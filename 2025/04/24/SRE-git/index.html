<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>版本管理系统Git和GitLab | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Site Reliability Engineering">
<meta property="og:type" content="article">
<meta property="og:title" content="版本管理系统Git和GitLab">
<meta property="og:url" content="http://example.com/2025/04/24/SRE-git/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="Site Reliability Engineering">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/SRE/day53/77.jpg">
<meta property="article:published_time" content="2025-04-24T01:21:27.000Z">
<meta property="article:modified_time" content="2025-04-30T10:29:51.677Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="Git">
<meta property="article:tag" content="Gitlab">
<meta property="article:tag" content="SRE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/SRE/day53/77.jpg"><link rel="shortcut icon" href="/../images/TITLE/user.webp"><link rel="canonical" href="http://example.com/2025/04/24/SRE-git/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '版本管理系统Git和GitLab',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2025-04-30 18:29:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/TITLE/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">103</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">35</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/SRE/day53/77.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">版本管理系统Git和GitLab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-24T01:21:27.000Z" title="发表于 2025-04-24 09:21:27">2025-04-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-30T10:29:51.677Z" title="更新于 2025-04-30 18:29:51">2025-04-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Git/">Git</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Gitlab/">Gitlab</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">29k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>110分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="版本管理系统Git和GitLab"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="DevOps-简介"><a href="#DevOps-简介" class="headerlink" title="DevOps 简介"></a>DevOps 简介</h1><h2 id="传统开发模型"><a href="#传统开发模型" class="headerlink" title="传统开发模型"></a>传统开发模型</h2><h3 id="软件开发生命周期"><a href="#软件开发生命周期" class="headerlink" title="软件开发生命周期"></a>软件开发生命周期</h3><p><strong>软件开发生命周期SDLC</strong> (Software Development Life Cycle)由计划，分析，设计，实现，测试集成和维护组成</p>
<p><img src="../../../../images/SRE/day53/1.jpg" alt="1"></p>
<ul>
<li><p>阶段1: 计划和需求分析 (Planning and Requirement Analysis)</p>
<p>每个软件开发生命周期模型都从分析开始，过程的利益相关者讨论对最终产品的要求。此阶段的目标是系统要求的详细定义。此外，还需要确保所有流程参与者都清楚地了解任务以及每个需求将如何实施。通常，讨论涉及质量保证专家，如果有必要，他们甚至可以在开发阶段干预过程中的添加。</p>
</li>
<li><p>阶段2: 设计项目架构 (Project Architecture) </p>
<p>在软件开发生命周期的第二阶段，开发人员实际上正在设计架构。所有利益相关者（包括客户）都会讨论此阶段可能出现的所有不同技术问题。此外，还定义了项目中使用的技术，团队负载，限制，时间范围和预算。最合适的项目决策是根据定义的要求做出的。</p>
</li>
<li><p>阶段3: 开发和编程 (Development and Coding)</p>
<p>在批准要求后，该过程进入下一阶段 - 实际开发。程序员从这里开始编写源代码，同时牢记先前定义的需求。系统管理员调整软件环境，前端程序员开发程序的用户界面以及与服务器交互的逻辑。编程本身一般会用四个阶段：算法开发，源代码编写，编译，测试和调试</p>
</li>
<li><p>阶段4: 测试 (Testing)</p>
<p>测试阶段包括调试过程。开发过程中遗漏的所有代码缺陷都会在此处检测到，记录下来并传回给开发人员进行修复。重复测试过程，直到删除所有关键问题并且软件工作流程稳定。</p>
</li>
<li><p>阶段5: 部署 (Deployment)</p>
<p>当程序最终确定并且没有关键问题时 - 是时候为最终用户启动它了。新程序版本发布后，技术支持团队加入。该部门提供用户反馈; 在利用期间咨询和支持用户。此外，此阶段还包括所选组件的更新，以确保软件是最新的，并且不会受到安全漏洞的影响。</p>
</li>
</ul>
<p><strong>SDLC模型 (Software Development Life cycle Model)</strong> </p>
<p>从第一个也是最古老的“瀑布式”SDLC模型演变而来，其种类不断扩大。比较常见的SDLC模型如下</p>
<ul>
<li>瀑布模型 (Waterfall Model)</li>
<li>迭代模型 (Iterative Model)</li>
<li>螺旋模型 (Spiral Model)</li>
<li>V形模型 (V-Shape Model)： 单元测试，集成测试，系统测试，验收测试 </li>
<li>敏捷模型 (Agile Model)</li>
</ul>
<h3 id="瀑布模型"><a href="#瀑布模型" class="headerlink" title="瀑布模型"></a>瀑布模型</h3><p>瀑布模型是早期实现的开发模型，是一个级联SDLC模型，其中开发过程看起来像制造业的流水线，一步一步地进行分析，预测，实现，测试，实施和支持阶段。该SDLC模型包括完全逐步执行每个阶段。该过程严格记录并预定义，具有该软件开发生命周期模型的每个阶段所期望的功能。</p>
<p><img src="../../../../images/SRE/day53/2.jpg" alt="2"></p>
<table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>简单易用和理解</td>
<td>各个阶段的划分完全固定，阶段之间产生大量的文档，极大地增加了工作量</td>
</tr>
<tr>
<td>当前一阶段完成后，只需要去关注后续阶段</td>
<td>由于开发模型是线性的，用户只有等到整个过程的末期才能见到开发成果，从而增加了开发风险</td>
</tr>
<tr>
<td>为项目提供了按阶段划分的检查节点</td>
<td>不适应用户需求的变化</td>
</tr>
</tbody></table>
<h3 id="敏捷开发"><a href="#敏捷开发" class="headerlink" title="敏捷开发"></a>敏捷开发</h3><p>敏捷开发的核心是迭代开发(lterative Development)与增量开发(IncrementalDevelopment) 。</p>
<p><img src="../../../../images/SRE/day53/3.jpg" alt="3"></p>
<p><strong>迭代开发：</strong></p>
<p>对于大型软件项目，传统的开发方式是采用一个大周期(比如一年或数年)进行开发，整个过程就是一次”大开发”</p>
<p>迭代开发的方式则不一样，它将开发过程拆分成多个小周期，即一次”大开发”变成多次”小开发”，每次小开发都是同样的流程，所以看上去就好像重复在做同样的步骤</p>
<p>比如： 某米公司生产手机，第一次生产某米1代(比较简陋)，逐年再生产某米2代，目前已经到某米1X代</p>
<p><strong>增量开发：</strong></p>
<p>软件的每个版本，都会新增一个可以被用户感知到的完整功能。也就是说，按照新增功能来划分迭代。</p>
<p>比如： 房地产公司开发一个小区。如果采用增量开发的模式，该公司第一个迭代就是交付一期楼盘，第二个迭代交付二期楼盘..….每个迭代都是完成一栋完整的楼盘。而不是第一个迭代挖好所有楼的地基，第二个迭代建好每栋楼的骨架，第三个迭代架设屋顶.……..</p>
<p>虽然敏捷开发将软件开发分成多个迭代，但是也要求，每次迭代都是一个完整的软件开发周期，必须按照软件工程的方法论，进行正规的流程管理。</p>
<p><strong>优势</strong></p>
<ul>
<li>尽早交付，加快资金回笼</li>
<li>降级风险，及时了解市场需求</li>
<li>提高效率，阶段性功能折分及快速质量反馈</li>
</ul>
<p>敏捷开发这种小步快跑的方式，大幅提高了开发团队的工作效率，让版本的更新速度变得更快。 </p>
<p>更新版本的速度快了，风险不是更大了吗？其实，事实并非如此。</p>
<p>敏捷开发可以帮助更快地发现问题，产品被更快地交付到用户手中，团队可以更快地得到用户的反馈，从而进行更快地响应。而且，DevOps小步快跑的形式带来的版本变化是比较小的，风险会更小（如下图所示）。即使出现问题，修复起来也会相对容易一些。</p>
<p><img src="../../../../images/SRE/day53/4.jpg" alt="4"></p>
<h2 id="DevOps-介绍"><a href="#DevOps-介绍" class="headerlink" title="DevOps 介绍"></a>DevOps 介绍</h2><h3 id="什么是-DevOps"><a href="#什么是-DevOps" class="headerlink" title="什么是 DevOps"></a>什么是 DevOps</h3><p><img src="../../../../images/SRE/day53/5.jpg" alt="5"></p>
<p>DevOps 即开发 Development 和 Operations运维的缩写。</p>
<p>DevOps的维基百科定义是这样的：</p>
<p><strong>DevOps是一组过程、方法与系统的统称，用于促进开发、技术运营和质量保障（QA）部门之间的沟通、协作与整合。</strong></p>
<p>DevOps 是针对开发人员、运维人员和测试人员的一种工作理念，是软件在应用开发、代码部署和质量测试等整条生命周期中协作和沟通的最佳实践</p>
<p>DevOps 强调整个组织的所有相关部门的紧密合作以及交付和基础设施变更的自动化、从而实现持续集成、持续部署和持续交付的目标</p>
<h3 id="为什么要-DevOps"><a href="#为什么要-DevOps" class="headerlink" title="为什么要 DevOps"></a>为什么要 DevOps</h3><p>传统的模式是开发人员只关心开发程序，追求功能的变化和实现</p>
<p>运维只负责基础环境管理和代码部署及监控等，更看重应用的稳定运行</p>
<p>双方缺少一个共同的目标</p>
<p><img src="../../../../images/SRE/day53/6.jpg" alt="6"></p>
<p>DevOps 强调团队协作、相互协助、持续发展，实现团队作战，即无论是开发、运维还是测试，都为了最终的代码发布、持续部署和业务稳定而付出各自的努力，从而实现产品设计、开发、测试和部署的良性循环，实现产品的最终持续交付。</p>
<p><img src="../../../../images/SRE/day53/7.jpg" alt="7"></p>
<p>想要将DevOps真正落地，首先第一点，是思维转变，也就是“洗脑”。不仅是运维的要洗，开发的也要洗。员工要洗，领导更要洗。</p>
<p>DevOps并不仅仅是组织架构变革，更是企业文化和思想观念的变革。如果不能改变观念，即使将员工放在一起，也不会产生火花。</p>
<p>除了洗脑之外，就是根据DevOps思想重新梳理全流程的<strong>规范和标准</strong>。</p>
<p>在DevOps的流程下，运维人员会在项目开发期间就介入到开发过程中，了解开发人员使用的系统架构和技术路线，从而制定适当的运维方案。而开发人员也会在运维的初期参与到系统部署中，并提供系统部署的优化建议。</p>
<p>DevOps的实施，促进开发和运维人员的沟通，增进彼此的理（gan）解（qing）。</p>
<p><strong>DevOps组织优先推动的目标</strong></p>
<ul>
<li>一组标准化的环境</li>
<li>降低新版本的失败率</li>
<li>缩短版本之间的交付时间</li>
<li>更快的平均版本恢复时间</li>
</ul>
<p><strong>DevOps的关键指标</strong></p>
<ul>
<li>平均恢复时间： Mean-time to recovery (MTTR)</li>
<li>平均投产时间： Mean-time to production</li>
<li>平均提前时间:Average lead-time，比计划时间提前</li>
<li>部署速度:Deployment speed</li>
<li>部署频率:Deployment frequency</li>
<li>生产失败率:Production failure rate</li>
</ul>
<h3 id="DevOps-相关的软件"><a href="#DevOps-相关的软件" class="headerlink" title="DevOps 相关的软件"></a>DevOps 相关的软件</h3><p>在思维和流程改变的同时，想要充分落地DevOps，当然离不开软件和平台的支持。目前支持DevOps的软件很多了。</p>
<p><img src="../../../../images/SRE/day53/8.jpg" alt="8"></p>
<p>DevOps 涉及的四大相关平台</p>
<ul>
<li>项目管理：如：Jira,禅道</li>
<li>代码托管：如：Gitlab,SVN</li>
<li>持续交付：如：Jenkins,Gitlab</li>
<li>运维平台：如：腾讯蓝鲸,Spug等</li>
</ul>
<h2 id="持续集成、持续交付和持续部署-CICD"><a href="#持续集成、持续交付和持续部署-CICD" class="headerlink" title="持续集成、持续交付和持续部署 CICD"></a>持续集成、持续交付和持续部署 CICD</h2><p>最初是<strong>瀑布模型</strong>，后来是<strong>敏捷开发</strong>，现在是<strong>DevOps</strong>，这是现代开发人员构建出色的产品的技术路线。随着DevOps的兴起，出现了<strong>持续集成</strong>（Continuous Integration）、<strong>持续交付</strong>（Continuous  Delivery） 、<strong>持续部署</strong>（Continuous Deployment） 的新方法。</p>
<p>传统的软件开发和交付方法正在迅速变得过时。从以前的敏捷时代，大多数公司会每月，每季度，每两年甚至每年发布部署/发布软件。然而现在在DevOps时代，每周，每天，甚至每天多次是常态。</p>
<p>当SaaS正在占领世界时，尤其如此，您可以轻松地动态更新应用程序，而无需强迫客户下载新组件。很多时候，他们甚至都不会意识到正在发生变化。开发团队通过软件交付流水线（Pipeline）实现自动化，以缩短交付周期，大多数团队都有自动化流程来检查代码并部署到新环境。</p>
<p>CI/CD 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法。CI/CD 的核心概念是持续集成、持续交付和持续部署。作为一个面向开发和运营团队的解决方案，CI/CD 主要针对在集成新代码时所引发的问题</p>
<p>具体而言，CI/CD 可让持续自动化和持续监控贯穿于应用的整个生命周期（从集成和测试阶段，到交付和部署）。这些关联的事务通常被统称为“CI/CD 管道”，由开发和运维团队以敏捷方式协同支持。</p>
<p>CICD 红帽参考连接</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.redhat.com/zh/topics/devops/what-is-ci-cd</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/9.jpg" alt="9"></p>
<p><img src="../../../../images/SRE/day53/10.jpg" alt="10"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ee/ci/introduction/</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/11.jpg" alt="11"></p>
<h3 id="持续集成-CI-Continuous-Integration"><a href="#持续集成-CI-Continuous-Integration" class="headerlink" title="持续集成 (CI-Continuous Integration)"></a>持续集成 (CI-Continuous Integration)</h3><p>集成指将多位开发者的开发代码提交后，合并集成在一起，存放在代码库的过程，并且后续还会不断的迭代更新代码</p>
<p>持续集成是指多名开发者在开发不同功能代码的过程当中，可以频繁的将代码行合并到一起并切相互不影响工作。很多情况下每天都要进行几次，主要目的是尽早发现集成错误，使团队更加紧密结合，更好地协作。</p>
<p>CI属于开发人员的自动化流程。成功的 CI 意味着应用代码的新更改会定期构建、测试并合并到共享存储库中。该解决方案可以解决在一次开发中有太多应用分支，从而导致相互冲突的问题。</p>
<p><strong>持续集成强调开发人员提交了新代码之后，立刻进行构建、（单元）测试。</strong> </p>
<p>根据测试结果，可以确定新代码和原有代码能否正确地集成在一起。通过持续集成可以自动编译、打包、签名项目，配合单元测试可以实现持续集成+自动化测试。让工程师从重复而又枯燥的手动打包完全解放出来，让工程师能更加专注于代码本身，最大限度的减少误操作风险，降低修复错误代码的成本，大幅提高工作效率。</p>
<h3 id="持续交付-CD-Continuous-Delivery"><a href="#持续交付-CD-Continuous-Delivery" class="headerlink" title="持续交付(CD-Continuous Delivery)"></a>持续交付(CD-Continuous Delivery)</h3><p>完成 CI 中构建及单元测试和集成测试的自动化流程后，持续交付可以自动的将已验证的代码发布到存储库。为了实现高效的持续交付流程，务必要确保 CI 已内置于开发管道。<strong>持续交付的目标是拥有一个可随时部署到生产环境的代码库。</strong></p>
<p>在持续交付中，每个阶段（从代码更改的合并，到生产就绪型构建版本的交付）都涉及测试自动化和代码发布自动化。在流程结束时，运维团队可以快速、轻松地将应用部署到生产环境中。</p>
<p><strong>持续交付完成了构建和测试过程细致的自动化，但是如何发布以及发布什么仍然是需要人工操作，持续部署可以改变这一点。</strong></p>
<p>持续集成（CONTINUOUS INTEGRATION，CI）指的是开发人员频繁的（一天多次的）将所有开发者的工作合并到主干上。这些新提交在最终合并到主线之前，都需要通过编译和自动化测试流进行验证，以保障所有的提交在合并主干之后的质量问题，对可能出现的一些问题进行预警。持续集成的核心在于确保新增的代码能够与原先代码正确的集成。</p>
<p>持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环境的「类生产环境」（production-like environments）中。比如，我们完成单元测试后，可以把代码部署到连接数据库的 Staging 环境中更多的测试。如果代码没有问题，可以继续手动部署到生产环境中。此方式是当前普遍采用的方式</p>
<p><img src="../../../../images/SRE/day53/12.jpg" alt="12"></p>
<h3 id="持续部署-CD-Continuous-Deployment"><a href="#持续部署-CD-Continuous-Deployment" class="headerlink" title="持续部署(CD-Continuous Deployment)"></a>持续部署(CD-Continuous Deployment)</h3><p>对于一个成熟的 CI/CD 管道来说，最后的阶段是持续部署。作为持续交付(自动将生产就绪型构建版本发布到代码存储库)的进一步延伸，持续部署可以自动将应用发布到生产环境。由于在生产之前的管道阶段没有手动风控，因此持续部署在很大程度上都得依赖精心设计的测试自动化。</p>
<p>实际上，持续部署意味着开发人员对应用的更改在编写后的几分钟内就能生效（假设它通过了自动化测试）。这更加便于持续接收和整合用户反馈。总而言之，所有这些 CI/CD 的关联步骤都有助于降低应用的部署风险，因此更便于以小件的方式（而非一次性）发布对应用的更改。不过，由于还需要编写自动化测试以适应 CI/CD 管道中的各种测试和发布阶段，因此前期投资还是会很大。</p>
<p>持续部署是基于某种工具或平台实现代码自动化的构建、测试和部署到线上环境以实现交付高质量的产品，持续部署在某种程度上代表了一个开发团队的更新迭代速率。</p>
<p>与持续集成相比，持续交付（CONTINUOUS DELIVERY）的侧重点在于交付，其核心对象不在于代码，而在于可交付的产物。由于持续集成仅仅针对于新旧代码的集成过程执行了一定的测试，其变动到持续交付后还需要一些额外的流程。与持续集成相比较，持续交付添加了测试Test-&gt;模拟Staging-&gt;生产Production的流程，也就是为新增的代码添加了一个保证：确保新增的代码在生产环境中是可用的。</p>
<p>在持续交付的基础上，把部署到生产环境的过程自动化。如果你对比上图持续部署就可以发现持续部署和持续交付的区别就是最终部署到生产环境是自动化的。因为自动发布存在较大的风险，当前采用此方式较少.</p>
<p><img src="../../../../images/SRE/day53/13.jpg" alt="13"></p>
<h2 id="CICD-流程过程和架构"><a href="#CICD-流程过程和架构" class="headerlink" title="CICD 流程过程和架构"></a>CICD 流程过程和架构</h2><h3 id="应用部署发展阶段"><a href="#应用部署发展阶段" class="headerlink" title="应用部署发展阶段"></a>应用部署发展阶段</h3><ul>
<li><p>开发人员自行上传代码</p>
<p>早期项目，没有专业的运维人员，运维的工作由开发兼职完成，项目发布很不专业，很容易出错，也是最原始的方式</p>
</li>
<li><p>开发人员先将代码发给运维，再由运维人员手动上传至生产环境</p>
<p>专业的运维人员完成应用的部署，每次项目发布都由运维人员一步一步手动实现，效率低下且容易出错</p>
</li>
<li><p>运维利用脚本和自动化运维工具实现部署</p>
<p>由运维人员编写Shell,Python等脚本或利用自动化运维工具，如Ansible等实现半自动化应用部署，效率很高，但对技术的专业性有较高要求</p>
</li>
<li><p>通过 Web 等 GUI 界面实现一键自动化部署</p>
<p>可以通过开源或自研的运维平台实现方便的应用部署，操作容易，效率高，但需要提前构建运维平台，比如，Jenkins等</p>
</li>
</ul>
<p><img src="../../../../images/SRE/day53/14.jpg" alt="14"></p>
<h3 id="CICD-相关工具"><a href="#CICD-相关工具" class="headerlink" title="CICD 相关工具"></a>CICD 相关工具</h3><p><img src="../../../../images/SRE/day53/15.jpg" alt="15"></p>
<h3 id="CICD-流程"><a href="#CICD-流程" class="headerlink" title="CICD 流程"></a>CICD 流程</h3><p><img src="../../../../images/SRE/day53/16.jpg" alt="16"></p>
<p><img src="../../../../images/SRE/day53/17.jpg" alt="17"></p>
<ul>
<li>开发人员不断的进行代码提交到本地，再提交到运程的代码仓库服务器 </li>
<li>Jenkins作为持续集成工具，使用Git工具到Git仓库拉取代码到集成服务器，代码测试与审查，再配合JDK，Maven，Go等软件完成代码编译，测试，打包等工作，在这个过程中每一步如果出错，都需要重新再执行一次整个流程。</li>
<li>Jenkins把生成的软件jar或war包等分发到测试服务器或者生产服务器，测试人员或用户就可以访问应用。</li>
</ul>
<h3 id="Kubernetes-环境的-CICD"><a href="#Kubernetes-环境的-CICD" class="headerlink" title="Kubernetes 环境的 CICD"></a>Kubernetes 环境的 CICD</h3><p><img src="../../../../images/SRE/day53/18.jpg" alt="18"></p>
<h3 id="CICD-服务器架构"><a href="#CICD-服务器架构" class="headerlink" title="CICD 服务器架构"></a>CICD 服务器架构</h3><p><img src="../../../../images/SRE/day53/19.jpg" alt="19"></p>
<h3 id="DevOps-与-CICD-的联系与区别"><a href="#DevOps-与-CICD-的联系与区别" class="headerlink" title="DevOps 与 CICD 的联系与区别"></a>DevOps 与 CICD 的联系与区别</h3><ul>
<li>CICD是软件工程实践的方法，需要借助于各种工具来具体实现</li>
<li>DevOps是一种文化：也正是容器、容器编排、微服务等技术使得DevOps最终能够以应有的方式得以落地</li>
<li>通常，在开发环境中自动化持续集成和持续交付(CI /CD)是DevOps团队的最终目标</li>
</ul>
<h2 id="版本控制系统-VCS"><a href="#版本控制系统-VCS" class="headerlink" title="版本控制系统 VCS"></a>版本控制系统 VCS</h2><p>关于版本控制</p>
<ul>
<li>版本控制（Version control）是维护工程蓝图的标准做法，能追踪工程蓝图从诞生一直到定案的过程</li>
<li>版本控制也是一种软件工程技巧，借此能在软件开发的过程中，确保由不同人所编辑的同一程序文件都得到同步</li>
<li>软件工程师常利用版本控制来跟踪、维护原始码、文档以及配置文件等的改动</li>
</ul>
<p>软件版本控制的方法</p>
<ul>
<li>最简单的情况下，软件设计师可以自己保留一个程序的许多不同版本，并且为它们做适当的编号<ul>
<li>这种简单的方法曾被用在很多大型的软件项目中</li>
<li>虽然可行，但效率较低</li>
<li>必须同时维护很多几乎一样的原始码备分，而且极度依赖软件设计师的自我修养与开发纪律</li>
</ul>
</li>
<li>使用版本控制系统（Version Control System，VCS），实现部分或全部版本控制工作的自动化，版本控制系统是一种软件，可以帮助软件团队的开发人员协同工作，并存档他们工作的完整历史记录。</li>
</ul>
<p><strong>为什么使用 VCS ?</strong></p>
<p>在实际开发过程中，经常会有这种需求或问题</p>
<ul>
<li>代码可能被破坏，比如误删除等，希望还能找回</li>
<li>代码出现了严重的Bug,希望回滚至数周前的旧代码</li>
<li>需要在已经发布的程序中添加新的功能，如果测试验证后没有问题，才会使用新的代码，而在测试验证期间，不能影响原来的代码</li>
<li>同一个软件需要有多个版本并行开发，满足不同的应用需求 实际项目开发基本都是多个人合作完成，在多个人写代码时，就牵扯到代码合并成一份的问题。</li>
<li>异地源代码备份，使用 VCS 时，需要创建一个 VCS 的远程实例，以在开发人员之间共享更改，这个远程 VCS 实例可以由值得信赖的第三方（如GitHub）进行异地托管；然后，它就会成为安全的异地备份</li>
</ul>
<h3 id="版本控制系统分类"><a href="#版本控制系统分类" class="headerlink" title="版本控制系统分类"></a>版本控制系统分类</h3><ul>
<li><p>本地版本控制系统</p>
<p>第一代版本控制系统被称为本地版本控制系统。通过加锁将并发执行转换成顺序执行。 一次只能有一个人处理文件。</p>
<p>具体流程如下：首先，应该把文件放在一个服务器上，方便使用者上传或下载文件；其次，任何人想对文件修改时，需要先把这个文件加锁，通过checkout指令，使得其他人无法修改；最后，当修改完成之后，需要释放锁，通过checkin指令，形成一个新的版本，存放到服务器端。</p>
<p>第一代版本控制系统主要有 RCS、SCCS（1972年发布）和 DSEE（被认为是 Atria ClearCase 的前身）。目前，有些项目还在使用</p>
</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">悲观锁</span><br><span class="line">每次获取数据的时候，都会担心数据被修改，所以每次获取数据的时候都会进行加锁，确保在自己使用的</span><br><span class="line">过程中数据不会被别人修改，使用完成后进行数据解锁。由于数据进行加锁，期间对该数据进行读写的其</span><br><span class="line">他线程都会进行等待。</span><br><span class="line">乐观锁</span><br><span class="line">每次获取数据的时候，都不会担心数据被修改，所以每次获取数据的时候都不会进行加锁，但是在更新数</span><br><span class="line">据的时候需要判断该数据是否被别人修改过。如果数据被其他线程修改，则不进行数据更新，如果数据没</span><br><span class="line">有被其他线程修改，则进行数据更新。由于数据没有进行加锁，期间该数据可以被其他线程进行读写操作。</span><br><span class="line">乐观锁一般会使用版本号机制或 CAS 算法实现。</span><br></pre></td></tr></table></figure>

<ul>
<li>集中式版本控制系统</li>
</ul>
<p><img src="../../../../images/SRE/day53/20.jpg" alt="20"></p>
<ul>
<li><p>用户想要完成任何的提交和回滚都依赖于连接集中的代码服务器才能实现，比如下班回家后，如果无法连接至代码的服务器，将无法提交代码</p>
<p>此外此集中式服务器还存在单点问题，在集中式实例的不可用期间，开发人员就无法推送、合并或回滚代码 </p>
<p>此方式可以更好的实现软件仓库的安全访问限制和控制</p>
</li>
<li><p>分布式版本控制系统</p>
<p>在每个用户都有一个完整的服务器，用于保存软件的完整版本，然后再部署一个中央服务器</p>
<p>用户可以先将代码提交到本地，没有网络也可以先提交到本地，然后在有网络的时候再提交到中央服务器，这样就大大方便了开发者</p>
<p>相比集中式的版本控制系统，工作的时候需要先从中央服务器获取最新的代码，改完之后需要提交，如果是一个比较大的文件则需要足够快的网络才能快速提交完成</p>
<p>而使用分布式的版本控制系统，每个用户都是一个完整的版本库，即使没有中央服务器也可以提交代码或者回滚，最终再把改好的代码提交至中央服务器进行合并即可。</p>
<p>此方式不容易实现软件仓库的安全访问限制和控制</p>
</li>
</ul>
<p><img src="../../../../images/SRE/day53/21.jpg" alt="21"></p>
<h3 id="常见的版本控制系统"><a href="#常见的版本控制系统" class="headerlink" title="常见的版本控制系统"></a>常见的版本控制系统</h3><p><img src="../../../../images/SRE/day53/22.jpg" alt="22"></p>
<h4 id="CVS-Concurrent-Version-System-集中式版本控制系统"><a href="#CVS-Concurrent-Version-System-集中式版本控制系统" class="headerlink" title="CVS(Concurrent Version System) 集中式版本控制系统"></a>CVS(Concurrent Version System) 集中式版本控制系统</h4><p>并发版本系统（Concurrent Versions System，CVS）是最初的第二代版本控制系统。大约十年间，它是最为流行的版本控制系统，直到 2000 年被 Subversion 所取代。</p>
<p>CVS 最早是由一位名叫 Dick Grune 的荷兰科学家于 1986 年 6 月 23 日公开发布了该代码。CVS 最初仅仅只是一个包装了 RCS（ 修订控制系统(Revision Control System)) 的 Shell 脚本集合。最终演变成当前版本的 CVS 的代码始于 1989 年 4 月的 Brian Berliner 的贡献，后来由 Jeff Polk 和许多其他贡献者提供帮助。 Brian Berliner 撰写了一篇论文，介绍了他对 CVS 程序的改进 - 该程序描述了该工具是如何在 Prysma 内部扩展和使用的。 1990 年 11 月 19 日，CVS 1.0 版被提交给自由软件基金会进行开发和分发。</p>
<p>CVS是一个C/S系统，是一个早期常用的代码版本控制软件。多个开发人员通过一个中心版本控制系统来记录文件版本，从而达到保证文件同步的目的。CVS版本控制系统是一种GNU软件包，主要用于在多人开发环境下的源码的维护。</p>
<p>由于 CVS 是集中式版本控制系统，所以它有客户端和服务端之区分。但要开始使用 CVS 的话，即使只在你的本地机器上使用，也必须设置 CVS 的服务端。</p>
<h4 id="SVN-Subversion-集中式版本控制系统"><a href="#SVN-Subversion-集中式版本控制系统" class="headerlink" title="SVN(Subversion) 集中式版本控制系统"></a>SVN(Subversion) 集中式版本控制系统</h4><p>SVN 由 CollabNet 公司于 2000 年资助并发起开发，目的是创建一个更好用的版本控制系统以取代CVS。</p>
<p>2000 年 2 月，CollabNet 联系了 Open Source Development with CVS（Coriolis, 1999）的作者 Karl Fogel，问他是否愿意为这个新项目工作。这时 Karl 已经在和他的朋友 Jim Blandy 讨论一个新的版本控制系统的设计。他不仅已经起好了名字 “Subversion”，而且有了 Subvesion 资料库的基本设计。</p>
<p>经过 14 个月的编码，在 2001 年 8 月 31 号，Subversion 可以“自我寄生”了。就是说，Subversion 开发人员停止使用 CVS 管理 Subversion 的源代码，开始使用 Subversion 代替。</p>
<p>2009 年 11 月，Subversion 被 Apache Incubator 项目所接收。2010 年 1 月，正式成为 Apache 软件基金会的一个顶级项目</p>
<p>SVN 依赖于网络，需要在各个开发主机上安装客户端软件，并且在一台服务器集中进行版本管理和存储.目前依然有部分公司在使用</p>
<p><strong>优点</strong>：</p>
<ul>
<li>管理方便，逻辑明确，符合一般人思维习惯。</li>
<li>易于管理，集中式服务器更能保证安全性。</li>
<li>代码一致性非常高。</li>
<li>适合开发人数不多的项目开发。</li>
</ul>
<p><strong>缺点</strong>： </p>
<ul>
<li>服务器压力太大，数据库容量暴增。</li>
<li>如果不能连接到服务器上，基本上不可以工作，如果服务器不能连接上，就不能提交，还原，对比等等。</li>
<li>不适合开源开发（开发人数非常非常多，但是Google app engine就是用svn的）。但是一般集中式管理的有非常明确的权限管理机制（例如分支访问限制），可以实现分层管理，从而很好的解决开发人数众多的问题。</li>
</ul>
<h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><p><img src="../../../../images/SRE/day53/23.jpg" alt="23"></p>
<p>在 Linux 开源的初期，Linux 开源项目的代码是 linus 本人通过 linux 命令 diff 和 patch 两条命令手动完成。随着 Linux 代码越来越壮大，靠 Linus 一个人来手动合并已经不现实。2002 年，Linus 选择了一个商业版本控制系统 BitKeeper 作为 Linux 内核的代码管理工具（BitKeeper 的开发商 BitMover 授权 linux 社区免费使用）。但是，免费使用是有很多的限制的，因此 linux 社区的大佬开始破解 BitKeeper。其中，samba 的作者 andrew 破解成功了。但是被 BitMover 公司发现，收回免费使用权。</p>
<p>迫不得已，Linus 选择了自己开发一个分布式版本控制工具以替代 BitKeeper。linus 闭关一个月，写出了 Git。在一个月后，Git 成功接管了 Linux 社区的版本控制工作，并且开始开源。维基百科中，有如下历史记录：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2005年4月3日，开始开发 Git。</span><br><span class="line">2005年4月6日，项目发布。</span><br><span class="line">2005年4月7日，Git就可以作为自身的版本控制工具了。</span><br><span class="line">2005年4月18日，发生第一个多分支合并。</span><br><span class="line">2005年4月29日，Git 的性能就已经达到了 Linus 的预期。</span><br><span class="line">2005年6月16日，Linux 2.6.12 发布，那时 Git 已经在维护 Linux 核心的源代码了。</span><br><span class="line">2005年7月26日，Linus 功成身退，将 Git 的维护交给另外一个 Git 的主要贡献者 Junio C Hamano。</span><br><span class="line">2016年5月，BitKeeper宣布使用 Apache 2.0许可证开源。</span><br></pre></td></tr></table></figure>

<p><strong>Git 重要特性：</strong></p>
<p>在本地就可以完成提交，因此不需要网络，提交完成后，可以有网络环境时，再同步到远程仓库服务器</p>
<p><strong>优点：</strong></p>
<ul>
<li>适合分布式开发，强调个体。</li>
<li>公共服务器压力和数据量都不会太大。</li>
<li>速度快、灵活。</li>
<li>任意两个开发者之间可以很容易的解决冲突。</li>
<li>支持离线工作。</li>
</ul>
<p><strong>缺点：</strong> </p>
<ul>
<li>不符合常规思维。</li>
<li>学习周期相对而言比较长。</li>
<li>代码保密性差，一旦开发者把整个库克隆下来就可以完全公开所有代码和版本信息。</li>
</ul>
<h4 id="Github-网站"><a href="#Github-网站" class="headerlink" title="Github 网站"></a>Github 网站</h4><p>2008年1月，Wanstrath和Preston-Werner推出使用Ruby on Rails编写而成的GitHub的个人测试版。2月，他们又增加了第三位联合创始人PJ Hyett，到2008年3月，GitHub的beta版已经拥有了2000名用户。GitHub于2008年4月推出公共版本，然后逐渐在开发者社区中流行起来，到2009年7月，用户数量达到了10万。</p>
<p>由于GitHub在软件开发人员中很受欢迎，成立后的四年，GitHub通过向个人程序员和企业收取每月访问平台的费用，在没有外部资金的情况下得以生存下来。</p>
<p>GitHub网站为开源项目免费提供Git存储，无数开源项目开始迁移至GitHub，包括jQuery，PHP，Ruby等等。GitHub同时提供付费账户和免费账户。这两种账户都可以创建公开的代码仓库，但是只有付费账户可以创建私有的代码仓库。 </p>
<p>2018年6月5日 微软花费 75 亿美元收购 GitHub</p>
<p>2019年1月7日 免费的 GitHub 用户现在可以获得不受限制的私人项目，最多可以有三个协同合作者</p>
<p>2020年4月14日 GitHub宣布向所有用户和团队提供不限制协作人数的私有仓库，同时GitHub的核心功能对所有人免费开放</p>
<p>官网： <a target="_blank" rel="noopener" href="http://www.github.com/">http://www.github.com</a></p>
<h4 id="GitLab-网站和软件"><a href="#GitLab-网站和软件" class="headerlink" title="GitLab 网站和软件"></a>GitLab 网站和软件</h4><p>Github 提供了公有云的软件仓库服务，但实现私有仓库早期是收费的，而GitLab的出现解决了这一问题。GitLab由乌克兰程序员DmitriyZaporozhets和ValerySizov开发，它使用Ruby语言写成。后来，一些部分用Go语言重写，是完全免费的开源软件，按照MIT许可证分发。2013年7月，GitLab产品被拆分为两个版本：GitLab CE（社区版）和GitLab EE（企业版），2014年2月，GitLab宣布采用开放核心业务模式。GitLabEE设置在专有许可证下，并且包含CE版本中不存在的功能。GitLabCE是使用MIT许可证的基于网络的Git仓库管理工具，且具有wiki和issue跟踪功能。使用Git作为代码管理工具，并在此基础上搭建起来的Web服务。</p>
<p>从安全方面来看，公司不希望员工获取到全部的代码，这个时候GitLab是最佳的选择。但对于开源项目而言，GitHub 依然是代码托管的首选平台。</p>
<p>GitLab 官方网站： <a target="_blank" rel="noopener" href="https://about.gitlab.com/">https://about.gitlab.com/</a></p>
<p><strong>Gitlab 企业版：</strong></p>
<p><img src="../../../../images/SRE/day53/24.jpg" alt="24"></p>
<p><strong>Gitlab 的优势</strong> </p>
<ul>
<li>开源免费，搭建简单、维护成本较低、可适用于中小型公司内部项目使用。</li>
<li>权限管理功能强大灵活，能实现代码对部分人可见，确保项目的安全性。 </li>
<li>支持离线提交，基于git实现，可以不在实时依赖网络环境进行代码提交。</li>
</ul>
<h2 id="常见的软件部署模式"><a href="#常见的软件部署模式" class="headerlink" title="常见的软件部署模式"></a>常见的软件部署模式</h2><h3 id="蓝绿部署-Blue-green-Deployments"><a href="#蓝绿部署-Blue-green-Deployments" class="headerlink" title="蓝绿部署 Blue-green Deployments"></a>蓝绿部署 Blue-green Deployments</h3><p><img src="../../../../images/SRE/day53/25.jpg" alt="25"></p>
<p>蓝绿部署指的是不停止老版本代码(不影响上一个版本访问)，而是在另外一套环境部署新版本然后进行测试，测试通过后将用户流量切到新版本，其特点为业务无中断，升级风险相对较小。但本方式成本较高， 一般小公司较少使用</p>
<p>蓝绿色部署是一种部署策略，利用两种相同的环境，即”蓝色”（又名预发布）环境和”绿色”（又名生产）环境，具有不同版本的应用程序或服务。质量保证和用户接受度测试通常在承载新版本或更改的蓝色环境中进行。一旦蓝色环境中测试并接受新的变化，用户流量就会从绿色环境切换为蓝色环境。然后，一旦部署成功，您可以切换到新环境。</p>
<p>具体过程：</p>
<p>1、当前版本(V1)业务正常访问</p>
<p>2、在另外一套环境部署新代码版本(V2)，代码可能是增加了功能或者是修复了某些bug</p>
<p>3、测试通过之后将用户请求流量切到新版本环境</p>
<p>4、观察一段时间，如有异常直接切换旧版本</p>
<p>5、下次升级，将旧版本(V2)升级到新版本(V3)</p>
<p>蓝绿部署适用的场景：</p>
<p>1、不停止老版本，额外部署一套新版本，等测试确认新版本正常后，才将用户请求切换至新版本，如果有问题，切换回老版本</p>
<p>2、蓝绿发布是一种用于升级与更新的发布策略，部署的最小维度是容器，而发布的最小维度是应用。</p>
<p>3、蓝绿发布对于增量升级有比较好的支持，但是对于涉及数据表结构变更等等不可逆转的升级，并不完全合适用蓝绿发布来实现，需要结合一些业务的逻辑以及数据迁移与回滚的策略才可以完全满足需求。</p>
<h3 id="金丝雀-灰度-发布-Canary-Deployment"><a href="#金丝雀-灰度-发布-Canary-Deployment" class="headerlink" title="金丝雀(灰度)发布 Canary Deployment"></a>金丝雀(灰度)发布 Canary Deployment</h3><p><img src="../../../../images/SRE/day53/26.jpg" alt="26"></p>
<p>“金丝雀”的由来：17世纪英国矿井工人发现，金丝雀对瓦斯这种气体十分敏感。空气中哪怕有极其微量的瓦斯，金丝雀也会停止歌唱；而当瓦斯含量超过一定限度时，虽然人类毫无察觉，金丝雀却早已毒发身亡。当时在采矿设备相对简陋的条件下，工人每次下井都会带上一只金丝雀作为“瓦斯检测指标”，以便在危险状况下紧急撤离。</p>
<p>金丝雀发布也叫灰度发布，是指在黑与白之间，能够平滑过渡的一种发布方式，灰度发布是增量发布（例如：2%、25%、75%、100%）进行更新)的一种类型，灰度发布是在原有版本可用的情况下，同时部署一个新版本应用作为“金丝雀”(小白鼠)，测试新版本的性能和表现，以保障整体系统稳定的情况下，尽早发现、调整问题。因此，灰度发布可以保证整体系统的稳定，在初始灰度的时候就可以发现、调整问题，以保证其影响度。</p>
<p>此方式在实际生产中使用较为普遍</p>
<p><strong>金丝雀/灰度发布步骤组成：</strong></p>
<p>1、准备好部署各个阶段的工件，包括：构建组件，测试脚本，配置文件和部署清单文件。</p>
<p>2、从负载均衡列表中移除掉“金丝雀”服务器（选择全部服务器中的一部分）。</p>
<p>3、升级“金丝雀”应用（排掉原有流量并进行部署）。</p>
<p>4、对应用进行自动化测试。</p>
<p>5、将“金丝雀”服务器重新添加到负载均衡列表中（连通性和健康检查）。</p>
<p>6、如果“金丝雀”在线使用测试成功，升级剩余的其他服务器。否则就回滚回旧版本</p>
<p><strong>金丝雀/灰度发布部署适用的场景：</strong></p>
<p>1、不停止老版本，额外搞一套新版本，不同版本应用共存。</p>
<p>2、灰度发布中，常常按照用户设置路由权重，例如90%的用户维持使用老版本，10%的用户尝鲜新版本。</p>
<p>3、经常与A/B测试一起使用，用于测试选择多种方案。</p>
<h3 id="滚动发布-更新"><a href="#滚动发布-更新" class="headerlink" title="滚动发布(更新)"></a>滚动发布(更新)</h3><p>滚动发布故名思议，就是逐步升级服务中的节点</p>
<p>滚动发布是指每次只升级一个或多个服务实例，升级完成后加入生产环境，不断执行这个过程，直到集群中的全部旧版本升级新版本。</p>
<p><img src="../../../../images/SRE/day53/27.jpg" alt="27"></p>
<p>红色：正在更新的实例</p>
<p>蓝色：更新完成并加入集群的实例</p>
<p>绿色：正在运行的实例</p>
<p><strong>滚动发布过程</strong></p>
<ol>
<li>先升级1个服务实例，主要做部署验证；</li>
<li>每次升级1个服务实例，自动从LB上摘掉，升级成功后自动加入集群</li>
<li>事先需要有自动更新策略，分为若干次，每次数量/百分比可配置</li>
<li>回滚是发布的逆过程，先从LB摘掉新版本，再升级老版本，这个过程一般时间比较长 </li>
<li>自动化要求高</li>
</ol>
<h3 id="A-B测试-A-B-Testing"><a href="#A-B测试-A-B-Testing" class="headerlink" title="A/B测试 A/B Testing"></a>A/B测试 A/B Testing</h3><p><img src="../../../../images/SRE/day53/28.jpg" alt="28"></p>
<p>A/B测试即同时对外提供两个APP运行环境，这和蓝绿部署的同时只有一个版本在线是不同的</p>
<p>A/B 测试是用来测试应用功能表现的方法，例如可用性、受欢迎程度、可见性等等 </p>
<p>蓝绿部署和A/B测试是不同的，蓝绿部署的目的是安全稳定地发布新版本应用，并在必要时回滚，即蓝绿部署是同一时间只有一套正式环境在线，而A/B测试是两套正式环境同时在线，一般用于多个产品竟争时使用</p>
<h1 id="版本控制系统-Git"><a href="#版本控制系统-Git" class="headerlink" title="版本控制系统 Git"></a>版本控制系统 Git</h1><h2 id="数据保存方式"><a href="#数据保存方式" class="headerlink" title="数据保存方式"></a>数据保存方式</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/book/zh/v2/起步-Git-是什么？</span><br></pre></td></tr></table></figure>

<p><strong>SVN 与 CVS：</strong> </p>
<p>每次提交的文件都单独保存， 即按照文件的提交时间区分不同的版本， 保存至不同的逻辑存储区域，后期恢复时候直接基于之前版本恢复。 将它们存储的信息看作是一组基本文件和每个文件随时间逐步累积的差异 （它们通常称作基于差异（delta-based） 的版本控制）</p>
<p><img src="../../../../images/SRE/day53/29.jpg" alt="29"></p>
<p><strong>Git:</strong></p>
<p>在 Git中，每当你提交更新或保存项目状态时，它基本上就会对当时的全部文件创建一个快照并保存这 快照的索引。为了效率，如果文件没有修改，Git 不再重新存储该文件，而是只保留一个链接指向之前存储的文件。 Git 对待数据更像是一个 快照流。</p>
<p><img src="../../../../images/SRE/day53/30.jpg" alt="30"></p>
<p><strong>Git和SVN区别</strong></p>
<ul>
<li>git是分布式的,svn是集中式的</li>
<li>git是每个历史版本都存储完整的文件，便于恢复,svn是存储差异文件</li>
<li>git可离线完成大部分操作,svn则不能</li>
<li>git有着更优雅的分支和合并实现</li>
<li>git有着更强的撤销修改和修改历史版本的能力</li>
<li>git速度更快，效率更高</li>
</ul>
<h2 id="Git-相关概念和原理"><a href="#Git-相关概念和原理" class="headerlink" title="Git 相关概念和原理"></a>Git 相关概念和原理</h2><h3 id="Git-的区域"><a href="#Git-的区域" class="headerlink" title="Git 的区域"></a>Git 的区域</h3><p><img src="../../../../images/SRE/day53/31.jpg" alt="31"></p>
<ul>
<li><p>工作区 workspace：clone的代码或者开发编写代码文件所在的目录 ，通常是一个服务代码所在的目录名称 ，对应于&lt;项目目录&gt;</p>
<p>工作区中的文件的变更不受Git的跟踪和管理，无法实现版本回滚等功能 </p>
<p>需要将工作的的变更，通过 add 命令加入暂存区后，才可纳入Git 的版本管理控制的范畴</p>
</li>
<li><p>暂存区（索引区，缓存区）index ：用于存储在工作区中对代码进行修改后的文件所保存的地方，只有放入此区的文件才能被git进行管理，使用 git add添加，对应为&lt;项目目录&gt;/.git/index文件</p>
<p>暂存区主要用于临时保存文件少量变更，类似于邮件中的草稿箱</p>
<p>当变更累积到一定阶段，希望生成里程碑式的结果时，会使用commit，将暂存区的变更一次性的批量提交到本地仓库</p>
</li>
<li><p>本地仓库repo： 用于存储在工作区和暂存区中改过并提交的文件地方，使用 git commit 提交，对应于/&lt;项目目录&gt;/.git/</p>
<p>每一次commit 会生成一个唯一的ID，通常用于表示一个阶段性的新的版本</p>
<p>checkout命令执行了同commit命令相反的操作，它将版本中存储的commit所代表着的某个版本恢复至工作区中</p>
<p>checkout命令完成后，工作区中的文件内容与其检出的提交那一刻的状态相同</p>
<p>若工作区中存储此前未被提交的新文件，这些文件的未被提交的新的更改会被存储仓库的旧内容覆盖</p>
<p>当然，用户也可以暂存这些新文件，并将带有新文件的工作区提交到版本库中，这将是新的暂存和提交循环</p>
</li>
<li><p>远程仓库 ：多个开发人员共同协作提交代码的仓库，即 私有 gitlab 服务器或公有云github,gitee网站等</p>
<p>利用远程仓库，可以实现异地备份和远程协作</p>
</li>
</ul>
<p><img src="../../../../images/SRE/day53/32.jpg" alt="32"></p>
<h3 id="Git-文件的状态变化周期"><a href="#Git-文件的状态变化周期" class="headerlink" title="Git 文件的状态变化周期"></a>Git 文件的状态变化周期</h3><p>文件状态变化</p>
<p><img src="../../../../images/SRE/day53/33.jpg" alt="33"></p>
<ul>
<li>untracked: 在工作目录下创建的新文件，这个时候本地git仓库不知道，不能对其进行版本跟踪管理</li>
<li>unmodified: 添加到暂存区的文件未修改，并已经把文件从暂存区推动到了本地仓库</li>
<li>modified: 已经添加到暂存区的文件，在本地工作区的文件被修改了 ，需要重新添加至暂存区</li>
<li>staged: 文件添加到了暂存区</li>
<li>unstaged: 已被跟踪的工作区的文件发生更新，但还没有存入暂存区中</li>
</ul>
<h3 id="Git-提交历史和提交链"><a href="#Git-提交历史和提交链" class="headerlink" title="Git 提交历史和提交链"></a>Git 提交历史和提交链</h3><p><img src="../../../../images/SRE/day53/34.jpg" alt="34"></p>
<p>版本库上的commit历史组合起来会形成一个提交链</p>
<p>除了初始commit，每个commit都会都会有一个父commit，也可能会有多个父commit(比如：分支合并)</p>
<p>除了最新一次的commit，每个commit都会有一个子commit，也可能会有多个子commit(比如：创建新分支)</p>
<p>这个提交链上的commit还可以使用字符串进行引用</p>
<p>通常，Git会为默认创建的提交链上的最新一次提交创建一个基于字符串的引用master/main</p>
<p>而该提交链也称为版本库的一个分支（Branch），master/main 也是分支的名称标识</p>
<p>另外自动创建的还有一个HEAD引用，它代表提交链的“头”，表示当前工作区所关联到的提交链上的特定提交，通常是最新一次提交</p>
<p>基于HEAD指向的commit，还能够以相对方式引用历史中的提交，例如HEAD~表示前一个提交</p>
<p>git show HEAD命令可以查看HEAD当前所指向的commit的信息</p>
<h3 id="Git-分支和标签"><a href="#Git-分支和标签" class="headerlink" title="Git 分支和标签"></a>Git 分支和标签</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/book/zh/v2/Git-分支-分支简介</span><br></pre></td></tr></table></figure>

<p>分支： Git 的分支，其实本质上仅仅是指向提交对象的可变指针。</p>
<p>Git 的默认分支名字是 master/main 。 在多次提交操作之后，你其实已经有一个指向最后那个提交对象的 master/main 分支。 master 分支会在每次提交时自动向前移动。</p>
<p>Git的分支实现对文件的多个副本，可以实现多个不同用途的软件版本同时的演进，实现多个开发版本的隔离</p>
<p><img src="../../../../images/SRE/day53/35.jpg" alt="35"></p>
<p>假设准备开发一个新功能，但是需要两周才能完成，第一周写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能测试等工作。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。</p>
<p>现在有了分支，就不用担心了。你创建了一个独立的分支，对其他人是透明的，没有影响，他们还继续在原来的分支上正常工作，而你在自己的分支上工作，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样既安全，又不影响别人工作。</p>
<ul>
<li><p>tag: 给某个状态打个标签用于记录当前状态，相当于里程碑性的提交</p>
<p>tag是git版本库的一个标记，指向某个commit的指针。为某个commit添加一个标签，从而对其完成特殊标记，例如标记特定的版本信息</p>
<p>tag主要用于发布版本的管理，一个版本发布之后，可以为git打上 v1.0.1,v1.0.2 …这样的类似的标签。</p>
<p>通常，用户应该每天下班前提交代码并完成推送，以备份代码；只有待需要发一个版本时，才会基于tag对相应commit进行标记</p>
<p>tag跟branch有点相似，但是本质上和分工上是不同的：</p>
<p>tag 对应某次commit, 是一个点，是不可移动的。</p>
<p>branch 对应一系列commit，是很多提交点连成的一根线形成的，有一个HEAD 指针，是可以依靠HEAD 指针移动的。</p>
<p>所以，两者的区别决定了使用方式，改动代码用 branch ，不改动只查看用 tag。</p>
<p>tag 和 branch 的相互配合使用，有时候起到非常方便的效果</p>
<p>例如：已经发布了 v1.0 v2.0 v3.0 三个版本，这个时候，我突然想不改现有代码的前提下，在 v2.0 的基础上加个新功能，作为 v4.0 发布。就可以检出 v2.0 的代码作为一个 branch ，然后作为开发分支。</p>
<p>常用的版本标记格式</p>
<ul>
<li>version-number.release-no.modificaton-no (e.g.， v1.3.2) </li>
<li>version-number.release-no.upgrade-no_modificaton-no (e.g.， v1.9.3_6)</li>
</ul>
</li>
</ul>
<h3 id="Git-开发分支流程"><a href="#Git-开发分支流程" class="headerlink" title="Git 开发分支流程"></a>Git 开发分支流程</h3><p>分支管理是现代版本控制系统在记录版本和变更记录之外的另一个非常重要的功能</p>
<ul>
<li>团队于同一个项目上协作时，分支管理是不可或缺的重要功能，因为它隔离不同开发人员的改动，为每个人提供一个相对独立的空间隔离团队根据布节奏要实现的代码提交、审核、集成和测试等工作</li>
<li>“如果说多人软件协作项目中有一个灵魂的话，我认为，这个灵魂就是分支策略。可以说，分支策略就是软件协作模式和发布模式的风向标。选择一种符合 DevOps 开发模式的分支策略，对于 DevOps 的实践落地也会大有帮助。” —— 石雪峰</li>
</ul>
<p><img src="../../../../images/SRE/day53/36.jpg" alt="36"></p>
<p><img src="../../../../images/SRE/day53/37.jpg" alt="37"></p>
<p>几种常见的分支模型</p>
<ul>
<li><p>master：开发、测试和发布都在master分支上完成</p>
<p>简单，但开发、测试和发布彼此影响，仅适用于单feature且无构建过程的场景</p>
</li>
<li><p>master/develop： 在开发分支开发，完成后合并至master分支</p>
<p>短期分支，develop分支的开发不会影响到master分支的构建过程，但不利于同时开发多个 feature；适用于单feature，可从master执行构建的场景</p>
<p>master 长期分支，记录发布历史</p>
<p>develop 长期分支，记录变更历史</p>
</li>
<li><p>master/develop/feature</p>
<p>开发人员工作在各自的feature分支上，feature分支经过开发、模块测试后合并到develop分支develop分支代码经过系统测试，release之后合并到master分支，release是短期分支多个feature有利于更大规模的合作，但release独立分支中的bug修复变更与develop上的变更可能会导致冲突；因而，适用于多feature，develop在release过程中不会修改的场景feature短期分支，保存研发人员研发过程</p>
</li>
<li><p>master/develop/feature/release</p>
<p>在前一分支模型的基础上，使用单独的release分支进行构建和bug修复</p>
<p>避免了因发布操作而阻塞了develop分支上的变更，但release分支存在的时间越长，导致develop合并冲突的可能性越大；因此，适用于多feature开发，但develop功能不受release影响的场景</p>
<p>release：短期分支，承载发布过程</p>
</li>
<li><p>master/develop/feature/release/hotfix</p>
<p>从master单独拉一个短期的hotfix分支进行问题修复</p>
<p>解决了前一模型中hotfix和develop冲突的问题</p>
<p>适用于多feature开发的场景，release不受线上版本hotfix的影响</p>
<p>hotfix: 从master拉出来的分支，短期分支</p>
</li>
<li><p>git-flow</p>
<p>master 只能用来存储产品代码，不能直接工作在 master 分支上 ，而是在其他指定的、独立的特性分支中，避免直接提交改动到 master 分支上也是很多工作流程的一个共同准则</p>
<p>develop 是 进行任何新的开发的基础分支，develop是任何feature分支的父分支，用于汇集所有feature上的代码，并在必要时合并至master分支</p>
<p>develop分支上的代码来自于 feature、release 和 bugfix 分支</p>
<p>master分支上的代码来自于 release 和 bugfix 分支</p>
<p>master 和develop都是长期分支，它们会存活在项目的整个生命周期中，而各feature分支、release分支和bugfix分支均为临时分支，每次的使命完成后即被删除</p>
</li>
</ul>
<h3 id="Git-使用远程仓库"><a href="#Git-使用远程仓库" class="headerlink" title="Git 使用远程仓库"></a>Git 使用远程仓库</h3><p><img src="../../../../images/SRE/day53/38.jpg" alt="38"></p>
<p>通过远程仓库，基于HTTP、SSH 及 Git 多种传输协议可以实现异地备份和远程协作</p>
<p>推送代码至远程仓库的步骤</p>
<ul>
<li>在某个Git托管服务上注册一个账号，比如：GitHub，Gitee，GitLAB</li>
<li>在Git托管服务上创建一个仓库</li>
<li>在本地版本库上，使用git remote add 命令添加关联的远程库<ul>
<li>远程仓库，一般默认名称为origin</li>
<li>相关的url在远程库上可以直接获取到</li>
</ul>
</li>
<li>git push 推送本地仓库到远程仓库，git pull 可以拉取远程仓库代码到本地现在仓库中</li>
<li>没有本地仓库的其它主机通过git clone 可以将远程仓库克隆到本地</li>
</ul>
<p><strong>设定远程仓库</strong></p>
<ul>
<li>添加： git remote add</li>
<li>列出： git remote -v</li>
<li>删除： git remote rm</li>
<li>重命名： git remote rename</li>
</ul>
<p><strong>克隆远程仓库</strong></p>
<ul>
<li>克隆： git clone</li>
<li>克隆到指定工作目录： git clone</li>
</ul>
<p><strong>远程协作</strong></p>
<ul>
<li>抓取远程仓库所有分支上的变更： git fetch</li>
<li>抓取远程仓库指定分支上的变更： git fetch</li>
<li>列出所有远程分支：git branch -r 将远程分支合并至本地分支，通常应该将存在映射关系（通常为同一个分支名称）的分支进行合并<ul>
<li>git checkout</li>
<li>git merge origin/</li>
</ul>
</li>
</ul>
<p><strong>拉取远程仓库上的变更</strong></p>
<p>拉取并合并当前分支映射的远程分支上的变更至本地工作区：git pull </p>
<p>git pull 相当于如下两个命令生成的结果</p>
<ul>
<li>git fetch</li>
<li>git merge </li>
</ul>
<p><strong>推送本地变更到远程仓库</strong></p>
<ul>
<li>推送指定的分支：git push</li>
<li>推送本地仓库中的所有分支：git push –all</li>
<li>推送本地仓库中的所有标签：git push –tag</li>
</ul>
<h2 id="Git-安装"><a href="#Git-安装" class="headerlink" title="Git 安装"></a>Git 安装</h2><h3 id="Linux-安装-git"><a href="#Linux-安装-git" class="headerlink" title="Linux 安装 git"></a>Linux 安装 git</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/download/linux</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/39.jpg" alt="39"></p>
<h4 id="二进制包安装"><a href="#二进制包安装" class="headerlink" title="二进制包安装"></a>二进制包安装</h4><p>CentOS和Ubuntu 系统源都带有git版本，可以直接安装</p>
<p>范例： Ubuntu 安装 git</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2004 ~]<span class="comment"># apt update</span></span><br><span class="line">[root@ubuntu2004 ~]<span class="comment"># apt -y install git </span></span><br><span class="line">[root@ubuntu2004 ~]<span class="comment"># git version</span></span><br><span class="line">git version 2.25.1</span><br><span class="line"></span><br><span class="line">[root@ubuntu2204 ~]<span class="comment"># git version</span></span><br><span class="line">git version 2.34.1</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># apt update</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># apt -y install git </span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># git version</span></span><br><span class="line">git version 2.17.1</span><br></pre></td></tr></table></figure>

<p>范例： Rocky安装git </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># yum -y install git</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># git version</span></span><br><span class="line">git version 2.27.0</span><br></pre></td></tr></table></figure>

<h4 id="源码编译安装"><a href="#源码编译安装" class="headerlink" title="源码编译安装"></a>源码编译安装</h4><p>源码下载</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.kernel.org/pub/software/scm/git</span><br><span class="line">https://github.com/git/git/tags</span><br></pre></td></tr></table></figure>

<p>范例：Ubuntu 编译安装 git</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2204 ~]<span class="comment"># apt update;apt -y install gcc make dh-autoreconf libcurl4-gnutls-dev libexpat1-dev</span></span><br><span class="line">[root@ubuntu2204 ~]<span class="comment"># git clone https://gitee.com/lbtooth/git.git</span></span><br><span class="line">[root@ubuntu2204 ~]<span class="comment"># cd git</span></span><br><span class="line">[root@ubuntu2204 git]<span class="comment"># make -j `grep -c processor /proc/cpuinfo` prefix=/apps</span></span><br><span class="line">[root@ubuntu2204 git]<span class="comment"># make prefix=/apps/git install </span></span><br><span class="line">[root@ubuntu2204 git]<span class="comment"># echo &#x27;PATH=/apps/git/bin/:$PATH&#x27; &gt; /etc/profile.d/git.sh</span></span><br><span class="line">[root@ubuntu2204 git]<span class="comment"># . /etc/profile.d/git.sh</span></span><br><span class="line">[root@ubuntu2204 ~]<span class="comment"># git version</span></span><br><span class="line">git version 2.39.1.388.g2fc9e9ca3c</span><br></pre></td></tr></table></figure>

<p>范例： Rocky 8 编译安装git </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># yum -y install gcc make openssl-devel curl-devel expat-devel</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># wget -P /usr/local/src https://github.com/git/git/archive/refs/tags/v2.33.0.tar.gz</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># wget -P /usr/local/src https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.33.0.tar.gz</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cd /usr/local/src</span></span><br><span class="line">[root@rocky8 src]<span class="comment"># tar xf v2.33.0.tar.gz</span></span><br><span class="line">[root@rocky8 git-2.33.0]<span class="comment"># cd git-2.33.0/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果有旧版git,可以执行下面操作</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># git clone https://gitee.com/lbtooth/git.git</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cd git/</span></span><br><span class="line">[root@rocky8 git-2.33.0]<span class="comment"># cat INSTALL</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 git-2.33.0]<span class="comment"># make -j `grep -c processor /proc/cpuinfo` prefix=/apps/git all</span></span><br><span class="line">[root@rocky8 git-2.33.0]<span class="comment"># make prefix=/apps/git install </span></span><br><span class="line">[root@rocky8 git-2.33.0]<span class="comment"># echo &#x27;PATH=/apps/git/bin/:$PATH&#x27; &gt; /etc/profile.d/git.sh</span></span><br><span class="line">[root@rocky8 git-2.33.0]<span class="comment"># . /etc/profile.d/git.sh</span></span><br><span class="line">[root@rocky8 git-2.33.0]<span class="comment"># git version</span></span><br><span class="line">git version 2.33.0</span><br></pre></td></tr></table></figure>

<h3 id="Windows-安装-git"><a href="#Windows-安装-git" class="headerlink" title="Windows 安装 git"></a>Windows 安装 git</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/downloads</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/40.jpg" alt="40"><br><img src="../../../../images/SRE/day53/41.jpg" alt="41"><br><img src="../../../../images/SRE/day53/42.jpg" alt="42"><br><img src="../../../../images/SRE/day53/43.jpg" alt="43"><br><img src="../../../../images/SRE/day53/44.jpg" alt="44"><br><img src="../../../../images/SRE/day53/45.jpg" alt="45"><br><img src="../../../../images/SRE/day53/46.jpg" alt="46"><br><img src="../../../../images/SRE/day53/47.jpg" alt="47"><br><img src="../../../../images/SRE/day53/48.jpg" alt="48"><br><img src="../../../../images/SRE/day53/49.jpg" alt="49"><br><img src="../../../../images/SRE/day53/50.jpg" alt="50"><br><img src="../../../../images/SRE/day53/51.jpg" alt="51"><br><img src="../../../../images/SRE/day53/52.jpg" alt="52"><br><img src="../../../../images/SRE/day53/53.jpg" alt="53"><br><img src="../../../../images/SRE/day53/54.jpg" alt="54"><br><img src="../../../../images/SRE/day53/55.jpg" alt="55"><br><img src="../../../../images/SRE/day53/56.jpg" alt="56"><br><img src="../../../../images/SRE/day53/57.jpg" alt="57"></p>
<p>**注意：  **</p>
<p><strong>Windows 版本的 git 在提交前，必须配置邮箱和用户名</strong></p>
<p><strong>git clone 时提交的用户密码信息会记录在凭据管理器中Windows凭据的普通凭据中，即修改密码后，需要删除凭据中密码</strong></p>
<h3 id="Mac-安装-git"><a href="#Mac-安装-git" class="headerlink" title="Mac 安装 git"></a>Mac 安装 git</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/download/mac</span><br></pre></td></tr></table></figure>

<h2 id="Git-常用语法"><a href="#Git-常用语法" class="headerlink" title="Git 常用语法"></a>Git 常用语法</h2><p>使用 git 命令添加代码，提交等管理代码操作</p>
<h3 id="Git-用法说明"><a href="#Git-用法说明" class="headerlink" title="Git 用法说明"></a>Git 用法说明</h3><p>官方文档：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/docs</span><br><span class="line">https://git-scm.com/book/zh/v2</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/58.jpg" alt="58"></p>
<p><strong>区域间文件操作</strong></p>
<p><img src="../../../../images/SRE/day53/59.jpg" alt="59"></p>
<p><strong>git 命令常见用法</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看git及子命令的帮助</span></span><br><span class="line">git <span class="built_in">help</span> &lt;子命令&gt;   <span class="comment">#不加&lt;子命令&gt;是查看git命令的帮助</span></span><br><span class="line">git &lt;子命令&gt; --<span class="built_in">help</span> <span class="comment">#不加&lt;子命令&gt;是查看git命令的帮助</span></span><br><span class="line">man git-&lt;子命令&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git version     <span class="comment">#查看版本</span></span><br><span class="line">git init        <span class="comment">#本地仓库初始化</span></span><br><span class="line">git init --bare <span class="comment">#创建无工作区的祼仓库，适用于充当远程仓库，一般对应的目录以.git为后缀</span></span><br><span class="line">git <span class="built_in">clone</span> http://url             <span class="comment">#克隆url指定的项目的所有文件，并在本地创建此项目的git仓库</span></span><br><span class="line">git <span class="built_in">clone</span> -b develop http://url  <span class="comment">#克隆url指定的项目中develop分支</span></span><br><span class="line">git <span class="built_in">clone</span> -b tag http://url      <span class="comment">#克隆url指定的项目中tag</span></span><br><span class="line"></span><br><span class="line">git config --global user.name <span class="string">&quot;wangxiaochun&quot;</span>     <span class="comment">#设置当前用户的git全局用户名，和下面两项都存放在~/.gitconfig文件中</span></span><br><span class="line">git config --global user.email <span class="string">&quot;29308620@qq.com&quot;</span> <span class="comment">#设置全局邮箱</span></span><br><span class="line">git config --global color.ui <span class="literal">true</span>    <span class="comment">#让Git显示颜色，会让命令输出看起来更醒目</span></span><br><span class="line">git config --global core.editor vim  <span class="comment">#git默认的编辑器为nano，不常用，需要修改为vim</span></span><br><span class="line">git config --global --list|-l        <span class="comment">#列出用户全局设置，默认保存在~/.gitconfig文件中</span></span><br><span class="line">git config --global -e               <span class="comment">#交互编辑配置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#文件操作</span></span><br><span class="line">git add index.html / . <span class="comment">#添加指定文件、目录或当前目录下所有数据到暂存区</span></span><br><span class="line">git <span class="built_in">mv</span> file_oldname file_newname    <span class="comment">#将已经进入版本仓库的文件改名，注意：不支持在工作区没有存入暂存区的新创建的文件</span></span><br><span class="line">git <span class="built_in">rm</span> --cached file   <span class="comment">#只删除暂存区的文件，不删除工作区文件，相当于git add 反操作，和git restore --staged 功能相同</span></span><br><span class="line">git <span class="built_in">rm</span> file            <span class="comment">#从工作目录和暂存区删除文件</span></span><br><span class="line">git checkout file      <span class="comment">#从暂存区复制文件到工作目录</span></span><br><span class="line">git restore --staged &lt;file&gt;       <span class="comment">#新版EXPERIMENTAL命令，撤销add到暂存区的文件回到工作区，重新成为untracked状态</span></span><br><span class="line">git restore &lt;file&gt;     <span class="comment">#撤消已跟踪但尚未加入暂存区中的文件变更，撤消了工作区中文件的所有新的更改</span></span><br><span class="line">git restore -s &lt;<span class="built_in">source</span>&gt; &lt;pathspec&gt;  <span class="comment">#从某个提交中恢复文件</span></span><br><span class="line">                                    <span class="comment">#示例：从前一次提交中恢复README.md文件：git restore -s HEAD~ READEME.md</span></span><br><span class="line">                                    </span><br><span class="line">                                    </span><br><span class="line"><span class="comment">#查看文件列表和内容</span></span><br><span class="line">git ls-files              <span class="comment">#查看暂存区文件，选项-s显示mode bits, object name and stage number,-o显示untracked文件</span></span><br><span class="line">git cat-file -p &lt;blogid&gt;  <span class="comment">#查看仓库对象的内容，仓库对象存放在.git/objects目录下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件变化</span></span><br><span class="line">git diff [&lt;path&gt;...]                            <span class="comment">#对比工作区和暂存区的区别</span></span><br><span class="line">git diff --staged|cached [&lt;path&gt;...]            <span class="comment">#对比暂存区和本地仓库的前一次提交的区别</span></span><br><span class="line">git diff [&lt;commit&gt;] [--] [&lt;path&gt;...]            <span class="comment">#对比工作区和指定提交的文件的区别</span></span><br><span class="line">git diff &lt;commit&gt;...&lt;commit&gt; [--] [&lt;path&gt;...]   <span class="comment">#提交和提交之间的文件的区别</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提交</span></span><br><span class="line">git commit -m “comment“   <span class="comment">#提交文件到工作区</span></span><br><span class="line">git commit -am <span class="string">&quot;comment&quot;</span>  <span class="comment">#添加所有修改(不包括新文件)到暂存区并提交，相当于git add + git commit</span></span><br><span class="line">git commit --amend --no-edit    <span class="comment">#重新覆盖上次的提交</span></span><br><span class="line">git commit --amend -m <span class="string">&quot;comment&quot;</span> <span class="comment">#重新提交，覆盖上次的提交</span></span><br><span class="line">git show HEAD                   <span class="comment">#查看最近一次提交的详细信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志</span></span><br><span class="line">git status  <span class="comment">#查看工作区的状态</span></span><br><span class="line">git <span class="built_in">log</span>     <span class="comment">#查看提交日志</span></span><br><span class="line">git <span class="built_in">log</span> --oneline     <span class="comment">#查看提交日志的简要信息，一个提交一行，只显示commit id的前七位</span></span><br><span class="line">git <span class="built_in">log</span> --oneline -N  <span class="comment">#查看最近N条commit日志</span></span><br><span class="line">git <span class="built_in">log</span>  --pretty=oneline <span class="comment">#查看提交日志的简要信息，一个提交一行，显示commit id 全部位</span></span><br><span class="line">git <span class="built_in">log</span> --stats       <span class="comment">#查看提交的文件的统计信息</span></span><br><span class="line">git <span class="built_in">log</span> -p [commit_id] <span class="comment">#查看指定提交和之前提交的变化详细信息</span></span><br><span class="line">git <span class="built_in">log</span> --author=<span class="string">&quot;&lt;author-name-pattern&gt;&quot;</span> <span class="comment">#查看指定作者的提交</span></span><br><span class="line">git <span class="built_in">log</span> &lt;file-pattern&gt; <span class="comment">#查看指定文件的提交</span></span><br><span class="line">git <span class="built_in">log</span> origin/main  <span class="comment">#查看远程仓库的日志</span></span><br><span class="line">git reflog  <span class="comment">#查看分支或其它引用在本地仓库的完整历史记录</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#回滚提交，本质上是将HEAD和master引用移到指定的commit上，是否基于指定的commit连同重置暂存区和工作区则取决于使用的选项</span></span><br><span class="line">git reset --hard|soft|minxed HEAD^^ <span class="comment">#git版本回滚， HEAD为当前版本，加一个^为上一个，^^为上上一个版本</span></span><br><span class="line">git reset --hard|soft|minxed HEAD~n <span class="comment">#回滚前n个版本，0表示当前commit，1表示前一个commit,即相当于HEAD^</span></span><br><span class="line">git reset --hard|soft|minxed 5ae4b06 <span class="comment">#回退到指定id的版本，使用 git reflog 获取每次提交的ID</span></span><br><span class="line">git reset --hard|soft|minxed v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#分支管理</span></span><br><span class="line">git branch     <span class="comment">#查看分支及当前所处的分支</span></span><br><span class="line">git branch -av <span class="comment">#查看所有本地和远程分支</span></span><br><span class="line">git branch &lt;分支名&gt; <span class="comment">#创建分支&lt;分支名&gt;</span></span><br><span class="line">git branch &lt;分支名&gt; &lt;commit_id&gt; <span class="comment">#基于指定提交创建新分支</span></span><br><span class="line">git branch -d &lt;分支名&gt;     <span class="comment">#删除分支</span></span><br><span class="line">git branch -m dev develop <span class="comment">#修改分支名dev为develop</span></span><br><span class="line">git branch -M main <span class="comment">#修改当前分支名称为main</span></span><br><span class="line">git branch -r      <span class="comment">#列出所有远程分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#切换分支</span></span><br><span class="line">git checkout &lt;分支名&gt;  <span class="comment">#切换到已有的分支，HEAD也会自动指向目标分支上的最新提交</span></span><br><span class="line">git checkout v1.0     <span class="comment">#切换至指定标签v1.0，检出到标签，会导致分离头指针，且新创建的提交也将处于分离的状态</span></span><br><span class="line">git checkout -b &lt;分支名&gt; <span class="comment">#创建并切换到一个新分支</span></span><br><span class="line">git checkout -b &lt;分支名&gt; origin/&lt;分支名&gt; <span class="comment">#利用服务器远程仓库的分支，同步在本地创建分支</span></span><br><span class="line">git checkout [&lt;commit&gt;]-- &lt;file&gt; ...  <span class="comment">#找回在工作区删除的已存入暂存区或提交的文件</span></span><br><span class="line">git merge master -m &lt;message&gt;  <span class="comment">#将master分支合并至当前分支，无选项-m, 则为交互式</span></span><br><span class="line">git merge orgin/&lt;branch_name&gt;   <span class="comment">#将远程分支合并到本地当前分支，通常应该将存在映射关系（通常为同一个分支名称）的分支进行合并</span></span><br><span class="line">git merge --abort     <span class="comment">#取消合并</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#标签</span></span><br><span class="line">git tag &lt;tagname&gt;                          <span class="comment">#当前commit创建轻量标签</span></span><br><span class="line">git tag -a &lt;tagname&gt;  -m &lt;message&gt;         <span class="comment">#将当前commit创建附注标签</span></span><br><span class="line">git tag -a &lt;tagname&gt;  -m &lt;message&gt; &lt;commit_id&gt;  <span class="comment">#将指定commit创建附注标签</span></span><br><span class="line">git tag -d &lt;tagname&gt;                    <span class="comment">#删除标签</span></span><br><span class="line">git reset --hard &lt;tagname&gt;              <span class="comment">#回滚到指定标签</span></span><br><span class="line">git tag                                 <span class="comment">#查看标签</span></span><br><span class="line">git tag -l [&lt;pattern&gt;]                  <span class="comment">#查看指定模式的标签</span></span><br><span class="line">git show &lt;tagname&gt;                      <span class="comment">#查看指定标签详细信息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程仓库</span></span><br><span class="line">git remote -v          <span class="comment">#查看远程仓库</span></span><br><span class="line">git remote show origin <span class="comment">#查看远程仓库详细信息</span></span><br><span class="line">git remote add origin git@gitlab.example.com:testgroup/testproject.git <span class="comment">#建立远程仓库和本地origin关联</span></span><br><span class="line">git remote rename origin new-origin  <span class="comment">#修改默认远程仓库名称origin为新的名称new-origin</span></span><br><span class="line">git remote remove origin <span class="comment">#删除关联</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#和远程仓库推和拉</span></span><br><span class="line">git push <span class="comment">#将本地仓库提交代码到远程服务器</span></span><br><span class="line">git push origin master <span class="comment">#将当前分支推送到远程的 master 分支</span></span><br><span class="line">git push origin dev    <span class="comment">#将当前分支推送到远程的dev分支，如果远程没有dev会自动创建</span></span><br><span class="line">git push -u|--set-upstream origin master <span class="comment">#将本地 master 分支推送到远程仓库 master,并且参数-u表示以后即可直接用git push 代替此命令</span></span><br><span class="line">git push origin main:dev <span class="comment">#将本地main分支推送至远程dev分支</span></span><br><span class="line">git push origin :dev <span class="comment">#将空分支推送到远程dev,即删除远程dev分支</span></span><br><span class="line">git push -u origin --all <span class="comment">#推送所有分支</span></span><br><span class="line">git push origin &lt;tagname&gt;       <span class="comment">#推送本地仓库指定的tag到远程</span></span><br><span class="line">git push origin --tag &lt;tagname&gt; <span class="comment">#推送本地仓库指定的tag到远程</span></span><br><span class="line">git push origin --tags          <span class="comment">#将本地仓库所有的tag都推送到远程，默认不会推送标签</span></span><br><span class="line">git push --delete origin &lt;tagname&gt; <span class="comment">#删除远程仓库的标签</span></span><br><span class="line">git pull               <span class="comment">#从远程服务器获取所有分支的代码到本地仓库，并自动合并到本地仓库和工作区</span></span><br><span class="line">git pull origin dev    <span class="comment">#从远程服务器指定的分支dev拉取代码到本地仓库，并自动合并到本地仓库和工作区</span></span><br><span class="line">git fetch &lt;remote_name&gt; <span class="comment">#获取远程仓库所有分支上的变更</span></span><br><span class="line">git fetch origin master <span class="comment">#从远程仓库origin的master分支获取最新版本到本地仓库，但不合并至工作区，需要手动完成合并</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#忽略文件，实现不跟踪指定文件</span></span><br><span class="line">vim .gitignore <span class="comment">#定义忽略文件，即不放在仓库的文件</span></span><br></pre></td></tr></table></figure>

<p>git log 显示日志格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --graph --pretty=format:<span class="string">&#x27;参数&#x27;</span> </span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>%H</code></td>
<td align="left">提交的完整哈希值</td>
</tr>
<tr>
<td align="left"><code>%h</code></td>
<td align="left">提交的简写哈希值</td>
</tr>
<tr>
<td align="left"><code>%T</code></td>
<td align="left">树的完整哈希值</td>
</tr>
<tr>
<td align="left"><code>%t</code></td>
<td align="left">树的简写哈希值</td>
</tr>
<tr>
<td align="left"><code>%P</code></td>
<td align="left">父提交的完整哈希值</td>
</tr>
<tr>
<td align="left"><code>%p</code></td>
<td align="left">父提交的简写哈希值</td>
</tr>
<tr>
<td align="left"><code>%an</code></td>
<td align="left">作者名字</td>
</tr>
<tr>
<td align="left"><code>%ae</code></td>
<td align="left">作者的电子邮件地址</td>
</tr>
<tr>
<td align="left"><code>%ad</code></td>
<td align="left">作者修订日期（可以用 –date=选项 来定制格式）</td>
</tr>
<tr>
<td align="left"><code>%ar</code></td>
<td align="left">作者修订日期，按多久以前的方式显示</td>
</tr>
<tr>
<td align="left"><code>%cn</code></td>
<td align="left">提交者的名字</td>
</tr>
<tr>
<td align="left"><code>%ce</code></td>
<td align="left">提交者的电子邮件地址</td>
</tr>
<tr>
<td align="left"><code>%cd</code></td>
<td align="left">提交日期</td>
</tr>
<tr>
<td align="left"><code>%cr</code></td>
<td align="left">提交日期（距今多长时间）</td>
</tr>
<tr>
<td align="left"><code>%s</code></td>
<td align="left">提交说明</td>
</tr>
</tbody></table>
<h3 id="Git-案例"><a href="#Git-案例" class="headerlink" title="Git 案例"></a>Git 案例</h3><h4 id="创建项目并初始化配置"><a href="#创建项目并初始化配置" class="headerlink" title="创建项目并初始化配置"></a>创建项目并初始化配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># mkdir /data/testproject/</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># cd /data/testproject/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git init</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># ls -a</span></span><br><span class="line">. ..   .git</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># tree .git</span></span><br><span class="line">.git</span><br><span class="line">├── branches      <span class="comment">#分支</span></span><br><span class="line">├── config        <span class="comment">#git config命令设置的配置信息</span></span><br><span class="line">├── description   <span class="comment">#被git web(Github的原型)用来显示对仓库的描述</span></span><br><span class="line">├── HEAD          <span class="comment">#当前分支的标识符号，一般指向refs/heads目录下的分支文件</span></span><br><span class="line">├── hooks         <span class="comment">#触发器规则的文件，俗称&quot;钩子文件&quot;</span></span><br><span class="line">│   ├── applypatch-msg.sample</span><br><span class="line">│   ├── commit-msg.sample</span><br><span class="line">│   ├── fsmonitor-watchman.sample</span><br><span class="line">├── info             <span class="comment">#一些特殊文件设置目录，比如忽略文件设置，.gitignore是互补的</span></span><br><span class="line">│   └── exclude </span><br><span class="line">├── objects          <span class="comment">#存放git对象，git 核心的文件目录  </span></span><br><span class="line">│   ├── info </span><br><span class="line">│   └── pack</span><br><span class="line">└── refs             <span class="comment">#各个提交对象的标识(SHA-1)文件</span></span><br><span class="line">   ├── heads         <span class="comment">#分支相关信息的目录</span></span><br><span class="line">   └── tags          <span class="comment">#标签相关信息的目录</span></span><br><span class="line">   </span><br><span class="line">9 directories, 17 files</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置git，提交commit之前需要先配置git的基本信息</span></span><br><span class="line"><span class="comment">#选项--system 表示针对所有用户的配置，保存在/etc/gitconfig文件中</span></span><br><span class="line"><span class="comment">#选项--global 表示当前用户环境，保存在~/.gitconfig文件中，推荐使用</span></span><br><span class="line"><span class="comment">#选项--local 表示只针对当前目录(项目)的配置，保存在当前目录的.git/config文件中，此为默认值，可省略</span></span><br><span class="line"><span class="comment">#优先级:local &gt; global &gt; system</span></span><br><span class="line"><span class="comment">#配置文件使用ini格式，存在一至多个[section]，各配置参数可以section为前缀引用</span></span><br><span class="line"><span class="comment">#列出已有配置：git config -l | --list</span></span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config --global user.name wangxiaochun</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config --global user.email root@wangxiaochun.com</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config --global color.ui true</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config --global core.editor vim</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config --system user.name wang</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看system,global和local的配置</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config -l</span></span><br><span class="line">user.name=wangxiaochun <span class="comment">#用户名，另外还可以使用author.name标记作者，以及使用committer.name标记提交者</span></span><br><span class="line">user.email=root@wangxiaochun.com <span class="comment">#用户的邮箱，还可以使用author.email标记作者邮箱和使用committer.email标记提交者邮箱</span></span><br><span class="line">core.editor=vim <span class="comment">#配置git默认使用的文本编辑器，也可由环境变量GIT_EDITOR指定，且此变量的优先级</span></span><br><span class="line">更高</span><br><span class="line">core.ui=<span class="literal">true</span>    <span class="comment">#为color.diff和color.grep设定默认值,true或auto表示启用语法着色功能,false或never表示关闭语法着色功能</span></span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># cat .gitconfig</span></span><br><span class="line">[user]</span><br><span class="line"> name = wangxiaochun</span><br><span class="line"> email = 29308620@qq.com</span><br><span class="line"> </span><br><span class="line"><span class="comment">#只查看global配置</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config -l --global</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#交互编辑配置</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config --global -e</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除配置</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># git config --unset --system user.name</span></span><br></pre></td></tr></table></figure>

<h4 id="添加暂存区并提交数据"><a href="#添加暂存区并提交数据" class="headerlink" title="添加暂存区并提交数据"></a>添加暂存区并提交数据</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># touch a.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add a.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -m &#x27;add a.txt&#x27;</span></span><br></pre></td></tr></table></figure>

<p>注意： </p>
<ul>
<li>如果工作区和暂存区数据不一致，会显示红色的提示</li>
</ul>
<p><img src="../../../../images/SRE/day53/60.jpg" alt="60"></p>
<ul>
<li>如果暂存区和本地仓库数据不一致，会显示绿色的提示</li>
</ul>
<p><img src="../../../../images/SRE/day53/61.jpg" alt="61"></p>
<h4 id="设置忽略文件"><a href="#设置忽略文件" class="headerlink" title="设置忽略文件"></a>设置忽略文件</h4><p>配置.gitignore文件让 Git 不再管理当前目录下的某些文件。</p>
<p>生产中有如下几类文件可能需要忽略</p>
<ul>
<li>程序运行时产生的临时文件</li>
<li>程序连接数据库这一类的配置文件</li>
<li>程序本地开发使用的图片文件</li>
<li>其它不想被共享的文件</li>
</ul>
<p>范例： 忽略指定文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># cat .gitignore </span></span><br><span class="line">/bin</span><br><span class="line">/target</span><br><span class="line">.classpath</span><br><span class="line">.project</span><br><span class="line">.settings</span><br><span class="line">*.h</span><br><span class="line">!test.h</span><br><span class="line">*.py[c|x]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Java class files</span></span><br><span class="line">*.class</span><br><span class="line"><span class="comment"># vim swap file</span></span><br><span class="line">*.swp</span><br><span class="line"><span class="comment"># Executable files</span></span><br><span class="line">*.exe</span><br><span class="line"><span class="comment"># Object and archive files</span></span><br><span class="line"><span class="comment"># Can use regular expression, e.g., [oa] matches either o or a *.[oa]</span></span><br><span class="line"><span class="comment"># temp sub-directory (ended with a directory separator) </span></span><br><span class="line">temp/</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：无须提交此文件.gitignore 就可以立即生效忽略，但为了保存此文件，还是最终需要提交此文件到本地仓库中</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -m &#x27;设置忽略&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="将文件加入暂存区再取消添加"><a href="#将文件加入暂存区再取消添加" class="headerlink" title="将文件加入暂存区再取消添加"></a>将文件加入暂存区再取消添加</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># touch f1.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git status</span></span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">	f1.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">&quot;git add&quot;</span> to track)</span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add f1.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看暂存区文件</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git ls-files</span></span><br><span class="line">f1.txt</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment">#git status</span></span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage)</span><br><span class="line">	new file:   f1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#从暂存区删除</span></span><br><span class="line"><span class="comment">#方法1</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git rm --cached f1.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方法2</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git restore --staged f1.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#确认是否从暂存区删除</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git status</span></span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">	f1.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">&quot;git add&quot;</span> to track)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git ls-files</span></span><br></pre></td></tr></table></figure>

<h4 id="查看暂存区的文件内容"><a href="#查看暂存区的文件内容" class="headerlink" title="查看暂存区的文件内容"></a>查看暂存区的文件内容</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 testproject]<span class="comment"># echo test.txt &gt; test.txt</span></span><br><span class="line">[root@rocky8 testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@rocky8 testproject]<span class="comment"># git ls-files -s</span></span><br><span class="line">100644 4871fd52755be519c29ae719f385bd5f2863627c 0 test.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 testproject]<span class="comment"># file .git/objects/48/71fd52755be519c29ae719f385bd5f2863627c</span></span><br><span class="line">.git/objects/48/71fd52755be519c29ae719f385bd5f2863627c: VAX COFF executable -version 20741</span><br><span class="line"></span><br><span class="line">[root@rocky8 testproject]<span class="comment"># git cat-file -t </span></span><br><span class="line">4871fd52755be519c29ae719f385bd5f2863627 </span><br><span class="line">blob</span><br><span class="line"></span><br><span class="line">[root@rocky8 testproject]<span class="comment"># git cat-file -p </span></span><br><span class="line">4871fd52755be519c29ae719f385bd5f2863627c</span><br><span class="line">test.txt</span><br></pre></td></tr></table></figure>

<h4 id="利用暂存区恢复误删除的工作区文件"><a href="#利用暂存区恢复误删除的工作区文件" class="headerlink" title="利用暂存区恢复误删除的工作区文件"></a>利用暂存区恢复误删除的工作区文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># touch test.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git ls-files</span></span><br><span class="line">README.md</span><br><span class="line">b.txt</span><br><span class="line">test.txt</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># rm -f test.txt </span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># ls </span></span><br><span class="line">README.md</span><br><span class="line"></span><br><span class="line"><span class="comment">#从暂存区复制文件到工作目录</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git checkout test.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># ls</span></span><br><span class="line">README.md test.txt</span><br></pre></td></tr></table></figure>

<h4 id="同时删除工作区和暂存区"><a href="#同时删除工作区和暂存区" class="headerlink" title="同时删除工作区和暂存区"></a>同时删除工作区和暂存区</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># touch f2.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git ls-files</span></span><br><span class="line">f1.txt</span><br><span class="line">f2.txt</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># ls</span></span><br><span class="line">f1.txt f2.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#同时删除工作区和暂存区文件</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git rm -f f2.txt</span></span><br><span class="line"><span class="built_in">rm</span> <span class="string">&#x27;f2.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># ls</span></span><br><span class="line">f1.txt </span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git ls-files</span></span><br><span class="line">f1.txt</span><br></pre></td></tr></table></figure>

<h4 id="回滚工作区的文件为暂存区中版本"><a href="#回滚工作区的文件为暂存区中版本" class="headerlink" title="回滚工作区的文件为暂存区中版本"></a>回滚工作区的文件为暂存区中版本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># echo v1 &gt; f1.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git status</span></span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">	f1.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">&quot;git add&quot;</span> to track)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo v2 &gt; f1.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git status</span></span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">&quot;git restore --staged &lt;file&gt;...&quot;</span> to unstage)</span><br><span class="line">	new file:   f1.txt</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">	modified:   f1.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#回滚工作区的文件为暂存区中版本</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git checkout -- f1.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt</span></span><br><span class="line">v1</span><br></pre></td></tr></table></figure>

<h4 id="多次提交后回滚至指定提交的版本"><a href="#多次提交后回滚至指定提交的版本" class="headerlink" title="多次提交后回滚至指定提交的版本"></a>多次提交后回滚至指定提交的版本</h4><h5 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h5><p>git reset 官方说明</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/book/zh/v2/Git-工具-重置揭密</span><br><span class="line">https://git-scm.com/book/en/v2/Git-Tools-Reset-Demystified</span><br></pre></td></tr></table></figure>

<p>git reset 是对本地仓库的项目进行回滚操作的命令，它主要有如下三个参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--soft  <span class="comment">#工作目录和暂存区都不会被改变，只是本地仓库中的文件回滚到指定的版本，仅移动HEAD和master指针的指向，不会重置暂存区或工作区</span></span><br><span class="line">--mixed <span class="comment">#默认选项。回滚暂存区和本地仓库，但工作目录不受影响</span></span><br><span class="line">--hard  <span class="comment">#本地仓库，暂存区和工作目录都回滚到指定的提交，该选项非常危险</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/62.jpg" alt="62"></p>
<p><strong>回滚前的状态</strong></p>
<p><img src="../../../../images/SRE/day53/63.jpg" alt="63"></p>
<p><strong>git reset –soft HEAD~ 执行的效果</strong></p>
<p><img src="../../../../images/SRE/day53/64.jpg" alt="64"></p>
<p><strong>git reset –mixed HEAD~ 执行的效果</strong></p>
<p><img src="../../../../images/SRE/day53/65.jpg" alt="65"></p>
<p><strong>git reset –hard HEAD~ 执行的效果</strong></p>
<p><img src="../../../../images/SRE/day53/66.jpg" alt="66"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt </span></span><br><span class="line">v1</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -m v1</span></span><br><span class="line">[master d25308d] v1</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 f1.txt</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git status</span></span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo v2 &gt; f1.txt </span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git status</span></span><br><span class="line">On branch master</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">	modified:   f1.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -m v2</span></span><br><span class="line">[master c301f0c] v2</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt </span></span><br><span class="line">v2</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git log</span></span><br><span class="line">commit c301f0c9b76e7f6655d10636045fd4f693069c98 (HEAD -&gt; master)</span><br><span class="line">Author: wsq &lt;wsq@qq.com&gt;</span><br><span class="line">Date:   Wed Apr 23 17:07:14 2025 +0800</span><br><span class="line"></span><br><span class="line">    v2</span><br><span class="line"></span><br><span class="line">commit d25308d9ede2ef39b5ab96514c29617bd799f9b8</span><br><span class="line">Author: wsq &lt;wsq@qq.com&gt;</span><br><span class="line">Date:   Wed Apr 23 17:02:13 2025 +0800</span><br><span class="line"></span><br><span class="line">    v1</span><br><span class="line">    </span><br><span class="line">[root@gitlab testproject]<span class="comment"># git reset --hard HEAD^</span></span><br><span class="line">HEAD is now at d25308d v1</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt </span></span><br><span class="line">v1</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git log</span></span><br><span class="line">commit d25308d9ede2ef39b5ab96514c29617bd799f9b8 (HEAD -&gt; master)</span><br><span class="line">Author: wsq &lt;wsq@qq.com&gt;</span><br><span class="line">Date:   Wed Apr 23 17:02:13 2025 +0800</span><br><span class="line"></span><br><span class="line">    v1</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo v2 &gt; f1.txt </span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -m v2</span></span><br><span class="line">[master 4a07d95] v2</span><br><span class="line">1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo v3 &gt; f1.txt </span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -m v3</span></span><br><span class="line">[master 5dd2fdf] v3</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git log</span></span><br><span class="line">commit 5dd2fdf09b1a84a67b82fc0e65039dccfe9fe49e (HEAD -&gt; master)</span><br><span class="line">Author: wsq &lt;wsq@qq.com&gt;</span><br><span class="line">Date:   Wed Apr 23 17:09:40 2025 +0800</span><br><span class="line"></span><br><span class="line">    v3</span><br><span class="line"></span><br><span class="line">commit c301f0c9b76e7f6655d10636045fd4f693069c98</span><br><span class="line">Author: wsq &lt;wsq@qq.com&gt;</span><br><span class="line">Date:   Wed Apr 23 17:07:14 2025 +0800</span><br><span class="line"></span><br><span class="line">    v2</span><br><span class="line"></span><br><span class="line">commit d25308d9ede2ef39b5ab96514c29617bd799f9b8</span><br><span class="line">Author: wsq &lt;wsq@qq.com&gt;</span><br><span class="line">Date:   Wed Apr 23 17:02:13 2025 +0800</span><br><span class="line"></span><br><span class="line">    v1</span><br><span class="line">   </span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt </span></span><br><span class="line">v3</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定回滚至指定版本</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git reset --hard 0cc266</span></span><br><span class="line">HEAD is now at d25308d v1</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt </span></span><br><span class="line">v1</span><br></pre></td></tr></table></figure>

<h5 id="git-revert"><a href="#git-revert" class="headerlink" title="git revert"></a>git revert</h5><p>如果我们修改了某些内容，已经commit到本地仓库，并且push到远程仓库了，这种情况下想把本地和远程仓库都回退到某个版本，该怎么做呢？</p>
<p>前面用git reset只是在本地仓库中回退版本，而远程仓库的版本不会变化，这样，即使本地reset了，但如果再次git pull，那么，远程仓库的内容又会和本地之前版本的内容进行merge，造成回退失败。</p>
<p>对于已经把代码push到远程仓库，你退回本地代码其实也想同时退回线上代码，回滚到某个指定的版本，线上线下代码保持一致。git revert用于撤销某次操作，此次操作之前和之后的commit和history都会保留，即用一个新提交来消除一个历史提交所做的任何修改。</p>
<p>revert之后你的本地代码会回滚到指定的历史版本，然后再git push。</p>
<p><img src="../../../../images/SRE/day53/67.jpg" alt="67"></p>
<p>git revert 用法</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git revert HEAD   #撤销前一次commit,会交互式打开文本编辑器提示输入提交信息</span><br><span class="line">git revert HEAD --no-edit #非交互式撤销前一次提交</span><br><span class="line">git revert HEAD^ #撤销前前一次commit</span><br><span class="line">git revert commit &lt;commit&gt; #撤销指定的版本，撤销也会作为一次提交进行保存。</span><br></pre></td></tr></table></figure>

<p>reset和revert区别</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git revert是用一次新的commit来回滚之前的commit，git reset是直接删除指定的commit。</span><br><span class="line">git reset是把HEAD向后移动了一下，而git revert是HEAD继续前进，只是新的commit的内容跟要</span><br><span class="line">revert的内容正好相反，能够抵消要被revert的内容。</span><br></pre></td></tr></table></figure>

<h4 id="创建分支和合并分支"><a href="#创建分支和合并分支" class="headerlink" title="创建分支和合并分支"></a>创建分支和合并分支</h4><p><strong>各种分支模型</strong></p>
<p><img src="../../../../images/SRE/day53/69.jpg" alt="69"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看分支，默认只有master分支</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git branch</span></span><br><span class="line">* master</span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo master data v1.0 &gt; f1.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo f2.txt &gt; f2.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -am &#x27;add tow files&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建并切换新分支dev</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git checkout -b dev </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看分支</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git branch</span></span><br><span class="line">* dev</span><br><span class="line"> master</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># ls</span></span><br><span class="line">f1.txt f2.txt</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt </span></span><br><span class="line">master data v1.0</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f2.txt </span></span><br><span class="line">f2.txt</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo dev data v1.0 &gt; f1.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -am &#x27;modify f1.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#只切换回原分支，修改数据</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git checkout master</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo f1.txt master data v2.0 &gt; f1.txt</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git commit -am &quot;f1.txt v2.0&quot;</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git log --pretty-oneline --graph --all</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#切换分支至dev</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git checkout dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#合并master分支到当前分支dev</span></span><br><span class="line"><span class="comment">#交互式合并</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git merge master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#或者非交互式</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git merge master -m &quot;merge master&quot;</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat f1.txt </span></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; <span class="string">HEAD                                   </span></span><br><span class="line"><span class="string">f1.txt dev data v1.0</span></span><br><span class="line"><span class="string">=======</span></span><br><span class="line"><span class="string">f1.txt master data v2.0</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt;&gt;&gt;&gt; master</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#平行分支(有多次独立的提交的多个分支)中因为不同分支中同一个文件内容不同，会出现冲突，需要手动解决冲突，并重新add和commit</span></span><br><span class="line"><span class="string">[root@gitlab testproject]# git merge master </span></span><br><span class="line"><span class="string">Auto-merging f1.txt</span></span><br><span class="line"><span class="string">CONFLICT (content): Merge conflict in f1.txt</span></span><br><span class="line"><span class="string">Automatic merge failed; fix conflicts and then commit the result.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#提示合并冲突，查看文件冲突的信息</span></span><br><span class="line"><span class="string">[root@gitlab testproject]# git status</span></span><br><span class="line"><span class="string">[root@gitlab testproject]# vim f1.txt </span></span><br><span class="line"><span class="string">[root@gitlab testproject]# cat f1.txt </span></span><br><span class="line"><span class="string">f1.txt dev data v1.0</span></span><br><span class="line"><span class="string">f1.txt master data v2.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@gitlab testproject]# git commit -am &#x27;merge master&#x27;</span></span><br><span class="line"><span class="string">[root@gitlab testproject]# git log --pretty=oneline --graph --all</span></span><br></pre></td></tr></table></figure>

<h4 id="修改分支名称"><a href="#修改分支名称" class="headerlink" title="修改分支名称"></a>修改分支名称</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># git branch</span></span><br><span class="line"> dev</span><br><span class="line">* master</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git checkout dev</span></span><br><span class="line">Switched to branch <span class="string">&#x27;dev&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改当前分支名称为main</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git branch -M main</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git branch</span></span><br><span class="line">* main</span><br><span class="line"> master</span><br></pre></td></tr></table></figure>

<h4 id="当前状态打-tag-并利用-tag-回滚"><a href="#当前状态打-tag-并利用-tag-回滚" class="headerlink" title="当前状态打 tag 并利用 tag 回滚"></a>当前状态打 tag 并利用 tag 回滚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># echo v1.0 &gt; a.txt;git add .;git commit -m v1.0</span></span><br><span class="line">[main 0fba09a] v1.0</span><br><span class="line">1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git tag v1.0</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git tag</span></span><br><span class="line">v1.0</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># echo v2.0 &gt; a.txt;git add .;git commit -m v2.0</span></span><br><span class="line">[main f0153a6] v2.0</span><br><span class="line">1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git tag v2.0</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git tag</span></span><br><span class="line">v1.0</span><br><span class="line">v2.0</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git show v1.0</span></span><br><span class="line">commit 0fba09a8319f4c671be711f863ae12d44fd451a9 (tag: v1.0)</span><br><span class="line">Author: wangxiaochun &lt;29308620@qq.com&gt;</span><br><span class="line">Date:   Tue Feb 02 23:11:02 2020 +0800</span><br><span class="line"></span><br><span class="line">   v1.0</span><br><span class="line"></span><br><span class="line">diff --git a/a.txt b/a.txt</span><br><span class="line">index e69de29..6b3126c 100644</span><br><span class="line">--- a/a.txt</span><br><span class="line">+++ b/a.txt</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+v1.0</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git reset --hard v1.0</span></span><br><span class="line">HEAD is now at 0fba09a v1.0</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># cat a.txt </span></span><br><span class="line">v1.0</span><br></pre></td></tr></table></figure>

<h4 id="本地代码提交给公用仓库码云"><a href="#本地代码提交给公用仓库码云" class="headerlink" title="本地代码提交给公用仓库码云"></a>本地代码提交给公用仓库码云</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在本机创建项目</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># mkdir /data/linux;cd /data/linux</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git init </span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git config --global user.name &quot;wangxiaochun&quot; </span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git config --global user.email &quot;29308620@qq.com&quot; </span></span><br><span class="line">[root@centos8 linux]<span class="comment"># echo Hello.git &gt; hello.txt</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git add .</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git commit -m &quot;v1.0&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#先注册并登录码云，创建名称为linux的仓库后，可以执行下面操作建立本地仓库和远程码云的联系</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git remote add origin https://gitee.com/lbtooth/linux.git</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将本地main分支推送至码云的master分支</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git push -u origin main:master</span></span><br><span class="line">Username <span class="keyword">for</span> <span class="string">&#x27;https://gitee.com&#x27;</span>: wangxiaochun</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">&#x27;https://lbtooth@gitee.com&#x27;</span>: 123456</span><br><span class="line"></span><br><span class="line">[root@centos8 linux]<span class="comment"># git remote</span></span><br><span class="line">origin</span><br><span class="line"></span><br><span class="line">[root@centos8 linux]<span class="comment"># git remote -v</span></span><br><span class="line">origin https://gitee.com/lbtooth/linux.git (fetch)</span><br><span class="line">origin https://gitee.com/lbtooth/linux.git (push)</span><br><span class="line"></span><br><span class="line"><span class="comment">#和码云同步至本地</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git pull origin master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次提交</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># echo Hello2,git &gt;&gt; hello.txt</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git add .</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git commit -m &quot;v2.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git log --oneline</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#push到远程仓库，再次查看日志</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git push -u origin main:master</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git log --oneline</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除关联</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git remote remove origin</span></span><br><span class="line">[root@centos8 linux]<span class="comment"># git remote -v</span></span><br></pre></td></tr></table></figure>

<h2 id="公有云仓库"><a href="#公有云仓库" class="headerlink" title="公有云仓库"></a>公有云仓库</h2><p>git 创建本地仓库后，可以将本地仓库和远程仓库进行同步。实现网络共享和备份</p>
<p>远程仓库可以分为公有云仓库和私有仓库</p>
<ul>
<li>公有云仓库： 如github，gitee等，免费给个人或公司用使用，依赖互联网</li>
<li>私有仓库： 如gitlab适合于公司等组织内部网络使用</li>
</ul>
<h3 id="使用-github"><a href="#使用-github" class="headerlink" title="使用 github"></a>使用 github</h3><p>范例： 使用 github 创建仓库并将本地仓库上传至远程</p>
<p><img src="../../../../images/SRE/day53/70.jpg" alt="70"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># git remote add origin git@github.com:lbtooth/hello-world.git</span></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git remote </span></span><br><span class="line">origin</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git remote -v</span></span><br><span class="line">origin git@github.com:lbtooth/hello-world.git (fetch)</span><br><span class="line">origin git@github.com:lbtooth/hello-world.git (push)</span><br><span class="line"></span><br><span class="line">[root@gitlab testproject]<span class="comment"># git push -u origin master</span></span><br><span class="line">The authenticity of host <span class="string">&#x27;github.com (52.74.223.119)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>github.com,52.74.223.119<span class="string">&#x27; (RSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">git@github.com: Permission denied (publickey).</span></span><br><span class="line"><span class="string">fatal: Could not read from remote repository.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Please make sure you have the correct access rights</span></span><br><span class="line"><span class="string">and the repository exists.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@gitlab testproject]# git-keygen</span></span><br><span class="line"><span class="string">[root@gitlab testproject]# cat ~/.ssh/id_rsa.pub </span></span><br><span class="line"><span class="string">ssh-rsa </span></span><br><span class="line"><span class="string">AAAAB3NzaC1yc2EAAAADAQABAAABAQDgAoGJ4si2K3lz3xe1LJ8mUenQ6bKRhSjoQkDT6ALUp0vILsjH</span></span><br><span class="line"><span class="string">EywgHhoA3gmHY3Vy+QXPhqDWQ/4zT3+e0DrEcXiWv+HuBOU07QtJgk4/r2NXg6dDfx3snmdbOpfIeTPM</span></span><br><span class="line"><span class="string">gRmZxZDLstk2m8RqEv3Bh4SxsIrGHd/AIlDnolqPrn0zorXJYDjJtN014ESPF5XPfewkZAly9TYBowbG</span></span><br><span class="line"><span class="string">t0EFIYcwIsEVEH21rl/cXoTJ3L0lEQqlIZtJPEWMGPW4qbs8RIcC9O1Xnm1kdDrC6dvSERrdh3FDDkhF</span></span><br><span class="line"><span class="string">CtcNqE72iikjjNxkQkeSDN392GEVnDhwhm3jM2xPNcZOs9F3OPnX root@ubuntu1804.wang.org</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/71.jpg" alt="71"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab testproject]<span class="comment"># git push -u origin master</span></span><br><span class="line">Counting objects: 11, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (5/5), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (11/11), 825 bytes | 825.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 11 (delta 0), reused 0 (delta 0)</span><br><span class="line">To github.com:lbtooth/hello-world.git</span><br><span class="line"> * [new branch]     master -&gt; master</span><br><span class="line">Branch <span class="string">&#x27;master&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;master&#x27;</span> from <span class="string">&#x27;origin&#x27;</span>.</span><br></pre></td></tr></table></figure>

<h3 id="使用-gitee"><a href="#使用-gitee" class="headerlink" title="使用 gitee"></a>使用 gitee</h3><p>范例： 国内码云创建仓库</p>
<p><img src="../../../../images/SRE/day53/72.jpg" alt="72"></p>
<p><img src="../../../../images/SRE/day53/73.jpg" alt="73"></p>
<h2 id="实战案例：-元宇宙创业史"><a href="#实战案例：-元宇宙创业史" class="headerlink" title="实战案例： 元宇宙创业史"></a>实战案例： 元宇宙创业史</h2><h3 id="个人小型项目初创"><a href="#个人小型项目初创" class="headerlink" title="个人小型项目初创"></a>个人小型项目初创</h3><h4 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h4><p>想要让 git 对一个目录进行版本控制需要以下步骤：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入要管理的文件夹</span></span><br><span class="line"><span class="built_in">cd</span> /meta-project</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行初始化命令</span></span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line"><span class="comment">#管理目录下的文件状态</span></span><br><span class="line">vim index.html</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="comment">#管理指定文件</span></span><br><span class="line">git add 文件名</span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="comment">#个人信息配置：用户名和邮箱，只需配置一次即可</span></span><br><span class="line">git config --global user.name <span class="string">&quot;wangxiaochun&quot;</span>  </span><br><span class="line">git config --global user.email <span class="string">&quot;root@wangxiaochun.com&quot;</span></span><br><span class="line">git config --global color.ui <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提交</span></span><br><span class="line">git commit -m <span class="string">&quot;项目开发基本功能v0.0.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看版本记录</span></span><br><span class="line">git <span class="built_in">log</span> --oneline</span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#记录图形展示</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline --graph --all</span><br><span class="line">git <span class="built_in">log</span> --graph --pretty=format:<span class="string">&quot;%h %s&quot;</span></span><br><span class="line">git <span class="built_in">log</span> --graph --pretty=format:<span class="string">&#x27;%h -%d %s (%an, %cd)&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="开发新功能"><a href="#开发新功能" class="headerlink" title="开发新功能"></a>开发新功能</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&#x27;添加AR功能&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h4><p>发现新功能审查有问题，回滚至之前版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span>                       <span class="comment">#查看所有的提交记录</span></span><br><span class="line">git reflog                    <span class="comment">#查看所有的历史提交记录</span></span><br><span class="line">git reset --hard &lt;commitID&gt;   <span class="comment">#回退到指定的commitID</span></span><br></pre></td></tr></table></figure>

<p>新功能过审后，再回滚至之后版本，即上面’添加AR功能’的版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reflog                    <span class="comment">#查看所有的历史提交记录</span></span><br><span class="line">git reset --hard &lt;commitID&gt;   <span class="comment">#回退到指定的commitID</span></span><br></pre></td></tr></table></figure>

<h3 id="发布特定版本和紧急修复-bug"><a href="#发布特定版本和紧急修复-bug" class="headerlink" title="发布特定版本和紧急修复 bug"></a>发布特定版本和紧急修复 bug</h3><p>有一些特定的”轻奢”用户需要特殊的新特性，但对当前版本不希望改变</p>
<p>创建新分支可以给使用者提供多个不同的分支版本，意味着可以把当前工作从主线版本分离开来，以免影响主线版本的开发。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看分支和当前分支</span></span><br><span class="line">git branch </span><br><span class="line"></span><br><span class="line"><span class="comment">#创建分支</span></span><br><span class="line">git branch dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换分支</span></span><br><span class="line">git checkout dev</span><br><span class="line">vim index.html</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&#x27;添加新特性&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除分支</span></span><br><span class="line">git branch -d debug</span><br><span class="line"></span><br><span class="line"><span class="comment">#将指定分支合并至当前分支，可能产生冲突</span></span><br><span class="line">git merge &lt;要合并的分支&gt;</span><br><span class="line">git merge dev  <span class="comment">#将dev的最新代码合并到当前分支</span></span><br></pre></td></tr></table></figure>

<h3 id="实现多台主机的远程协作开发"><a href="#实现多台主机的远程协作开发" class="headerlink" title="实现多台主机的远程协作开发"></a>实现多台主机的远程协作开发</h3><p>项目很成功，赚得了第一桶金，购置了新的公办场地，招聘了多个员工协同开发工作</p>
<p>原有电脑的配置已显不足，为支持更大项目的需要，配置了新电脑，继续开发</p>
<p>同时时间紧张，回家也需要加班开发</p>
<h4 id="注册和创建的远程软件仓库"><a href="#注册和创建的远程软件仓库" class="headerlink" title="注册和创建的远程软件仓库"></a>注册和创建的远程软件仓库</h4><p>首先，需要注册github或gitee等仓库账号，并创建远程仓库，然后再执行如下命令，将代码上传到仓库</p>
<p>注意： 新建仓库时，选择不初始化仓库</p>
<p><img src="../../../../images/SRE/day53/74.jpg" alt="74"></p>
<p><img src="../../../../images/SRE/day53/75.jpg" alt="75"></p>
<h4 id="将本地仓库同步至远程仓库"><a href="#将本地仓库同步至远程仓库" class="headerlink" title="将本地仓库同步至远程仓库"></a>将本地仓库同步至远程仓库</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#给远程仓库起别名</span></span><br><span class="line">git remote add origin &lt;远程仓库地址&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#将当前分支的代码推送至远程</span></span><br><span class="line">git push -u origin 分支</span><br><span class="line"></span><br><span class="line"><span class="comment">#推送当前已有项目到gitee仓库</span></span><br><span class="line">git remote add origin https://gitee.com/lbtooth/meta-project.git</span><br><span class="line">git push -u origin <span class="string">&quot;master&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关联远程仓库</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git remote add origin https://gitee.com/lbtooth/meta-project.git</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#也可以将用户和密码同时关联</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git remote add origin https://&lt;用户名&gt;:&lt;密码&gt;@gitee.com/lbtooth/meta-project.git</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看关联</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git remote </span></span><br><span class="line">origin</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git remote -v</span></span><br><span class="line">origin https://gitee.com/lbtooth/meta-project.git (fetch)</span><br><span class="line">origin https://gitee.com/lbtooth/meta-project.git (push)</span><br><span class="line"></span><br><span class="line"><span class="comment">#推送所有分支到远程仓库</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git push -u origin --all</span></span><br><span class="line">Username <span class="keyword">for</span> <span class="string">&#x27;https://gitee.com&#x27;</span>: lbtooth</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">&#x27;https://lbtooth@gitee.com&#x27;</span>: </span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.3]</span><br><span class="line">remote: Create a pull request <span class="keyword">for</span> <span class="string">&#x27;debug&#x27;</span> on Gitee by visiting:</span><br><span class="line">remote:     https://gitee.com/lbtooth/meta-project/pull/new/lbtooth:debug...lbtooth:master</span><br><span class="line">To https://gitee.com/lbtooth/meta-project.git</span><br><span class="line"> * [new branch]     debug -&gt; debug</span><br><span class="line">Branch <span class="string">&#x27;dev&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;dev&#x27;</span> from <span class="string">&#x27;origin&#x27;</span>.</span><br><span class="line">Branch <span class="string">&#x27;master&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;master&#x27;</span> from <span class="string">&#x27;origin&#x27;</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者只推送dev分支</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git checkout dev</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git push origin dev</span></span><br></pre></td></tr></table></figure>

<p>查看gitee网站可以看到仓库有文件上传成功</p>
<p><img src="../../../../images/SRE/day53/76.jpg" alt="76"></p>
<h4 id="在新电脑初次使用下载远程仓库的代码并继续开发"><a href="#在新电脑初次使用下载远程仓库的代码并继续开发" class="headerlink" title="在新电脑初次使用下载远程仓库的代码并继续开发"></a>在新电脑初次使用下载远程仓库的代码并继续开发</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#克隆远程仓库代码，自动实现实现git remote add origin 远程仓库地址</span></span><br><span class="line">git <span class="built_in">clone</span> &lt;远程仓库地址&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换分支</span></span><br><span class="line">git checkout 分支</span><br><span class="line"></span><br><span class="line"><span class="comment">#在公司下载完代码后，继续开发，切换到dev分支进行开发</span></span><br><span class="line">git checkout dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#把master分支合并到dev</span></span><br><span class="line">git merge master</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改代码</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="comment">#提交代码</span></span><br><span class="line">git commit -m <span class="string">&#x27;继续开发新功能&#x27;</span></span><br><span class="line">git push origin dev</span><br></pre></td></tr></table></figure>

<p>示例： 新电脑同步远程仓库到本地</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#公有仓库直接下载即可</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git clone https://gitee.com/lbtooth/meta-project.git</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果是私有仓库，还需要提供用户和密码</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git clone https://&lt;用户名&gt;:&lt;密码&gt;@gitee.com/lbtooth/meta-project.git</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#确认分支</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git branch</span></span><br><span class="line">* master</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git checkout -b dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#拉取dev分支</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git pull origin dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#确认新代码已经同步到本机</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># cat index.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#个人信息配置：用户名和邮箱，只需配置一次即可</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git config --global user.email &quot;wang@qq.com&quot;</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git config --global user.name &quot;wang&quot;  </span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git config --global color.ui true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#继续提交</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># vim index.html</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git add .</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git commit -m &#x27;继续开发新功能&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同步到远程仓库</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git push origin dev</span></span><br><span class="line">Username <span class="keyword">for</span> <span class="string">&#x27;https://gitee.com&#x27;</span>: lbtooth</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">&#x27;https://lbtooth@gitee.com&#x27;</span>: </span><br><span class="line">Enumerating objects: 5, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (5/5), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 2 threads</span><br><span class="line">Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 361 bytes | 361.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.3]</span><br><span class="line">To https://gitee.com/lbtooth/meta-project.git</span><br><span class="line">   6be3e4d..43b9a43 dev -&gt; dev</span><br></pre></td></tr></table></figure>

<h4 id="下班回到家继续加班"><a href="#下班回到家继续加班" class="headerlink" title="下班回到家继续加班"></a>下班回到家继续加班</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换到dev分支进行开发</span></span><br><span class="line">git checkout dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#拉取最新代码</span></span><br><span class="line">git pull origin dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#等价于</span></span><br><span class="line">git fetch origin dev</span><br><span class="line">git merge origin/dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#继续开发</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="comment">#提交代码</span></span><br><span class="line">git commit -m <span class="string">&#x27;在家加班&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#推送至远程</span></span><br><span class="line">git push origin dev</span><br></pre></td></tr></table></figure>

<h4 id="到公司继续开发"><a href="#到公司继续开发" class="headerlink" title="到公司继续开发"></a>到公司继续开发</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换到dev分支进行开发</span></span><br><span class="line">git checkout dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#拉最新代码，不必再clone，只需要通过pull获取最新代码即可</span></span><br><span class="line">git pull origin dev</span><br><span class="line"></span><br><span class="line"><span class="comment">#继续开发.提交代码</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&#x27;上班工作&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#推送代码到仓库</span></span><br><span class="line">git push origin dev</span><br></pre></td></tr></table></figure>

<h4 id="开发完毕，要上线"><a href="#开发完毕，要上线" class="headerlink" title="开发完毕，要上线"></a>开发完毕，要上线</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将dev分支合并到master，进行上线</span></span><br><span class="line">git checkout master</span><br><span class="line">git merge dev</span><br><span class="line">git push origin master</span><br><span class="line"></span><br><span class="line"><span class="comment">#把dev分支也推送到远程</span></span><br><span class="line">git checkout dev</span><br><span class="line">git merge master</span><br><span class="line">git push origin dev</span><br></pre></td></tr></table></figure>

<h4 id="免密码登录"><a href="#免密码登录" class="headerlink" title="免密码登录"></a>免密码登录</h4><p>通过HTTP/HTTPS实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#原来的地址：</span></span><br><span class="line">https://gitee.com/lbtooth/meta-project.git</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改的地址：</span></span><br><span class="line">https://用户名:密码@gitee.com/lbtooth/meta-project.git</span><br><span class="line"></span><br><span class="line">git remote add origin https://用户名:密码@gitee.com/lbtooth/meta-project.git</span><br><span class="line"></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

<p>SSH 实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成公钥和私钥(默认放在 ~/.ssh目录下，id_rsa.pub公钥、id_rsa私钥）</span></span><br><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line"><span class="comment">#拷贝公钥的内容，并设置到gitee或github中</span></span><br><span class="line"><span class="built_in">cat</span> id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment">#在git本地中配置ssh地址</span></span><br><span class="line">git remote add origin git@gitee.com:lbtooth/meta-project.git</span><br><span class="line"></span><br><span class="line"><span class="comment">#以后使用以下即可</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

<h3 id="多版本管理"><a href="#多版本管理" class="headerlink" title="多版本管理"></a>多版本管理</h3><p>虽然每次commit,都会生成一个commit id,但此方式无疑是不方便标记和记忆的</p>
<p>git标签就是对指定的commit的一次快照，相当于给commit ID起了一个容易记忆的名称，可以做为进度的里程碑的标记</p>
<p>git tag 便于后续将特定时期的代码快速取出。</p>
<p>在代码发布时可以使用标签发布。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对当前最新提交的代码创建标签，-a标签名称，-m标签描述</span></span><br><span class="line">git tag -a <span class="string">&quot;v2.0&quot;</span> -m <span class="string">&quot;新版本2.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建标签，指定commit ID</span></span><br><span class="line">git <span class="built_in">log</span> <span class="comment">#查看Commit ID</span></span><br><span class="line">git tag -a <span class="string">&quot;v1.0&quot;</span> &lt;Commit ID&gt; -m <span class="string">&quot;正式版本1.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标签详情</span></span><br><span class="line">git tag</span><br><span class="line">git tag -l</span><br><span class="line"></span><br><span class="line"><span class="comment">#同步所有标签到远程仓库</span></span><br><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当前状态创建tag</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git tag -a &quot;v1.0&quot; -m &quot;正式版本1.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看tag信息</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git show v1.0</span></span><br><span class="line">tag v1.0</span><br><span class="line">Tagger: wang &lt;wang@qq.com&gt;</span><br><span class="line">Date:   Tue Jul 19 10:01:29 2022 +0000</span><br><span class="line"></span><br><span class="line">正式版本1.0</span><br><span class="line"></span><br><span class="line">commit 61a19a66264171fb73600166384ea828e00a5818 (HEAD -&gt; master, tag: v1.0, </span><br><span class="line">origin/master)</span><br><span class="line">Author: wang &lt;wang@qq.com&gt;</span><br><span class="line">Date:   Tue Jul 19 09:18:38 2022 +0000</span><br><span class="line"></span><br><span class="line">   删除Hello.java</span><br><span class="line">   </span><br><span class="line">diff --git a/Hello.java b/Hello.java</span><br><span class="line">deleted file mode 100644</span><br><span class="line">index 110b1e6..0000000</span><br><span class="line">--- a/Hello.java</span><br><span class="line">+++ /dev/null</span><br><span class="line">@@ -1 +0,0 @@</span><br><span class="line">-Hello v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看commit ID</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git log</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git reflog</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#为指定commit id创建tag</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git tag -a &#x27;v0.0.1&#x27; d9c6b575702441fd -m &#x27;初始发布&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同步所有tag到远程仓库</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git push origin --tags</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#拉取所有远程仓库的tag</span></span><br><span class="line">[root@ubuntu2004 meta-project]<span class="comment"># git pull origin --tags</span></span><br></pre></td></tr></table></figure>

<h1 id="私有软件仓库-GitLab"><a href="#私有软件仓库-GitLab" class="headerlink" title="私有软件仓库 GitLab"></a>私有软件仓库 GitLab</h1><h2 id="GitLab-介绍"><a href="#GitLab-介绍" class="headerlink" title="GitLab 介绍"></a>GitLab 介绍</h2><h3 id="Gitlab-介绍"><a href="#Gitlab-介绍" class="headerlink" title="Gitlab 介绍"></a>Gitlab 介绍</h3><p><img src="../../../../images/SRE/day53/77.jpg" alt="77"></p>
<p>GitLab 是一个基于Ruby on Rails构建用于仓库管理系统的开源项目，使用Git作为代码管理工具，提供了Web界面进行访问公开的或者私有的项目</p>
<p>GitLab 优势</p>
<ul>
<li>开源免费</li>
<li>可以作为 Git 代码仓库</li>
<li>提供了方便易用的 Web 管理界面</li>
<li>支持多租户</li>
<li>功能丰富</li>
<li>支持离线提交</li>
<li>安全性高， 可以对不同的用户设置不同的权限，并且支持不同用户只能访问特定的代码，实现代码部分可见</li>
</ul>
<h3 id="GitLab-架构"><a href="#GitLab-架构" class="headerlink" title="GitLab 架构"></a>GitLab 架构</h3><p>Gitlab 是一个复杂的系统，由很多应用组成</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://panlw.github.io/15365441001781.html</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/78.jpg" alt="78"></p>
<p>Gitlab的服务构成</p>
<ul>
<li>Nginx：静态web服务器</li>
<li>GitLab shell：用于处理基于ssh会话的Git命令和修改authorized keys列表</li>
<li>gitlab-workhorse：轻量级的反向代理服务器 它旨在充当智能反向代理，以帮助整个 GitLab 加速</li>
<li>postgresql：数据库</li>
<li>redis：缓存数据库</li>
<li>sidekiq：用于在后台执行队列任务（异步执行)</li>
<li>unicorn：An HTTP server for Rack applications, GitLab Rails应用是托管在这个服务器上面的</li>
<li>GitLab Exporter：GitLab指标暴露器</li>
<li>Node Exporter：节点指标暴露器</li>
<li>GitLab self-monitoring的多个组件：Prometheus、Alertmanager、Grafana、Sentry和Jaeger</li>
<li>Inbound emails（SMPT）：接收用于更新issue的邮件</li>
<li>Outbound email (SMTP)：向用户发送邮件通知</li>
<li>LDAP Authentication：LDAP认证集成</li>
<li>MinIO：对象存储服务</li>
<li>Registry：容器注册表，支持Image的push和pull操作</li>
<li>Runner：执行GitLab的CI/CD作业</li>
</ul>
<h2 id="GitLab-安装"><a href="#GitLab-安装" class="headerlink" title="GitLab 安装"></a>GitLab 安装</h2><p>GitLab 有两个版本：EE商业版和CE社区版，以下使用CE版</p>
<h3 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h3><p>Gitlab 服务的安装文档：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ce/install/</span><br></pre></td></tr></table></figure>

<p>安装方法说明</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ee/install/install_methods.html</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Linux安装包：官方的 deb/rpm 安装包（也被称作 Omnibus GitLab）包含极狐GitLab和依赖的组件，包括PostgreSQL、Redis 和 Sidekiq</p>
<p>Omnibus GitLab是基于Chef的应用编排工具，它基于Chef的cookbooks和recipes等组件自动化编排GitLab的各组件，避免了用户复杂的配置过程 </p>
<p>相关项目 <a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-org/omnibus-gitlab">https://gitlab.com/gitlab-org/omnibus-gitlab</a></p>
</li>
<li><p>Source：源码安装，在GitLab没有提供适用的安装包的平台上（例如各类BSD系统）只能采用这种安装方式</p>
</li>
<li><p>Docker：Docker 容器化的极狐GitLab 软件包</p>
</li>
<li><p>GitLab Operator：Kubernetes Operator风格的部署模式</p>
</li>
<li><p>Helm Chart：用于在 Kubernetes 上安装极狐GitLab 及其所有组件的云原生 Helm chart</p>
</li>
<li><p>GitLab Environment Toolkit（GET）：自动化工具集，用于在主流的公有云（Azure、GCP和AWS）上部署GitLab</p>
</li>
</ul>
<h3 id="安装-GitLab-要求"><a href="#安装-GitLab-要求" class="headerlink" title="安装 GitLab 要求"></a>安装 GitLab 要求</h3><p>Gitlab硬件和软件的环境要求：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ce/install/requirements.html</span><br></pre></td></tr></table></figure>

<p>硬件配置要求较高：</p>
<ul>
<li>测试环境：内存4G以上</li>
<li>生产环境：建议CPU2C以上，内存8G以上，磁盘10G以上配置，和用户数有关</li>
</ul>
<p><strong>注意：如果内存较低，可以会导致Gitlab有些服务无法启动，建议4G以上内存</strong></p>
<p><img src="../../../../images/SRE/day53/79.jpg" alt="79"></p>
<p>数据库要求：</p>
<p><strong>从GitLab 12.1 开始不再支持MySQL,只支持PostgreSQL</strong> </p>
<p><img src="../../../../images/SRE/day53/80.jpg" alt="80"></p>
<h3 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h3><h4 id="Ubuntu-系统环境安装前准备"><a href="#Ubuntu-系统环境安装前准备" class="headerlink" title="Ubuntu 系统环境安装前准备"></a>Ubuntu 系统环境安装前准备</h4><p>配置ubuntu 仓库</p>
<p>配置阿里云或清华大学等国内镜像仓库实现加速</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># vim /etc/apt/sources.list</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">debhttps://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<h4 id="RHEL-系统环境安装前准备"><a href="#RHEL-系统环境安装前准备" class="headerlink" title="RHEL 系统环境安装前准备"></a>RHEL 系统环境安装前准备</h4><p>基于最小化服务器安装，建议修改配置如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></span><br><span class="line">[root@centos ~]<span class="comment"># systemctl disable firewalld</span></span><br><span class="line">[root@centos ~]<span class="comment"># sed -i &#x27;/SELINUX/s/enforcing/disabled/&#x27; /etc/sysconfig/selinux</span></span><br><span class="line">[root@centos ~]<span class="comment"># hostnamectl set-hostname gitlab.example.com</span></span><br><span class="line">[root@centos ~]<span class="comment"># reboot</span></span><br></pre></td></tr></table></figure>

<h3 id="GitLab-安装-1"><a href="#GitLab-安装-1" class="headerlink" title="GitLab 安装"></a>GitLab 安装</h3><p>gitlab 安装有多种方式，下面选择包安装方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ce/install/</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/81.jpg" alt="81"></p>
<h4 id="安装-GitLab"><a href="#安装-GitLab" class="headerlink" title="安装 GitLab"></a>安装 GitLab</h4><p>官方gitlab 包下载链接</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://packages.gitlab.com/gitlab</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/82.jpg" alt="82"></p>
<p><strong>GitLab-CE 安装包官方下载地址：</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://packages.gitlab.com/gitlab/gitlab-ce</span><br></pre></td></tr></table></figure>

<p><strong>yum源清华大学下载地址：</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/</span><br></pre></td></tr></table></figure>

<p><strong>CentOS 的yum源</strong></p>
<p><img src="../../../../images/SRE/day53/83.jpg" alt="83"></p>
<p><strong>Ubuntu 的deb源</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/84.jpg" alt="84"></p>
<p>范例：Ubuntu 国内镜像下载并安装 GitLab</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新版下载和安装</span></span><br><span class="line">[root@ubuntu2004 ~]<span class="comment"># wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_14.1.0-ce.0_amd64.deb</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># dpkg -i gitlab-ce_14.1.0-ce.0_amd64.deb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#旧版下载和安装</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_11.11.8-ce.0_amd64.deb</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># dpkg -i gitlab-ce_11.11.8-ce.0_amd64.deb</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/85.jpg" alt="85"></p>
<h4 id="修改-GitLab-配置"><a href="#修改-GitLab-配置" class="headerlink" title="修改 GitLab 配置"></a>修改 GitLab 配置</h4><p><strong>gitlab 相关的目录：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/gitlab     <span class="comment">#配置文件目录，重要</span></span><br><span class="line">/var/opt/gitlab <span class="comment">#数据目录，源代码就存放在此目录，重要</span></span><br><span class="line">/var/log/gitlab <span class="comment">#日志目录</span></span><br><span class="line">/run/gitlab     <span class="comment">#运行目录，存放很多的数据库文件</span></span><br><span class="line">/opt/gitlab     <span class="comment">#安装目录</span></span><br></pre></td></tr></table></figure>

<p>范例： gitlab 初始化配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># vim /etc/gitlab/gitlab.rb</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># grep &quot;^[a-Z]&quot; /etc/gitlab/gitlab.rb</span></span><br><span class="line">external_url <span class="string">&#x27;http://gitlab.wang.org&#x27;</span> <span class="comment">#修改此行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以下可选，增加下面行(可以和上面行写在一起)，实现邮件通知设置</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.qq.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;29308620@qq.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;授权码&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;qq.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&quot;29308620@qq.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#新版中增加下面行，给root用户指定初始密码才能登录，或者设置环境变量GITLAB_ROOT_PASSWORD实现初始密码</span></span><br><span class="line"><span class="comment">#注意：密码至少8位并且复杂度要求才是有效密码</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;initial_root_password&#x27;</span>] = <span class="string">&quot;12345678&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#名称解析</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line">10.0.0.100 gitlab.wang.org</span><br></pre></td></tr></table></figure>

<p>由于 Gitlab 主机功能是代码托管，默认有些额外的组件比较消耗资源，如果暂时不使用可以考虑关闭</p>
<p>范例： 将不需要使用的组件都设定为false</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line">prometheus[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">prometheus[<span class="string">&#x27;monitor_kubernetes&#x27;</span>] =<span class="literal">false</span></span><br><span class="line">alertmanager[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">node_exporter[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">redis_exporter[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">postgres_exporter[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_exporter[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">prometheus_monitoring[<span class="string">&#x27;enable&#x27;</span>] =<span class="literal">false</span></span><br><span class="line">grafana[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h4 id="初始化和启动服务"><a href="#初始化和启动服务" class="headerlink" title="初始化和启动服务"></a>初始化和启动服务</h4><p>执行配置reconfigure并启动服务：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#每次修改完配置文件都需要执行此操作</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/86.jpg" alt="86"></p>
<h4 id="验证-GitLab-启动完成"><a href="#验证-GitLab-启动完成" class="headerlink" title="验证 GitLab 启动完成"></a>验证 GitLab 启动完成</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新版服务</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl status</span></span><br><span class="line">run: alertmanager: (pid 12495) 73s; run: <span class="built_in">log</span>: (pid 12138) 144s</span><br><span class="line">run: gitaly: (pid 12374) 76s; run: <span class="built_in">log</span>: (pid 11439) 257s</span><br><span class="line">run: gitlab-exporter: (pid 12388) 76s; run: <span class="built_in">log</span>: (pid 11915) 163s</span><br><span class="line">run: gitlab-workhorse: (pid 12349) 77s; run: <span class="built_in">log</span>: (pid 11840) 181s</span><br><span class="line">run: grafana: (pid 12514) 73s; run: <span class="built_in">log</span>: (pid 12286) 96s</span><br><span class="line">run: logrotate: (pid 11357) 270s; run: <span class="built_in">log</span>: (pid 11365) 269s</span><br><span class="line">run: nginx: (pid 11846) 177s; run: <span class="built_in">log</span>: (pid 11860) 176s</span><br><span class="line">run: node-exporter: (pid 12363) 76s; run: <span class="built_in">log</span>: (pid 11898) 170s</span><br><span class="line">run: postgres-exporter: (pid 12507) 73s; run: <span class="built_in">log</span>: (pid 12164) 140s</span><br><span class="line">run: postgresql: (pid 11570) 252s; run: <span class="built_in">log</span>: (pid 11585) 249s</span><br><span class="line">run: prometheus: (pid 12397) 75s; run: <span class="built_in">log</span>: (pid 11960) 152s</span><br><span class="line">run: puma: (pid 11754) 196s; run: <span class="built_in">log</span>: (pid 11762) 193s</span><br><span class="line">run: redis: (pid 11387) 264s; run: <span class="built_in">log</span>: (pid 11395) 263s</span><br><span class="line">run: redis-exporter: (pid 12390) 75s; run: <span class="built_in">log</span>: (pid 11936) 157s</span><br><span class="line">run: sidekiq: (pid 11772) 190s; run: <span class="built_in">log</span>: (pid 11786) 187s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#旧版服务</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl status</span></span><br><span class="line">run: alertmanager: (pid 29801) 117s; run: <span class="built_in">log</span>: (pid 29411) 135s</span><br><span class="line">run: gitaly: (pid 29575) 120s; run: <span class="built_in">log</span>: (pid 28084) 222s</span><br><span class="line">run: gitlab-monitor: (pid 29659) 119s; run: <span class="built_in">log</span>: (pid 29196) 151s</span><br><span class="line">run: gitlab-workhorse: (pid 29616) 120s; run: <span class="built_in">log</span>: (pid 28848) 173s</span><br><span class="line">run: logrotate: (pid 28923) 166s; run: <span class="built_in">log</span>: (pid 29008) 163s</span><br><span class="line">run: nginx: (pid 28851) 172s; run: <span class="built_in">log</span>: (pid 28902) 169s</span><br><span class="line">run: node-exporter: (pid 29638) 119s; run: <span class="built_in">log</span>: (pid 29107) 157s</span><br><span class="line">run: postgres-exporter: (pid 29817) 116s; run: <span class="built_in">log</span>: (pid 29479) 131s</span><br><span class="line">run: postgresql: (pid 28231) 217s; run: <span class="built_in">log</span>: (pid 28266) 214s</span><br><span class="line">run: prometheus: (pid 29767) 118s; run: <span class="built_in">log</span>: (pid 29335) 139s</span><br><span class="line">run: redis: (pid 27937) 229s; run: <span class="built_in">log</span>: (pid 27974) 227s</span><br><span class="line">run: redis-exporter: (pid 29668) 118s; run: <span class="built_in">log</span>: (pid 29258) 145s</span><br><span class="line">run: sidekiq: (pid 28742) 180s; run: <span class="built_in">log</span>: (pid 28797) 177s</span><br><span class="line">run: unicorn: (pid 28653) 186s; run: <span class="built_in">log</span>: (pid 28698) 183s</span><br></pre></td></tr></table></figure>

<h4 id="验证端口及状态"><a href="#验证端口及状态" class="headerlink" title="验证端口及状态"></a>验证端口及状态</h4><p>80端口是在初始化gitlib的时候启动的，因此如果之前有程序占用了相关端口，就会导致初始化失败或无法访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># lsof -i :80</span></span><br><span class="line">COMMAND   PID       USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">nginx   28851       root   7u IPv4  88801     0t0 TCP *:http (LISTEN)</span><br><span class="line">nginx   28852 gitlab-www   7u IPv4  88801     0t0 TCP *:http (LISTEN)</span><br><span class="line">nginx   28853 gitlab-www   7u IPv4  88801     0t0 TCP *:http (LISTEN)</span><br></pre></td></tr></table></figure>

<h4 id="Gitlab的常用命令"><a href="#Gitlab的常用命令" class="headerlink" title="Gitlab的常用命令"></a>Gitlab的常用命令</h4><p>GitLab除了使用Web界面进行管理，还提供了各组件的统一命令为gitlab-ctl，例如gitlab-ctl reconfig或gitlab-ctl restart等能统一执行各组件的重新配置及重启操作；此外还有一些各组件专用的命令，如gitlab-pgsql、 gitlab-rails和gitlab-rake等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gitlab-rails   <span class="comment">#用于启动控制台进行特殊操作，如修改管理员密码、打开数据库控制台( gitlab-rails dbconsole)等</span></span><br><span class="line">gitlab-psql    <span class="comment">#数据库命令行</span></span><br><span class="line">gitlab-rake    <span class="comment">#数据备份恢复等数据操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端命令行操作行</span></span><br><span class="line">gitlab-ctl  </span><br><span class="line">gitlab-ctl reconfigure  <span class="comment">#修改过配置后需要执行重新配置</span></span><br><span class="line">gitlab-ctl stop         <span class="comment">#停止gitlab</span></span><br><span class="line">gitlab-ctl start        <span class="comment">#启动gitlab</span></span><br><span class="line">gitlab-ctl restart      <span class="comment">#重启gitlab</span></span><br><span class="line">gitlab-ctl status       <span class="comment">#查看组件运行状态</span></span><br><span class="line">gitlab-ctl <span class="built_in">tail</span>         <span class="comment">#查看所有日志</span></span><br><span class="line">gitlab-ctl <span class="built_in">tail</span> nginx   <span class="comment">#查看某个组件的日志</span></span><br><span class="line">gitlab-ctl service-list <span class="comment">#列出服务</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-psql</span></span><br><span class="line">psql (9.6.11)</span><br><span class="line">Type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line">gitlabhq_production=<span class="comment"># help</span></span><br><span class="line">You are using psql, the command-line interface to PostgreSQL.</span><br><span class="line">Type: \copyright <span class="keyword">for</span> distribution terms</span><br><span class="line">       \h <span class="keyword">for</span> <span class="built_in">help</span> with SQL commands</span><br><span class="line">       \? <span class="keyword">for</span> <span class="built_in">help</span> with psql commands</span><br><span class="line">       \g or terminate with semicolon to execute query</span><br><span class="line">       \q to quit</span><br><span class="line">gitlabhq_production=<span class="comment"># \db</span></span><br><span class="line">         List of tablespaces</span><br><span class="line">   Name     |   Owner     | Location</span><br><span class="line">------------+-------------+----------</span><br><span class="line"> pg_default | gitlab-psql |</span><br><span class="line"> pg_global  | gitlab-psql |</span><br><span class="line"></span><br><span class="line">(2 rows)</span><br><span class="line"></span><br><span class="line">gitlabhq_production-<span class="comment"># \q</span></span><br></pre></td></tr></table></figure>

<p>范例： 查看服务列表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl service-list</span></span><br><span class="line">alertmanager*</span><br><span class="line">gitaly*</span><br><span class="line">gitlab-exporter*</span><br><span class="line">gitlab-workhorse*</span><br><span class="line">grafana*</span><br><span class="line">logrotate*</span><br><span class="line">nginx*</span><br><span class="line">node-exporter*</span><br><span class="line">postgres-exporter*</span><br><span class="line">postgresql*</span><br><span class="line">prometheus*</span><br><span class="line">puma*</span><br><span class="line">redis*</span><br><span class="line">redis-exporter*</span><br><span class="line">sidekiq*</span><br></pre></td></tr></table></figure>

<h4 id="一键安装-GitLab-脚本"><a href="#一键安装-GitLab-脚本" class="headerlink" title="一键安装 GitLab 脚本"></a>一键安装 GitLab 脚本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#说明：安装GitLab 服务器内存建议至少4G,root密码至少8位</span></span><br><span class="line">GITLAB_VERSION=14.1.0</span><br><span class="line">URL=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_<span class="variable">$&#123;GITLAB_VERSION&#125;</span>-ce.0_amd64.deb&quot;</span></span><br><span class="line"><span class="comment">#URL=&quot;https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb&quot;</span></span><br><span class="line"><span class="comment">#URL=&quot;https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el8/gitlab-ce-14.1.5-ce.0.el8.x86_64.rpm&quot;</span></span><br><span class="line"><span class="comment">#URL=&quot;https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-14.1.5-ce.0.el7.x86_64.rpm&quot;</span></span><br><span class="line"></span><br><span class="line">GITLAB_ROOT_PASSWORD=12345678</span><br><span class="line">SMTP_PASSWORD=xxxxxxxxxxxxxx</span><br><span class="line">HOST=gitlab.wang.org</span><br><span class="line"></span><br><span class="line"><span class="comment">#HOST=`hostname -I|awk &#x27;&#123;print $1&#125;&#x27;`</span></span><br><span class="line">. /etc/os-release</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">color</span></span> () &#123;</span><br><span class="line">    RES_COL=60</span><br><span class="line">    MOVE_TO_COL=<span class="string">&quot;echo -en \\033[<span class="variable">$&#123;RES_COL&#125;</span>G&quot;</span></span><br><span class="line">    SETCOLOR_SUCCESS=<span class="string">&quot;echo -en \\033[1;32m&quot;</span></span><br><span class="line">    SETCOLOR_FAILURE=<span class="string">&quot;echo -en \\033[1;31m&quot;</span></span><br><span class="line">    SETCOLOR_WARNING=<span class="string">&quot;echo -en \\033[1;33m&quot;</span></span><br><span class="line">    SETCOLOR_NORMAL=<span class="string">&quot;echo -en \E[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> &amp;&amp; <span class="variable">$MOVE_TO_COL</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;[&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$2</span> = <span class="string">&quot;success&quot;</span> -o <span class="variable">$2</span> = <span class="string">&quot;0&quot;</span> ] ;<span class="keyword">then</span></span><br><span class="line">        <span class="variable">$&#123;SETCOLOR_SUCCESS&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">&quot; OK &quot;</span>    </span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$2</span> = <span class="string">&quot;failure&quot;</span> -o <span class="variable">$2</span> = <span class="string">&quot;1&quot;</span> ] ;<span class="keyword">then</span> </span><br><span class="line">        <span class="variable">$&#123;SETCOLOR_FAILURE&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">&quot;FAILED&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$&#123;SETCOLOR_WARNING&#125;</span></span><br><span class="line">        <span class="built_in">echo</span> -n $<span class="string">&quot;WARNING&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;SETCOLOR_NORMAL&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;]&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_gitlab</span></span>() &#123;</span><br><span class="line">    wget -P /usr/local/src/ <span class="variable">$URL</span> || &#123; color  <span class="string">&quot;下载失败!&quot;</span> 1 ;<span class="built_in">exit</span> ; &#125;</span><br><span class="line">    PACK=<span class="string">&quot;/usr/local/src/<span class="variable">$&#123;URL##*/&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$ID</span> = <span class="string">&quot;centos&quot;</span> -o <span class="variable">$ID</span> = <span class="string">&quot;rocky&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">       yum -y install <span class="variable">$PACK</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">       dpkg -i  <span class="variable">$PACK</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">           color <span class="string">&quot;安装gitlab完成!&quot;</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">           color <span class="string">&quot;安装gitlab失败!&quot;</span> 1</span><br><span class="line">           <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">config_gitlab</span></span>() &#123;</span><br><span class="line">    sed -i.bak  <span class="string">&quot;/^external_url.*/c external_url \&#x27;http://<span class="variable">$HOST</span>\&#x27;&quot;</span> /etc/gitlab/gitlab.rb</span><br><span class="line">    <span class="built_in">cat</span> &gt;&gt; /etc/gitlab/gitlab.rb &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_enable&#x27;] = true</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_address&#x27;] = &quot;smtp.qq.com&quot;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_port&#x27;] = 465</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_user_name&#x27;] = &quot;29308620@qq.com&quot;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_password&#x27;] = &quot;$SMTP_PASSWORD&quot;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_domain&#x27;] = &quot;qq.com&quot;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_authentication&#x27;] = &quot;login&quot;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;] = true</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;smtp_tls&#x27;] = true</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;gitlab_email_from&#x27;] = &quot;29308620@qq.com&quot;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;initial_root_password&#x27;] = &quot;$GITLAB_ROOT_PASSWORD&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">   gitlab-ctl reconfigure</span><br><span class="line">   gitlab-ctl status</span><br><span class="line">    <span class="keyword">if</span> [ $?  -eq 0 ];<span class="keyword">then</span>  </span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">       color <span class="string">&quot;Gitlab安装完成!&quot;</span> 0</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;-------------------------------------------------------------------&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;请访问链接: \E[32;1mhttp://<span class="variable">$HOST</span>/\E[0m&quot;</span></span><br><span class="line"> 		<span class="built_in">echo</span> -e <span class="string">&quot;用户和密码: \E[32;1mroot/<span class="variable">$&#123;GITLAB_ROOT_PASSWORD&#125;</span>\E[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        color <span class="string">&quot;Gitlab安装失败!&quot;</span> 1</span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_gitlab</span><br><span class="line">config_gitlab</span><br></pre></td></tr></table></figure>

<h4 id="基于-Docker-安装-GitLab"><a href="#基于-Docker-安装-GitLab" class="headerlink" title="基于 Docker 安装 GitLab"></a>基于 Docker 安装 GitLab</h4><p>范例：基于Docker 部署</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GITLAB_HOME=/srv/gitlab</span><br><span class="line">sudo docker run --detach \</span><br><span class="line">  --hostname gitlab.example.com \</span><br><span class="line">  --publish 443:443 --publish 80:80 --publish 22:22 \</span><br><span class="line">  --name gitlab \</span><br><span class="line">  --restart always \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/config:/etc/gitlab \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/logs:/var/log/gitlab \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/data:/var/opt/gitlab \</span><br><span class="line">  --shm-size 256m \</span><br><span class="line">  gitlab/gitlab-ee:latest</span><br></pre></td></tr></table></figure>

<h2 id="GitLab-基本配置"><a href="#GitLab-基本配置" class="headerlink" title="GitLab 基本配置"></a>GitLab 基本配置</h2><h3 id="首次登录-GitLab-Web-界面修改密码"><a href="#首次登录-GitLab-Web-界面修改密码" class="headerlink" title="首次登录 GitLab Web 界面修改密码"></a>首次登录 GitLab Web 界面修改密码</h3><p>新版gitlab密码初始化官方帮助链接</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/omnibus/installation/index.html</span><br></pre></td></tr></table></figure>

<p>浏览器访问 <code>http://gitlab服务器IP/</code></p>
<p>在新版gitlab中第一次登录的界面发生变化，取消重设密码界面，需要直接输入用户和密码才能登录，默认用户为root，其密码是随机生成</p>
<p><img src="../../../../images/SRE/day53/87.jpg" alt="87"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果没有在配置文件中对密码做初始化设置，可以从以下文件找到初始密码</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># cat /etc/gitlab/initial_root_password</span></span><br><span class="line">Password: t2c31Eqz4035tmrbAJFl/itm8aSkEHu87xGzluzsj/w=</span><br></pre></td></tr></table></figure>

<p>新版登录界面，用root用户和配置文件中指定的密码或以上文件中的初始密码登录</p>
<p><img src="../../../../images/SRE/day53/88.jpg" alt="88"></p>
<p>新版登录后，也可以再次修改密码，注意：密码至少8位</p>
<p><img src="../../../../images/SRE/day53/89.jpg" alt="89"></p>
<p>使用用户 root 和上面设置的密码登录</p>
<p>新版界面</p>
<p><img src="../../../../images/SRE/day53/90.jpg" alt="90"></p>
<p>新版登录首页</p>
<p><img src="../../../../images/SRE/day53/91.jpg" alt="91"></p>
<p>以下是旧版的首次登录web页面，必须先设置密码，密码要求最少8位</p>
<p><img src="../../../../images/SRE/day53/92.jpg" alt="92"></p>
<p>旧版界面</p>
<p><img src="../../../../images/SRE/day53/93.jpg" alt="93"></p>
<p>旧版登录首页</p>
<p><img src="../../../../images/SRE/day53/94.jpg" alt="94"></p>
<h3 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h3><p>登录gitlab后可能看到用户的头像不能正常显示，可以修改为自定义的头像</p>
<p><img src="../../../../images/SRE/day53/95.jpg" alt="95"><br><img src="../../../../images/SRE/day53/96.jpg" alt="96"><br><img src="../../../../images/SRE/day53/97.jpg" alt="97"></p>
<h3 id="关闭账号注册功能"><a href="#关闭账号注册功能" class="headerlink" title="关闭账号注册功能"></a>关闭账号注册功能</h3><p>新版用户注册界面</p>
<p><img src="../../../../images/SRE/day53/98.jpg" alt="98"><br><img src="../../../../images/SRE/day53/99.jpg" alt="99"></p>
<p>关闭注册功能，先用root用户登录</p>
<p><img src="../../../../images/SRE/day53/100.jpg" alt="100"><br><img src="../../../../images/SRE/day53/101.jpg" alt="101"></p>
<p>Save Changes 后，再重新登录观察到注册界面不再显示</p>
<p><img src="../../../../images/SRE/day53/102.jpg" alt="102"></p>
<p>旧版中默认情况下也可以直接注册账号，基于安全目的，一般都会关闭此功能</p>
<p><img src="../../../../images/SRE/day53/103.jpg" alt="103"></p>
<p>取消账户注册功能之后点 <code>save changes</code></p>
<p><img src="../../../../images/SRE/day53/104.jpg" alt="104"></p>
<p>重新登录，验证是否还有注册选项</p>
<p><img src="../../../../images/SRE/day53/105.jpg" alt="105"></p>
<h3 id="修改邮箱地址"><a href="#修改邮箱地址" class="headerlink" title="修改邮箱地址"></a>修改邮箱地址</h3><p><strong>新版界面</strong></p>
<p><img src="../../../../images/SRE/day53/106.jpg" alt="106"></p>
<p>确认收到邮件</p>
<p><img src="../../../../images/SRE/day53/107.jpg" alt="107"></p>
<p>确认邮件生效</p>
<p><img src="../../../../images/SRE/day53/108.jpg" alt="108"></p>
<p>查看邮件生效</p>
<p><img src="../../../../images/SRE/day53/109.jpg" alt="109"></p>
<p>修改个人资料的邮件地址</p>
<p><img src="../../../../images/SRE/day53/110.jpg" alt="110"></p>
<p>验证邮箱</p>
<p><img src="../../../../images/SRE/day53/111.jpg" alt="111"></p>
<p><strong>旧版界面</strong></p>
<p><img src="../../../../images/SRE/day53/112.jpg" alt="112"><br><img src="../../../../images/SRE/day53/113.jpg" alt="113"></p>
<p>登录邮箱帐号，验证注册信息</p>
<p><img src="../../../../images/SRE/day53/114.jpg" alt="114"></p>
<p>如下面，修改邮箱设置指定新的邮箱</p>
<p><img src="../../../../images/SRE/day53/115.jpg" alt="115"></p>
<p>重新登录后，可以看到邮箱的变化</p>
<p><img src="../../../../images/SRE/day53/116.jpg" alt="116"></p>
<p>删除旧的邮箱</p>
<p><img src="../../../../images/SRE/day53/117.jpg" alt="117"></p>
<h2 id="GitLab-用户和组管理"><a href="#GitLab-用户和组管理" class="headerlink" title="GitLab 用户和组管理"></a>GitLab 用户和组管理</h2><h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><p>创建gitlab用户账户并登录</p>
<p><strong>新版界面</strong></p>
<p><img src="../../../../images/SRE/day53/118.jpg" alt="118"><br><img src="../../../../images/SRE/day53/119.jpg" alt="119"><br><img src="../../../../images/SRE/day53/120.jpg" alt="120"></p>
<p>编辑用户信息，修改密码</p>
<p><img src="../../../../images/SRE/day53/121.jpg" alt="121"></p>
<p><img src="../../../../images/SRE/day53/122.jpg" alt="122"></p>
<p>创建用户成功后，如果用户邮箱正常，也会收到下面邮件</p>
<p><img src="../../../../images/SRE/day53/123.jpg" alt="123"></p>
<p>点上面的链接重设密码</p>
<p><img src="../../../../images/SRE/day53/124.jpg" alt="124"></p>
<p>登录成功，并且收到邮件</p>
<p><img src="../../../../images/SRE/day53/125.jpg" alt="125"></p>
<p>同样的方式再创建其他用户</p>
<p><img src="../../../../images/SRE/day53/126.jpg" alt="126"></p>
<p><strong>旧版界面</strong></p>
<p><img src="../../../../images/SRE/day53/127.jpg" alt="127"></p>
<p>如下图，填写用户信息</p>
<p><img src="../../../../images/SRE/day53/128.jpg" alt="128"></p>
<p>登录邮箱，可以看到注册邮件</p>
<p><img src="../../../../images/SRE/day53/129.jpg" alt="129"></p>
<p><strong>使用第一次使用新账号登录要设置密码：</strong></p>
<p><img src="../../../../images/SRE/day53/130.jpg" alt="130"><br><img src="../../../../images/SRE/day53/131.jpg" alt="131"></p>
<p>修改密码后，会收到修改密码的邮件</p>
<p><img src="../../../../images/SRE/day53/132.jpg" alt="132"></p>
<h3 id="创建组"><a href="#创建组" class="headerlink" title="创建组"></a>创建组</h3><p>使用管理员root 或用户都可以创建group组</p>
<p>一个group组里面可以拥有多个project项目分支，可以将开发的用户添加到组里，再进行设置权限</p>
<p>不同的组对应公司不同的开发项目或者服务模块</p>
<p>如果gitlab使用者的组织规模较大，每一个group组可以分别对应一个组织，如:某个分公司或部门</p>
<p>如果gitlab使用者的组织规模较小， 每一个group组也可以对应一个项目或业务</p>
<p>不同的组中添加不同的开发人员帐号，即可实现对开发者实现权限的管理。</p>
<p><strong>新版界面</strong></p>
<p><img src="../../../../images/SRE/day53/133.jpg" alt="133"></p>
<p>基于安全，选择private</p>
<p><img src="../../../../images/SRE/day53/134.jpg" alt="134"></p>
<p><strong>旧版界面</strong></p>
<p><img src="../../../../images/SRE/day53/135.jpg" alt="135"></p>
<h2 id="GitLab-项目管理"><a href="#GitLab-项目管理" class="headerlink" title="GitLab 项目管理"></a>GitLab 项目管理</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p><img src="../../../../images/SRE/day53/136.jpg" alt="136"></p>
<p><strong>新版界面</strong></p>
<p><img src="../../../../images/SRE/day53/137.jpg" alt="137"></p>
<p>创建项目，指定项目属于组，并选择不进行初始化项目仓库</p>
<p><img src="../../../../images/SRE/day53/138.jpg" alt="138"><br><img src="../../../../images/SRE/day53/139.jpg" alt="139"></p>
<p>命令行指引</p>
<p>您还可以按照以下说明从计算机中上传现有文件。</p>
<p><strong>Git 全局设置</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;Administrator&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;admin@example.com&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>创建一个新仓库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> http://gitlab.wang.org/dev/meta.git</span><br><span class="line"><span class="built_in">cd</span> meta</span><br><span class="line">git switch -c main</span><br><span class="line"><span class="built_in">touch</span> README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">&quot;add README&quot;</span></span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

<p><strong>推送现有文件夹</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> existing_folder</span><br><span class="line">git init --initial-branch=main</span><br><span class="line">git remote add origin http://gitlab.wang.org/dev/meta.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;Initial commit&quot;</span></span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

<p><strong>推送现有的 Git 仓库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> existing_repo</span><br><span class="line">git remote rename origin old-origin</span><br><span class="line">git remote add origin http://gitlab.wang.org/dev/meta.git</span><br><span class="line">git push -u origin --all</span><br><span class="line">git push -u origin --tags</span><br></pre></td></tr></table></figure>

<p><strong>旧版界面</strong></p>
<p><img src="../../../../images/SRE/day53/140.jpg" alt="140"></p>
<p>使用管理员创建项目：</p>
<p><img src="../../../../images/SRE/day53/141.jpg" alt="141"></p>
<p>创建后的项目效果：</p>
<p><img src="../../../../images/SRE/day53/142.jpg" alt="142"></p>
<h3 id="将用户添加到组或项目"><a href="#将用户添加到组或项目" class="headerlink" title="将用户添加到组或项目"></a>将用户添加到组或项目</h3><p>将用户添加到组或项目中，并指定不同的角色，可以获取不同的权限</p>
<p>角色和权限官方帮助</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ce/user/permissions.html</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/143.jpg" alt="143"></p>
<p><strong>Gitlab用户在组里面有5种不同权限:</strong></p>
<ul>
<li>Guest: 可以创建issue、发表评论，不能读写版本库</li>
<li>Reporter:可以克隆代码，不能提交，QA、PM可以赋予这个权限</li>
<li>Developer:可以克隆代码、开发、提交、 push(非保护分支Protected branches)，普通开发可以赋予这个权限</li>
<li>Maintainer:可以创建项目、添加tag、保护分支、添加项目成员、编辑项目，核心开发人员可以赋予这个权限</li>
<li>Owner:可以设置项目访问权限Visibility Level、删除项目、迁移项目、管理组成员，开发组组长可以赋予这个权限</li>
</ul>
<p>在组中添加用户并指定角色</p>
<p><img src="../../../../images/SRE/day53/144.jpg" alt="144"></p>
<p>注意: 设为maintainer角色才能push代码,developer角色(对保护分支，如master)只能pull不能push</p>
<p><img src="../../../../images/SRE/day53/145.jpg" alt="145"><br><img src="../../../../images/SRE/day53/146.jpg" alt="146"></p>
<p>或者在项目中添加用户进行角色指定，此方式后续管理不太方便，不建议加用户到项目，建议将用户加入组中</p>
<p><img src="../../../../images/SRE/day53/147.jpg" alt="147"></p>
<p><strong>旧版界面</strong></p>
<p><img src="../../../../images/SRE/day53/148.jpg" alt="148"><br><img src="../../../../images/SRE/day53/149.jpg" alt="149"></p>
<h3 id="使用项目"><a href="#使用项目" class="headerlink" title="使用项目"></a>使用项目</h3><h4 id="在项目中新建一个测试页面"><a href="#在项目中新建一个测试页面" class="headerlink" title="在项目中新建一个测试页面"></a>在项目中新建一个测试页面</h4><p>用上面创建的用户wang登录，找到项目界面，在项目中新建文件</p>
<p><img src="../../../../images/SRE/day53/150.jpg" alt="150"><br><img src="../../../../images/SRE/day53/151.jpg" alt="151"></p>
<p>旧版界面</p>
<p><img src="../../../../images/SRE/day53/152.jpg" alt="152"></p>
<p>填写READE.md文件内容</p>
<p><img src="../../../../images/SRE/day53/153.jpg" alt="153"></p>
<p>新建项目文件</p>
<p><img src="../../../../images/SRE/day53/154.jpg" alt="154"><br><img src="../../../../images/SRE/day53/155.jpg" alt="155"></p>
<h4 id="在linux客户端测试clone和提交项目"><a href="#在linux客户端测试clone和提交项目" class="headerlink" title="在linux客户端测试clone和提交项目"></a>在linux客户端测试clone和提交项目</h4><p><img src="../../../../images/SRE/day53/156.jpg" alt="156"></p>
<p>命令行指引</p>
<p>您还可以按照以下说明从计算机中上传现有文件。</p>
<p><strong>Git 全局设置</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;Administrator&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;admin@example.com&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>创建一个新仓库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> http://gitlab.wang.org/dev/meta.git</span><br><span class="line"><span class="built_in">cd</span> meta</span><br><span class="line">git switch -c main</span><br><span class="line"><span class="built_in">touch</span> README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">&quot;add README&quot;</span></span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

<p><strong>推送现有文件夹</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> existing_folder</span><br><span class="line">git init --initial-branch=main</span><br><span class="line">git remote add origin http://gitlab.wang.org/dev/meta.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;Initial commit&quot;</span></span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

<p><strong>推送现有的 Git 仓库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> existing_repo</span><br><span class="line">git remote rename origin old-origin</span><br><span class="line">git remote add origin http://gitlab.wang.org/dev/meta.git</span><br><span class="line">git push -u origin --all</span><br><span class="line">git push -u origin --tags</span><br></pre></td></tr></table></figure>

<p>根据不同的情况，在另一台主机上执行下面操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># cd /data</span></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># ls</span></span><br><span class="line">lost+found</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># git clone http://gitlab.wang.org/testgroup/testproject.git</span></span><br><span class="line">Cloning into <span class="string">&#x27;testproject&#x27;</span>...</span><br><span class="line">Username <span class="keyword">for</span> <span class="string">&#x27;http://10.0.0.100&#x27;</span>: wang</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">&#x27;http://wang@10.0.0.100&#x27;</span>:</span><br><span class="line">remote: Enumerating objects: 6, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (6/6), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 6 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (6/6), <span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># ls -a</span></span><br><span class="line">. .. lost+found testproject</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># tree testproject/</span></span><br><span class="line">testproject/</span><br><span class="line">├── index.html</span><br><span class="line">└── README.md</span><br><span class="line"></span><br><span class="line">0 directories, 2 files</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置用户名和邮箱</span></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># git config --global user.name &quot;wangxiaochun&quot;</span></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># git config --global user.email &quot;root@wangxiaochun.com&quot;</span></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># cat ~/.gitconfig</span></span><br><span class="line">[user]</span><br><span class="line">       name = wangxiaochun</span><br><span class="line">       email = root@wangxiaochun.com</span><br><span class="line">       </span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># vim testproject/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改项目文件</span></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># vim testproject/index.html</span></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># cat testproject/index.html</span></span><br><span class="line">&lt;h1&gt;index.html v1 &lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;index.html v2 &lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 data]<span class="comment"># cd testproject/</span></span><br><span class="line">[root@ubuntu1804 testproject]<span class="comment"># git add .</span></span><br><span class="line">[root@ubuntu1804 testproject]<span class="comment"># git commit -m &quot;v2&quot;</span></span><br><span class="line">[master 44dbd92] v2</span><br><span class="line">1 file changed, 2 insertions(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 testproject]<span class="comment"># git push</span></span><br><span class="line">Username <span class="keyword">for</span> <span class="string">&#x27;http://10.0.0.100&#x27;</span>: wang</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">&#x27;http://wang@10.0.0.100&#x27;</span>:</span><br><span class="line">Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 296 bytes | 296.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To http://10.0.0.100/testgroup/testproject.git</span><br><span class="line">   928e057..44dbd92 master -&gt; master</span><br></pre></td></tr></table></figure>

<h4 id="在windows-安装-git-客户端测试clone和提交项目"><a href="#在windows-安装-git-客户端测试clone和提交项目" class="headerlink" title="在windows 安装 git 客户端测试clone和提交项目"></a>在windows 安装 git 客户端测试clone和提交项目</h4><p>官网下载链接:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://git-scm.com/download/win</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/157.jpg" alt="157"><br><img src="../../../../images/SRE/day53/158.jpg" alt="158"><br><img src="../../../../images/SRE/day53/159.jpg" alt="159"></p>
<h4 id="Web端验证数据"><a href="#Web端验证数据" class="headerlink" title="Web端验证数据"></a>Web端验证数据</h4><p><img src="../../../../images/SRE/day53/160.jpg" alt="160"><br><img src="../../../../images/SRE/day53/161.jpg" alt="161"></p>
<h4 id="实现-ssh-基于key验证的-git-访问"><a href="#实现-ssh-基于key验证的-git-访问" class="headerlink" title="实现 ssh 基于key验证的 git 访问"></a>实现 ssh 基于key验证的 git 访问</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># ssh-keygen </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># cat .ssh/id_rsa.pub </span></span><br><span class="line">ssh-rsa </span><br><span class="line">AAAAB3NzaC1yc2EAAAADAQABAAABgQDQerYDHH/IWvYfIzCiIvp9oHzCNVepAOcP37M3cmhz0NFnN655</span><br><span class="line">cA66lp5j00qCOfjh9DFq4RNMUiL9XvqQ/Q4N7/ZLoUlVO2L3XPTTmwLtKg3snGExn0owj4B49wi5BTjs</span><br><span class="line">wo9HOmf3Qh7KGHKO9VlG0O+/QFU8W1nySrPJvdi5mQaofqyXXMMsK2lIFgdDH0QhZcY3IkpC63BEhfgb</span><br><span class="line">vnhlXjVjwepu8lcJYWU8We30XOm6j6/dIjdP+AzamdiIntj/Oby5P0yuN/kNYjQvsbiaw1nO8z+Z/cqA</span><br><span class="line">4e2pmmA7sHwUIqUve5RL7+DDue71sL7aODWQjcgOkRj5BYSNWcavF1hispfQIhakz9pdROhB90wXVcyr</span><br><span class="line">RehnHK73IMGc+abu0/9oz8e58LyEaRdSaQ6nRywcso/rmX1aoH/KTFmRe42O+pOeri1KzbSfrrTIQmma</span><br><span class="line">0wF9k1YQEoTI0fpQpyvGWM5nGtEm7W+iG0zPiMaDzAzGcetu8AkJyFy37GwuDL8=</span><br><span class="line">root@centos8.wang.org</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/162.jpg" alt="162"><br><img src="../../../../images/SRE/day53/163.jpg" alt="163"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cd /opt</span></span><br><span class="line">[root@centos8 opt]<span class="comment"># ls</span></span><br><span class="line">[root@centos8 opt]<span class="comment"># git clone git@10.0.0.100:testgroup/testproject.git</span></span><br><span class="line">Cloning into <span class="string">&#x27;testproject&#x27;</span>...</span><br><span class="line">The authenticity of host <span class="string">&#x27;10.0.0.100 (10.0.0.100)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:SCZC/wgETlcNAvmd1gaG8Tvb4sR53VzbaX1MHKi9GLY.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>10.0.0.100<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">remote: Enumerating objects: 6, done.</span></span><br><span class="line"><span class="string">remote: Counting objects: 100% (3/3), done.</span></span><br><span class="line"><span class="string">remote: Compressing objects: 100% (2/2), done.</span></span><br><span class="line"><span class="string">remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 3</span></span><br><span class="line"><span class="string">Receiving objects: 100% (6/6), done.</span></span><br></pre></td></tr></table></figure>

<h4 id="保护分支"><a href="#保护分支" class="headerlink" title="保护分支"></a>保护分支</h4><p>默认master 分支被保护，开发者角色无法对被保护的分支提交代码</p>
<p>也可以将其它分支进行保护，防止指定分支被破环</p>
<p><img src="../../../../images/SRE/day53/164.jpg" alt="164"></p>
<h4 id="合并分支"><a href="#合并分支" class="headerlink" title="合并分支"></a>合并分支</h4><p>由于普通开发者无法直接提交代码至master分支</p>
<p>可以先创建其它分支如dev,再提交代码到dev分支</p>
<p>接下来申请将dev 分支合并至master分支</p>
<p>管理者收到请求，经过审核没有问题进行批准合并</p>
<p>最终实现 master 代码的更新</p>
<p><img src="../../../../images/SRE/day53/165.jpg" alt="165"><br><img src="../../../../images/SRE/day53/166.jpg" alt="166"></p>
<p><img src="../../../../images/SRE/day53/167.jpg" alt="167"><br><img src="../../../../images/SRE/day53/168.jpg" alt="168"></p>
<h2 id="GitLab-的数据备份和恢复"><a href="#GitLab-的数据备份和恢复" class="headerlink" title="GitLab 的数据备份和恢复"></a>GitLab 的数据备份和恢复</h2><p>数据备份和恢复官方帮助：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ee/raketasks/backup_restore.html</span><br></pre></td></tr></table></figure>

<h3 id="备份相关配置文件"><a href="#备份相关配置文件" class="headerlink" title="备份相关配置文件"></a>备份相关配置文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/gitlab/gitlab.rb</span><br><span class="line">/etc/gitlab/gitlab-secrets.json <span class="comment">#双因子验证等使用此文件</span></span><br></pre></td></tr></table></figure>

<p>备份配置文件命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl backup-etc --backup-path &lt;DIRECTORY&gt;</span><br><span class="line"><span class="comment">#如果不指定--backup-path &lt;DIRECTORY&gt;，则默认备份至/etc/gitlab/config_backup/</span></span><br></pre></td></tr></table></figure>

<p>范例：备份配置文件命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl backup-etc</span></span><br><span class="line">Could not find <span class="string">&#x27;/etc/gitlab/config_backup&#x27;</span> directory. Creating.</span><br><span class="line">Running configuration backup</span><br><span class="line">Creating configuration backup archive: gitlab_config_1627267534_2021_07_26.tar</span><br><span class="line">/etc/gitlab/</span><br><span class="line">/etc/gitlab/gitlab.rb</span><br><span class="line">/etc/gitlab/gitlab-secrets.json</span><br><span class="line">/etc/gitlab/trusted-certs/</span><br><span class="line">Configuration backup archive complete: </span><br><span class="line">/etc/gitlab/config_backup/gitlab_config_1627267534_2021_07_26.tar</span><br><span class="line">Keeping all older configuration backups</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># ls /etc/gitlab/config_backup/</span></span><br><span class="line">gitlab_config_1627267534_2021_07_26.tar</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># tar tvf /etc/gitlab/config_backup/gitlab_config_1627267534_2021_07_26.tar </span></span><br><span class="line">tar: Removing leading `/<span class="string">&#x27; from member names</span></span><br><span class="line"><span class="string">drwxrwxr-x root/root         0 2021-07-26 10:45 /etc/gitlab/</span></span><br><span class="line"><span class="string">-rw------- root/root    121857 2021-07-26 09:36 /etc/gitlab/gitlab.rb</span></span><br><span class="line"><span class="string">-rw------- root/root     19021 2021-07-26 09:40 /etc/gitlab/gitlab-secrets.json</span></span><br><span class="line"><span class="string">drwxr-xr-x root/root         0 2021-07-26 09:37 /etc/gitlab/trusted-certs/</span></span><br></pre></td></tr></table></figure>

<h3 id="手动备份数据"><a href="#手动备份数据" class="headerlink" title="手动备份数据"></a>手动备份数据</h3><p>不同版本的备份数据命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#GitLab 12.2之后版本</span></span><br><span class="line">gitlab-backup create</span><br><span class="line"></span><br><span class="line"><span class="comment">#GitLab 12.1之前版本</span></span><br><span class="line">gitlab-rake gitlab:backup:create</span><br></pre></td></tr></table></figure>

<p>备份相关配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认在/etc/gitlab/gitlab.rb文件中指定备份路径，如果目录空间不足，可以修改新的目录</span></span><br><span class="line"><span class="comment">#注意：修改完配置需要执行gitlab-ctl reconfigure</span></span><br><span class="line"><span class="comment"># gitlab_rails[&#x27;backup_path&#x27;] = &quot;/var/opt/gitlab/backups&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#备份的文件权限，所有者和所属组为git</span></span><br><span class="line"><span class="comment"># gitlab_rails[&#x27;backup_archive_permissions&#x27;] = 0644</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#默认备份过期时长为7天，单位为s, 之后会被自动删除</span></span><br><span class="line"><span class="comment"># gitlab_rails[&#x27;backup_keep_time&#x27;] = 604800</span></span><br></pre></td></tr></table></figure>

<p>范例：新版备份</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-backup create</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#默认备份保存在下面目录</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># ll /var/opt/gitlab/backups/</span></span><br><span class="line">-rw-------  1 git  git  307200 Jul 26 11:02 </span><br><span class="line">1627268555_2021_07_26_14.1.0_gitlab_backup.tar</span><br></pre></td></tr></table></figure>

<p>范例： 旧版备份数据</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在任意目录即可备份当前gitlab数据</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-rake gitlab:backup:create</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment">#ll /var/opt/gitlab/backups/</span></span><br><span class="line">-rw-------  1 git git 102400 Mar  7 14:34 </span><br><span class="line">1583562898_2020_03_07_11.11.8_gitlab_backup.tar</span><br></pre></td></tr></table></figure>

<h3 id="模拟删除项目"><a href="#模拟删除项目" class="headerlink" title="模拟删除项目"></a>模拟删除项目</h3><p><img src="../../../../images/SRE/day53/169.jpg" alt="169"><br><img src="../../../../images/SRE/day53/170.jpg" alt="170"><br><img src="../../../../images/SRE/day53/171.jpg" alt="171"></p>
<h3 id="执行恢复"><a href="#执行恢复" class="headerlink" title="执行恢复"></a>执行恢复</h3><p>恢复的前提条件</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">备份和恢复使用的版本要一致</span><br><span class="line">还原相关配置文件后，执行gitlab-ctl reconfigure </span><br><span class="line">确保gitlab正在运行状态</span><br></pre></td></tr></table></figure>

<p><strong>新版恢复方法</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#恢复前先停止两个服务</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl stop puma</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl stop sidekiq</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#恢复时指定备份文件的时间部分，不需要指定文件的全名</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-backup restore BACKUP=备份文件名的时间部分</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-backup restore BACKUP=1583562898_2020_03_07_11.11.8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Next, restore /etc/gitlab/gitlab-secrets.json if necessary, as previously mentioned.Reconfigure, restart and check GitLab:</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl restart</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#后续检查可选做</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-rake gitlab:check SANITIZE=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#In GitLab 13.1 and later, check database values can be decrypted especially if /etc/gitlab/gitlab-secrets.json was restored, or if a different server is the target for the restore.</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-rake gitlab:doctor:secrets</span></span><br></pre></td></tr></table></figure>

<p><strong>旧版恢复方法</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#恢复前先停止两个服务</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl stop unicorn</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl stop sidekiq </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#恢复时指定备份文件的时间部分，不需要指定文件的全名</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-rake gitlab:backup:restore BACKUP=备份文件名的时间部分</span></span><br></pre></td></tr></table></figure>

<p><strong>范例：新版恢复过程</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl stop puma</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl stop sidekiq</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl status</span></span><br><span class="line">run: alertmanager: (pid 886) 486s; run: <span class="built_in">log</span>: (pid 863) 486s</span><br><span class="line">run: gitaly: (pid 916) 485s; run: <span class="built_in">log</span>: (pid 872) 486s</span><br><span class="line">run: gitlab-exporter: (pid 888) 486s; run: <span class="built_in">log</span>: (pid 857) 486s</span><br><span class="line">run: gitlab-workhorse: (pid 909) 485s; run: <span class="built_in">log</span>: (pid 865) 486s</span><br><span class="line">run: grafana: (pid 908) 485s; run: <span class="built_in">log</span>: (pid 871) 486s</span><br><span class="line">run: logrotate: (pid 910) 485s; run: <span class="built_in">log</span>: (pid 864) 486s</span><br><span class="line">run: nginx: (pid 905) 485s; run: <span class="built_in">log</span>: (pid 884) 486s</span><br><span class="line">run: node-exporter: (pid 885) 486s; run: <span class="built_in">log</span>: (pid 882) 486s</span><br><span class="line">run: postgres-exporter: (pid 906) 485s; run: <span class="built_in">log</span>: (pid 880) 486s</span><br><span class="line">run: postgresql: (pid 917) 485s; run: <span class="built_in">log</span>: (pid 878) 486s</span><br><span class="line">run: prometheus: (pid 887) 486s; run: <span class="built_in">log</span>: (pid 858) 486s</span><br><span class="line">down: puma: 386s, normally up; run: <span class="built_in">log</span>: (pid 879) 486s</span><br><span class="line">run: redis: (pid 915) 485s; run: <span class="built_in">log</span>: (pid 883) 486s</span><br><span class="line">run: redis-exporter: (pid 907) 485s; run: <span class="built_in">log</span>: (pid 870) 486s</span><br><span class="line">down: sidekiq: 379s, normally up; run: <span class="built_in">log</span>: (pid 881) 486s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#确保备份的版本名称</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># ll /var/opt/gitlab/backups/1627268555_2021_07_26_14.1.0_gitlab_backup.tar </span></span><br><span class="line">-rw------- 1 git git 307200 Jul 26 11:02 /var/opt/gitlab/backups/1627268555_2021_07_26_14.1.0_gitlab_backup.tar</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：备份文件所有目录及权限属性，无需指定完整文件名</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-backup restore BACKUP=1627268555_2021_07_26_14.1.0</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl restart</span></span><br><span class="line">ok: run: alertmanager: (pid 1853) 1s</span><br><span class="line">ok: run: gitaly: (pid 1861) 1s</span><br><span class="line">ok: run: gitlab-exporter: (pid 1883) 0s</span><br><span class="line">ok: run: gitlab-workhorse: (pid 1885) 0s</span><br><span class="line">ok: run: grafana: (pid 1893) 1s</span><br><span class="line">ok: run: logrotate: (pid 1903) 0s</span><br><span class="line">ok: run: nginx: (pid 1909) 1s</span><br><span class="line">ok: run: node-exporter: (pid 1991) 0s</span><br><span class="line">ok: run: postgres-exporter: (pid 1997) 0s</span><br><span class="line">ok: run: postgresql: (pid 2006) 0s</span><br><span class="line">ok: run: prometheus: (pid 2015) 1s</span><br><span class="line">ok: run: puma: (pid 2023) 0s</span><br><span class="line">ok: run: redis: (pid 2029) 1s</span><br><span class="line">ok: run: redis-exporter: (pid 2035) 0s</span><br><span class="line">ok: run: sidekiq: (pid 2041) 0s</span><br><span class="line"></span><br><span class="line"><span class="comment">#观察日志，等待恢复完成，需要再等一会儿再验证是否恢复</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl tail</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/172.jpg" alt="172"></p>
<p><strong>范例：旧版恢复过程</strong></p>
<p><img src="../../../../images/SRE/day53/173.jpg" alt="173"></p>
<p>确认恢复数据：</p>
<p><img src="../../../../images/SRE/day53/174.jpg" alt="174"></p>
<p>恢复后再将之前停止的两个服务启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl start sidekiq</span></span><br><span class="line">ok: run: sidekiq: (pid 16859) 0s</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl start unicorn</span></span><br><span class="line">ok: run: unicorn: (pid 16882) 1s</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者执行下面也可以</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># gitlab-ctl restart</span></span><br></pre></td></tr></table></figure>

<h3 id="确保还原完成"><a href="#确保还原完成" class="headerlink" title="确保还原完成"></a>确保还原完成</h3><p>恢复后，项目及用户信息都已还原</p>
<p><strong>注意：可能需要等一段时间才能打开浏览器进行访问</strong></p>
<p><img src="../../../../images/SRE/day53/175.jpg" alt="175"></p>
<h2 id="GitLab-迁移和升级"><a href="#GitLab-迁移和升级" class="headerlink" title="GitLab 迁移和升级"></a>GitLab 迁移和升级</h2><p>在生产中升级往往伴随着服务器的迁移，比如从本地机房迁移到云环境中，而实现升级</p>
<p>迁移流程</p>
<ul>
<li>在原GitLab主机上备份配置文件和数据</li>
<li>在目标主机上安装相同的版本的GitLab软件</li>
<li>还原配置和数据</li>
<li>本质上就是备份和恢复的过程</li>
</ul>
<p>升级流程</p>
<ul>
<li><p>如果新主机，需要先安装原版本，并还原配置和数据</p>
</li>
<li><p>不能直接跳过中间的版本直接升级，选择最近的大版本进行升级</p>
<p>比如:12.1想升级到13.0,先升级到12.X最高版，再升级到13.0.</p>
</li>
<li><p>下载新版本的安装包，直接安装包</p>
</li>
<li><p>安装包时可能会提示出错，原因是版本升级后有些配置项会过时，根据提示修改配置即可</p>
</li>
<li><p>重新配置: gitlab-ctl reconfigure</p>
</li>
<li><p>重启服务: gitlab-ctl restart</p>
</li>
</ul>
<h2 id="实现-Https"><a href="#实现-Https" class="headerlink" title="实现 Https"></a>实现 Https</h2><p>GitLab 如果用于不安全的网络，建议使用 https</p>
<p>官方说明</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/omnibus/settings/nginx.html#enable-https</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建证书</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># mkdir -p /etc/gitlab/ssl; cd /etc/gitlab/ssl</span></span><br><span class="line">[root@gitlab ssl]<span class="comment"># openssl genrsa -out gitlab.wang.org.key 2048</span></span><br><span class="line">[root@gitlab ssl]<span class="comment"># openssl req -days 3650 -x509 \</span></span><br><span class="line">-sha256 -nodes -newkey rsa:2048 -keyout gitlab.wang.org.key -out gitlab.wang.org.crt</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/gitlab/gitlab.rb</span></span><br><span class="line">external_url <span class="string">&quot;https://gitlab.example.com&quot;</span> <span class="comment">#此项必须修改为https</span></span><br><span class="line">nginx[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">nginx[<span class="string">&#x27;client_max_body_size&#x27;</span>] = <span class="string">&#x27;1000m&#x27;</span></span><br><span class="line">nginx[<span class="string">&#x27;redirect_http_to_https&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">nginx[<span class="string">&#x27;redirect_http_to_https_port&#x27;</span>] = 80 <span class="comment"># 所有请求80的都跳转到443</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_certificate&#x27;</span>] =<span class="string">&quot;/etc/gitlab/ssl/gitlab.wang.org.crt&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_certificate_key&#x27;</span>] =<span class="string">&quot;/etc/gitlab/ssl/gitlab.wang.org.key&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_ciphers&#x27;</span>] = <span class="string">&quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_prefer_server_ciphers&#x27;</span>] = <span class="string">&quot;on&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_protocols&#x27;</span>] = <span class="string">&quot;TLSv1.2&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_session_cache&#x27;</span>] = <span class="string">&quot;shared:SSL:10m&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_session_timeout&#x27;</span>] = <span class="string">&quot;1440m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新初始化</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl status</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#还登录原来的URL,会自动跳转到 https</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day53/176.jpg" alt="176"><br><img src="../../../../images/SRE/day53/177.jpg" alt="177"><br><img src="../../../../images/SRE/day53/178.jpg" alt="178"></p>
<h2 id="找回-GitLab-忘记的密码"><a href="#找回-GitLab-忘记的密码" class="headerlink" title="找回 GitLab 忘记的密码"></a>找回 GitLab 忘记的密码</h2><p>官方说明</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.gitlab.com/ee/security/reset_user_password.html#reset-the-root-password</span><br></pre></td></tr></table></figure>

<p>注意：新版用户密码至少8位且符合复杂度才有效</p>
<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-rails console -e production</span></span><br><span class="line"><span class="comment">#此步可能比较慢，需要等一段时间</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"> Ruby:         ruby 2.7.5p203 (2021-11-24 revision f69aeb8314) [x86_64-linux]</span><br><span class="line"> GitLab:       15.1.2 (ea7455c8292) FOSS</span><br><span class="line"> GitLab Shell: 14.7.4</span><br><span class="line"> PostgreSQL:   13.6</span><br><span class="line">------------------------------------------------------------[ booted <span class="keyword">in</span> 23.59s ]</span><br><span class="line">Loading production environment (Rails 6.1.4.7)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输入下面指令</span></span><br><span class="line">irb(main):001:0&gt; user = User.<span class="built_in">where</span>(<span class="built_in">id</span>: 1).first</span><br><span class="line">=&gt; <span class="comment">#&lt;User id:1 @root&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更改密码并确认密码</span></span><br><span class="line">irb(main):002:0&gt; user.password=<span class="string">&quot;wang2020&quot;</span></span><br><span class="line">=&gt; <span class="string">&quot;wangwang2020&quot;</span></span><br><span class="line"></span><br><span class="line">irb(main):003:0&gt; user.password_confirmation=<span class="string">&quot;wang2020&quot;</span></span><br><span class="line">=&gt; <span class="string">&quot;wangwang2020&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#保存</span></span><br><span class="line">irb(main):004:0&gt; user.save</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#退出控制台</span></span><br><span class="line">irb(main):005:0&gt; quit</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证用新密码登录</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/04/24/SRE-git/">http://example.com/2025/04/24/SRE-git/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Git/">Git</a><a class="post-meta__tags" href="/tags/Gitlab/">Gitlab</a><a class="post-meta__tags" href="/tags/SRE/">SRE</a></div><div class="post_share"><div class="social-share" data-image="/../images/SRE/day53/77.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/04/21/SRE-kafka/" title="消息队列和微服务"><img class="cover" src="/../images/SRE/day52/30.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">消息队列和微服务</div></div></a></div><div class="next-post pull-right"><a href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins"><img class="cover" src="/../images/SRE/day55/1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">DevOps之CICD工具Jenkins</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/04/03/DN-Git/" title="Git"><img class="cover" src="/../images/TITLE/git.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-03</div><div class="title">Git</div></div></a></div><div><a href="/2023/06/12/DN-Gitlab/" title="Gitlab"><img class="cover" src="/../images/TITLE/gitlab.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-12</div><div class="title">Gitlab</div></div></a></div><div><a href="/2025/04/15/SRE-HAProxy/" title="高可用性集群HAProxy"><img class="cover" src="/../images/SRE/day47/1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-15</div><div class="title">高可用性集群HAProxy</div></div></a></div><div><a href="/2025/04/16/SRE-Keepalived/" title="高可用性集群Keepalived"><img class="cover" src="/../images/SRE/day48/1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-16</div><div class="title">高可用性集群Keepalived</div></div></a></div><div><a href="/2025/02/21/SRE-LVS/" title="企业级调度器LVS"><img class="cover" src="/../images/SRE/day27/3.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-21</div><div class="title">企业级调度器LVS</div></div></a></div><div><a href="/2024/04/24/SRE-Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%92%8C%E5%B8%AE%E5%8A%A9/" title="Linux基本操作和帮助"><img class="cover" src="/../images/TITLE/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="title">Linux基本操作和帮助</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/TITLE/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">103</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">35</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DevOps-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">DevOps 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">传统开发模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">软件开发生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%80%91%E5%B8%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">瀑布模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91"><span class="toc-number">1.1.3.</span> <span class="toc-text">敏捷开发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DevOps-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">DevOps 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-DevOps"><span class="toc-number">1.2.1.</span> <span class="toc-text">什么是 DevOps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81-DevOps"><span class="toc-number">1.2.2.</span> <span class="toc-text">为什么要 DevOps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DevOps-%E7%9B%B8%E5%85%B3%E7%9A%84%E8%BD%AF%E4%BB%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">DevOps 相关的软件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E3%80%81%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98%E5%92%8C%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2-CICD"><span class="toc-number">1.3.</span> <span class="toc-text">持续集成、持续交付和持续部署 CICD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90-CI-Continuous-Integration"><span class="toc-number">1.3.1.</span> <span class="toc-text">持续集成 (CI-Continuous Integration)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98-CD-Continuous-Delivery"><span class="toc-number">1.3.2.</span> <span class="toc-text">持续交付(CD-Continuous Delivery)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2-CD-Continuous-Deployment"><span class="toc-number">1.3.3.</span> <span class="toc-text">持续部署(CD-Continuous Deployment)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CICD-%E6%B5%81%E7%A8%8B%E8%BF%87%E7%A8%8B%E5%92%8C%E6%9E%B6%E6%9E%84"><span class="toc-number">1.4.</span> <span class="toc-text">CICD 流程过程和架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B1%95%E9%98%B6%E6%AE%B5"><span class="toc-number">1.4.1.</span> <span class="toc-text">应用部署发展阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CICD-%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-number">1.4.2.</span> <span class="toc-text">CICD 相关工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CICD-%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">CICD 流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes-%E7%8E%AF%E5%A2%83%E7%9A%84-CICD"><span class="toc-number">1.4.4.</span> <span class="toc-text">Kubernetes 环境的 CICD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CICD-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E6%9E%84"><span class="toc-number">1.4.5.</span> <span class="toc-text">CICD 服务器架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DevOps-%E4%B8%8E-CICD-%E7%9A%84%E8%81%94%E7%B3%BB%E4%B8%8E%E5%8C%BA%E5%88%AB"><span class="toc-number">1.4.6.</span> <span class="toc-text">DevOps 与 CICD 的联系与区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F-VCS"><span class="toc-number">1.5.</span> <span class="toc-text">版本控制系统 VCS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.1.</span> <span class="toc-text">版本控制系统分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.2.</span> <span class="toc-text">常见的版本控制系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CVS-Concurrent-Version-System-%E9%9B%86%E4%B8%AD%E5%BC%8F%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">CVS(Concurrent Version System) 集中式版本控制系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SVN-Subversion-%E9%9B%86%E4%B8%AD%E5%BC%8F%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">SVN(Subversion) 集中式版本控制系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">Git</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Github-%E7%BD%91%E7%AB%99"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">Github 网站</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GitLab-%E7%BD%91%E7%AB%99%E5%92%8C%E8%BD%AF%E4%BB%B6"><span class="toc-number">1.5.2.5.</span> <span class="toc-text">GitLab 网站和软件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AF%E4%BB%B6%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">常见的软件部署模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2-Blue-green-Deployments"><span class="toc-number">1.6.1.</span> <span class="toc-text">蓝绿部署 Blue-green Deployments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%91%E4%B8%9D%E9%9B%80-%E7%81%B0%E5%BA%A6-%E5%8F%91%E5%B8%83-Canary-Deployment"><span class="toc-number">1.6.2.</span> <span class="toc-text">金丝雀(灰度)发布 Canary Deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BB%9A%E5%8A%A8%E5%8F%91%E5%B8%83-%E6%9B%B4%E6%96%B0"><span class="toc-number">1.6.3.</span> <span class="toc-text">滚动发布(更新)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-B%E6%B5%8B%E8%AF%95-A-B-Testing"><span class="toc-number">1.6.4.</span> <span class="toc-text">A&#x2F;B测试 A&#x2F;B Testing</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F-Git"><span class="toc-number">2.</span> <span class="toc-text">版本控制系统 Git</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%BF%9D%E5%AD%98%E6%96%B9%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">数据保存方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%92%8C%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.</span> <span class="toc-text">Git 相关概念和原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E7%9A%84%E5%8C%BA%E5%9F%9F"><span class="toc-number">2.2.1.</span> <span class="toc-text">Git 的区域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E6%96%87%E4%BB%B6%E7%9A%84%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96%E5%91%A8%E6%9C%9F"><span class="toc-number">2.2.2.</span> <span class="toc-text">Git 文件的状态变化周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2%E5%92%8C%E6%8F%90%E4%BA%A4%E9%93%BE"><span class="toc-number">2.2.3.</span> <span class="toc-text">Git 提交历史和提交链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E5%88%86%E6%94%AF%E5%92%8C%E6%A0%87%E7%AD%BE"><span class="toc-number">2.2.4.</span> <span class="toc-text">Git 分支和标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E5%BC%80%E5%8F%91%E5%88%86%E6%94%AF%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.5.</span> <span class="toc-text">Git 开发分支流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="toc-number">2.2.6.</span> <span class="toc-text">Git 使用远程仓库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">Git 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-%E5%AE%89%E8%A3%85-git"><span class="toc-number">2.3.1.</span> <span class="toc-text">Linux 安装 git</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">二进制包安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">源码编译安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E5%AE%89%E8%A3%85-git"><span class="toc-number">2.3.2.</span> <span class="toc-text">Windows 安装 git</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mac-%E5%AE%89%E8%A3%85-git"><span class="toc-number">2.3.3.</span> <span class="toc-text">Mac 安装 git</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="toc-number">2.4.</span> <span class="toc-text">Git 常用语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E7%94%A8%E6%B3%95%E8%AF%B4%E6%98%8E"><span class="toc-number">2.4.1.</span> <span class="toc-text">Git 用法说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-%E6%A1%88%E4%BE%8B"><span class="toc-number">2.4.2.</span> <span class="toc-text">Git 案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">创建项目并初始化配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%9A%82%E5%AD%98%E5%8C%BA%E5%B9%B6%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">添加暂存区并提交数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.2.3.</span> <span class="toc-text">设置忽略文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E6%96%87%E4%BB%B6%E5%8A%A0%E5%85%A5%E6%9A%82%E5%AD%98%E5%8C%BA%E5%86%8D%E5%8F%96%E6%B6%88%E6%B7%BB%E5%8A%A0"><span class="toc-number">2.4.2.4.</span> <span class="toc-text">将文件加入暂存区再取消添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9A%82%E5%AD%98%E5%8C%BA%E7%9A%84%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">2.4.2.5.</span> <span class="toc-text">查看暂存区的文件内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9A%82%E5%AD%98%E5%8C%BA%E6%81%A2%E5%A4%8D%E8%AF%AF%E5%88%A0%E9%99%A4%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8C%BA%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.2.6.</span> <span class="toc-text">利用暂存区恢复误删除的工作区文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E5%88%A0%E9%99%A4%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%92%8C%E6%9A%82%E5%AD%98%E5%8C%BA"><span class="toc-number">2.4.2.7.</span> <span class="toc-text">同时删除工作区和暂存区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E6%BB%9A%E5%B7%A5%E4%BD%9C%E5%8C%BA%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%BA%E6%9A%82%E5%AD%98%E5%8C%BA%E4%B8%AD%E7%89%88%E6%9C%AC"><span class="toc-number">2.4.2.8.</span> <span class="toc-text">回滚工作区的文件为暂存区中版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%AC%A1%E6%8F%90%E4%BA%A4%E5%90%8E%E5%9B%9E%E6%BB%9A%E8%87%B3%E6%8C%87%E5%AE%9A%E6%8F%90%E4%BA%A4%E7%9A%84%E7%89%88%E6%9C%AC"><span class="toc-number">2.4.2.9.</span> <span class="toc-text">多次提交后回滚至指定提交的版本</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#git-reset"><span class="toc-number">2.4.2.9.1.</span> <span class="toc-text">git reset</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#git-revert"><span class="toc-number">2.4.2.9.2.</span> <span class="toc-text">git revert</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%86%E6%94%AF%E5%92%8C%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF"><span class="toc-number">2.4.2.10.</span> <span class="toc-text">创建分支和合并分支</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%88%86%E6%94%AF%E5%90%8D%E7%A7%B0"><span class="toc-number">2.4.2.11.</span> <span class="toc-text">修改分支名称</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81%E6%89%93-tag-%E5%B9%B6%E5%88%A9%E7%94%A8-tag-%E5%9B%9E%E6%BB%9A"><span class="toc-number">2.4.2.12.</span> <span class="toc-text">当前状态打 tag 并利用 tag 回滚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E6%8F%90%E4%BA%A4%E7%BB%99%E5%85%AC%E7%94%A8%E4%BB%93%E5%BA%93%E7%A0%81%E4%BA%91"><span class="toc-number">2.4.2.13.</span> <span class="toc-text">本地代码提交给公用仓库码云</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E6%9C%89%E4%BA%91%E4%BB%93%E5%BA%93"><span class="toc-number">2.5.</span> <span class="toc-text">公有云仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-github"><span class="toc-number">2.5.1.</span> <span class="toc-text">使用 github</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-gitee"><span class="toc-number">2.5.2.</span> <span class="toc-text">使用 gitee</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A-%E5%85%83%E5%AE%87%E5%AE%99%E5%88%9B%E4%B8%9A%E5%8F%B2"><span class="toc-number">2.6.</span> <span class="toc-text">实战案例： 元宇宙创业史</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E5%B0%8F%E5%9E%8B%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%88%9B"><span class="toc-number">2.6.1.</span> <span class="toc-text">个人小型项目初创</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">初始化项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">开发新功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80"><span class="toc-number">2.6.1.3.</span> <span class="toc-text">版本回退</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E7%89%B9%E5%AE%9A%E7%89%88%E6%9C%AC%E5%92%8C%E7%B4%A7%E6%80%A5%E4%BF%AE%E5%A4%8D-bug"><span class="toc-number">2.6.2.</span> <span class="toc-text">发布特定版本和紧急修复 bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%A4%9A%E5%8F%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E8%BF%9C%E7%A8%8B%E5%8D%8F%E4%BD%9C%E5%BC%80%E5%8F%91"><span class="toc-number">2.6.3.</span> <span class="toc-text">实现多台主机的远程协作开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%92%8C%E5%88%9B%E5%BB%BA%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93"><span class="toc-number">2.6.3.1.</span> <span class="toc-text">注册和创建的远程软件仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93%E5%90%8C%E6%AD%A5%E8%87%B3%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="toc-number">2.6.3.2.</span> <span class="toc-text">将本地仓库同步至远程仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E6%96%B0%E7%94%B5%E8%84%91%E5%88%9D%E6%AC%A1%E4%BD%BF%E7%94%A8%E4%B8%8B%E8%BD%BD%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BB%A3%E7%A0%81%E5%B9%B6%E7%BB%A7%E7%BB%AD%E5%BC%80%E5%8F%91"><span class="toc-number">2.6.3.3.</span> <span class="toc-text">在新电脑初次使用下载远程仓库的代码并继续开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E7%8F%AD%E5%9B%9E%E5%88%B0%E5%AE%B6%E7%BB%A7%E7%BB%AD%E5%8A%A0%E7%8F%AD"><span class="toc-number">2.6.3.4.</span> <span class="toc-text">下班回到家继续加班</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B0%E5%85%AC%E5%8F%B8%E7%BB%A7%E7%BB%AD%E5%BC%80%E5%8F%91"><span class="toc-number">2.6.3.5.</span> <span class="toc-text">到公司继续开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%AE%8C%E6%AF%95%EF%BC%8C%E8%A6%81%E4%B8%8A%E7%BA%BF"><span class="toc-number">2.6.3.6.</span> <span class="toc-text">开发完毕，要上线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-number">2.6.3.7.</span> <span class="toc-text">免密码登录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-number">2.6.4.</span> <span class="toc-text">多版本管理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93-GitLab"><span class="toc-number">3.</span> <span class="toc-text">私有软件仓库 GitLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.</span> <span class="toc-text">GitLab 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gitlab-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.1.</span> <span class="toc-text">Gitlab 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E6%9E%B6%E6%9E%84"><span class="toc-number">3.1.2.</span> <span class="toc-text">GitLab 架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.</span> <span class="toc-text">GitLab 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">安装方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-GitLab-%E8%A6%81%E6%B1%82"><span class="toc-number">3.2.2.</span> <span class="toc-text">安装 GitLab 要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-number">3.2.3.</span> <span class="toc-text">安装前准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Ubuntu-%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">Ubuntu 系统环境安装前准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RHEL-%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">RHEL 系统环境安装前准备</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E5%AE%89%E8%A3%85-1"><span class="toc-number">3.2.4.</span> <span class="toc-text">GitLab 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-GitLab"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">安装 GitLab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-GitLab-%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">修改 GitLab 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.4.3.</span> <span class="toc-text">初始化和启动服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81-GitLab-%E5%90%AF%E5%8A%A8%E5%AE%8C%E6%88%90"><span class="toc-number">3.2.4.4.</span> <span class="toc-text">验证 GitLab 启动完成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%AB%AF%E5%8F%A3%E5%8F%8A%E7%8A%B6%E6%80%81"><span class="toc-number">3.2.4.5.</span> <span class="toc-text">验证端口及状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gitlab%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.4.6.</span> <span class="toc-text">Gitlab的常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85-GitLab-%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.4.7.</span> <span class="toc-text">一键安装 GitLab 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Docker-%E5%AE%89%E8%A3%85-GitLab"><span class="toc-number">3.2.4.8.</span> <span class="toc-text">基于 Docker 安装 GitLab</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.</span> <span class="toc-text">GitLab 基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E6%AC%A1%E7%99%BB%E5%BD%95-GitLab-Web-%E7%95%8C%E9%9D%A2%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="toc-number">3.3.1.</span> <span class="toc-text">首次登录 GitLab Web 界面修改密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%B4%E5%83%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">修改头像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E8%B4%A6%E5%8F%B7%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">3.3.3.</span> <span class="toc-text">关闭账号注册功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%82%AE%E7%AE%B1%E5%9C%B0%E5%9D%80"><span class="toc-number">3.3.4.</span> <span class="toc-text">修改邮箱地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%AE%A1%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">GitLab 用户和组管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">3.4.1.</span> <span class="toc-text">用户管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84"><span class="toc-number">3.4.2.</span> <span class="toc-text">创建组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86"><span class="toc-number">3.5.</span> <span class="toc-text">GitLab 项目管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.5.1.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%BB%84%E6%88%96%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.5.2.</span> <span class="toc-text">将用户添加到组或项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.5.3.</span> <span class="toc-text">使用项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%B5%8B%E8%AF%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">在项目中新建一个测试页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8linux%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95clone%E5%92%8C%E6%8F%90%E4%BA%A4%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.5.3.2.</span> <span class="toc-text">在linux客户端测试clone和提交项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8windows-%E5%AE%89%E8%A3%85-git-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95clone%E5%92%8C%E6%8F%90%E4%BA%A4%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.5.3.3.</span> <span class="toc-text">在windows 安装 git 客户端测试clone和提交项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Web%E7%AB%AF%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE"><span class="toc-number">3.5.3.4.</span> <span class="toc-text">Web端验证数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-ssh-%E5%9F%BA%E4%BA%8Ekey%E9%AA%8C%E8%AF%81%E7%9A%84-git-%E8%AE%BF%E9%97%AE"><span class="toc-number">3.5.3.5.</span> <span class="toc-text">实现 ssh 基于key验证的 git 访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E6%8A%A4%E5%88%86%E6%94%AF"><span class="toc-number">3.5.3.6.</span> <span class="toc-text">保护分支</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF"><span class="toc-number">3.5.3.7.</span> <span class="toc-text">合并分支</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">3.6.</span> <span class="toc-text">GitLab 的数据备份和恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.6.1.</span> <span class="toc-text">备份相关配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">3.6.2.</span> <span class="toc-text">手动备份数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E5%88%A0%E9%99%A4%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.6.3.</span> <span class="toc-text">模拟删除项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">3.6.4.</span> <span class="toc-text">执行恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E4%BF%9D%E8%BF%98%E5%8E%9F%E5%AE%8C%E6%88%90"><span class="toc-number">3.6.5.</span> <span class="toc-text">确保还原完成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E8%BF%81%E7%A7%BB%E5%92%8C%E5%8D%87%E7%BA%A7"><span class="toc-number">3.7.</span> <span class="toc-text">GitLab 迁移和升级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Https"><span class="toc-number">3.8.</span> <span class="toc-text">实现 Https</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E5%9B%9E-GitLab-%E5%BF%98%E8%AE%B0%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">3.9.</span> <span class="toc-text">找回 GitLab 忘记的密码</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/01/MY-Proxy/" title="Proxy 代理"><img src="/../images/MY/clash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Proxy 代理"/></a><div class="content"><a class="title" href="/2025/08/01/MY-Proxy/" title="Proxy 代理">Proxy 代理</a><time datetime="2025-08-01T11:05:46.000Z" title="发表于 2025-08-01 19:05:46">2025-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2"><img src="/../images/SRE/day46/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S 1.29.2"/></a><div class="content"><a class="title" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2">K8S 1.29.2</a><time datetime="2025-07-30T07:17:21.000Z" title="发表于 2025-07-30 15:17:21">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins"><img src="/../images/SRE/day55/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DevOps之CICD工具Jenkins"/></a><div class="content"><a class="title" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins">DevOps之CICD工具Jenkins</a><time datetime="2025-05-09T09:30:43.000Z" title="发表于 2025-05-09 17:30:43">2025-05-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/24/SRE-git/" title="版本管理系统Git和GitLab"><img src="/../images/SRE/day53/77.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="版本管理系统Git和GitLab"/></a><div class="content"><a class="title" href="/2025/04/24/SRE-git/" title="版本管理系统Git和GitLab">版本管理系统Git和GitLab</a><time datetime="2025-04-24T01:21:27.000Z" title="发表于 2025-04-24 09:21:27">2025-04-24</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="../images/BEIAN/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="../images/BEIAN/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>