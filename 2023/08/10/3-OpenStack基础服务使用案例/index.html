<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>私有云：(3)OpenStack基础服务使用案例 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="W"><meta name="copyright" content="W"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="OpenStack基础服务使用案例">
<meta property="og:type" content="article">
<meta property="og:title" content="私有云：(3)OpenStack基础服务使用案例">
<meta property="og:url" content="http://example.com/2023/08/10/3-OpenStack%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="OpenStack基础服务使用案例">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/title/openstack3.png">
<meta property="article:published_time" content="2023-08-09T18:00:00.000Z">
<meta property="article:modified_time" content="2024-10-12T23:59:44.570Z">
<meta property="article:author" content="W">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/title/openstack3.png"><link rel="shortcut icon" href="/../images/title/user.webp"><link rel="canonical" href="http://example.com/2023/08/10/3-OpenStack%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '私有云：(3)OpenStack基础服务使用案例',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-10-13 07:59:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/title/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/title/openstack3.png')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">私有云：(3)OpenStack基础服务使用案例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-09T18:00:00.000Z" title="发表于 2023-08-10 02:00:00">2023-08-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-12T23:59:44.570Z" title="更新于 2024-10-13 07:59:44">2024-10-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E9%87%8C%E9%9B%BE%E9%87%8C/">云里雾里</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="私有云：(3)OpenStack基础服务使用案例"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="案例描述"><a href="#案例描述" class="headerlink" title="案例描述"></a>案例描述</h1><p>本案例共讲述了OpenStack云平台中基础组件与服务的使用，包括Glance镜像服务,Nova计算服务,Cinder块存储服务,Swift对象存储服务的使用方法。具体案例如下：</p>
<p>1.Glance镜像服务：镜像的上传及过程中限制disk和ram；</p>
<p>2.Nova计算服务：创建云主机，开启实例大小调整，和调优操作；</p>
<p>3.Cinder块存储服务：云硬盘的基础使用，创建，挂载，扩容Cinder；</p>
<p>4.Swift对象存储服务：对象存储的基础使用，分片存储。</p>
<h1 id="案例一：Glance镜像服务的基本使用"><a href="#案例一：Glance镜像服务的基本使用" class="headerlink" title="案例一：Glance镜像服务的基本使用"></a>案例一：Glance镜像服务的基本使用</h1><h2 id="案例准备"><a href="#案例准备" class="headerlink" title="案例准备"></a>案例准备</h2><h3 id="规划节点"><a href="#规划节点" class="headerlink" title="规划节点"></a>规划节点</h3><p>节点规划见表1。</p>
<p>表1 节点规划</p>
<table>
<thead>
<tr>
<th><strong>IP</strong></th>
<th><strong>主机名</strong></th>
<th><strong>节点</strong></th>
</tr>
</thead>
<tbody><tr>
<td>172.128.11.13</td>
<td>controller</td>
<td>控制节点</td>
</tr>
<tr>
<td>172.128.11.19</td>
<td>compute</td>
<td>计算节点</td>
</tr>
</tbody></table>
<h3 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h3><p>登录物理OpenStack平台，使用云主机搭建的OpenStack平台作为实验节点。</p>
<h2 id="案例实施"><a href="#案例实施" class="headerlink" title="案例实施"></a>案例实施</h2><h3 id="Glance镜像服务介绍"><a href="#Glance镜像服务介绍" class="headerlink" title="Glance镜像服务介绍"></a>Glance镜像服务介绍</h3><p>Glance是OpenStack镜像服务，用来注册、登陆和检索虚拟机镜像。Glance服务提供了一个REST API，使读者能够查询虚拟机镜像元数据和检索的实际镜像。通过镜像服务提供的虚拟机镜像可以存储在不同的位置，从简单的文件系统对象存储到类似OpenStack对象存储系统。Glance与其他组件的关系如图1-1所示。</p>
<p><img src="../../../../images/image/DX/30.png" alt="30"></p>
<p>图1-1 Glance与其他组件的关系</p>
<p>默认情况下，上传的虚拟机镜像存储路径为/var/lib/glance/images/。Glance负责镜像文件的注册、查询和存储管理。</p>
<p>● glance-api负责接受Image API请求，处理image查询和存储等</p>
<p>● glance-registry负责存储，处理和检索image的元数据(大小，类型等)</p>
<p>● 使用数据库来存储image文件的元数据</p>
<p>● 支持不同的存储仓库来存储image文件，包括swift,本地磁盘，RADOS块设备，Amazon S3，HTTP。</p>
<hr>
<h3 id="Glance重要概念"><a href="#Glance重要概念" class="headerlink" title="Glance重要概念"></a>Glance重要概念</h3><p>（1）镜像状态</p>
<p>镜像状态是Glance管理镜像重要的一个内容，Glance组件给整个OpenStack提供的镜像查询和检索，Glance可以通过虚拟机镜像的状态感知某一镜像的可用状态。如图1-2所示，OpenStack中镜像的状态分成以下几种：</p>
<p>● Queued:Queued状态这是一种初始化镜像状态，在镜像文件刚刚被创建，在glance数据库中已经保存了镜像标示符，但还没有上传至glance中，此时的glance对镜像数据没有任何描述，其存储空间为0。</p>
<p>● Saving:Saving状态是镜像的原始数据在上传中的一种过度状态，它产生在镜像数据上传至glance的过程中，一般来讲，glance收到一个image请求后，才将镜像上传给glance。</p>
<p>● Active:Active状态是当镜像成功上传完毕以后的一种状态，它表明glance中可用的镜像。</p>
<p>● Killed:Killed状态出现在镜像上传失败或者镜像文件不可读的情况下，glance将镜像状态设置成Killed。</p>
<p>● Deleted:Deleted状态表明一个镜像文件马上会被删除，只是当前glance这种仍然保留该镜像文件的相关信息和原始镜像数据。</p>
<p>● Pending_delete:Pending_delete状态类似于deleted，虽然此时的镜像文件没有删除，但镜像文件不能恢复的。</p>
<p><img src="../../../../images/image/DX/31.png" alt="31"></p>
<p>图1-2 Glance镜像文件状态转换过程</p>
<p>（2）Glance基本架构和三大模块</p>
<p>它的设计模式采用C/S架构模式，Client通过Glance提供的REST API与Glance的服务器（Server）程序进行通信，Glance的服务器程序通过网络端口监听，接收Client发送来的镜像操作请求，基本架构如图1-3所示。</p>
<p><img src="../../../../images/image/DX/32.png" alt="32"></p>
<p>图1-3 Glance架构图</p>
<p>● Glance-api：接收REST API的请求，然后通过其他模块（glance-registry及image store）来完成诸如镜像的查找、获取、上传、删除等操作，默认监听端口9292。</p>
<p>● Glance-registry：用于与MariaDB数据库交互，用于存储或获取镜像的元数据（metadata）；通过glance-registry，可以向数据库中写入或获取镜像的各种数据，glance-registry监听端口9191。</p>
<p>● Store Adapter：是一个存储的接口层，通过这个接口，glance可以获取镜像，image store支持的存储有Amazon的S3、OpenStack本身的Swift，本地文件存储和其他分布式存储。</p>
<p>（3）Glance组件的工作过程</p>
<p>如图1-4所示介绍了Glance组件在申请镜像是所与OpenStack平台进行交互的流程图。</p>
<p><img src="../../../../images/image/DX/33.png" alt="33"></p>
<p>图1-4 glance工作过程</p>
<hr>
<h3 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h3><p>（1）下载CirrOS镜像文件</p>
<p>CirrOS是一个极小的云操作系统，可以使用这个小的操作系统来进行Glance服务组件的操作练习。将提供的cirros-0.3.4-x86_64-disk.img镜像上传到controller节点的root目录下面。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# ls</span><br><span class="line">cirros-0.3.4-x86_64-disk.img</span><br></pre></td></tr></table></figure>

<p>将镜像上传至controller节点后，通过file命令查看镜像文件信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# file cirros-0.3.4-x86_64-disk.img </span><br><span class="line">cirros-0.3.4-x86_64-disk.img: QEMU QCOW Image (v2), 41126400 bytes</span><br></pre></td></tr></table></figure>

<p>（2）创建镜像</p>
<p>通过命令创建镜像，命令的格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller images]# glance help image-create </span><br><span class="line">usage: glance image-create [--architecture ]</span><br><span class="line">                           [--protected [True|False]] [--name ]</span><br><span class="line">                           [--instance-uuid ]</span><br><span class="line">                           [--min-disk ] [--visibility ]</span><br><span class="line">                           [--kernel-id ]</span><br><span class="line">                           [--tags  [ ...]]</span><br><span class="line">                           [--os-version ]</span><br><span class="line">                           [--disk-format ]</span><br><span class="line">                           [--os-distro ] [--id ]</span><br><span class="line">                           [--owner ] [--ramdisk-id ]</span><br><span class="line">                           [--min-ram ]</span><br><span class="line">                           [--container-format ]</span><br><span class="line">                           [--property ] [--file ]</span><br><span class="line">                           [--progress]</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--disk-format：镜像格式</span><br><span class="line">--container-format： 镜像在其他项目中可见性</span><br><span class="line">--progress： 显示上传镜像的进度</span><br><span class="line">--file：选择本地镜像文件</span><br><span class="line">--name：上传后镜像的名称</span><br></pre></td></tr></table></figure>

<p>使用镜像cirros-0.3.4-x86_64-disk.img通过命令上传镜像至OpenStack中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# glance image-create --name cirros-0.3.4 --disk-format qcow2 --container-format bare --progress &lt; cirros-0.3.4-x86_64-disk.img</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br><span class="line">| Property         | Value                                                              |</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br><span class="line">| checksum         | f8ab98ff5e73ebab884d80c9dc9c7290                                   |</span><br><span class="line">| container_format | bare                                                               |</span><br><span class="line">| created_at       | 2022-02-10T03:15:29Z                                               |</span><br><span class="line">| disk_format      | qcow2                                                              |</span><br><span class="line">| id               | 32a2513c-e5ba-438b-a5ee-63c35c03b284                               |</span><br><span class="line">| min_disk         | 0                                                                  |</span><br><span class="line">| min_ram          | 0                                                                  |</span><br><span class="line">| name             | cirros-0.3.4                                                       |</span><br><span class="line">| os_hash_algo     | sha512                                                             |</span><br><span class="line">| os_hash_value    | f0fd1b50420dce4ca382ccfbb528eef3a38bbeff00b54e95e3876b9bafe7ed2d6f9</span><br><span class="line">                     19ca35d9046d437c6d2d8698b1174a335fbd66035bb3edc525d2cdb187232      |</span><br><span class="line">| os_hidden        | False                                                              |</span><br><span class="line">| owner            | 1776912d52a7444d8b2d09eb86e8d1d9                                   |</span><br><span class="line">| protected        | False                                                              |</span><br><span class="line">| size             | 13267968                                                           |</span><br><span class="line">| status           | active                                                             |</span><br><span class="line">| tags             | []                                                                 |</span><br><span class="line">| updated_at       | 2022-02-10T03:15:29Z                                               |</span><br><span class="line">| virtual_size     | Not available                                                      |</span><br><span class="line">| visibility       | shared                                                             |</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="管理镜像"><a href="#管理镜像" class="headerlink" title="管理镜像"></a>管理镜像</h3><p>（1）查看镜像</p>
<p>通过命令可以在OpenStack平台中查看当前glance中所上传的镜像名称。具体命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# glance image-list</span><br><span class="line">+--------------------------------------+--------------+</span><br><span class="line">| ID                                   | Name         |</span><br><span class="line">+--------------------------------------+--------------+</span><br><span class="line">| 32a2513c-e5ba-438b-a5ee-63c35c03b284 | cirros-0.3.4 |</span><br><span class="line">+--------------------------------------+--------------+</span><br></pre></td></tr></table></figure>

<p>也可以使用命令查看镜像的详细信息。具体命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# glance image-show  32a2513c-e5ba-438b-a5ee-63c35c03b284</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br><span class="line">| Property         | Value                                                              |</span><br><span class="line">+------------------+------------------------------------------------------------------ -+</span><br><span class="line">| checksum         | f8ab98ff5e73ebab884d80c9dc9c7290                                   |</span><br><span class="line">| container_format | bare                                                               |</span><br><span class="line">| created_at       | 2022-02-10T03:15:29Z                                               |</span><br><span class="line">| disk_format      | qcow2                                                              |</span><br><span class="line">| id               | 32a2513c-e5ba-438b-a5ee-63c35c03b284                               |</span><br><span class="line">| min_disk         | 0                                                                  |</span><br><span class="line">| min_ram          | 0                                                                  |</span><br><span class="line">| name             | cirros-0.3.4                                                       |</span><br><span class="line">| os_hash_algo     | sha512                                                             |</span><br><span class="line">| os_hash_value    | f0fd1b50420dce4ca382ccfbb528eef3a38bbeff00b54e95e3876b9bafe7ed2d6f9</span><br><span class="line">                     19ca35d9046d437c6d2d8698b1174a335fbd66035bb3edc525d2cdb187232      |</span><br><span class="line">| os_hidden        | False                                                              |</span><br><span class="line">| owner            | 1776912d52a7444d8b2d09eb86e8d1d9                                   |</span><br><span class="line">| protected        | False                                                              |</span><br><span class="line">| size             | 13267968                                                           |</span><br><span class="line">| status           | active                                                             |</span><br><span class="line">| tags             | []                                                                 |</span><br><span class="line">| updated_at       | 2022-02-10T03:15:29Z                                               |</span><br><span class="line">| virtual_size     | Not available                                                      |</span><br><span class="line">| visibility       | shared                                                             |</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（2）修改镜像</p>
<p>可以使用glance image-update更新镜像信息，命令的格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller images]# glance help image-update </span><br><span class="line">usage: glance image-update [--architecture ]</span><br><span class="line">                           [--protected [True|False]] [--name ]</span><br><span class="line">                           [--instance-uuid ]</span><br><span class="line">                           [--min-disk ] [--visibility ]</span><br><span class="line">                           [--kernel-id ]</span><br><span class="line">                           [--os-version ]</span><br><span class="line">                           [--disk-format ]</span><br><span class="line">                           [--os-distro ] [--owner ]</span><br><span class="line">                           [--ramdisk-id ] [--min-ram ]</span><br><span class="line">                           [--container-format ]</span><br><span class="line">                           [--property ] [--remove-property key]</span><br><span class="line">                           </span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--min-disk：镜像启动最小硬盘大小</span><br><span class="line">--name：镜像名称</span><br><span class="line">--disk-format：镜像格式</span><br><span class="line">--min-ram：镜像启动最小内存大小</span><br><span class="line">--container-format：镜像在项目中可见性</span><br></pre></td></tr></table></figure>

<p>如果需要改变镜像启动硬盘最低要求值（min-disk）1G，min-disk默认单位为G。使用glance image-update更新镜像信息操作如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# glance image-update --min-disk=1 32a2513c-e5ba-438b-a5ee-63c35c03b284</span><br><span class="line"></span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br><span class="line">| Property         | Value                                                              |</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br><span class="line">| checksum         | f8ab98ff5e73ebab884d80c9dc9c7290                                   |</span><br><span class="line">| container_format | bare                                                               |</span><br><span class="line">| created_at       | 2022-02-10T03:15:29Z                                               |</span><br><span class="line">| disk_format      | qcow2                                                              |</span><br><span class="line">| id               | 32a2513c-e5ba-438b-a5ee-63c35c03b284                               |</span><br><span class="line">| min_disk         | 1                                                                  |</span><br><span class="line">| min_ram          | 0                                                                  |</span><br><span class="line">| name             | cirros-0.3.4                                                       |</span><br><span class="line">| os_hash_algo     | sha512                                                             |</span><br><span class="line">| os_hash_value    | f0fd1b50420dce4ca382ccfbb528eef3a38bbeff00b54e95e3876b9bafe7ed2d6f9</span><br><span class="line">19ca35d9046d437c6d2d8698b1174a335fbd66035bb3edc525d2cdb187232      |</span><br><span class="line">| os_hidden        | False                                                              |</span><br><span class="line">| owner            | 1776912d52a7444d8b2d09eb86e8d1d9                                   |</span><br><span class="line">| protected        | False                                                              |</span><br><span class="line">| size             | 13267968                                                           |</span><br><span class="line">| status           | active                                                             |</span><br><span class="line">| tags             | []                                                                 |</span><br><span class="line">| updated_at       | 2022-02-10T03:16:59Z                                               |</span><br><span class="line">| virtual_size     | Not available                                                      |</span><br><span class="line">| visibility       | shared                                                             |</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>也可以使用命令更新镜像启动内存最低要求值（min-ram）为1G，min-ram默认单位为M。使用glance image-update更新镜像信息操作如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# glance image-update --min-ram=1024 32a2513c-e5ba-438b-a5ee-63c35c03b284</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br><span class="line">| Property         | Value                                                              |</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br><span class="line">| checksum         | f8ab98ff5e73ebab884d80c9dc9c7290                                   |</span><br><span class="line">| container_format | bare                                                               |</span><br><span class="line">| created_at       | 2022-02-10T03:15:29Z                                               |</span><br><span class="line">| disk_format      | qcow2                                                              |</span><br><span class="line">| id               | 32a2513c-e5ba-438b-a5ee-63c35c03b284                               |</span><br><span class="line">| min_disk         | 1                                                                  |</span><br><span class="line">| min_ram          | 1024                                                               |</span><br><span class="line">| name             | cirros-0.3.4                                                       |</span><br><span class="line">| os_hash_algo     | sha512                                                             |</span><br><span class="line">| os_hash_value    | f0fd1b50420dce4ca382ccfbb528eef3a38bbeff00b54e95e3876b9bafe7ed2d6f9</span><br><span class="line">19ca35d9046d437c6d2d8698b1174a335fbd66035bb3edc525d2cdb187232      |</span><br><span class="line">| os_hidden        | False                                                              |</span><br><span class="line">| owner            | 1776912d52a7444d8b2d09eb86e8d1d9                                   |</span><br><span class="line">| protected        | False                                                              |</span><br><span class="line">| size             | 13267968                                                           |</span><br><span class="line">| status           | active                                                             |</span><br><span class="line">| tags             | []                                                                 |</span><br><span class="line">| updated_at       | 2022-02-10T03:17:21Z                                               |</span><br><span class="line">| virtual_size     | Not available                                                      |</span><br><span class="line">| visibility       | shared                                                             |</span><br><span class="line">+------------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（3）删除镜像</p>
<p>可以使用glance image-delete删除上传至OpenStack平台中的镜像，使用命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller images]# glance help image-delete</span><br><span class="line">usage: glance image-delete  [ ...]</span><br><span class="line"></span><br><span class="line">Delete specified image.</span><br><span class="line"></span><br><span class="line">Positional arguments:</span><br><span class="line">    ID of image(s) to delete.</span><br><span class="line"></span><br><span class="line">Run `glance --os-image-api-version 1 help image-delete` for v1 help</span><br></pre></td></tr></table></figure>

<p>只需要在命令后跟上镜像ID即可。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller images]# glance image-delete 32a2513c-e5ba-438b-a5ee-63c35c03b284</span><br><span class="line">[root@controller images]# glance image-list</span><br><span class="line">+--------------------------------------+-------------------------------+</span><br><span class="line">| ID                                   | Name                          |</span><br><span class="line">+--------------------------------------+-------------------------------+</span><br><span class="line">+--------------------------------------+-------------------------------+</span><br></pre></td></tr></table></figure>

<h1 id="案例二：Nova服务的基本使用"><a href="#案例二：Nova服务的基本使用" class="headerlink" title="案例二：Nova服务的基本使用"></a>案例二：Nova服务的基本使用</h1><h2 id="案例准备-1"><a href="#案例准备-1" class="headerlink" title="案例准备"></a>案例准备</h2><h3 id="规划节点-1"><a href="#规划节点-1" class="headerlink" title="规划节点"></a>规划节点</h3><p>节点规划见表2。</p>
<p>表2 节点规划</p>
<table>
<thead>
<tr>
<th><strong>IP</strong></th>
<th><strong>主机名</strong></th>
<th><strong>节点</strong></th>
</tr>
</thead>
<tbody><tr>
<td>172.128.11.13</td>
<td>controller</td>
<td>控制节点</td>
</tr>
<tr>
<td>172.128.11.19</td>
<td>compute</td>
<td>计算节点</td>
</tr>
</tbody></table>
<h3 id="基础准备-1"><a href="#基础准备-1" class="headerlink" title="基础准备"></a>基础准备</h3><p>登录物理OpenStack平台，使用云主机搭建的OpenStack平台作为实验节点。</p>
<h2 id="案例实施-1"><a href="#案例实施-1" class="headerlink" title="案例实施"></a>案例实施</h2><h3 id="Nova简介"><a href="#Nova简介" class="headerlink" title="Nova简介"></a>Nova简介</h3><p>计算服务是OpenStack最核心的服务之一，负责维护和管理云环境的计算资源，它在OpenStack项目中代号是nova。</p>
<p>Nova自身并没有提供任何虚拟化能力，它提供计算服务，使用不同的虚拟化驱动来与底层支持的Hypervisor（虚拟机管理器）进行交互。所有的计算实例（虚拟服务器）由Nova进行生命周期的调度管理（启动、挂起、停止、删除等）。</p>
<p>Nova需要Keystone、Glance、Neutron、Cinder和Swift等其他服务的支持，能与这些服务集成，实现如加密磁盘、裸金属计算实例等。</p>
<hr>
<h3 id="Nova架构"><a href="#Nova架构" class="headerlink" title="Nova架构"></a>Nova架构</h3><p>Nova项目最初的源代码由美国国家航空航天局（NASA）贡献，截至Ocata版本，Nova项目已发行了十几个版本，也是社区所有项目中最为成熟和用户生产环境部署率最高的项目。在2010年OpenStack项目成立之初，Nova项目主要分为Nova-Compute、Nova-volume和Nova-network三大功能模块。在2012年9月OpenStack的Folsom版本发行时，社区才将Nova-volume和Nova-network独立出来分别构建了Cinder和Quantum项目（后因商标原因更名为Neutron项目）。Nova服务除了Nova-Compute、Nova-volume和Nova-network三大功能模块之外，还有处理RESTful API请求的Nova-API模块、调度Nova-Compute的Nova-scheduler模块、用以模块信息交互的消息队列系统和配置及状态数据存储的数据库。而在早期的OpenStack版本中，仅有Nova、Swift和Glance三大项目，如果用户不准备使用对象存储Swift，则Nova和Glance项目即构成了早期的OpenStack云平台。如图2-1所示。</p>
<p><img src="../../../../images/image/DX/34.png" alt="34"></p>
<p>图2-1 Nova架构图</p>
<p>在OpenStack的Folsom版本发行后，Nova-volume和Nova-network被独立成为块存储Cinder项目和网络Neutron项目，而Nova自身的功能模块也被不断细分，除了Nova-Compute和Nova-API功能模块，以及消息队列和数据库之外，Nova项目还构建了Nova-cert、Nova-Conductor、Nova-consoleauth和nova-console等模块。块存储Cinder项目和网络服务Neutron独立后，OpenStack中三大核心功能计算、存储和网络项目之间的逻辑架构如如图2-2所示。</p>
<p><img src="../../../../images/image/DX/35.png" alt="35"></p>
<p>图2-2 Nova与OpenStack平台逻辑结构</p>
<hr>
<h3 id="创建flavor类型"><a href="#创建flavor类型" class="headerlink" title="创建flavor类型"></a>创建flavor类型</h3><p>flavor类型为OpenStack在创建云主机时需要提供的云主机大小类型，云主机的资源大小可使用不同的flavor类型来进行定义。</p>
<p>（1）创建flavor类型</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help  flavor create </span><br><span class="line">usage: openstack flavor create [-h] [-f &#123;json,shell,table,value,yaml&#125;]</span><br><span class="line">                               [-c COLUMN] [--max-width ]</span><br><span class="line">                               [--fit-width] [--print-empty] [--noindent]</span><br><span class="line">                               [--prefix PREFIX] [--id ] [--ram ]</span><br><span class="line">                               [--disk ] [--ephemeral ]</span><br><span class="line">                               [--swap ] [--vcpus ]</span><br><span class="line">                               [--rxtx-factor ] [--public | --private]</span><br><span class="line">                               [--property ] [--project ]</span><br><span class="line">                               [--project-domain ]</span><br><span class="line">                               </span><br><span class="line"></span><br><span class="line">Create new flavor</span><br></pre></td></tr></table></figure>

<p>使用命令创建一个flavor，10G的硬盘大小，1G内存，2颗vcpu，ID为1，名称为centos。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]#  openstack flavor create --disk 10 --ram 1024  --vcpus 2 --id 1 centos</span><br><span class="line">+----------------------------+--------+</span><br><span class="line">| Field                      | Value  |</span><br><span class="line">+----------------------------+--------+</span><br><span class="line">| OS-FLV-DISABLED:disabled   | False  |</span><br><span class="line">| OS-FLV-EXT-DATA:ephemeral  | 0      |</span><br><span class="line">| disk                       | 10     |</span><br><span class="line">| id                         | 1      |</span><br><span class="line">| name                       | centos |</span><br><span class="line">| os-flavor-access:is_public | True   |</span><br><span class="line">| properties                 |        |</span><br><span class="line">| ram                        | 1024   |</span><br><span class="line">| rxtx_factor                | 1.0    |</span><br><span class="line">| swap                       |        |</span><br><span class="line">| vcpus                      | 2      |</span><br><span class="line">+----------------------------+--------+</span><br></pre></td></tr></table></figure>

<p>（2）查看flavor类型</p>
<p>使用“openstack flavor list”命令查看flavor类型列表，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack flavor list </span><br><span class="line">+----+--------+------+------+-----------+-------+-----------+</span><br><span class="line">| ID | Name   |  RAM | Disk | Ephemeral | VCPUs | Is Public |</span><br><span class="line">+----+--------+------+------+-----------+-------+-----------+</span><br><span class="line">| 1  | centos | 1024 |   10 |         0 |     2 | True      |</span><br><span class="line">+----+--------+------+------+-----------+-------+-----------+</span><br></pre></td></tr></table></figure>

<p>也可以使用“openstack flavor show”命令查看具体的flavor类型的详细信息。命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help flavor show</span><br><span class="line">usage: openstack flavor show [-h] [-f &#123;json,shell,table,value,yaml&#125;]</span><br><span class="line">                             [-c COLUMN] [--max-width ] [--fit-width]</span><br><span class="line">                             [--print-empty] [--noindent] [--prefix PREFIX]</span><br><span class="line">                             </span><br></pre></td></tr></table></figure>

<p>通过命令查看创建的“centos”的flavor类型详细信息。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack flavor show centos</span><br><span class="line">+----------------------------+--------+</span><br><span class="line">| Field                      | Value  |</span><br><span class="line">+----------------------------+--------+</span><br><span class="line">| OS-FLV-DISABLED:disabled   | False  |</span><br><span class="line">| OS-FLV-EXT-DATA:ephemeral  | 0      |</span><br><span class="line">| access_project_ids         | None   |</span><br><span class="line">| disk                       | 10     |</span><br><span class="line">| id                         | 1      |</span><br><span class="line">| name                       | centos |</span><br><span class="line">| os-flavor-access:is_public | True   |</span><br><span class="line">| properties                 |        |</span><br><span class="line">| ram                        | 1024   |</span><br><span class="line">| rxtx_factor                | 1.0    |</span><br><span class="line">| swap                       |        |</span><br><span class="line">| vcpus                      | 2      |</span><br><span class="line">+----------------------------+--------+</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="访问安全组"><a href="#访问安全组" class="headerlink" title="访问安全组"></a>访问安全组</h3><p>访问安全组为是OpenStack提供给云主机的一个访问策略控制组，通过安全组中的策略可以控制云主机的出入访问规则。</p>
<p>（1）查看访问安全组</p>
<p>使用命令“openstack security group list”可以查看当前所创建的访问安全组列表。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group list</span><br><span class="line">+--------------------------+---------+------------------------+------------------+------+</span><br><span class="line">| ID                       | Name    | Description            | Project          | Tags |</span><br><span class="line">+--------------------------+---------+------------------------+------------------+------+</span><br><span class="line">|896ce430-21f8-4673-8110-af| default | Default security group |1776912d52a7444d8b| []   |</span><br><span class="line"> ce97e43715                                                    2d09eb86e8d1d9            </span><br><span class="line">+--------------------------+---------+------------------------+------------------+------+</span><br></pre></td></tr></table></figure>

<p>“default”为openstack平台自带的安全组，通过命令可以查看安全组中的安全规则，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]#  openstack security group rule list default</span><br><span class="line">+--------------------+-------------+-----------+-----------+------------+----------------------+</span><br><span class="line">| ID                 | IP Protocol | Ethertype | IP Range  | Port Range | Remote Security Group|</span><br><span class="line">+--------------------+-------------+-----------+-----------+------------+----------------------+</span><br><span class="line">| 1e6c27ff-b456-4d2a | None        | IPv4      | 0.0.0.0/0 |            | 896ce430-21f8-4673   |</span><br><span class="line">  -a64d-51197fea048e                                                      -8110-afce97e43715</span><br><span class="line">| 699e2744-e926-4bb4 | None        | IPv6      | ::/0      |            | None                 |</span><br><span class="line">  -9e4f-54885f669bc5</span><br><span class="line">| 7aa363c8-5df3-4ce3 | None        | IPv6      | ::/0      |            | 896ce430-21f8-4673   |</span><br><span class="line">  -a775-9e453f086c87                                                      -8110-afce97e43715</span><br><span class="line">| bb08b786-09f4-44f3 | None        | IPv4      | 0.0.0.0/0 |            | None                 |</span><br><span class="line">  -a030-71b189a0f84f</span><br><span class="line">+--------------------+-------------+-----------+-----------+------------+----------------------+</span><br></pre></td></tr></table></figure>

<p>在安全规则的列表中，不能看出每条规则的具体策略，通过使用命令“openstack security group rule show”查看规则的详细信息。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack  security group rule show 7aa363c8-5df3-4ce3-a775-9e453f086c87</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br><span class="line">| Field             | Value                                                             |</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br><span class="line">| created_at        | 2022-02-10T03:21:40Z                                              |</span><br><span class="line">| description       | None                                                              |</span><br><span class="line">| direction         | ingress                                                           |</span><br><span class="line">| ether_type        | IPv6                                                              |</span><br><span class="line">| id                | 7aa363c8-5df3-4ce3-a775-9e453f086c87                              |</span><br><span class="line">| location          | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;000000&#x27;, </span><br><span class="line">project.id=&#x27;1776912d52a7444d8b2d09eb86e8d1d9&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;,</span><br><span class="line"> zone=                                                                                  |</span><br><span class="line">| name              | None                                                              |</span><br><span class="line">| port_range_max    | None                                                              |</span><br><span class="line">| port_range_min    | None                                                              |</span><br><span class="line">| project_id        | 1776912d52a7444d8b2d09eb86e8d1d9                                  |</span><br><span class="line">| protocol          | None                                                              |</span><br><span class="line">| remote_group_id   | 896ce430-21f8-4673-8110-afce97e43715                              |</span><br><span class="line">| remote_ip_prefix  | ::/0                                                              |</span><br><span class="line">| revision_number   | 0                                                                 |</span><br><span class="line">| security_group_id | 896ce430-21f8-4673-8110-afce97e43715                              |</span><br><span class="line">| tags              | []                                                                |</span><br><span class="line">| updated_at        | 2022-02-10T03:21:40Z                                              |</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（2）创建访问安全组</p>
<p>创建一个新的安全组，命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help security group create </span><br><span class="line">usage: openstack security group create [-h] [-f &#123;json,shell,table,value,yaml&#125;]</span><br><span class="line">                                       [-c COLUMN] [--max-width ]</span><br><span class="line">                                       [--fit-width] [--print-empty]</span><br><span class="line">                                       [--noindent] [--prefix PREFIX]</span><br><span class="line">                                       [--description ]</span><br><span class="line">                                       [--project ]</span><br><span class="line">                                       [--project-domain ]</span><br><span class="line">                                       </span><br></pre></td></tr></table></figure>

<p>使用命令创建新的安全组规则，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group create test</span><br><span class="line">+-----------------+---------------------------------------------------------------------+</span><br><span class="line">| Field           | Value                                                               |</span><br><span class="line">+-----------------+---------------------------------------------------------------------+</span><br><span class="line">| created_at      | 2022-02-10T03:25:18Z                                                |</span><br><span class="line">| description     | test                                                                |</span><br><span class="line">| id              | 96373f68-be50-4819-b9a6-8fc8d3e9dc0a                                |</span><br><span class="line">| location        | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;000000&#x27;, </span><br><span class="line">project.id=&#x27;1776912d52a7444d8b2d09eb86e8d1d9&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;,</span><br><span class="line"> zone=                                                                                  |</span><br><span class="line">| name            | test                                                                |</span><br><span class="line">| project_id      | 1776912d52a7444d8b2d09eb86e8d1d9                                    |</span><br><span class="line">| revision_number | 1                                                                   |</span><br><span class="line">| rules           | created_at=&#x27;2022-02-10T03:25:18Z&#x27;, direction=&#x27;egress&#x27;, ethertype</span><br><span class="line">=&#x27;IPv4&#x27;, id=&#x27;2bbc98ad-4784-419d-b815-4ee2c6c75b54&#x27;, updated_at=&#x27;2022-02-10T03:25:18Z&#x27;   |</span><br><span class="line">|                 | created_at=&#x27;2022-02-10T03:25:19Z&#x27;, direction=&#x27;egress&#x27;, ethertype</span><br><span class="line">=&#x27;IPv6&#x27;, id=&#x27;70fcb5e0-fd86-461e-84a4-2a83b4b90730&#x27;, updated_at=&#x27;2022-02-10T03:25:19Z&#x27;   |</span><br><span class="line">| tags            | []                                                                  |</span><br><span class="line">| updated_at      | 2022-02-10T03:25:18Z                                                |</span><br><span class="line">+-----------------+---------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（3）删除访问安全组</p>
<p>可以使用命令删除不需要使用的访问安全组，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group delete test</span><br><span class="line">[root@controller ~]# openstack security group list</span><br><span class="line">+-------------------------+---------+------------------------+------------------+------+</span><br><span class="line">| ID                      | Name    | Description            | Project          | Tags |</span><br><span class="line">+-------------------------+---------+------------------------+------------------+------+</span><br><span class="line">| 896ce430-21f8-4673-8110 | default | Default security group | 1776912d52a7444d | []   |</span><br><span class="line">  -afce97e43715                                                8b2d09eb86e8d1d9</span><br><span class="line">+-------------------------+---------+------------------------+------------------+------+</span><br></pre></td></tr></table></figure>

<p>（4）添加安全规则</p>
<p>在默认安全组中添加三条需要使用的访问规则，使用“openstack security group rule create”命令，命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack  help security group rule create </span><br><span class="line">usage: openstack security group rule create [-h]</span><br><span class="line">                                            [-f &#123;json,shell,table,value,yaml&#125;]</span><br><span class="line">                                            [-c COLUMN]</span><br><span class="line">                                            [--max-width ]</span><br><span class="line">                                            [--fit-width] [--print-empty]</span><br><span class="line">                                            [--noindent] [--prefix PREFIX]</span><br><span class="line">                                            [--remote-ip  | --remote-group ]</span><br><span class="line">                                            [--description ]</span><br><span class="line">                                            [--dst-port ]</span><br><span class="line">                                            [--icmp-type ]</span><br><span class="line">                                            [--icmp-code ]</span><br><span class="line">                                            [--protocol ]</span><br><span class="line">                                            [--ingress | --egress]</span><br><span class="line">                                            [--ethertype ]</span><br><span class="line">                                            [--project ]</span><br><span class="line">                                            [--project-domain ]</span><br><span class="line">                                            </span><br></pre></td></tr></table></figure>

<p>在“defualt”安全组中添加一条策略，从入口方向放行所有ICMP规则，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group rule create --protocol icmp --ingress  default</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br><span class="line">| Field             | Value                                                             |</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br><span class="line">| created_at        | 2022-02-10T04:47:42Z                                              |</span><br><span class="line">| description       |                                                                   |</span><br><span class="line">| direction         | ingress                                                           |</span><br><span class="line">| ether_type        | IPv4                                                              |</span><br><span class="line">| id                | 61014f36-5c20-46ce-b779-7d0c7458e691                              |</span><br><span class="line">| location          | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;000000&#x27;, </span><br><span class="line">project.id=&#x27;1776912d52a7444d8b2d09eb86e8d1d9&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;, </span><br><span class="line">zone=                                                                                   |</span><br><span class="line">| name              | None                                                              |</span><br><span class="line">| port_range_max    | None                                                              |</span><br><span class="line">| port_range_min    | None                                                              |</span><br><span class="line">| project_id        | 1776912d52a7444d8b2d09eb86e8d1d9                                  |</span><br><span class="line">| protocol          | icmp                                                              |</span><br><span class="line">| remote_group_id   | None                                                              |</span><br><span class="line">| remote_ip_prefix  | 0.0.0.0/0                                                         |</span><br><span class="line">| revision_number   | 0                                                                 |</span><br><span class="line">| security_group_id | 896ce430-21f8-4673-8110-afce97e43715                              |</span><br><span class="line">| tags              | []                                                                |</span><br><span class="line">| updated_at        | 2022-02-10T04:47:42Z                                              |</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>在“defualt”安全组中添加一条策略，从入口方向放行所有TCP规则，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group rule create --protocol tcp --ingress  default</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br><span class="line">| Field             | Value                                                             |</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br><span class="line">| created_at        | 2022-02-10T04:47:59Z                                              |</span><br><span class="line">| description       |                                                                   |</span><br><span class="line">| direction         | ingress                                                           |</span><br><span class="line">| ether_type        | IPv4                                                              |</span><br><span class="line">| id                | 03ace6cf-ec1a-42a9-a754-c21fe887d1c0                              |</span><br><span class="line">| location          | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;000000&#x27;, </span><br><span class="line">project.id=&#x27;1776912d52a7444d8b2d09eb86e8d1d9&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;,</span><br><span class="line"> zone=                                                                                  |</span><br><span class="line">| name              | None                                                              |</span><br><span class="line">| port_range_max    | None                                                              |</span><br><span class="line">| port_range_min    | None                                                              |</span><br><span class="line">| project_id        | 1776912d52a7444d8b2d09eb86e8d1d9                                  |</span><br><span class="line">| protocol          | tcp                                                               |</span><br><span class="line">| remote_group_id   | None                                                              |</span><br><span class="line">| remote_ip_prefix  | 0.0.0.0/0                                                         |</span><br><span class="line">| revision_number   | 0                                                                 |</span><br><span class="line">| security_group_id | 896ce430-21f8-4673-8110-afce97e43715                              |</span><br><span class="line">| tags              | []                                                                |</span><br><span class="line">| updated_at        | 2022-02-10T04:47:59Z                                              |</span><br><span class="line">+-------------------+-------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>在“defualt”安全组中添加一条策略，从入口方向放行所有UDP规则，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group rule create --protocol udp --ingress  default</span><br><span class="line">+-------------------+------------------------------------------------------------------+</span><br><span class="line">| Field             | Value                                                            |</span><br><span class="line">+-------------------+------------------------------------------------------------------+</span><br><span class="line">| created_at        | 2022-02-10T04:48:22Z                                             |</span><br><span class="line">| description       |                                                                  |</span><br><span class="line">| direction         | ingress                                                          |</span><br><span class="line">| ether_type        | IPv4                                                             |</span><br><span class="line">| id                | 9ec501e5-2c16-4d89-8a15-57a16a8fe3cd                             |</span><br><span class="line">| location          | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;000000&#x27;, </span><br><span class="line">project.id=&#x27;1776912d52a7444d8b2d09eb86e8d1d9&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;,</span><br><span class="line"> zone=                                                                                 |</span><br><span class="line">| name              | None                                                             |</span><br><span class="line">| port_range_max    | None                                                             |</span><br><span class="line">| port_range_min    | None                                                             |</span><br><span class="line">| project_id        | 1776912d52a7444d8b2d09eb86e8d1d9                                 |</span><br><span class="line">| protocol          | udp                                                              |</span><br><span class="line">| remote_group_id   | None                                                             |</span><br><span class="line">| remote_ip_prefix  | 0.0.0.0/0                                                        |</span><br><span class="line">| revision_number   | 0                                                                |</span><br><span class="line">| security_group_id | 896ce430-21f8-4673-8110-afce97e43715                             |</span><br><span class="line">| tags              | []                                                               |</span><br><span class="line">| updated_at        | 2022-02-10T04:48:22Z                                             |</span><br><span class="line">+-------------------+------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>查看“default”安全组中所有的规则列表信息，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group rule list default</span><br><span class="line">+--------------------+-----------+---------+-------   -+----------+---------------------+</span><br><span class="line">| ID                 |IP Protocol|Ethertype| IP Range  |Port Range|Remote Security Group|</span><br><span class="line">+--------------------+-----------+---------+-----------+----------+---------------------+</span><br><span class="line">| 03ace6cf-ec1a-42a9 | tcp       | IPv4    | 0.0.0.0/0 |          | None                |</span><br><span class="line">  -a754-c21fe887d1c0</span><br><span class="line">| 1e6c27ff-b456-4d2a | None      | IPv4    | 0.0.0.0/0 |          | 896ce430-21f8-4673  |</span><br><span class="line">  -a64d-51197fea048e                                                -8110-afce97e43715</span><br><span class="line">| 61014f36-5c20-46ce | icmp      | IPv4    | 0.0.0.0/0 |          | None                |</span><br><span class="line">  -b779-7d0c7458e691</span><br><span class="line">| 699e2744-e926-4bb4 | None      | IPv6    | ::/0      |          | None                |</span><br><span class="line">  -9e4f-54885f669bc5</span><br><span class="line">| 7aa363c8-5df3-4ce3 | None      | IPv6    | ::/0      |          | 896ce430-21f8-4673  |</span><br><span class="line">  -a775-9e453f086c87                                                -8110-afce97e43715</span><br><span class="line">| 9ec501e5-2c16-4d89 | udp       | IPv4    | 0.0.0.0/0 |          | None                |</span><br><span class="line">  -8a15-57a16a8fe3cd</span><br><span class="line">| bb08b786-09f4-44f3 | None      | IPv4    | 0.0.0.0/0 |          | None                |</span><br><span class="line">  -a030-71b189a0f84f</span><br><span class="line">+--------------------+-----------+---------+-----------+----------+---------------------+</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="启动虚拟机"><a href="#启动虚拟机" class="headerlink" title="启动虚拟机"></a>启动虚拟机</h3><p>（1）查询可用镜像</p>
<p>使用“openstack image list”命令查看当前可用镜像列表。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack image list</span><br><span class="line">+--------------------------------------+--------------+--------+</span><br><span class="line">| ID                                   | Name         | Status |</span><br><span class="line">+--------------------------------------+--------------+--------+</span><br><span class="line">| 32a2513c-e5ba-438b-a5ee-63c35c03b284 | cirros-0.3.4 | active |</span><br><span class="line">+--------------------------------------+--------------+--------+</span><br></pre></td></tr></table></figure>

<p>使用“openstack flavor list”命令查看可用的类型。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack flavor list</span><br><span class="line">+----+--------+------+------+-----------+-------+-----------+</span><br><span class="line">| ID | Name   |  RAM | Disk | Ephemeral | VCPUs | Is Public |</span><br><span class="line">+----+--------+------+------+-----------+-------+-----------+</span><br><span class="line">| 1  | centos | 1024 |   10 |         0 |     2 | True      |</span><br><span class="line">+----+--------+------+------+-----------+-------+-----------+</span><br></pre></td></tr></table></figure>

<p>（2）创建网络和子网</p>
<p>使用“openstack network create ”命令创建网络息。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack network create --provider-network-type vlan --provider-physical-network provider network-vlan --provider-segment 200</span><br><span class="line">+---------------------------+-----------------------------------------------------------+</span><br><span class="line">| Field                     | Value                                                     |</span><br><span class="line">+---------------------------+-----------------------------------------------------------+</span><br><span class="line">| admin_state_up            | UP                                                        |</span><br><span class="line">| availability_zone_hints   |                                                           |</span><br><span class="line">| availability_zones        |                                                           |</span><br><span class="line">| created_at                | 2022-02-10T05:02:18Z                                      |</span><br><span class="line">| description               |                                                           |</span><br><span class="line">| dns_domain                | None                                                      |</span><br><span class="line">| id                        | cccedc78-027d-40e9-afbd-708154923ca6                      |</span><br><span class="line">| ipv4_address_scope        | None                                                      |</span><br><span class="line">| ipv6_address_scope        | None                                                      |</span><br><span class="line">| is_default                | False                                                     |</span><br><span class="line">| is_vlan_transparent       | None                                                      |</span><br><span class="line">| location                  | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;000000&#x27;,</span><br><span class="line"> project.id=&#x27;1776912d52a7444d8b2d09eb86e8d1d9&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;,</span><br><span class="line"> zone=                                                                                  |</span><br><span class="line">| mtu                       | 1500                                                      |</span><br><span class="line">| name                      | network-vlan                                              |</span><br><span class="line">| port_security_enabled     | True                                                      |</span><br><span class="line">| project_id                | 1776912d52a7444d8b2d09eb86e8d1d9                          |</span><br><span class="line">| provider:network_type     | vlan                                                      |</span><br><span class="line">| provider:physical_network | provider                                                  |</span><br><span class="line">| provider:segmentation_id  | 200                                                       |</span><br><span class="line">| qos_policy_id             | None                                                      |</span><br><span class="line">| revision_number           | 1                                                         |</span><br><span class="line">| router:external           | Internal                                                  |</span><br><span class="line">| segments                  | None                                                      |</span><br><span class="line">| shared                    | False                                                     |</span><br><span class="line">| status                    | ACTIVE                                                    |</span><br><span class="line">| subnets                   |                                                           |</span><br><span class="line">| tags                      |                                                           |</span><br><span class="line">| updated_at                | 2022-02-10T05:02:18Z                                      |</span><br><span class="line">+---------------------------+-----------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>使用“openstack subnet create”创建子网。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack subnet list</span><br><span class="line">[root@controller ~]# openstack subnet create  --network network-vlan  --allocation-pool start=192.168.200.100,end=192.168.200.200 --gateway 192.168.200.1 --subnet-range 192.168.200.0/24  subnet-vlan</span><br><span class="line">+-------------------+------------------------------------------------------------------+</span><br><span class="line">| Field             | Value                                                            |</span><br><span class="line">+-------------------+------------------------------------------------------------------+</span><br><span class="line">| allocation_pools  | 192.168.200.100-192.168.200.200                                  |</span><br><span class="line">| cidr              | 192.168.200.0/24                                                 |</span><br><span class="line">| created_at        | 2022-02-10T05:03:52Z                                             |</span><br><span class="line">| description       |                                                                  |</span><br><span class="line">| dns_nameservers   |                                                                  |</span><br><span class="line">| enable_dhcp       | True                                                             |</span><br><span class="line">| gateway_ip        | 192.168.200.1                                                    |</span><br><span class="line">| host_routes       |                                                                  |</span><br><span class="line">| id                | 69c14fff-de95-440a-bc8e-fe9f43e4b424                             |</span><br><span class="line">| ip_version        | 4                                                                |</span><br><span class="line">| ipv6_address_mode | None                                                             |</span><br><span class="line">| ipv6_ra_mode      | None                                                             |</span><br><span class="line">| location          | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;000000&#x27;,</span><br><span class="line"> project.id=&#x27;1776912d52a7444d8b2d09eb86e8d1d9&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;,</span><br><span class="line"> zone=                                                                                 |</span><br><span class="line">| name              | subnet-vlan                                                      |</span><br><span class="line">| network_id        | cccedc78-027d-40e9-afbd-708154923ca6                             |</span><br><span class="line">| prefix_length     | None                                                             |</span><br><span class="line">| project_id        | 1776912d52a7444d8b2d09eb86e8d1d9                                 |</span><br><span class="line">| revision_number   | 0                                                                |</span><br><span class="line">| segment_id        | None                                                             |</span><br><span class="line">| service_types     |                                                                  |</span><br><span class="line">| subnetpool_id     | None                                                             |</span><br><span class="line">| tags              |                                                                  |</span><br><span class="line">| updated_at        | 2022-02-10T05:03:52Z                                             |</span><br><span class="line">+-------------------+------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（3）修改openstack平台（云主机则跳过）</p>
<p>因为当前环境为本地PC环境的VMWare Workstation软件启动的虚拟机，所以在此openstack平台启动云主机，需要对openstack平台配置文件进行修改，修改nova服务配置文件，设置参数“virt_type=qemu”。命令参数如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# crudini --set /etc/nova/nova.conf libvirt virt_type  qemu</span><br><span class="line">[root@compute ~]# systemctl restart openstack-nova-compute</span><br></pre></td></tr></table></figure>

<p>（4）启动云主机</p>
<p>使用“openstack server create”命令创建云主机，其命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help server create</span><br><span class="line">usage: openstack server create [-h] [-f &#123;json,shell,table,value,yaml&#125;]</span><br><span class="line">                               [-c COLUMN] [--max-width ]</span><br><span class="line">                               [--fit-width] [--print-empty] [--noindent]</span><br><span class="line">                               [--prefix PREFIX]</span><br><span class="line">                               (--image  | --volume ) --flavor</span><br><span class="line">                                [--security-group ]</span><br><span class="line">                               [--key-name ]</span><br><span class="line">                               [--property ]</span><br><span class="line">                               [--file ]</span><br><span class="line">                               [--user-data ]</span><br><span class="line">                               [--availability-zone ]</span><br><span class="line">                               [--block-device-mapping ]</span><br><span class="line">                               [--nic ]</span><br><span class="line">                               [--network ] [--port ]</span><br><span class="line">                               [--hint ]</span><br><span class="line">                               [--config-drive |True]</span><br><span class="line">                               [--min ] [--max ] [--wait]</span><br><span class="line">                               </span><br></pre></td></tr></table></figure>

<p>通过命令创建云主机，使用cirros镜像，flavor为2核vCPU、1G内存、10G硬盘，使用network-vlan网络。云主机名为“cirros-test”创建命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server create --image cirros-0.3.4 --flavor 1 --network network-vlan cirros-test</span><br><span class="line">+-------------------------------------+-----------------------------------------------------+</span><br><span class="line">| Field                               | Value                                               |</span><br><span class="line">+-------------------------------------+-----------------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig                   | MANUAL                                              |</span><br><span class="line">| OS-EXT-AZ:availability_zone         |                                                     |</span><br><span class="line">| OS-EXT-SRV-ATTR:host                | None                                                |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                                |</span><br><span class="line">| OS-EXT-SRV-ATTR:instance_name       |                                                     |</span><br><span class="line">| OS-EXT-STS:power_state              | NOSTATE                                             |</span><br><span class="line">| OS-EXT-STS:task_state               | scheduling                                          |</span><br><span class="line">| OS-EXT-STS:vm_state                 | building                                            |</span><br><span class="line">| OS-SRV-USG:launched_at              | None                                                |</span><br><span class="line">| OS-SRV-USG:terminated_at            | None                                                |</span><br><span class="line">| accessIPv4                          |                                                     |</span><br><span class="line">| accessIPv6                          |                                                     |</span><br><span class="line">| addresses                           |                                                     |</span><br><span class="line">| adminPass                           | 77zZUHVY7Krg                                        |</span><br><span class="line">| config_drive                        |                                                     |</span><br><span class="line">| created                             | 2022-02-10T05:05:59Z                                |</span><br><span class="line">| flavor                              | centos (1)                                          |</span><br><span class="line">| hostId                              |                                                     |</span><br><span class="line">| id                                  | 7e424f14-eed1-44f5-a29a-0b64749cbc4d                |</span><br><span class="line">| image                               | cirros-0.3.4 (32a2513c-e5ba-438b-a5ee-63c35c03b284) |</span><br><span class="line">| key_name                            | None                                                |</span><br><span class="line">| name                                | cirros-test                                         |</span><br><span class="line">| progress                            | 0                                                   |</span><br><span class="line">| project_id                          | 1776912d52a7444d8b2d09eb86e8d1d9                    |</span><br><span class="line">| properties                          |                                                     |</span><br><span class="line">| security_groups                     | name=&#x27;default&#x27;                                      |</span><br><span class="line">| status                              | BUILD                                               |</span><br><span class="line">| updated                             | 2022-02-10T05:05:59Z                                |</span><br><span class="line">| user_id                             | e415c8bc53884e72a7993dffbcde2a1e                    |</span><br><span class="line">| volumes_attached                    |                                                     |</span><br><span class="line">+-------------------------------------+-----------------------------------------------------+</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="管理虚拟机"><a href="#管理虚拟机" class="headerlink" title="管理虚拟机"></a>管理虚拟机</h3><p>（1）查看虚拟机</p>
<p>使用“openstack server list”命令查看虚拟机列表信息，使用命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server list</span><br><span class="line">+--------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| ID                 | Name        | Status | Networks        | Image        | Flavor |</span><br><span class="line">+--------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| 7e424f14-eed1-44f5 | cirros-test | ACTIVE | network-vlan=   | cirros-0.3.4 | centos |</span><br><span class="line">  -a29a-0b64749cbc4d                          192.168.200.132</span><br><span class="line">+--------------------+-------------+--------+-----------------+--------------+--------+</span><br></pre></td></tr></table></figure>

<p>使用命令可以查看虚拟机的具体信息，包括使用的安全组、flavor以及网络信息，通过命令“openstack server show”进行查看。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server show cirros-test</span><br><span class="line">+-------------------------------------+----------------------------------------------------------+</span><br><span class="line">| Field                               | Value                                                    |</span><br><span class="line">+-------------------------------------+----------------------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig                   | MANUAL                                                   |</span><br><span class="line">| OS-EXT-AZ:availability_zone         | nova                                                     |</span><br><span class="line">| OS-EXT-SRV-ATTR:host                | compute                                                  |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | compute                                                  |</span><br><span class="line">| OS-EXT-SRV-ATTR:instance_name       | instance-00000001                                        |</span><br><span class="line">| OS-EXT-STS:power_state              | Running                                                  |</span><br><span class="line">| OS-EXT-STS:task_state               | None                                                     |</span><br><span class="line">| OS-EXT-STS:vm_state                 | active                                                   |</span><br><span class="line">| OS-SRV-USG:launched_at              | 2022-02-10T05:06:13.000000                               |</span><br><span class="line">| OS-SRV-USG:terminated_at            | None                                                     |</span><br><span class="line">| accessIPv4                          |                                                          |</span><br><span class="line">| accessIPv6                          |                                                          |</span><br><span class="line">| addresses                           | network-vlan=192.168.200.132                             |</span><br><span class="line">| config_drive                        |                                                          |</span><br><span class="line">| created                             | 2022-02-10T05:05:59Z                                     |</span><br><span class="line">| flavor                              | centos (1)                                               |</span><br><span class="line">| hostId                              | 736518b10ef6cb7486f2b93262900c0cabc8e7f84bba5a7a8347c7e0 |</span><br><span class="line">| id                                  | 7e424f14-eed1-44f5-a29a-0b64749cbc4d                     |</span><br><span class="line">| image                               | cirros-0.3.4 (32a2513c-e5ba-438b-a5ee-63c35c03b284)      |</span><br><span class="line">| key_name                            | None                                                     |</span><br><span class="line">| name                                | cirros-test                                              |</span><br><span class="line">| progress                            | 0                                                        |</span><br><span class="line">| project_id                          | 1776912d52a7444d8b2d09eb86e8d1d9                         |</span><br><span class="line">| properties                          |                                                          |</span><br><span class="line">| security_groups                     | name=&#x27;default&#x27;                                           |</span><br><span class="line">| status                              | ACTIVE                                                   |</span><br><span class="line">| updated                             | 2022-02-10T05:06:13Z                                     |</span><br><span class="line">| user_id                             | e415c8bc53884e72a7993dffbcde2a1e                         |</span><br><span class="line">| volumes_attached                    |                                                          |</span><br><span class="line">+-------------------------------------+----------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（2）操作虚拟机</p>
<p>可以通过命令操作虚拟机，对虚拟机进行关机、开机、重启等操作。关闭虚拟机操作，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server stop cirros-test</span><br><span class="line">+-------------------------+-------------+---------+-----------------+--------------+--------+</span><br><span class="line">| ID                      | Name        | Status  | Networks        | Image        | Flavor |</span><br><span class="line">+-------------------------+-------------+---------+-----------------+--------------+--------+</span><br><span class="line">| 7e424f14-eed1-44f5-a29a | cirros-test | SHUTOFF | network-vlan=   | cirros-0.3.4 | centos |</span><br><span class="line">  -0b64749cbc4d                                     192.168.200.132</span><br><span class="line">+-------------------------+-------------+---------+-----------------+--------------+--------+</span><br></pre></td></tr></table></figure>

<p>通过命令操作虚拟机，对虚拟机进行开机操作，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server start cirros-test</span><br><span class="line">[root@controller ~]# openstack server list</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| ID                      | Name        | Status | Networks        | Image        | Flavor |</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| 7e424f14-eed1-44f5-a29a | cirros-test | ACTIVE | network-vlan=   | cirros-0.3.4 | centos |</span><br><span class="line">  -0b64749cbc4d                                    192.168.200.132</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br></pre></td></tr></table></figure>

<p>通过命令操作虚拟机，对虚拟机进行重启操作，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server reboot cirros-test</span><br><span class="line">[root@controller ~]# openstack server list</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| ID                      | Name        | Status | Networks        | Image        | Flavor |</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| 7e424f14-eed1-44f5-a29a | cirros-test | ACTIVE | network-vlan=   | cirros-0.3.4 | centos |</span><br><span class="line">  -0b64749cbc4d                                    192.168.200.132</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="云主机调整类型大小"><a href="#云主机调整类型大小" class="headerlink" title="云主机调整类型大小"></a>云主机调整类型大小</h3><p>（1）修改配置文件</p>
<p>修改controller节点和compute节点nova.conf配置文件，添加调整类型大小的参数。</p>
<p>controller节点设置参数如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# crudini --set /etc/nova/nova.conf DEFAULT allow_resize_to_same_host True</span><br><span class="line">[root@controller ~]# crudini --set /etc/nova/nova.conf DEFAULT scheduler_default_filters RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter,ServerGroupAntiAffinityFilter,ServerGroupAffinityFilter</span><br></pre></td></tr></table></figure>

<p>修改完配置文件后重启相关服务。命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# systemctl restart openstack-nova*</span><br></pre></td></tr></table></figure>

<p>compute节点设置参数如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# crudini --set /etc/nova/nova.conf DEFAULT allow_resize_to_same_host True</span><br><span class="line">[root@compute ~]# crudini --set /etc/nova/nova.conf DEFAULT scheduler_default_filters RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter,ServerGroupAntiAffinityFilter,ServerGroupAffinityFilter</span><br></pre></td></tr></table></figure>

<p>修改完配置文件后重启相关服务。命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# systemctl restart openstack-nova-compute</span><br></pre></td></tr></table></figure>

<p>（2）创建云主机类型</p>
<p>现有云主机硬盘和内存不满足使用，需要对现有云主机进行资源扩容，将内存扩容至2G，硬盘扩容至15G大小，类型名称为“centos1”首先创建一个新的云主机类型满足扩容资源的需求。通过命令创建新云主机类型，命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]#  openstack flavor create --disk 15 --ram 2048 --vcpus 2 centos1</span><br><span class="line">+----------------------------+--------------------------------------+</span><br><span class="line">| Field                      | Value                                |</span><br><span class="line">+----------------------------+--------------------------------------+</span><br><span class="line">| OS-FLV-DISABLED:disabled   | False                                |</span><br><span class="line">| OS-FLV-EXT-DATA:ephemeral  | 0                                    |</span><br><span class="line">| disk                       | 15                                   |</span><br><span class="line">| id                         | 182eac11-33b4-4153-8f8f-42e67c67e8bf |</span><br><span class="line">| name                       | centos1                              |</span><br><span class="line">| os-flavor-access:is_public | True                                 |</span><br><span class="line">| properties                 |                                      |</span><br><span class="line">| ram                        | 2048                                 |</span><br><span class="line">| rxtx_factor                | 1.0                                  |</span><br><span class="line">| swap                       |                                      |</span><br><span class="line">| vcpus                      | 2                                    |</span><br><span class="line">+----------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<p>查看当前云主机类型列表，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack flavor list</span><br><span class="line">+--------------------------------------+---------+------+------+-----------+-------+-----------+</span><br><span class="line">| ID                                   | Name    |  RAM | Disk | Ephemeral | VCPUs | Is Public |</span><br><span class="line">+--------------------------------------+---------+------+------+-----------+-------+-----------+</span><br><span class="line">| 1                                    | centos  | 1024 |   10 |         0 |     2 | True      |</span><br><span class="line">| 182eac11-33b4-4153-8f8f-42e67c67e8bf | centos1 | 2048 |   15 |         0 |     2 | True      |</span><br><span class="line">+--------------------------------------+---------+------+------+-----------+-------+-----------+</span><br></pre></td></tr></table></figure>

<p>（3）调整云主机类型</p>
<p>查看云主机列表，通过命令查看云主机列表。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server list</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| ID                      | Name        | Status | Networks        | Image        | Flavor |</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br><span class="line">| 7e424f14-eed1-44f5-a29a | cirros-test | ACTIVE | network-vlan=   | cirros-0.3.4 | centos |</span><br><span class="line">  -0b64749cbc4d                                    192.168.200.132</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+--------+</span><br></pre></td></tr></table></figure>

<p>使用命令“openstack server resize”调整云主机类型，命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help server resize  </span><br><span class="line">usage: openstack server resize [-h] [--flavor  | --confirm | --revert]</span><br><span class="line">                               [--wait]</span><br><span class="line">                               &lt;server&gt;</span><br><span class="line"></span><br><span class="line">  &lt;server&gt;           Server (name or ID)</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help         show this help message and exit</span><br><span class="line">  --flavor   Resize server to specified flavor</span><br><span class="line">  --confirm          Confirm server resize is complete</span><br><span class="line">  --revert           Restore server state before resize</span><br><span class="line">  --wait             Wait for resize to complete</span><br></pre></td></tr></table></figure>

<p>使用命令调整云主机“cirros-test”类型为centos1，使用–wait参数，在命令执行后，调整云主机需要一定时间，添加–wait参数后会在确认时回馈“complete”。命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server resize --flavor centos1 --wait cirros-test</span><br><span class="line">Complete</span><br><span class="line">[root@controller ~]# openstack server list</span><br><span class="line">+-------------------------+-------------+---------------+-----------------+--------------+---------+</span><br><span class="line">| ID                      | Name        | Status        | Networks        | Image        | Flavor  |</span><br><span class="line">+-------------------------+-------------+---------------+-----------------+--------------+---------+</span><br><span class="line">| 7e424f14-eed1-44f5-a29a | cirros-test | VERIFY_RESIZE | network-vlan=   | cirros-0.3.4 | centos1 |</span><br><span class="line">  -0b64749cbc4d                                           192.168.200.132</span><br><span class="line">+-------------------------+-------------+---------------+-----------------+--------------+---------+</span><br></pre></td></tr></table></figure>

<p>在命令执行完毕后，返回“Complete”值时，通过命令查看云主机列表信息。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server list</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+---------+</span><br><span class="line">| ID                      | Name        | Status | Networks        | Image        | Flavor  |</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+---------+</span><br><span class="line">| 7e424f14-eed1-44f5-a29a | cirros-test | ACTIVE | network-vlan=   | cirros-0.3.4 | centos1 |</span><br><span class="line">  -0b64749cbc4d                                    192.168.200.132</span><br><span class="line">+-------------------------+-------------+--------+-----------------+--------------+---------+</span><br></pre></td></tr></table></figure>

<h1 id="案例三：Cinder服务的基本使用"><a href="#案例三：Cinder服务的基本使用" class="headerlink" title="案例三：Cinder服务的基本使用"></a>案例三：Cinder服务的基本使用</h1><h2 id="案例准备-2"><a href="#案例准备-2" class="headerlink" title="案例准备"></a>案例准备</h2><h3 id="规划节点-2"><a href="#规划节点-2" class="headerlink" title="规划节点"></a>规划节点</h3><p>节点规划见表3。</p>
<p>表3 节点规划</p>
<table>
<thead>
<tr>
<th><strong>IP</strong></th>
<th><strong>主机名</strong></th>
<th><strong>节点</strong></th>
</tr>
</thead>
<tbody><tr>
<td>172.128.11.13</td>
<td>controller</td>
<td>控制节点</td>
</tr>
<tr>
<td>172.128.11.19</td>
<td>compute</td>
<td>计算节点</td>
</tr>
</tbody></table>
<h3 id="基础准备-2"><a href="#基础准备-2" class="headerlink" title="基础准备"></a>基础准备</h3><p>登录物理OpenStack平台，使用云主机搭建的OpenStack平台作为实验节点。</p>
<h2 id="案例实施-2"><a href="#案例实施-2" class="headerlink" title="案例实施"></a>案例实施</h2><h3 id="Cinder概述"><a href="#Cinder概述" class="headerlink" title="Cinder概述"></a>Cinder概述</h3><p>OpenStack早期版本是使用nova-volume为云平台提供持久性块存储服务器的。从Folsom版本后，就把作为Nova组成部分的nova-volume分离了出来，形成了独立的Cinder组件。Cinder本身并不直接提供块存储设备实际的管理和服务，而是在虚拟机和具体的存储设备之间引入一个抽象的“逻辑存储卷”。Cinder与Neutron类似也是通过Plugins-Agent的方式通过添加了不同厂家的DRIVE来整合多种厂家的后端存储设备，并通过提供统一的API接口的方式为云平台提供持久性的块设备存储服务，类似于Amazon的EBS（Elastic Block Storage）。Cinder服务的实现在OpenStack众多服务中，只依赖Keystone服务提供认证。可能有些人觉得Cinder提供的Volume作为云主机的云磁盘，因此Cinder与Nova也有依赖关系。其实，这是一种错误的映像，Cinder-Volume创建的“逻辑存储卷”不仅可以用于云主机的云磁盘，也可以用于其他场景，其创建卷的过程与Nova创建的云主机的状态并没有直接关联。或者换个角度来看，Nova创建的云主机也可以不用挂载Cinder创建的Volume而正常运行。</p>
<hr>
<h3 id="Cinder架构"><a href="#Cinder架构" class="headerlink" title="Cinder架构"></a>Cinder架构</h3><p>在OpenStack中，块存储服务Cinder为Nova项目所实现的虚拟机实例提供了数据持久性的存储服务。此外，块存储还提供了Volumes管理的基础架构，同时还负责Volumes的快照和类型管理。从功能层面来看，Cinder以插件架构的形式为各种存储后端提供了统一API访问接口的抽象层实现，使得存储客户端可以通过统一的API访问不同的存储资源，而不用担心底层各式各样的存储驱动。Cinder提供的块存储通常以存储卷的形式挂载到虚拟机后才能使用，目前一个Volume同时只能挂载到一个虚拟机，但是不同的时刻可以挂载到不同的虚拟机，因此Cinder块存储与AWS的EBS不同，不能像EBS一样提供共享存储解决方案。除了挂载到虚拟机作为块存储使用外，用户还可以将系统镜像写入块存储并从加载有镜像的Volume启动系统（SAN BOOT）。</p>
<p>Cinder的逻辑架构如图3-1所示，除了cinder-client外，其余均是Cinder服务的核心组件，共有4个：cinder-api、cinder-scheduler、cinder-volume和cinder-backup。而cinder-client其实就是封装了Cinder提供的REST接口的CLI工具。</p>
<p><img src="../../../../images/image/DX/36.png" alt="36"></p>
<p>图3-1 cinder逻辑架构图</p>
<p>（1）cinder-api</p>
<p>对外提供REST API，对操作需求进行解析，对API进行路由并寻找相应的处理方法，包含卷的CRUD，快照的CRUD、备份、Volume Type的管理、卷的挂载/卸载等操作。Cinder API本质上其实是一个WSGI App，启动Cinder API服务相当于启动一个名为osapi_volume的WSGI服务去监听Client的HTTP请求。OpenStack定义了两种类型的Cinder资源，包括核心资源（Core Resoure）和扩展资源（Extension Resoure）。而核心资源及其API路由器分为V1及V2两个版本，分别放在V1和V2两个目录下，其中API路由器（目录中的router.py）负责把HTTP请求分发到其管理的核心资源中去；V1的核心资源则包括卷（Volume）、卷类型（Volume Type）、快照（Snapshot）的操作管理，比如创建和删除一个卷，或为某个卷做一个快照等；V2的核心资源增加了Qos、limit及备份的操作管理（H版本以后）。</p>
<p>（2）Cinder-scheduler</p>
<p>负责收集后端存储Backends上报的容量、能力信息。根据指定的算法完成卷到cinder-volume的映射。在Folsom版本中，cinder-scheduler服务只是实现了简单调度（Simple Scheduler）算法和随机调度（Chancer Scheduler）算法。简单调度算法就是获取活动的卷服务节点，按剩余容量从小到大排列，选择剩余容量最多的Host节点；随机调度算法就是在满足条件的节点中随机挑选出一个Host节点。在G版本后有了类似nova-scheduler的基于过滤和权重的新调度策略FilterScheduler。</p>
<p>（3）Cinder-volume</p>
<p>多节点部署，使用不同的配置文件、接入不同的backend设备，由各存储厂商插入driver代码与设备交互完成设备容量和能力信息收集、卷操作。每个存储节点都会运行一个cinder-volume服务，若干个这样的存储节点联合起来可以构成一个存储资源池。</p>
<p>（4）Cinder-backup</p>
<p>实现卷的数据备份到其他介质。目前支持的有以Ceph、Swift和IBM TSM（Tivoli Storage Manager）为后端存储的备份存储系统，其中默认的是采用Swift备份的存储系统。与Cinder-volume类似，Cinder-backup也通过Driver插件架构的形式与不同的存储备份后端交互。</p>
<p>（5）Cinder-db</p>
<p>提供存储卷、快照、备份、service等数据，支持Mysql、PG、MSSQL等SQL数据库。</p>
<hr>
<h3 id="块存储服务"><a href="#块存储服务" class="headerlink" title="块存储服务"></a>块存储服务</h3><p>（1）查看服务状态</p>
<p>使用“openstack volume service list”命令查询块存储服务状态，命令代码如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack volume service list</span><br><span class="line">+------------------+-------------+------+---------+-------+----------------------------+</span><br><span class="line">| Binary           | Host        | Zone | Status  | State | Updated At                 |</span><br><span class="line">+------------------+-------------+------+---------+-------+----------------------------+</span><br><span class="line">| cinder-volume    | compute@lvm | nova | enabled | up    | 2022-02-10T05:21:08.000000 |</span><br><span class="line">| cinder-scheduler | controller  | nova | enabled | up    | 2022-02-10T05:21:06.000000 |</span><br><span class="line">+------------------+-------------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>

<p>（2）创建块存储</p>
<p>通过使用命令“openstack volume create”创建块存储，命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help volume create </span><br><span class="line">usage: openstack volume create [-h] [-f &#123;json,shell,table,value,yaml&#125;]</span><br><span class="line">                               [-c COLUMN] [--max-width ]</span><br><span class="line">                               [--fit-width] [--print-empty] [--noindent]</span><br><span class="line">                               [--prefix PREFIX] [--size ]</span><br><span class="line">                               [--type ]</span><br><span class="line">                               [--image  | --snapshot  | --source  | --source-replicated ]</span><br><span class="line">                               [--description ] [--user ]</span><br><span class="line">                               [--project ]</span><br><span class="line">                               [--availability-zone ]</span><br><span class="line">                               [--consistency-group consistency-group&gt;]</span><br><span class="line">                               [--property ] [--hint ]</span><br><span class="line">                               [--multi-attach] [--bootable | --non-bootable]</span><br><span class="line">                               [--read-only | --read-write]</span><br><span class="line">                               </span><br></pre></td></tr></table></figure>

<p>通过命令创建块存储，大小为2G，名称为“volume”。命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack volume create --size 2 volume</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| Field               | Value                                |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| attachments         | []                                   |</span><br><span class="line">| availability_zone   | nova                                 |</span><br><span class="line">| bootable            | false                                |</span><br><span class="line">| consistencygroup_id | None                                 |</span><br><span class="line">| created_at          | 2022-02-10T05:21:32.000000           |</span><br><span class="line">| description         | None                                 |</span><br><span class="line">| encrypted           | False                                |</span><br><span class="line">| id                  | 67634904-65eb-471f-9ab6-79296e2494b7 |</span><br><span class="line">| migration_status    | None                                 |</span><br><span class="line">| multiattach         | False                                |</span><br><span class="line">| name                | volume                               |</span><br><span class="line">| properties          |                                      |</span><br><span class="line">| replication_status  | None                                 |</span><br><span class="line">| size                | 2                                    |</span><br><span class="line">| snapshot_id         | None                                 |</span><br><span class="line">| source_volid        | None                                 |</span><br><span class="line">| status              | creating                             |</span><br><span class="line">| type                | None                                 |</span><br><span class="line">| updated_at          | None                                 |</span><br><span class="line">| user_id             | e415c8bc53884e72a7993dffbcde2a1e     |</span><br><span class="line">+---------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（3）查看块存储</p>
<p>使用“openstack volume list”命令查看块存储列表信息。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack volume list</span><br><span class="line">+--------------------------------------+--------+-----------+------+-------------+</span><br><span class="line">| ID                                   | Name   | Status    | Size | Attached to |</span><br><span class="line">+--------------------------------------+--------+-----------+------+-------------+</span><br><span class="line">| 67634904-65eb-471f-9ab6-79296e2494b7 | volume | available |    2 |             |</span><br><span class="line">+--------------------------------------+--------+-----------+------+-------------+</span><br></pre></td></tr></table></figure>

<p>通过openstack命令查看某一块存储的详细信息。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack volume show volume</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| Field                          | Value                                |</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| attachments                    | []                                   |</span><br><span class="line">| availability_zone              | nova                                 |</span><br><span class="line">| bootable                       | false                                |</span><br><span class="line">| consistencygroup_id            | None                                 |</span><br><span class="line">| created_at                     | 2022-02-10T05:21:32.000000           |</span><br><span class="line">| description                    | None                                 |</span><br><span class="line">| encrypted                      | False                                |</span><br><span class="line">| id                             | 67634904-65eb-471f-9ab6-79296e2494b7 |</span><br><span class="line">| migration_status               | None                                 |</span><br><span class="line">| multiattach                    | False                                |</span><br><span class="line">| name                           | volume                               |</span><br><span class="line">| os-vol-host-attr:host          | compute@lvm#LVM                      |</span><br><span class="line">| os-vol-mig-status-attr:migstat | None                                 |</span><br><span class="line">| os-vol-mig-status-attr:name_id | None                                 |</span><br><span class="line">| os-vol-tenant-attr:tenant_id   | 1776912d52a7444d8b2d09eb86e8d1d9     |</span><br><span class="line">| properties                     |                                      |</span><br><span class="line">| replication_status             | None                                 |</span><br><span class="line">| size                           | 2                                    |</span><br><span class="line">| snapshot_id                    | None                                 |</span><br><span class="line">| source_volid                   | None                                 |</span><br><span class="line">| status                         | available                            |</span><br><span class="line">| type                           | None                                 |</span><br><span class="line">| updated_at                     | 2022-02-10T05:21:33.000000           |</span><br><span class="line">| user_id                        | e415c8bc53884e72a7993dffbcde2a1e     |</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（4）挂载云硬盘</p>
<p>块存储设备创建成功后，可以在OpenStack上将该设备挂载至云主机上，可以作为一块云硬盘来进行使用。给云主机添加一块磁盘。</p>
<p>将块存储挂载至云主机的命令为“openstack server add volume”，其命令格式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help server add volume</span><br><span class="line">usage: openstack server add volume [-h] [--device ]  </span><br><span class="line"></span><br><span class="line">Add volume to server</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">             Server (name or ID)</span><br><span class="line">             Volume to add (name or ID)</span><br></pre></td></tr></table></figure>

<p>使用命令将创建的“volume”块存储添加至云主机“cirros-test”上。命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server add volume cirros-test volume</span><br></pre></td></tr></table></figure>

<p>使用命令查看块存储的列表信息，命令代码如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack volume list</span><br><span class="line">+-------------------------+--------+--------+------+--------------------------------------+</span><br><span class="line">| ID                      | Name   | Status | Size | Attached to                          |</span><br><span class="line">+-------------------------+--------+--------+------+--------------------------------------+</span><br><span class="line">| 67634904-65eb-471f-9ab6 | volume | in-use |    2 | Attached to cirros-test on /dev/vdb  |</span><br><span class="line">  -79296e2494b7</span><br><span class="line">+-------------------------+--------+--------+------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="扩展卷"><a href="#扩展卷" class="headerlink" title="扩展卷"></a>扩展卷</h3><p>（1）扩展卷大小</p>
<p>创建完卷后可能因为需求的变更，需要对已有的卷进行扩容操作，这时需要用到“openstack volume set”命令修改卷的信息。命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack  help  volume set</span><br><span class="line">usage: openstack volume set [-h] [--name ] [--size ]</span><br><span class="line">                            [--description ] [--no-property]</span><br><span class="line">                            [--property ]</span><br><span class="line">                            [--image-property ] [--state ]</span><br><span class="line">                            [--type ]</span><br><span class="line">                            [--retype-policy ]</span><br><span class="line">                            [--bootable | --non-bootable]</span><br><span class="line">                            [--read-only | --read-write]</span><br><span class="line">                            </span><br></pre></td></tr></table></figure>

<p>通过命令将 “volume” 卷大小从2G扩容至3G，使用–size参数可修改已创建好的卷大小。命令操作如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack volume list</span><br><span class="line">+-------------------------+--------+--------+------+--------------------------------------+</span><br><span class="line">| ID                      | Name   | Status | Size | Attached to                          |</span><br><span class="line">+-------------------------+--------+--------+------+--------------------------------------+</span><br><span class="line">| 67634904-65eb-471f-9ab6 | volume | in-use |    2 | Attached to cirros-test on /dev/vdb  |</span><br><span class="line">  -79296e2494b7</span><br><span class="line">+-------------------------+--------+--------+------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack volume set --size 3 volume</span><br><span class="line">[root@controller ~]# openstack volume list</span><br><span class="line">+--------------------------------------+--------+-----------+------+-------------+</span><br><span class="line">| ID                                   | Name   | Status    | Size | Attached to |</span><br><span class="line">+--------------------------------------+--------+-----------+------+-------------+</span><br><span class="line">| 67634904-65eb-471f-9ab6-79296e2494b7 | volume | available |    3 |             |</span><br><span class="line">+--------------------------------------+--------+-----------+------+-------------+</span><br></pre></td></tr></table></figure>

<p>（2）验证卷大小</p>
<p>将扩容后的卷“volume”挂载至云主机“cirros-test”上，操作命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack server add volume centos_server volume</span><br><span class="line">[root@controller ~]# openstack volume list</span><br><span class="line">+--------------------------------------+--------+----------+------+-------------+</span><br><span class="line">| ID                                   | Name   | Status   | Size | Attached to |</span><br><span class="line">+--------------------------------------+--------+----------+------+-------------+</span><br><span class="line">| 67634904-65eb-471f-9ab6-79296e2494b7 | volume | reserved |    3 |             |</span><br><span class="line">+--------------------------------------+--------+----------+------+-------------+</span><br></pre></td></tr></table></figure>

<p>可以看到卷“volume”挂载至云主机“cirros-test”上盘符的名称为/dev/vdb，使用dashboard的控制台界面，输入命令“lsblk”查看云硬盘大小是否为3G。命令操作如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lsblk</span></span><br><span class="line">NAME            MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">vda             252:0    0  15G  0 disk</span><br><span class="line">├─vda1          252:1    0   15G  0 part /</span><br><span class="line">vdb             252:16   0   3G  0 disk</span><br></pre></td></tr></table></figure>

<p>可以看到显示盘符“vdb”大小为3G。此时云硬盘已经扩展完成。</p>
<h1 id="案例四：Swift服务的基本使用"><a href="#案例四：Swift服务的基本使用" class="headerlink" title="案例四：Swift服务的基本使用"></a>案例四：Swift服务的基本使用</h1><h2 id="案例准备-3"><a href="#案例准备-3" class="headerlink" title="案例准备"></a>案例准备</h2><h3 id="规划节点-3"><a href="#规划节点-3" class="headerlink" title="规划节点"></a>规划节点</h3><p>节点规划见表4。</p>
<p>表4 节点规划</p>
<table>
<thead>
<tr>
<th><strong>IP</strong></th>
<th><strong>主机名</strong></th>
<th><strong>节点</strong></th>
</tr>
</thead>
<tbody><tr>
<td>172.128.11.13</td>
<td>controller</td>
<td>控制节点</td>
</tr>
<tr>
<td>172.128.11.19</td>
<td>compute</td>
<td>计算节点</td>
</tr>
</tbody></table>
<h3 id="基础准备-3"><a href="#基础准备-3" class="headerlink" title="基础准备"></a>基础准备</h3><p>登录物理OpenStack平台，使用云主机搭建的OpenStack平台作为实验节点。</p>
<h2 id="案例实施-3"><a href="#案例实施-3" class="headerlink" title="案例实施"></a>案例实施</h2><h3 id="Swift概述"><a href="#Swift概述" class="headerlink" title="Swift概述"></a>Swift概述</h3><p>Swift 最初是由Rackspace公司开发的高可用分布式对象存储服务，并于2010年贡献给OpenStack开源社区作为其最初的核心子项目之一，为其Nova子项目提供虚机镜像存储服务。Swift构筑在比较便宜的标准硬件存储基础设施之上，无需采用 RAID（磁盘冗余阵列），通过在软件层面引入一致性散列技术和数据冗余性，牺牲一定程度的数据一致性来达到高可用性和可伸缩性，支持多租户模式、容器和对象读写操作，适合解决互联网的应用场景下非结构化数据存储问题。Swift在OpenStack系统中不依赖于任何服务，可以独立部署为其他系统提供分布式对象存储服务。而在OpenStack的应用中，其Proxy Server往往由Keystone节点兼任，由Keystone来完成服务访问的安全认证。</p>
<p>Swift是业务提供时，使用普通的服务器来构建冗余的、可扩展的分布式对象存储集群，存储容量可达PB级。通过统一REST API进行友好访问，不仅易于扩展，且无中心数据库，避免单点故障或单点性能瓶颈。Swift主要通过Account、Container和Object三个表单结构来完成存储对象的存储、查询、获取和上传等功能，通过数据存储的多副本机制实现数据的高可用。</p>
<hr>
<h3 id="Swift的架构和组件"><a href="#Swift的架构和组件" class="headerlink" title="Swift的架构和组件"></a>Swift的架构和组件</h3><p>Swift的架构是一种完全对称、面向资源的分布式系统架构，所有组件都可扩展，避免因单点失效而影响整个系统运转。通信方式采用非阻塞式 I/O 模式，提高了系统吞吐和响应能力，如下图所示。系统架构整体上采用分层的理念设计，共分为两层：访问层和存储层。Controller的Ring以上部分属于访问层，接收外部REST API的访问，实现负载均衡和访问安全验证，并定位对象数据的存储的位置。后端的Server部分属于存储层，用来分别存储不同的对象数据：Account、Container和Object。</p>
<hr>
<h3 id="Swift中的数据结构原理"><a href="#Swift中的数据结构原理" class="headerlink" title="Swift中的数据结构原理"></a>Swift中的数据结构原理</h3><p>Swift中最重要的算法就是一致性哈希（Consistent Hashing），它是Swift实现海量数据存储，并能实现数据均衡度和可扩展性兼容的保证，可以不过分的认为一致性哈希算法是所有分布式存储的灵魂，不仅Swift中有它的影子，在开源分布式存储Ceph以及华为分布式存储FusionStorage中同样有它的影子。在面对海量级别的对象，需要存放在成千上万台服务器和硬盘设备上，首先要解决寻址问题，即如何将对象均匀地分布到这些设备地址上。这也是Swift中的一致性哈希首先要解决的问题，算法的基本思路是：通过计算可将对象均匀分布到虚拟空间的虚拟节点上，在增加或删除节点时可大大减少需移动的数据量；虚拟空间大小通常采用2的n次幂，便于进行高效的移位操作；然后通过独特的数据结构 Ring（环）再将虚拟节点映射到实际的物理存储设备上，完成寻址过程。</p>
<hr>
<h3 id="对象存储服务"><a href="#对象存储服务" class="headerlink" title="对象存储服务"></a>对象存储服务</h3><p>（1）查看服务状态</p>
<p>在openstack平台中使用命令“swift stat”查看对象存储服务状态，执行命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# swift stat</span><br><span class="line">               Account: AUTH_563a1bd3cee84608913f046e5a39fffd</span><br><span class="line">            Containers: 0</span><br><span class="line">               Objects: 0</span><br><span class="line">                 Bytes: 0</span><br><span class="line">       X-Put-Timestamp: 1612342537.62212</span><br><span class="line">           X-Timestamp: 1612342537.62212</span><br><span class="line">            X-Trans-Id: tx308afd55a7dd4527bebee-00601a64f6</span><br><span class="line">          Content-Type: text/plain; charset=utf-8</span><br><span class="line">X-Openstack-Request-Id: tx308afd55a7dd4527bebee-00601a64f6</span><br></pre></td></tr></table></figure>

<p>（2）创建容器</p>
<p>通过“openstack container create”命令创建容器，命令格式如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack  help container create </span><br><span class="line">usage: openstack container create [-h] [-f &#123;csv,json,table,value,yaml&#125;]</span><br><span class="line">                                  [-c COLUMN] [--max-width ]</span><br><span class="line">                                  [--fit-width] [--print-empty] [--noindent]</span><br><span class="line">                                  [--quote &#123;all,minimal,none,nonnumeric&#125;]</span><br><span class="line">                                  [--sort-column SORT_COLUMN]</span><br><span class="line">                                   [ ...]</span><br></pre></td></tr></table></figure>

<p>使用命令创建容器，名称为“swift-test”，操作命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack  container create  swift-test</span><br><span class="line">+---------------------------------------+------------+------------------------------------+</span><br><span class="line">| account                               | container  | x-trans-id                         |</span><br><span class="line">+---------------------------------------+------------+------------------------------------+</span><br><span class="line">| AUTH_13b5e35202d54a84ae7a5ae5c57b9846 | swift-test | tx14edab5036414bfab0e64-006204b5ef |</span><br><span class="line">+---------------------------------------+------------+------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（3）查看容器</p>
<p>使用命令查询容器列表信息，命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack container list </span><br><span class="line">+------------+</span><br><span class="line">| Name       |</span><br><span class="line">+------------+</span><br><span class="line">| swift-test |</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure>

<p>使用命令查询容器详细信息，命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack container show swift-test</span><br><span class="line">+--------------+---------------------------------------+</span><br><span class="line">| Field        | Value                                 |</span><br><span class="line">+--------------+---------------------------------------+</span><br><span class="line">| account      | AUTH_13b5e35202d54a84ae7a5ae5c57b9846 |</span><br><span class="line">| bytes_used   | 0                                     |</span><br><span class="line">| container    | swift-test                            |</span><br><span class="line">| object_count | 0                                     |</span><br><span class="line">+--------------+---------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（4）创建对象</p>
<p>创建完容器后，可以创建对象，通过使用命令“openstack object create”在对象中创建对象。命令格式如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help object create</span><br><span class="line">usage: openstack object create [-h] [-f &#123;csv,json,table,value,yaml&#125;]</span><br><span class="line">                               [-c COLUMN] [--max-width ]</span><br><span class="line">                               [--fit-width] [--print-empty] [--noindent]</span><br><span class="line">                               [--quote &#123;all,minimal,none,nonnumeric&#125;]</span><br><span class="line">                               [--sort-column SORT_COLUMN] [--name ]</span><br><span class="line">                                 [ ...]</span><br></pre></td></tr></table></figure>

<p>在使用命令创建对象前，需要将上传后的目录结构在本地创建。在本地创建名为“test”的目录“/root/test”，将/root/anaconda-ks.cfg文件复制至“/root/test”目录中。命令代码如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# mkdir test</span><br><span class="line">[root@controller ~]# cp anaconda-ks.cfg test/</span><br></pre></td></tr></table></figure>

<p>创建对象的过程也是向容器中上传文件，使用命令创建“test/anaconda-ks.cfg”和“anaconda-ks.cfg”对象。操作命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack object create swift-test test/anaconda-ks.cfg </span><br><span class="line">+----------------------+------------+----------------------------------+</span><br><span class="line">| object               | container  | etag                             |</span><br><span class="line">+----------------------+------------+----------------------------------+</span><br><span class="line">| test/anaconda-ks.cfg | swift-test | 41656296ae6768ae924a5b5f3fe15bf0 |</span><br><span class="line">+----------------------+------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>（5）查看对象</p>
<p>创建完对象后，通过命令查看容器中对象信息，使用命令“openstack object list”查看对象信息，命令格式如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack  help object list </span><br><span class="line">usage: openstack object list [-h] [-f &#123;csv,json,table,value,yaml&#125;] [-c COLUMN]</span><br><span class="line">                             [--max-width ] [--fit-width]</span><br><span class="line">                             [--print-empty] [--noindent]</span><br><span class="line">                             [--quote &#123;all,minimal,none,nonnumeric&#125;]</span><br><span class="line">                             [--sort-column SORT_COLUMN] [--prefix ]</span><br><span class="line">                             [--delimiter ] [--marker ]</span><br><span class="line">                             [--end-marker ]</span><br><span class="line">                             [--limit ] [--long] [--all]</span><br><span class="line">                             </span><br></pre></td></tr></table></figure>

<p>使用命令查看容器“swift-test”中所有对象信息，操作命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack object list swift-test</span><br><span class="line">+----------------------+</span><br><span class="line">| Name                 |</span><br><span class="line">+----------------------+</span><br><span class="line">| test/anaconda-ks.cfg |</span><br><span class="line">+----------------------+</span><br></pre></td></tr></table></figure>

<p>通过查询命令可以看出，在通过命令上传对象时，本地路径即为容器内对象路径。使用命令“openstack object show”查询“swift-test”容器中“test/anaconda-ks.cfg”对象详细信息，命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller opt]# openstack object show swift-test test/anaconda-ks.cfg</span><br><span class="line">+----------------+---------------------------------------+</span><br><span class="line">| Field          | Value                                 |</span><br><span class="line">+----------------+---------------------------------------+</span><br><span class="line">| account        | AUTH_13b5e35202d54a84ae7a5ae5c57b9846 |</span><br><span class="line">| container      | swift-test                            |</span><br><span class="line">| content-length | 6880                                  |</span><br><span class="line">| content-type   | application/octet-stream              |</span><br><span class="line">| etag           | 41656296ae6768ae924a5b5f3fe15bf0      |</span><br><span class="line">| last-modified  | Thu, 10 Feb 2022 06:54:30 GMT         |</span><br><span class="line">| object         | test/anaconda-ks.cfg                  |</span><br><span class="line">+----------------+---------------------------------------+</span><br></pre></td></tr></table></figure>

<p>（6）下载对象</p>
<p>存储在容器中的对象，可以在需要使用时，通过“openstack object save”命令进行下载至本地，命令格式如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack help object save </span><br><span class="line">usage: openstack object save [-h] [--file ]  </span><br><span class="line"></span><br><span class="line">Save object locally</span><br></pre></td></tr></table></figure>

<p>使用命令将“swift-test”容器中“test/anaconda-ks.cfg”对象下载至本地/opt/目录下。操作命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cd /opt/</span><br><span class="line">[root@controller opt]# openstack object save swift-test test/anaconda-ks.cfg</span><br><span class="line">[root@controller opt]# ls test/</span><br><span class="line">anaconda-ks.cfg</span><br></pre></td></tr></table></figure>

<p>（7）删除对象</p>
<p>使用“openstack object delete”命令删除容器内的对象，命令格式如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller opt]# openstack help object delete</span><br><span class="line">usage: openstack object delete [-h]   [ ...]</span><br></pre></td></tr></table></figure>

<p>使用删除对象命令将“swift-test”容器内“test/anaconda-ks.cfg”删除，查看“swift-test”容器中对象列表信息。操作命令如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller opt]# openstack object delete swift-test test/anaconda-ks.cfg</span><br><span class="line">[root@controller opt]# openstack object list swift-test</span><br><span class="line">+-----------------+</span><br><span class="line">| Name            |</span><br><span class="line">+-----------------+</span><br><span class="line">| anaconda-ks.cfg |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure>

<p>（8）删除容器</p>
<p>使用“openstack container delete”命令删除容器，命令格式如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller opt]# openstack help container delete</span><br><span class="line">usage: openstack container delete [-h] [--recursive]</span><br><span class="line">                                   [ ...]</span><br></pre></td></tr></table></figure>

<p>使用删除容器命令将“swift-test”容器删除，因为容器内存有对象，所以无法直接删除。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller opt]# openstack container delete swift-test</span><br><span class="line">Conflict (HTTP 409) (Request-ID: tx8c3de39f832f49ac9d655-00601bba0a)</span><br></pre></td></tr></table></figure>

<p>需要添加“–recursive”参数将容器内部对象一起删除，才可以删除“swift-test”容器，查看容器列表信息。操作命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller opt]# openstack container delete --recursive swift-test </span><br><span class="line">[root@controller opt]# openstack container list</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="分片存储案例"><a href="#分片存储案例" class="headerlink" title="分片存储案例"></a>分片存储案例</h3><p>（1）创建容器</p>
<p>使用命令创建一个容器test并查看容器的状态信息，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# swift post test</span><br><span class="line">[root@controller ~]# swift stat test</span><br><span class="line">               Account: AUTH_13b5e35202d54a84ae7a5ae5c57b9846</span><br><span class="line">             Container: test</span><br><span class="line">               Objects: 0</span><br><span class="line">                 Bytes: 0</span><br><span class="line">              Read ACL:</span><br><span class="line">             Write ACL:</span><br><span class="line">               Sync To:</span><br><span class="line">              Sync Key:</span><br><span class="line">         Accept-Ranges: bytes</span><br><span class="line">      X-Storage-Policy: Policy-0</span><br><span class="line">         Last-Modified: Thu, 10 Feb 2022 07:00:01 GMT</span><br><span class="line">           X-Timestamp: 1644476400.54127</span><br><span class="line">            X-Trans-Id: tx1523620b734d425fb7249-006204b7f7</span><br><span class="line">          Content-Type: application/json; charset=utf-8</span><br><span class="line">X-Openstack-Request-Id: tx1523620b734d425fb7249-006204b7f7</span><br></pre></td></tr></table></figure>

<p>（2）上传镜像并分片存储</p>
<p>将提供的cirros-0.3.4-x86_64-disk.img镜像上传至controller节点的/root目录下，并使用命令上传至test容器中，进行分片存储，每个片段的大小为10M，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# ll</span><br><span class="line">total 8088152</span><br><span class="line">-rw-------. 1 root root       1741 Oct 20 16:11 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root   13287936 Oct 21 14:23 cirros-0.3.4-x86_64-disk.img</span><br></pre></td></tr></table></figure>

<p>上传镜像至容器并进行分片：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# swift upload test -S 10000000 cirros-0.3.4-x86_64-disk.img</span><br><span class="line">cirros-0.3.4-x86_64-disk.img segment 0</span><br><span class="line">cirros-0.3.4-x86_64-disk.img segment 1</span><br><span class="line">cirros-0.3.4-x86_64-disk.img</span><br></pre></td></tr></table></figure>

<p>查看cirros镜像的存储路径：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]#  swift stat test cirros-0.3.4-x86_64-disk.img </span><br><span class="line">               Account: AUTH_13b5e35202d54a84ae7a5ae5c57b9846</span><br><span class="line">             Container: test</span><br><span class="line">                Object: cirros-0.3.4-x86_64-disk.img</span><br><span class="line">          Content Type: application/octet-stream</span><br><span class="line">        Content Length: 13267968</span><br><span class="line">         Last Modified: Thu, 10 Feb 2022 07:01:25 GMT</span><br><span class="line">                  ETag: &quot;fedf8be64303d80840c0c67304617bb2&quot;</span><br><span class="line">              Manifest: test_segments/cirros-0.3.4-x86_64-disk.img/1644463107.000000/13267968/10000000/</span><br><span class="line">            Meta Mtime: 1644463107.000000</span><br><span class="line">         Accept-Ranges: bytes</span><br><span class="line">           X-Timestamp: 1644476484.47485</span><br><span class="line">            X-Trans-Id: tx80ea2f784bd046f1813c7-006204b85a</span><br><span class="line">X-Openstack-Request-Id: tx80ea2f784bd046f1813c7-006204b85a</span><br></pre></td></tr></table></figure>

<p>查看存储路径中的数据片：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# swift list test_segments</span><br><span class="line">cirros-0.3.4-x86_64-disk.img/1644463107.000000/13267968/10000000/00000000</span><br><span class="line">cirros-0.3.4-x86_64-disk.img/1644463107.000000/13267968/10000000/00000001</span><br></pre></td></tr></table></figure>

<p>可以看到，cirros镜像在上传至swfit对象存储中被分片存储了，单个存储片的大小为10M，因为该镜像大小为16M左右，所有分成了两个存储片。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">W</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/08/10/3-OpenStack%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/">http://example.com/2023/08/10/3-OpenStack基础服务使用案例/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OpenStack/">OpenStack</a></div><div class="post_share"><div class="social-share" data-image="/../images/title/openstack3.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/10/2-OpenStack%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(2)OpenStack基础平台部署案例"><img class="cover" src="/../images/title/openstack2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">私有云：(2)OpenStack基础平台部署案例</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/10/4-OpenStack%E9%AB%98%E7%BA%A7%E6%9C%8D%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/" title="私有云：(4)OpenStack高级服务使用案例"><img class="cover" src="/../images/title/openstack4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">私有云：(4)OpenStack高级服务使用案例</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/10/1-%E5%9F%BA%E7%A1%80%E8%AE%AD%E7%BB%83%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/" title="私有云：(1)基础训练环境构建"><img class="cover" src="/../images/title/openstack1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(1)基础训练环境构建</div></div></a></div><div><a href="/2023/08/10/10-Redis%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/" title="私有云：(10)Redis集群部署与优化案例"><img class="cover" src="/../images/title/redis.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(10)Redis集群部署与优化案例</div></div></a></div><div><a href="/2023/08/10/11-Ansible%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(11)Ansible集群服务部署案例"><img class="cover" src="/../images/title/ansible.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(11)Ansible集群服务部署案例</div></div></a></div><div><a href="/2023/08/10/12-Python%E8%B0%83%E7%94%A8OpenStack_API%E6%A1%88%E4%BE%8B/" title="私有云：(12)Python调用OpenStack_API案例"><img class="cover" src="/../images/title/python4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(12)Python调用OpenStack_API案例</div></div></a></div><div><a href="/2023/08/10/2-OpenStack%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(2)OpenStack基础平台部署案例"><img class="cover" src="/../images/title/openstack2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(2)OpenStack基础平台部署案例</div></div></a></div><div><a href="/2023/08/10/13-%E7%A7%81%E6%9C%89%E4%BA%91Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/" title="私有云：(13)私有云Python运维开发案例"><img class="cover" src="/../images/title/python3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(13)私有云Python运维开发案例</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/title/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">W</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">案例描述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9AGlance%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">案例一：Glance镜像服务的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87"><span class="toc-number">2.1.</span> <span class="toc-text">案例准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%92%E8%8A%82%E7%82%B9"><span class="toc-number">2.1.1.</span> <span class="toc-text">规划节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%87%86%E5%A4%87"><span class="toc-number">2.1.2.</span> <span class="toc-text">基础准备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD"><span class="toc-number">2.2.</span> <span class="toc-text">案例实施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Glance%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.1.</span> <span class="toc-text">Glance镜像服务介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Glance%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-number">2.2.2.</span> <span class="toc-text">Glance重要概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.3.</span> <span class="toc-text">创建镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.4.</span> <span class="toc-text">管理镜像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9ANova%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">案例二：Nova服务的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87-1"><span class="toc-number">3.1.</span> <span class="toc-text">案例准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%92%E8%8A%82%E7%82%B9-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">规划节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%87%86%E5%A4%87-1"><span class="toc-number">3.1.2.</span> <span class="toc-text">基础准备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD-1"><span class="toc-number">3.2.</span> <span class="toc-text">案例实施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nova%E7%AE%80%E4%BB%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">Nova简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nova%E6%9E%B6%E6%9E%84"><span class="toc-number">3.2.2.</span> <span class="toc-text">Nova架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAflavor%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.3.</span> <span class="toc-text">创建flavor类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%AE%89%E5%85%A8%E7%BB%84"><span class="toc-number">3.2.4.</span> <span class="toc-text">访问安全组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">3.2.5.</span> <span class="toc-text">启动虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">3.2.6.</span> <span class="toc-text">管理虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%91%E4%B8%BB%E6%9C%BA%E8%B0%83%E6%95%B4%E7%B1%BB%E5%9E%8B%E5%A4%A7%E5%B0%8F"><span class="toc-number">3.2.7.</span> <span class="toc-text">云主机调整类型大小</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9ACinder%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">案例三：Cinder服务的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87-2"><span class="toc-number">4.1.</span> <span class="toc-text">案例准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%92%E8%8A%82%E7%82%B9-2"><span class="toc-number">4.1.1.</span> <span class="toc-text">规划节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%87%86%E5%A4%87-2"><span class="toc-number">4.1.2.</span> <span class="toc-text">基础准备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD-2"><span class="toc-number">4.2.</span> <span class="toc-text">案例实施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cinder%E6%A6%82%E8%BF%B0"><span class="toc-number">4.2.1.</span> <span class="toc-text">Cinder概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cinder%E6%9E%B6%E6%9E%84"><span class="toc-number">4.2.2.</span> <span class="toc-text">Cinder架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%97%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.2.3.</span> <span class="toc-text">块存储服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%8D%B7"><span class="toc-number">4.2.4.</span> <span class="toc-text">扩展卷</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%9B%9B%EF%BC%9ASwift%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">案例四：Swift服务的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87-3"><span class="toc-number">5.1.</span> <span class="toc-text">案例准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%92%E8%8A%82%E7%82%B9-3"><span class="toc-number">5.1.1.</span> <span class="toc-text">规划节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%87%86%E5%A4%87-3"><span class="toc-number">5.1.2.</span> <span class="toc-text">基础准备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD-3"><span class="toc-number">5.2.</span> <span class="toc-text">案例实施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift%E6%A6%82%E8%BF%B0"><span class="toc-number">5.2.1.</span> <span class="toc-text">Swift概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift%E7%9A%84%E6%9E%B6%E6%9E%84%E5%92%8C%E7%BB%84%E4%BB%B6"><span class="toc-number">5.2.2.</span> <span class="toc-text">Swift的架构和组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8E%9F%E7%90%86"><span class="toc-number">5.2.3.</span> <span class="toc-text">Swift中的数据结构原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.2.4.</span> <span class="toc-text">对象存储服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%89%87%E5%AD%98%E5%82%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.5.</span> <span class="toc-text">分片存储案例</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/20/Day06-%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E5%92%8C%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9/" title="文件查找和打包压缩"><img src="/../images/title/linux1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="文件查找和打包压缩"/></a><div class="content"><a class="title" href="/2024/10/20/Day06-%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E5%92%8C%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9/" title="文件查找和打包压缩">文件查找和打包压缩</a><time datetime="2024-10-19T16:00:00.000Z" title="发表于 2024-10-20 00:00:00">2024-10-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/12/docker-push/" title="一键 docker 打标签 &amp; 上传到 Harbor"><img src="/../images/title/docker-sh.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一键 docker 打标签 &amp; 上传到 Harbor"/></a><div class="content"><a class="title" href="/2024/10/12/docker-push/" title="一键 docker 打标签 &amp; 上传到 Harbor">一键 docker 打标签 &amp; 上传到 Harbor</a><time datetime="2024-10-11T16:16:00.000Z" title="发表于 2024-10-12 00:16:00">2024-10-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/12/hadoop%E8%84%9A%E6%9C%AC/" title="基于完全分布式模式部署 Hadoop"><img src="/../images/title/hadoop-jb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于完全分布式模式部署 Hadoop"/></a><div class="content"><a class="title" href="/2024/10/12/hadoop%E8%84%9A%E6%9C%AC/" title="基于完全分布式模式部署 Hadoop">基于完全分布式模式部署 Hadoop</a><time datetime="2024-10-11T16:10:00.000Z" title="发表于 2024-10-12 00:10:00">2024-10-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/12/markdown%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/" title="markdown 文字效果"><img src="/../images/title/markdown.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="markdown 文字效果"/></a><div class="content"><a class="title" href="/2024/10/12/markdown%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/" title="markdown 文字效果">markdown 文字效果</a><time datetime="2024-10-11T16:00:00.000Z" title="发表于 2024-10-12 00:00:00">2024-10-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By W</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>