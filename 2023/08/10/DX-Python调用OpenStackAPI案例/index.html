<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>私有云：(12)Python调用OpenStack_API案例 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Python调用OpenStack_API案例">
<meta property="og:type" content="article">
<meta property="og:title" content="私有云：(12)Python调用OpenStack_API案例">
<meta property="og:url" content="http://example.com/2023/08/10/DX-Python%E8%B0%83%E7%94%A8OpenStackAPI%E6%A1%88%E4%BE%8B/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="Python调用OpenStack_API案例">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/title/python4.jpg">
<meta property="article:published_time" content="2023-08-10T04:00:00.000Z">
<meta property="article:modified_time" content="2024-11-08T11:57:09.653Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/title/python4.jpg"><link rel="shortcut icon" href="/../images/title/user.webp"><link rel="canonical" href="http://example.com/2023/08/10/DX-Python%E8%B0%83%E7%94%A8OpenStackAPI%E6%A1%88%E4%BE%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '私有云：(12)Python调用OpenStack_API案例',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-11-08 19:57:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/title/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/title/python4.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">私有云：(12)Python调用OpenStack_API案例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-10T04:00:00.000Z" title="发表于 2023-08-10 12:00:00">2023-08-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-08T11:57:09.653Z" title="更新于 2024-11-08 19:57:09">2024-11-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9D%E5%89%91%E9%94%8B%E4%BB%8E%E7%A3%A8%E7%A0%BA%E5%87%BA/">宝剑锋从磨砺出</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>101分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="私有云：(12)Python调用OpenStack_API案例"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="案例描述"><a href="#案例描述" class="headerlink" title="案例描述"></a>案例描述</h1><p>通过本模块课程学习，主要掌握以下内容：</p>
<p>了解Python语法、python-keystoneclient库和OpenStack APIs。</p>
<p>能够使用Python编写代码，利用python-keystoneclient库查询Keystone项目。</p>
<p>了解使用OpenStack Python SDK进行Python运维脚本开发。</p>
<p>（4）掌握用户、镜像、实例类型等管理代码Python语法编写方法。</p>
<h1 id="案例一：Python开发环境准备"><a href="#案例一：Python开发环境准备" class="headerlink" title="案例一：Python开发环境准备"></a>案例一：Python开发环境准备</h1><h2 id="任务目标"><a href="#任务目标" class="headerlink" title="任务目标"></a>任务目标</h2><p>了解python-keystoneclient库。<br>了解Python语法。<br>使用Python编写代码，利用python-keystoneclient库查询Keystone项目。</p>
<h2 id="案例准备"><a href="#案例准备" class="headerlink" title="案例准备"></a>案例准备</h2><p>节点规划见表1。</p>
<p>表1节点规划</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>节点</th>
</tr>
</thead>
<tbody><tr>
<td>172.128.11.18</td>
<td>controller</td>
<td>OpenStack控制节点</td>
</tr>
</tbody></table>
<p>使用all-in-one云主机进行实验，安装Python3环境，并导入相应的依赖包。</p>
<h2 id="案例实施"><a href="#案例实施" class="headerlink" title="案例实施"></a>案例实施</h2><p>查看Python版本，命令如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# ls</span><br><span class="line"> Python-api.tar</span><br><span class="line">通过里面的yum源安装python3</span><br><span class="line"></span><br><span class="line">[root@ controller ~]# python3 --version</span><br><span class="line">Python 3.6.8</span><br></pre></td></tr></table></figure>

<p>使用提供的whl文件安装依赖，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cd Python-api</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install certifi-2019.11.28-py2.py3-none-any.whl</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install urllib3-1.25.11-py3-none-any.whl</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install idna-2.8-py2.py3-none-any.whl</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install chardet-3.0.4-py2.py3-none-any.whl</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install requests-2.24.0-py2.py3-none-any.whl</span> </span><br></pre></td></tr></table></figure>

<p>安装之后可以使用命令查看是否被成功安装，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# pip3 list</span><br><span class="line">Package            Version</span><br><span class="line">------------------ ----------</span><br><span class="line">appdirs            1.4.4</span><br><span class="line">certifi            2019.11.28</span><br><span class="line">cffi               1.15.0</span><br><span class="line">chardet            3.0.4</span><br><span class="line">charset-normalizer 2.0.12</span><br><span class="line">cryptography       36.0.1</span><br><span class="line">decorator          5.1.1</span><br><span class="line">dogpile.cache      1.1.5</span><br><span class="line">idna               2.8</span><br><span class="line">importlib-metadata 4.8.3</span><br><span class="line">iso8601            1.0.2</span><br><span class="line">jmespath           0.10.0</span><br><span class="line">jsonpatch          1.32</span><br><span class="line">jsonpointer        2.2</span><br><span class="line">keystoneauth1      4.5.0</span><br><span class="line">munch              2.5.0</span><br><span class="line">netifaces          0.11.0</span><br><span class="line">openstacksdk       0.61.0</span><br><span class="line">os-service-types   1.7.0</span><br><span class="line">pbr                5.8.1</span><br><span class="line">pip                21.3.1</span><br><span class="line">pycparser          2.21</span><br><span class="line">PyYAML             6.0</span><br><span class="line">requests           2.24.0</span><br><span class="line">requestsexceptions 1.4.0</span><br><span class="line">setuptools         59.6.0</span><br><span class="line">six                1.16.0</span><br><span class="line">stevedore          3.5.0</span><br><span class="line">typing_extensions  4.1.1</span><br><span class="line">urllib3            1.25.11</span><br><span class="line">zipp               3.6.0</span><br></pre></td></tr></table></figure>

<p>至此，基本环境安装完毕。</p>
<h1 id="案例二：通过RESTful编写Python运维"><a href="#案例二：通过RESTful编写Python运维" class="headerlink" title="案例二：通过RESTful编写Python运维"></a>案例二：通过RESTful编写Python运维</h1><h2 id="任务目标-1"><a href="#任务目标-1" class="headerlink" title="任务目标"></a>任务目标</h2><p>了解OpenStack APIs。<br>了解用户、镜像、实例类型等管理代码Python语法编写方法。<br>在OpenStack云中，可以使用OpenStack API来启动服务器云主机，创建镜像、给实例和镜像分配元数据、创建存储容器和对象以及完成其他相关的动作。<br>OpenStack APIs 参考官方文档<a target="_blank" rel="noopener" href="https://docs.openstack.org/train/api/%E3%80%82%E9%92%88%E5%AF%B9%E6%AF%8F%E4%B8%AA%E6%9C%8D%E5%8A%A1%E9%83%BD%E6%8F%90%E4%BE%9B%E4%BA%86Restful">https://docs.openstack.org/train/api/。针对每个服务都提供了Restful</a> 接口说明。以下给出使用Python调用APIs实现OpenStack运维。</p>
<h2 id="案例准备-1"><a href="#案例准备-1" class="headerlink" title="案例准备"></a>案例准备</h2><p>沿用案例一的all-in-one云主机环境进行实验。</p>
<h2 id="案例实施-1"><a href="#案例实施-1" class="headerlink" title="案例实施"></a>案例实施</h2><p>登录OpenStack平台，可以查看APIs的网站与端口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# source /etc/keystone/admin-openrc.sh  </span><br><span class="line">[root@controller ~]# openstack endpoint list -c &quot;Service Name&quot;  -c &quot;Enabled&quot;  -c &quot;URL&quot;  </span><br></pre></td></tr></table></figure>

<p>查询Endpoint接口如图1所示：</p>
<p><img src="../../../../images/image/DX/73.png" alt="73"></p>
<p>图1</p>
<h3 id="认证服务：用户管理"><a href="#认证服务：用户管理" class="headerlink" title="认证服务：用户管理"></a>认证服务：用户管理</h3><h4 id="接口说明"><a href="#接口说明" class="headerlink" title="接口说明"></a>接口说明</h4><p>接口官网：<a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/identity/%E3%80%82">https://docs.openstack.org/api-ref/identity/。</a><br>当前版本为V3.0.网站为：<a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/identity/v3/index.html">https://docs.openstack.org/api-ref/identity/v3/index.html</a><br>Identity服务生成访问OpenStack服务REST API的认证令牌。客户端通过向身份验证服务提供有效凭据来获取此令牌（Token）和其他服务API的URL端点。<br>每次向OpenStack服务请求REST API时，都需要在X-Auth-Token请求头中提供自己的认证令牌（Token）。<br>和大多数OpenStack项目一样，OpenStack Identity通过基于角色访问控制（RBAC）的方法定义策略规则来保护API。<br>Identity服务配置文件设置存储这些规则的JSON策略文件的名称和位置。<br>V3 API为所有GET请求实现了HEAD。 每个HEAD请求包含与对应的GET API相同的报头和HTTP状态代码。<br>以下以用户管理的Python实现案例，展示如何调用认证服务的APIs。具体APIs参考如下地址（如图2所示）：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/identity/v3/index.html#users">https://docs.openstack.org/api-ref/identity/v3/index.html#users</a></p>
<p><img src="../../../../images/image/DX/74.png" alt="74"><br>图2<br>以下展示User增删查改的管理Python实现代码。<br>创建用户接口：POST /v3/users<br>请求参数见表2：<br>表2 请求参数</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>user</td>
<td>body</td>
<td>object</td>
<td>用户</td>
</tr>
<tr>
<td>default_project_id (Optional)</td>
<td>body</td>
<td>string</td>
<td>项目ID</td>
</tr>
<tr>
<td>domain_id (Optional)</td>
<td>body</td>
<td>string</td>
<td>区域ID</td>
</tr>
<tr>
<td>federated (Optional)</td>
<td>body</td>
<td>list</td>
<td>用户联邦列表</td>
</tr>
<tr>
<td>enabled (Optional)</td>
<td>body</td>
<td>boolean</td>
<td>是否启用</td>
</tr>
<tr>
<td>name</td>
<td>body</td>
<td>string</td>
<td>用户名称</td>
</tr>
<tr>
<td>password (Optional)</td>
<td>body</td>
<td>string</td>
<td>密码</td>
</tr>
<tr>
<td>extra (Optional)</td>
<td>body</td>
<td>string</td>
<td>额外信息</td>
</tr>
<tr>
<td>options (Optional)</td>
<td>body</td>
<td>object</td>
<td>选项</td>
</tr>
</tbody></table>
<p>创建用户body json案例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    <span class="string">&quot;user&quot;</span>: &#123;  </span><br><span class="line">        <span class="string">&quot;default_project_id&quot;</span>: <span class="string">&quot;263fd9&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;domain_id&quot;</span>: <span class="string">&quot;1789d1&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;enabled&quot;</span>: <span class="literal">true</span>,  </span><br><span class="line">        <span class="string">&quot;federated&quot;</span>: [  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="string">&quot;idp_id&quot;</span>: <span class="string">&quot;efbab5a6acad4d108fec6c63d9609d83&quot;</span>,  </span><br><span class="line">                <span class="string">&quot;protocols&quot;</span>: [  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        <span class="string">&quot;protocol_id&quot;</span>: <span class="string">&quot;mapped&quot;</span>,  </span><br><span class="line">                        <span class="string">&quot;unique_id&quot;</span>: <span class="string">&quot;test@example.com&quot;</span>  </span><br><span class="line">                    &#125;  </span><br><span class="line">                ]  </span><br><span class="line">            &#125;  </span><br><span class="line">        ],  </span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;James Doe&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;secretsecret&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;James Doe user&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;jdoe@example.com&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;options&quot;</span>: &#123;  </span><br><span class="line">            <span class="string">&quot;ignore_password_expiry&quot;</span>: <span class="literal">true</span>  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>其他接口参数基本一致，可以查看每个接口的request与response的数据格式。</p>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>创建apis_user_manager.py文件实现，用户的创建、查找、删除、更新。代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright 2021~2022 The Cloud Computing support Teams of ChinaSkills.  </span></span><br><span class="line"><span class="keyword">import</span> requests,json,time  </span><br><span class="line"><span class="keyword">import</span> logging  </span><br><span class="line"><span class="comment">#-----------logger-----------  </span></span><br><span class="line"><span class="comment">#get logger  </span></span><br><span class="line">logger = logging.getLogger(__name__)  </span><br><span class="line"><span class="comment"># level  </span></span><br><span class="line">logger.setLevel(logging.DEBUG)  </span><br><span class="line"><span class="comment"># format  </span></span><br><span class="line"><span class="built_in">format</span> = logging.Formatter(<span class="string">&#x27;%(asctime)s %(message)s&#x27;</span>)  </span><br><span class="line"><span class="comment"># to console  </span></span><br><span class="line">stream_handler  = logging.StreamHandler()  </span><br><span class="line">stream_handler .setFormatter(<span class="built_in">format</span>)  </span><br><span class="line">logger.addHandler(stream_handler )  </span><br><span class="line"><span class="comment">#-----------logger-----------  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_auth_token</span>(<span class="params">controller_ip, domain, user, password</span>):  </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">    :param controller_ip: openstack master ip address  </span></span><br><span class="line"><span class="string">    :param domain: current user&#x27;s domain  </span></span><br><span class="line"><span class="string">    :param user: user name  </span></span><br><span class="line"><span class="string">    :param password: user password  </span></span><br><span class="line"><span class="string">    :return: keystoen auth Token for current user.  </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        url = <span class="string">f&quot;http://<span class="subst">&#123;controller_ip&#125;</span>:5000/v3/auth/tokens&quot;</span>  </span><br><span class="line">        body = &#123;  </span><br><span class="line">                    <span class="string">&quot;auth&quot;</span>: &#123;  </span><br><span class="line">                        <span class="string">&quot;identity&quot;</span>: &#123;  </span><br><span class="line">                            <span class="string">&quot;methods&quot;</span>: [  </span><br><span class="line">                                <span class="string">&quot;password&quot;</span>  </span><br><span class="line">                            ],  </span><br><span class="line">                            <span class="string">&quot;password&quot;</span>: &#123;  </span><br><span class="line">                                <span class="string">&quot;user&quot;</span>: &#123;  </span><br><span class="line">                                    <span class="string">&quot;domain&quot;</span>: &#123;  </span><br><span class="line">                                        <span class="string">&quot;name&quot;</span>: domain  </span><br><span class="line">                                    &#125;,  </span><br><span class="line">                                    <span class="string">&quot;name&quot;</span>: user,  </span><br><span class="line">                                    <span class="string">&quot;password&quot;</span>: password  </span><br><span class="line">                                &#125;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;,  </span><br><span class="line">                        <span class="string">&quot;scope&quot;</span>: &#123;  </span><br><span class="line">                            <span class="string">&quot;project&quot;</span>: &#123;  </span><br><span class="line">                                <span class="string">&quot;domain&quot;</span>: &#123;  </span><br><span class="line">                                    <span class="string">&quot;name&quot;</span>: domain  </span><br><span class="line">                                &#125;,  </span><br><span class="line">                                <span class="string">&quot;name&quot;</span>: user  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">        headers = &#123;  </span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">print</span>(body)  </span><br><span class="line">        Token = requests.post(url, data=json.dumps(body), headers=headers).headers[<span class="string">&#x27;X-Subject-Token&#x27;</span>]  </span><br><span class="line">        headers = &#123;  </span><br><span class="line">            <span class="string">&quot;X-Auth-Token&quot;</span>: Token  </span><br><span class="line">        &#125;  </span><br><span class="line">        logger.debug(<span class="string">f&quot;获取Token值：<span class="subst">&#123;<span class="built_in">str</span>(Token)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> headers  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        logger.error(<span class="string">f&quot;获取Token值失败，请检查访问云主机控制节点IP是否正确？输出错误信息如下：<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)  </span><br><span class="line">        exit(<span class="number">0</span>)  </span><br><span class="line"><span class="comment">#用户管理  </span></span><br><span class="line"><span class="comment"># https://docs.openstack.org/api-ref/identity/v3/index.html#users  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user_manager</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, handers: <span class="built_in">dict</span>, resUrl: <span class="built_in">str</span></span>):  </span><br><span class="line">        self.headers = handers  </span><br><span class="line">        self.resUrl = resUrl  </span><br><span class="line">    <span class="comment">#      POST  /v3/users  Create user  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_users</span>(<span class="params">self, user_name, password:<span class="built_in">str</span>, desc:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        create a user with name and password and description.  </span></span><br><span class="line"><span class="string">        :param user_name:  </span></span><br><span class="line"><span class="string">        :param password:  </span></span><br><span class="line"><span class="string">        :param desc:  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        body = &#123;  </span><br><span class="line">            <span class="string">&quot;user&quot;</span>: &#123;  </span><br><span class="line">                <span class="string">&quot;name&quot;</span>: user_name,  </span><br><span class="line">                <span class="string">&quot;password&quot;</span>: password,  </span><br><span class="line">                <span class="string">&quot;description&quot;</span>: desc,  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        status_code = requests.post(self.resUrl, data=json.dumps(body), headers=self.headers).text  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回状态:<span class="subst">&#123;<span class="built_in">str</span>(status_code)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> status_code  </span><br><span class="line">    <span class="comment"># /v3/users    # List all users  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_users</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        status_code =  requests.get(self.resUrl, headers=self.headers).text  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回状态:<span class="subst">&#123;<span class="built_in">str</span>(status_code)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> status_code  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_user_id</span>(<span class="params">self, user_name</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        get user id by name.  </span></span><br><span class="line"><span class="string">        :param user_name:  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        result = json.loads(requests.get(self.resUrl, headers=self.headers).text)  </span><br><span class="line">        user_name = user_name  </span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> result[<span class="string">&#x27;users&#x27;</span>]:  </span><br><span class="line">            <span class="keyword">if</span> item[<span class="string">&#x27;name&#x27;</span>] == user_name:  </span><br><span class="line">                <span class="keyword">return</span> item[<span class="string">&#x27;id&#x27;</span>]  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;NONE&quot;</span>  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">self, <span class="built_in">id</span>:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        get a flavor by id.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        api_url = self.resUrl + <span class="string">&quot;/&quot;</span>+<span class="built_in">id</span>  </span><br><span class="line">        result = json.loads(requests.get(api_url, headers=self.headers).text)  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回信息:<span class="subst">&#123;<span class="built_in">str</span>(result)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_user</span>(<span class="params">self, <span class="built_in">id</span>:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">         delete a user by id.  </span></span><br><span class="line"><span class="string">         :return:  </span></span><br><span class="line"><span class="string">         &quot;&quot;&quot;</span>  </span><br><span class="line">        api_url = self.resUrl + <span class="string">&quot;/&quot;</span> + <span class="built_in">id</span>  </span><br><span class="line">        response = requests.delete(api_url, headers=self.headers)  </span><br><span class="line">        <span class="comment"># 204 - No ContentThe server has fulfilled the request.  </span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">204</span>:  </span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;User itemDeletedSuccess&quot;</span>: response.status_code&#125;  </span><br><span class="line">        result = json.loads(response.text)  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回信息:<span class="subst">&#123;<span class="built_in">str</span>(result)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line">        <span class="comment"># http://192.168.200.226:8774/v2.1/ get apis version infomation.  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_User_password</span>(<span class="params">self, <span class="built_in">id</span>: <span class="built_in">str</span>, original_password: <span class="built_in">str</span>, new_password : <span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        update a flavor desc by id.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        self.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&quot;application/json&quot;</span>  </span><br><span class="line">        body = &#123;  </span><br><span class="line">            <span class="string">&quot;user&quot;</span>: &#123;  </span><br><span class="line">                <span class="string">&quot;password&quot;</span>: new_password,  </span><br><span class="line">                <span class="string">&quot;original_password&quot;</span>: original_password  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        api_url = self.resUrl + <span class="string">&quot;/&quot;</span> + <span class="built_in">id</span> + <span class="string">&quot;/password&quot;</span>  </span><br><span class="line">        response = requests.post(api_url, data=json.dumps(body), headers=self.headers)  </span><br><span class="line">        <span class="comment"># Normal response codes: 204 without return text  </span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">204</span> :  </span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;item Update Password Success&quot;</span>: response.status_code&#125;  </span><br><span class="line">        result = json.loads(response.text)  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回信息:<span class="subst">&#123;<span class="built_in">str</span>(result)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    <span class="comment"># openstack allinone （controller ) credentials  </span></span><br><span class="line">    <span class="comment"># host ip address  </span></span><br><span class="line">    controller_ip = <span class="string">&quot;192.168.200.226&quot;</span>  </span><br><span class="line">    <span class="comment"># domain name  </span></span><br><span class="line">    domain = <span class="string">&quot;demo&quot;</span>  </span><br><span class="line">    <span class="comment"># user name  </span></span><br><span class="line">    user = <span class="string">&quot;admin&quot;</span>  </span><br><span class="line">    <span class="comment"># user password  </span></span><br><span class="line">    password = <span class="string">&quot;000000&quot;</span>  </span><br><span class="line">    headers = get_auth_token(controller_ip,domain,user,password)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;headers:&quot;</span>, headers)  </span><br><span class="line">    <span class="comment">#get all user  </span></span><br><span class="line">    user_m = user_manager(headers, <span class="string">f&quot;http://<span class="subst">&#123;controller_ip&#125;</span>:5000/v3/users&quot;</span>)  </span><br></pre></td></tr></table></figure>

<h4 id="代码验证"><a href="#代码验证" class="headerlink" title="代码验证"></a>代码验证</h4><p>① 登录通过账号密码方式：使用get_auth_token()方法，通过该方法获取Token值。<br>② 封装了user_manager类，通过python request库实现对API的网络访问，实现对用户的增删查改操作。</p>
<ul>
<li>创建：POST /v3/users</li>
<li>查询：get /v3/users</li>
<li>删除：delete /v3/users/id</li>
<li>更改密码：/v3/users/id/password”</li>
</ul>
<p>具体可以通过官网的API说明。<br>③ 执行user_manager的每个方法进行代码测试，通过openstack user命令行或Dashboard界面进行研究者。</p>
<p>修改apis_user_manager.py的if <strong>name</strong> == ‘__main__’:函数中OpenStack的IP、domain、user、password，执行apis_user_manager.py，进行查询所有、创建、根据ID查询、更新密码和删除验证。在apis_user_manager.py的if <strong>name</strong> == ‘<strong>main</strong>‘最后添加如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#get all user  </span></span><br><span class="line">user_m = user_manager(headers, <span class="string">f&quot;http://<span class="subst">&#123;controller_ip&#125;</span>:5000/v3/users&quot;</span>)  </span><br><span class="line"><span class="comment"># 1 查询所有  </span></span><br><span class="line">users = user_m.get_users()  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;查询所有users:&quot;</span>, users)  </span><br><span class="line"><span class="comment"># 2 创建  </span></span><br><span class="line">user = user_m.create_users(<span class="string">&quot;user_demo&quot;</span>, <span class="string">&quot;passw0rd&quot;</span>,<span class="string">&quot;A user created by python code.&quot;</span>)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;创建用户:&quot;</span>, user)  </span><br><span class="line"><span class="comment"># get user id by name  </span></span><br><span class="line"><span class="built_in">id</span> = user_m.get_user_id(<span class="string">&quot;user_demo&quot;</span>)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;User user_demo Id is:&quot;</span>, <span class="built_in">id</span>)  </span><br><span class="line"><span class="comment">#3. 使用ID查询  </span></span><br><span class="line">user = user_m.get_user(<span class="built_in">id</span>)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;查询<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>用户:&quot;</span>, user)  </span><br><span class="line"><span class="comment"># 4. 更新密码  </span></span><br><span class="line">result = user_m.update_User_password(<span class="built_in">id</span>, <span class="string">&quot;passw0rd&quot;</span>, <span class="string">&quot;8assw52d&quot;</span>)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;更新密码<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>用户:&quot;</span>, result)  </span><br><span class="line"><span class="comment">#5. 删除新建用户  </span></span><br><span class="line">result = user_m.delete_user(<span class="built_in">id</span>)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;删除<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>用户:&quot;</span>, result)  </span><br></pre></td></tr></table></figure>

<p>然后执行apis_user_manager.py，结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# python3 apis_user_manager.py  </span><br><span class="line">&#123;&#x27;auth&#x27;: &#123;&#x27;identity&#x27;: &#123;&#x27;methods&#x27;: [&#x27;password&#x27;], &#x27;password&#x27;: &#123;&#x27;user&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;password&#x27;: &#x27;000000&#x27;&#125;&#125;&#125;, &#x27;scope&#x27;: &#123;&#x27;project&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;&#125;&#125;&#125;&#125;  </span><br><span class="line">2022-03-10 13:24:37,146 获取Token值：gAAAAABiKYoR1bvKz87Qx2H5ULprGbheY3EIWsm6t3ry1St5-B7LFfRddB8VLVwdxY-HSHdMlG-0vcam-UKzfRqHziFXTL7oNPacSfrvk4qiZMqCHKaisI7nETxa9Qrgsd_a0trjCTNWxYgfalGLpBjSfNA4ccCdw_3i3LocRWY2OcJQ3ccPM5w  </span><br><span class="line">headers: &#123;&#x27;X-Auth-Token&#x27;: &#x27;gAAAAABiKYoR1bvKz87Qx2H5ULprGbheY3EIWsm6t3ry1St5-B7LFfRddB8VLVwdxY-HSHdMlG-0vcam-UKzfRqHziFXTL7oNPacSfrvk4qiZMqCHKaisI7nETxa9Qrgsd_a0trjCTNWxYgfalGLpBjSfNA4ccCdw_3i3LocRWY2OcJQ3ccPM5w&#x27;&#125;  </span><br><span class="line">2022-03-10 13:24:38,511 返回状态:&#123;&quot;users&quot;: [&#123;&quot;name&quot;: &quot;admin&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/89f8027475294689ae6c0183fa35bf5a&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;options&quot;: &#123;&#125;, &quot;default_project_id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;, &quot;id&quot;: &quot;89f8027475294689ae6c0183fa35bf5a&quot;, &quot;password_expires_at&quot;: null&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;demo&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/df883f8abb124254a4e04138e92ebad6&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;df883f8abb124254a4e04138e92ebad6&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;glance&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/5f149fe240114fb5ae43e6d9ea3585c9&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;5f149fe240114fb5ae43e6d9ea3585c9&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;placement&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/c12e3ae6719f4145b45890b4f32b1bde&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;c12e3ae6719f4145b45890b4f32b1bde&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;nova&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/214fedb287114f2d8bf09bbb665369bd&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;214fedb287114f2d8bf09bbb665369bd&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;neutron&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/a22d0df83e564c17a618429a136aa46d&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;a22d0df83e564c17a618429a136aa46d&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;cinder&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/70fd527b01f141d091d240b17ffa7532&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;70fd527b01f141d091d240b17ffa7532&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;swift&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/38fca0a11172451ebd4fdd34bab4a62c&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;38fca0a11172451ebd4fdd34bab4a62c&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;heat&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/c099073d62754032937dfd422e5253a1&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;c099073d62754032937dfd422e5253a1&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;heat_domain_admin&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/ff8b9ec030ba4de8a7b4fd847c94c3c3&quot;&#125;, &quot;domain_id&quot;: &quot;e62a73d6033d49e89a0fd711a87f7d7b&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;ff8b9ec030ba4de8a7b4fd847c94c3c3&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;ceilometer&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/d35395e5ae554a5ea0fb5c2b5dbb2ba7&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;d35395e5ae554a5ea0fb5c2b5dbb2ba7&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;gnocchi&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/90deb816e8ee4ff7ae28d342f6074127&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;90deb816e8ee4ff7ae28d342f6074127&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;aodh&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/761b461915464665a29780738d9bb5fa&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;761b461915464665a29780738d9bb5fa&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;zun&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/2d8554f24c04452c8ffa9aa216a7c484&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;2d8554f24c04452c8ffa9aa216a7c484&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;kuryr&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/e9227d1e10c24ab2872b549157b4d376&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;e9227d1e10c24ab2872b549157b4d376&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;octavia&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/6a0958e6e55e4513a5f2451db007a2cc&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;6a0958e6e55e4513a5f2451db007a2cc&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;manila&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/77bba8c0d46c44578b8831e3d704ca97&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;77bba8c0d46c44578b8831e3d704ca97&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;cloudkitty&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/9f7da13262e44bf58c1bf29ee0318c81&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;9f7da13262e44bf58c1bf29ee0318c81&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;barbican&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/38ac5cab65974983b6a01be246e665a9&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;38ac5cab65974983b6a01be246e665a9&quot;, &quot;options&quot;: &#123;&#125;&#125;], &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users&quot;, &quot;previous&quot;: null, &quot;next&quot;: null&#125;&#125;  </span><br><span class="line">查询所有users: &#123;&quot;users&quot;: [&#123;&quot;name&quot;: &quot;admin&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/89f8027475294689ae6c0183fa35bf5a&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;options&quot;: &#123;&#125;, &quot;default_project_id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;, &quot;id&quot;: &quot;89f8027475294689ae6c0183fa35bf5a&quot;, &quot;password_expires_at&quot;: null&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;demo&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/df883f8abb124254a4e04138e92ebad6&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;df883f8abb124254a4e04138e92ebad6&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;glance&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/5f149fe240114fb5ae43e6d9ea3585c9&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;5f149fe240114fb5ae43e6d9ea3585c9&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;placement&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/c12e3ae6719f4145b45890b4f32b1bde&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;c12e3ae6719f4145b45890b4f32b1bde&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;nova&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/214fedb287114f2d8bf09bbb665369bd&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;214fedb287114f2d8bf09bbb665369bd&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;neutron&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/a22d0df83e564c17a618429a136aa46d&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;a22d0df83e564c17a618429a136aa46d&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;cinder&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/70fd527b01f141d091d240b17ffa7532&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;70fd527b01f141d091d240b17ffa7532&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;swift&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/38fca0a11172451ebd4fdd34bab4a62c&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;38fca0a11172451ebd4fdd34bab4a62c&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;heat&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/c099073d62754032937dfd422e5253a1&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;c099073d62754032937dfd422e5253a1&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;heat_domain_admin&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/ff8b9ec030ba4de8a7b4fd847c94c3c3&quot;&#125;, &quot;domain_id&quot;: &quot;e62a73d6033d49e89a0fd711a87f7d7b&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;ff8b9ec030ba4de8a7b4fd847c94c3c3&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;ceilometer&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/d35395e5ae554a5ea0fb5c2b5dbb2ba7&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;d35395e5ae554a5ea0fb5c2b5dbb2ba7&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;gnocchi&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/90deb816e8ee4ff7ae28d342f6074127&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;90deb816e8ee4ff7ae28d342f6074127&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;aodh&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/761b461915464665a29780738d9bb5fa&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;761b461915464665a29780738d9bb5fa&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;zun&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/2d8554f24c04452c8ffa9aa216a7c484&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;2d8554f24c04452c8ffa9aa216a7c484&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;kuryr&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/e9227d1e10c24ab2872b549157b4d376&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;e9227d1e10c24ab2872b549157b4d376&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;octavia&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/6a0958e6e55e4513a5f2451db007a2cc&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;6a0958e6e55e4513a5f2451db007a2cc&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;manila&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/77bba8c0d46c44578b8831e3d704ca97&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;77bba8c0d46c44578b8831e3d704ca97&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;cloudkitty&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/9f7da13262e44bf58c1bf29ee0318c81&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;9f7da13262e44bf58c1bf29ee0318c81&quot;, &quot;options&quot;: &#123;&#125;&#125;, &#123;&quot;password_expires_at&quot;: null, &quot;name&quot;: &quot;barbican&quot;, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/38ac5cab65974983b6a01be246e665a9&quot;&#125;, &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;, &quot;enabled&quot;: true, &quot;id&quot;: &quot;38ac5cab65974983b6a01be246e665a9&quot;, &quot;options&quot;: &#123;&#125;&#125;], &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users&quot;, &quot;previous&quot;: null, &quot;next&quot;: null&#125;&#125;  </span><br><span class="line">创建用户: &#123;&quot;user&quot;: &#123;&quot;description&quot;: &quot;A user created by python code.&quot;, &quot;name&quot;: &quot;user_demo&quot;, &quot;domain_id&quot;: &quot;default&quot;, &quot;enabled&quot;: true, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/f0a881341365462a930381b82ef378ff&quot;&#125;, &quot;options&quot;: &#123;&#125;, &quot;id&quot;: &quot;f0a881341365462a930381b82ef378ff&quot;, &quot;password_expires_at&quot;: null&#125;&#125;  </span><br><span class="line">2022-03-10 13:24:41,724 返回状态:&#123;&quot;user&quot;: &#123;&quot;description&quot;: &quot;A user created by python code.&quot;, &quot;name&quot;: &quot;user_demo&quot;, &quot;domain_id&quot;: &quot;default&quot;, &quot;enabled&quot;: true, &quot;links&quot;: &#123;&quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/f0a881341365462a930381b82ef378ff&quot;&#125;, &quot;options&quot;: &#123;&#125;, &quot;id&quot;: &quot;f0a881341365462a930381b82ef378ff&quot;, &quot;password_expires_at&quot;: null&#125;&#125;  </span><br><span class="line">User user_demo Id is: f0a881341365462a930381b82ef378ff  </span><br><span class="line">查询f0a881341365462a930381b82ef378ff用户: &#123;&#x27;user&#x27;: &#123;&#x27;description&#x27;: &#x27;A user created by python code.&#x27;, &#x27;links&#x27;: &#123;&#x27;self&#x27;: &#x27;http://172.128.11.18:5000/v3/users/f0a881341365462a930381b82ef378ff&#x27;&#125;, &#x27;enabled&#x27;: True, &#x27;id&#x27;: &#x27;f0a881341365462a930381b82ef378ff&#x27;, &#x27;password_expires_at&#x27;: None, &#x27;options&#x27;: &#123;&#125;, &#x27;domain_id&#x27;: &#x27;default&#x27;, &#x27;name&#x27;: &#x27;user_demo&#x27;&#125;&#125;  </span><br><span class="line">2022-03-10 13:24:44,021 返回信息:&#123;&#x27;user&#x27;: &#123;&#x27;description&#x27;: &#x27;A user created by python code.&#x27;, &#x27;links&#x27;: &#123;&#x27;self&#x27;: &#x27;http://172.128.11.18:5000/v3/users/f0a881341365462a930381b82ef378ff&#x27;&#125;, &#x27;enabled&#x27;: True, &#x27;id&#x27;: &#x27;f0a881341365462a930381b82ef378ff&#x27;, &#x27;password_expires_at&#x27;: None, &#x27;options&#x27;: &#123;&#125;, &#x27;domain_id&#x27;: &#x27;default&#x27;, &#x27;name&#x27;: &#x27;user_demo&#x27;&#125;&#125;  </span><br><span class="line">更新密码f0a881341365462a930381b82ef378ff用户: &#123;&#x27;item Update Password Success&#x27;: 204&#125;  </span><br><span class="line">删除f0a881341365462a930381b82ef378ff用户: &#123;&#x27;User itemDeletedSuccess&#x27;: 204&#125;  </span><br><span class="line">Process finished with exit code 0  </span><br></pre></td></tr></table></figure>

<h3 id="计算服务：实例类型管理"><a href="#计算服务：实例类型管理" class="headerlink" title="计算服务：实例类型管理"></a>计算服务：实例类型管理</h3><h4 id="接口说明-1"><a href="#接口说明-1" class="headerlink" title="接口说明"></a>接口说明</h4><p>计算服务的API官网：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/api-guide/compute/index.html">https://docs.openstack.org/api-guide/compute/index.html</a><br>Nova项目提供了RESTful HTTP服务：OpenStack Compute API。这些API提供了对计算资源的大规模可伸缩、随需应变、自服务访问能力。<br>API版本：<br>在Mitaka发布之后，每个Nova部署都有以下服务端点：</p>
<ul>
<li>/ -可用版本列表</li>
<li>/v2 -计算API的第一个版本，使用扩展（称之为计算API v2.0）</li>
<li>/v2.1 -相同的API，只是使用了微版本</li>
</ul>
<p>文档只要给出v2.1 API接口说明。<br>以下以主机类型（flavors）管理为案例，实现Python代码。具体APIs说明参见：<a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/compute/">https://docs.openstack.org/api-ref/compute/</a><br>接口清单如图3所示，涉及查询（Get）、创建（POST）、更新（PUT）与删除（DELETE）。</p>
<p><img src="../../../../images/image/DX/75.png" alt="75"></p>
<p>图3<br>具体参看：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/compute/?expanded=list-flavors-detail,list-flavors-with-details-detail">https://docs.openstack.org/api-ref/compute/?expanded=list-flavors-detail,list-flavors-with-details-detail</a><br>创建Flavor使用接口：POST /flavors。创建flavor需要云管理员（administrators），调用正常响应码为200，错误响应码为badRequest(400), unauthorized(401), forbidden(403), conflict(409)。<br>请求（Request）参数见表3：<br>表3 请求（Request）参数说明</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>位置</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>flavor</td>
<td>body</td>
<td>object</td>
<td>Flavor一种主机类型。</td>
</tr>
<tr>
<td>name</td>
<td>body</td>
<td>string</td>
<td>名称。</td>
</tr>
<tr>
<td>description (Optional)</td>
<td>body</td>
<td>string</td>
<td>描述可选（限制65535字符），自V2.55版本开始。</td>
</tr>
<tr>
<td>id (Optional)</td>
<td>body</td>
<td>string</td>
<td>Flavor的ID，缺省为uuid。</td>
</tr>
<tr>
<td>ram</td>
<td>body</td>
<td>integer</td>
<td>内存大小（单位MiB）。</td>
</tr>
<tr>
<td>disk</td>
<td>body</td>
<td>integer</td>
<td>磁盘大小（单位GiB）。.</td>
</tr>
<tr>
<td>vcpus</td>
<td>body</td>
<td>integer</td>
<td>虚拟CPU个数(vCPUs)。</td>
</tr>
<tr>
<td>OS-FLV-EXT-DATA:ephemeral (Optional)</td>
<td>body</td>
<td>integer</td>
<td>临时磁盘的大小（单位GiB）。</td>
</tr>
<tr>
<td>swap (Optional)</td>
<td>body</td>
<td>integer</td>
<td>交换磁盘大小，单位为MiB。</td>
</tr>
<tr>
<td>rxtx_factor (Optional)</td>
<td>body</td>
<td>float</td>
<td>如果网络后端支持QOS扩展，将在端口上设置的接收/发送因子（作为一个浮动）。否则将被忽略。它的默认值是1.0。</td>
</tr>
<tr>
<td>os-flavor-access:is_public (Optional)</td>
<td>body</td>
<td>boolean</td>
<td>主机类型是公用还是项目专有？默认公用。</td>
</tr>
</tbody></table>
<p>响应（Response）说明见表4：<br>表4 响应（Response）说明</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>位置</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>flavor</td>
<td>body</td>
<td>object</td>
<td>Flavor一种主机类型。</td>
</tr>
<tr>
<td>name</td>
<td>body</td>
<td>string</td>
<td>名称。</td>
</tr>
<tr>
<td>description</td>
<td>body</td>
<td>string</td>
<td>描述可选（限制65535字符），自V2.55版本开始。</td>
</tr>
<tr>
<td>id</td>
<td>body</td>
<td>string</td>
<td>Flavor的ID，缺省为uuid。</td>
</tr>
<tr>
<td>ram</td>
<td>body</td>
<td>integer</td>
<td>内存大小（单位MiB）。</td>
</tr>
<tr>
<td>disk</td>
<td>body</td>
<td>integer</td>
<td>磁盘大小（单位GiB）。.</td>
</tr>
<tr>
<td>vcpus</td>
<td>body</td>
<td>integer</td>
<td>虚拟CPU个数(vCPUs)。</td>
</tr>
<tr>
<td>links</td>
<td>body</td>
<td>array</td>
<td>资源链接。</td>
</tr>
<tr>
<td>OS-FLV-EXT-DATA:ephemeral</td>
<td>body</td>
<td>integer</td>
<td>交换磁盘大小，单位为MiB。</td>
</tr>
<tr>
<td>OS-FLV-DISABLED:disabled (Optional)</td>
<td>body</td>
<td>boolean</td>
<td>是否禁用。通常只对管理用户可见。</td>
</tr>
<tr>
<td>swap</td>
<td>body</td>
<td>integer</td>
<td>交换磁盘大小，单位为MiB。</td>
</tr>
<tr>
<td>rxtx_factor</td>
<td>body</td>
<td>float</td>
<td>如果网络后端支持QOS扩展，将在端口上设置的接收/发送因子（作为一个浮动）。否则将被忽略。它的默认值是1.0。</td>
</tr>
<tr>
<td>os-flavor-access:is_public</td>
<td>body</td>
<td>boolean</td>
<td>主机类型是公用还是项目专有？默认公用。</td>
</tr>
<tr>
<td>extra_specs (Optional)</td>
<td>body</td>
<td>object</td>
<td>额外规格（key、value键值对），自V2.61。</td>
</tr>
</tbody></table>
<p>创建Flavor的body json案例：</p>
<p>Example Create Flavor (v2.55) :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    <span class="string">&quot;flavor&quot;</span>: &#123;  </span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;test_flavor&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;ram&quot;</span>: <span class="number">1024</span>,  </span><br><span class="line">        <span class="string">&quot;vcpus&quot;</span>: <span class="number">2</span>,  </span><br><span class="line">        <span class="string">&quot;disk&quot;</span>: <span class="number">10</span>,  </span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;10&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;rxtx_factor&quot;</span>: <span class="number">2.0</span>,  </span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;test description&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>Example Create Flavor (v2.75) :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    <span class="string">&quot;flavor&quot;</span>: &#123;  </span><br><span class="line">        <span class="string">&quot;OS-FLV-DISABLED:disabled&quot;</span>: <span class="literal">false</span>,  </span><br><span class="line">        <span class="string">&quot;disk&quot;</span>: <span class="number">10</span>,  </span><br><span class="line">        <span class="string">&quot;OS-FLV-EXT-DATA:ephemeral&quot;</span>: <span class="number">0</span>,  </span><br><span class="line">        <span class="string">&quot;os-flavor-access:is_public&quot;</span>: <span class="literal">true</span>,  </span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;10&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;links&quot;</span>: [  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://openstack.example.com/v2/6f70656e737461636b20342065766572/flavors/10&quot;</span>,  </span><br><span class="line">                <span class="string">&quot;rel&quot;</span>: <span class="string">&quot;self&quot;</span>  </span><br><span class="line">            &#125;,  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://openstack.example.com/6f70656e737461636b20342065766572/flavors/10&quot;</span>,  </span><br><span class="line">                <span class="string">&quot;rel&quot;</span>: <span class="string">&quot;bookmark&quot;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        ],  </span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;test_flavor&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;ram&quot;</span>: <span class="number">1024</span>,  </span><br><span class="line">        <span class="string">&quot;swap&quot;</span>: <span class="number">0</span>,  </span><br><span class="line">        <span class="string">&quot;rxtx_factor&quot;</span>: <span class="number">2.0</span>,  </span><br><span class="line">        <span class="string">&quot;vcpus&quot;</span>: <span class="number">2</span>,  </span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;test description&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;extra_specs&quot;</span>: &#123;&#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>其他接口参数基本一致，可以查看每个接口的request与response的数据格式。</p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><p>创建apis_flavor_manager.py文件实现，主机类型创建、查找、删除、更新。代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright 2021~2022 The Cloud Computing support Teams of ChinaSkills.  </span></span><br><span class="line"><span class="keyword">import</span> requests,json,time  </span><br><span class="line"><span class="keyword">import</span> logging  </span><br><span class="line"><span class="comment">#-----------logger-----------  </span></span><br><span class="line"><span class="comment">#get logger  </span></span><br><span class="line">logger = logging.getLogger(__name__)  </span><br><span class="line"><span class="comment"># level  </span></span><br><span class="line">logger.setLevel(logging.DEBUG)  </span><br><span class="line"><span class="comment"># format  </span></span><br><span class="line"><span class="built_in">format</span> = logging.Formatter(<span class="string">&#x27;%(asctime)s %(message)s&#x27;</span>)  </span><br><span class="line"><span class="comment"># to console  </span></span><br><span class="line">stream_handler  = logging.StreamHandler()  </span><br><span class="line">stream_handler .setFormatter(<span class="built_in">format</span>)  </span><br><span class="line">logger.addHandler(stream_handler )  </span><br><span class="line"><span class="comment">#-----------logger-----------  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_auth_token</span>(<span class="params">controller_ip, domain, user, password</span>):  </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">    :param controller_ip: openstack master ip address  </span></span><br><span class="line"><span class="string">    :param domain: current user&#x27;s domain  </span></span><br><span class="line"><span class="string">    :param user: user name  </span></span><br><span class="line"><span class="string">    :param password: user password  </span></span><br><span class="line"><span class="string">    :return: keystoen auth Token for current user.  </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        url = <span class="string">f&quot;http://<span class="subst">&#123;controller_ip&#125;</span>:5000/v3/auth/tokens&quot;</span>  </span><br><span class="line">        body = &#123;  </span><br><span class="line">                    <span class="string">&quot;auth&quot;</span>: &#123;  </span><br><span class="line">                        <span class="string">&quot;identity&quot;</span>: &#123;  </span><br><span class="line">                            <span class="string">&quot;methods&quot;</span>: [  </span><br><span class="line">                                <span class="string">&quot;password&quot;</span>  </span><br><span class="line">                            ],  </span><br><span class="line">                            <span class="string">&quot;password&quot;</span>: &#123;  </span><br><span class="line">                                <span class="string">&quot;user&quot;</span>: &#123;  </span><br><span class="line">                                    <span class="string">&quot;domain&quot;</span>: &#123;  </span><br><span class="line">                                        <span class="string">&quot;name&quot;</span>: domain  </span><br><span class="line">                                    &#125;,  </span><br><span class="line">                                    <span class="string">&quot;name&quot;</span>: user,  </span><br><span class="line">                                    <span class="string">&quot;password&quot;</span>: password  </span><br><span class="line">                                &#125;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;,  </span><br><span class="line">                        <span class="string">&quot;scope&quot;</span>: &#123;  </span><br><span class="line">                            <span class="string">&quot;project&quot;</span>: &#123;  </span><br><span class="line">                                <span class="string">&quot;domain&quot;</span>: &#123;  </span><br><span class="line">                                    <span class="string">&quot;name&quot;</span>: domain  </span><br><span class="line">                                &#125;,  </span><br><span class="line">                                <span class="string">&quot;name&quot;</span>: user  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">        headers = &#123;  </span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">print</span>(body)  </span><br><span class="line">        Token = requests.post(url, data=json.dumps(body), headers=headers).headers[<span class="string">&#x27;X-Subject-Token&#x27;</span>]  </span><br><span class="line">        headers = &#123;  </span><br><span class="line">            <span class="string">&quot;X-Auth-Token&quot;</span>: Token  </span><br><span class="line">        &#125;  </span><br><span class="line">        logger.debug(<span class="string">f&quot;获取Token值：<span class="subst">&#123;<span class="built_in">str</span>(Token)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> headers  </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">        logger.error(<span class="string">f&quot;获取Token值失败，请检查访问云主机控制节点IP是否正确？输出错误信息如下：<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)  </span><br><span class="line">        exit(<span class="number">0</span>)  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">flavor_manager</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,handers:<span class="built_in">dict</span>,resUrl:<span class="built_in">str</span></span>):  </span><br><span class="line">        self.headers=handers  </span><br><span class="line">        self.resUrl=resUrl  </span><br><span class="line">    <span class="comment">#创建flavor类型  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_flavor</span>(<span class="params">self,flavor_name:<span class="built_in">str</span>,ram,vcpus,disk,<span class="built_in">id</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        :param flavor_name:  </span></span><br><span class="line"><span class="string">        :param ram:  </span></span><br><span class="line"><span class="string">        :param vcpus:  </span></span><br><span class="line"><span class="string">        :param disk:  </span></span><br><span class="line"><span class="string">        :param id:  </span></span><br><span class="line"><span class="string">        :return status_code:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        self.headers[<span class="string">&#x27;Content-Type&#x27;</span>]=<span class="string">&quot;application/json&quot;</span>  </span><br><span class="line">        body=&#123;  </span><br><span class="line">            <span class="string">&quot;flavor&quot;</span>:&#123;  </span><br><span class="line">                <span class="string">&quot;name&quot;</span>:flavor_name,  </span><br><span class="line">                <span class="string">&quot;ram&quot;</span>:ram,  </span><br><span class="line">                <span class="string">&quot;vcpus&quot;</span>:vcpus,  </span><br><span class="line">                <span class="string">&quot;disk&quot;</span>:disk,  </span><br><span class="line">                <span class="string">&quot;id&quot;</span>:<span class="built_in">id</span>,  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        logger.debug(<span class="string">f&quot;创建flavor请求body:<span class="subst">&#123;<span class="built_in">str</span>(body)&#125;</span>&quot;</span>)  </span><br><span class="line">        status_code = requests.post(self.resUrl, data=json.dumps(body), headers=self.headers).text  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回状态:<span class="subst">&#123;<span class="built_in">str</span>(status_code)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span>  status_code  </span><br><span class="line">    <span class="comment">#获取all flavors  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_flavors</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        get all flavors  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        result = json.loads(requests.get(self.resUrl,headers=self.headers).text)  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回信息:<span class="subst">&#123;<span class="built_in">str</span>(result)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line">        <span class="comment"># 获取flavor_id  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_flavor</span>(<span class="params">self, <span class="built_in">id</span>:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        get a flavor by id.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        api_url = self.resUrl + <span class="string">&quot;/&quot;</span>+<span class="built_in">id</span>  </span><br><span class="line">        result = json.loads(requests.get(api_url, headers=self.headers).text)  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回信息:<span class="subst">&#123;<span class="built_in">str</span>(result)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_flavor</span>(<span class="params">self, <span class="built_in">id</span>:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        delete a flavor by id.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        api_url = self.resUrl + <span class="string">&quot;/&quot;</span>+<span class="built_in">id</span>  </span><br><span class="line">        response = requests.delete(api_url, headers=self.headers)  </span><br><span class="line">        <span class="comment">#Normal response codes: 202 without return text  </span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">202</span>:  </span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;itemDeletedSuccess&quot;</span>: response.status_code&#125;  </span><br><span class="line">        result = json.loads(response.text)  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回信息:<span class="subst">&#123;<span class="built_in">str</span>(result)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line">    <span class="comment">#http://192.168.200.226:8774/v2.1/ get apis version infomation.  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_flavor_desc</span>(<span class="params">self, <span class="built_in">id</span>: <span class="built_in">str</span>, desc:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        update a flavor desc by id.(需要带小版本号）  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment"># 特别注意：This API is available starting with microversion 2.55.  </span></span><br><span class="line">        self.headers[<span class="string">&#x27;X-OpenStack-Nova-API-Version&#x27;</span>] = <span class="string">&quot;2.55&quot;</span>  </span><br><span class="line">        self.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&quot;application/json&quot;</span>  </span><br><span class="line">        body = &#123;  </span><br><span class="line">            <span class="string">&quot;flavor&quot;</span>: &#123;  </span><br><span class="line">                <span class="string">&quot;description&quot;</span>: desc  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        api_url = self.resUrl + <span class="string">&quot;/&quot;</span> + <span class="built_in">id</span>  </span><br><span class="line">        response = requests.put(api_url, data=json.dumps(body), headers=self.headers)  </span><br><span class="line">        <span class="comment"># Normal response codes: 202 without return text  </span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">202</span>:  </span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;itemUpdateSuccess&quot;</span>: response.status_code&#125;  </span><br><span class="line">        result = json.loads(response.text)  </span><br><span class="line">        logger.debug(<span class="string">f&quot;返回信息:<span class="subst">&#123;<span class="built_in">str</span>(result)&#125;</span>&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> result  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    <span class="comment"># openstack allinone （controller ) credentials  </span></span><br><span class="line">    <span class="comment"># host ip address  </span></span><br><span class="line">    controller_ip = <span class="string">&quot;192.168.200.226&quot;</span>  </span><br><span class="line">    <span class="comment"># domain name  </span></span><br><span class="line">    domain = <span class="string">&quot;demo&quot;</span>  </span><br><span class="line">    <span class="comment"># user name  </span></span><br><span class="line">    user = <span class="string">&quot;admin&quot;</span>  </span><br><span class="line">    <span class="comment"># user password  </span></span><br><span class="line">    password = <span class="string">&quot;000000&quot;</span>  </span><br><span class="line">    headers = get_auth_token(controller_ip,domain,user,password)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;headers:&quot;</span>, headers)  </span><br><span class="line">    <span class="comment">#. get token  </span></span><br><span class="line">    flavor_m = flavor_manager(headers, <span class="string">f&quot;http://<span class="subst">&#123;controller_ip&#125;</span>:8774/v2.1/flavors&quot;</span>)  </span><br></pre></td></tr></table></figure>

<h4 id="代码验证-1"><a href="#代码验证-1" class="headerlink" title="代码验证"></a>代码验证</h4><p>① 登录通过账号密码方式：使用get_auth_token()方法，通过该方法获取Token值。<br>② 封装了flavor_manager类，通过python request库实现对API的网络访问，实现对用户的增删查改操作。</p>
<ul>
<li>创建：POST v2.1/flavors</li>
<li>查询：get v2.1/flavors</li>
<li>删除：delete v2.1/flavors/id</li>
<li>更改密码：put v2.1/flavors/id</li>
</ul>
<p>具体可以通过官网的API说明。<br>③ 执行flavor_manager的每个方法进行代码测试，通过openstack flavor命令行或Dashboard界面进行研究者。</p>
<p>修改apis_flavor_manager.py的if <strong>name</strong> == ‘__main__’:函数中OpenStack的IP、domain、user、password，执行apis_flavor_manager.py，进行查询所有、创建、根据ID查询、更新描述。在apis_flavor_manager.py的 <strong>name</strong> == ‘<strong>main</strong>‘代码段最后添加如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#. get token  </span></span><br><span class="line">    flavor_m = flavor_manager(headers, <span class="string">f&quot;http://<span class="subst">&#123;controller_ip&#125;</span>:8774/v2.1/flavors&quot;</span>)  </span><br><span class="line">    <span class="comment">#1 查所有  </span></span><br><span class="line">    flavors = flavor_m.get_flavors()  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;查询所有flavors:&quot;</span>, flavors)  </span><br><span class="line">    <span class="comment">#  </span></span><br><span class="line">    <span class="comment">#2 如果存在，先删除存在的flavor 100000  </span></span><br><span class="line">    flavor = flavor_m.delete_flavor(<span class="string">&quot;100000&quot;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;查询id=100000 flavor:&quot;</span>, flavor)  </span><br><span class="line">    <span class="comment">#  </span></span><br><span class="line">    <span class="comment">#3 创建 flavor first 100000  </span></span><br><span class="line">    <span class="comment"># # id 是唯一的  </span></span><br><span class="line">    status_code = flavor_m.create_flavor(flavor_name=<span class="string">&quot;flavor_small&quot;</span>, ram=<span class="number">1024</span>, vcpus=<span class="number">1</span>, disk=<span class="number">10</span>, <span class="built_in">id</span>=<span class="number">100000</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建主机类型:&quot;</span>, status_code)  </span><br><span class="line">    <span class="comment">#4 查询  </span></span><br><span class="line">    flavor = flavor_m.get_flavor(<span class="string">&quot;100000&quot;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;查询id=100000 flavor:&quot;</span>, flavor)  </span><br><span class="line">    <span class="comment">#  </span></span><br><span class="line">    <span class="comment">#5 更新描述  </span></span><br><span class="line">    status_code = flavor_m.update_flavor_desc(<span class="string">&quot;100000&quot;</span>,  <span class="string">&quot;Update description skill_china&quot;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;更新主机类型描述:&quot;</span>, status_code)  </span><br><span class="line">    <span class="comment">#6 查询  </span></span><br><span class="line">    flavors = flavor_m.get_flavor(<span class="string">&quot;100000&quot;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;查询所有flavors:&quot;</span>, flavors)  </span><br><span class="line">    <span class="comment">#  </span></span><br><span class="line">    <span class="comment"># print(&quot;---------finished------------&quot;)  </span></span><br></pre></td></tr></table></figure>

<p>通过OpenStack平台查询镜像ID、FlavorID、网络ID，替换以上参数，然后执行apis_flavor_manager.py，结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# python3 apis_flavor_manager.py  </span><br><span class="line">&#123;&#x27;auth&#x27;: &#123;&#x27;identity&#x27;: &#123;&#x27;methods&#x27;: [&#x27;password&#x27;], &#x27;password&#x27;: &#123;&#x27;user&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;password&#x27;: &#x27;000000&#x27;&#125;&#125;&#125;, &#x27;scope&#x27;: &#123;&#x27;project&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;&#125;&#125;&#125;&#125;  </span><br><span class="line">headers: &#123;&#x27;X-Auth-Token&#x27;: &#x27;gAAAAABiKYYsaQyAaxh8lleESSUcUz01l-PYNoHMuptZ8sQLRD5hcSG9nPS6e39n1yVi1P6sPv1dfQVH7YAvJnMik5sEHW0ci7B8IDjrTz5hncpKr9xdqNSBskLAuJFBK49iNIj8w4eBF-LWi-vR454wju7zJiULjeWXdTiIDz6mDOJN1HyBwx4&#x27;&#125;  </span><br><span class="line">2022-03-10 13:07:59,869 获取Token值：gAAAAABiKYYsaQyAaxh8lleESSUcUz01l-PYNoHMuptZ8sQLRD5hcSG9nPS6e39n1yVi1P6sPv1dfQVH7YAvJnMik5sEHW0ci7B8IDjrTz5hncpKr9xdqNSBskLAuJFBK49iNIj8w4eBF-LWi-vR454wju7zJiULjeWXdTiIDz6mDOJN1HyBwx4  </span><br><span class="line">查询所有flavors: &#123;&#x27;flavors&#x27;: [&#123;&#x27;id&#x27;: &#x27;1&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/1&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/1&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;m1.tiny&#x27;&#125;, &#123;&#x27;id&#x27;: &#x27;2&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/2&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/2&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;m1.small&#x27;&#125;, &#123;&#x27;id&#x27;: &#x27;3&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/3&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/3&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;m1.medium&#x27;&#125;]&#125;  </span><br><span class="line">2022-03-10 13:08:00,454 返回信息:&#123;&#x27;flavors&#x27;: [&#123;&#x27;id&#x27;: &#x27;1&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/1&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/1&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;m1.tiny&#x27;&#125;, &#123;&#x27;id&#x27;: &#x27;2&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/2&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/2&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;m1.small&#x27;&#125;, &#123;&#x27;id&#x27;: &#x27;3&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/3&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/3&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;m1.medium&#x27;&#125;]&#125;  </span><br><span class="line">查询id=100000 flavor: &#123;&#x27;itemNotFound&#x27;: &#123;&#x27;message&#x27;: &#x27;Flavor 100000 could not be found.&#x27;, &#x27;code&#x27;: 404&#125;&#125;  </span><br><span class="line">2022-03-10 13:08:00,963 返回信息:&#123;&#x27;itemNotFound&#x27;: &#123;&#x27;message&#x27;: &#x27;Flavor 100000 could not be found.&#x27;, &#x27;code&#x27;: 404&#125;&#125;  </span><br><span class="line">2022-03-10 13:08:00,963 创建flavor请求body:&#123;&#x27;flavor&#x27;: &#123;&#x27;name&#x27;: &#x27;flavor_small&#x27;, &#x27;ram&#x27;: 1024, &#x27;vcpus&#x27;: 1, &#x27;disk&#x27;: 10, &#x27;id&#x27;: 100000&#125;&#125;  </span><br><span class="line">2022-03-10 13:08:01,516 返回状态:&#123;&quot;flavor&quot;: &#123;&quot;links&quot;: [&#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/v2.1/flavors/100000&quot;, &quot;rel&quot;: &quot;self&quot;&#125;, &#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/flavors/100000&quot;, &quot;rel&quot;: &quot;bookmark&quot;&#125;], &quot;ram&quot;: 1024, &quot;OS-FLV-DISABLED:disabled&quot;: false, &quot;os-flavor-access:is_public&quot;: true, &quot;rxtx_factor&quot;: 1.0, &quot;disk&quot;: 10, &quot;id&quot;: &quot;100000&quot;, &quot;name&quot;: &quot;flavor_small&quot;, &quot;vcpus&quot;: 1, &quot;swap&quot;: &quot;&quot;, &quot;OS-FLV-EXT-DATA:ephemeral&quot;: 0&#125;&#125;  </span><br><span class="line">创建主机类型: &#123;&quot;flavor&quot;: &#123;&quot;links&quot;: [&#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/v2.1/flavors/100000&quot;, &quot;rel&quot;: &quot;self&quot;&#125;, &#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/flavors/100000&quot;, &quot;rel&quot;: &quot;bookmark&quot;&#125;], &quot;ram&quot;: 1024, &quot;OS-FLV-DISABLED:disabled&quot;: false, &quot;os-flavor-access:is_public&quot;: true, &quot;rxtx_factor&quot;: 1.0, &quot;disk&quot;: 10, &quot;id&quot;: &quot;100000&quot;, &quot;name&quot;: &quot;flavor_small&quot;, &quot;vcpus&quot;: 1, &quot;swap&quot;: &quot;&quot;, &quot;OS-FLV-EXT-DATA:ephemeral&quot;: 0&#125;&#125;  </span><br><span class="line">2022-03-10 13:08:02,041 返回信息:&#123;&#x27;flavor&#x27;: &#123;&#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;ram&#x27;: 1024, &#x27;OS-FLV-DISABLED:disabled&#x27;: False, &#x27;os-flavor-access:is_public&#x27;: True, &#x27;rxtx_factor&#x27;: 1.0, &#x27;disk&#x27;: 10, &#x27;id&#x27;: &#x27;100000&#x27;, &#x27;name&#x27;: &#x27;flavor_small&#x27;, &#x27;vcpus&#x27;: 1, &#x27;swap&#x27;: &#x27;&#x27;, &#x27;OS-FLV-EXT-DATA:ephemeral&#x27;: 0&#125;&#125;  </span><br><span class="line">查询id=100000 flavor: &#123;&#x27;flavor&#x27;: &#123;&#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;ram&#x27;: 1024, &#x27;OS-FLV-DISABLED:disabled&#x27;: False, &#x27;os-flavor-access:is_public&#x27;: True, &#x27;rxtx_factor&#x27;: 1.0, &#x27;disk&#x27;: 10, &#x27;id&#x27;: &#x27;100000&#x27;, &#x27;name&#x27;: &#x27;flavor_small&#x27;, &#x27;vcpus&#x27;: 1, &#x27;swap&#x27;: &#x27;&#x27;, &#x27;OS-FLV-EXT-DATA:ephemeral&#x27;: 0&#125;&#125;  </span><br><span class="line">更新主机类型描述: &#123;&#x27;flavor&#x27;: &#123;&#x27;description&#x27;: &#x27;Update description skill_china&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;ram&#x27;: 1024, &#x27;OS-FLV-DISABLED:disabled&#x27;: False, &#x27;os-flavor-access:is_public&#x27;: True, &#x27;rxtx_factor&#x27;: 1.0, &#x27;disk&#x27;: 10, &#x27;id&#x27;: &#x27;100000&#x27;, &#x27;name&#x27;: &#x27;flavor_small&#x27;, &#x27;vcpus&#x27;: 1, &#x27;swap&#x27;: &#x27;&#x27;, &#x27;OS-FLV-EXT-DATA:ephemeral&#x27;: 0&#125;&#125;  </span><br><span class="line">2022-03-10 13:08:02,522 返回信息:&#123;&#x27;flavor&#x27;: &#123;&#x27;description&#x27;: &#x27;Update description skill_china&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;ram&#x27;: 1024, &#x27;OS-FLV-DISABLED:disabled&#x27;: False, &#x27;os-flavor-access:is_public&#x27;: True, &#x27;rxtx_factor&#x27;: 1.0, &#x27;disk&#x27;: 10, &#x27;id&#x27;: &#x27;100000&#x27;, &#x27;name&#x27;: &#x27;flavor_small&#x27;, &#x27;vcpus&#x27;: 1, &#x27;swap&#x27;: &#x27;&#x27;, &#x27;OS-FLV-EXT-DATA:ephemeral&#x27;: 0&#125;&#125;  </span><br><span class="line">查询所有flavors: &#123;&#x27;flavor&#x27;: &#123;&#x27;description&#x27;: &#x27;Update description skill_china&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;ram&#x27;: 1024, &#x27;OS-FLV-DISABLED:disabled&#x27;: False, &#x27;os-flavor-access:is_public&#x27;: True, &#x27;rxtx_factor&#x27;: 1.0, &#x27;disk&#x27;: 10, &#x27;id&#x27;: &#x27;100000&#x27;, &#x27;name&#x27;: &#x27;flavor_small&#x27;, &#x27;vcpus&#x27;: 1, &#x27;swap&#x27;: &#x27;&#x27;, &#x27;OS-FLV-EXT-DATA:ephemeral&#x27;: 0&#125;&#125;  </span><br><span class="line">2022-03-10 13:08:02,933 返回信息:&#123;&#x27;flavor&#x27;: &#123;&#x27;description&#x27;: &#x27;Update description skill_china&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/100000&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;ram&#x27;: 1024, &#x27;OS-FLV-DISABLED:disabled&#x27;: False, &#x27;os-flavor-access:is_public&#x27;: True, &#x27;rxtx_factor&#x27;: 1.0, &#x27;disk&#x27;: 10, &#x27;id&#x27;: &#x27;100000&#x27;, &#x27;name&#x27;: &#x27;flavor_small&#x27;, &#x27;vcpus&#x27;: 1, &#x27;swap&#x27;: &#x27;&#x27;, &#x27;OS-FLV-EXT-DATA:ephemeral&#x27;: 0&#125;&#125;  </span><br><span class="line">Process finished with exit code 0  </span><br></pre></td></tr></table></figure>

<h3 id="计算服务：云主机管理"><a href="#计算服务：云主机管理" class="headerlink" title="计算服务：云主机管理"></a>计算服务：云主机管理</h3><h4 id="接口说明-2"><a href="#接口说明-2" class="headerlink" title="接口说明"></a>接口说明</h4><p>计算服务的API官网：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/api-guide/compute/index.html">https://docs.openstack.org/api-guide/compute/index.html</a><br>Nova项目提供了RESTful HTTP服务：OpenStack Compute API。这些API提供了对计算资源的大规模可伸缩、随需应变、自服务访问能力。<br>API版本：<br>在Mitaka发布之后，每个Nova部署都应该有以下服务端点：</p>
<ul>
<li>/ -可用版本列表</li>
<li>/v2 -计算API的第一个版本，使用扩展（称之为计算API v2.0）</li>
<li>/v2.1 -相同的API，只是使用了微版本</li>
</ul>
<p>文档只要给出v2.1 API接口说明。<br>以下以主机（servers）管理为案例，实现Python代码。具体APIs说明参见：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/compute/">https://docs.openstack.org/api-ref/compute/</a><br>接口清单如图4所示，涉及查询（Get）、创建（POST）、更新（PUT）与删除（DELETE）。</p>
<p><img src="../../../../images/image/DX/76.png" alt="76"></p>
<p>图4<br>具体参看：<a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/compute/#servers-servers">https://docs.openstack.org/api-ref/compute/#servers-servers</a><br>创建主机接口说明：<br>创建servers使用接口：POST /servers。创建Server需要租户管理员权限，调用正常响应码为202，错误响应码为badRequest(400), unauthorized(401), forbidden(403), itemNotFound(404),conflict(409)。<br>请求（Request）说明（主要参数）见表5：<br>表5请求（Request）参数说明</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>位置</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>server</td>
<td>body</td>
<td>object</td>
<td>云主机</td>
</tr>
<tr>
<td>flavorRef</td>
<td>body</td>
<td>string</td>
<td>云主机类型ID。</td>
</tr>
<tr>
<td>name</td>
<td>body</td>
<td>string</td>
<td>名称</td>
</tr>
<tr>
<td>networks</td>
<td>body</td>
<td>array</td>
<td>网络</td>
</tr>
<tr>
<td>networks.uuid (Optional)</td>
<td>body</td>
<td>string</td>
<td>网络UUID</td>
</tr>
<tr>
<td>networks.port (Optional)</td>
<td>body</td>
<td>string</td>
<td>网络端口</td>
</tr>
<tr>
<td>networks.fixed_ip (Optional)</td>
<td>body</td>
<td>string</td>
<td>固定IP</td>
</tr>
</tbody></table>
<p>创建云主机的body json案例如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    &quot;server&quot; : &#123;  </span><br><span class="line">        &quot;name&quot; : &quot;device-tagging-server&quot;,  </span><br><span class="line">        &quot;imageRef&quot;: &quot;70a599e0-31e7-49b7-b260-868f441e862b&quot;,  </span><br><span class="line">        &quot;flavorRef&quot; : &quot;http://openstack.example.com/flavors/1&quot;,  </span><br><span class="line">        &quot;networks&quot; : [&#123;  </span><br><span class="line">            &quot;uuid&quot; : &quot;3cb9bc59-5699-4588-a4b1-b87f96708bc6&quot;,  </span><br><span class="line">            &quot;tag&quot;: &quot;nic1&quot;  </span><br><span class="line">        &#125;],  </span><br><span class="line">        &quot;block_device_mapping_v2&quot;: [&#123;  </span><br><span class="line">            &quot;uuid&quot;: &quot;70a599e0-31e7-49b7-b260-868f441e862b&quot;,  </span><br><span class="line">            &quot;source_type&quot;: &quot;image&quot;,  </span><br><span class="line">            &quot;destination_type&quot;: &quot;volume&quot;,  </span><br><span class="line">            &quot;boot_index&quot;: 0,  </span><br><span class="line">            &quot;volume_size&quot;: &quot;1&quot;,  </span><br><span class="line">            &quot;tag&quot;: &quot;disk1&quot;  </span><br><span class="line">        &#125;]  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>响应Response见表6：<br>表6 响应Response参数说明</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>位置</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>flavor</td>
<td>body</td>
<td>object</td>
<td>Flavor一种主机类型。</td>
</tr>
<tr>
<td>name</td>
<td>body</td>
<td>string</td>
<td>名称。</td>
</tr>
<tr>
<td>description</td>
<td>body</td>
<td>string</td>
<td>描述可选（限制65535字符），自V2.55版本开始。</td>
</tr>
<tr>
<td>id</td>
<td>body</td>
<td>string</td>
<td>Flavor的ID，缺省为uuid。</td>
</tr>
<tr>
<td>ram</td>
<td>body</td>
<td>integer</td>
<td>内存大小（单位MiB）。</td>
</tr>
<tr>
<td>disk</td>
<td>body</td>
<td>integer</td>
<td>磁盘大小（单位GiB）。.</td>
</tr>
<tr>
<td>vcpus</td>
<td>body</td>
<td>integer</td>
<td>虚拟CPU个数(vCPUs)。</td>
</tr>
<tr>
<td>links</td>
<td>body</td>
<td>array</td>
<td>资源链接。</td>
</tr>
<tr>
<td>OS-FLV-EXT-DATA:ephemeral</td>
<td>body</td>
<td>integer</td>
<td>交换磁盘大小，单位为MiB。</td>
</tr>
<tr>
<td>OS-FLV-DISABLED:disabled (Optional)</td>
<td>body</td>
<td>boolean</td>
<td>是否禁用。通常只对管理用户可见。</td>
</tr>
<tr>
<td>swap</td>
<td>body</td>
<td>integer</td>
<td>交换磁盘大小，单位为MiB。</td>
</tr>
<tr>
<td>rxtx_factor</td>
<td>body</td>
<td>float</td>
<td>如果网络后端支持QOS扩展，将在端口上设置的接收/发送因子（作为一个浮动）。否则将被忽略。它的默认值是1.0。</td>
</tr>
<tr>
<td>os-flavor-access:is_public</td>
<td>body</td>
<td>boolean</td>
<td>主机类型是公用还是项目专有？默认公用。</td>
</tr>
<tr>
<td>extra_specs (Optional)</td>
<td>body</td>
<td>object</td>
<td>额外规格(key、value键值对)，自V2.61。</td>
</tr>
</tbody></table>
<p>Example Create Flavor (v2.55)：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    &quot;flavor&quot;: &#123;  </span><br><span class="line">        &quot;name&quot;: &quot;test_flavor&quot;,  </span><br><span class="line">        &quot;ram&quot;: 1024,  </span><br><span class="line">        &quot;vcpus&quot;: 2,  </span><br><span class="line">        &quot;disk&quot;: 10,  </span><br><span class="line">        &quot;id&quot;: &quot;10&quot;,  </span><br><span class="line">        &quot;rxtx_factor&quot;: 2.0,  </span><br><span class="line">        &quot;description&quot;: &quot;test description&quot;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>Example Create Flavor (v2.75)：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    &quot;flavor&quot;: &#123;  </span><br><span class="line">        &quot;OS-FLV-DISABLED:disabled&quot;: false,  </span><br><span class="line">        &quot;disk&quot;: 10,  </span><br><span class="line">        &quot;OS-FLV-EXT-DATA:ephemeral&quot;: 0,  </span><br><span class="line">        &quot;os-flavor-access:is_public&quot;: true,  </span><br><span class="line">        &quot;id&quot;: &quot;10&quot;,  </span><br><span class="line">        &quot;links&quot;: [  </span><br><span class="line">            &#123;  </span><br><span class="line">                &quot;href&quot;: &quot;http://openstack.example.com/v2/6f70656e737461636b20342065766572/flavors/10&quot;,  </span><br><span class="line">                &quot;rel&quot;: &quot;self&quot;  </span><br><span class="line">            &#125;,  </span><br><span class="line">            &#123;  </span><br><span class="line">                &quot;href&quot;: &quot;http://openstack.example.com/6f70656e737461636b20342065766572/flavors/10&quot;,  </span><br><span class="line">                &quot;rel&quot;: &quot;bookmark&quot;  </span><br><span class="line">            &#125;  </span><br><span class="line">        ],  </span><br><span class="line">        &quot;name&quot;: &quot;test_flavor&quot;,  </span><br><span class="line">        &quot;ram&quot;: 1024,  </span><br><span class="line">        &quot;swap&quot;: 0,  </span><br><span class="line">        &quot;rxtx_factor&quot;: 2.0,  </span><br><span class="line">        &quot;vcpus&quot;: 2,  </span><br><span class="line">        &quot;description&quot;: &quot;test description&quot;,  </span><br><span class="line">        &quot;extra_specs&quot;: &#123;&#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><p>创建apis_server_manager.py文件实现，主机类型创建、查找、删除、更新。代码如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright 2021~2022 The Cloud Computing support Teams of ChinaSkills.</span></span><br><span class="line"></span><br><span class="line">import requests, json, time</span><br><span class="line">import logging</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-----------logger-----------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get logger</span></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">level</span></span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">format</span></span><br><span class="line">format = logging.Formatter(&#x27;%(asctime)s %(message)s&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to console</span></span><br><span class="line">stream_handler = logging.StreamHandler()</span><br><span class="line">stream_handler.setFormatter(format)</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-----------logger-----------</span></span><br><span class="line"></span><br><span class="line">def get_auth_token(controller_ip, domain, user, password):</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    :param controller_ip: openstack master ip address</span><br><span class="line">    :param domain: current user&#x27;s domain</span><br><span class="line">    :param user: user name</span><br><span class="line">    :param password: user password</span><br><span class="line">    :return: keystoen auth Token for current user.</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        url = f&quot;http://&#123;controller_ip&#125;:5000/v3/auth/tokens&quot;</span><br><span class="line">        body = &#123;</span><br><span class="line">            &quot;auth&quot;: &#123;</span><br><span class="line">                &quot;identity&quot;: &#123;</span><br><span class="line">                    &quot;methods&quot;: [</span><br><span class="line">                        &quot;password&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;password&quot;: &#123;</span><br><span class="line">                        &quot;user&quot;: &#123;</span><br><span class="line">                            &quot;domain&quot;: &#123;</span><br><span class="line">                                &quot;name&quot;: domain</span><br><span class="line">                            &#125;,</span><br><span class="line">                            &quot;name&quot;: user,</span><br><span class="line">                            &quot;password&quot;: password</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;scope&quot;: &#123;</span><br><span class="line">                    &quot;project&quot;: &#123;</span><br><span class="line">                        &quot;domain&quot;: &#123;</span><br><span class="line">                            &quot;name&quot;: domain</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;name&quot;: user</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        headers = &#123;</span><br><span class="line">            &quot;Content-Type&quot;: &quot;application/json&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">        print(body)</span><br><span class="line">        Token = requests.post(url, data=json.dumps(body), headers=headers).headers[&#x27;X-Subject-Token&#x27;]</span><br><span class="line"></span><br><span class="line">        headers = &#123;</span><br><span class="line">            &quot;X-Auth-Token&quot;: Token</span><br><span class="line">        &#125;</span><br><span class="line">        logger.debug(f&quot;获取Token值：&#123;str(Token)&#125;&quot;)</span><br><span class="line">        return headers</span><br><span class="line">    except Exception as e:</span><br><span class="line">        logger.error(f&quot;获取Token值失败，请检查访问云主机控制节点IP是否正确？输出错误信息如下：&#123;str(e)&#125;&quot;)</span><br><span class="line">        exit(0)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">云主机管理</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://docs.openstack.org/api-ref/compute/?expanded=<span class="comment">#list-servers</span></span></span><br><span class="line">class server_manager:</span><br><span class="line">    def __init__(self, handers: dict, resUrl: str):</span><br><span class="line">        self.headers = handers</span><br><span class="line">        self.resUrl = resUrl</span><br><span class="line"></span><br><span class="line">        #      POST  v2/servers</span><br><span class="line"></span><br><span class="line">    def create_server(self, server_name: str, imageRef, flavorRef, networks_id):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        :param server_name:</span><br><span class="line">        :param container_format:</span><br><span class="line">        :param disk_format:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        body = &#123;</span><br><span class="line">            &quot;server&quot;: &#123;</span><br><span class="line">                &quot;name&quot;: server_name,</span><br><span class="line">                &quot;flavorRef&quot;: flavorRef,</span><br><span class="line">                &quot;imageRef&quot;: imageRef,</span><br><span class="line">                &quot;networks&quot;: [&#123;</span><br><span class="line">                    &quot;uuid&quot;: networks_id</span><br><span class="line">                &#125;],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # 必须内容 name、flavorRef、networks、imageRef</span><br><span class="line"></span><br><span class="line">        response = requests.post(self.resUrl, data=json.dumps(body), headers=self.headers)</span><br><span class="line">        logger.debug(response.status_code)</span><br><span class="line">        if response.status_code == 202:</span><br><span class="line">            return &#123;&quot;serverItemCreatedSuccess&quot;: response.status_code&#125;</span><br><span class="line"></span><br><span class="line">        return response.text</span><br><span class="line"></span><br><span class="line">    # 获取glance镜像id</span><br><span class="line">    def get_server_id(self, server_name: str):</span><br><span class="line">        result = json.loads(requests.get(self.resUrl, headers=self.headers).text)</span><br><span class="line">        logger.debug(result)</span><br><span class="line">        for item in result[&#x27;servers&#x27;]:</span><br><span class="line">            if (item[&#x27;name&#x27;] == server_name):</span><br><span class="line">                return item[&#x27;id&#x27;]</span><br><span class="line">        return &quot;&quot;</span><br><span class="line">    # ----------------------------</span><br><span class="line">    # /v2/servers</span><br><span class="line">    # List servers</span><br><span class="line">    def get_servers(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        status_code = requests.get(self.resUrl, headers=self.headers).text</span><br><span class="line">        logger.debug(f&quot;返回状态:&#123;str(status_code)&#125;&quot;)</span><br><span class="line">        return status_code</span><br><span class="line"></span><br><span class="line">    # /v2/servers/&#123;server_id&#125; Show server</span><br><span class="line"></span><br><span class="line">    def get_server(self, id: str):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        get a flavor by id.</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        api_url = self.resUrl + &quot;/&quot; + id</span><br><span class="line">        response = requests.get(api_url, headers=self.headers)</span><br><span class="line">        result = json.loads(response.text)</span><br><span class="line">        logger.debug(f&quot;返回信息:&#123;str(result)&#125;&quot;)</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">    # /v2/servers/&#123;server_id&#125; Delete server</span><br><span class="line">    def delete_server(self, id: str):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">         delete a user by id.</span><br><span class="line">         :return:</span><br><span class="line">         &quot;&quot;&quot;</span><br><span class="line">        api_url = self.resUrl + &quot;/&quot; + id</span><br><span class="line">        response = requests.delete(api_url, headers=self.headers)</span><br><span class="line"></span><br><span class="line">        # 204 - No Content	The server has fulfilled the request.</span><br><span class="line">        if response.status_code == 204:</span><br><span class="line">            return &#123;&quot;server itemDeletedSuccess&quot;: response.status_code&#125;</span><br><span class="line"></span><br><span class="line">        result = json.loads(response.text)</span><br><span class="line">        logger.debug(f&quot;返回信息:&#123;str(result)&#125;&quot;)</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">        # http://192.168.200.226:8774/v2.1/ get apis version infomation.</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # openstack allinone （controller ) credentials</span><br><span class="line">    # host ip address</span><br><span class="line">    controller_ip = &quot;192.168.200.226&quot;</span><br><span class="line">    # domain name</span><br><span class="line">    domain = &quot;demo&quot;</span><br><span class="line">    # user name</span><br><span class="line">    user = &quot;admin&quot;</span><br><span class="line">    # user password</span><br><span class="line">    password = &quot;000000&quot;</span><br><span class="line">    headers = get_auth_token(controller_ip, domain, user, password)</span><br><span class="line">    print(&quot;headers:&quot;, headers)</span><br></pre></td></tr></table></figure>

<h4 id="代码验证-2"><a href="#代码验证-2" class="headerlink" title="代码验证"></a>代码验证</h4><p>① 登录通过账号密码方式：使用get_auth_token()方法，通过该方法获取Token值。<br>② 封装了server_manager类，通过python request库实现对API的网络访问，实现对用户的增删查改操作。</p>
<ul>
<li>创建：POST v2.1/flavors</li>
<li>查询：get v2.1/flavors</li>
<li>删除：delete v2.1/flavors/id</li>
<li>更改密码：put v2.1/flavors/id</li>
</ul>
<p>具体可以通过官网的API说明。<br>③执行server_manager的每个方法进行代码测试，通过openstack server命令行或Dashboard界面进行研究者。<br>修改apis_server_manager.py的if <strong>name</strong> == ‘_<em>main__’:函数中OpenStack的IP、domain、user、password，执行apis</em> server _manager.py，进行查询所有、创建、根据ID查询、更新描述。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack image list</span><br><span class="line">+-------------------------------------+-----------+--------+</span><br><span class="line">| ID                                  | Name      | Status |</span><br><span class="line">+-------------------------------------+-----------+--------+</span><br><span class="line">|d50222d2-f737-4b47-ba7c-38eaa2418ff0 | cirros    | active |</span><br><span class="line">|038ba49b-ddee-4e0f-8ecb-6f64d2788138 | cirros002 | active |</span><br><span class="line">+-------------------------------------+-----------+--------+</span><br><span class="line">[root@controller ~]# openstack network list</span><br><span class="line">+------------------------------------+------+--------------------------------------+</span><br><span class="line">| ID                                 | Name | Subnets                              |</span><br><span class="line">+------------------------------------+------+--------------------------------------+</span><br><span class="line">|df62ea19-3e33-40bf-9f41-f2c5f343b3e7| net  | a16130c4-79c1-4ae8-9bc3-c167ee009d63 |</span><br><span class="line">+------------------------------------+------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<p>在apis_ server <em>manager.py的 __name</em>_ == ‘<strong>main</strong>‘代码段最后添加如下代码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server_m = server_manager(headers, f&quot;http://&#123;controller_ip&#125;:8774/v2.1/servers&quot;)  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1 查所有</span>  </span><br><span class="line">servers = server_m.get_servers()  </span><br><span class="line">print(&quot;查询所有servers:&quot;, servers)  </span><br><span class="line">print(&quot;-----------finished----------&quot;)  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2 创建</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过apis或openstack命令查询网络net1 ID、镜像 cirros ID、主机类型ID m1.tiny 1</span>  </span><br><span class="line">imageRef = &quot;8372926e-517a-4c69-8d24-01e972bbe4a2&quot;  </span><br><span class="line">flavorRef = &quot;1&quot;  </span><br><span class="line">networks_id = &quot;4bd2cb47-d3c4-48ed-afd9-4e4488677c5c&quot;  </span><br><span class="line">networks_name = &quot;net1&quot;  </span><br><span class="line">result = server_m.create_server(&quot;server_001&quot;,imageRef, flavorRef,networks_id)  </span><br><span class="line">print(f&quot;创建 云主机:&quot;, result)  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2 查询<span class="built_in">id</span></span>  </span><br><span class="line">id = server_m.get_server_id(server_name=&quot;server_001&quot;)  </span><br><span class="line">print(&quot;server_001，id为: &quot;, id)  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3 查一个云主机</span>  </span><br><span class="line">result = server_m.get_server(id)  </span><br><span class="line">print(f&quot;查询&#123;id&#125;云主机:&quot;, result)  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">delete a 云主机</span>  </span><br><span class="line">result = server_m.delete_server(id)  </span><br><span class="line">print(f&quot;删除&#123;id&#125;镜像:&quot;, result)  </span><br></pre></td></tr></table></figure>

<p>然后执行apis_server_manager.py，结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# python3 apis_server_manager.py  </span><br><span class="line">&#123;&#x27;auth&#x27;: &#123;&#x27;identity&#x27;: &#123;&#x27;methods&#x27;: [&#x27;password&#x27;], &#x27;password&#x27;: &#123;&#x27;user&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;password&#x27;: &#x27;000000&#x27;&#125;&#125;&#125;, &#x27;scope&#x27;: &#123;&#x27;project&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;&#125;&#125;&#125;&#125;  </span><br><span class="line">2022-03-10 13:22:41,080 获取Token值：gAAAAABiKYmdnf1LDjTT0KSaK55jvsrnLWvwHEEXsIIppNx_WcVKliwp-xHnryAgPXBs-tg0fQSs8bwWG9GwFHbZxWqRrseRJUsAlmqbplkExmwOYFdJqnV-yMQp5tStc4fFnctB2jgF-lZS03V9l_0Uza84tFsH-JVhoiy6Hw5xCzm3sUHsNLM  </span><br><span class="line">headers: &#123;&#x27;X-Auth-Token&#x27;: &#x27;gAAAAABiKYmdnf1LDjTT0KSaK55jvsrnLWvwHEEXsIIppNx_WcVKliwp-xHnryAgPXBs-tg0fQSs8bwWG9GwFHbZxWqRrseRJUsAlmqbplkExmwOYFdJqnV-yMQp5tStc4fFnctB2jgF-lZS03V9l_0Uza84tFsH-JVhoiy6Hw5xCzm3sUHsNLM&#x27;&#125;  </span><br><span class="line">查询所有servers: &#123;&quot;servers&quot;: [&#123;&quot;id&quot;: &quot;57b04243-d8fc-4f53-a6ae-3a7271bb920a&quot;, &quot;links&quot;: [&#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/v2.1/servers/57b04243-d8fc-4f53-a6ae-3a7271bb920a&quot;, &quot;rel&quot;: &quot;self&quot;&#125;, &#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/servers/57b04243-d8fc-4f53-a6ae-3a7271bb920a&quot;, &quot;rel&quot;: &quot;bookmark&quot;&#125;], &quot;name&quot;: &quot;test&quot;&#125;]&#125;  </span><br><span class="line">-----------finished----------  </span><br><span class="line">2022-03-10 13:22:41,827 返回状态:&#123;&quot;servers&quot;: [&#123;&quot;id&quot;: &quot;57b04243-d8fc-4f53-a6ae-3a7271bb920a&quot;, &quot;links&quot;: [&#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/v2.1/servers/57b04243-d8fc-4f53-a6ae-3a7271bb920a&quot;, &quot;rel&quot;: &quot;self&quot;&#125;, &#123;&quot;href&quot;: &quot;http://172.128.11.18:8774/servers/57b04243-d8fc-4f53-a6ae-3a7271bb920a&quot;, &quot;rel&quot;: &quot;bookmark&quot;&#125;], &quot;name&quot;: &quot;test&quot;&#125;]&#125;  </span><br><span class="line">2022-03-10 13:22:49,752 202  </span><br><span class="line">创建 云主机: &#123;&#x27;serverItemCreatedSuccess&#x27;: 202&#125;  </span><br><span class="line">server_001，id为:  3c636f98-91ab-4b44-8de8-21ff04e56875  </span><br><span class="line">2022-03-10 13:22:50,895 &#123;&#x27;servers&#x27;: [&#123;&#x27;id&#x27;: &#x27;3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/servers/3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/servers/3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;server_001&#x27;&#125;, &#123;&#x27;id&#x27;: &#x27;57b04243-d8fc-4f53-a6ae-3a7271bb920a&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/servers/57b04243-d8fc-4f53-a6ae-3a7271bb920a&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/servers/57b04243-d8fc-4f53-a6ae-3a7271bb920a&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;name&#x27;: &#x27;test&#x27;&#125;]&#125;  </span><br><span class="line">2022-03-10 13:22:52,828 返回信息:&#123;&#x27;server&#x27;: &#123;&#x27;OS-EXT-STS:task_state&#x27;: &#x27;scheduling&#x27;, &#x27;addresses&#x27;: &#123;&#125;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/servers/3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/servers/3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;image&#x27;: &#123;&#x27;id&#x27;: &#x27;d50222d2-f737-4b47-ba7c-38eaa2418ff0&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;]&#125;, &#x27;OS-EXT-STS:vm_state&#x27;: &#x27;building&#x27;, &#x27;OS-EXT-SRV-ATTR:instance_name&#x27;: &#x27;&#x27;, &#x27;OS-SRV-USG:launched_at&#x27;: None, &#x27;flavor&#x27;: &#123;&#x27;id&#x27;: &#x27;1&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/1&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;]&#125;, &#x27;id&#x27;: &#x27;3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;user_id&#x27;: &#x27;89f8027475294689ae6c0183fa35bf5a&#x27;, &#x27;OS-DCF:diskConfig&#x27;: &#x27;MANUAL&#x27;, &#x27;accessIPv4&#x27;: &#x27;&#x27;, &#x27;accessIPv6&#x27;: &#x27;&#x27;, &#x27;progress&#x27;: 0, &#x27;OS-EXT-STS:power_state&#x27;: 0, &#x27;OS-EXT-AZ:availability_zone&#x27;: &#x27;&#x27;, &#x27;config_drive&#x27;: &#x27;&#x27;, &#x27;status&#x27;: &#x27;BUILD&#x27;, &#x27;updated&#x27;: &#x27;2022-03-10T05:16:23Z&#x27;, &#x27;hostId&#x27;: &#x27;&#x27;, &#x27;OS-EXT-SRV-ATTR:host&#x27;: None, &#x27;OS-SRV-USG:terminated_at&#x27;: None, &#x27;key_name&#x27;: None, &#x27;OS-EXT-SRV-ATTR:hypervisor_hostname&#x27;: None, &#x27;name&#x27;: &#x27;server_001&#x27;, &#x27;created&#x27;: &#x27;2022-03-10T05:16:22Z&#x27;, &#x27;tenant_id&#x27;: &#x27;0b6f2d0be1d342e09edc31dc841db7a5&#x27;, &#x27;os-extended-volumes:volumes_attached&#x27;: [], &#x27;metadata&#x27;: &#123;&#125;&#125;&#125;  </span><br><span class="line">查询3c636f98-91ab-4b44-8de8-21ff04e56875云主机: &#123;&#x27;server&#x27;: &#123;&#x27;OS-EXT-STS:task_state&#x27;: &#x27;scheduling&#x27;, &#x27;addresses&#x27;: &#123;&#125;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/v2.1/servers/3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;rel&#x27;: &#x27;self&#x27;&#125;, &#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/servers/3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;], &#x27;image&#x27;: &#123;&#x27;id&#x27;: &#x27;d50222d2-f737-4b47-ba7c-38eaa2418ff0&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;]&#125;, &#x27;OS-EXT-STS:vm_state&#x27;: &#x27;building&#x27;, &#x27;OS-EXT-SRV-ATTR:instance_name&#x27;: &#x27;&#x27;, &#x27;OS-SRV-USG:launched_at&#x27;: None, &#x27;flavor&#x27;: &#123;&#x27;id&#x27;: &#x27;1&#x27;, &#x27;links&#x27;: [&#123;&#x27;href&#x27;: &#x27;http://172.128.11.18:8774/flavors/1&#x27;, &#x27;rel&#x27;: &#x27;bookmark&#x27;&#125;]&#125;, &#x27;id&#x27;: &#x27;3c636f98-91ab-4b44-8de8-21ff04e56875&#x27;, &#x27;user_id&#x27;: &#x27;89f8027475294689ae6c0183fa35bf5a&#x27;, &#x27;OS-DCF:diskConfig&#x27;: &#x27;MANUAL&#x27;, &#x27;accessIPv4&#x27;: &#x27;&#x27;, &#x27;accessIPv6&#x27;: &#x27;&#x27;, &#x27;progress&#x27;: 0, &#x27;OS-EXT-STS:power_state&#x27;: 0, &#x27;OS-EXT-AZ:availability_zone&#x27;: &#x27;&#x27;, &#x27;config_drive&#x27;: &#x27;&#x27;, &#x27;status&#x27;: &#x27;BUILD&#x27;, &#x27;updated&#x27;: &#x27;2022-03-10T05:16:23Z&#x27;, &#x27;hostId&#x27;: &#x27;&#x27;, &#x27;OS-EXT-SRV-ATTR:host&#x27;: None, &#x27;OS-SRV-USG:terminated_at&#x27;: None, &#x27;key_name&#x27;: None, &#x27;OS-EXT-SRV-ATTR:hypervisor_hostname&#x27;: None, &#x27;name&#x27;: &#x27;server_001&#x27;, &#x27;created&#x27;: &#x27;2022-03-10T05:16:22Z&#x27;, &#x27;tenant_id&#x27;: &#x27;0b6f2d0be1d342e09edc31dc841db7a5&#x27;, &#x27;os-extended-volumes:volumes_attached&#x27;: [], &#x27;metadata&#x27;: &#123;&#125;&#125;&#125;  </span><br><span class="line">Process finished with exit code 0  </span><br></pre></td></tr></table></figure>

<h3 id="镜像管理代码"><a href="#镜像管理代码" class="headerlink" title="镜像管理代码"></a>镜像管理代码</h3><h4 id="接口说明-3"><a href="#接口说明-3" class="headerlink" title="接口说明"></a>接口说明</h4><p>镜像(glance)服务的API官网：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/image/v2/index.html">https://docs.openstack.org/api-ref/image/v2/index.html</a><br>Glance项目提供了RESTful HTTP服务：OpenStack Image Serivce API。<br>以下以镜像（images）管理为案例，实现Python代码。具体APIs接口清单如图5所示，涉及查询（Get）、创建（POST）、更新（PUT）与删除（DELETE）。</p>
<p><img src="../../../../images/image/DX/77.png" alt="77"></p>
<p>图5<br>具体参看：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/api-ref/compute/?expanded=list-images-detail">https://docs.openstack.org/api-ref/compute/?expanded=list-images-detail</a><br>创建镜像接口说明：POST /v2/images<br>创建镜像调用正常响应码为201，错误响应码为400，401，403，409，413， 415。<br>请求（Request）说明见表7：<br>表7 请求（Request）说明</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>位置</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>container_format (Optional)</td>
<td>body</td>
<td>enum</td>
<td>容器格式，如：ami，ari，aki，bare，ovf，ova，或docker。</td>
</tr>
<tr>
<td>disk_format (Optional)</td>
<td>body</td>
<td>enum</td>
<td>磁盘格式，如：ami，ari，aki，vhd，vhdx，vmdk，raw，qcow2，vdi，ploop或iso。</td>
</tr>
<tr>
<td>id (Optional)</td>
<td>body</td>
<td>string</td>
<td>镜像ID（UUID格式）。</td>
</tr>
<tr>
<td>min_disk (Optional)</td>
<td>body</td>
<td>integer</td>
<td>最小磁盘大小（GB单位）。</td>
</tr>
<tr>
<td>min_ram (Optional)</td>
<td>body</td>
<td>integer</td>
<td>最小内存大小（MB单位）。</td>
</tr>
<tr>
<td>name (Optional)</td>
<td>body</td>
<td>string</td>
<td>名称。</td>
</tr>
<tr>
<td>protected (Optional)</td>
<td>body</td>
<td>boolean</td>
<td>是否包含不被删除。</td>
</tr>
<tr>
<td>tags (Optional)</td>
<td>body</td>
<td>array</td>
<td>标签</td>
</tr>
<tr>
<td>visibility (Optional)</td>
<td>body</td>
<td>string</td>
<td>开放性（公开、私有、共享）。</td>
</tr>
</tbody></table>
<p>请求案例代码如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    &quot;container_format&quot;: &quot;bare&quot;,  </span><br><span class="line">    &quot;disk_format&quot;: &quot;raw&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;Ubuntu&quot;,  </span><br><span class="line">    &quot;id&quot;: &quot;b2173dd3-7ad6-4362-baa6-a68bce3565cb&quot;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>响应信息见表8：<br>表8 响应信息</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>位置</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Location</td>
<td>header</td>
<td>string</td>
<td>镜像文件URL路径</td>
</tr>
<tr>
<td>OpenStack-image-import-methods (Optional)</td>
<td>header</td>
<td>string</td>
<td>Import方法（自v2.6增加）。</td>
</tr>
<tr>
<td>OpenStack-image-store-ids (Optional)</td>
<td>header</td>
<td>string</td>
<td>后端存储ID。</td>
</tr>
<tr>
<td>checksum</td>
<td>body</td>
<td>string</td>
<td>检验Hash码。</td>
</tr>
<tr>
<td>container_format</td>
<td>body</td>
<td>enum</td>
<td>容器格式。</td>
</tr>
<tr>
<td>created_at</td>
<td>body</td>
<td>string</td>
<td>创建时间。</td>
</tr>
<tr>
<td>disk_format</td>
<td>body</td>
<td>enum</td>
<td>磁盘格式。</td>
</tr>
<tr>
<td>file</td>
<td>body</td>
<td>string</td>
<td>虚拟机镜像文件URL地址。</td>
</tr>
<tr>
<td>id</td>
<td>body</td>
<td>string</td>
<td>镜像ID（UUID格式）。</td>
</tr>
<tr>
<td>min_disk</td>
<td>body</td>
<td>integer</td>
<td>最小磁盘大小（GB单位）。</td>
</tr>
<tr>
<td>min_ram</td>
<td>body</td>
<td>integer</td>
<td>最小内存大小（MB单位）。</td>
</tr>
<tr>
<td>name</td>
<td>body</td>
<td>string</td>
<td>名称。</td>
</tr>
<tr>
<td>os_hash_algo</td>
<td>body</td>
<td>string</td>
<td>计算图像数据的安全哈希值的算法（自v2.7增加）。</td>
</tr>
<tr>
<td>os_hash_value</td>
<td>body</td>
<td>string</td>
<td>计算的图像数据的安全哈希的hexdigest（自v2.7增加）。</td>
</tr>
<tr>
<td>os_hidden</td>
<td>body</td>
<td>boolean</td>
<td>是否隐藏（自v2.7增加）。</td>
</tr>
<tr>
<td>owner</td>
<td>body</td>
<td>string</td>
<td>所有者的标识符。</td>
</tr>
<tr>
<td>protected</td>
<td>body</td>
<td>boolean</td>
<td>是否保护。</td>
</tr>
<tr>
<td>schema</td>
<td>body</td>
<td>string</td>
<td>描述虚拟机映像的schema URL。</td>
</tr>
<tr>
<td>self</td>
<td>body</td>
<td>string</td>
<td>虚拟机镜像的URL。</td>
</tr>
<tr>
<td>size</td>
<td>body</td>
<td>integer</td>
<td>镜像数据大学（bytes）。</td>
</tr>
<tr>
<td>status</td>
<td>body</td>
<td>string</td>
<td>状态</td>
</tr>
<tr>
<td>tags</td>
<td>body</td>
<td>array</td>
<td>标签</td>
</tr>
<tr>
<td>updated_at</td>
<td>body</td>
<td>string</td>
<td>更新日期。</td>
</tr>
<tr>
<td>virtual_size</td>
<td>body</td>
<td>integer</td>
<td>虚拟大小</td>
</tr>
<tr>
<td>visibility</td>
<td>body</td>
<td>string</td>
<td>开放性（公开、私有、共享）。</td>
</tr>
<tr>
<td>direct_url (Optional)</td>
<td>body</td>
<td>string</td>
<td>访问保存在外部存储中的映像文件URL。</td>
</tr>
<tr>
<td>locations (Optional)</td>
<td>body</td>
<td>array</td>
<td>地址。</td>
</tr>
</tbody></table>
<p>响应（Response）案例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    &quot;status&quot;: &quot;queued&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;Ubuntu&quot;,  </span><br><span class="line">    &quot;tags&quot;: [],  </span><br><span class="line">    &quot;container_format&quot;: &quot;bare&quot;,  </span><br><span class="line">    &quot;created_at&quot;: &quot;2015-11-29T22:21:42Z&quot;,  </span><br><span class="line">    &quot;size&quot;: null,  </span><br><span class="line">    &quot;disk_format&quot;: &quot;raw&quot;,  </span><br><span class="line">    &quot;updated_at&quot;: &quot;2015-11-29T22:21:42Z&quot;,  </span><br><span class="line">    &quot;visibility&quot;: &quot;private&quot;,  </span><br><span class="line">    &quot;locations&quot;: [],  </span><br><span class="line">    &quot;self&quot;: &quot;/v2/images/b2173dd3-7ad6-4362-baa6-a68bce3565cb&quot;,  </span><br><span class="line">    &quot;min_disk&quot;: 0,  </span><br><span class="line">    &quot;protected&quot;: false,  </span><br><span class="line">    &quot;id&quot;: &quot;b2173dd3-7ad6-4362-baa6-a68bce3565cb&quot;,  </span><br><span class="line">    &quot;file&quot;: &quot;/v2/images/b2173dd3-7ad6-4362-baa6-a68bce3565cb/file&quot;,  </span><br><span class="line">    &quot;checksum&quot;: null,  </span><br><span class="line">    &quot;os_hash_algo&quot;: null,  </span><br><span class="line">    &quot;os_hash_value&quot;: null,  </span><br><span class="line">    &quot;os_hidden&quot;: false,  </span><br><span class="line">    &quot;owner&quot;: &quot;bab7d5c60cd041a0a36f7c4b6e1dd978&quot;,  </span><br><span class="line">    &quot;virtual_size&quot;: null,  </span><br><span class="line">    &quot;min_ram&quot;: 0,  </span><br><span class="line">    &quot;schema&quot;: &quot;/v2/schemas/image&quot;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>其他接口的参数创建相似，可以查看具体APIs说明</p>
<h4 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h4><p>创建apis_image_manager.py文件实现，主机类型创建、查找、删除、更新。代码如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright 2021~2022 The Cloud Computing support Teams of ChinaSkills.</span>  </span><br><span class="line">import requests, json, time  </span><br><span class="line">import logging  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-----------logger-----------</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get logger</span>  </span><br><span class="line">logger = logging.getLogger(__name__)  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">level</span>  </span><br><span class="line">logger.setLevel(logging.DEBUG)  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">format</span>  </span><br><span class="line">format = logging.Formatter(&#x27;%(asctime)s %(message)s&#x27;)  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to console</span>  </span><br><span class="line">stream_handler = logging.StreamHandler()  </span><br><span class="line">stream_handler.setFormatter(format)  </span><br><span class="line">logger.addHandler(stream_handler)  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-----------logger-----------</span>  </span><br><span class="line">def get_auth_token(controller_ip, domain, user, password):  </span><br><span class="line">    &#x27;&#x27;&#x27;  </span><br><span class="line">    :param controller_ip: openstack master ip address  </span><br><span class="line">    :param domain: current user&#x27;s domain  </span><br><span class="line">    :param user: user name  </span><br><span class="line">    :param password: user password  </span><br><span class="line">    :return: keystoen auth Token for current user.  </span><br><span class="line">    &#x27;&#x27;&#x27;  </span><br><span class="line">    try:  </span><br><span class="line">        url = f&quot;http://&#123;controller_ip&#125;:5000/v3/auth/tokens&quot;  </span><br><span class="line">        body = &#123;  </span><br><span class="line">            &quot;auth&quot;: &#123;  </span><br><span class="line">                &quot;identity&quot;: &#123;  </span><br><span class="line">                    &quot;methods&quot;: [  </span><br><span class="line">                        &quot;password&quot;  </span><br><span class="line">                    ],  </span><br><span class="line">                    &quot;password&quot;: &#123;  </span><br><span class="line">                        &quot;user&quot;: &#123;  </span><br><span class="line">                            &quot;domain&quot;: &#123;  </span><br><span class="line">                                &quot;name&quot;: domain  </span><br><span class="line">                            &#125;,  </span><br><span class="line">                            &quot;name&quot;: user,  </span><br><span class="line">                            &quot;password&quot;: password  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;,  </span><br><span class="line">                &quot;scope&quot;: &#123;  </span><br><span class="line">                    &quot;project&quot;: &#123;  </span><br><span class="line">                        &quot;domain&quot;: &#123;  </span><br><span class="line">                            &quot;name&quot;: domain  </span><br><span class="line">                        &#125;,  </span><br><span class="line">                        &quot;name&quot;: user  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        headers = &#123;  </span><br><span class="line">            &quot;Content-Type&quot;: &quot;application/json&quot;,  </span><br><span class="line">        &#125;  </span><br><span class="line">        print(body)  </span><br><span class="line">        Token = requests.post(url, data=json.dumps(body), headers=headers).headers[&#x27;X-Subject-Token&#x27;]  </span><br><span class="line">        headers = &#123;  </span><br><span class="line">            &quot;X-Auth-Token&quot;: Token  </span><br><span class="line">        &#125;  </span><br><span class="line">        logger.debug(f&quot;获取Token值：&#123;str(Token)&#125;&quot;)  </span><br><span class="line">        return headers  </span><br><span class="line">    except Exception as e:  </span><br><span class="line">        logger.error(f&quot;获取Token值失败，请检查访问云主机控制节点IP是否正确？输出错误信息如下：&#123;str(e)&#125;&quot;)  </span><br><span class="line">        exit(0)  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">镜像管理</span>  </span><br><span class="line">class image_manager:  </span><br><span class="line">    def __init__(self, handers: dict, resUrl: str):  </span><br><span class="line">        self.headers = handers  </span><br><span class="line">        self.resUrl = resUrl  </span><br><span class="line">    #POST  v2/images  </span><br><span class="line">    def create_image(self, image_name: str, container_format=&quot;bare&quot;, disk_format=&quot;qcow2&quot;):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        :param image_name:  </span><br><span class="line">        :param container_format:  </span><br><span class="line">        :param disk_format:  </span><br><span class="line">        :return:  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        body = &#123;  </span><br><span class="line">            &quot;container_format&quot;: container_format,  </span><br><span class="line">            &quot;disk_format&quot;: disk_format,  </span><br><span class="line">            &quot;name&quot;: image_name  </span><br><span class="line">        &#125;  </span><br><span class="line">        response = requests.post(self.resUrl, data=json.dumps(body), headers=self.headers)  </span><br><span class="line">        logger.debug(response.status_code)  </span><br><span class="line">        if response.status_code == 201:  </span><br><span class="line">            return &#123;&quot;ImageItemCreatedSuccess&quot;: response.status_code&#125;  </span><br><span class="line">        return response.text  </span><br><span class="line">    # 获取glance镜像id  </span><br><span class="line">    def get_image_id(self, image_name: str):  </span><br><span class="line">        result = json.loads(requests.get(self.resUrl, headers=self.headers).text)  </span><br><span class="line">        logger.debug(result)  </span><br><span class="line">        for item in result[&#x27;images&#x27;]:  </span><br><span class="line">            if (item[&#x27;name&#x27;] == image_name):  </span><br><span class="line">                return item[&#x27;id&#x27;]  </span><br><span class="line">    # 上传glance镜像  </span><br><span class="line">    # Image data¶ Uploads and downloads raw image data.  </span><br><span class="line">    # These operations may be restricted to administrators. Consult your cloud operator’s documentation for details.  </span><br><span class="line">    # /v2/images/&#123;image_id&#125;/file  </span><br><span class="line">    # 镜像可以重名  </span><br><span class="line">    def upload_iamge_data(self, image_id: str, file_path=&quot;&quot;):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        :param image_id:  </span><br><span class="line">        :param file_path:  </span><br><span class="line">        :return:  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        self.resUrl = self.resUrl + &quot;/&quot; + image_id + &quot;/file&quot;  </span><br><span class="line">        self.headers[&#x27;Content-Type&#x27;] = &quot;application/octet-stream&quot;  </span><br><span class="line">        response = requests.put(self.resUrl, data=open(file_path, &#x27;rb&#x27;).read(), headers=self.headers)  </span><br><span class="line">        logger.debug(response.status_code)  </span><br><span class="line">        if response.status_code == 204:  </span><br><span class="line">            return &#123;&quot;ImageItemCreatedSuccess&quot;: response.status_code&#125;  </span><br><span class="line">        return response.text  </span><br><span class="line">    # ----------------------------  </span><br><span class="line">    # /v2/images  </span><br><span class="line">    # List images  </span><br><span class="line">    def get_images(self):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        :return:  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        status_code = requests.get(self.resUrl, headers=self.headers).text  </span><br><span class="line">        logger.debug(f&quot;返回状态:&#123;str(status_code)&#125;&quot;)  </span><br><span class="line">        return status_code  </span><br><span class="line">    # /v2/images/&#123;image_id&#125; Show image  </span><br><span class="line">    def get_image(self, id: str):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        get a flavor by id.  </span><br><span class="line">        :return:  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        api_url = self.resUrl + &quot;/&quot; + id  </span><br><span class="line">        response = requests.get(api_url, headers=self.headers)  </span><br><span class="line">        result = json.loads(response.text)  </span><br><span class="line">        logger.debug(f&quot;返回信息:&#123;str(result)&#125;&quot;)  </span><br><span class="line">        return result  </span><br><span class="line">    # /v2/images/&#123;image_id&#125; Delete image  </span><br><span class="line">    def delete_image(self, id: str):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">         delete a image by id.  </span><br><span class="line">         :return:  </span><br><span class="line">         &quot;&quot;&quot;  </span><br><span class="line">        api_url = self.resUrl + &quot;/&quot; + id  </span><br><span class="line">        response = requests.delete(api_url, headers=self.headers)  </span><br><span class="line">        # 204 - No ContentThe server has fulfilled the request.  </span><br><span class="line">        if response.status_code == 204:  </span><br><span class="line">            return &#123;&quot;Image itemDeletedSuccess&quot;: response.status_code&#125;  </span><br><span class="line">        result = json.loads(response.text)  </span><br><span class="line">        logger.debug(f&quot;返回信息:&#123;str(result)&#125;&quot;)  </span><br><span class="line">        return result  </span><br><span class="line">        # http://192.168.200.226:8774/v2.1/ get apis version infomation.  </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:  </span><br><span class="line">    # openstack allinone （controller ) credentials  </span><br><span class="line">    # host ip address  </span><br><span class="line">    controller_ip = &quot;192.168.200.226&quot;  </span><br><span class="line">    # domain name  </span><br><span class="line">    domain = &quot;demo&quot;  </span><br><span class="line">    # user name  </span><br><span class="line">    user = &quot;admin&quot;  </span><br><span class="line">    # user password  </span><br><span class="line">    password = &quot;000000&quot;  </span><br><span class="line">    headers = get_auth_token(controller_ip, domain, user, password)  </span><br><span class="line">    print(&quot;headers:&quot;, headers)  </span><br></pre></td></tr></table></figure>

<h4 id="代码验证-3"><a href="#代码验证-3" class="headerlink" title="代码验证"></a>代码验证</h4><p>① 登录通过账号密码方式：使用get_auth_token()方法，通过该方法获取Token值。<br>② 封装了image_manager类，通过python request库实现对API的网络访问，实现对用户的增删查改操作。</p>
<ul>
<li>创建：post v2/images</li>
<li>查询：get v2/images</li>
<li>删除：delete v2/images/id</li>
<li>更改密码：put v2/images/id</li>
</ul>
<p>具体可以通过官网的API说明。<br>执行image_manager的每个方法进行代码测试，通过openstack image命令行或Dashboard界面进行研究者。<br>修改apis_image_manager.py的if <strong>name</strong> == ‘__main__’:函数中OpenStack的IP、domain、user、password，执行apis_image_manager.py，进行查询所有、创建、根据ID查询、更新描述。在apis_image_manager.py的 <strong>name</strong> == ‘<strong>main</strong>‘代码段最后添加如下代码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> http://controller:9292</span>  </span><br><span class="line">    image_m = image_manager(headers, f&quot;http://&#123;controller_ip&#125;:9292/v2/images&quot;)  </span><br><span class="line">    # 1 查所有  </span><br><span class="line">    images = image_m.get_images()  </span><br><span class="line">    print(&quot;查询所有images:&quot;, images)  </span><br><span class="line">    #2 创建镜像（注意，镜像允许同名）  </span><br><span class="line">    result = image_m.create_image(image_name=&quot;cirros002&quot;)  # 调用glance-api中创建镜像方法  </span><br><span class="line">    print(f&quot;创建cirros002 镜像:&quot;, result)  </span><br><span class="line">    #    #1.1查询id  </span><br><span class="line">    id = image_m.get_image_id(image_name=&quot;cirros002&quot;)  </span><br><span class="line">    print(&quot;cirros002镜像的，id为: &quot;, id)  </span><br><span class="line">    # 1.2 上传镜像文件  </span><br><span class="line">    result = image_m.upload_iamge_data(id, file_path=&quot;cirros-0.3.4-x86_64-disk.img&quot;)  </span><br><span class="line">    print(f&quot;上传&#123;id&#125;镜像:&quot;, result)  </span><br></pre></td></tr></table></figure>

<p>然后执行apis_image_manager.py，结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# python3 apis_image_manager.py  </span><br><span class="line">&#123;&#x27;auth&#x27;: &#123;&#x27;identity&#x27;: &#123;&#x27;methods&#x27;: [&#x27;password&#x27;], &#x27;password&#x27;: &#123;&#x27;user&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;password&#x27;: &#x27;000000&#x27;&#125;&#125;&#125;, &#x27;scope&#x27;: &#123;&#x27;project&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;&#125;&#125;&#125;&#125;  </span><br><span class="line">headers: &#123;&#x27;X-Auth-Token&#x27;: &#x27;gAAAAABiKYbUS0SDwZzUhzjEuBFQmqWjRxrtCqcdmEpPvEt29dbwRWfjj_GLaLhqiErU0qsfNQN5leEMS788SshaSGFXKwScCAumH22lB2INMbVm9hV4Gn2OnZjkvM0PsJ-DVoIK136QIS6FwZPVI93Xqujawpkw5762db9nI9Gmd3wOxZWDBqs&#x27;&#125;  </span><br><span class="line">2022-03-10 13:10:48,187 获取Token值：gAAAAABiKYbUS0SDwZzUhzjEuBFQmqWjRxrtCqcdmEpPvEt29dbwRWfjj_GLaLhqiErU0qsfNQN5leEMS788SshaSGFXKwScCAumH22lB2INMbVm9hV4Gn2OnZjkvM0PsJ-DVoIK136QIS6FwZPVI93Xqujawpkw5762db9nI9Gmd3wOxZWDBqs  </span><br><span class="line">2022-03-10 13:10:48,803 返回状态:&#123;&quot;images&quot;: [&#123;&quot;container_format&quot;: &quot;bare&quot;, &quot;min_ram&quot;: 0, &quot;updated_at&quot;: &quot;2022-03-10T00:56:57Z&quot;, &quot;file&quot;: &quot;/v2/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0/file&quot;, &quot;owner&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;, &quot;id&quot;: &quot;d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;, &quot;size&quot;: 13287936, &quot;self&quot;: &quot;/v2/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;, &quot;disk_format&quot;: &quot;qcow2&quot;, &quot;os_hash_algo&quot;: &quot;sha512&quot;, &quot;schema&quot;: &quot;/v2/schemas/image&quot;, &quot;status&quot;: &quot;active&quot;, &quot;tags&quot;: [], &quot;visibility&quot;: &quot;shared&quot;, &quot;min_disk&quot;: 0, &quot;virtual_size&quot;: null, &quot;name&quot;: &quot;cirros&quot;, &quot;checksum&quot;: &quot;ee1eca47dc88f4879d8a229cc70a07c6&quot;, &quot;created_at&quot;: &quot;2022-03-10T00:56:56Z&quot;, &quot;os_hidden&quot;: false, &quot;protected&quot;: false, &quot;os_hash_value&quot;: &quot;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&quot;&#125;], &quot;schema&quot;: &quot;/v2/schemas/images&quot;, &quot;first&quot;: &quot;/v2/images&quot;&#125;  </span><br><span class="line">查询所有images: &#123;&quot;images&quot;: [&#123;&quot;container_format&quot;: &quot;bare&quot;, &quot;min_ram&quot;: 0, &quot;updated_at&quot;: &quot;2022-03-10T00:56:57Z&quot;, &quot;file&quot;: &quot;/v2/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0/file&quot;, &quot;owner&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;, &quot;id&quot;: &quot;d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;, &quot;size&quot;: 13287936, &quot;self&quot;: &quot;/v2/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;, &quot;disk_format&quot;: &quot;qcow2&quot;, &quot;os_hash_algo&quot;: &quot;sha512&quot;, &quot;schema&quot;: &quot;/v2/schemas/image&quot;, &quot;status&quot;: &quot;active&quot;, &quot;tags&quot;: [], &quot;visibility&quot;: &quot;shared&quot;, &quot;min_disk&quot;: 0, &quot;virtual_size&quot;: null, &quot;name&quot;: &quot;cirros&quot;, &quot;checksum&quot;: &quot;ee1eca47dc88f4879d8a229cc70a07c6&quot;, &quot;created_at&quot;: &quot;2022-03-10T00:56:56Z&quot;, &quot;os_hidden&quot;: false, &quot;protected&quot;: false, &quot;os_hash_value&quot;: &quot;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&quot;&#125;], &quot;schema&quot;: &quot;/v2/schemas/images&quot;, &quot;first&quot;: &quot;/v2/images&quot;&#125;  </span><br><span class="line">创建cirros002 镜像: &#123;&#x27;ImageItemCreatedSuccess&#x27;: 201&#125;  </span><br><span class="line">2022-03-10 13:10:49,569 201  </span><br><span class="line">2022-03-10 13:10:50,145 &#123;&#x27;images&#x27;: [&#123;&#x27;container_format&#x27;: &#x27;bare&#x27;, &#x27;min_ram&#x27;: 0, &#x27;updated_at&#x27;: &#x27;2022-03-10T05:04:21Z&#x27;, &#x27;file&#x27;: &#x27;/v2/images/038ba49b-ddee-4e0f-8ecb-6f64d2788138/file&#x27;, &#x27;owner&#x27;: &#x27;0b6f2d0be1d342e09edc31dc841db7a5&#x27;, &#x27;id&#x27;: &#x27;038ba49b-ddee-4e0f-8ecb-6f64d2788138&#x27;, &#x27;size&#x27;: None, &#x27;self&#x27;: &#x27;/v2/images/038ba49b-ddee-4e0f-8ecb-6f64d2788138&#x27;, &#x27;disk_format&#x27;: &#x27;qcow2&#x27;, &#x27;os_hash_algo&#x27;: None, &#x27;schema&#x27;: &#x27;/v2/schemas/image&#x27;, &#x27;status&#x27;: &#x27;queued&#x27;, &#x27;tags&#x27;: [], &#x27;visibility&#x27;: &#x27;shared&#x27;, &#x27;min_disk&#x27;: 0, &#x27;virtual_size&#x27;: None, &#x27;name&#x27;: &#x27;cirros002&#x27;, &#x27;checksum&#x27;: None, &#x27;created_at&#x27;: &#x27;2022-03-10T05:04:21Z&#x27;, &#x27;os_hidden&#x27;: False, &#x27;protected&#x27;: False, &#x27;os_hash_value&#x27;: None&#125;, &#123;&#x27;container_format&#x27;: &#x27;bare&#x27;, &#x27;min_ram&#x27;: 0, &#x27;updated_at&#x27;: &#x27;2022-03-10T00:56:57Z&#x27;, &#x27;file&#x27;: &#x27;/v2/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0/file&#x27;, &#x27;owner&#x27;: &#x27;0b6f2d0be1d342e09edc31dc841db7a5&#x27;, &#x27;id&#x27;: &#x27;d50222d2-f737-4b47-ba7c-38eaa2418ff0&#x27;, &#x27;size&#x27;: 13287936, &#x27;self&#x27;: &#x27;/v2/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&#x27;, &#x27;disk_format&#x27;: &#x27;qcow2&#x27;, &#x27;os_hash_algo&#x27;: &#x27;sha512&#x27;, &#x27;schema&#x27;: &#x27;/v2/schemas/image&#x27;, &#x27;status&#x27;: &#x27;active&#x27;, &#x27;tags&#x27;: [], &#x27;visibility&#x27;: &#x27;shared&#x27;, &#x27;min_disk&#x27;: 0, &#x27;virtual_size&#x27;: None, &#x27;name&#x27;: &#x27;cirros&#x27;, &#x27;checksum&#x27;: &#x27;ee1eca47dc88f4879d8a229cc70a07c6&#x27;, &#x27;created_at&#x27;: &#x27;2022-03-10T00:56:56Z&#x27;, &#x27;os_hidden&#x27;: False, &#x27;protected&#x27;: False, &#x27;os_hash_value&#x27;: &#x27;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&#x27;&#125;], &#x27;schema&#x27;: &#x27;/v2/schemas/images&#x27;, &#x27;first&#x27;: &#x27;/v2/images&#x27;&#125;  </span><br><span class="line">cirros002镜像的，id为:  038ba49b-ddee-4e0f-8ecb-6f64d2788138  </span><br><span class="line">上传038ba49b-ddee-4e0f-8ecb-6f64d2788138镜像: &#123;&#x27;ImageItemCreatedSuccess&#x27;: 204&#125;  </span><br></pre></td></tr></table></figure>

<p>镜像上传需要一定时间，上传后再查询与删除。替换上面输出的ID，最后再添加如下代码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id = &quot;038ba49b-ddee-4e0f-8ecb-6f64d2788138&quot;</span><br><span class="line">  result = image_m.get_image(id)</span><br><span class="line">  print(f&quot;查询&#123;id&#125;镜像:&quot;, result)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">4. delete a user</span></span><br><span class="line">  result = image_m.delete_image(id)</span><br><span class="line">  print(f&quot;删除&#123;id&#125;镜像:&quot;, result)</span><br></pre></td></tr></table></figure>

<p>删除或注释以下代码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1 查所有</span></span><br><span class="line">   images = image_m.get_images()</span><br><span class="line">   print(&quot;查询所有images:&quot;, images)</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">2 创建镜像（注意，镜像允许同名）</span></span><br><span class="line">   result = image_m.create_image(image_name=&quot;cirros002&quot;)  # 调用glance-api中创建镜像方法</span><br><span class="line">   print(f&quot;创建cirros002 镜像:&quot;, result)</span><br><span class="line"><span class="meta prompt_">   # </span><span class="language-bash">   <span class="comment">#1.1查询id</span></span></span><br><span class="line">   id = image_m.get_image_id(image_name=&quot;cirros002&quot;)</span><br><span class="line">   print(&quot;cirros002镜像的，id为: &quot;, id)</span><br><span class="line"><span class="meta prompt_">   # </span><span class="language-bash">1.2 上传镜像文件</span></span><br><span class="line">   result = image_m.upload_iamge_data(id, file_path=&quot;cirros-0.3.4-x86_64-disk.img&quot;)</span><br><span class="line">   print(f&quot;上传&#123;id&#125;镜像:&quot;, result)</span><br></pre></td></tr></table></figure>

<p>然后执行apis_image_manager.py，结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# python3 apis_image_manager.py</span><br><span class="line">&#123;&#x27;auth&#x27;: &#123;&#x27;identity&#x27;: &#123;&#x27;methods&#x27;: [&#x27;password&#x27;], &#x27;password&#x27;: &#123;&#x27;user&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;password&#x27;: &#x27;000000&#x27;&#125;&#125;&#125;, &#x27;scope&#x27;: &#123;&#x27;project&#x27;: &#123;&#x27;domain&#x27;: &#123;&#x27;name&#x27;: &#x27;demo&#x27;&#125;, &#x27;name&#x27;: &#x27;admin&#x27;&#125;&#125;&#125;&#125;  </span><br><span class="line">2022-03-10 13:14:29,986 获取Token值：gAAAAABiKYeyF3CRflZXsarjvfvtkGs86paQe4PeWG6n2I25gjIhyQ8rUdjmDZAWZme0V2meKwIA_-hEEfTObPpo-Zggq0nvIdyzhRau-6H0uhpZx1awr3O3HLsoj8QOtOS0NhIBFed-QAPpCw3uduh_HwSVJ-Se7axa1Mq26cAFyUSKVakxJsg  </span><br><span class="line">headers: &#123;&#x27;X-Auth-Token&#x27;: &#x27;gAAAAABiKYeyF3CRflZXsarjvfvtkGs86paQe4PeWG6n2I25gjIhyQ8rUdjmDZAWZme0V2meKwIA_-hEEfTObPpo-Zggq0nvIdyzhRau-6H0uhpZx1awr3O3HLsoj8QOtOS0NhIBFed-QAPpCw3uduh_HwSVJ-Se7axa1Mq26cAFyUSKVakxJsg&#x27;&#125;  </span><br><span class="line">2022-03-10 13:14:30,462 返回信息:&#123;&#x27;container_format&#x27;: &#x27;bare&#x27;, &#x27;min_ram&#x27;: 0, &#x27;updated_at&#x27;: &#x27;2022-03-10T05:04:25Z&#x27;, &#x27;file&#x27;: &#x27;/v2/images/038ba49b-ddee-4e0f-8ecb-6f64d2788138/file&#x27;, &#x27;owner&#x27;: &#x27;0b6f2d0be1d342e09edc31dc841db7a5&#x27;, &#x27;id&#x27;: &#x27;038ba49b-ddee-4e0f-8ecb-6f64d2788138&#x27;, &#x27;size&#x27;: 13287936, &#x27;self&#x27;: &#x27;/v2/images/038ba49b-ddee-4e0f-8ecb-6f64d2788138&#x27;, &#x27;disk_format&#x27;: &#x27;qcow2&#x27;, &#x27;os_hash_algo&#x27;: &#x27;sha512&#x27;, &#x27;schema&#x27;: &#x27;/v2/schemas/image&#x27;, &#x27;status&#x27;: &#x27;active&#x27;, &#x27;tags&#x27;: [], &#x27;visibility&#x27;: &#x27;shared&#x27;, &#x27;min_disk&#x27;: 0, &#x27;virtual_size&#x27;: None, &#x27;name&#x27;: &#x27;cirros002&#x27;, &#x27;checksum&#x27;: &#x27;ee1eca47dc88f4879d8a229cc70a07c6&#x27;, &#x27;created_at&#x27;: &#x27;2022-03-10T05:04:21Z&#x27;, &#x27;os_hidden&#x27;: False, &#x27;protected&#x27;: False, &#x27;os_hash_value&#x27;: &#x27;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&#x27;&#125;  </span><br><span class="line">查询038ba49b-ddee-4e0f-8ecb-6f64d2788138镜像: &#123;&#x27;container_format&#x27;: &#x27;bare&#x27;, &#x27;min_ram&#x27;: 0, &#x27;updated_at&#x27;: &#x27;2022-03-10T05:04:25Z&#x27;, &#x27;file&#x27;: &#x27;/v2/images/038ba49b-ddee-4e0f-8ecb-6f64d2788138/file&#x27;, &#x27;owner&#x27;: &#x27;0b6f2d0be1d342e09edc31dc841db7a5&#x27;, &#x27;id&#x27;: &#x27;038ba49b-ddee-4e0f-8ecb-6f64d2788138&#x27;, &#x27;size&#x27;: 13287936, &#x27;self&#x27;: &#x27;/v2/images/038ba49b-ddee-4e0f-8ecb-6f64d2788138&#x27;, &#x27;disk_format&#x27;: &#x27;qcow2&#x27;, &#x27;os_hash_algo&#x27;: &#x27;sha512&#x27;, &#x27;schema&#x27;: &#x27;/v2/schemas/image&#x27;, &#x27;status&#x27;: &#x27;active&#x27;, &#x27;tags&#x27;: [], &#x27;visibility&#x27;: &#x27;shared&#x27;, &#x27;min_disk&#x27;: 0, &#x27;virtual_size&#x27;: None, &#x27;name&#x27;: &#x27;cirros002&#x27;, &#x27;checksum&#x27;: &#x27;ee1eca47dc88f4879d8a229cc70a07c6&#x27;, &#x27;created_at&#x27;: &#x27;2022-03-10T05:04:21Z&#x27;, &#x27;os_hidden&#x27;: False, &#x27;protected&#x27;: False, &#x27;os_hash_value&#x27;: &#x27;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&#x27;&#125;  </span><br><span class="line">-----------finished----------  </span><br></pre></td></tr></table></figure>

<h1 id="案例三：通过OpenStack-SDK编写Python运维"><a href="#案例三：通过OpenStack-SDK编写Python运维" class="headerlink" title="案例三：通过OpenStack SDK编写Python运维"></a>案例三：通过OpenStack SDK编写Python运维</h1><h2 id="任务目标-2"><a href="#任务目标-2" class="headerlink" title="任务目标"></a>任务目标</h2><p>了解使用OpenStack Python SDK进行Python运维脚本开发 。<br>了解用户、镜像、实例类型等运维管理代码的编写案例。</p>
<h2 id="案例准备-2"><a href="#案例准备-2" class="headerlink" title="案例准备"></a>案例准备</h2><p>沿用案例一的all-in-one云主机环境进行实验。</p>
<h2 id="案例实施-2"><a href="#案例实施-2" class="headerlink" title="案例实施"></a>案例实施</h2><p>OpenStack Python SDK官方文档参见：<br><a target="_blank" rel="noopener" href="https://docs.openstack.org/openstacksdk/latest/user/index.html%E3%80%82">https://docs.openstack.org/openstacksdk/latest/user/index.html。</a><br>通过OpenStack Python SDK可以编写自动化Python脚本，用于创建和管理Openstack云环境中的资源。SDK实现了Python绑定OpenStack API，这能够让你使用Python实现自动化任务通过调用Python对象，而不用直接调用REST接口。<br>源代码地址为：<a target="_blank" rel="noopener" href="https://github.com/openstack/openstacksdk%E3%80%82%E6%8F%90%E4%BE%9B%E5%AE%8C%E6%95%B4%E6%BA%90%E4%BB%A3%E7%A0%81%E5%8F%8Aexamples%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81%E3%80%82%E5%A6%82%E5%9B%BE6%E6%89%80%E7%A4%BA%EF%BC%9A">https://github.com/openstack/openstacksdk。提供完整源代码及examples案例代码。如图6所示：</a></p>
<p><img src="../../../../images/image/DX/78.png" alt="78"><br>图6<br>Python的OpenStack模块下每种资源提供一个对应的模块实现。安装 OpenStack SDK：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip install openstacksdk</span>  </span><br></pre></td></tr></table></figure>

<p>查找认证的Endpoint地址：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keystone     | identity       | True    | internal  | http://controller:5000/v3/  </span><br></pre></td></tr></table></figure>

<p>执行以下代码的机器，需要配置hostname：controller IP。</p>
<h3 id="用户认证"><a href="#用户认证" class="headerlink" title="用户认证"></a>用户认证</h3><p>前面通过调用Restful APIs封装用户、主机、镜像等管理类，由于调用SDK非常简单，这里采用一个模块sdk_manager来统一实现。<br>认证方式：采用账户名密码方式，通过openstack. connect()建立连接。<br>用户管理：通过openstack. connect.identity模块实现。<br>新建sdk_manager_identity.py，用户查询与项目项目代码如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">import json,logging  </span><br><span class="line">import openstack  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">openstack logger</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">openstack.enable_logging(debug=True)</span>  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文档地址</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://docs.openstack.org/openstacksdk/latest/user/index.html</span>  </span><br><span class="line">def create_connection(auth_url, user_domain_name, username, password):  </span><br><span class="line">    &quot;&quot;&quot;  </span><br><span class="line">    建立连接  </span><br><span class="line">    :param auth_url:  </span><br><span class="line">    :param user_domain_name:  </span><br><span class="line">    :param username:  </span><br><span class="line">    :param password:  </span><br><span class="line">    :return:  </span><br><span class="line">    &quot;&quot;&quot;  </span><br><span class="line">    return openstack.connect(  </span><br><span class="line">        auth_url=auth_url,  </span><br><span class="line">        user_domain_name=user_domain_name,  </span><br><span class="line">        username=username,  </span><br><span class="line">        password=password,  </span><br><span class="line">    )  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">user Manager</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参见文档</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://docs.openstack.org/openstacksdk/latest/user/guides/identity.html</span>  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">openstack.connection.Connection</span>  </span><br><span class="line">class user_manager:  </span><br><span class="line">    def __init__(self, connect:openstack.connection.Connection):  </span><br><span class="line">        self.connect = connect  </span><br><span class="line">    def list_users(self):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        get User Resource.list object.  </span><br><span class="line">        :return:  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        users = self.connect.identity.users()  </span><br><span class="line">        #to json  </span><br><span class="line">        user_jsons = &#123;&#125;  </span><br><span class="line">        for user in users:  </span><br><span class="line">            user_jsons[user[&#x27;name&#x27;]] = user  </span><br><span class="line">        return json.dumps(user_jsons,indent=2)  </span><br><span class="line">    def list_projects(self):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        :return:  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        projects = self.connect.identity.projects()  </span><br><span class="line">        # to json  </span><br><span class="line">        projects_jsons = &#123;&#125;  </span><br><span class="line">        for item in projects:  </span><br><span class="line">            projects_jsons[item[&#x27;name&#x27;]] = item  </span><br><span class="line">        return json.dumps(projects_jsons, indent=2)  </span><br><span class="line">    def list_domains(self):  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        :return:  </span><br><span class="line">        &quot;&quot;&quot;  </span><br><span class="line">        items = self.connect.identity.domains()  </span><br><span class="line">        # to json  </span><br><span class="line">        items_jsons = &#123;&#125;  </span><br><span class="line">        for item in items:  </span><br><span class="line">            items_jsons[item[&#x27;name&#x27;]] = item  </span><br><span class="line">        return json.dumps(items_jsons, indent=2)  </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:  </span><br><span class="line">    # Initialize connection(通过配置文件）  </span><br><span class="line">    auth_url = &quot;http://172.128.11.18:5000/v3/&quot;  </span><br><span class="line">    username = &quot;admin&quot;  </span><br><span class="line">    password = &quot;000000&quot;  </span><br><span class="line">    user_domain_name = &#x27;demo&#x27;  </span><br><span class="line">    conn = create_connection(auth_url, user_domain_name, username, password)  </span><br><span class="line">    #查用户  </span><br><span class="line">    print(&quot;-------users-------&quot;)  </span><br><span class="line">    user_m = user_manager(conn)  </span><br><span class="line">    result = user_m.list_users()  </span><br><span class="line">    print(result)  </span><br><span class="line">    # 查项目  </span><br><span class="line">    print(&quot;-------projects-------&quot;)  </span><br><span class="line">    result = user_m.list_projects()  </span><br><span class="line">    print(result)  </span><br><span class="line">    # 查域  </span><br><span class="line">    print(&quot;-------domains-------&quot;)  </span><br><span class="line">    result = user_m.list_domains()  </span><br><span class="line">    print(result)  </span><br></pre></td></tr></table></figure>

<p>以上代码分别通过create_connection、user_manager实现建立连接、用户与项目的查询，__main__方法提供测试代码，可以逐个方法进行测试验证。相关的执行结果，可以通过命令行或dashboard界面进行验证。<br>执行sdk_manager_identity.py，结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# python3 sdk_manager_identity.py  </span><br><span class="line">&#123;&#x27;auth_url&#x27;: &#x27;http://172.128.11.18:5000/v3/&#x27;, &#x27;user_domain_name&#x27;: &#x27;demo&#x27;, &#x27;username&#x27;: &#x27;admin&#x27;, &#x27;password&#x27;: &#x27;000000&#x27;&#125;  </span><br><span class="line">-------users-------  </span><br><span class="line">&#123;  </span><br><span class="line">  &quot;admin&quot;: &#123;  </span><br><span class="line">    &quot;default_project_id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">    &quot;description&quot;: null,  </span><br><span class="line">    &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;email&quot;: null,  </span><br><span class="line">    &quot;is_enabled&quot;: true,  </span><br><span class="line">    &quot;links&quot;: &#123;  </span><br><span class="line">      &quot;self&quot;: &quot;http://172.128.11.18:5000/v3/users/89f8027475294689ae6c0183fa35bf5a&quot;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,  </span><br><span class="line">    &quot;password&quot;: null,  </span><br><span class="line">    &quot;password_expires_at&quot;: null,  </span><br><span class="line">    &quot;id&quot;: &quot;89f8027475294689ae6c0183fa35bf5a&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,  </span><br><span class="line">  ......  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">-------projects-------  </span><br><span class="line">&#123;  </span><br><span class="line">  &quot;admin&quot;: &#123;  </span><br><span class="line">    &quot;description&quot;: &quot;Admin Project&quot;,  </span><br><span class="line">    &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;is_domain&quot;: false,  </span><br><span class="line">    &quot;is_enabled&quot;: true,  </span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,  </span><br><span class="line">    &quot;options&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;parent_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;tags&quot;: []  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &quot;demo&quot;: &#123;  </span><br><span class="line">    &quot;description&quot;: &quot;Demo Project&quot;,  </span><br><span class="line">    &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;is_domain&quot;: false,  </span><br><span class="line">    &quot;is_enabled&quot;: true,  </span><br><span class="line">    &quot;name&quot;: &quot;demo&quot;,  </span><br><span class="line">    &quot;options&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;parent_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;id&quot;: &quot;32bb0b4849bc405a82aed64b7c0072fe&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;demo&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;tags&quot;: []  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &quot;service&quot;: &#123;  </span><br><span class="line">    &quot;description&quot;: &quot;Service Project&quot;,  </span><br><span class="line">    &quot;domain_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;is_domain&quot;: false,  </span><br><span class="line">    &quot;is_enabled&quot;: true,  </span><br><span class="line">    &quot;name&quot;: &quot;service&quot;,  </span><br><span class="line">    &quot;options&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;parent_id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;id&quot;: &quot;b47586b9fe8845c0b65ac944616cb934&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;service&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;tags&quot;: []  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">-------domains-------  </span><br><span class="line">&#123;  </span><br><span class="line">  &quot;demo&quot;: &#123;  </span><br><span class="line">    &quot;description&quot;: &quot;Default Domain&quot;,  </span><br><span class="line">    &quot;is_enabled&quot;: true,  </span><br><span class="line">    &quot;name&quot;: &quot;demo&quot;,  </span><br><span class="line">    &quot;links&quot;: &#123;  </span><br><span class="line">      &quot;self&quot;: &quot;http://172.128.11.18:5000/v3/domains/720f960530dc4e1982ebc7bdfd261f86&quot;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;id&quot;: &quot;720f960530dc4e1982ebc7bdfd261f86&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;demo&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &quot;Default&quot;: &#123;  </span><br><span class="line">    &quot;description&quot;: &quot;The default domain&quot;,  </span><br><span class="line">    &quot;is_enabled&quot;: true,  </span><br><span class="line">    &quot;name&quot;: &quot;Default&quot;,  </span><br><span class="line">    &quot;links&quot;: &#123;  </span><br><span class="line">      &quot;self&quot;: &quot;http://172.128.11.18:5000/v3/domains/default&quot;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;id&quot;: &quot;default&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;Default&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &quot;heat&quot;: &#123;  </span><br><span class="line">    &quot;description&quot;: &quot;Stack projects and users&quot;,  </span><br><span class="line">    &quot;is_enabled&quot;: true,  </span><br><span class="line">    &quot;name&quot;: &quot;heat&quot;,  </span><br><span class="line">    &quot;links&quot;: &#123;  </span><br><span class="line">      &quot;self&quot;: &quot;http://172.128.11.18:5000/v3/domains/e62a73d6033d49e89a0fd711a87f7d7b&quot;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;id&quot;: &quot;e62a73d6033d49e89a0fd711a87f7d7b&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;heat&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">Process finished with exit code 0  </span><br></pre></td></tr></table></figure>

<p>官网提供了查询User、Project、Domain资源的Python案例，资源的封装通过代理模式实现，参考类如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class IdentityService(service_description.ServiceDescription):  </span><br><span class="line">    &quot;&quot;&quot;The identity service.&quot;&quot;&quot;  </span><br><span class="line">    supported_versions = &#123;  </span><br><span class="line">        &#x27;2&#x27;: _proxy_v2.Proxy,  </span><br><span class="line">        &#x27;3&#x27;: _proxy_v3.Proxy,  </span><br><span class="line">    &#125;  </span><br></pre></td></tr></table></figure>

<p>思考一下如何通过SDK创建与更新资源。</p>
<h3 id="计算资源案例"><a href="#计算资源案例" class="headerlink" title="计算资源案例"></a>计算资源案例</h3><p>计算资源前面通过调用Restful APIs封装主机、镜像等管理类，在模块增加主机、镜像、主机类型、网络的管理实现。<br>主机管理：通过openstack. connect.compute模块实现。<br>镜像、主机类型、网络：也通过openstack. connect.compute模块实现。另外openstack.connect.image、openstack.connect.network也实现镜像与网络操作。<br>在sdk_manager_compute.py下增加如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json,logging  </span><br><span class="line"><span class="keyword">import</span> openstack  </span><br><span class="line"><span class="comment">#openstack logger  </span></span><br><span class="line"><span class="comment"># openstack.enable_logging(debug=True)  </span></span><br><span class="line"><span class="comment">#文档地址  </span></span><br><span class="line"><span class="comment"># https://docs.openstack.org/openstacksdk/latest/user/index.html  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_connection</span>(<span class="params">auth_url, user_domain_name, username, password</span>):  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">    建立连接  </span></span><br><span class="line"><span class="string">    :param auth_url:  </span></span><br><span class="line"><span class="string">    :param user_domain_name:  </span></span><br><span class="line"><span class="string">    :param username:  </span></span><br><span class="line"><span class="string">    :param password:  </span></span><br><span class="line"><span class="string">    :return:  </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>  </span><br><span class="line">    <span class="keyword">return</span> openstack.connect(  </span><br><span class="line">        auth_url=auth_url,  </span><br><span class="line">        user_domain_name=user_domain_name,  </span><br><span class="line">        username=username,  </span><br><span class="line">        password=password,  </span><br><span class="line">    )  </span><br><span class="line"><span class="comment">#user Manager  </span></span><br><span class="line"><span class="comment"># 参见文档  </span></span><br><span class="line"><span class="comment"># https://docs.openstack.org/openstacksdk/latest/user/guides/identity.html  </span></span><br><span class="line"><span class="comment">#openstack.connection.Connection  </span></span><br><span class="line"><span class="comment">#云主机管理  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">server_manager</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connect</span>):  </span><br><span class="line">        self.connect = connect  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_servers</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        查询所有云主机.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment">#to json  </span></span><br><span class="line">        items = self.connect.compute.servers()  </span><br><span class="line">        server_jsons = &#123;&#125;  </span><br><span class="line">        <span class="keyword">for</span> server <span class="keyword">in</span> items:  </span><br><span class="line">            server_jsons[server[<span class="string">&#x27;name&#x27;</span>]] = server  </span><br><span class="line">        <span class="comment"># return &quot;&quot;  </span></span><br><span class="line">        <span class="keyword">return</span> items<span class="comment"># json.dumps(server_jsons,indent=2,skipkeys=True)  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_server</span>(<span class="params">self, server_name, image_name, flavor_name,networ_name</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        create a server.  </span></span><br><span class="line"><span class="string">        :param server_name:  </span></span><br><span class="line"><span class="string">        :param image_name:  </span></span><br><span class="line"><span class="string">        :param flavor_name:  </span></span><br><span class="line"><span class="string">        :param networ_name:  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        image = self.connect.compute.find_image(image_name)  </span><br><span class="line">        flavor = self.connect.compute.find_flavor(flavor_name)  </span><br><span class="line">        network = self.connect.network.find_network(networ_name)  </span><br><span class="line">        server = self.connect.compute.create_server(  </span><br><span class="line">            name=server_name, image_id=image.<span class="built_in">id</span>, flavor_id=flavor.<span class="built_in">id</span>,  </span><br><span class="line">            networks=[&#123;<span class="string">&quot;uuid&quot;</span>: network.<span class="built_in">id</span>&#125;])  </span><br><span class="line">        result = self.connect.compute.wait_for_server(server)  </span><br><span class="line">        <span class="keyword">return</span> result <span class="comment">#json.dumps(result,indent=2,skipkeys=True)  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_server</span>(<span class="params">self, server_name</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        删除云主机  </span></span><br><span class="line"><span class="string">        :param server_name:  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        server = self.connect.compute.find_server(server_name)  </span><br><span class="line">        result = self.connect.compute.delete_server(server)  </span><br><span class="line">        <span class="keyword">return</span> result <span class="comment">#json.dumps(result, indent=2, skipkeys=True)  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_server</span>(<span class="params">self, server_name</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        获取云主机  </span></span><br><span class="line"><span class="string">        :param server_name:  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        server = self.connect.compute.find_server(server_name)  </span><br><span class="line">        <span class="keyword">return</span> json.dumps(server, indent=<span class="number">2</span>, skipkeys=<span class="literal">True</span>)  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">image_manager</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connect</span>):  </span><br><span class="line">        self.connect = connect  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_images</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        查询所有镜像  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment">#to json  </span></span><br><span class="line">        items = self.connect.compute.images()  </span><br><span class="line">        images_jsons = &#123;&#125;  </span><br><span class="line">        <span class="keyword">for</span> image <span class="keyword">in</span> items:  </span><br><span class="line">            images_jsons[image[<span class="string">&#x27;name&#x27;</span>]] = image  </span><br><span class="line">        <span class="keyword">return</span> json.dumps(images_jsons,indent=<span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_image</span>(<span class="params">self, image_name:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        查询镜像  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment">#to json  </span></span><br><span class="line">        image = self.connect.compute.find_image(image_name)  </span><br><span class="line">        <span class="keyword">return</span> json.dumps(image,indent=<span class="number">2</span>)  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">flavor_manager</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connect</span>):  </span><br><span class="line">        self.connect = connect  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_flavors</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        查询所有云主机类型  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment">#to json  </span></span><br><span class="line">        items = self.connect.compute.flavors()  </span><br><span class="line">        flavors_jsons = &#123;&#125;  </span><br><span class="line">        <span class="keyword">for</span> flavor <span class="keyword">in</span> items:  </span><br><span class="line">            flavors_jsons[flavor[<span class="string">&#x27;name&#x27;</span>]] = flavor  </span><br><span class="line">        <span class="keyword">return</span> json.dumps(flavors_jsons,indent=<span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_flavor</span>(<span class="params">self, flavor_name:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        根据名称获取云主机类.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment">#to json  </span></span><br><span class="line">        flavor = self.connect.compute.find_flavor(flavor_name)  </span><br><span class="line">        <span class="keyword">return</span> json.dumps(flavor,indent=<span class="number">2</span>)  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">network_manager</span>:  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connect</span>):  </span><br><span class="line">        self.connect = connect  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_networks</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        查询所有网络.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment">#to json  </span></span><br><span class="line">        items = self.connect.network.networks()  </span><br><span class="line">        items_jsons = &#123;&#125;  </span><br><span class="line">        <span class="keyword">for</span> network <span class="keyword">in</span> items:  </span><br><span class="line">            items_jsons[network[<span class="string">&#x27;name&#x27;</span>]] = network  </span><br><span class="line">        <span class="keyword">return</span> json.dumps(items_jsons,indent=<span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_network</span>(<span class="params">self, network_name:<span class="built_in">str</span></span>):  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;  </span></span><br><span class="line"><span class="string">        跟名称查询网络.  </span></span><br><span class="line"><span class="string">        :return:  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="comment">#to json  </span></span><br><span class="line">        flavor = self.connect.compute.find_network(network_name)  </span><br><span class="line">        <span class="keyword">return</span> json.dumps(flavor,indent=<span class="number">2</span>)  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    <span class="comment"># Initialize connection(通过配置文件）  </span></span><br><span class="line">    auth_url = <span class="string">&quot;http://172.128.11.18:5000/v3/&quot;</span>  </span><br><span class="line">    username = <span class="string">&quot;admin&quot;</span>  </span><br><span class="line">    password = <span class="string">&quot;000000&quot;</span>  </span><br><span class="line">    user_domain_name = <span class="string">&#x27;demo&#x27;</span>  </span><br><span class="line">    conn = create_connection(auth_url, user_domain_name, username, password)  </span><br><span class="line">    <span class="comment"># 1 查询flavors  </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;list flavors--------&quot;</span>)  </span><br><span class="line">    sdk_m = flavor_manager(conn)  </span><br><span class="line">    flavors = sdk_m.list_flavors()  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;flavors:&quot;</span>, flavors)  </span><br><span class="line">    <span class="comment"># 2 镜像管理  </span></span><br><span class="line">    sdk_m = image_manager(conn)  </span><br><span class="line">    items = sdk_m.list_images()  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;image:&quot;</span>, items)  </span><br><span class="line">    <span class="comment"># 3 网络管理  </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;list networks--------&quot;</span>)  </span><br><span class="line">    sdk_m = network_manager(conn)  </span><br><span class="line">    networks = sdk_m.list_networks()  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;networks:&quot;</span>, networks)  </span><br><span class="line">    <span class="comment">#4 查询 云主机  </span></span><br><span class="line">    sdk_m = server_manager(conn)  </span><br><span class="line">    servers = sdk_m.list_servers()  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;servers:&quot;</span>, servers)  </span><br><span class="line">    <span class="comment">#5 创建云主机  </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;creat server--------&quot;</span>)  </span><br><span class="line">    servers = sdk_m.create_server(<span class="string">&quot;test_song&quot;</span>,<span class="string">&quot;cirros&quot;</span>,<span class="string">&quot;m1.tiny&quot;</span>,<span class="string">&quot;net&quot;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;servers:&quot;</span>, servers)  </span><br><span class="line">    <span class="comment">#6 删除云主机  </span></span><br><span class="line">    result = sdk_m.delete_server(<span class="string">&quot;test_song&quot;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;servers:&quot;</span>, result)  </span><br></pre></td></tr></table></figure>

<p>以上代码分别通过user_manager、server_manager、image_manager、flavor_manager、network_manager实现镜像、云主机、镜像、主机类型、网络的增删除改。每种资源的操作都提供对应的方法直接操作，非常简单，其他资源或方法可以通过源码或帮助文件进行操作。<br>__main__方法提供测试代码，可以逐个方法进行测试验证。相关的执行结果，可以通过命令行或Dashboard界面进行验证。<br>执行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# python3 sdk_manager_compute.py  </span><br><span class="line">&#123;&#x27;auth_url&#x27;: &#x27;http://172.128.11.18:5000/v3/&#x27;, &#x27;user_domain_name&#x27;: &#x27;demo&#x27;, &#x27;username&#x27;: &#x27;admin&#x27;, &#x27;password&#x27;: &#x27;000000&#x27;&#125;  </span><br><span class="line">list flavors--------  </span><br><span class="line">flavors: &#123;  </span><br><span class="line">  &quot;m1.tiny&quot;: &#123;  </span><br><span class="line">    &quot;links&quot;: [  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/v2.1/flavors/1&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;self&quot;  </span><br><span class="line">      &#125;,  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/flavors/1&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;bookmark&quot;  </span><br><span class="line">      &#125;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;name&quot;: &quot;m1.tiny&quot;,  </span><br><span class="line">    &quot;description&quot;: null,  </span><br><span class="line">    &quot;disk&quot;: 10,  </span><br><span class="line">    &quot;is_public&quot;: true,  </span><br><span class="line">    &quot;ram&quot;: 512,  </span><br><span class="line">    &quot;vcpus&quot;: 1,  </span><br><span class="line">    &quot;swap&quot;: &quot;&quot;,  </span><br><span class="line">    &quot;ephemeral&quot;: 0,  </span><br><span class="line">    &quot;is_disabled&quot;: false,  </span><br><span class="line">    &quot;rxtx_factor&quot;: 1.0,  </span><br><span class="line">    &quot;extra_specs&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;id&quot;: &quot;1&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;m1.tiny&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &quot;flavor_small&quot;: &#123;  </span><br><span class="line">    &quot;links&quot;: [  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/v2.1/flavors/100000&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;self&quot;  </span><br><span class="line">      &#125;,  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/flavors/100000&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;bookmark&quot;  </span><br><span class="line">      &#125;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;name&quot;: &quot;flavor_small&quot;,  </span><br><span class="line">    &quot;description&quot;: &quot;Update description skill_china&quot;,  </span><br><span class="line">    &quot;disk&quot;: 10,  </span><br><span class="line">    &quot;is_public&quot;: true,  </span><br><span class="line">    &quot;ram&quot;: 1024,  </span><br><span class="line">    &quot;vcpus&quot;: 1,  </span><br><span class="line">    &quot;swap&quot;: &quot;&quot;,  </span><br><span class="line">    &quot;ephemeral&quot;: 0,  </span><br><span class="line">    &quot;is_disabled&quot;: false,  </span><br><span class="line">    &quot;rxtx_factor&quot;: 1.0,  </span><br><span class="line">    &quot;extra_specs&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;id&quot;: &quot;100000&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;flavor_small&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &quot;m1.small&quot;: &#123;  </span><br><span class="line">    &quot;links&quot;: [  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/v2.1/flavors/2&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;self&quot;  </span><br><span class="line">      &#125;,  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/flavors/2&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;bookmark&quot;  </span><br><span class="line">      &#125;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;name&quot;: &quot;m1.small&quot;,  </span><br><span class="line">    &quot;description&quot;: null,  </span><br><span class="line">    &quot;disk&quot;: 20,  </span><br><span class="line">    &quot;is_public&quot;: true,  </span><br><span class="line">    &quot;ram&quot;: 1024,  </span><br><span class="line">    &quot;vcpus&quot;: 1,  </span><br><span class="line">    &quot;swap&quot;: &quot;&quot;,  </span><br><span class="line">    &quot;ephemeral&quot;: 0,  </span><br><span class="line">    &quot;is_disabled&quot;: false,  </span><br><span class="line">    &quot;rxtx_factor&quot;: 1.0,  </span><br><span class="line">    &quot;extra_specs&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;id&quot;: &quot;2&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;m1.small&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,  </span><br><span class="line">  &quot;m1.medium&quot;: &#123;  </span><br><span class="line">    &quot;links&quot;: [  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/v2.1/flavors/3&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;self&quot;  </span><br><span class="line">      &#125;,  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/flavors/3&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;bookmark&quot;  </span><br><span class="line">      &#125;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;name&quot;: &quot;m1.medium&quot;,  </span><br><span class="line">    &quot;description&quot;: null,  </span><br><span class="line">    &quot;disk&quot;: 40,  </span><br><span class="line">    &quot;is_public&quot;: true,  </span><br><span class="line">    &quot;ram&quot;: 2048,  </span><br><span class="line">    &quot;vcpus&quot;: 2,  </span><br><span class="line">    &quot;swap&quot;: &quot;&quot;,  </span><br><span class="line">    &quot;ephemeral&quot;: 0,  </span><br><span class="line">    &quot;is_disabled&quot;: false,  </span><br><span class="line">    &quot;rxtx_factor&quot;: 1.0,  </span><br><span class="line">    &quot;extra_specs&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;id&quot;: &quot;3&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;m1.medium&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">image: &#123;  </span><br><span class="line">  &quot;cirros&quot;: &#123;  </span><br><span class="line">    &quot;links&quot;: [  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/v2.1/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;self&quot;  </span><br><span class="line">      &#125;,  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:8774/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;bookmark&quot;  </span><br><span class="line">      &#125;,  </span><br><span class="line">      &#123;  </span><br><span class="line">        &quot;href&quot;: &quot;http://controller:9292/images/d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;,  </span><br><span class="line">        &quot;type&quot;: &quot;application/vnd.openstack.image&quot;,  </span><br><span class="line">        &quot;rel&quot;: &quot;alternate&quot;  </span><br><span class="line">      &#125;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;name&quot;: &quot;cirros&quot;,  </span><br><span class="line">    &quot;created_at&quot;: &quot;2022-03-10T00:56:56Z&quot;,  </span><br><span class="line">    &quot;metadata&quot;: &#123;&#125;,  </span><br><span class="line">    &quot;min_disk&quot;: 0,  </span><br><span class="line">    &quot;min_ram&quot;: 0,  </span><br><span class="line">    &quot;progress&quot;: 100,  </span><br><span class="line">    &quot;status&quot;: &quot;ACTIVE&quot;,  </span><br><span class="line">    &quot;updated_at&quot;: &quot;2022-03-10T00:56:57Z&quot;,  </span><br><span class="line">    &quot;size&quot;: 13287936,  </span><br><span class="line">    &quot;id&quot;: &quot;d50222d2-f737-4b47-ba7c-38eaa2418ff0&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;cirros&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">list networks--------  </span><br><span class="line">networks: &#123;  </span><br><span class="line">  &quot;net&quot;: &#123;  </span><br><span class="line">    &quot;availability_zone_hints&quot;: [],  </span><br><span class="line">    &quot;availability_zones&quot;: [  </span><br><span class="line">      &quot;nova&quot;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;created_at&quot;: &quot;2022-03-10T01:21:52Z&quot;,  </span><br><span class="line">    &quot;description&quot;: &quot;&quot;,  </span><br><span class="line">    &quot;dns_domain&quot;: null,  </span><br><span class="line">    &quot;ipv4_address_scope_id&quot;: null,  </span><br><span class="line">    &quot;ipv6_address_scope_id&quot;: null,  </span><br><span class="line">    &quot;is_admin_state_up&quot;: true,  </span><br><span class="line">    &quot;is_default&quot;: null,  </span><br><span class="line">    &quot;is_port_security_enabled&quot;: true,  </span><br><span class="line">    &quot;is_router_external&quot;: false,  </span><br><span class="line">    &quot;is_shared&quot;: false,  </span><br><span class="line">    &quot;mtu&quot;: 1450,  </span><br><span class="line">    &quot;name&quot;: &quot;net&quot;,  </span><br><span class="line">    &quot;project_id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">    &quot;provider_network_type&quot;: &quot;vxlan&quot;,  </span><br><span class="line">    &quot;provider_physical_network&quot;: null,  </span><br><span class="line">    &quot;provider_segmentation_id&quot;: 12,  </span><br><span class="line">    &quot;qos_policy_id&quot;: null,  </span><br><span class="line">    &quot;segments&quot;: null,  </span><br><span class="line">    &quot;status&quot;: &quot;ACTIVE&quot;,  </span><br><span class="line">    &quot;subnet_ids&quot;: [  </span><br><span class="line">      &quot;a16130c4-79c1-4ae8-9bc3-c167ee009d63&quot;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;updated_at&quot;: &quot;2022-03-10T01:21:53Z&quot;,  </span><br><span class="line">    &quot;is_vlan_transparent&quot;: null,  </span><br><span class="line">    &quot;revision_number&quot;: 2,  </span><br><span class="line">    &quot;id&quot;: &quot;df62ea19-3e33-40bf-9f41-f2c5f343b3e7&quot;,  </span><br><span class="line">    &quot;name&quot;: &quot;net&quot;,  </span><br><span class="line">    &quot;location&quot;: &#123;  </span><br><span class="line">      &quot;cloud&quot;: &quot;defaults&quot;,  </span><br><span class="line">      &quot;region_name&quot;: &quot;&quot;,  </span><br><span class="line">      &quot;zone&quot;: null,  </span><br><span class="line">      &quot;project&quot;: &#123;  </span><br><span class="line">        &quot;id&quot;: &quot;0b6f2d0be1d342e09edc31dc841db7a5&quot;,  </span><br><span class="line">        &quot;name&quot;: null,  </span><br><span class="line">        &quot;domain_id&quot;: null,  </span><br><span class="line">        &quot;domain_name&quot;: null  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    &quot;tags&quot;: []  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">servers:   </span><br><span class="line">creat server--------  </span><br><span class="line">servers: openstack.compute.v2.server.Server(name=test_song, imageRef=d50222d2-f737-4b47-ba7c-38eaa2418ff0, flavorRef=1, networks=[&#123;&#x27;uuid&#x27;: &#x27;df62ea19-3e33-40bf-9f41-f2c5f343b3e7&#x27;&#125;], security_groups=[&#123;&#x27;name&#x27;: &#x27;default&#x27;&#125;], OS-DCF:diskConfig=MANUAL, id=25554b93-65b2-472b-9bc0-344c4f405a50, links=[&#123;&#x27;href&#x27;:   </span><br></pre></td></tr></table></figure>

<p>计算资源或其他资源的Python调用类似，可以查看接口进行测试。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/08/10/DX-Python%E8%B0%83%E7%94%A8OpenStackAPI%E6%A1%88%E4%BE%8B/">http://example.com/2023/08/10/DX-Python调用OpenStackAPI案例/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OpenStack/">OpenStack</a></div><div class="post_share"><div class="social-share" data-image="/../images/title/python4.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/10/DX-Ansible%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(11)Ansible集群服务部署案例"><img class="cover" src="/../images/title/ansible.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">私有云：(11)Ansible集群服务部署案例</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/10/DX-%E7%A7%81%E6%9C%89%E4%BA%91Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/" title="私有云：(13)私有云Python运维开发案例"><img class="cover" src="/../images/title/python3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">私有云：(13)私有云Python运维开发案例</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/10/DX-Ansible%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(11)Ansible集群服务部署案例"><img class="cover" src="/../images/title/ansible.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(11)Ansible集群服务部署案例</div></div></a></div><div><a href="/2023/08/10/DX-Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98%E6%A1%88%E4%BE%8B/" title="私有云：(8)Linux系统调优案例"><img class="cover" src="/../images/title/linux5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(8)Linux系统调优案例</div></div></a></div><div><a href="/2023/08/10/DX-Linux%E7%B3%BB%E7%BB%9F%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B/" title="私有云：(7)Linux系统集群部署应用案例"><img class="cover" src="/../images/title/linux4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(7)Linux系统集群部署应用案例</div></div></a></div><div><a href="/2023/08/10/DX-OpenStack%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(2)OpenStack基础平台部署案例"><img class="cover" src="/../images/title/openstack2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(2)OpenStack基础平台部署案例</div></div></a></div><div><a href="/2023/08/10/DX-OpenStack%E5%B9%B3%E5%8F%B0%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/" title="私有云：(9)OpenStack平台安全管理与优化案例"><img class="cover" src="/../images/title/openstack2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(9)OpenStack平台安全管理与优化案例</div></div></a></div><div><a href="/2023/08/10/DX-OpenStack%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4%E6%A1%88%E4%BE%8B/" title="私有云：(5)OpenStack服务运维案例"><img class="cover" src="/../images/title/openstack5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(5)OpenStack服务运维案例</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/title/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">案例描述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9APython%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">案例一：Python开发环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E7%9B%AE%E6%A0%87"><span class="toc-number">2.1.</span> <span class="toc-text">任务目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">案例准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD"><span class="toc-number">2.3.</span> <span class="toc-text">案例实施</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E9%80%9A%E8%BF%87RESTful%E7%BC%96%E5%86%99Python%E8%BF%90%E7%BB%B4"><span class="toc-number">3.</span> <span class="toc-text">案例二：通过RESTful编写Python运维</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E7%9B%AE%E6%A0%87-1"><span class="toc-number">3.1.</span> <span class="toc-text">任务目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87-1"><span class="toc-number">3.2.</span> <span class="toc-text">案例准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD-1"><span class="toc-number">3.3.</span> <span class="toc-text">案例实施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1%EF%BC%9A%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">3.3.1.</span> <span class="toc-text">认证服务：用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">接口说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.1.2.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%AA%8C%E8%AF%81"><span class="toc-number">3.3.1.3.</span> <span class="toc-text">代码验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%EF%BC%9A%E5%AE%9E%E4%BE%8B%E7%B1%BB%E5%9E%8B%E7%AE%A1%E7%90%86"><span class="toc-number">3.3.2.</span> <span class="toc-text">计算服务：实例类型管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E-1"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">接口说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%AA%8C%E8%AF%81-1"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">代码验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%EF%BC%9A%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86"><span class="toc-number">3.3.3.</span> <span class="toc-text">计算服务：云主机管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E-2"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">接口说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%AA%8C%E8%AF%81-2"><span class="toc-number">3.3.3.3.</span> <span class="toc-text">代码验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.4.</span> <span class="toc-text">镜像管理代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E-3"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">接口说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-3"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%AA%8C%E8%AF%81-3"><span class="toc-number">3.3.4.3.</span> <span class="toc-text">代码验证</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A%E9%80%9A%E8%BF%87OpenStack-SDK%E7%BC%96%E5%86%99Python%E8%BF%90%E7%BB%B4"><span class="toc-number">4.</span> <span class="toc-text">案例三：通过OpenStack SDK编写Python运维</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E7%9B%AE%E6%A0%87-2"><span class="toc-number">4.1.</span> <span class="toc-text">任务目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87-2"><span class="toc-number">4.2.</span> <span class="toc-text">案例准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD-2"><span class="toc-number">4.3.</span> <span class="toc-text">案例实施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81"><span class="toc-number">4.3.1.</span> <span class="toc-text">用户认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90%E6%A1%88%E4%BE%8B"><span class="toc-number">4.3.2.</span> <span class="toc-text">计算资源案例</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/21/ST-%E9%AB%98%E5%8F%AF%E7%94%A8Hadoop/" title="高可用部署 HADOOP"><img src="/../images/title/hadoop-jb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高可用部署 HADOOP"/></a><div class="content"><a class="title" href="/2024/11/21/ST-%E9%AB%98%E5%8F%AF%E7%94%A8Hadoop/" title="高可用部署 HADOOP">高可用部署 HADOOP</a><time datetime="2024-11-20T16:10:00.000Z" title="发表于 2024-11-21 00:10:00">2024-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/21/SRE-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" title="磁盘存储和文件系统"><img src="/../images/image/SRE/day09/4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="磁盘存储和文件系统"/></a><div class="content"><a class="title" href="/2024/11/21/SRE-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" title="磁盘存储和文件系统">磁盘存储和文件系统</a><time datetime="2024-11-20T16:00:00.000Z" title="发表于 2024-11-21 00:00:00">2024-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/08/ST-Linux%E5%AE%9E%E7%94%A8%E7%94%A8%E8%84%9A%E6%9C%AC/" title="Linux 实用脚本"><img src="/../images/title/ST.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux 实用脚本"/></a><div class="content"><a class="title" href="/2024/11/08/ST-Linux%E5%AE%9E%E7%94%A8%E7%94%A8%E8%84%9A%E6%9C%AC/" title="Linux 实用脚本">Linux 实用脚本</a><time datetime="2024-11-07T16:10:00.000Z" title="发表于 2024-11-08 00:10:00">2024-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="shell脚本编程"><img src="/../images/title/linux2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shell脚本编程"/></a><div class="content"><a class="title" href="/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="shell脚本编程">shell脚本编程</a><time datetime="2024-11-04T16:00:00.000Z" title="发表于 2024-11-05 00:00:00">2024-11-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>