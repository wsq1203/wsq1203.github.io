<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>私有云：(7)Linux系统集群部署应用案例 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Linux系统集群部署应用案例">
<meta property="og:type" content="article">
<meta property="og:title" content="私有云：(7)Linux系统集群部署应用案例">
<meta property="og:url" content="http://example.com/2023/08/10/DX-Linux%E7%B3%BB%E7%BB%9F%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="Linux系统集群部署应用案例">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/TITLE/linux4.jpg">
<meta property="article:published_time" content="2023-08-09T23:00:00.000Z">
<meta property="article:modified_time" content="2025-04-01T11:39:30.562Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/TITLE/linux4.jpg"><link rel="shortcut icon" href="/../images/TITLE/user.webp"><link rel="canonical" href="http://example.com/2023/08/10/DX-Linux%E7%B3%BB%E7%BB%9F%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '私有云：(7)Linux系统集群部署应用案例',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2025-04-01 19:39:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/TITLE/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/TITLE/linux4.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">私有云：(7)Linux系统集群部署应用案例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-09T23:00:00.000Z" title="发表于 2023-08-10 07:00:00">2023-08-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-01T11:39:30.562Z" title="更新于 2025-04-01 19:39:30">2025-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Contest/">Contest</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="私有云：(7)Linux系统集群部署应用案例"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="案例描述"><a href="#案例描述" class="headerlink" title="案例描述"></a>案例描述</h1><p>本案例讲述如何使用OpenStack平台的云主机来部署ELK服务，具体案例描述如下：</p>
<p>（1）Elasticsearch集群安装、elasticsearch.yml文件配置、Elasticsearch集群健康状态检查。</p>
<p>（2）Kibana服务安装、kibana.yml文件配置、测试访问Kibana页面。</p>
<p>（3）Logstash服务安装、logstash.yml文件配置、配置logstash收集syslog日志。</p>
<p>（4）Kibana检索日志信息、Kibana页面配置日志检索信息、验证日志检索是否成功。</p>
<h3 id="规划节点"><a href="#规划节点" class="headerlink" title="规划节点"></a>规划节点</h3><p>节点规划见表1。</p>
<p>表1 节点规划</p>
<table>
<thead>
<tr>
<th><strong>IP</strong></th>
<th><strong>主机名</strong></th>
<th><strong>节点</strong></th>
</tr>
</thead>
<tbody><tr>
<td>172.128.11.10</td>
<td>elk-1</td>
<td>Elasticsearch/Kibana</td>
</tr>
<tr>
<td>172.128.11.17</td>
<td>elk-2</td>
<td>Elasticsearch/Logstash</td>
</tr>
<tr>
<td>172.128.11.11</td>
<td>elk-3</td>
<td>Elasticsearch</td>
</tr>
</tbody></table>
<h3 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h3><p>登录物理OpenStack平台，使用CentOS7.9镜像创建三台云主机，云主机类型使用2VCPU/4GB内存/50GB硬盘。创建后的云主机作为本次案例的实验节点。</p>
<h1 id="案例实施"><a href="#案例实施" class="headerlink" title="案例实施"></a>案例实施</h1><h3 id="ELK日志分析系统"><a href="#ELK日志分析系统" class="headerlink" title="ELK日志分析系统"></a>ELK日志分析系统</h3><p>ELK指的是Elasticsearch+Logstash+Kibana这种架构的缩写。</p>
<p>ELK是一种日志分析平台，在很早之前我们经常使用Shell三剑客（一般泛指grep、sed、awk）来进行日志分析，这种方式虽然也可以应对多种场景，但是当日志量大、分析频率高，并且在结合用户不会使用Shell的情况下，这种方法就很不受欢迎。这时候就运营而出了一种新型的日志分析系统，那就是ELK，它的配置方便、使用简单，同时它的分析结果可以使用户能够更加直观的看出分析出来的结果。</p>
<p>一个完整的集中式日志系统，需要包含以下几个主要特点：</p>
<p>● 收集－能够采集多种来源的日志数据；</p>
<p>● 传输－能够稳定的把日志数据传输到中央系统；</p>
<p>● 存储－如何存储日志数据；</p>
<p>● 分析－可以支持 UI 分析；</p>
<p>● 警告－能够提供错误报告，监控机制；</p>
<p>而ELK则提供一整套的解决方案，并且都是开源软件，之间相互配合，完美衔接，高效的满足了很多场合的应用。</p>
<p>（1）Elasticsearch服务</p>
<p>Elasticsearch是一款开源的、分布式、高扩展并且高实时的搜索与数据分析引擎，它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful Web接口。Elasticsearch是使用Java语言开发的，他能很方便的使大量数据具有搜索、分析和探索的能力。充分利用Elasticsearch的水平伸缩性，能使数据在生产环境变得更有价值。</p>
<p>Elasticsearch使用Lucene（全文检索引擎工具包），并试图通过JSON和Java API提供其所有特性。它支持facetting和percolating，如果新文档与注册查询匹配，这对于通知非常有用。另一个特性称为“网关”，处理索引的长期持久性；例如，在服务器崩溃的情况下，可以从网关恢复索引。Elasticsearch支持实时GET请求，适合作为NoSQL数据存储，但缺少分布式事务。</p>
<p>（2）Logstash服务</p>
<p>Logstash经常用于日志系统中做日志采集设备，最常用于ELK中作为日志搜集器使用。</p>
<p>简单的来说Logstash是具有实时流水线能力的开源的数据搜索引擎。它可以去动态的统一不同来源的数据，并将数据标准化到用户选择的目标输出。它提供了大量的插件，可以帮助我们解析、丰富、转换和缓冲任何类型的数据。Logstash大概分为三个部分，分别是Inputs（输入阶段）、Filters（过滤器阶段）、Outputs（输出阶段）。</p>
<p>Inputs（输入阶段）：会生成时间，采集各种样式，大小和相关来源数据，负责从各个服务器中收集数据。</p>
<p>Filters（过滤器阶段）：它可以将过滤器和条件语句结合使用对事件进行处理包括：grok、mutate等。</p>
<p>Outputs（输出阶段）：将事件数据发送到特定的目标，完成了输出处理，该事件就完成了执行。如：elasticsearch、file等。</p>
<p>以上三个部分除了Filter是可选之外，其他两个部分都是必须的。</p>
<p>（3）Kibana服务</p>
<p>Kibana也是一个开源的分析与可视化平台，常和Elasticsearch搭配使用。用户可以用kibana搜索、查看存放在Elasticsearch中的数据。Kibana与Elasticsearch的交互方式是各种不同的图表、表格、地图等，直观的展示数据，从而达到高级的数据分析与可视化的目的。</p>
<hr>
<h3 id="ELK常见架构"><a href="#ELK常见架构" class="headerlink" title="ELK常见架构"></a>ELK常见架构</h3><p>Elasticsearch+Logstash+Kibana：这种架构是最常见的一种，也是最简单的一种架构，这种架构通过Logstash收集日志，运用Elasticsearch分析日志，最后通过Kibana中展示日志信息。</p>
<p>Elasticsearch+Logstash+Filebeat+Kibana：在这种架构中增加了一个Filebeat模块。这个模块在上面的内容中没有对它详细介绍，它是一款轻量的日志收集代理，用来部署在客户端当中，这个服务较Logstash来说能够节省资源，一般在生产环境中大多采用这种架构，但是这种架构有一个弊端，那就是当Logstash出现故障后，则会造成日志的丢失。</p>
<p>Elasticsearch+Logstash+filebeat+redis（及其他中间件）+Kibana：这种架构等于是上面第二种的完善，通过增加中间件来去避免数据丢失，当Logstash出现故障后，日志依旧留存在中间件内，当Logstash再次启动，则会读取中间件中积压的日志。</p>
<hr>
<h3 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h3><p>（1）三台主机修改主机名</p>
<p>elk-1节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@lqhelk-1 ~]# hostnamectl set-hostname elk-1</span><br><span class="line">[root@lqhelk-1 ~]# bash </span><br><span class="line">[root@elk-1 ~]# hostnamectl </span><br><span class="line">   Static hostname: elk-1</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa</span><br><span class="line">           Boot ID: 4786f596058f424db58406c8c1b9c635</span><br><span class="line">    Virtualization: kvm</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-1160.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br></pre></td></tr></table></figure>

<p>elk-2节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@lqhelk-2 ~]# hostnamectl  set-hostname elk-2</span><br><span class="line">[root@elk-2 ~]# hostnamectl  </span><br><span class="line">   Static hostname: elk-2</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa</span><br><span class="line">           Boot ID: 17e276b0811d4a01907ab8424a16a072</span><br><span class="line">    Virtualization: kvm</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-1160.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br></pre></td></tr></table></figure>

<p>elk-3节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@lqhelk-3 ~]# hostnamectl  set-hostname elk-3</span><br><span class="line">[root@lqhelk-3 ~]# bash </span><br><span class="line">[root@elk-3 ~]# hostnamectl  </span><br><span class="line">   Static hostname: elk-3</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa</span><br><span class="line">           Boot ID: 07d416916e744daa8a96163a93fcf34a</span><br><span class="line">    Virtualization: kvm</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-1160.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br></pre></td></tr></table></figure>

<p>（2）三台主机配置主机名映射（以第一台节点为例，三个节点都要配置）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# vi /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">172.128.11.10 elk-1</span><br><span class="line">172.128.11.17 elk-2</span><br><span class="line">172.128.11.11 elk-3</span><br></pre></td></tr></table></figure>

<p>（3）三台主机安装JDK环境（以第一台节点为例）</p>
<p>使用CentOS7.9镜像配置YUM源，部署ELK环境需要jdk1.8以上的JDK版本软件环境，我们本次实验使用的是opnejdk1.8，可直接使用本地源进行安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# curl -O http://mirrors.douxuedu.com/competition/CentOS-7-x86_64-DVD-2009.iso</span><br><span class="line">[root@elk-1 ~]# mv /etc/yum.repos.d/* /media/</span><br><span class="line">[root@elk-1 ~]# mkdir  /opt/centos-2009</span><br><span class="line">[root@elk-1 ~]# vi /etc/yum.repos.d/local.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos-2009</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[root@elk-1 ~]# mount CentOS-7-x86_64-DVD-2009.iso  /mnt/</span><br><span class="line">mount: /dev/loop0 is write-protected, mounting read-only</span><br><span class="line">[root@elk-1 ~]# cp -rvf /mnt/* /opt/centos-2009</span><br><span class="line">[root@elk-1 ~]# umount /mnt/</span><br><span class="line">[root@elk-1 ~]# yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel</span><br><span class="line">......</span><br><span class="line">Installed:</span><br><span class="line">  java-1.8.0-openjdk.x86_64 1:1.8.0.262.b10-1.el7                 java-1.8.0-openjdk-devel.x86_64 1:1.8.0.262.b10-1.el7                </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  alsa-lib.x86_64 0:1.1.8-1.el7                                 atk.x86_64 0:2.28.1-2.el7                                              </span><br><span class="line">  avahi-libs.x86_64 0:0.6.31-20.el7                             cairo.x86_64 0:1.15.12-4.el</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@elk-1 ~]# java -version</span><br><span class="line">openjdk version &quot;1.8.0_262&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_262-b10)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.262-b10, mixed mode)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="部署Elasticserach"><a href="#部署Elasticserach" class="headerlink" title="部署Elasticserach"></a>部署Elasticserach</h3><p>（1）三台主机安装Elasticserach（以第一台主机为例）</p>
<p>将提供的elasticsearch-6.0.0.rpm包分别上传至三台主机的/root目录下，并使用命令进行安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# ll</span><br><span class="line">total 27332</span><br><span class="line">-rw-------. 1 root root     6880 Oct 30  2020 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root 27970243 Nov 27 02:52 elasticsearch-6.0.0.rpm</span><br><span class="line">-rw-------. 1 root root     6587 Oct 30  2020 original-ks.cfg</span><br><span class="line">[root@elk-1 ~]# rpm -ivh elasticsearch-6.0.0.rpm </span><br><span class="line">warning: elasticsearch-6.0.0.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Creating elasticsearch group... OK</span><br><span class="line">Creating elasticsearch user... OK</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:elasticsearch-0:6.0.0-1          ################################# [100%]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using systemd</span></span></span><br><span class="line"> sudo systemctl daemon-reload</span><br><span class="line"> sudo systemctl enable elasticsearch.service</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## You can start elasticsearch service by executing</span></span></span><br><span class="line"> sudo systemctl start elasticsearch.service</span><br></pre></td></tr></table></figure>

<p>（2）三台主机分别配置Elasticserach</p>
<p>配置elasticsearch的配置文件，配置文件在/etc/elasticsearch/elasticsearch.yml。</p>
<p>elk-1节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# vi /etc/elasticsearch/elasticsearch.yml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">---------------------------------- Cluster -----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use a descriptive name for your cluster:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">cluster.name: ELK          //取消注释，配置elasticsearch集群名称</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ------------------------------------ Node ------------------------------------</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use a descriptive name for the node:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">node.name: elk-1         //配置节点名，默认随机指定一个name列表中名字，该列表在Elasticserach的jar包中config文件夹里name.txt文件中</span></span><br><span class="line">node.master: true        //添加指定该节点是否有资格被选举成为node</span><br><span class="line">node.data: false      //指定该节点是否有资格被选举成为node，Elasticserach是默认集群中的第一台机器为master，如果这台机挂了就会重新选举master，其他两节点为false。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">----------------------------------- Paths ------------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">path.data: /var/lib/elasticsearch        //配置索引数据存储位置(保持默认,不要开启注释)。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Path to log files:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">path.logs: /var/log/elasticsearch      //设置日志文件的存储路径，默认是Elasticserach根目录下的logs文件夹。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">---------------------------------- Network -----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">network.host: 172.128.11.10    //设置绑定的ip地址，可以是ipv4或ipv6的，默认为0.0.0.0。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set a custom port for HTTP:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">http.port: 9200           //启动的Elasticserach对外访问的http端口，默认9200</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--------------------------------- Discovery ----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Pass an initial list of hosts to perform discovery when new node is started:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The default list of hosts is [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;[::1]&quot;</span>]</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#discovery.zen.ping.unicast.hosts: [&quot;host1&quot;, &quot;host2&quot;]</span></span></span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;elk-1&quot;,&quot;elk-2&quot;,&quot;elk-3&quot;]   //设置集群中master节点的初始列表，可以通过这些节点来自动发现新加入集群的节点。</span><br></pre></td></tr></table></figure>

<p>elk-2节点（参数说明不再详细写出）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-2 ~]# vi /etc/elasticsearch/elasticsearch.yml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">---------------------------------- Cluster -----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use a descriptive name for your cluster:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">cluster.name: ELK</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ------------------------------------ Node ------------------------------------</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use a descriptive name for the node:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">node.name: elk-2</span></span><br><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">----------------------------------- Paths ------------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">path.data: /var/lib/elasticsearch</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Path to log files:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">path.logs: /var/log/elasticsearch。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">---------------------------------- Network -----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">network.host: 172.128.11.17</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set a custom port for HTTP:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">http.port: 9200</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--------------------------------- Discovery ----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Pass an initial list of hosts to perform discovery when new node is started:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The default list of hosts is [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;[::1]&quot;</span>]</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#discovery.zen.ping.unicast.hosts: [&quot;host1&quot;, &quot;host2&quot;]</span></span></span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;elk-1&quot;,&quot;elk-2&quot;,&quot;elk-3&quot;]</span><br></pre></td></tr></table></figure>

<p>elk-3节点（参数说明不再详细写出）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-3 ~]# vi /etc/elasticsearch/elasticsearch.yml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">---------------------------------- Cluster -----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use a descriptive name for your cluster:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">cluster.name: ELK</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ------------------------------------ Node ------------------------------------</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use a descriptive name for the node:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">node.name: elk-3</span></span><br><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">----------------------------------- Paths ------------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">path.data: /var/lib/elasticsearch</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Path to log files:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">path.logs: /var/log/elasticsearch。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">---------------------------------- Network -----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">network.host: 172.128.11.11</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set a custom port for HTTP:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">http.port: 9200</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--------------------------------- Discovery ----------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Pass an initial list of hosts to perform discovery when new node is started:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The default list of hosts is [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;[::1]&quot;</span>]</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#discovery.zen.ping.unicast.hosts: [&quot;host1&quot;, &quot;host2&quot;]</span></span></span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;elk-1&quot;,&quot;elk-2&quot;,&quot;elk-3&quot;]</span><br></pre></td></tr></table></figure>

<p>（3）三台主机启动服务（以第一台节点为例）</p>
<p>使用命令启动服务，并设置开机自启，最后使用命令查看进行及端口号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# systemctl start elasticsearch</span><br><span class="line">[root@elk-1 ~]# systemctl  enable elasticsearch</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/elasticsearch.service to /usr/lib/systemd/system/elasticsearch.service.</span><br><span class="line">[root@elk-1 ~]# ps -ef |grep elasticsearch</span><br><span class="line">elastic+ 15943     1 90 07:46 ?        00:00:11 /bin/java -Xms1g -Xmx1g -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+AlwaysPreTouch -server -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/lib/elasticsearch -Des.path.home=/usr/share/elasticsearch -Des.path.conf=/etc/elasticsearch -cp /usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch -p /var/run/elasticsearch/elasticsearch.pid --quiet</span><br><span class="line">root     16023 15676  0 07:47 pts/0    00:00:00 grep --color=auto elasticsearch</span><br><span class="line">[root@elk-1 ~]# netstat -ntpl</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address          Foreign Address     State     PID/Program name </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*          LISTEN      1268/sshd     </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*          LISTEN      1139/master   </span><br><span class="line">tcp        0      0 0.0.0.0:111             0.0.0.0:*          LISTEN      565/rpcbind   </span><br><span class="line">tcp6       0      0 172.128.11.10:9300      :::*               LISTEN      15943/java     </span><br><span class="line">tcp6       0      0 :::22                   :::*               LISTEN      1268/sshd     </span><br><span class="line">tcp6       0      0 ::1:25                  :::*               LISTEN      1139/master   </span><br><span class="line">tcp6       0      0 :::111                  :::*               LISTEN      565/rpcbind   </span><br><span class="line">tcp6       0      0 172.128.11.10:9200      :::*               LISTEN      15943/java</span><br></pre></td></tr></table></figure>

<p>三台主机如果有进程存在或者能够发现9200和9300端口暴露，则服务启动成功。</p>
<p>（4）检查集群状态</p>
<p>elk-1节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]#  curl &#x27;172.128.11.10:9200/_cluster/health?pretty&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;cluster_name&quot; : &quot;ELK&quot;,   //集群名称</span><br><span class="line">  &quot;status&quot; : &quot;green&quot;,   //集群健康状态，green为健康，yellow或者red则是集群有问题</span><br><span class="line">  &quot;timed_out&quot; : false   //是否超时,</span><br><span class="line">  &quot;number_of_nodes&quot; : 3,   //集群中节点数</span><br><span class="line">  &quot;number_of_data_nodes&quot; : 2,   //集群中data节点数量</span><br><span class="line">  &quot;active_primary_shards&quot; : 0,</span><br><span class="line">  &quot;active_shards&quot; : 0,</span><br><span class="line">  &quot;relocating_shards&quot; : 0,</span><br><span class="line">  &quot;initializing_shards&quot; : 0,</span><br><span class="line">  &quot;unassigned_shards&quot; : 0,</span><br><span class="line">  &quot;delayed_unassigned_shards&quot; : 0,</span><br><span class="line">  &quot;number_of_pending_tasks&quot; : 0,</span><br><span class="line">  &quot;number_of_in_flight_fetch&quot; : 0,</span><br><span class="line">  &quot;task_max_waiting_in_queue_millis&quot; : 0,</span><br><span class="line">  &quot;active_shards_percent_as_number&quot; : 100.0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="部署Kibana"><a href="#部署Kibana" class="headerlink" title="部署Kibana"></a>部署Kibana</h3><p>（1）第一台主机安装kibana</p>
<p>将提供的kibana-6.0.0-x86_64.rpm包上传至第一台主机的/root目录下，其他主机无需上传，并使用命令进行安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# rpm -ivh kibana-6.0.0-x86_64.rpm </span><br><span class="line">warning: kibana-6.0.0-x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:kibana-6.0.0-1                   ################################# [100%]</span><br></pre></td></tr></table></figure>

<p>（2）配置Kibana</p>
<p>配置kibana的配置文件，配置文件在/etc/kibana/kibana.yml，在配置文件增加或修改以下内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# cat /etc/kibana/kibana.yml |grep -v ^#</span><br><span class="line">server.port: 5601              </span><br><span class="line">server.host: 172.128.11.10      </span><br><span class="line">elasticsearch.url: &quot;http://172.128.11.10:9200&quot;</span><br></pre></td></tr></table></figure>

<p>（3）启动Kibana</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# systemctl  start kibana</span><br><span class="line">[root@elk-1 ~]# systemctl  enable  kibana</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/kibana.service to /etc/systemd/system/kibana.service.</span><br><span class="line">[root@elk-1 ~]# ps -ef |grep kibana</span><br><span class="line">kibana   16141     1  9 08:26 ?        00:00:03 /usr/share/kibana/bin/../node/bin/node --no-warnings /usr/share/kibana/bin/../src/cli -c /etc/kibana/kibana.yml</span><br><span class="line">root     16192 15676  0 08:27 pts/0    00:00:00 grep --color=auto kibana</span><br><span class="line">[root@elk-1 ~]# netstat  -ntpl</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address         Foreign Address     State      PID/Program name </span><br><span class="line">tcp        0      0 0.0.0.0:22            0.0.0.0:*           LISTEN      1268/sshd       </span><br><span class="line">tcp        0      0 127.0.0.1:25          0.0.0.0:*           LISTEN      1139/master     </span><br><span class="line">tcp        0      0 172.128.11.10:5601    0.0.0.0:*           LISTEN      16141/node     </span><br><span class="line">tcp        0      0 0.0.0.0:111           0.0.0.0:*           LISTEN      565/rpcbind     </span><br><span class="line">tcp6       0      0 172.128.11.10:9300    :::*                LISTEN      15943/java     </span><br><span class="line">tcp6       0      0 :::22                 :::*                LISTEN      1268/sshd       </span><br><span class="line">tcp6       0      0 ::1:25                :::*                LISTEN      1139/master     </span><br><span class="line">tcp6       0      0 :::111                :::*                LISTEN      565/rpcbind     </span><br><span class="line">tcp6       0      0 172.128.11.10:9200    :::*                LISTEN      15943/java </span><br></pre></td></tr></table></figure>

<p>启动后如果有进程或者能够发现5601端口暴露则服务启动成功，并可以通过浏览器访问地址<a target="_blank" rel="noopener" href="http://172.128.11.10:5601/%EF%BC%8C%E8%83%BD%E5%A4%9F%E7%9C%8B%E5%88%B0%E5%A6%82%E5%9B%BE1%E6%89%80%E7%A4%BA%E9%A1%B5%E9%9D%A2%E3%80%82">http://172.128.11.10:5601/，能够看到如图1所示页面。</a></p>
<p><img src="../../../../images/DX/66.png" alt="66"></p>
<p>图1 浏览器访问地址</p>
<hr>
<h3 id="部署Logstash"><a href="#部署Logstash" class="headerlink" title="部署Logstash"></a>部署Logstash</h3><p>（1）安装Logstash</p>
<p>将提供的logstash-6.0.0.rpm包上传到第二台主机的/root目录下，其他主机无需上传，并使用命令进行安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-2 ~]# ll</span><br><span class="line">total 137968</span><br><span class="line">-rw-------. 1 root root      6880 Oct 30  2020 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root  27970243 Feb 10 07:06 elasticsearch-6.0.0.rpm</span><br><span class="line">-rw-r--r--. 1 root root 113288712 Feb 10 08:49 logstash-6.0.0.rpm</span><br><span class="line">-rw-------. 1 root root      6587 Oct 30  2020 original-ks.cfg</span><br><span class="line">[root@elk-2 ~]# rpm -ivh logstash-6.0.0.rpm </span><br><span class="line">warning: logstash-6.0.0.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY</span><br><span class="line">Preparing...                          ################################# [100%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   1:logstash-1:6.0.0-1               ################################# [100%]</span><br><span class="line">Using provided startup.options file: /etc/logstash/startup.options</span><br><span class="line">Successfully created system startup script for Logstash</span><br></pre></td></tr></table></figure>

<p>（2）配置Logstash</p>
<p>配置/etc/logstash/logstash.yml，修改增加第190行如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-2 ~]# vi /etc/logstash/logstash.yml</span><br><span class="line">http.host: &quot;172.128.11.17&quot;   //第二台主机名称</span><br></pre></td></tr></table></figure>

<p>配置logstash收集syslog日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-2 ~]# vi /etc/logstash/conf.d/syslog.conf</span><br><span class="line">input &#123;</span><br><span class="line">    file &#123;</span><br><span class="line">        path =&gt; &quot;/var/log/messages&quot;</span><br><span class="line">        type =&gt; &quot;systemlog&quot;</span><br><span class="line">        start_position =&gt; &quot;beginning&quot;</span><br><span class="line">        stat_interval =&gt; &quot;3&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">    if [type] == &quot;systemlog&quot; &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">            hosts =&gt; [&quot;172.128.11.10:9200&quot;]    //这里的地址为第一台主机地址</span><br><span class="line">            index =&gt; &quot;system-log-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>检测配置文件是否错误：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-2 ~]# chmod  644 /var/log/messages    //给这个文件赋权限，如果不给权限，则无法读取日志</span><br><span class="line">[root@elk-2 ~]# ln -s /usr/share/logstash/bin/logstash /usr/bin</span><br><span class="line">[root@elk-2 ~]# logstash --path.settings /etc/logstash/ -f /etc/logstash/conf.d/syslog.conf --config.test_and_exit</span><br><span class="line">Sending Logstash&#x27;s logs to /var/log/logstash which is now configured via log4j2.properties</span><br><span class="line">Configuration OK      //结果显示OK则证明没问题</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<p>● –path.settings 用于指定logstash的配置文件所在的目录</p>
<p>● -f 指定需要被检测的配置文件的路径</p>
<p>● –config.test_and_exit 指定检测完之后就退出，不然就会直接启动了</p>
<p>（3）启动Logstash</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-2 ~]# systemctl start logstash</span><br><span class="line">[root@elk-2 ~]# ps -ef |grep logstash</span><br><span class="line">logstash 17891     1 99 09:06 ?        00:00:18 /bin/java -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+DisableExplicitGC -Djava.awt.headless=true -Dfile.encoding=UTF-8 -XX:+HeapDumpOnOutOfMemoryError -Xmx1g -Xms256m -Xss2048k -Djffi.boot.library.path=/usr/share/logstash/vendor/jruby/lib/jni -Xbootclasspath/a:/usr/share/logstash/vendor/jruby/lib/jruby.jar -classpath : -Djruby.home=/usr/share/logstash/vendor/jruby -Djruby.lib=/usr/share/logstash/vendor/jruby/lib -Djruby.script=jruby -Djruby.shell=/bin/sh org.jruby.Main /usr/share/logstash/lib/bootstrap/environment.rb logstash/runner.rb --path.settings /etc/logstash</span><br><span class="line">root     17927 15677  0 09:06 pts/0    00:00:00 grep --color=auto logstash</span><br><span class="line">[root@elk-2 ~]# netstat -lnpt</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address         Foreign Address      State     PID/Program name </span><br><span class="line">tcp        0      0 0.0.0.0:22            0.0.0.0:*            LISTEN      1273/sshd     </span><br><span class="line">tcp        0      0 127.0.0.1:25          0.0.0.0:*            LISTEN      1084/master   </span><br><span class="line">tcp        0      0 0.0.0.0:111           0.0.0.0:*            LISTEN      580/rpcbind   </span><br><span class="line">tcp6       0      0 172.128.11.17:9200    :::*                 LISTEN      15918/java     </span><br><span class="line">tcp6       0      0 172.128.11.17:9300    :::*                 LISTEN      15918/java     </span><br><span class="line">tcp6       0      0 :::22                 :::*                 LISTEN      1273/sshd     </span><br><span class="line">tcp6       0      0 ::1:25                :::*                 LISTEN      1084/master   </span><br><span class="line">tcp6       0      0 :::111                :::*                 LISTEN      580/rpcbind </span><br></pre></td></tr></table></figure>

<p>如果启动服务后，有进程但是没有9600端口，是因为权限问题，之前我们以root的身份在终端启动过logstash，所以产生的相关文件的属组属主都是root，解决方法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-2 ~]# ll /var/lib/logstash/</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 2 root root 6 Feb 10 09:00 dead_letter_queue</span><br><span class="line">drwxr-xr-x. 2 root root 6 Feb 10 09:00 queue</span><br><span class="line">[root@elk-2 ~]# chown -R logstash /var/lib/logstash/</span><br><span class="line">[root@elk-2 ~]# ll /var/lib/logstash/</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 2 logstash root 6 Feb 10 09:00 dead_letter_queue</span><br><span class="line">drwxr-xr-x. 2 logstash root 6 Feb 10 09:00 queue</span><br><span class="line">[root@elk-2 ~]# systemctl restart logstash</span><br><span class="line">[root@elk-2 ~]# netstat -lnpt</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address          Foreign Address     State     PID/Program name </span><br><span class="line">tcp        0      0 0.0.0.0:22             0.0.0.0:*           LISTEN     1273/sshd       </span><br><span class="line">tcp        0      0 127.0.0.1:25           0.0.0.0:*           LISTEN     1084/master     </span><br><span class="line">tcp        0      0 0.0.0.0:111            0.0.0.0:*           LISTEN     580/rpcbind     </span><br><span class="line">tcp6       0      0 172.128.11.17:9200     :::*                LISTEN     15918/java     </span><br><span class="line">tcp6       0      0 172.128.11.17:9300     :::*                LISTEN     15918/java     </span><br><span class="line">tcp6       0      0 :::22                  :::*                LISTEN     1273/sshd       </span><br><span class="line">tcp6       0      0 ::1:25                 :::*                LISTEN     1084/master     </span><br><span class="line">tcp6       0      0 172.128.11.17:9600     :::*                LISTEN     18724/java     </span><br><span class="line">tcp6       0      0 :::111                 :::*                LISTEN     580/rpcbind</span><br></pre></td></tr></table></figure>

<p>启动完毕后，让syslog产生日志，用第三台主机登录elk-2机器，登录后退出。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-3 ~]# ssh elk-2</span><br><span class="line">The authenticity of host &#x27;elk-2 (172.128.11.17)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:nJT1L6Cz5MvNxC/ib2Rk+WN6Q/a3E3yi/67VwVOjt5k.</span><br><span class="line">ECDSA key fingerprint is MD5:10:0c:b0:88:e6:03:76:cb:53:0b:ea:97:5e:b7:8f:10.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &#x27;elk-2,172.128.11.17&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">root@elk-2&#x27;s password: </span><br><span class="line">Last login: Thu Feb 10 01:34:28 2022 from 192.168.0.112</span><br><span class="line">[root@elk-2 ~]# </span><br><span class="line">[root@elk-2 ~]# logout</span><br><span class="line">Connection to elk-2 closed.</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Kibana检索日志"><a href="#Kibana检索日志" class="headerlink" title="Kibana检索日志"></a>Kibana检索日志</h3><p>（1）Kibana上查看日志</p>
<p>之前部署kibana完成后，还没有检索日志。现在logstash部署完成，我们回到第一台主机上查看日志索引，执行命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# curl &#x27;172.128.11.17:9200/_cat/indices?v&#x27;</span><br><span class="line">health status index                 uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span><br><span class="line">green  open   system-log-2022.02.10 E6kpwHcdRmy8iO42S3zlTg   5   1      20933            0      7.9mb          3.9mb</span><br><span class="line">green  open   .kibana               OdfKD6JFTx-pPwfJNZtpLA   1   1          1            0      7.3kb          3.6kb</span><br></pre></td></tr></table></figure>

<p>获取\删除指定索引详细信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-1 ~]# curl -XGET/DELETE &#x27;172.128.11.17:9200/system-log-2022.02.10?pretty&#x27;    //此处的system-log-2022.02.10是上面步骤查看出的日志索引名称</span><br><span class="line">&#123;</span><br><span class="line">  &quot;system-log-2022.02.10&quot; : &#123;</span><br><span class="line">    &quot;aliases&quot; : &#123; &#125;,</span><br><span class="line">    &quot;mappings&quot; : &#123;</span><br><span class="line">      &quot;systemlog&quot; : &#123;</span><br><span class="line">        &quot;properties&quot; : &#123;</span><br><span class="line">          &quot;@timestamp&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;date&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;@version&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot; : &#123;</span><br><span class="line">              &quot;keyword&quot; : &#123;</span><br><span class="line">                &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot; : 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;host&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot; : &#123;</span><br><span class="line">              &quot;keyword&quot; : &#123;</span><br><span class="line">                &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot; : 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;message&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot; : &#123;</span><br><span class="line">              &quot;keyword&quot; : &#123;</span><br><span class="line">                &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot; : 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;path&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot; : &#123;</span><br><span class="line">              &quot;keyword&quot; : &#123;</span><br><span class="line">                &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot; : 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;type&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot; : &#123;</span><br><span class="line">              &quot;keyword&quot; : &#123;</span><br><span class="line">                &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot; : 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1644484128903&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;5&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;E6kpwHcdRmy8iO42S3zlTg&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6000099&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;system-log-2022.02.10&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）Web页面配置</p>
<p>浏览器访问172.128.11.10:5601，到kibana上配置，索引的目录为:system-log-2022.02.10，修改完成后点击“Create”按钮，如图2所示。</p>
<p><img src="../../../../images/DX/67.png" alt="67"></p>
<p>图2 浏览器访问页面</p>
<p>配置完成后，点击左上角的“Discover”，进入“Discover”页面后如果出现以下提示，则是代表无法查找到日志信息，如图3所示。</p>
<p><img src="../../../../images/DX/68.png" alt="68"></p>
<p>图3 进入Discover页面</p>
<p>这种情况一般是时间的问题，可以点击右上角切换成查看当天的日志信息，如图4所示。</p>
<p><img src="../../../../images/DX/69.png" alt="69"></p>
<p>图4 查看当天的日志信息</p>
<p>更改完成后，可以看到，Kibana服务已经成功检索主机的日志信息，并反馈在页面。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/08/10/DX-Linux%E7%B3%BB%E7%BB%9F%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B/">http://example.com/2023/08/10/DX-Linux系统集群部署应用案例/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OpenStack/">OpenStack</a></div><div class="post_share"><div class="social-share" data-image="/../images/TITLE/linux4.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/10/DX-OpenStack%E7%A7%81%E6%9C%89%E4%BA%91%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(6)OpenStack私有云应用部署案例"><img class="cover" src="/../images/TITLE/openstack1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">私有云：(6)OpenStack私有云应用部署案例</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/10/DX-Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98%E6%A1%88%E4%BE%8B/" title="私有云：(8)Linux系统调优案例"><img class="cover" src="/../images/TITLE/linux5.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">私有云：(8)Linux系统调优案例</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/10/DX-Ansible%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(11)Ansible集群服务部署案例"><img class="cover" src="/../images/TITLE/ansible.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(11)Ansible集群服务部署案例</div></div></a></div><div><a href="/2023/08/10/DX-Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98%E6%A1%88%E4%BE%8B/" title="私有云：(8)Linux系统调优案例"><img class="cover" src="/../images/TITLE/linux5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(8)Linux系统调优案例</div></div></a></div><div><a href="/2023/08/10/DX-OpenStack%E5%B9%B3%E5%8F%B0%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/" title="私有云：(9)OpenStack平台安全管理与优化案例"><img class="cover" src="/../images/TITLE/openstack2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(9)OpenStack平台安全管理与优化案例</div></div></a></div><div><a href="/2023/08/10/DX-OpenStack%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(2)OpenStack基础平台部署案例"><img class="cover" src="/../images/TITLE/openstack2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(2)OpenStack基础平台部署案例</div></div></a></div><div><a href="/2023/08/10/DX-OpenStack%E7%A7%81%E6%9C%89%E4%BA%91%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(6)OpenStack私有云应用部署案例"><img class="cover" src="/../images/TITLE/openstack1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(6)OpenStack私有云应用部署案例</div></div></a></div><div><a href="/2023/08/10/DX-OpenStack%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4%E6%A1%88%E4%BE%8B/" title="私有云：(5)OpenStack服务运维案例"><img class="cover" src="/../images/TITLE/openstack5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(5)OpenStack服务运维案例</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/TITLE/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">案例描述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%92%E8%8A%82%E7%82%B9"><span class="toc-number">1.0.1.</span> <span class="toc-text">规划节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%87%86%E5%A4%87"><span class="toc-number">1.0.2.</span> <span class="toc-text">基础准备</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%96%BD"><span class="toc-number">2.</span> <span class="toc-text">案例实施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ELK%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.0.1.</span> <span class="toc-text">ELK日志分析系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ELK%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84"><span class="toc-number">2.0.2.</span> <span class="toc-text">ELK常见架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.0.3.</span> <span class="toc-text">基础环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Elasticserach"><span class="toc-number">2.0.4.</span> <span class="toc-text">部署Elasticserach</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Kibana"><span class="toc-number">2.0.5.</span> <span class="toc-text">部署Kibana</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Logstash"><span class="toc-number">2.0.6.</span> <span class="toc-text">部署Logstash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kibana%E6%A3%80%E7%B4%A2%E6%97%A5%E5%BF%97"><span class="toc-number">2.0.7.</span> <span class="toc-text">Kibana检索日志</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/01/SRE-kvm/" title="企业级Linux虚拟化KVM"><img src="/../images/SRE/day41/21.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="企业级Linux虚拟化KVM"/></a><div class="content"><a class="title" href="/2025/04/01/SRE-kvm/" title="企业级Linux虚拟化KVM">企业级Linux虚拟化KVM</a><time datetime="2025-04-01T09:21:21.000Z" title="发表于 2025-04-01 17:21:21">2025-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/26/SRE-zabbix/" title="企业级监控系统ZABBIX"><img src="/../images/SRE/day38/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="企业级监控系统ZABBIX"/></a><div class="content"><a class="title" href="/2025/03/26/SRE-zabbix/" title="企业级监控系统ZABBIX">企业级监控系统ZABBIX</a><time datetime="2025-03-26T14:26:34.000Z" title="发表于 2025-03-26 22:26:34">2025-03-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/17/SRE-Tomcat/" title="企业级Web应用服务器TOMCAT"><img src="/../images/SRE/day33/24.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="企业级Web应用服务器TOMCAT"/></a><div class="content"><a class="title" href="/2025/03/17/SRE-Tomcat/" title="企业级Web应用服务器TOMCAT">企业级Web应用服务器TOMCAT</a><time datetime="2025-03-17T09:45:17.000Z" title="发表于 2025-03-17 17:45:17">2025-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/03/SRE-jumpserver/" title="企业级堡垒机JumpServer"><img src="https://www.jumpserver.org/images/logo/logo-dark-JumpServer.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="企业级堡垒机JumpServer"/></a><div class="content"><a class="title" href="/2025/03/03/SRE-jumpserver/" title="企业级堡垒机JumpServer">企业级堡垒机JumpServer</a><time datetime="2025-03-03T11:41:44.000Z" title="发表于 2025-03-03 19:41:44">2025-03-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="../images/BEIAN/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="../images/BEIAN/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>