<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL | Blog</title><meta name="author" content="W"><meta name="copyright" content="W"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="MySQL适用与中小规模、关系型数据库系统,支持Linux、Unix、Windows等多种操作系统">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="http://example.com/2023/04/13/tedu-MySQL/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="MySQL适用与中小规模、关系型数据库系统,支持Linux、Unix、Windows等多种操作系统">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/title/mysql.jpg">
<meta property="article:published_time" content="2023-04-12T16:00:00.000Z">
<meta property="article:modified_time" content="2024-10-12T23:59:44.745Z">
<meta property="article:author" content="W">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/title/mysql.jpg"><link rel="shortcut icon" href="/../jihu/wallpaper/used/user.jpg"><link rel="canonical" href="http://example.com/2023/04/13/tedu-MySQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-13 07:59:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../jihu/wallpaper/used/user.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/title/mysql.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Blog"><span class="site-name">Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-12T16:00:00.000Z" title="发表于 2023-04-13 00:00:00">2023-04-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-12T23:59:44.745Z" title="更新于 2024-10-13 07:59:44">2024-10-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E9%87%8C%E9%9B%BE%E9%87%8C/">云里雾里</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>83分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MySQL基础"><a href="#MySQL基础" class="headerlink" title="MySQL基础"></a>MySQL基础</h1><p>数据库：存储数据的仓库</p>
<p>常见软件</p>
<p>主流操作系统： Unix、Linux、Windows</p>
<table>
<thead>
<tr>
<th>软件名</th>
<th>开源</th>
<th>跨平台</th>
<th>厂商</th>
</tr>
</thead>
<tbody><tr>
<td>Oracle</td>
<td>否</td>
<td>是</td>
<td>甲骨文</td>
</tr>
<tr>
<td>MySQL</td>
<td>是</td>
<td>是</td>
<td>甲骨文</td>
</tr>
<tr>
<td>SOL Server</td>
<td>否</td>
<td>否</td>
<td>微软</td>
</tr>
<tr>
<td>DB2</td>
<td>否</td>
<td>是</td>
<td>IBM</td>
</tr>
<tr>
<td>Redis</td>
<td>是</td>
<td>是</td>
<td>开源软件</td>
</tr>
<tr>
<td>Memcached</td>
<td>是</td>
<td>是</td>
<td>开源软件</td>
</tr>
<tr>
<td>MongoDB</td>
<td>是</td>
<td>是</td>
<td>开源软件</td>
</tr>
</tbody></table>
<h2 id="专业术语"><a href="#专业术语" class="headerlink" title="专业术语"></a>专业术语</h2><ul>
<li><p>DB</p>
<p>数据库</p>
<p>依照某种数据模型进行组织并存放到存储器的数据集合</p>
</li>
<li><p>DBMS（DataBase Management System）</p>
<p>数据库管理系统</p>
<p>用来操作和管理数据库的服务软件</p>
</li>
<li><p>DBS（DataBase System）</p>
<p>数据库系统：及DB+DBMS</p>
<p>指带有数据库并整合了数据库管理软件的计算机系统</p>
</li>
</ul>
<h2 id="MySQL介绍"><a href="#MySQL介绍" class="headerlink" title="MySQL介绍"></a>MySQL介绍</h2><h3 id="起源与发展"><a href="#起源与发展" class="headerlink" title="起源与发展"></a>起源与发展</h3><ul>
<li><p>应用最广泛的开源数据库软件</p>
<p>-最早隶属于瑞典的MySQL AB公司</p>
<p>-2008年1月，MySQL AB被Sun收购</p>
<p>-2009年4月，Sun被Oracle收购</p>
</li>
<li><p>崭新的开源分支MariaDB</p>
<p>-为应付MySQL可能会闭源的风险而诞生</p>
<p>-由MySQL原作者Widenius主导开发</p>
<p>-与MySQL保持最大程度兼容</p>
</li>
</ul>
<h3 id="特点与应用"><a href="#特点与应用" class="headerlink" title="特点与应用"></a>特点与应用</h3><ul>
<li><p>主要特点</p>
<p>-适用与中小规模、关系型数据库系统</p>
<p>-支持Linux、Unix、Windows等多种操作系统</p>
<p>-支持Python、Java、Perl、PHP等编程语言</p>
</li>
<li><p>典型应用环境</p>
<p>-LAMP平台，与Apache HTTP Server组合</p>
<p>-LNMP平台，与Nginx组合</p>
</li>
</ul>
<p>官网地址：<a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/mysql">http://dev.mysql.com/downloads/mysql</a></p>
<h2 id="安装MySQL软件、启动服务"><a href="#安装MySQL软件、启动服务" class="headerlink" title="安装MySQL软件、启动服务"></a>安装MySQL软件、启动服务</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># tar -xvf mysql-5.7.17.tar</span></span><br><span class="line">[root@master ~]<span class="comment"># cd mysql-5.7.17 &amp;&amp; yum install -y mysql-community-*.rpm</span></span><br><span class="line"><span class="comment">###启动服务并设置开机自启</span></span><br><span class="line">[root@master ~]<span class="comment"># systemctl enable --now mysqld</span></span><br><span class="line"><span class="comment">###查看服务信息</span></span><br><span class="line">[root@master ~]<span class="comment"># ss -ltunp |grep 3306</span></span><br><span class="line"><span class="comment">###查看进程</span></span><br><span class="line">[root@master ~]<span class="comment"># ps -C mysqld</span></span><br></pre></td></tr></table></figure>

<h3 id="通过yum安装"><a href="#通过yum安装" class="headerlink" title="通过yum安装"></a>通过yum安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># yum install mariadb-server -y</span></span><br><span class="line">[root@master ~]<span class="comment"># systemctl enable --now mariadb</span></span><br><span class="line">[root@master ~]<span class="comment"># mysql_secure_installation</span></span><br><span class="line"></span><br><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line"></span><br><span class="line">In order to <span class="built_in">log</span> into MariaDB to secure it, we<span class="string">&#x27;ll need the current</span></span><br><span class="line"><span class="string">password for the root user. If you&#x27;</span>ve just installed MariaDB, and</span><br><span class="line">you haven<span class="string">&#x27;t set the root password yet, the password will be blank,</span></span><br><span class="line"><span class="string">so you should just press enter here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter current password for root (enter for none):          #直接回车</span></span><br><span class="line"><span class="string">OK, successfully used password, moving on...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Setting the root password ensures that nobody can log into the MariaDB</span></span><br><span class="line"><span class="string">root user without the proper authorisation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Set root password? [Y/n] y                      #设置root密码</span></span><br><span class="line"><span class="string">New password: 000000</span></span><br><span class="line"><span class="string">Re-enter new password: 000000</span></span><br><span class="line"><span class="string">Password updated successfully!</span></span><br><span class="line"><span class="string">Reloading privilege tables..</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">By default, a MariaDB installation has an anonymous user, allowing anyone</span></span><br><span class="line"><span class="string">to log into MariaDB without having to have a user account created for</span></span><br><span class="line"><span class="string">them. This is intended only for testing, and to make the installation</span></span><br><span class="line"><span class="string">go a bit smoother. You should remove them before moving into a</span></span><br><span class="line"><span class="string">production environment.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Remove anonymous users? [Y/n] y</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Normally, root should only be allowed to connect from &#x27;</span>localhost<span class="string">&#x27;. This</span></span><br><span class="line"><span class="string">ensures that someone cannot guess at the root password from the network.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Disallow root login remotely? [Y/n] n</span></span><br><span class="line"><span class="string">... skipping.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">By default, MariaDB comes with a database named &#x27;</span><span class="built_in">test</span><span class="string">&#x27; that anyone can</span></span><br><span class="line"><span class="string">access. This is also intended only for testing, and should be removed</span></span><br><span class="line"><span class="string">before moving into a production environment.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Remove test database and access to it? [Y/n] y</span></span><br><span class="line"><span class="string">- Dropping test database...</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">- Removing privileges on test database...</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reloading the privilege tables will ensure that all changes made so far</span></span><br><span class="line"><span class="string">will take effect immediately.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reload privilege tables now? [Y/n] y</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Cleaning up...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">All done! If you&#x27;</span>ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks <span class="keyword">for</span> using MariaDB!</span><br></pre></td></tr></table></figure>

<h2 id="相关参数"><a href="#相关参数" class="headerlink" title="相关参数"></a>相关参数</h2><ul>
<li>软件安装好自动创建相关目录与文件</li>
</ul>
<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>/etc/my.cnf</td>
<td>主配置文件</td>
</tr>
<tr>
<td>/var/lib/mysql</td>
<td>数据库目录</td>
</tr>
<tr>
<td>默认端口号</td>
<td>3306</td>
</tr>
<tr>
<td>进程名</td>
<td>mysqld</td>
</tr>
<tr>
<td>传输协议</td>
<td>TCP</td>
</tr>
<tr>
<td>进程所有者</td>
<td>mysql</td>
</tr>
<tr>
<td>进程所属祖</td>
<td>mysql</td>
</tr>
<tr>
<td>错误日志文件</td>
<td>/var/log/mysqld.log</td>
</tr>
</tbody></table>
<h2 id="初始化配置"><a href="#初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h2><ul>
<li><p>数据库管理员名为root</p>
<p>-默认仅允许root本机连接</p>
<p>-首次登陆密码在安装软件时随机生成</p>
<p>-随机密码存储在日志文件/var/log/mysqld.log里</p>
<p>-连接命令 #mysql -h数据库地址 -u用户 -p密码</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查看随机密码</span></span><br><span class="line">[root@master ~]<span class="comment"># grep &quot;password&quot; /var/log/mysqld.log</span></span><br><span class="line">2017-04-18T07:29:27.643784Z 1 [Note] A temporary password is generated <span class="keyword">for</span> </span><br><span class="line">root@localhost: mtoa&gt;Av&lt;p6Yk</span><br><span class="line"></span><br><span class="line"><span class="comment">###连接</span></span><br><span class="line">[root@master ~]<span class="comment"># mysql -uroot -pmtoa&gt;Av&lt;p6Yk</span></span><br></pre></td></tr></table></figure>

<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><ul>
<li><p>具体操作如下：</p>
<p>-使用alter user命令修改登录密码</p>
<p>-新密码必须满足密码策略</p>
<p>-管理员root使用新密码连接</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###修改密码</span></span><br><span class="line">mysql&gt; alter user root@<span class="string">&quot;localhost&quot;</span> identified by <span class="string">&quot;密码&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">###使用新密码登录</span></span><br><span class="line">[root@master ~]<span class="comment"># mysql -uroot -p密码</span></span><br></pre></td></tr></table></figure>

<h3 id="修改密码策略"><a href="#修改密码策略" class="headerlink" title="修改密码策略"></a>修改密码策略</h3><table>
<thead>
<tr>
<th>策略名称</th>
<th>验证方式</th>
</tr>
</thead>
<tbody><tr>
<td>LOW（0）</td>
<td>长度</td>
</tr>
<tr>
<td>MENIUM（1）默认</td>
<td>长度，数字，小写/大写，特殊字符</td>
</tr>
<tr>
<td>STRONG（2）</td>
<td>长度，数字，小写/大写，特殊字符，字典文件</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查看变量</span></span><br><span class="line">mysql&gt; show variables like <span class="string">&quot;%password%&quot;</span>;</span><br><span class="line"><span class="comment">###修改密码策略</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_policy=0;</span><br><span class="line"><span class="comment">###修改密码长度</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_length=6;</span><br><span class="line"></span><br><span class="line"><span class="comment">###永久配置</span></span><br><span class="line">[root@master ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">validate_password_policy=0</span><br><span class="line">varidate_password_length=6</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure>

<h2 id="数据库基础"><a href="#数据库基础" class="headerlink" title="数据库基础"></a>数据库基础</h2><h3 id="连接方式"><a href="#连接方式" class="headerlink" title="连接方式"></a>连接方式</h3><ul>
<li><p>客户端连接MySQL服务的方法</p>
<p>-命令行</p>
<p>-图形工具软件（软件自带图形界面、web页面）</p>
<p>-编写脚本（php、java、python ······）</p>
</li>
<li><p>使用mysql命令</p>
<p>-mysql -h服务器IP -u用户名 -p密码</p>
<p>-quit或exit #退出</p>
</li>
</ul>
<h3 id="数据存储流程"><a href="#数据存储流程" class="headerlink" title="数据存储流程"></a>数据存储流程</h3><ul>
<li><p>客户端把数据存储到数据库服务器上的步骤</p>
<p>-连接数据库服务器</p>
<p>-创建数据库 #类似文件夹</p>
<p>-创建数据表 #类似文件</p>
<p>-插入数据 #类似文件内容</p>
<p>-断开连接</p>
</li>
</ul>
<h3 id="MySQL管理环境"><a href="#MySQL管理环境" class="headerlink" title="MySQL管理环境"></a>MySQL管理环境</h3><ul>
<li><p>SQL命令使用规则</p>
<p>-SQL命令不区分字母大小写（密码、变量值除外）</p>
<p>-每条SQL命令以 ; 结束</p>
<p>-默认命令不支持Tab键自动补齐</p>
<p>-\c 中止sql命令</p>
</li>
</ul>
<h3 id="SQL命令分类"><a href="#SQL命令分类" class="headerlink" title="SQL命令分类"></a>SQL命令分类</h3><ul>
<li><p>常用的SQL命令分类</p>
<p>-管理数据库使用SQL（结构化查寻语言）</p>
<p>-DDL 数据定义语言 如：create、alter、drop</p>
<p>-DML 数据操作语言 如：insert、update、delete</p>
<p>-DCL 数据控制语言 如：grant、revoke</p>
<p>-DTL 数据事务语言 如：commit、rollback、savepoint</p>
</li>
</ul>
<h3 id="MySQL基本操作"><a href="#MySQL基本操作" class="headerlink" title="MySQL基本操作"></a>MySQL基本操作</h3><h4 id="库管理命令"><a href="#库管理命令" class="headerlink" title="库管理命令"></a>库管理命令</h4><ul>
<li><p>库类似文件夹，用来存储表</p>
<p>-可以创建多个库，通过库名区分</p>
<p>-show databeses; #显示已有的库</p>
<p>-select user(); #显示连接用户</p>
<p>-use 库名; #切换库（进入数据库）</p>
<p>-select database(); #显示当前所在库</p>
<p>-create database 库名; #创建数据库</p>
<p>-show tables; #显示已有的表</p>
<p>-drop database 库名; #删除库</p>
</li>
<li><p>库名命名规则</p>
<p>-仅可以使用数字、字母、下划线、不能纯数字</p>
<p>-区分字母大小写，具有唯一性</p>
<p>-不能使用指令关键字、特殊字符</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database DB1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create database db1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="表管理命令"><a href="#表管理命令" class="headerlink" title="表管理命令"></a>表管理命令</h4><ul>
<li><p>建表</p>
<p>-表 存储数据的文件</p>
<p>Mysql&gt; create table 库名.表名(</p>
<p> 字段名1 类型(宽度),</p>
<p> 字段名2 类型(宽度),</p>
<p>)DEFAULT CHARSET=utf8; #指定中文字符集，可以给字段赋值中文</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; crate table db1.test(</span><br><span class="line">name char(15),</span><br><span class="line">homeaddr char(20), <span class="comment">#如果是最后一个字段要把逗号去掉</span></span><br><span class="line">······</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>表 类似与文件</li>
</ul>
<p>​     -desc 库名<code>.</code>表名 #查看表结构</p>
<p>​     -drop table 库名<code>.</code>表名  #删除表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.test;</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type     | Null | Key | Default | Extra |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| name     | char(15) | YES  |     |  NULL   |       |</span><br><span class="line">| homeaddr | char(20) | YES  |     |  NULL   |       |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; drop table db1.test;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure>

<h4 id="记录管理命令"><a href="#记录管理命令" class="headerlink" title="记录管理命令"></a>记录管理命令</h4><ul>
<li><p>记录类似于文件里的行</p>
<p>-select * from 库名<code>.</code>表名; #查看表记录</p>
<p>-insert into 库名<code>.</code>表名 values(值列表); #插入表记录</p>
<p>-update 库名<code>.</code>表名 set 字段=值; #修改表记录</p>
<p>-delete from 表名; #删除表记录</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###插入数据</span></span><br><span class="line">mysql&gt; insert into db1.test values(<span class="string">&quot;jim&quot;</span>,<span class="string">&quot;usa&quot;</span>),(<span class="string">&quot;bob&quot;</span>,<span class="string">&quot;china&quot;</span>);</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line">Records: 2 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看数据</span></span><br><span class="line">mysql&gt; select * from db1.test;</span><br><span class="line">+------+----------+</span><br><span class="line">| name | homeaddr |</span><br><span class="line">+------+----------+</span><br><span class="line">| jim  | usa      |</span><br><span class="line">| bob  | china    |</span><br><span class="line">+------+----------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###更新数据</span></span><br><span class="line">mysql&gt; update db1.test <span class="built_in">set</span> homeaddr=<span class="string">&quot;beijing&quot;</span> <span class="built_in">where</span> name=<span class="string">&quot;jim&quot;</span>; </span><br><span class="line">                                   <span class="comment">#where 用于指定需要修改的行不加默认为所有</span></span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1 Changed: 1 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test;</span><br><span class="line">+------+----------+</span><br><span class="line">| name | homeaddr |</span><br><span class="line">+------+----------+</span><br><span class="line">| jim  | beijing  |</span><br><span class="line">| bob  | china    |</span><br><span class="line">+------+----------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###删除数据</span></span><br><span class="line">MariaDB [(none)]&gt; delete from db1.test <span class="built_in">where</span> name=<span class="string">&quot;jim&quot;</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; select * from db1.test;</span><br><span class="line">+------+----------+</span><br><span class="line">| name | homeaddr |</span><br><span class="line">+------+----------+</span><br><span class="line">| bob  | china    |</span><br><span class="line">+------+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="字符类型"><a href="#字符类型" class="headerlink" title="字符类型"></a>字符类型</h2><ul>
<li><h2 id="定长：char-字符个数"><a href="#定长：char-字符个数" class="headerlink" title="定长：char(字符个数)"></a>定长：char(字符个数)</h2><p>-最大字符个数255</p>
<p>-不够指定字符个数时在右边用空格补全 </p>
<p> #假设设定为10个字符，而插入的数据为3个字符，就会在右边用7个空格补全到10字符</p>
<p>-字符个数超出时，无法写入数据</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.test;</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type     | Null | Key | Default | Extra |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| name     | char(15) | YES  |     | NULL    |       |</span><br><span class="line">| homeaddr | char(20) | YES  |     | NULL    |       |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###设定name字段为15个字符超出部分无法保存</span></span><br><span class="line"></span><br><span class="line">mysql&gt; insert into db1.test values(<span class="string">&quot;abcdefghijklmnop&quot;</span>,<span class="string">&quot;usa&quot;</span>);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into db1.test values(<span class="string">&quot;abcdefghijklmnopq&quot;</span>,<span class="string">&quot;usa&quot;</span>);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into db1.test values(<span class="string">&quot;abcdefghijklmnopqrst&quot;</span>,<span class="string">&quot;usa&quot;</span>);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into db1.test values(<span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>,<span class="string">&quot;usa&quot;</span><span class="string">&quot;);</span></span><br><span class="line"><span class="string">Query OK, 1 row affected, 1 warning (0.01 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MariaDB [(none)]&gt; select * from db1.test;</span></span><br><span class="line"><span class="string">+-----------------+----------+</span></span><br><span class="line"><span class="string">| name            | homeaddr |</span></span><br><span class="line"><span class="string">+-----------------+----------+</span></span><br><span class="line"><span class="string">| bob             | china    |</span></span><br><span class="line"><span class="string">| abcdefghijklmno | usa      |</span></span><br><span class="line"><span class="string">| abcdefghijklmno | usa      |</span></span><br><span class="line"><span class="string">| abcdefghijklmno | usa      |</span></span><br><span class="line"><span class="string">| abcdefghijklmno | usa      |</span></span><br><span class="line"><span class="string">+-----------------+----------+</span></span><br><span class="line"><span class="string">5 rows in set (0.00 sec)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="变长varchar-字符个数"><a href="#变长varchar-字符个数" class="headerlink" title="变长varchar(字符个数)"></a>变长varchar(字符个数)</h2><p>-按数据实际大小分配空间 #不会用空格补齐</p>
<p>-字符个数超出时，无法写入数据</p>
</li>
<li><h2 id="大文本类型：text-blob"><a href="#大文本类型：text-blob" class="headerlink" title="大文本类型：text/blob"></a>大文本类型：text/blob</h2><p>-字符数大于65535时使用</p>
</li>
</ul>
<h2 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h2><ul>
<li><h2 id="整数型"><a href="#整数型" class="headerlink" title="整数型"></a>整数型</h2><p>只能存整数</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>有符号范围</th>
<th>无符号范围</th>
</tr>
</thead>
<tbody><tr>
<td>tinyint</td>
<td>微小整数</td>
<td>-128~127</td>
<td>0~255</td>
</tr>
<tr>
<td>smallint</td>
<td>小整数</td>
<td>-32768~32767</td>
<td>0~65535</td>
</tr>
<tr>
<td>mediumint</td>
<td>中整型</td>
<td>-223~223-1</td>
<td>0~224-1</td>
</tr>
<tr>
<td>int</td>
<td>大整型</td>
<td>-231~231-1</td>
<td>0~232-1</td>
</tr>
<tr>
<td>bigint</td>
<td>极大整型</td>
<td>-264~263-1</td>
<td>0~264-1</td>
</tr>
<tr>
<td>unsigned</td>
<td>使用无符号存储范围</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><h2 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h2></li>
</ul>
<p>​     存储有小数点的数</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>有符号范围</th>
<th>无符号范围</th>
</tr>
</thead>
<tbody><tr>
<td>float</td>
<td>单精度</td>
<td>-3.402823466E+38 到 -1.175494351E-38</td>
<td>1.175494351E-38 到 3.402823466E+38</td>
</tr>
<tr>
<td>double</td>
<td>双精度</td>
<td>-1.7976931348623175E+308 到 -2.2250738585072014E-308</td>
<td>2.2250738585072014E-308 到 1.7976931348623157E+308</td>
</tr>
</tbody></table>
<p>1.175494351E-38 = 1.175494351 / 1038</p>
<p>1.175494351E+38 = 1.175494351E38 = 1.175494351 * 1038</p>
<h2 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h2><h3 id="类型关键字"><a href="#类型关键字" class="headerlink" title="类型关键字"></a>类型关键字</h3><ul>
<li><p>日期date</p>
<p>-范围：0001-01-01 ~ 9999-12-31</p>
<p>-格式：yyyymmdd 19491001</p>
</li>
<li><p>年year</p>
<p>-范围：1901-2155</p>
<p>-格式：yyyy 1998 2000</p>
</li>
<li><p>时间time</p>
<p>-格式 HHMMSS 221838</p>
</li>
<li><p>日期时间 datetime</p>
<p>-范围：1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</p>
<p>-格式：yyyymmddhhmmss</p>
</li>
<li><p>日期时间 timestamp</p>
<p>-范围： 1970-01-01 00:00:00 ~ 2038-01-19 00:00:00</p>
<p>-格式：yyyymmddhhmmss</p>
</li>
</ul>
<h3 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h3><table>
<thead>
<tr>
<th>类型</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>curtime()</td>
<td>获取当前系统的时间</td>
</tr>
<tr>
<td>curdate()</td>
<td>获取当前系统的日期</td>
</tr>
<tr>
<td>now()</td>
<td>获取当前系统的日期和时间</td>
</tr>
<tr>
<td>year()</td>
<td>获取年</td>
</tr>
<tr>
<td>month()</td>
<td>获取月</td>
</tr>
<tr>
<td>day()</td>
<td>获取日</td>
</tr>
<tr>
<td>date()</td>
<td>获取日期</td>
</tr>
<tr>
<td>time()</td>
<td>获取时间</td>
</tr>
</tbody></table>
<h3 id="关于日期时间字段"><a href="#关于日期时间字段" class="headerlink" title="关于日期时间字段"></a>关于日期时间字段</h3><p>-当未给timestamp字段赋值时，自动以当前系统时间赋值，而datetime值为NULL（空）</p>
<h3 id="year类型"><a href="#year类型" class="headerlink" title="year类型"></a>year类型</h3><p>-要求使用4位数赋值</p>
<p>-当使用2位数赋值时：01~99</p>
<p>-01<del>69视为 2001</del>2069</p>
<p>-70<del>99视为 1907</del>1999</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###timestamp和datetime字段最大字符数为6</span></span><br><span class="line">mysql&gt; create table db1.test3( name char(20), ts timestamp(6), <span class="built_in">date</span> datetime(6), yr year(20) );</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###给指定字段插入数据</span></span><br><span class="line">mysql&gt; insert into db1.test3(name,yr) values(<span class="string">&quot;bob&quot;</span>,55);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test3;</span><br><span class="line">+------+----------------------------+------+------+</span><br><span class="line">| name | ts                         | <span class="built_in">date</span> | yr   |</span><br><span class="line">+------+----------------------------+------+------+</span><br><span class="line">| bob  | 2023-03-11 19:44:35.292665 | NULL | 2055 |</span><br><span class="line">+------+----------------------------+------+------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><ul>
<li><p>enum 单选</p>
<p>-格式： 字段名 enum(值1，值2，值N)</p>
<p>-仅能在列表里选择一个值</p>
</li>
<li><p>set 多选</p>
<p>-格式：字段名 set(值1，值2，值N)</p>
<p>-在列表里选择一个或多个</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.test5( name char(10), sex enum(<span class="string">&quot;boy&quot;</span>,<span class="string">&quot;girl&quot;</span>,<span class="string">&quot;&quot;</span>others<span class="string">&quot;), </span></span><br><span class="line"><span class="string">likes set(&quot;</span>book<span class="string">&quot;,&quot;</span>tea<span class="string">&quot;,&quot;</span>ball<span class="string">&quot;,&quot;</span>game<span class="string">&quot;) );</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; insert into db1.test5 values(&quot;</span>bob<span class="string">&quot;,&quot;</span>boy<span class="string">&quot;,&quot;</span>book,tea,game<span class="string">&quot;);</span></span><br><span class="line"><span class="string">Query OK, 1 row affected (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; select * from db1.test5;</span></span><br><span class="line"><span class="string">+------+------+---------------+</span></span><br><span class="line"><span class="string">| name | sex  | likes         |</span></span><br><span class="line"><span class="string">+------+------+---------------+</span></span><br><span class="line"><span class="string">| bob  | boy  | book,tea,game |</span></span><br><span class="line"><span class="string">+------+------+---------------+</span></span><br><span class="line"><span class="string">1 row in set (0.01 sec)</span></span><br></pre></td></tr></table></figure>

<h1 id="约束条件，修改表结构"><a href="#约束条件，修改表结构" class="headerlink" title="约束条件，修改表结构"></a>约束条件，修改表结构</h1><h2 id="约束条件"><a href="#约束条件" class="headerlink" title="约束条件"></a>约束条件</h2><ul>
<li>作用：限制字段赋值</li>
<li>desc 库名<code>.</code>表名</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.test;</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type     | Null | Key | Default | Extra |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| name     | char(15) | YES  |     | NULL    |       |</span><br><span class="line">| homeaddr | char(20) | YES  |     | NULL    |       |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="设置约束条件"><a href="#设置约束条件" class="headerlink" title="设置约束条件"></a>设置约束条件</h3><ul>
<li>null 允许为空 （默认设置）</li>
<li>not null 不允许为空</li>
<li>key 键值类型</li>
<li>default 设置默认值，缺省为NULL</li>
<li>estra 额外设置</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.t1( </span><br><span class="line">name char(10) not null, </span><br><span class="line">age tinyint unsigned default 20, </span><br><span class="line">class char(20) not null default <span class="string">&quot;cloudcomputing2101&quot;</span>,</span><br><span class="line">pay <span class="built_in">float</span>(7,2) default 28000 );   <span class="comment">#float(7,2)一共7个字符保留两位小数 5位整数，2位小数</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into db1.t1(name) values(<span class="string">&quot;bob&quot;</span>);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.t1;</span><br><span class="line">+------+------+--------------------+----------+</span><br><span class="line">| name | age  |    class           | pay      |</span><br><span class="line">+------+------+--------------------+----------+</span><br><span class="line">| bob  | 20   | cloudcomputing2101 | 28000.00 |</span><br><span class="line">+------+------+--------------------+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h2><h3 id="语法结构"><a href="#语法结构" class="headerlink" title="语法结构"></a>语法结构</h3><ul>
<li><p>alter table 库名<code>.</code>表名 执行动作;</p>
<p>-add 添加字段</p>
<p>-modify 修改字段类型</p>
<p>-change 修改字段名</p>
<p>-drop 删除字段</p>
<p>-rename 修改表名</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.t2;</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type       | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">| name  | char(10)   | NO   |     | NULL    |       |</span><br><span class="line">| age   | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| class | char(20)   | NO   |     | 2101    |       |</span><br><span class="line">| pay   | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="添加新字段"><a href="#添加新字段" class="headerlink" title="添加新字段"></a>添加新字段</h2></li>
</ul>
<p>​     -新字段默认添加在字段末尾</p>
<p>​     -alter table 库名<code>.</code>表名</p>
<p>​      add 字段名 类型(宽度) 约束条件 [ after 字段名 | first ];</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table db1.t2 add sex enum(<span class="string">&quot;boy&quot;</span>,<span class="string">&quot;girl&quot;</span>) default <span class="string">&quot;boy&quot;</span> after name;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t2; </span><br><span class="line">+-------+--------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type               | Null | Key | Default | Extra |</span><br><span class="line">+-------+--------------------+------+-----+---------+-------+</span><br><span class="line">| name  | char(10)           | NO   |     | NULL    |       |</span><br><span class="line">| sex   | enum(<span class="string">&#x27;boy&#x27;</span>,<span class="string">&#x27;girl&#x27;</span>) | YES  |     | boy     |       |</span><br><span class="line">| age   | tinyint(4)         | YES  |     | 20      |       |</span><br><span class="line">| class | char(20)           | NO   |     | 2101    |       |</span><br><span class="line">| pay   | <span class="built_in">float</span>(4,2)         | YES  |     | 28.00   |       |</span><br><span class="line">+-------+--------------------+------+-----+---------+-------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="修改字段类型"><a href="#修改字段类型" class="headerlink" title="修改字段类型"></a>修改字段类型</h2></li>
</ul>
<p>​      -修改的字段类型不能与已存储的数据冲突</p>
<p>​     -alter table 库名<code>.</code>表名</p>
<p>​      modify 字段名 类型(宽度) 约束条件 [ after 字段名 | first ];</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table db1.t2 modify sex <span class="built_in">set</span>(<span class="string">&quot;boy&quot;</span>,<span class="string">&quot;girl&quot;</span>) not null default <span class="string">&quot;girl&quot;</span> first;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t2; </span><br><span class="line">+-------+-------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type              | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------------+------+-----+---------+-------+</span><br><span class="line">| sex   | <span class="built_in">set</span>(<span class="string">&#x27;boy&#x27;</span>,<span class="string">&#x27;girl&#x27;</span>) | NO   |     | girl    |       |</span><br><span class="line">| name  | char(10)          | NO   |     | NULL    |       |</span><br><span class="line">| age   | tinyint(4)        | YES  |     | 20      |       |</span><br><span class="line">| class | char(20)          | NO   |     | 2101    |       |</span><br><span class="line">| pay   | <span class="built_in">float</span>(4,2)        | YES  |     | 28.00   |       |</span><br><span class="line">+-------+-------------------+------+-----+---------+-------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="删除字段"><a href="#删除字段" class="headerlink" title="删除字段"></a>删除字段</h2></li>
</ul>
<p>​     -表中有多条记录时，所有列的此字段的值都会被删除</p>
<p>​     -alter table 库名<code>.</code>表名 drop 字段名;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table db1.t2 drop sex;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t2;</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type       | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">| name  | char(10)   | NO   |     | NULL    |       |</span><br><span class="line">| age   | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| class | char(20)   | NO   |     | 2101    |       |</span><br><span class="line">| pay   | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="修改字段名"><a href="#修改字段名" class="headerlink" title="修改字段名"></a>修改字段名</h2></li>
</ul>
<p>​     -alter table 库名<code>.</code>表名 </p>
<p>​       change 原字段名 新字段名 类型 约束条件 [ after 字段名 | first ];</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table db1.t2 change class school char(10) not null defauult <span class="string">&quot;hnpi&quot;</span> after pay;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t2;</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type       | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| name   | char(10)   | NO   |     | NULL    |       |</span><br><span class="line">| age    | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| pay    | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">| school | char(10)   | NO   |     | hnpi    |       |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h2></li>
</ul>
<p>​     -表对应的文件名，也会被影响</p>
<p>​      每张表在/var/lib/mysql目录下都会用相应文件</p>
<p>​     -表记录不受影响</p>
<p>​     -alter table 库名<code>.</code>表名 rename 库名<code>.</code>新表名;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table db1.t2 rename db1.template;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.template;</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type       | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| name   | char(10)   | NO   |     | NULL    |       | </span><br><span class="line">| age    | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| pay    | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">| school | char(10)   | NO   |     | hnpi    |       |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h1><h2 id="MySQL键值概述"><a href="#MySQL键值概述" class="headerlink" title="MySQL键值概述"></a>MySQL键值概述</h2><h3 id="键值类型"><a href="#键值类型" class="headerlink" title="键值类型"></a>键值类型</h3><ul>
<li>根据数据存储需求，选择键值</li>
<li>index 普通所以</li>
<li>unique 唯一索引</li>
<li>fulltext 全文索引</li>
<li>primary key 主键</li>
<li>foreign key 外键</li>
</ul>
<h2 id="索引介绍"><a href="#索引介绍" class="headerlink" title="索引介绍"></a>索引介绍</h2><ul>
<li>类似与书的目录</li>
<li>对表中的字段进行排序</li>
<li>索引算法：Btree、B+tree、hash</li>
</ul>
<h3 id="索引优点"><a href="#索引优点" class="headerlink" title="索引优点"></a>索引优点</h3><ul>
<li>可以加快数据的查询速度</li>
</ul>
<h3 id="索引缺点"><a href="#索引缺点" class="headerlink" title="索引缺点"></a>索引缺点</h3><ul>
<li><p>当对表中数据进行增加、删除、修改的时候，索引也要动态调整，</p>
<p>降低了数据的维护速度</p>
</li>
<li><p>索引需要站物理空间</p>
</li>
</ul>
<h2 id="普通索引index"><a href="#普通索引index" class="headerlink" title="普通索引index"></a>普通索引index</h2><ul>
<li><h2 id="具体要求"><a href="#具体要求" class="headerlink" title="具体要求"></a>具体要求</h2><p>-一个表中可以有多个index字段</p>
<p>-字段值允许重复，且可以赋NULL值</p>
<p>-index字段 标志是MUL</p>
<p>-通常把做为查询条件的字段设置为index字段</p>
</li>
</ul>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><ul>
<li><h3 id="建表时创建索引"><a href="#建表时创建索引" class="headerlink" title="建表时创建索引"></a>建表时创建索引</h3><p>index(字段名)，index(字段名)……</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.t3(</span><br><span class="line">-&gt; <span class="built_in">id</span> char(15) not null,</span><br><span class="line">-&gt; name char(20) not null,</span><br><span class="line">-&gt; age int(3) not null,</span><br><span class="line">-&gt; gender enum(<span class="string">&quot;boy&quot;</span>,<span class="string">&quot;girl&quot;</span>) default <span class="string">&quot;boy&quot;</span> not null,</span><br><span class="line">-&gt; index(<span class="built_in">id</span>),index(name)</span><br><span class="line">-&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t3;</span><br><span class="line">+--------+--------------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type               | Null | Key | Default | Extra |</span><br><span class="line">+--------+--------------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>     | char(15)           | NO   | MUL | NULL    |       |</span><br><span class="line">| name   | char(20)           | NO   | MUL | NULL    |       |</span><br><span class="line">| age    | int(3)             | NO   |     | NULL    |       |</span><br><span class="line">| gender | enum(<span class="string">&#x27;boy&#x27;</span>,<span class="string">&#x27;girl&#x27;</span>) | NO   |     | boy     |       |</span><br><span class="line">+--------+--------------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="在已有表里创建索引"><a href="#在已有表里创建索引" class="headerlink" title="在已有表里创建索引"></a>在已有表里创建索引</h3><p>-create index 索引名 on 表名(字段名)；</p>
</li>
<li><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>-drop index 索引名 on 表名;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.template;</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type       | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| name   | char(10)   | NO   |     | NULL    |       |</span><br><span class="line">| age    | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| pay    | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">| school | char(10)   | NO   |     | hnpi    |       |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create index name on db1.template(name);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.template;</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type       | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| name   | char(10)   | NO   | MUL | NULL    |       |</span><br><span class="line">| age    | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| pay    | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">| school | char(10)   | NO   |     | hnpi    |       |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; drop index name on db1.template;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.template;</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type       | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| name   | char(10)   | NO   |     | NULL    |       |</span><br><span class="line">| age    | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| pay    | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">| school | char(10)   | NO   |     | hnpi    |       |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="查看索引信息"><a href="#查看索引信息" class="headerlink" title="查看索引信息"></a>查看索引信息</h2></li>
</ul>
<p>​     -show index from 表名 \G;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.t3;</span><br><span class="line">+--------+--------------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type               | Null | Key | Default | Extra |</span><br><span class="line">+--------+--------------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>     | char(15)           | NO   | MUL | NULL    |       |</span><br><span class="line">| name   | char(20)           | NO   | MUL | NULL    |       |</span><br><span class="line">| age    | int(3)             | NO   |     | NULL    |       |</span><br><span class="line">| gender | enum(<span class="string">&#x27;boy&#x27;</span>,<span class="string">&#x27;girl&#x27;</span>) | NO   |     | boy     |       |</span><br><span class="line">+--------+--------------------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show index from db1.t3\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">            Table: t3</span><br><span class="line">       Non_unique: 1</span><br><span class="line">         Key_name: <span class="built_in">id</span></span><br><span class="line">     Seq_in_index: 1</span><br><span class="line">      Column_name: <span class="built_in">id</span></span><br><span class="line">        Collation: A</span><br><span class="line">      Cardinality: 0</span><br><span class="line">         Sub_part: NULL</span><br><span class="line">           Packed: NULL</span><br><span class="line">             Null: </span><br><span class="line">       Index_type: BTREE</span><br><span class="line">          Comment: </span><br><span class="line">    Index_comment: </span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">            Table: t3</span><br><span class="line">       Non_unique: 1</span><br><span class="line">         Key_name: name</span><br><span class="line">     Seq_in_index: 1</span><br><span class="line">      Column_name: name</span><br><span class="line">        Collation: A</span><br><span class="line">      Cardinality: 0</span><br><span class="line">         Sub_part: NULL</span><br><span class="line">           Packed: NULL</span><br><span class="line">             Null: </span><br><span class="line">       Index_type: BTREE </span><br><span class="line">          Comment: </span><br><span class="line">    Index_comment: </span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="主键外键"><a href="#主键外键" class="headerlink" title="主键外键"></a>主键外键</h1><h2 id="主键primary-key"><a href="#主键primary-key" class="headerlink" title="主键primary key"></a>主键primary key</h2><h3 id="具体要求-1"><a href="#具体要求-1" class="headerlink" title="具体要求"></a>具体要求</h3><ul>
<li><p>字段值不允许重复，且不允许赋NULL值</p>
</li>
<li><p>一个表中只能有一个primary key字段</p>
</li>
<li><p>多个字段都作为主键，称为复合主键，必须一起创建</p>
</li>
<li><p>主键的标志是PRI</p>
</li>
<li><p>主键通常与auto_increment连用 </p>
<p>###递增属性 多用于id号 当设置此属性的字段不被插入数据时，默认为最后一行id+1 </p>
</li>
<li><p>通常把表中唯一表示记录的字段[记录编号字段]设置为主键</p>
</li>
</ul>
<h3 id="创建表时创建主键"><a href="#创建表时创建主键" class="headerlink" title="创建表时创建主键"></a>创建表时创建主键</h3><p>命令：primary key(字段名)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.t4(</span><br><span class="line">-&gt; <span class="built_in">id</span> char(10) not null primary key,</span><br><span class="line">-&gt; name char(10) not null</span><br><span class="line">-&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t4;</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | char(10) | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | char(10) | NO   |     | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table db1.t5(</span><br><span class="line">-&gt; <span class="built_in">id</span> char(10),</span><br><span class="line">-&gt; name char(10) not null,</span><br><span class="line">-&gt; primary key(<span class="built_in">id</span>)</span><br><span class="line">-&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t5;</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | char(10) | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | char(10) | NO   |     | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="在已有表中创建主键"><a href="#在已有表中创建主键" class="headerlink" title="在已有表中创建主键"></a>在已有表中创建主键</h3><ul>
<li>alter table 表名 add primary key(字段名);</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.template;</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type       | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>     | char(10)   | YES  |     | NULL    |       |</span><br><span class="line">| name   | char(10)   | NO   |     | NULL    |       |</span><br><span class="line">| age    | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| pay    | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">| school | char(10)   | NO   |     | hnpi    |       |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table db1.template add primary key(<span class="built_in">id</span>);</span><br><span class="line">Query OK, 0 rows affected (0.03 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.template;</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type       | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>     | char(10)   | NO   | PRI | NULL    |       |</span><br><span class="line">| name   | char(10)   | NO   |     | NULL    |       |  </span><br><span class="line">| age    | tinyint(4) | YES  |     | 20      |       |</span><br><span class="line">| pay    | <span class="built_in">float</span>(4,2) | YES  |     | 28.00   |       |</span><br><span class="line">| school | char(10)   | NO   |     | hnpi    |       |</span><br><span class="line">+--------+------------+------+-----+---------+-------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="删除主键"><a href="#删除主键" class="headerlink" title="删除主键"></a>删除主键</h3><ul>
<li><p>alter table 表名 drop primary key;</p>
<p>删除主键前，如果有自增属性，必须先去掉</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.t6(</span><br><span class="line">-&gt; <span class="built_in">id</span> char(10) primary key auto_increment,</span><br><span class="line">-&gt; name char(10)</span><br><span class="line">-&gt; );</span><br><span class="line">ERROR 1063 (42000): Incorrect column specifier <span class="keyword">for</span> column <span class="string">&#x27;id&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###只有数值字符类才能设置递增属性</span></span><br><span class="line">mysql&gt; create table db1.t6( <span class="built_in">id</span> int primary key auto_increment, name char(10) );</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###有递增属性不能直接删除主键</span></span><br><span class="line">mysql&gt; alter table db1.t6 delete primary key;</span><br><span class="line">ERROR 1064 (42000): You have an error <span class="keyword">in</span> your SQL syntax; check the manual that </span><br><span class="line">corresponds to your MariaDB server version <span class="keyword">for</span> the right syntax to use near </span><br><span class="line"><span class="string">&#x27;delete primary key&#x27;</span> at line 1</span><br><span class="line"></span><br><span class="line"><span class="comment">###删除递增属性</span></span><br><span class="line">mysql&gt; alter table db1.t6 modify <span class="built_in">id</span> int;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t6; </span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)  | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | char(10) | YES  |     | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###删除成功</span></span><br><span class="line">mysql&gt; alter table db1.t6 drop primary key;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br></pre></td></tr></table></figure>

<h3 id="复合主键"><a href="#复合主键" class="headerlink" title="复合主键"></a>复合主键</h3><ul>
<li>表中多个字段一起做主键</li>
<li>插入记录时，不允许主键字段重复</li>
</ul>
<h3 id="建表时创建"><a href="#建表时创建" class="headerlink" title="建表时创建"></a>建表时创建</h3><ul>
<li>primary key(字段名1，字段名2，……);</li>
</ul>
<h3 id="在已有表里创建"><a href="#在已有表里创建" class="headerlink" title="在已有表里创建"></a>在已有表里创建</h3><ul>
<li>alter table 表名 add primary key(字段名1，字段名2，……);</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.t8(</span><br><span class="line">-&gt; <span class="built_in">id</span> int auto_increment,</span><br><span class="line">-&gt; name char(10),</span><br><span class="line">-&gt; age char(10),</span><br><span class="line">-&gt; primary key(<span class="built_in">id</span>,name)</span><br><span class="line">-&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t8;</span><br><span class="line">+-------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+-------+----------+------+-----+---------+----------------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name  | char(10) | NO   | PRI | NULL    |                |</span><br><span class="line">| age   | char(10) | YES  |     | NULL    |                |</span><br><span class="line">+-------+----------+------+-----+---------+----------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t9;</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)  | YES  |     | NULL    |       |</span><br><span class="line">| name  | char(10) | YES  |     | NULL    |       |</span><br><span class="line">| age   | char(10) | YES  |     | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table db1.t9 add primary key(<span class="built_in">id</span>,name);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t9;</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)  | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | char(10) | NO   | PRI | NULL    |       |</span><br><span class="line">| age   | char(10) | YES  |     | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="外键foreign-key"><a href="#外键foreign-key" class="headerlink" title="外键foreign key"></a>外键foreign key</h2><h3 id="使用规则"><a href="#使用规则" class="headerlink" title="使用规则"></a>使用规则</h3><ul>
<li><p>外键功能</p>
<p>-插入表记录时，字段值在另一个表字段值范围内选择</p>
</li>
<li><p>使用规则</p>
<p>-表存储引擎必须时innodb ###mariadb默认存储引擎</p>
<p>-字段类型要一致</p>
<p>-<strong>被参照字段必须要是索引类型的一种（primary key）</strong></p>
</li>
</ul>
<h3 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table 表名(</span><br><span class="line">字段名列表，</span><br><span class="line">foreign key[外键名](字段名) references 表名(字段名) <span class="comment">#指外键</span></span><br><span class="line">on update cascade <span class="comment">#同步更新</span></span><br><span class="line">on delete cascade <span class="comment">#同步删除</span></span><br><span class="line">)engine=innodb; <span class="comment">#存储引擎</span></span><br></pre></td></tr></table></figure>

<h3 id="删除外键"><a href="#删除外键" class="headerlink" title="删除外键"></a>删除外键</h3><ul>
<li><p>查看外键 show create table 表名 \G</p>
</li>
<li><p>删除外键 alter table 表名 drop foreign key 名称; </p>
<p>#是外键的名称通过show create table 表名 \G查看</p>
<p>#CONSTRAINT <code>t2_ibfk_1</code> t2_ibfk_1为外键名</p>
</li>
<li><p>添加外键 alter table 表名 add foreign key(字段名) on </p>
<p>update cascade ondelete cascade;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.t1;</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| name  | char(10) | NO   | PRI | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.t1;</span><br><span class="line">+-------+</span><br><span class="line">| name  |</span><br><span class="line">+-------+</span><br><span class="line">| bob   |</span><br><span class="line">| lihua |</span><br><span class="line">| linda |</span><br><span class="line">+-------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table db1.t2(</span><br><span class="line">-&gt; <span class="built_in">id</span> int primary key auto_increment,</span><br><span class="line">-&gt; name char(10),</span><br><span class="line">-&gt; foreign key(name) references db1.t1(name)</span><br><span class="line">-&gt; on update cascade</span><br><span class="line">-&gt; on delete cascade</span><br><span class="line">-&gt; )engine=innodb;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###查看外键名称 CONSTRAINT `t2_ibfk_1`</span></span><br><span class="line">mysql&gt; show create table db1.t2 \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">            Table: t2</span><br><span class="line">     Create Table: CREATE TABLE `t2` (</span><br><span class="line">      `<span class="built_in">id</span>` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">      `name` char(10) DEFAULT NULL,</span><br><span class="line">      PRIMARY KEY (`<span class="built_in">id</span>`),</span><br><span class="line">      KEY `name` (`name`),</span><br><span class="line">      CONSTRAINT `t2_ibfk_1` FOREIGN KEY (`name`) REFERENCES </span><br><span class="line">      `t1` (`name`) ON DELETE CASCADE ON UPDATE CASCADE</span><br><span class="line">    ) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; desc db1.t2;</span><br><span class="line">+-------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+-------+----------+------+-----+---------+----------------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name  | char(10) | YES  | MUL | NULL    |                |</span><br><span class="line">+-------+----------+------+-----+---------+----------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###删除外键</span></span><br><span class="line">mysql&gt; alter table db1.t2 drop foreign key t2_ibfk_1;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create table db1.t2\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Table: t2</span><br><span class="line">    Create Table: CREATE TABLE `t2` (</span><br><span class="line">      `<span class="built_in">id</span>` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">      `name` char(10) DEFAULT NULL,</span><br><span class="line">      PRIMARY KEY (`<span class="built_in">id</span>`),</span><br><span class="line">      KEY `name` (`name`)</span><br><span class="line">    ) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###添加外键</span></span><br><span class="line">mysql&gt; alter table db1.t2 add foreign key name(name) </span><br><span class="line">references db1.t1(name) on update cascade on delete cascade;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create table db1.t2\G </span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">        Table: t2</span><br><span class="line"> Create Table: CREATE TABLE `t2` (</span><br><span class="line">   `<span class="built_in">id</span>` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">   `name` char(10) DEFAULT NULL,</span><br><span class="line">   PRIMARY KEY (`<span class="built_in">id</span>`),</span><br><span class="line">   KEY `name` (`name`),</span><br><span class="line">   CONSTRAINT `name` FOREIGN KEY (`name`) REFERENCES `t1` (`name`) </span><br><span class="line">   ON DELETE CASCADE ON UPDATE CASCADE</span><br><span class="line"> ) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="指定外键名"><a href="#指定外键名" class="headerlink" title="指定外键名"></a>指定外键名</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.t3( </span><br><span class="line"><span class="built_in">id</span> int primary key auto_increment, </span><br><span class="line">name charr(10), </span><br><span class="line">foreign key <span class="built_in">test</span>(name) references db1.t1(name) </span><br><span class="line">on update cascade </span><br><span class="line">on delette cascade </span><br><span class="line">)engine=innodb;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table db1.t3\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">        Table: t3</span><br><span class="line"> Create Table: CREATE TABLE `t3` (</span><br><span class="line">   `<span class="built_in">id</span>` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">   `name` char(10) DEFAULT NULL,</span><br><span class="line">   PRIMARY KEY (`<span class="built_in">id</span>`),</span><br><span class="line">   KEY `<span class="built_in">test</span>` (`name`),</span><br><span class="line">   CONSTRAINT `<span class="built_in">test</span>` FOREIGN KEY (`name`) REFERENCES `t1` (`name`)</span><br><span class="line">   ON DELETE CASCADE ON UPDATE CASCADE</span><br><span class="line"> ) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="数据导入导出"><a href="#数据导入导出" class="headerlink" title="数据导入导出"></a>数据导入导出</h1><h2 id="检索目录"><a href="#检索目录" class="headerlink" title="检索目录"></a>检索目录</h2><p>安装mysql服务软件时，会自动创建检索目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&quot;secure_file_priv&quot;</span>;</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">| Variable_name    | Value           |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">| secure_file_priv | /var/lib/mysql/ |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">[root@controller lib]<span class="comment"># ll -d /var/lib/mysql/</span></span><br><span class="line">drwxr-xr-x. 14 mysql mysql 4096 Mar 11 16:41 /var/lib/mysql/</span><br></pre></td></tr></table></figure>

<h3 id="修改检索目录"><a href="#修改检索目录" class="headerlink" title="修改检索目录"></a>修改检索目录</h3><ul>
<li>操作步骤</li>
<li>创建目录并修改所有者</li>
<li>修改主配置文件</li>
<li>重启服务</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mkdir /mysql</span></span><br><span class="line">[root@controller ~]<span class="comment"># chown mysql:mysql /mysql</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">secure_file_priv=<span class="string">&quot;/mysql&quot;</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000 -e &quot;show variables like &#x27;secure_file_priv&#x27;;&quot;</span></span><br><span class="line">+------------------+---------+</span><br><span class="line">| Variable_name    | Value   |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| secure_file_priv | /mysql/ |</span><br><span class="line">+------------------+---------+</span><br></pre></td></tr></table></figure>

<h2 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h2><ul>
<li><p>把系统文件的内容存储到数据库的表里，默认只有数据库管理员root用户有数据导入权限</p>
</li>
<li><p>数据导入步骤</p>
<p>-建表</p>
<p>-拷贝文件到检索目录下</p>
<p>-导入数据</p>
</li>
<li><p>字段分隔符要与文件一致</p>
</li>
<li><p>表字段类型和字段个数要与文件匹配</p>
</li>
<li><p>导入数据时指定文件的绝对路径</p>
</li>
<li><p>命令：</p>
<p>load data infile “/目录名/文件名”</p>
<p>into table 库名.表名</p>
<p>fields terminated by “符号” ##列间隔符号</p>
<p>lines terminated by “\n” ##行结束符号</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># cp /etc/passwd /mysql/passwd</span></span><br><span class="line">[root@controller ~]<span class="comment"># cat /mysql/passwd </span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">…………………………</span><br><span class="line">mysql&gt; create table db1.pswd(</span><br><span class="line">-&gt; user char(10) primary key,</span><br><span class="line">-&gt; pswd char(10) not null,</span><br><span class="line">-&gt; uid char(10) not null,</span><br><span class="line">-&gt; gid char(10) not null,</span><br><span class="line">-&gt; name char(30) not null,</span><br><span class="line">-&gt; home char(40) not null,</span><br><span class="line">-&gt; <span class="built_in">command</span> char(40) not null</span><br><span class="line">-&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; load data infile <span class="string">&quot;/mysql/passwd&quot;</span> </span><br><span class="line">-&gt; into table db1.pswd</span><br><span class="line">-&gt; fields terminated by <span class="string">&quot;:&quot;</span></span><br><span class="line">-&gt; lines terminated by <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">Query OK, 39 rows affected, 2 warnings (0.00 sec) </span><br><span class="line">Records: 39 Deleted: 0 Skipped: 0 Warnings: 2</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.pswd;</span><br><span class="line">+-------+------+------+------+-------+-----------------+---------------+</span><br><span class="line">| user  | pswd | uid  | gid  | name  | home            | <span class="built_in">command</span>       |</span><br><span class="line">+-------+------+------+------+-------+-----------------+---------------+</span><br><span class="line">| adm   | x    | 3    | 4    | adm   | /var/adm        | /sbin/        |</span><br><span class="line">| apache| x    | 48   | 48   | Apache| /usr/share/httpd| /sbin/nologin |</span><br><span class="line">| bin   | x    | 1    | 1    | bin   | /bin            | /sbin/nologin |</span><br><span class="line">| chrony| x    | 998  | 996  |       | /var/lib/chrony | /sbin/nologin |</span><br><span class="line">…………………………</span><br></pre></td></tr></table></figure>

<h2 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h2><ul>
<li><p>格式1：</p>
<p>select 命令 into outfile “/目录名/文件名”;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from db1.t1;</span><br><span class="line">+-------+</span><br><span class="line">| name  |</span><br><span class="line">+-------+</span><br><span class="line">| bob   |</span><br><span class="line">| lihua |</span><br><span class="line">| linda |</span><br><span class="line">+-------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.t1 into outfile <span class="string">&quot;/mysql/t1&quot;</span>;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">[root@controller mysql]<span class="comment"># cat /mysql/t1 </span></span><br><span class="line">bob</span><br><span class="line">lihua</span><br><span class="line">linda</span><br></pre></td></tr></table></figure>

<ul>
<li>格式2：</li>
</ul>
<p>​     select 命令 into outfile “/目录名/文件名” fields terminated by “分隔符”;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test3;</span><br><span class="line">+------+----------------------------+------+------+</span><br><span class="line">| name | ts                         | <span class="built_in">date</span> | yr   |</span><br><span class="line">+------+----------------------------+------+------+</span><br><span class="line">| bob  | 2023-03-11 19:44:35.292665 | NULL | 2055 |</span><br><span class="line">+------+----------------------------+------+------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test3 into outfile <span class="string">&quot;/mysql/test3&quot;</span> fields terminated by <span class="string">&quot;*&quot;</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">[root@controller ~]<span class="comment"># cat /mysql/test3 </span></span><br><span class="line">bob*2023-03-11 19:44:35.292665*\N*2055</span><br><span class="line"><span class="comment">###date列为空</span></span><br></pre></td></tr></table></figure>

<ul>
<li>格式3：</li>
</ul>
<p>​     select 命令 into outfile “/目录名/文件名” </p>
<p>​    fields terminated by “分隔符” lines terminated by “\n”; ##每行间隔 默认为换行符”\n”</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from db1.test;</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| name            | homeaddr |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| bob             | china    |</span><br><span class="line">| abcdefghijklmno | usa      |</span><br><span class="line">| abcdefghijklmno | usa      |</span><br><span class="line">| abcdefghijklmno | usa      |</span><br><span class="line">| abcdefghijklmno | usa      |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test into outfile <span class="string">&quot;/mysql/test&quot;</span> </span><br><span class="line">-&gt; fields terminated by <span class="string">&quot;***&quot;</span> lines terminated by <span class="string">&quot;#####&quot;</span>;</span><br><span class="line">Query OK, 5 rows affected (0.00 sec)</span><br><span class="line">[root@controller ~]<span class="comment"># cat /mysql/test</span></span><br><span class="line">bob***china<span class="comment">#####abcdefghijklmno***usa#####</span></span><br><span class="line">abcdefghijklmno***usa<span class="comment">#####abcdefghijklmno***usa#####</span></span><br><span class="line">abcdefghijklmno***usa<span class="comment">#####</span></span><br></pre></td></tr></table></figure>

<h1 id="管理表记录"><a href="#管理表记录" class="headerlink" title="管理表记录"></a>管理表记录</h1><h2 id="插入表记录"><a href="#插入表记录" class="headerlink" title="插入表记录"></a>插入表记录</h2><ul>
<li><p>格式1：添加一条记录，给所有字段赋值</p>
<p>insert into 表名 values(字段值列表);</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into db1.test7 values(<span class="string">&quot;bob&quot;</span>,1,19,<span class="string">&quot;ch&quot;</span>);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>格式2：添加多条记录，给所有字段赋值</p>
<p>insert into 表名 values(字段值列表),(字段值列表),(字段值列表);</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into db1.test7 values(<span class="string">&quot;bob&quot;</span>,1,19,<span class="string">&quot;ch&quot;</span>),(<span class="string">&quot;linda&quot;</span>,2,20,<span class="string">&quot;ch&quot;</span>),(<span class="string">&quot;linli&quot;</span>,3,16,<span class="string">&quot;usa&quot;</span>);</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line">Records: 3 Duplicates: 0 Warnings: 0</span><br></pre></td></tr></table></figure>

<ul>
<li><p>格式3：添加一条记录，给指定字段赋值</p>
<p>insert into 表名(字段名列表) values(字段值列表);</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into db1.test7(name,age) values(<span class="string">&quot;bob&quot;</span>,35);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>格式4：添加多条记录，给指定字段赋值</p>
<p>insert into 表名(字段名列表) values(字段值列表),(字段值列表),(字段值列表);</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into db1.test7(name,age) values(<span class="string">&quot;bob&quot;</span>,35),(<span class="string">&quot;lihua&quot;</span>,13),(<span class="string">&quot;lili&quot;</span>,16);</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3 Duplicates: 0 Warnings: 0</span><br><span class="line">mysql&gt; desc db1.test7;</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| name  | char(10) | YES  |     | NULL    |       |</span><br><span class="line">| <span class="built_in">id</span>    | char(10) | YES  |     | NULL    |       |</span><br><span class="line">| age   | char(10) | YES  |     | NULL    |       |</span><br><span class="line">| home  | char(10) | YES  |     | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test7;</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| name  | <span class="built_in">id</span>   | age  | home |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| bob   | 1    | 19   | ch   |</span><br><span class="line">| bob   | 1    | 19   | ch   |</span><br><span class="line">| linda | 2    | 20   | ch   |</span><br><span class="line">| linli | 3    | 16   | usa  |</span><br><span class="line">| bob   | NULL | 35   | NULL |</span><br><span class="line">| bob   | NULL | 35   | NULL |</span><br><span class="line">| lihua | NULL | 13   | NULL |</span><br><span class="line">| lili  | NULL | 16   | NULL |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>总结</p>
<p>-字段值要与字段类型相匹配</p>
<p>-字符类型的字段，要用 “” 号括起来</p>
<p>-依次给所有字段赋值时，字段名可以省略</p>
<p>-只给部分字段赋值时，必须明确写出对应的字段名称</p>
<p>-没有赋值的字段使用默认值或自增长值</p>
<p>-新纪录追加在末尾</p>
</li>
</ul>
<h2 id="查询表记录"><a href="#查询表记录" class="headerlink" title="查询表记录"></a>查询表记录</h2><ul>
<li><p>格式1：</p>
<p>select 字段1,……,字段N from 库名.表名; #查看所需字段的所有记录</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,age from db1.test7;</span><br><span class="line">+-------+------+</span><br><span class="line">| name  | age  |</span><br><span class="line">+-------+------+</span><br><span class="line">| bob   | 19   |</span><br><span class="line">| bob   | 19   |</span><br><span class="line">| linda | 20   |</span><br><span class="line">| linli | 16   |</span><br><span class="line">| bob   | 35   |</span><br><span class="line">| bob   | 35   |</span><br><span class="line">| lihua | 13   |</span><br><span class="line">| lili  | 16   |</span><br><span class="line">+-------+------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>格式2：</p>
<p>select 字段1,……,字段N from 库名.表名 where 条件表达式; #条件查询</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,age from db1.test7 <span class="built_in">where</span> home=<span class="string">&quot;ch&quot;</span>;</span><br><span class="line">+-------+------+</span><br><span class="line">| name  | age  |</span><br><span class="line">+-------+------+</span><br><span class="line">| bob   | 19   |</span><br><span class="line">| bob   | 19   |</span><br><span class="line">| linda | 20   |</span><br><span class="line">+-------+------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>当想输出原本不存在的列时 可以通过as显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc db1.t4;</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">| name  | char(15) | YES  |     | NULL    |       |</span><br><span class="line">| age   | int(11)  | YES  |     | NULL    |       |</span><br><span class="line">+-------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select name,age,2023-age as class from db1.t4;</span><br><span class="line">+------+------+-------+</span><br><span class="line">| name | age  | class |</span><br><span class="line">+------+------+-------+</span><br><span class="line">| bob  | 20   | 2003  |</span><br><span class="line">+------+------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select name,age,<span class="string">&quot;stu&quot;</span> as class from db1.t4;</span><br><span class="line">+------+------+-------+</span><br><span class="line">| name | age  | class |</span><br><span class="line">+------+------+-------+</span><br><span class="line">| bob  | 20   | stu   |</span><br><span class="line">+------+------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>总结</p>
<p>-*表示所有字段</p>
<p>-查看当前库表记录时库名可以省略</p>
<p>-字段列表决定显示列个数</p>
<p>-条件决定显示行的个数</p>
</li>
</ul>
<h2 id="更新表记录"><a href="#更新表记录" class="headerlink" title="更新表记录"></a>更新表记录</h2><ul>
<li><p>格式1：批量更新</p>
<p>update 库名.表名 set 字段名=值,字段名=值,字段名=值,……;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update db1.test7 <span class="built_in">set</span> age=18,home=<span class="string">&quot;ch&quot;</span>;</span><br><span class="line">Query OK, 8 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 8 Changed: 8 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test7;</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| name  | <span class="built_in">id</span>   | age  | home |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| bob   | 1    | 18   | ch   |</span><br><span class="line">| bob   | 1    | 18   | ch   |</span><br><span class="line">| linda | 2    | 18   | ch   |</span><br><span class="line">| linli | 3    | 18   | ch   |</span><br><span class="line">| bob   | NULL | 18   | ch   |</span><br><span class="line">| bob   | NULL | 18   | ch   |</span><br><span class="line">| lihua | NULL | 18   | ch   |</span><br><span class="line">| lili  | NULL | 18   | ch   |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>格式2：条件批量跟新</p>
<p>update 库名.表名 set 字段名=值,字段名=值,字段名=值,……</p>
<p>where 条件表达式;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update db1.test7 <span class="built_in">set</span> age=20,home=<span class="string">&quot;usa&quot;</span> <span class="built_in">where</span> <span class="built_in">id</span>=1 ;</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 2 Changed: 2 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test7;</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| name  | <span class="built_in">id</span>   | age  | home |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| bob   | 1    | 20   | usa  |</span><br><span class="line">| bob   | 1    | 20   | usa  |</span><br><span class="line">| linda | 2    | 18   | ch   |</span><br><span class="line">| linli | 3    | 18   | ch   |</span><br><span class="line">| bob   | NULL | 18   | ch   |</span><br><span class="line">| bob   | NULL | 18   | ch   |</span><br><span class="line">| lihua | NULL | 18   | ch   |</span><br><span class="line">| lili  | NULL | 18   | ch   |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>总结</p>
<p>-字段值要与字段类型相匹配</p>
<p>-对于字符类型的字段，值要用双引号括起来</p>
<p>-若不是用where限定条件，会跟新所有记录</p>
<p>-限定条件时，只跟新匹配条件的记录</p>
</li>
</ul>
<h2 id="删除表记录"><a href="#删除表记录" class="headerlink" title="删除表记录"></a>删除表记录</h2><ul>
<li><p>格式1：条件匹配删除</p>
<p>delete from 库名.表名 where 条件表达式;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from db1.test7 <span class="built_in">where</span> name=<span class="string">&quot;bob&quot;</span>;</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test7;</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| name  | <span class="built_in">id</span>   | age  | home |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">| linda | 2    | 18   | ch   |</span><br><span class="line">| linli | 3    | 18   | ch   |</span><br><span class="line">| lihua | NULL | 18   | ch   |</span><br><span class="line">| lili  | NULL | 18   | ch   |</span><br><span class="line">+-------+------+------+------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>格式2：删除所有记录</p>
<p>delete from 库名.表名;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from db1.test7;</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from db1.test7;</span><br><span class="line">Empty <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<h1 id="匹配条件"><a href="#匹配条件" class="headerlink" title="匹配条件"></a>匹配条件</h1><h2 id="基本匹配条件"><a href="#基本匹配条件" class="headerlink" title="基本匹配条件"></a>基本匹配条件</h2><h3 id="数值比较"><a href="#数值比较" class="headerlink" title="数值比较"></a>数值比较</h3><ul>
<li>字段必须是字段类型</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>比较</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td>相等</td>
<td>id = 3</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
<td>uid &gt; 3</td>
</tr>
<tr>
<td>&gt;=</td>
<td>大于或等于</td>
<td>uid &gt;= 3</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
<td>uid &lt; 3</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于或等于</td>
<td>uid &lt;= 3</td>
</tr>
<tr>
<td>!=</td>
<td>不相等</td>
<td>uid != 3</td>
</tr>
</tbody></table>
<h3 id="字符比较-匹配空-非空"><a href="#字符比较-匹配空-非空" class="headerlink" title="字符比较/匹配空/非空"></a>字符比较/匹配空/非空</h3><ul>
<li>字段必须是字符类型</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>比较</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td>相等</td>
<td>name = “root”</td>
</tr>
<tr>
<td>!=</td>
<td>不相等</td>
<td>name != “root”</td>
</tr>
<tr>
<td>is null</td>
<td>空</td>
<td>shell is null</td>
</tr>
<tr>
<td>is not null</td>
<td>非空</td>
<td>shell is not null</td>
</tr>
</tbody></table>
<h3 id="范围匹配"><a href="#范围匹配" class="headerlink" title="范围匹配"></a>范围匹配</h3><ul>
<li>匹配范围内任意一个值即可</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>比较</th>
</tr>
</thead>
<tbody><tr>
<td>in (值列表)</td>
<td>在……里……</td>
</tr>
<tr>
<td>not in (值列表)</td>
<td>不在……里……</td>
</tr>
<tr>
<td>between 数字 and 数字</td>
<td>在……之间……</td>
</tr>
</tbody></table>
<h3 id="逻辑匹配"><a href="#逻辑匹配" class="headerlink" title="逻辑匹配"></a>逻辑匹配</h3><ul>
<li>多个判断条件时使用</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>用途</th>
<th>格式</th>
</tr>
</thead>
<tbody><tr>
<td>or</td>
<td>逻辑或</td>
<td>条件1 or 条件2 or 条件3</td>
</tr>
<tr>
<td>and</td>
<td>逻辑与</td>
<td>条件1 and 条件2 and 条件3</td>
</tr>
<tr>
<td>！或 not</td>
<td>逻辑非</td>
<td></td>
</tr>
</tbody></table>
<p>and = &amp;&amp;  or = || (可替换)</p>
<h2 id="高级匹配条件"><a href="#高级匹配条件" class="headerlink" title="高级匹配条件"></a>高级匹配条件</h2><h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><ul>
<li><p>用法（适用于select update delete）</p>
<p>where 字段名 like “通配符”</p>
<p>_ 表示1个字符</p>
<p>% 表示0~n个字符</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user from mysql.user <span class="built_in">where</span> user like <span class="string">&quot;____&quot;</span>; <span class="comment">##四个“_”</span></span><br><span class="line">+------------+------+</span><br><span class="line">| host       | user |</span><br><span class="line">+------------+------+</span><br><span class="line">| %          | heat |</span><br><span class="line">| %          | nova |</span><br><span class="line">| %          | root |</span><br><span class="line">| 127.0.0.1  | root |</span><br><span class="line">| ::1        | root |</span><br><span class="line">| controller | root |</span><br><span class="line">| localhost  | heat |</span><br><span class="line">| localhost  | nova |</span><br><span class="line">| localhost  | root |</span><br><span class="line">+------------+------+</span><br><span class="line">9 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><ul>
<li><p>用法</p>
<p>where 字段名 regexp “正则表达式”</p>
<p>正则元字符</p>
<p>^ 开头</p>
<p>$ 结尾 </p>
<p>. 一个字符 </p>
<p>[] 范围 </p>
<p>*前面字符出现零次或多次</p>
<p>| 或</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user from mysql.user <span class="built_in">where</span> user regexp <span class="string">&quot;^r|t$&quot;</span>;</span><br><span class="line">+------------+------+</span><br><span class="line">| host | user |</span><br><span class="line">+------------+------+</span><br><span class="line">| % | heat |</span><br><span class="line">| % | root |</span><br><span class="line">| 127.0.0.1 | root |</span><br><span class="line">| ::1 | root |</span><br><span class="line">| controller | root |</span><br><span class="line">| localhost | heat |</span><br><span class="line">| localhost | root |</span><br><span class="line">+------------+------+</span><br><span class="line">7 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select host,user from mysql.user <span class="built_in">where</span> user regexp <span class="string">&quot;^......$&quot;</span>;</span><br><span class="line">+-----------+--------+</span><br><span class="line">| host | user |</span><br><span class="line">+-----------+--------+</span><br><span class="line">| % | cinder |</span><br><span class="line">| % | glance |</span><br><span class="line">| localhost | cinder |</span><br><span class="line">| localhost | glance |</span><br><span class="line">+-----------+--------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select host,user from mysql.user <span class="built_in">where</span> user regexp <span class="string">&quot;[rnf]&quot;</span>;</span><br><span class="line">+------------+----------+</span><br><span class="line">| host       | user     |</span><br><span class="line">+------------+----------+</span><br><span class="line">| %          | cinder   |</span><br><span class="line">| %          | glance   |</span><br><span class="line">| %          | keystone |</span><br><span class="line">| %          | neutron  |</span><br><span class="line">| %          | nova     |</span><br><span class="line">| %          | root     |</span><br><span class="line">| 127.0.0.1  | root     |</span><br><span class="line">| ::1        | root     |</span><br><span class="line">| controller | root     |</span><br><span class="line">| localhost  | cinder   |</span><br><span class="line">| localhost  | glance   |</span><br><span class="line">| localhost  | keystone |</span><br><span class="line">| localhost  | neutron  |</span><br><span class="line">| localhost  | nova     |</span><br><span class="line">| localhost  | root     |</span><br><span class="line">+------------+----------+</span><br><span class="line">15 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select host,user from mysql.user <span class="built_in">where</span> user regexp <span class="string">&quot;^r.*&quot;</span>;</span><br><span class="line">+------------+------+</span><br><span class="line">| host       | user |</span><br><span class="line">+------------+------+</span><br><span class="line">| %          | root |</span><br><span class="line">| 127.0.0.1  | root |</span><br><span class="line">| ::1        | root |</span><br><span class="line">| controller | root |</span><br><span class="line">| localhost  | root |</span><br><span class="line">+------------+------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="数字计算"><a href="#数字计算" class="headerlink" title="数字计算"></a>数字计算</h3><ul>
<li>字段必须是数值类型</li>
</ul>
<table>
<thead>
<tr>
<th>符号</th>
<th>用途</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加法</td>
<td>uid + gid</td>
</tr>
<tr>
<td>-</td>
<td>减法</td>
<td>uid - gid</td>
</tr>
<tr>
<td>*</td>
<td>乘法</td>
<td>uid * gid</td>
</tr>
<tr>
<td>/</td>
<td>除法</td>
<td>uid / gid</td>
</tr>
<tr>
<td>%</td>
<td>取余数（求模）</td>
<td>uid % gid</td>
</tr>
<tr>
<td>()</td>
<td>提高优先级</td>
<td>(uid + gid) /2</td>
</tr>
</tbody></table>
<h1 id="操作查询结果"><a href="#操作查询结果" class="headerlink" title="操作查询结果"></a>操作查询结果</h1><h2 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h2><ul>
<li><h2 id="MySQL内置数据统计函数"><a href="#MySQL内置数据统计函数" class="headerlink" title="MySQL内置数据统计函数"></a>MySQL内置数据统计函数</h2><p>-avg(字段名) #统计字段平均值</p>
<p>-sum(字段名) #统计字段之和</p>
<p>-min(字段名) #统计字段最小值</p>
<p>-max(字段名) #统计字段最大值</p>
<p>-count(字段名) #统计字段值个数</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select avg(uid) from db1.pswd;</span><br><span class="line">+-------------------+</span><br><span class="line">| avg(uid)          |</span><br><span class="line">+-------------------+</span><br><span class="line">| 307.2564102564103 |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select <span class="built_in">sum</span>(uid) from db1.pswd;</span><br><span class="line">+----------+</span><br><span class="line">| <span class="built_in">sum</span>(uid) |</span><br><span class="line">+----------+</span><br><span class="line">| 11983    |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select min(uid) from db1.pswd;</span><br><span class="line">+----------+</span><br><span class="line">| min(uid) |</span><br><span class="line">+----------+</span><br><span class="line">| 0        |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select max(uid) from db1.pswd;</span><br><span class="line">+----------+</span><br><span class="line">| max(uid) |</span><br><span class="line">+----------+</span><br><span class="line">| 999      |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select count(uid) from db1.pswd;</span><br><span class="line">+------------+</span><br><span class="line">| count(uid) |</span><br><span class="line">+------------+</span><br><span class="line">| 39         |</span><br><span class="line">+------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p>SQL查询 order by 字段名 [ asc | desc ]; 升序|降序</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,uid from db1.pswd order by uid asc;</span><br><span class="line">+--------------------+-----+</span><br><span class="line">| name               | uid |</span><br><span class="line">+--------------------+-----+</span><br><span class="line">| root               | 0   |</span><br><span class="line">| bin                | 1   |</span><br><span class="line">| daemon             | 2   |</span><br><span class="line">| adm                | 3   |</span><br><span class="line">| lp                 | 4   |</span><br><span class="line">| <span class="built_in">sync</span>               | 5   |</span><br><span class="line">| shutdown           | 6   |</span><br><span class="line">| halt               | 7   |</span><br><span class="line">| mail               | 8   |</span><br><span class="line">| operator           | 11  |</span><br><span class="line">| games              | 12  |</span><br><span class="line">| FTP User           | 14  |</span><br><span class="line">| Named              | 25  |</span><br><span class="line">| MySQL Server       | 27  |</span><br><span class="line">| Apache             | 48  |</span><br><span class="line">| radvd user         | 75  |</span><br><span class="line">| System message bus | 81  |</span><br><span class="line">+--------------------+-----+</span><br><span class="line">39 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>SQL查询 group by 字段名;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name,uid from db1.pswd group by name;</span><br><span class="line">+------------------+------+</span><br><span class="line">| name             | uid  |</span><br><span class="line">+------------------+------+</span><br><span class="line">| adm              | 3    |</span><br><span class="line">| Apache           | 48   |</span><br><span class="line">| bin              | 1    |</span><br><span class="line">| daemon           | 2    |</span><br><span class="line">| etcd user        | 994  |</span><br><span class="line">| FTP User         | 14   |</span><br><span class="line">| games            | 12   |</span><br><span class="line">| halt             | 7    |</span><br><span class="line">| haproxy          | 188  |</span><br><span class="line">| lp               | 4    |</span><br><span class="line">| mail             | 8    |</span><br><span class="line">| Memcached daemon | 995  |</span><br><span class="line">| MySQL Server     | 27   |</span><br><span class="line">| Named            | 25   |</span><br><span class="line">| Nobody           | 99   |</span><br><span class="line">| operator         | 11   |</span><br><span class="line">| root             | 0    |</span><br><span class="line">| shutdown         | 6    |</span><br><span class="line">| <span class="built_in">sync</span>             | 5    |</span><br><span class="line">| User <span class="keyword">for</span> polkitd | 999  |</span><br><span class="line">+------------------+------+</span><br><span class="line">37 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h2><p>select distinct 字段名 from 表名;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct <span class="built_in">command</span> from db1.pswd;</span><br><span class="line">+----------------+</span><br><span class="line">| <span class="built_in">command</span>        |</span><br><span class="line">+----------------+</span><br><span class="line">| /sbin/nologin  |</span><br><span class="line">| /sbin/halt     |</span><br><span class="line">| /bin/bash      |</span><br><span class="line">| /sbin/shutdown |</span><br><span class="line">| /bin/sync      |</span><br><span class="line">+----------------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="查找数据结果"><a href="#查找数据结果" class="headerlink" title="查找数据结果"></a>查找数据结果</h2><ul>
<li><h3 id="having用法"><a href="#having用法" class="headerlink" title="having用法"></a>having用法</h3><p>SQL查询 having 条件表达式;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name from db1.pswd having name=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| root |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select name from db1.pswd <span class="built_in">where</span> uid &lt;=100 having name like <span class="string">&quot;____&quot;</span>; <span class="comment">##4个&quot;_&quot;</span></span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| halt |</span><br><span class="line">| mail |</span><br><span class="line">| root |</span><br><span class="line">| <span class="built_in">sync</span> |</span><br><span class="line">+------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="限制查询结果行数"><a href="#限制查询结果行数" class="headerlink" title="限制查询结果行数"></a>限制查询结果行数</h2><ul>
<li>SQL查询 limit 数字; #显示查询结果前几行</li>
<li>SQL查询 limit 数字1,数字2; #显示指定范围内的查询记录</li>
<li>数字1：起始行 （0表示第1行）</li>
<li>数字2：总行数</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name from db1.pswd <span class="built_in">limit</span> 5;</span><br><span class="line">+--------------------------+</span><br><span class="line">| name                     |</span><br><span class="line">+--------------------------+</span><br><span class="line">| adm                      |</span><br><span class="line">| Apache                   |</span><br><span class="line">| bin                      |</span><br><span class="line">|                          |</span><br><span class="line">| OpenStack Cinder Daemons |</span><br><span class="line">+--------------------------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select name from db1.pswd <span class="built_in">limit</span> 0,5;</span><br><span class="line">+--------------------------+</span><br><span class="line">| name                     |</span><br><span class="line">+--------------------------+</span><br><span class="line">| adm                      |</span><br><span class="line">| Apache                   |</span><br><span class="line">| bin                      |</span><br><span class="line">|                          |</span><br><span class="line">| OpenStack Cinder Daemons |</span><br><span class="line">+--------------------------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select name from db1.pswd <span class="built_in">limit</span> 5,5;</span><br><span class="line">+---------------------------+</span><br><span class="line">| name                      |</span><br><span class="line">+---------------------------+</span><br><span class="line">| daemon                    |</span><br><span class="line">| System message bus        |</span><br><span class="line">| Erlang Port Mapper Daemon |</span><br><span class="line">| etcd user                 |</span><br><span class="line">| FTP User                  |</span><br><span class="line">+---------------------------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="MySQL图形工具管理"><a href="#MySQL图形工具管理" class="headerlink" title="MySQL图形工具管理"></a>MySQL图形工具管理</h1><h2 id="管理工具"><a href="#管理工具" class="headerlink" title="管理工具"></a>管理工具</h2><table>
<thead>
<tr>
<th>类型</th>
<th>界面</th>
<th>操作系统</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>mysql</td>
<td>命令行</td>
<td>跨平台</td>
<td>MySQL官方bundle包自带</td>
</tr>
<tr>
<td>MySQL-Workbench</td>
<td>图形</td>
<td>跨平台</td>
<td>MySQL官方提供</td>
</tr>
<tr>
<td>MySQL-Front</td>
<td>图形</td>
<td>Windows</td>
<td>开源，轻量级客户端软件</td>
</tr>
<tr>
<td>Navicat</td>
<td>图形</td>
<td>Windows</td>
<td>专用、功能强大、商业版</td>
</tr>
<tr>
<td>phpMyAdmin</td>
<td>浏览器</td>
<td>跨平台</td>
<td>开源、需LAMP平台</td>
</tr>
</tbody></table>
<h2 id="phpMyAdmin"><a href="#phpMyAdmin" class="headerlink" title="phpMyAdmin"></a>phpMyAdmin</h2><ul>
<li>部署环境LAMP</li>
<li>启动httpd服务程序</li>
<li>解压phpMyAdmin包，并移动到网站目录</li>
<li>配置config.inc.php，指定MySQL服务器地址</li>
<li>浏览器访问、使用数据库管理员root登录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install -y httpd php php-mysql</span><br><span class="line">systenctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">systenctl <span class="built_in">enable</span> --now php-fpm</span><br><span class="line"></span><br><span class="line">tar -zxvf phpMyAdmin-2.11.11-all-languages.tar.gz</span><br><span class="line"><span class="built_in">mv</span> phpMyAdmin-2.11.11-all-languages /var/www/html/phpmyadmin</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /var/www/html/phpmyadmin</span><br><span class="line"><span class="built_in">cp</span> config.sample.inc.php config.inc.php</span><br><span class="line"></span><br><span class="line">vim config.inc.php</span><br><span class="line">17 <span class="variable">$cfg</span>[<span class="string">&#x27;blowfish_secret&#x27;</span>] = <span class="string">&#x27;000000&#x27;</span>; cookies参数随便写不能空</span><br><span class="line">31 <span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;host&#x27;</span>] = <span class="string">&#x27;localhost&#x27;</span>; 数据库地址</span><br></pre></td></tr></table></figure>

<h1 id="用户授权"><a href="#用户授权" class="headerlink" title="用户授权"></a>用户授权</h1><h2 id="授权grant"><a href="#授权grant" class="headerlink" title="授权grant"></a>授权grant</h2><ul>
<li><p>授权：添加用户并设置权限及连接密码</p>
</li>
<li><h3 id="命令格式-1"><a href="#命令格式-1" class="headerlink" title="命令格式"></a>命令格式</h3><p>grant 权限列表 on 库名 用户名@”客户端地址” identified by “密码” with grant option; #有授权权限，可选项</p>
</li>
<li><h3 id="权限列表"><a href="#权限列表" class="headerlink" title="权限列表"></a>权限列表</h3><p>all 所有权限</p>
<p>usage 无权限</p>
<p>select,update,insert 个别权限</p>
<p>select,update(字段1,……,字段N) 指定字段</p>
</li>
<li><h3 id="库名"><a href="#库名" class="headerlink" title="库名"></a>库名</h3><p>*. * 所有库所有表</p>
<p>库名.* 一个库</p>
<p>库名.表名 一张表</p>
</li>
<li><h3 id="用户名"><a href="#用户名" class="headerlink" title="用户名"></a>用户名</h3><p>授权时自定义 要有标识性</p>
<p>存储在mysql库的user表里</p>
</li>
<li><h3 id="客户端地址"><a href="#客户端地址" class="headerlink" title="客户端地址"></a>客户端地址</h3><p>% 所有主机</p>
<p>192.168.1.% 网段内所有主机 192.168.1.1~254</p>
<p>192.168.1.1 1台主机</p>
<p>localhost 数据库服务器本机</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all on *.* to root@<span class="string">&quot;%&quot;</span> identified by <span class="string">&quot;000000&quot;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant select on *.* to user1@<span class="string">&quot;%&quot;</span> identified by <span class="string">&quot;000000&quot;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant select on *.* to user2@<span class="string">&quot;192.168.1.%&quot;</span> identified by <span class="string">&quot;0000000&quot;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="授权库"><a href="#授权库" class="headerlink" title="授权库"></a>授权库</h1><h2 id="mysql库记录授权信息"><a href="#mysql库记录授权信息" class="headerlink" title="mysql库记录授权信息"></a>mysql库记录授权信息</h2><ul>
<li>user表 记录已有授权<strong>用户</strong>及全局权限</li>
<li>db表 记录已有授权用户对<strong>数据库</strong>的访问权限</li>
<li>tables_priv表 记录已有授权用户对<strong>表</strong>的访问权限</li>
<li>columns_priv表 记录已有授权用户对<strong>字段</strong>的访问权限</li>
<li><strong>查看表记录可以获取用户权限，也可以通过修改记录，修改用户权限</strong></li>
</ul>
<h2 id="user表"><a href="#user表" class="headerlink" title="user表"></a>user表</h2><ul>
<li>存储服务器已有授权<strong>用户</strong>，及全局权限</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc mysql.user;</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from mysql.user;</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from mysql.user <span class="built_in">where</span> user=<span class="string">&quot;用户名&quot;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; update mysql.user <span class="built_in">set</span> 字段名=<span class="string">&quot;值&quot;</span> <span class="built_in">where</span> 条件;flush privilege;</span><br></pre></td></tr></table></figure>

<h2 id="db表"><a href="#db表" class="headerlink" title="db表"></a>db表</h2><ul>
<li>存储服务器已有授权用户，对已有<strong>数据库</strong>的访问权限</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc mysql.db;</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from mysql.db;</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from mysql.db <span class="built_in">where</span> db=<span class="string">&quot;库名&quot;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; update mysql.db <span class="built_in">set</span> 字段名=<span class="string">&quot;值&quot;</span> <span class="built_in">where</span> 条件;flush privilege;</span><br></pre></td></tr></table></figure>

<h2 id="tables-priv表"><a href="#tables-priv表" class="headerlink" title="tables_priv表"></a>tables_priv表</h2><ul>
<li>记录已有授权用户，对<strong>表</strong>的访问权限</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc mysql.tables_priv;</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from mysql.tables_priv;</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from mysql.tables_priv <span class="built_in">where</span> db=<span class="string">&quot;表名&quot;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; update mysql.tables_priv <span class="built_in">set</span> 字段名=<span class="string">&quot;值&quot;</span> <span class="built_in">where</span> 条件;flush privilege;</span><br></pre></td></tr></table></figure>

<h2 id="columns-priv表"><a href="#columns-priv表" class="headerlink" title="columns_priv表"></a>columns_priv表</h2><ul>
<li>记录已有授权用户，对<strong>字段</strong>的访问权限</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc mysql.columns_priv;</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from mysql.columns_priv;</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from mysql.columns_priv <span class="built_in">where</span> db=<span class="string">&quot;表名&quot;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; update mysql.columns_priv <span class="built_in">set</span> 字段名=<span class="string">&quot;值&quot;</span> <span class="built_in">where</span> 条件;flush privilege;</span><br></pre></td></tr></table></figure>

<h1 id="撤销权限"><a href="#撤销权限" class="headerlink" title="撤销权限"></a>撤销权限</h1><h2 id="删除用户权限"><a href="#删除用户权限" class="headerlink" title="删除用户权限"></a>删除用户权限</h2><ul>
<li><p>revoke 权限列表 on 库名.表名 from 用户名@”客户端地址”;</p>
<p>库名必须和授权时的表示方式一样</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; revoke all on *.* from root@<span class="string">&quot;%&quot;</span> ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; revoke select on *.* from user2@<span class="string">&quot;192.168.1.%&quot;</span> ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h2><ul>
<li>登录用户使用</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>select user();</td>
<td>显示登录用户及客户端地址</td>
</tr>
<tr>
<td>show grants;</td>
<td>用户显示自身访问权限</td>
</tr>
<tr>
<td>show grants for 用户名@”客户端地址”;</td>
<td>管理员查看已有授权用户权限</td>
</tr>
<tr>
<td>set password = password(“密码”);</td>
<td>授权用户连接后修改连接密码</td>
</tr>
<tr>
<td>set password for 用户名@”客户端地址” = password(“密码”);</td>
<td>管理员重置授权用户密码</td>
</tr>
<tr>
<td>drop user 用户名@”客户端地址”;</td>
<td>删除授权用户(必须有管理员权限)</td>
</tr>
</tbody></table>
<h1 id="root密码管理"><a href="#root密码管理" class="headerlink" title="root密码管理"></a>root密码管理</h1><h2 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h2><ul>
<li>操作系统管理员有此权限</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mysqladmin -uroot -p password</span></span><br><span class="line">Enter password: 旧密码</span><br><span class="line">New password: 新密码</span><br><span class="line">Confirm new password: 再次输入新密码</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># mysqladmin -u root -p password</span></span><br><span class="line">Enter password: </span><br><span class="line">New password: </span><br><span class="line">Confirm new password:</span><br></pre></td></tr></table></figure>

<h2 id="破解root密码-无密码登录"><a href="#破解root密码-无密码登录" class="headerlink" title="破解root密码 - 无密码登录"></a>破解root密码 - 无密码登录</h2><ul>
<li>操作系统管理员有此权限</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart mariadb</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql</span></span><br><span class="line">Welcome to the mysqlonitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 31</span><br><span class="line"></span><br><span class="line">Server version: 10.1.20-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h2 id="破解线上服务器root密码"><a href="#破解线上服务器root密码" class="headerlink" title="破解线上服务器root密码"></a>破解线上服务器root密码</h2><ul>
<li>拷贝其他服务器的mysql库 覆盖本机的mysql库</li>
<li>修改所有者/组用户为mysql</li>
<li>yum -y install psmisc; pstree -p | grep mysqld</li>
<li>重载mysql进程 kill -SIGHUP mysqld服务父进程pid号</li>
<li>使用密码登录</li>
</ul>
<h1 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h1><h2 id="数据备份方式"><a href="#数据备份方式" class="headerlink" title="数据备份方式"></a>数据备份方式</h2><ul>
<li><p>物理备份（拷贝数据库目录）</p>
<p>cp、tar、……</p>
</li>
<li><p>逻辑备份（mysql软件自带命令和安装第三方提供的软件）</p>
<p>mysqldump 备份命令</p>
</li>
</ul>
<h2 id="数据备份策略"><a href="#数据备份策略" class="headerlink" title="数据备份策略"></a>数据备份策略</h2><ul>
<li><p>完全备份</p>
<p>备份所有数据 </p>
</li>
<li><p>增量备份</p>
<p>备份上次备份后，所有新产生的数据</p>
</li>
<li><p>差异备份</p>
<p>完全备份后，所有新产生的数据</p>
</li>
</ul>
<h2 id="备份策略应用"><a href="#备份策略应用" class="headerlink" title="备份策略应用"></a>备份策略应用</h2><ul>
<li>完全备份</li>
<li>完全备份+差异备份</li>
<li>完全备份+增量备份</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>备份步骤</th>
<th>完全备份</th>
<th>差异备份</th>
<th>增量备份</th>
</tr>
</thead>
<tbody><tr>
<td>第1次</td>
<td>备份原有数据A</td>
<td>数据A</td>
<td></td>
<td></td>
</tr>
<tr>
<td>第2次</td>
<td>已经插入数据B</td>
<td>数据A,数据B</td>
<td>数据B</td>
<td>数据B</td>
</tr>
<tr>
<td>第3次</td>
<td>已经插入数据C</td>
<td>数据A,数据B,数据C</td>
<td>数据B,数据C</td>
<td>数据C</td>
</tr>
</tbody></table>
<h2 id="物理备份与恢复"><a href="#物理备份与恢复" class="headerlink" title="物理备份与恢复"></a>物理备份与恢复</h2><ul>
<li><p>备份</p>
<p>cp -r /var/lib/mysql /root/mysql.bak</p>
<p>tar -zcvf /root/mysql.tar.gz /var/lib/mysql/*</p>
</li>
<li><p>恢复操作</p>
<p>cp -r /root/mysql.bak /var/lib/mysql/</p>
<p>tar -zxvf /root/mysql.tar.gz -C /var/lib/mysql/</p>
<p>chown -R mysql:mysql /var/lib/mysql</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@controller mysql]<span class="comment"># systemctl stop mariadb</span></span><br><span class="line">[root@controller ~]<span class="comment"># tar -zcvf /root/mysql.tar.gz /var/lib/mysql/* </span></span><br><span class="line"><span class="comment">###最好去mysql目录下压缩，否则可能把整个路径压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#数据库正在被访问时，套接字文件不会被压缩 需要把数据库服务关闭再次压缩</span></span><br><span class="line">tar: /var/lib/mysql/mysql.sock: socket ignored</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg mysql.tar.gz</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># rm -rf /var/lib/mysql/*</span></span><br><span class="line">[root@controller ~]<span class="comment"># ls /var/lib/mysql/</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># tar -zxf mysql.tar.gz -C /var/lib/mysql/ </span></span><br><span class="line">[root@controller ~]<span class="comment"># chown -R mysql:mysql /var/lib/mysql/</span></span><br><span class="line">[root@controller mysql]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<h2 id="逻辑备份"><a href="#逻辑备份" class="headerlink" title="逻辑备份"></a>逻辑备份</h2><h3 id="数据库完全备份与恢复"><a href="#数据库完全备份与恢复" class="headerlink" title="数据库完全备份与恢复"></a>数据库完全备份与恢复</h3><ul>
<li><p>完全备份</p>
<p>mysqldump -uroot -p密码 库名 &gt; /目录/xxx.sql</p>
</li>
<li><p>完全恢复</p>
<p>mysql -uroot -p密码 [库名] &lt; /目录/xxx.sql</p>
</li>
</ul>
<h3 id="库名表示方式"><a href="#库名表示方式" class="headerlink" title="库名表示方式"></a>库名表示方式</h3><ul>
<li>-A 整台服务器的所有数据</li>
<li>-B 备份一个库或多个库的所有数据</li>
<li>库名 表名列表 备份一张表或多张表</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###备份所有库</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysqldump -uroot -p000000 -A &gt; mysql-all.sql</span></span><br><span class="line">[root@controller ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg mysql-all.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">###备份一个库</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysqldump -uroot -p000000 -B mysql &gt; mysql-my.sql</span></span><br><span class="line">[root@controller ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg mysql-all.sql mysql-my.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">###备份多个库</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysqldump -uroot -p000000 -B mysql keystone &gt; mysql-mk.sql</span></span><br><span class="line">[root@controller ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg mysql-all.sql mysql-mk.sql mysql-my.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">###备份多个表</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysqldump -uroot -p000000 \</span></span><br><span class="line">keystone access_token whitelisted_config user_option user_group_membership\</span><br><span class="line"> &gt; keystone.sql</span><br><span class="line">[root@controller ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg keystone.sql mysql-all.sql mysql-mk.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">###数据恢复</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000 &lt; mysql-mk.sql</span></span><br><span class="line">or</span><br><span class="line">mysql&gt; <span class="built_in">source</span> /root/mysql-mk.sql</span><br></pre></td></tr></table></figure>

<h1 id="binlog日志管理"><a href="#binlog日志管理" class="headerlink" title="binlog日志管理"></a>binlog日志管理</h1><h2 id="binlog日志介绍"><a href="#binlog日志介绍" class="headerlink" title="binlog日志介绍"></a>binlog日志介绍</h2><ul>
<li>也称做 二进制日志</li>
<li>MySQL服务日志文件的一种，记录除查询之外的所有SQL命令</li>
<li>可用于数据库备份和恢复</li>
<li>配置mysql主从同步的必要条件</li>
</ul>
<h2 id="启动日志"><a href="#启动日志" class="headerlink" title="启动日志"></a>启动日志</h2><table>
<thead>
<tr>
<th>配置项</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>server_id = 数字</td>
<td>指定id值(1~255)</td>
</tr>
<tr>
<td>log_bin[=/目录名/文件名(自定义)]</td>
<td>启用binlog日志</td>
</tr>
<tr>
<td>max_binlog_size=数字m</td>
<td>指定日志文件容量，默认1G</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log_bin</span><br><span class="line">server_id=1</span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| File               | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| mariadb-bin.000001 | 8491     |              |                  |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="创建新的日志文件"><a href="#创建新的日志文件" class="headerlink" title="创建新的日志文件"></a>创建新的日志文件</h2><ul>
<li>systemctl restart mariadb</li>
<li>mysql&gt; flush logs;</li>
<li>mysqldump –flush-logs/-F</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@controller mysql]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line">[root@controller mysql]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| File               | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| mariadb-bin.000002 | 583      |              |                  |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush logs;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| File               | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| mariadb-bin.000003 | 370      |              |                  |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># mysqldump -uroot -p000000 -F -A &gt; all.sql</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| File               | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| mariadb-bin.000012 | 1140     |              |                  |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="清理日志"><a href="#清理日志" class="headerlink" title="清理日志"></a>清理日志</h2><ul>
<li><p>删除指定编号之前的binlog日志文件</p>
<p>mysql&gt; purge master logs to “binlog文件名”;</p>
</li>
<li><p>删除所有binlog日志，重建新日志</p>
<p>mysql&gt; reset master;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查看所有binog日志</span></span><br><span class="line">[root@controller ~]<span class="comment"># ls /var/lib/mysql/ |grep mariadb-bin.0</span></span><br><span class="line">mariadb-bin.000001</span><br><span class="line">mariadb-bin.000002</span><br><span class="line">mariadb-bin.000003</span><br><span class="line">mariadb-bin.000004</span><br><span class="line">mariadb-bin.000005</span><br><span class="line">mariadb-bin.000006</span><br><span class="line">mariadb-bin.000007</span><br><span class="line">mariadb-bin.000008</span><br><span class="line">mariadb-bin.000009</span><br><span class="line">mariadb-bin.000010</span><br><span class="line">mariadb-bin.000011</span><br><span class="line">mariadb-bin.000012</span><br><span class="line"></span><br><span class="line"><span class="comment">###删掉12号之前的日志</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line">mysql&gt; purge master logs to <span class="string">&quot;mariadb-bin.000012&quot;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># ls /var/lib/mysql/ |grep mariadb-bin.0</span></span><br><span class="line">mariadb-bin.000012</span><br><span class="line"></span><br><span class="line"><span class="comment">###删除所有日志，重新创建</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line"></span><br><span class="line">mysql&gt; reset master;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; show master status;</span><br><span class="line"></span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| File               | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">| mariadb-bin.000001 | 1589     |              |                  |</span><br><span class="line">+--------------------+----------+--------------+------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="binlog日志恢复"><a href="#binlog日志恢复" class="headerlink" title="binlog日志恢复"></a>binlog日志恢复</h2><h3 id="使用日志恢复所有数据"><a href="#使用日志恢复所有数据" class="headerlink" title="使用日志恢复所有数据"></a>使用日志恢复所有数据</h3><p>命令格式（增量）</p>
<p>mysqlbinlog 日志文件名 | mysql -uroot -p密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mysqlbinlog mariadb-bin.000001 | mysql -uroot -p000000</span></span><br></pre></td></tr></table></figure>

<h3 id="使用日志恢复部分数据"><a href="#使用日志恢复部分数据" class="headerlink" title="使用日志恢复部分数据"></a>使用日志恢复部分数据</h3><p>记录SQL命令的方法</p>
<ul>
<li><p>日志如何区分记录的多条SQL命令</p>
<p>记录命令执行的时间</p>
<p>记录命令执行时的偏移量</p>
<p><code>mariadb-bin.000001 | 1589</code> #1589为偏移量</p>
</li>
<li><p>查看日志内容</p>
<p>mysqlbinlog /目录名/日志名</p>
</li>
</ul>
<h3 id="命令格式-2"><a href="#命令格式-2" class="headerlink" title="命令格式"></a>命令格式</h3><p>mysqlbinlog 选项 日志文件名 | mysql -uroot -p密码</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>–start-datetime=”yyyy-mm-dd hh:mm:ss”</td>
<td>起始时间</td>
</tr>
<tr>
<td>–stop-datetime=”yyyy-mm-dd hh:mm:ss”</td>
<td>结束时间</td>
</tr>
<tr>
<td>–start-position=数字</td>
<td>起始偏移量</td>
</tr>
<tr>
<td>–stop-position=数字</td>
<td>结束偏移量</td>
</tr>
</tbody></table>
<h2 id="日志格式"><a href="#日志格式" class="headerlink" title="日志格式"></a>日志格式</h2><ul>
<li>报表格式 statement</li>
<li>行格式 row(默认)</li>
<li>混合格式 mixed</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mysql -e &quot;show variables like &#x27;binlog_format&#x27;;&quot;</span></span><br><span class="line">+---------------+-----------+</span><br><span class="line">| Variable_name | Value     |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| binlog_format | STATEMENT |</span><br><span class="line">+---------------+-----------+</span><br><span class="line"><span class="comment">###查看日志内容</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysqlbinlog /var/lib/mysql/mariadb-bin.000001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -e &quot;show variables like &#x27;binlog_format&#x27;;&quot;</span></span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">[root@controller ~]<span class="comment"># mysqlbinlog /var/lib/mysql/mariadb-bin.000003</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -e &quot;show variables like &#x27;binlog_format&#x27;;&quot;</span></span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | MIXED |</span><br><span class="line">+---------------+-------+</span><br><span class="line">[root@controller ~]<span class="comment"># mysqlbinlog /var/lib/mysql/mariadb-bin.000004</span></span><br></pre></td></tr></table></figure>

<h1 id="innobackupex"><a href="#innobackupex" class="headerlink" title="innobackupex"></a>innobackupex</h1><h2 id="常用的MySQL备份工具"><a href="#常用的MySQL备份工具" class="headerlink" title="常用的MySQL备份工具"></a>常用的MySQL备份工具</h2><ul>
<li><p>物理备份缺点</p>
<p>跨平台性差</p>
<p>备份时间长、冗余备份、浪费存储空间</p>
</li>
<li><p>mysqldump备份缺点</p>
<p>效率较低、备份和还原速度慢、锁表</p>
<p>备份过程中，数据插入和更新操作被阻塞</p>
</li>
</ul>
<h2 id="innobackupex工具"><a href="#innobackupex工具" class="headerlink" title="innobackupex工具"></a>innobackupex工具</h2><ul>
<li><p>一款强大的在线热备份工具</p>
<p>备份过程中不锁表，适合生产环境</p>
<p>由专业组织Percona提供（改进MySQL分支）</p>
</li>
<li><p>主要有两个组件</p>
<p>xtrabckup：C程序，支持InnoDB/XtraDB</p>
<p>innobackupex：以Perl脚本封装xtrabackup，还支持MyISAM</p>
</li>
</ul>
<h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h2><p>yum安装自动解决依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-8.0.4/binary/\</span><br><span class="line">redhat/7/x86_64/percona-xtrabackup-80-8.0.4-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>yum install -y percona-xtrabackup-80-8.0.4-1.el7.x86_64.rpm</p>
<h2 id="完全备份"><a href="#完全备份" class="headerlink" title="完全备份"></a>完全备份</h2><ul>
<li><p>命令格式</p>
<p>innobackupex –user 用户名 –password 密码</p>
<p> [–databases=”数据库名”] 备份目录名 [–no-timestamp]</p>
<p>–databases=”库名” #一个库</p>
<p>–databases=”库1,库2” #多个库</p>
<p>–databases=”库名.表名” #一张表</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>常用选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–user</td>
<td>用户名</td>
</tr>
<tr>
<td>–password</td>
<td>密码</td>
</tr>
<tr>
<td>–databases</td>
<td>数据库名</td>
</tr>
<tr>
<td>–no-timestamp</td>
<td>不用日期命名备份文件存储的子目录名</td>
</tr>
</tbody></table>
<h2 id="完全恢复"><a href="#完全恢复" class="headerlink" title="完全恢复"></a>完全恢复</h2><ul>
<li>systemctl stop mysqld #停止数据库服务</li>
<li>rm -rf /var/lib/mysql/* #清空数据库目录</li>
<li>innobackupex –apply-log 备份目录名 #准备恢复数据</li>
<li>innobackupex –copy-back 备份目录名 #恢复数据</li>
<li>chown -R mysql:mysql /var/lib/mysql/ #修改所有者和组</li>
<li>systemctl start mysqld #启动服务</li>
</ul>
<h2 id="恢复单张表"><a href="#恢复单张表" class="headerlink" title="恢复单张表"></a>恢复单张表</h2><ul>
<li>删除表空间 （数据库目录下 “表名.ibd”）</li>
<li>导出表信息</li>
<li>拷贝表信息文件到数据库目录下</li>
<li>修改表信息文件所有者及组用户为mysql</li>
<li>导入表空间</li>
<li>删除数据库目录下的表信息文件</li>
<li>查看表记录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除表空间</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -e &quot;alter table 库名.表名 discard tablespace;&quot; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导出表信息</span></span><br><span class="line">[root@controller ~]<span class="comment"># innobackupex --apply-log --export 数据完全备份目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#拷贝表信息文件到数据库目录下</span></span><br><span class="line">[root@controller ~]<span class="comment"># cp /数据库完全备份目录/数据库名目录/表明.&#123;ibd,cfg,exp&#125; 数据库目录/库名目录/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改表信息文件所有者及组用户为mysql</span></span><br><span class="line">[root@controller ~]<span class="comment"># chown -R mysql:mysql /数据库目录名/库名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导入表空间</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -e &quot;alter table 库名.表名 import tablespace;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看表记录</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -e &quot;select * from 库名.表名;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除表信息</span></span><br><span class="line">[root@controller ~]<span class="comment"># rm -rf /数据库目录/库名/表名.&#123;cfg,exp&#125;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>常用选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–export</td>
<td>导出表信息</td>
</tr>
<tr>
<td>import</td>
<td>导入表空间</td>
</tr>
</tbody></table>
<h2 id="增量备份和恢复"><a href="#增量备份和恢复" class="headerlink" title="增量备份和恢复"></a>增量备份和恢复</h2><h3 id="增量备份：备份上次备份后产生的数据"><a href="#增量备份：备份上次备份后产生的数据" class="headerlink" title="增量备份：备份上次备份后产生的数据"></a>增量备份：备份上次备份后产生的数据</h3><ul>
<li>备份时必须先有一次备份，通常是完全备份</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##完全备份</span></span><br><span class="line"><span class="comment"># innobackupex --user root --password 密码 /fullbak \</span></span><br><span class="line">--no-timestamp </span><br><span class="line"></span><br><span class="line"><span class="comment">##增量备份</span></span><br><span class="line"><span class="comment"># innobackupex --user root --password 密码 --incremental /new1dir \</span></span><br><span class="line">--incremental-basedir=/fullbak --no-timestamp</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>常用选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–incremental 目录名</td>
<td>增量备份</td>
</tr>
<tr>
<td>–incremental-basedir=目录名</td>
<td>增量备份时，指定上次备份数据存储的目录名</td>
</tr>
</tbody></table>
<h3 id="增量备份过程"><a href="#增量备份过程" class="headerlink" title="增量备份过程"></a>增量备份过程</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># cat /备份目录/xtrabackup——checkpoints</span></span><br><span class="line">backup_type = full-prepared <span class="comment">#数据备份类型</span></span><br><span class="line">from_lsn = 0 <span class="comment">#记录当前备份的数据lsn开始位置</span></span><br><span class="line">to_lsn = 3248354 <span class="comment">#记录当前备份的数据lsn结束位置</span></span><br><span class="line">last_lsn = 3248354 <span class="comment">#记录当前备份完成后数据库目录下日志文件中lsn位置</span></span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line">lsn ： 日志序列号 事务日志文件用来区分记录的sql命令</span><br></pre></td></tr></table></figure>

<h3 id="增量恢复"><a href="#增量恢复" class="headerlink" title="增量恢复"></a>增量恢复</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># innobackupex --apply-log --redo-only 完全备份目录     #准备恢复</span></span><br><span class="line"><span class="comment"># innobackupex --apply-log --redo-only 完全备份目录 \</span></span><br><span class="line">--incremental-dir=增量备份目录                          <span class="comment">#合并数据</span></span><br><span class="line"><span class="comment"># systemctl stop mysqld</span></span><br><span class="line"><span class="comment"># rm -rf /var/lib/mysql/*</span></span><br><span class="line"><span class="comment"># innobackupex --copy-back 完全备份目录                 #拷贝数据</span></span><br><span class="line"><span class="comment"># chown -R mysql:mysql /var/lib/mysql</span></span><br><span class="line"><span class="comment"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>常用选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–redo-only</td>
<td>日志合并</td>
</tr>
<tr>
<td>–apply-log</td>
<td>准备恢复数据</td>
</tr>
<tr>
<td>–incremental-dir=目录名</td>
<td>准备恢复数据时，指定增量备份数据存储的目录名</td>
</tr>
</tbody></table>
<p>合并后xtrabackupex_checkpoints文件内容会发生改变</p>
<p>to_lsn 和 last_lsn 变为增量备份结束位置</p>
<h1 id="MySQL主从数据库"><a href="#MySQL主从数据库" class="headerlink" title="MySQL主从数据库"></a>MySQL主从数据库</h1><h2 id="MySQL主从数据库概述"><a href="#MySQL主从数据库概述" class="headerlink" title="MySQL主从数据库概述"></a>MySQL主从数据库概述</h2><h3 id="主从同步介绍"><a href="#主从同步介绍" class="headerlink" title="主从同步介绍"></a>主从同步介绍</h3><ul>
<li>实现数据自动同步的服务结构</li>
<li>主服务器（master）：接受客户端访问连接</li>
<li>从服务器（slave）：自动同步主服务器数据</li>
</ul>
<p><img src="../../../../images/image/SQL/1.png" alt="1.png"></p>
<ul>
<li><p>Master</p>
<p>启用binlog日志</p>
</li>
<li><p>Slave</p>
<p>Slave_IO: 复制master主机binlog日志文件里的SQL命令到本机的relay-log文件里</p>
<p>Slave_IO: 执行本机relay-log文件里的SQL语句，实现与Master数据一致</p>
</li>
</ul>
<h3 id="主从结构模式"><a href="#主从结构模式" class="headerlink" title="主从结构模式"></a>主从结构模式</h3><ul>
<li><p>基本应用</p>
<p>单项复制： 一主  –&gt;   一从</p>
</li>
<li><p>扩展应用</p>
<p>一主多从:   从  &lt;– 主 –&gt; 从</p>
<p>链式复制:   主  –&gt; 从 –&gt; 从</p>
<p>互为主从:    主 &lt;–&gt; 主</p>
</li>
</ul>
<h2 id="配置一主一从结构"><a href="#配置一主一从结构" class="headerlink" title="配置一主一从结构"></a>配置一主一从结构</h2><h3 id="配置主服务器"><a href="#配置主服务器" class="headerlink" title="配置主服务器"></a>配置主服务器</h3><ul>
<li>启用binlog日志、授权用户、查看binlog日志信息</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log_bin=日志名           <span class="comment">#启用binlog日志</span></span><br><span class="line">server_id=<span class="built_in">id</span>值          <span class="comment">#指定服务器id</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on *.* to repluser@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&quot;000000&quot;</span>;</span><br><span class="line">mysql&gt; show master status;</span><br></pre></td></tr></table></figure>

<h3 id="配置从服务器"><a href="#配置从服务器" class="headerlink" title="配置从服务器"></a>配置从服务器</h3><ul>
<li>只当server_id</li>
<li>指定主服务器信息</li>
<li>启动slave进程</li>
<li>查看slave状态</li>
<li>测试配置</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; change master to master_host=<span class="string">&quot;192.168.1.10&quot;</span>,</span><br><span class="line">master_user=<span class="string">&quot;repluser&quot;</span>,master_password=<span class="string">&quot;000000&quot;</span>,master_log_file=<span class="string">&quot;mysql-bin.000001&quot;</span>,master_log_pos=334;</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">mysql&gt; show slave status \G</span><br><span class="line"></span><br><span class="line">    Slave_IO_Running: Yes      <span class="comment">#IO线程已运行</span></span><br><span class="line">    Slave_SQL_Running: Yes      <span class="comment">#SQL线程已运行</span></span><br></pre></td></tr></table></figure>

<h3 id="相关文件"><a href="#相关文件" class="headerlink" title="相关文件"></a>相关文件</h3><ul>
<li>存放在数据库目录下</li>
<li>删除文件，重启数据库服务，可把主机恢复为独立的数据库服务器</li>
</ul>
<table>
<thead>
<tr>
<th>文件名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>master.info</td>
<td>主库信息</td>
</tr>
<tr>
<td>relay-log.info</td>
<td>中继日志信息</td>
</tr>
<tr>
<td>主机名-relay-bin.xxxxxxx</td>
<td>中继日志</td>
</tr>
<tr>
<td>主机名-relay-bin.index</td>
<td>索引文件</td>
</tr>
</tbody></table>
<h2 id="配置MySQL一主多从"><a href="#配置MySQL一主多从" class="headerlink" title="配置MySQL一主多从"></a>配置MySQL一主多从</h2><h3 id="必须确保主从数据服务器数据一致"><a href="#必须确保主从数据服务器数据一致" class="headerlink" title="必须确保主从数据服务器数据一致"></a>必须确保主从数据服务器数据一致</h3><h3 id="配置从服务器-1"><a href="#配置从服务器-1" class="headerlink" title="配置从服务器"></a>配置从服务器</h3><ul>
<li>指定server_id</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">server_id=<span class="built_in">id</span>值          <span class="comment">#指定服务器id</span></span><br><span class="line"></span><br><span class="line">[root@node ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<ul>
<li>指定主服务器</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; change master to master_host=<span class="string">&quot;192.168.1.10&quot;</span>,</span><br><span class="line">master_user=<span class="string">&quot;repluser&quot;</span>,master_password=<span class="string">&quot;000000&quot;</span>,master_log_file=<span class="string">&quot;mysql-bin.000001&quot;</span>,master_log_pos=334;</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">mysql&gt; show slave status \G</span><br><span class="line"></span><br><span class="line">    Slave_IO_Running: Yes      <span class="comment">#IO线程已运行</span></span><br><span class="line">    Slave_SQL_Running: Yes      <span class="comment">#SQL线程已运行</span></span><br></pre></td></tr></table></figure>

<h2 id="配置MySQL主从从结构"><a href="#配置MySQL主从从结构" class="headerlink" title="配置MySQL主从从结构"></a>配置MySQL主从从结构</h2><h3 id="配置主服务器-1"><a href="#配置主服务器-1" class="headerlink" title="配置主服务器"></a>配置主服务器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log_bin=日志名           <span class="comment">#启用binlog日志</span></span><br><span class="line">server_id=<span class="built_in">id</span>值          <span class="comment">#指定服务器id</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on *.* to repluser@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&quot;000000&quot;</span>;</span><br><span class="line">mysql&gt; show master status;</span><br></pre></td></tr></table></figure>

<h3 id="配置从服务器-2"><a href="#配置从服务器-2" class="headerlink" title="配置从服务器"></a>配置从服务器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log_bin=日志名           <span class="comment">#启用binlog日志</span></span><br><span class="line">log_slave_updates       <span class="comment">#允许级联复制</span></span><br><span class="line">server_id=<span class="built_in">id</span>值          <span class="comment">#指定服务器id</span></span><br><span class="line"></span><br><span class="line">[root@node1 ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line">mysql&gt; change master to master_host=<span class="string">&quot;192.168.1.10&quot;</span>,</span><br><span class="line">master_user=<span class="string">&quot;repluser&quot;</span>,master_password=<span class="string">&quot;000000&quot;</span>,master_log_file=<span class="string">&quot;mysql-bin.000001&quot;</span>,master_log_pos=334;</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">mysql&gt; show slave status \G</span><br><span class="line"></span><br><span class="line">    Slave_IO_Running: Yes      <span class="comment">#IO线程已运行</span></span><br><span class="line">    Slave_SQL_Running: Yes      <span class="comment">#SQL线程已运行</span></span><br></pre></td></tr></table></figure>

<h3 id="配置从从服务器"><a href="#配置从从服务器" class="headerlink" title="配置从从服务器"></a>配置从从服务器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">server_id=<span class="built_in">id</span>值          <span class="comment">#指定服务器id</span></span><br><span class="line"></span><br><span class="line">[root@node2 ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line">mysql&gt; change master to master_host=<span class="string">&quot;192.168.1.10&quot;</span>,</span><br><span class="line">master_user=<span class="string">&quot;repluser&quot;</span>,master_password=<span class="string">&quot;000000&quot;</span>,master_log_file=<span class="string">&quot;mysql-bin.000001&quot;</span>,master_log_pos=334;</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">mysql&gt; show slave status \G</span><br><span class="line"></span><br><span class="line">    Slave_IO_Running: Yes      <span class="comment">#IO线程已运行</span></span><br><span class="line">    Slave_SQL_Running: Yes      <span class="comment">#SQL线程已运行</span></span><br></pre></td></tr></table></figure>

<h2 id="MySQL主从同步复制模式介绍"><a href="#MySQL主从同步复制模式介绍" class="headerlink" title="MySQL主从同步复制模式介绍"></a>MySQL主从同步复制模式介绍</h2><h3 id="异步复制"><a href="#异步复制" class="headerlink" title="异步复制"></a>异步复制</h3><ul>
<li><p>Asynchronous replication （默认方式）</p>
<p>主数据库执行完一次事务后，立即将结果返回给客户端，不关心从服务器是否已经同步数据</p>
</li>
</ul>
<h3 id="半同步复制"><a href="#半同步复制" class="headerlink" title="半同步复制"></a>半同步复制</h3><ul>
<li><p>Semisynchronous replication</p>
<p>主服务器在执行完一次事务后，等待至少一台从服务器同步数据完成，才将结果返回给客户端</p>
</li>
</ul>
<h3 id="半同步命令行配置（临时）"><a href="#半同步命令行配置（临时）" class="headerlink" title="半同步命令行配置（临时）"></a>半同步命令行配置（临时）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###加载master模块</span></span><br><span class="line">mysql&gt; install plugin rpl_semi_sync_master SONAME <span class="string">&quot;semisync_master.so&quot;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###加载slave模块</span></span><br><span class="line">mysql&gt; install plugin rpl_semi_sync_master SONAME <span class="string">&quot;semisync_master.so&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">###slave模块启用</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global rpl_semi_sync_master_enabled=1;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">###slave模块启用（若只是maser时不需要开启）同为master和slave开启</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global rpl_semi_sync_slave_enabled=1;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>

<h3 id="半同步永久配置"><a href="#半同步永久配置" class="headerlink" title="半同步永久配置"></a>半同步永久配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment">###加载模块</span></span><br><span class="line">plugin-load=<span class="string">&quot;rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so&quot;</span></span><br><span class="line"><span class="comment">###启用模块</span></span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_slave_enabled=1</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">&quot;rpl_semi_sync_%_enabled&quot;</span>;</span><br><span class="line">+------------------------------+-------+</span><br><span class="line">| Variable_name                | Value |</span><br><span class="line">+------------------------------+-------+</span><br><span class="line">| rpl_semi_sync_master_enabled | ON    |</span><br><span class="line">| rpl_semi_sync_slave_enabled  | ON    |</span><br><span class="line">+------------------------------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="MyCAT读写分离"><a href="#MyCAT读写分离" class="headerlink" title="MyCAT读写分离"></a>MyCAT读写分离</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>各节点配置主机名、IP、关闭防火墙、关闭selinux、同步时间</p>
<h2 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h2><p>MyCAT是使用Java开放的，因此需要先安装JDK</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###安装JDK</span></span><br><span class="line">[root@node1 ~]<span class="comment"># yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###验证JDK版本</span></span><br><span class="line">[root@node1 ~]<span class="comment"># java -version</span></span><br><span class="line">openjdk version <span class="string">&quot;1.8.0_342&quot;</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_342-b07)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.342-b07, mixed mode)</span><br></pre></td></tr></table></figure>

<h2 id="安装MyCAT"><a href="#安装MyCAT" class="headerlink" title="安装MyCAT"></a>安装MyCAT</h2><p>事先将MyCAT的二进制软件包Mycat-server-1.6.tar.gz上传到Mycat节点的/root目录下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment">#  cp /opt/Mycat-server-1.6-RELEASE-linux.tar.gz /root/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###将MyCAT软件包解压到/user/local目录</span></span><br><span class="line">[root@node1 ~]<span class="comment"># tar -xf Mycat-server-1.6-RELEASE-linux.tar.gz -C /usr/local/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###赋予mycat目录权限</span></span><br><span class="line">[root@node1 ~]<span class="comment"># chown -R 777 /usr/local/mycat/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###添加mycat服务的环境变量</span></span><br><span class="line">[root@node1 ~]<span class="comment"># echo &quot;export PATH=$PATH:/usr/local/mycat/bin&quot; &gt;&gt; /etc/profile</span></span><br><span class="line">[root@node1 ~]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure>

<h2 id="配置MyCAT读写分离"><a href="#配置MyCAT读写分离" class="headerlink" title="配置MyCAT读写分离"></a>配置MyCAT读写分离</h2><p>配置MyCAT实现读写分离需要修改两个配置文件。</p>
<ul>
<li>schema.xml：用于配置读写分离规则。它管理着逻辑库、分片表、分片节点和分片主机等信息。</li>
<li>server.xml：用于配置用户访问规则。</li>
</ul>
<h3 id="配置读写分离规则"><a href="#配置读写分离规则" class="headerlink" title="配置读写分离规则"></a>配置读写分离规则</h3><ul>
<li>在这里定义⼀个逻辑库(schema)USERDB。</li>
<li>逻辑库 USERDB 对应数据库为 test（在部署主从数据库时已创建）。</li>
<li>设置数据库写入节点为主节点 192.168.137.102。</li>
<li>设置数据库读取节点为从节点 192.168.137.103。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># vi /usr/local/mycat/conf/schema.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM <span class="string">&quot;schema.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mycat:schema xmlns:mycat=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span><br><span class="line">  &lt;schema name=<span class="string">&quot;USERDB&quot;</span> checkSQLschema=<span class="string">&quot;true&quot;</span> sqlMaxLimit=<span class="string">&quot;100&quot;</span> dataNode=<span class="string">&quot;dn</span></span><br><span class="line"><span class="string">   1&quot;</span>&gt;&lt;/schema&gt;</span><br><span class="line">  &lt;dataNode name=<span class="string">&quot;dn1&quot;</span> dataHost=<span class="string">&quot;localhost1&quot;</span> database=<span class="string">&quot;test&quot;</span> /&gt;</span><br><span class="line">  &lt;dataHost name=<span class="string">&quot;localhost1&quot;</span> maxCon=<span class="string">&quot;1000&quot;</span> minCon=<span class="string">&quot;10&quot;</span> balance=<span class="string">&quot;3&quot;</span> dbType=</span><br><span class="line">   <span class="string">&quot;mysql&quot;</span> dbDriver=<span class="string">&quot;native&quot;</span> writeType=<span class="string">&quot;0&quot;</span> switchType=<span class="string">&quot;1&quot;</span> slaveThreshold=<span class="string">&quot;10</span></span><br><span class="line"><span class="string">  0&quot;</span>&gt;</span><br><span class="line">  &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">  &lt;writeHost host=<span class="string">&quot;192.168.137.102&quot;</span> url=<span class="string">&quot;192.168.137.102:3306&quot;</span> user=<span class="string">&quot;root&quot;</span> p</span><br><span class="line">   assword=<span class="string">&quot;123456&quot;</span>&gt;</span><br><span class="line">  &lt;readHost host=<span class="string">&quot;192.168.137.103&quot;</span> url=<span class="string">&quot;192.168.137.103:3306&quot;</span> user=<span class="string">&quot;root&quot;</span> pa</span><br><span class="line">   ssword=<span class="string">&quot;123456&quot;</span> /&gt;</span><br><span class="line">  &lt;/writeHost&gt;</span><br><span class="line"> &lt;/dataHost&gt;</span><br><span class="line">&lt;/mycat:schema&gt;</span><br><span class="line">[root@node1 ~]<span class="comment"># chown root:root /usr/local/mycat/conf/schema.xml</span></span><br></pre></td></tr></table></figure>

<p>重要配置项含义如下。</p>
<ul>
<li>sqlMaxLimit：配置默认查询数量。 </li>
<li>database：为真实数据库名。</li>
<li>balance=”0”：不开启读写分离机制，所有读操作都发送到当前可用的 writeHost 上。</li>
<li>balance=”1”：全部的readHost与stand by writeHost参与select语句的负载均衡，简单来说，当双主双从模式（M1-&gt;S1，M2-&gt;S2，并且M1与M2互为主备），正常情况下，M2、S1、S2都参与select语句的负载均衡。    </li>
<li>balance=”2”：所有读操作都随机的在writeHost、readhost上分发。    </li>
<li>balance=”3”：所有读请求随机地分发到wiriterHost对应的readhost执行， writerHost不负担读压力，注意balance=3只在1.4及其以后版本有，1.3版本没有。       </li>
<li>writeType=”0”：所有写操作发送到配置的第一个writeHost，第一个挂了需要切换到还生存的第二个writeHost，重新启动后已切换后的为准，切换记录在配置文件dnindex.properties中。  </li>
<li>writeType=”1”：所有写操作都随机的发送到配置的writeHost。</li>
</ul>
<h3 id="配置用户访问规则"><a href="#配置用户访问规则" class="headerlink" title="配置用户访问规则"></a>配置用户访问规则</h3><p>修改server.xml文件中root用户的访问密码与数据库，密码设置为<strong>123456</strong>，访问Mycat的逻辑库为USERDB。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># vi /usr/local/mycat/conf/server.xml</span></span><br><span class="line">......</span><br><span class="line"><span class="comment">### 保留该部分以上内容，修改以下内容</span></span><br><span class="line">&lt;user name=<span class="string">&quot;root&quot;</span>&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;password&quot;</span>&gt;123456&lt;/property&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;schemas&quot;</span>&gt;USERDB&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 删除以下内容</span></span><br><span class="line">&lt;user name=<span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;password&quot;</span>&gt;user&lt;/property&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;schemas&quot;</span>&gt;TESTDB&lt;/property&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;readOnly&quot;</span>&gt;<span class="literal">true</span>&lt;/property&gt;</span><br><span class="line">&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<h2 id="运行MyCAT"><a href="#运行MyCAT" class="headerlink" title="运行MyCAT"></a>运行MyCAT</h2><p>通过命令启动Mycat数据库中间件服务，启动后使用ss -nltp命令查看虚拟机端口开放情况，如果有开放<strong>8066</strong>和<strong>9066</strong>端口，则表示Mycat服务启动成功。  </p>
<p>Mycat服务默认的数据端口是<strong>8066</strong>，而<strong>9066</strong>端口则是Mycat管理端口，用于管理Mycat的整个集群状态。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># /usr/local/mycat/bin/mycat start</span></span><br><span class="line">Starting Mycat-server...</span><br><span class="line">[root@node1 ~]<span class="comment"># ss -nltp</span></span><br><span class="line">State Recv-Q Send-Q Local Address:Port Peer Addre</span><br><span class="line">ss:Port</span><br><span class="line">LISTEN 0 128 *:80 *:* <span class="built_in">users</span>:((&quot;nginx&quot;,pid=<span class="number">9852</span>,fd=<span class="number">6</span>),(&quot;nginx&quot;,pid=<span class="number">9359</span>,fd=<span class="number">6</span>))</span><br><span class="line">LISTEN 0 128 *:22 *:* <span class="built_in">users</span>:((&quot;sshd&quot;,pid=<span class="number">872</span>,fd=<span class="number">3</span>))</span><br><span class="line">LISTEN 0 100 127.0.0.1:25 *:* <span class="built_in">users</span>:((&quot;master&quot;,pid=<span class="number">1033</span>,fd=<span class="number">13</span>))</span><br><span class="line">LISTEN 0 1 127.0.0.1:32000 *:* <span class="built_in">users</span>:((&quot;java&quot;,pid=<span class="number">16043</span>,fd=<span class="number">4</span>))</span><br><span class="line">LISTEN 0 100 [::]:9066 [::]:* <span class="built_in">users</span>:((&quot;java&quot;,pid=<span class="number">16043</span>,fd=<span class="number">74</span>))</span><br><span class="line">LISTEN 0 50 [::]:34986 [::]:* <span class="built_in">users</span>:((&quot;java&quot;,pid=<span class="number">16043</span>,fd=<span class="number">58</span>))</span><br><span class="line">LISTEN 0 128 [::]:80 [::]:* <span class="built_in">users</span>:((&quot;nginx&quot;,pid=<span class="number">9852</span>,fd=<span class="number">7</span>),(&quot;nginx&quot;,pid=<span class="number">9359</span>,fd=<span class="number">7</span>))</span><br><span class="line">LISTEN 0 50 [::]:45811 [::]:* <span class="built_in">users</span>:((&quot;java&quot;,pid=<span class="number">16043</span>,fd=<span class="number">56</span>))</span><br><span class="line">LISTEN 0 128 [::]:22 [::]:* <span class="built_in">users</span>:((&quot;sshd&quot;,pid=<span class="number">872</span>,fd=<span class="number">4</span>))</span><br><span class="line">LISTEN 0 100 [::1]:25 [::]:* <span class="built_in">users</span>:((&quot;master&quot;,pid=<span class="number">1033</span>,fd=<span class="number">14</span>))</span><br><span class="line">LISTEN 0 50 [::]:1984 [::]:* <span class="built_in">users</span>:((&quot;java&quot;,pid=<span class="number">16043</span>,fd=<span class="number">57</span>))</span><br><span class="line">LISTEN 0 100 [::]:8066 [::]:* <span class="built_in">users</span>:((&quot;java&quot;,pid=<span class="number">16043</span>,fd=<span class="number">78</span>))</span><br></pre></td></tr></table></figure>

<h3 id="如果不能正常启动服务可查看mycat日志"><a href="#如果不能正常启动服务可查看mycat日志" class="headerlink" title="如果不能正常启动服务可查看mycat日志"></a>如果不能正常启动服务可查看mycat日志</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># cat /usr/local/mycat/logs/wrapper.log</span></span><br></pre></td></tr></table></figure>

<h3 id="验证读写分离"><a href="#验证读写分离" class="headerlink" title="验证读写分离"></a>验证读写分离</h3><p>mycat可以认为是⼀个MySQL服务器，对主从两个节点的操作，可以简单认为是对mycat节点的操作。</p>
<p>根据前面的配置，操作主从节点的test数据库，相当于对mycat节点的USERDB数据库进行操作。</p>
<p>可以通过MySQL命令行登录数据端口（<strong>8066</strong>）执行相应的数据操作SQL语句进行管理，也可以通过MySQL命令行登录管<br>理端口（<strong>9066</strong>）执行相应的管理SQL语句进行管理，也可以通过JDBC方式进行远程连接管理。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 安装mariadb客户端</span></span><br><span class="line">[root@node1 ~]<span class="comment"># yum install -y mariadb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 连接mycat服务器，操作USERDB逻辑库</span></span><br><span class="line">[root@node1 ~]<span class="comment"># mysql -h127.0.0.1 -P8066 -uroot -p123456</span></span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 1</span><br><span class="line">Server version: 5.6.29-mycat-1.6-RELEASE-20161028204710 MyCat Server (Open</span><br><span class="line">CloundDB)</span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statem</span><br><span class="line">ent.</span><br><span class="line">MySQL [(none)]&gt; show databases;</span><br><span class="line">+----------+</span><br><span class="line">| DATABASE |</span><br><span class="line">+----------+</span><br><span class="line">| USERDB   |        <span class="comment">###数据库提前创建好了</span></span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">MySQL [(none)]&gt; use USERDB;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line">Database changed</span><br><span class="line">MySQL [USERDB]&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| company        |</span><br><span class="line">+----------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">MySQL [USERDB]&gt; select * from company;</span><br><span class="line">+----+----------+------+</span><br><span class="line">| <span class="built_in">id</span> | name     | addr |</span><br><span class="line">+----+----------+------+</span><br><span class="line">| 1  | facebook | usa  |</span><br><span class="line">+----+----------+------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.04 sec)</span><br><span class="line">MySQL [USERDB]&gt; insert into company values(2,<span class="string">&quot;bastetball&quot;</span>,<span class="string">&quot;usa&quot;</span>);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>通过show@@datasource;语句可查询数据库读写操作的分离信息。   </p>
<ul>
<li>所有的写操作WRITE_LOAD数都在192.168.137.102主数据库节点上。</li>
<li>所有的读取操作READ_LOAD数都在192.168.137.103主数据库节点上。由此可见，数据库读写操作已经分离到192.168.137.102和192.168.137.103节点上了。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看mycat的数据源</span></span><br><span class="line">[root@node1 ~]<span class="comment"># mysql -h127.0.0.1 -P9066 -uroot -p123456 -e &#x27;show @@datasource;&#x27;</span></span><br><span class="line">+----------+-----------------+-------+-----------------+------+------+--------+------+------+---------+-----------+------------+</span><br><span class="line">| DATANODE | NAME            | TYPE  | HOST            | PORT | W/R | ACTIVE | IDLE  | SIZE | EXECUTE | READ_LOAD | WRITE_LOAD |</span><br><span class="line">+----------+-----------------+-------+-----------------+------+------+--------+------+------+---------+-----------+------------+</span><br><span class="line">| dn1      | 192.168.137.102 | mysql | 192.168.137.102 | 3306 | W   | 0      | 10    | 1000 | 67      | 0         | 1          |</span><br><span class="line">| dn1      | 192.168.137.103 | mysql | 192.168.137.103 | 3306 | R   | 0      | 6     | 1000 | 72      | 11        | 0          |</span><br><span class="line">+----------+-----------------+-------+-----------------+------+-----+--------+-------+------+---------+-----------+------------+</span><br></pre></td></tr></table></figure>

<h1 id="数据分片"><a href="#数据分片" class="headerlink" title="数据分片"></a>数据分片</h1><h2 id="数据分片概述"><a href="#数据分片概述" class="headerlink" title="数据分片概述"></a>数据分片概述</h2><p><code>分库分表</code></p>
<ul>
<li>将存放在一台数据库服务器中的数据，按照特定的方式进行<code>拆分</code>、<code>分散</code>存放到多台数据库服务器中，以达到分散单台服务器负载的效果</li>
</ul>
<p><code>水平分割</code></p>
<ul>
<li><p>横向切分</p>
<p>按照表中指定字段的分片规则，将<code>表记录按行</code>切分，分散到多个数据库中</p>
</li>
</ul>
<p><code>垂直分割</code></p>
<ul>
<li><p>纵向切分</p>
<p>将单个数据库的多个表，按业务类型，分散存储到不同的数据库中</p>
</li>
</ul>
<h3 id="Mycat软件介绍"><a href="#Mycat软件介绍" class="headerlink" title="Mycat软件介绍"></a>Mycat软件介绍</h3><ul>
<li>MyCAT是基于Java的数据库系统中间件，为高并发的分布式存储提供解决方案</li>
<li>适合数据大量写入的存储需求</li>
<li>支持MySQL、Oracle、Sqlserver、Mongodb等</li>
<li>提供数据读写分离服务</li>
<li>提供数据分片服务</li>
<li>基于阿里巴巴Cobar进行研发的开源软件</li>
</ul>
<h3 id="分片规则"><a href="#分片规则" class="headerlink" title="分片规则"></a>分片规则</h3><ul>
<li>MyCAT提供了10种分片规则</li>
<li>枚举法 sharding-by-intfile</li>
<li>固定分片 rule1</li>
<li>范围约定 auto-sharding-long</li>
<li>求模法 mod-long</li>
<li>日期列分区法 sharding-by-date</li>
<li>通配取模 sharding-by-pattern</li>
<li>ASCII码求模通配 sharding-by-prefixpatten</li>
<li>编程指定 sharding-by-substring</li>
<li>字符串拆分hash解析 sharding-by-stringhash</li>
<li>一致性hash sharding-by-murmur</li>
</ul>
<h3 id="工作过程"><a href="#工作过程" class="headerlink" title="工作过程"></a>工作过程</h3><p><strong>当mycat收到一个SQL命令时</strong></p>
<ul>
<li>解析SQL命令涉及的表</li>
<li>然后看对表的配置，如果有分片规则，则获取SQL命令里分片字段的值，并匹配分配函数，获取分片列表</li>
<li>让后将SQL命令发往对应的数据库服务器去执行</li>
<li>最后收集和处理所有分片规则结果数据，返回给客户端</li>
</ul>
<h3 id="安装软件-1"><a href="#安装软件-1" class="headerlink" title="安装软件"></a>安装软件</h3><p>节点规划</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>角色</th>
<th>数据库</th>
<th>ip</th>
</tr>
</thead>
<tbody><tr>
<td>client</td>
<td>客户端</td>
<td>无</td>
<td>192.168.1.10</td>
</tr>
<tr>
<td>mycat</td>
<td>分片服务器</td>
<td>无</td>
<td>192.168.1.20</td>
</tr>
<tr>
<td>db1</td>
<td>数据库服务器</td>
<td>db1</td>
<td>192.168.1.11</td>
</tr>
<tr>
<td>db2</td>
<td>数据库服务器</td>
<td>db2</td>
<td>192.168.1.12</td>
</tr>
<tr>
<td>db3</td>
<td>数据库服务器</td>
<td>db3</td>
<td>192.168.1.13</td>
</tr>
</tbody></table>
<ul>
<li>安装JDK</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]<span class="comment"># yum install java-1.8.0-openjdk.x86_64 -y</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>安装mycat服务软件包</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]<span class="comment"># tar xf Mycat-server-1.6-RELEASE-linux.tar.gz </span></span><br><span class="line">[root@mycat ~]<span class="comment"># mv mycat/ /usr/local/</span></span><br><span class="line">[root@mycat ~]<span class="comment"># ls /usr/local/mycat/</span></span><br><span class="line">bin  catlet  conf  lib  logs  version.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="配置数据库分片服务"><a href="#配置数据库分片服务" class="headerlink" title="配置数据库分片服务"></a>配置数据库分片服务</h2><h3 id="mycat目录结构"><a href="#mycat目录结构" class="headerlink" title="mycat目录结构"></a>mycat目录结构</h3><ul>
<li>bin         #mycat命令</li>
<li>catlet    #扩展功能</li>
<li>conf      #配置文件</li>
<li>lib         #mycat使用的jar包</li>
<li>logs       #mycat启动日志的运行日志</li>
</ul>
<h3 id="重要配置文件"><a href="#重要配置文件" class="headerlink" title="重要配置文件"></a>重要配置文件</h3><ul>
<li>server.xml       #设置连接账户及逻辑库</li>
<li>schema.xml    #配置数据分片存储的表</li>
<li>rule.xml          #分片规则</li>
<li>其它文件         #分片规则配置文件</li>
</ul>
<h3 id="创建连接用户"><a href="#创建连接用户" class="headerlink" title="创建连接用户"></a>创建连接用户</h3><ul>
<li><p>/usr/local/mycat/conf/server.xml</p>
<p>定义客户端连接mycat服务的用户</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]<span class="comment"># vim /usr/local/mycat/conf/server.xml</span></span><br><span class="line">&lt;user name=<span class="string">&quot;admin&quot;</span>&gt;   <span class="comment">#连接mycat服务用户名</span></span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span>&gt;123456&lt;/property&gt; <span class="comment">#密码</span></span><br><span class="line">        &lt;property name=<span class="string">&quot;schemas&quot;</span>&gt;TESTDB&lt;/property&gt; <span class="comment">#逻辑库</span></span><br><span class="line">        &lt;property name=<span class="string">&quot;readOnly&quot;</span>&gt;<span class="literal">true</span>&lt;/property&gt; <span class="comment">#只读权限</span></span><br><span class="line">&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<h3 id="配置数据分片"><a href="#配置数据分片" class="headerlink" title="配置数据分片"></a>配置数据分片</h3><p>定义分片的表schema.xml</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]<span class="comment"># vim /usr/local/mycat/conf/schema.xml </span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM <span class="string">&quot;schema.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mycat:schema xmlns:mycat=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">     &lt;schema ······&gt;   <span class="comment">#指定表使用的分片规则</span></span><br><span class="line">     &lt;/schema&gt;</span><br><span class="line">     </span><br><span class="line">     &lt;dataNode ······/&gt; <span class="comment">#指定数据库服务器主机名</span></span><br><span class="line">     </span><br><span class="line">     &lt;dataHost ······&gt; <span class="comment">#指定数据库服务器IP地址</span></span><br><span class="line">     &lt;/dataHost&gt;</span><br><span class="line">     </span><br><span class="line">&lt;/mycat:schema&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>指定表使用的分片规则</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;schema&gt; ······ &lt;/schema&gt;  <span class="comment">#定义分片信息</span></span><br><span class="line">&lt;table&gt; ······ &lt;/table&gt;    <span class="comment">#定义表</span></span><br><span class="line">name  <span class="comment">#逻辑库名或逻辑表名</span></span><br><span class="line">dataNode   <span class="comment">#指定数据库服务器</span></span><br><span class="line">rule   <span class="comment">#指定使用的分片规则</span></span><br><span class="line"><span class="built_in">type</span>=global   <span class="comment">#数据不分片存储</span></span><br><span class="line"></span><br><span class="line">[root@mycat ~]<span class="comment"># vim /usr/local/mycat/conf/schema.xml</span></span><br><span class="line">&lt;schema name=<span class="string">&quot;TESTDB&quot;</span> checkSQLschema=<span class="string">&quot;false&quot;</span> sqlMaxLimit=<span class="string">&quot;100&quot;</span>&gt;</span><br><span class="line">        &lt;table name=<span class="string">&quot;hotnews&quot;</span> primaryKey=<span class="string">&quot;ID&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;mod-long&quot;</span> dataNode=<span class="string">&quot;dn1,dn2,dn3&quot;</span> /&gt;</span><br><span class="line">        &lt;table name=<span class="string">&quot;company&quot;</span> primaryKey=<span class="string">&quot;ID&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;global&quot;</span> dataNode=<span class="string">&quot;dn1,dn2,dn3&quot;</span> /&gt;</span><br><span class="line">&lt;/schema&gt;</span><br></pre></td></tr></table></figure>

<h3 id="定义数据库服务器主机名"><a href="#定义数据库服务器主机名" class="headerlink" title="定义数据库服务器主机名"></a>定义数据库服务器主机名</h3><ul>
<li>&lt;dataNode 选项=值,······/&gt;  #定义数据库服务器信息</li>
<li>name                                      #第几台数据库服务器</li>
<li>datahost                                #主机名</li>
<li>database                               #存储数据的数据库</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataNode name=<span class="string">&quot;dn1&quot;</span> dataHost=<span class="string">&quot;db1&quot;</span> database=<span class="string">&quot;db1&quot;</span> /&gt;</span><br><span class="line">&lt;dataNode name=<span class="string">&quot;dn2&quot;</span> dataHost=<span class="string">&quot;db2&quot;</span> database=<span class="string">&quot;db2&quot;</span> /&gt;</span><br><span class="line">&lt;dataNode name=<span class="string">&quot;dn3&quot;</span> dataHost=<span class="string">&quot;db3&quot;</span> database=<span class="string">&quot;db3&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="定义服务器IP地址"><a href="#定义服务器IP地址" class="headerlink" title="定义服务器IP地址"></a>定义服务器IP地址</h3><ul>
<li>&lt;dataHost 选项=值,······/&gt;   #指定数据库服务器的IP地址</li>
<li>name                                     #主机名（与datahost对应的主机名）</li>
<li>host                                       #主机名（与IP地址对应的主机名）</li>
<li>url                                         #数据库服务器IP地址及端口号</li>
<li>user                                      #数据库服务器授权用户</li>
<li>password                            #授权用户密码</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataHost name=<span class="string">&quot;db1&quot;</span> ······&gt;</span><br><span class="line">     &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">         &lt;writeHost host=<span class="string">&quot;hostM1&quot;</span> url=<span class="string">&quot;192.168.1.11:3306&quot;</span> user=<span class="string">&quot;admin&quot;</span> password=<span class="string">&quot;123456&quot;</span>&gt;</span><br><span class="line">         &lt;/writeHost&gt;</span><br><span class="line">&lt;/dataHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;dataHost name=<span class="string">&quot;db2&quot;</span> ······&gt;</span><br><span class="line">     &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">         &lt;writeHost host=<span class="string">&quot;hostM2&quot;</span> url=<span class="string">&quot;192.168.1.12:3306&quot;</span> user=<span class="string">&quot;admin&quot;</span> password=<span class="string">&quot;123456&quot;</span>&gt;</span><br><span class="line">         &lt;/writeHost&gt;</span><br><span class="line">&lt;/dataHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;dataHost name=<span class="string">&quot;db3&quot;</span> ······&gt;</span><br><span class="line">     &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">         &lt;writeHost host=<span class="string">&quot;hostM3&quot;</span> url=<span class="string">&quot;192.168.1.13:3306&quot;</span> user=<span class="string">&quot;admin&quot;</span> password=<span class="string">&quot;123456&quot;</span>&gt;</span><br><span class="line">         &lt;/writeHost&gt;</span><br><span class="line">&lt;/dataHost&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建存储数据的库"><a href="#创建存储数据的库" class="headerlink" title="创建存储数据的库"></a>创建存储数据的库</h3><ul>
<li>根据分片配置做出相应配置</li>
<li>创建存储数据的库db1、db2、db3</li>
<li>添加授权用户</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database db1;    <span class="comment">#在db1服务器创建</span></span><br><span class="line">mysql&gt; create database db2;    <span class="comment">#在db2服务器创建</span></span><br><span class="line">mysql&gt; create database db3;    <span class="comment">#在db3服务器创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#所有数据库服务器</span></span><br><span class="line">mysql&gt; grant all on *.* to admin@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&quot;123456&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]<span class="comment"># /usr/local/mycat/bin/mycat --help</span></span><br><span class="line">Usage: /usr/local/mycat/bin/mycat &#123; console | start | stop | restart | status | dump &#125;</span><br><span class="line"></span><br><span class="line">[root@mycat ~]<span class="comment"># /usr/local/mycat/bin/mycat start</span></span><br><span class="line">Starting Mycat-server...</span><br><span class="line"></span><br><span class="line">[root@mycat ~]<span class="comment"># ss -ltunp |grep 8066</span></span><br><span class="line">tcp    LISTEN     0      100      :::8066                 :::*                   <span class="built_in">users</span>:((&quot;java&quot;,pid=<span class="number">11684</span>,fd=<span class="number">85</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h3><ul>
<li><p>客户端连接分片服务器存取数据</p>
<p>连接</p>
<p>选择库</p>
<p>建表</p>
<p>插入数据</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]<span class="comment"># mysql -h192.168.1.20 -uroot -p123456 -P8066</span></span><br><span class="line"><span class="comment">#root密码在server.xml中定义</span></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+----------+</span><br><span class="line">| DATABASE |</span><br><span class="line">+----------+</span><br><span class="line">| TESTDB   |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use TESTDB</span><br><span class="line"></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+------------------+</span><br><span class="line">| Tables <span class="keyword">in</span> TESTDB |</span><br><span class="line">+------------------+</span><br><span class="line">| company          |</span><br><span class="line">| hotnews          |</span><br><span class="line">+------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="分片规则-枚举法"><a href="#分片规则-枚举法" class="headerlink" title="分片规则-枚举法"></a>分片规则-枚举法</h2><h3 id="sharding-by-intfile"><a href="#sharding-by-intfile" class="headerlink" title="sharding-by-intfile"></a>sharding-by-intfile</h3><ul>
<li>枚举法</li>
<li>分片字段值，必须在分片规则文件定义的值里选择</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#找到使用枚举法分片规则的表 schema.xml</span></span><br><span class="line">&lt;table name=<span class="string">&quot;employee&quot;</span> primaryKey=<span class="string">&quot;ID&quot;</span> dataNode=<span class="string">&quot;dn1,dn2,dn3&quot;</span> rule=<span class="string">&quot;sharding-by-intfile&quot;</span> /&gt;  <span class="comment">#表使用的分片规则</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#找到分片字段名 rule.xml</span></span><br><span class="line">&lt;tableRule name=<span class="string">&quot;sharding-by-intfile&quot;</span>&gt;  <span class="comment">#分片规则</span></span><br><span class="line">    &lt;rule&gt;</span><br><span class="line">       &lt;columns&gt;sharding_id&lt;/columns&gt;  <span class="comment">#字段名</span></span><br><span class="line">       &lt;algorithm&gt;hash-int&lt;/algorithm&gt;  <span class="comment">#算法</span></span><br><span class="line">     &lt;/rule&gt;</span><br><span class="line">&lt;/tableRule&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#找到分片规则使用的配置文件 rule.xml</span></span><br><span class="line">&lt;<span class="keyword">function</span> name=<span class="string">&quot;hash-int&quot;</span> class=<span class="string">&quot;io.mycat.route.function.PartitionByFileMap&quot;</span>&gt; <span class="comment">#算法</span></span><br><span class="line">&lt;property name=<span class="string">&quot;mapFile&quot;</span>&gt;partition-hash-int.txt&lt;/property&gt;</span><br><span class="line">                         <span class="comment">#配置文件名</span></span><br><span class="line">&lt;/function&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定分片字段的值</span></span><br><span class="line">[root@mycat ~]<span class="comment"># vim /usr/local/mycat/conf/partition-hash-int.txt </span></span><br><span class="line">10000=0  <span class="comment">#0表示第一台数据库服务器 对应dn1</span></span><br><span class="line">10010=1  <span class="comment">#1表示第二台数据库服务器 对应dn2</span></span><br><span class="line">10020=2  <span class="comment">#2表示第三台数据库服务器 对应dn3</span></span><br><span class="line"></span><br><span class="line">[root@mycat ~]<span class="comment"># /usr/local/mycat/bin/mycat restart</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建数据"><a href="#创建数据" class="headerlink" title="创建数据"></a>创建数据</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table TESTDB.employee(</span><br><span class="line">    -&gt; ID int primary key,</span><br><span class="line">    -&gt; sharding_id int,</span><br><span class="line">    -&gt; name char(15),</span><br><span class="line">    -&gt; age int);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into employee(ID,sharding_id,name,age) values(1,10000,<span class="string">&quot;bob&quot;</span>,19),(2,10010,<span class="string">&quot;tom&quot;</span>,21),(3,10020,<span class="string">&quot;lucy&quot;</span>,16);</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; insert into employee(ID,sharding_id,name,age) values(4,10000,<span class="string">&quot;bob2&quot;</span>,19),(5,10010,<span class="string">&quot;tom2&quot;</span>,21),(6,10020,<span class="string">&quot;lucy2&quot;</span>,16);</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#在数据库服务器查看数据</span></span><br><span class="line"><span class="comment">#db1</span></span><br><span class="line">mysql&gt; select * from db1.employee;</span><br><span class="line">+----+-------------+------+------+</span><br><span class="line">| ID | sharding_id | name | age  |</span><br><span class="line">+----+-------------+------+------+</span><br><span class="line">|  1 |       10000 | bob  |   19 |</span><br><span class="line">|  4 |       10000 | bob2 |   19 |</span><br><span class="line">+----+-------------+------+------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#db2</span></span><br><span class="line">mysql&gt; select * from db2.employee;</span><br><span class="line">+----+-------------+------+------+</span><br><span class="line">| ID | sharding_id | name | age  |</span><br><span class="line">+----+-------------+------+------+</span><br><span class="line">|  2 |       10010 | tom  |   21 |</span><br><span class="line">|  5 |       10010 | tom2 |   21 |</span><br><span class="line">+----+-------------+------+------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#db3</span></span><br><span class="line">mysql&gt; select * from db3.employee;</span><br><span class="line">+----+-------------+-------+------+</span><br><span class="line">| ID | sharding_id | name  | age  |</span><br><span class="line">+----+-------------+-------+------+</span><br><span class="line">|  3 |       10020 | lucy  |   16 |</span><br><span class="line">|  6 |       10020 | lucy2 |   16 |</span><br><span class="line">+----+-------------+-------+------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="分片规则-求模法"><a href="#分片规则-求模法" class="headerlink" title="分片规则-求模法"></a>分片规则-求模法</h2><h3 id="mod-long"><a href="#mod-long" class="headerlink" title="mod-long"></a>mod-long</h3><ul>
<li><p>求模法</p>
<p>根据分片字段值与设定的数字的求模结果存储数据</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#schema.xml</span></span><br><span class="line">&lt;table name=<span class="string">&quot;hotnews&quot;</span> primaryKey=<span class="string">&quot;ID&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;mod-long&quot;</span> dataNode=<span class="string">&quot;dn1,dn2,dn3&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#rule.xml</span></span><br><span class="line">&lt;tableRule name=<span class="string">&quot;mod-long&quot;</span>&gt;</span><br><span class="line">   &lt;rule&gt;</span><br><span class="line">      &lt;columns&gt;<span class="built_in">id</span>&lt;/columns&gt;  <span class="comment">#求模字段名 </span></span><br><span class="line">      &lt;algorithm&gt;mod-long&lt;/algorithm&gt;  <span class="comment">#算法</span></span><br><span class="line">&lt;/rule&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">function</span> name=<span class="string">&quot;mod-long&quot;</span> class=<span class="string">&quot;io.mycat.route.function.PartitionByMod&quot;</span>&gt;</span><br><span class="line">      &lt;!-- how many data nodes --&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;count&quot;</span>&gt;3&lt;/property&gt;  <span class="comment">#字段与之求模的数字</span></span><br><span class="line">&lt;/function&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="添加新库新表"><a href="#添加新库新表" class="headerlink" title="添加新库新表"></a>添加新库新表</h2><h3 id="添加新库"><a href="#添加新库" class="headerlink" title="添加新库"></a>添加新库</h3><ul>
<li>修改server.xml文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;user name=<span class="string">&quot;root&quot;</span>&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;password&quot;</span>&gt;123456&lt;/property&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;schemas&quot;</span>&gt;TESTDB,BBSDB&lt;/property&gt;</span><br><span class="line">&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<h3 id="添加新表"><a href="#添加新表" class="headerlink" title="添加新表"></a>添加新表</h3><ul>
<li>修改schema.xml文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加</span></span><br><span class="line">&lt;schema name=<span class="string">&quot;BBSDB&quot;</span> checkSQLschema=<span class="string">&quot;false&quot;</span> sqlMaxLimit=<span class="string">&quot;100&quot;</span>&gt;</span><br><span class="line">    &lt;table name=<span class="string">&quot;age&quot;</span> primaryKey=<span class="string">&quot;ID&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;global&quot;</span> dataNode=<span class="string">&quot;dn1,dn2,dn3&quot;</span> /&gt;</span><br><span class="line">    &lt;table name=<span class="string">&quot;user&quot;</span> primaryKey=<span class="string">&quot;ID&quot;</span> dataNode=<span class="string">&quot;dn1,dn2,dn3&quot;</span> rule=<span class="string">&quot;sharding-by-intfile&quot;</span> /&gt;</span><br><span class="line">&lt;/schema&gt;</span><br><span class="line"></span><br><span class="line">[root@mycat ~]<span class="comment"># /usr/local/mycat/bin/mycat restart</span></span><br></pre></td></tr></table></figure>

<h3 id="客户端测试"><a href="#客户端测试" class="headerlink" title="客户端测试"></a>客户端测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]<span class="comment"># mysql -h192.168.1.20 -uroot -p123456 -P8066</span></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+----------+</span><br><span class="line">| DATABASE |</span><br><span class="line">+----------+</span><br><span class="line">| BBSDB    |</span><br><span class="line">| TESTDB   |</span><br><span class="line">+----------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<h1 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h1><h2 id="存储引擎介绍"><a href="#存储引擎介绍" class="headerlink" title="存储引擎介绍"></a>存储引擎介绍</h2><h3 id="存储引擎-1"><a href="#存储引擎-1" class="headerlink" title="存储引擎"></a>存储引擎</h3><ul>
<li>MySQL服务软件自带的功能组件之一</li>
<li>每种存储引擎都有各自的功能和数据存储方式</li>
<li>建表的时候可以指定表使用的存储引擎</li>
</ul>
<h3 id="查看可用的存储引擎"><a href="#查看可用的存储引擎" class="headerlink" title="查看可用的存储引擎"></a>查看可用的存储引擎</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br><span class="line">+--------------------+---------+---------------------------------------------------------+</span><br><span class="line">| Engine             | Support | Comment                                                 |</span><br><span class="line">+--------------------+---------+---------------------------------------------------------+</span><br><span class="line">| CSV                | YES     | CSV storage engine                                      |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                   |</span><br><span class="line">| MEMORY             | YES     | Hash based, stored <span class="keyword">in</span> memory, useful <span class="keyword">for</span> temporary table|  </span><br><span class="line">| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it      |</span><br><span class="line">| MyISAM             | YES     | MyISAM storage engine                                   |</span><br><span class="line">| InnoDB             | DEFAULT | Percona-XtraDB, Supports transactions, row-level locking|</span><br><span class="line">| ARCHIVE            | YES     | Archive storage engine                                  |</span><br><span class="line">| FEDERATED          | YES     | FederatedX pluggable storage engine                     |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | Performance Schema                                      |</span><br><span class="line">| Aria               | YES     | Crash-safe tables with MyISAM heritage                  |</span><br><span class="line">+--------------------+---------+---------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h2 id="修该服务存储引擎"><a href="#修该服务存储引擎" class="headerlink" title="修该服务存储引擎"></a>修该服务存储引擎</h2><ul>
<li>修改数据库默认存储引擎</li>
<li>/etc/my.cnf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@db1 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">default_storage_engine=存储引擎</span><br><span class="line"></span><br><span class="line">[root@db1 ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<h3 id="创建表时指定存储引擎"><a href="#创建表时指定存储引擎" class="headerlink" title="创建表时指定存储引擎"></a>创建表时指定存储引擎</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table db1.t2(<span class="built_in">id</span> int)engine=memory;</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table db1.t2\G</span><br><span class="line">************************ 1. row ************************</span><br><span class="line">       Table: t2</span><br><span class="line">Create Table: CREATE TABLE `t2` (</span><br><span class="line">  `<span class="built_in">id</span>` int(11) DEFAULT NULL</span><br><span class="line">) ENGINE=MEMORY DEFAULT CHARSET=latin1</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="修改已有表的存储引擎"><a href="#修改已有表的存储引擎" class="headerlink" title="修改已有表的存储引擎"></a>修改已有表的存储引擎</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table db1.t2 engine=myisam;</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table db1.t2\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: t2</span><br><span class="line">Create Table: CREATE TABLE `t2` (</span><br><span class="line">  `<span class="built_in">id</span>` int(11) DEFAULT NULL</span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=latin1</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="常用存储引擎特点"><a href="#常用存储引擎特点" class="headerlink" title="常用存储引擎特点"></a>常用存储引擎特点</h2><h3 id="innodb存储引擎"><a href="#innodb存储引擎" class="headerlink" title="innodb存储引擎"></a>innodb存储引擎</h3><ul>
<li><p>主要特点</p>
<p>支持行级锁</p>
<p>支持事务（SQL命令执行过程）、事务回滚、外键</p>
</li>
<li><p>表文件</p>
<p>表名.frm(存表结构) 、表名.ibd(存索引，表数据)</p>
</li>
<li><p>事务日志文件（存储SQL命令）</p>
<p>ib_logfile0、ib_logfile1</p>
</li>
</ul>
<h3 id="myisam存储引擎"><a href="#myisam存储引擎" class="headerlink" title="myisam存储引擎"></a>myisam存储引擎</h3><ul>
<li><p>主要特点</p>
<p>支持表级锁</p>
<p>不支持事务、事务回滚、外键</p>
</li>
<li><p>表文件</p>
<p>表名.frm  表名.MYI(索引)  表名.MYD(数据)</p>
</li>
</ul>
<h2 id="MySQL锁机制"><a href="#MySQL锁机制" class="headerlink" title="MySQL锁机制"></a>MySQL锁机制</h2><h3 id="锁粒度"><a href="#锁粒度" class="headerlink" title="锁粒度"></a>锁粒度</h3><ul>
<li>表级锁：对整张表加锁（myisam）</li>
<li>行级锁：仅对被访问的行分别加锁（innodb）</li>
</ul>
<h3 id="锁类型"><a href="#锁类型" class="headerlink" title="锁类型"></a>锁类型</h3><ul>
<li>读锁（共享锁）：支持并发读</li>
<li>写锁（互斥锁，排它锁）：上锁期间不能对表做读或写操作</li>
</ul>
<h3 id="显示等待获取锁请求的个数"><a href="#显示等待获取锁请求的个数" class="headerlink" title="显示等待获取锁请求的个数"></a>显示等待获取锁请求的个数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="string">&quot;table_locks_waited&quot;</span>;</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| Variable_name      | Value |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| Table_locks_waited | 0     |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h2><h3 id="Atomic：原子性"><a href="#Atomic：原子性" class="headerlink" title="Atomic：原子性"></a>Atomic：原子性</h3><ul>
<li>事务的整个操作是一个整体，不可分割，要么全部成功，要么全部失败</li>
</ul>
<h3 id="Consistency：一致性"><a href="#Consistency：一致性" class="headerlink" title="Consistency：一致性"></a>Consistency：一致性</h3><ul>
<li>事务操作的前后，表中记录没有变化</li>
</ul>
<h3 id="Isolation：隔离性"><a href="#Isolation：隔离性" class="headerlink" title="Isolation：隔离性"></a>Isolation：隔离性</h3><ul>
<li>事务操作是相互隔离不受影响的</li>
</ul>
<h3 id="Durability：持久性"><a href="#Durability：持久性" class="headerlink" title="Durability：持久性"></a>Durability：持久性</h3><ul>
<li>数据一旦提交，不可改变，永久改变表数据</li>
</ul>
<h3 id="事务特性演示"><a href="#事务特性演示" class="headerlink" title="事务特性演示"></a>事务特性演示</h3><ul>
<li>相关命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&quot;autocommit&quot;</span>;  <span class="comment">#查看数据提交状态</span></span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| autocommit    | ON    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> autocommit=off;    <span class="comment">#关闭自动提交</span></span><br><span class="line"> </span><br><span class="line">mysql&gt; rollback;              <span class="comment">#数据回滚</span></span><br><span class="line"> </span><br><span class="line">mysql&gt; commit;                <span class="comment">#提交数据</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">W</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/04/13/tedu-MySQL/">http://example.com/2023/04/13/tedu-MySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="/../images/title/mysql.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/12/tedu-Ceph/" title="Ceph"><img class="cover" src="/../images/title/ceph.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ceph</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/14/OpenStack/" title="私有云相关赛题"><img class="cover" src="/../images/title/openstack5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">私有云相关赛题</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../jihu/wallpaper/used/user.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">W</div><div class="author-info__description">O&M</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">MySQL基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD"><span class="toc-number">1.1.</span> <span class="toc-text">专业术语</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">MySQL介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%B7%E6%BA%90%E4%B8%8E%E5%8F%91%E5%B1%95"><span class="toc-number">1.2.1.</span> <span class="toc-text">起源与发展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.2.</span> <span class="toc-text">特点与应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85MySQL%E8%BD%AF%E4%BB%B6%E3%80%81%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text">安装MySQL软件、启动服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87yum%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text">通过yum安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.</span> <span class="toc-text">相关参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.</span> <span class="toc-text">初始化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="toc-number">1.5.1.</span> <span class="toc-text">修改密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5"><span class="toc-number">1.5.2.</span> <span class="toc-text">修改密码策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80"><span class="toc-number">1.6.</span> <span class="toc-text">数据库基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">1.6.1.</span> <span class="toc-text">连接方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">数据存储流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E7%AE%A1%E7%90%86%E7%8E%AF%E5%A2%83"><span class="toc-number">1.6.3.</span> <span class="toc-text">MySQL管理环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E5%91%BD%E4%BB%A4%E5%88%86%E7%B1%BB"><span class="toc-number">1.6.4.</span> <span class="toc-text">SQL命令分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.5.</span> <span class="toc-text">MySQL基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%93%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">库管理命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">表管理命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">记录管理命令</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">字符类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E9%95%BF%EF%BC%9Achar-%E5%AD%97%E7%AC%A6%E4%B8%AA%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">定长：char(字符个数)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%95%BFvarchar-%E5%AD%97%E7%AC%A6%E4%B8%AA%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">变长varchar(字符个数)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%96%87%E6%9C%AC%E7%B1%BB%E5%9E%8B%EF%BC%9Atext-blob"><span class="toc-number">2.4.</span> <span class="toc-text">大文本类型：text&#x2F;blob</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.5.</span> <span class="toc-text">数值类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E5%9E%8B"><span class="toc-number">2.6.</span> <span class="toc-text">整数型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E5%9E%8B"><span class="toc-number">2.7.</span> <span class="toc-text">浮点型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.8.</span> <span class="toc-text">日期和时间类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">2.8.1.</span> <span class="toc-text">类型关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">2.8.2.</span> <span class="toc-text">时间函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E5%AD%97%E6%AE%B5"><span class="toc-number">2.8.3.</span> <span class="toc-text">关于日期时间字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#year%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.8.4.</span> <span class="toc-text">year类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.9.</span> <span class="toc-text">枚举类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6%EF%BC%8C%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">约束条件，修改表结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">约束条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.1.1.</span> <span class="toc-text">设置约束条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.</span> <span class="toc-text">修改表结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.1.</span> <span class="toc-text">语法结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%AD%97%E6%AE%B5"><span class="toc-number">3.3.</span> <span class="toc-text">添加新字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text">修改字段类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5"><span class="toc-number">3.5.</span> <span class="toc-text">删除字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">3.6.</span> <span class="toc-text">修改字段名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%90%8D"><span class="toc-number">3.7.</span> <span class="toc-text">修改表名</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95"><span class="toc-number">4.</span> <span class="toc-text">普通索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E9%94%AE%E5%80%BC%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">MySQL键值概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.1.1.</span> <span class="toc-text">键值类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.2.</span> <span class="toc-text">索引介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E7%82%B9"><span class="toc-number">4.2.1.</span> <span class="toc-text">索引优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BC%BA%E7%82%B9"><span class="toc-number">4.2.2.</span> <span class="toc-text">索引缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95index"><span class="toc-number">4.3.</span> <span class="toc-text">普通索引index</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E8%A6%81%E6%B1%82"><span class="toc-number">4.4.</span> <span class="toc-text">具体要求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">4.4.1.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8%E6%97%B6%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">4.4.2.</span> <span class="toc-text">建表时创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B7%B2%E6%9C%89%E8%A1%A8%E9%87%8C%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">4.4.3.</span> <span class="toc-text">在已有表里创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">4.4.4.</span> <span class="toc-text">删除索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF"><span class="toc-number">4.5.</span> <span class="toc-text">查看索引信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E5%A4%96%E9%94%AE"><span class="toc-number">5.</span> <span class="toc-text">主键外键</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%94%AEprimary-key"><span class="toc-number">5.1.</span> <span class="toc-text">主键primary key</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E8%A6%81%E6%B1%82-1"><span class="toc-number">5.1.1.</span> <span class="toc-text">具体要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E5%88%9B%E5%BB%BA%E4%B8%BB%E9%94%AE"><span class="toc-number">5.1.2.</span> <span class="toc-text">创建表时创建主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B7%B2%E6%9C%89%E8%A1%A8%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%BB%E9%94%AE"><span class="toc-number">5.1.3.</span> <span class="toc-text">在已有表中创建主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%BB%E9%94%AE"><span class="toc-number">5.1.4.</span> <span class="toc-text">删除主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E4%B8%BB%E9%94%AE"><span class="toc-number">5.1.5.</span> <span class="toc-text">复合主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8%E6%97%B6%E5%88%9B%E5%BB%BA"><span class="toc-number">5.1.6.</span> <span class="toc-text">建表时创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B7%B2%E6%9C%89%E8%A1%A8%E9%87%8C%E5%88%9B%E5%BB%BA"><span class="toc-number">5.1.7.</span> <span class="toc-text">在已有表里创建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%94%AEforeign-key"><span class="toc-number">5.2.</span> <span class="toc-text">外键foreign key</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A7%84%E5%88%99"><span class="toc-number">5.2.1.</span> <span class="toc-text">使用规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="toc-number">5.2.2.</span> <span class="toc-text">命令格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%A4%96%E9%94%AE"><span class="toc-number">5.2.3.</span> <span class="toc-text">删除外键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%A4%96%E9%94%AE%E5%90%8D"><span class="toc-number">5.2.4.</span> <span class="toc-text">指定外键名</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="toc-number">6.</span> <span class="toc-text">数据导入导出</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E7%9B%AE%E5%BD%95"><span class="toc-number">6.1.</span> <span class="toc-text">检索目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A3%80%E7%B4%A2%E7%9B%AE%E5%BD%95"><span class="toc-number">6.1.1.</span> <span class="toc-text">修改检索目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5"><span class="toc-number">6.2.</span> <span class="toc-text">数据导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA"><span class="toc-number">6.3.</span> <span class="toc-text">数据导出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E8%A1%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">7.</span> <span class="toc-text">管理表记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E8%A1%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">7.1.</span> <span class="toc-text">插入表记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">7.2.</span> <span class="toc-text">查询表记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">7.3.</span> <span class="toc-text">更新表记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8%E8%AE%B0%E5%BD%95"><span class="toc-number">7.4.</span> <span class="toc-text">删除表记录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">匹配条件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="toc-number">8.1.</span> <span class="toc-text">基本匹配条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%AF%94%E8%BE%83"><span class="toc-number">8.1.1.</span> <span class="toc-text">数值比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E6%AF%94%E8%BE%83-%E5%8C%B9%E9%85%8D%E7%A9%BA-%E9%9D%9E%E7%A9%BA"><span class="toc-number">8.1.2.</span> <span class="toc-text">字符比较&#x2F;匹配空&#x2F;非空</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E5%8C%B9%E9%85%8D"><span class="toc-number">8.1.3.</span> <span class="toc-text">范围匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%8C%B9%E9%85%8D"><span class="toc-number">8.1.4.</span> <span class="toc-text">逻辑匹配</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="toc-number">8.2.</span> <span class="toc-text">高级匹配条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.2.1.</span> <span class="toc-text">模糊查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">8.2.2.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E8%AE%A1%E7%AE%97"><span class="toc-number">8.2.3.</span> <span class="toc-text">数字计算</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C"><span class="toc-number">9.</span> <span class="toc-text">操作查询结果</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-number">9.1.</span> <span class="toc-text">聚集函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E5%86%85%E7%BD%AE%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%87%BD%E6%95%B0"><span class="toc-number">9.2.</span> <span class="toc-text">MySQL内置数据统计函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">9.3.</span> <span class="toc-text">排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">9.4.</span> <span class="toc-text">分组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D"><span class="toc-number">9.5.</span> <span class="toc-text">去重</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">9.6.</span> <span class="toc-text">查找数据结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#having%E7%94%A8%E6%B3%95"><span class="toc-number">9.6.1.</span> <span class="toc-text">having用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E8%A1%8C%E6%95%B0"><span class="toc-number">9.7.</span> <span class="toc-text">限制查询结果行数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%9B%BE%E5%BD%A2%E5%B7%A5%E5%85%B7%E7%AE%A1%E7%90%86"><span class="toc-number">10.</span> <span class="toc-text">MySQL图形工具管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">10.1.</span> <span class="toc-text">管理工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phpMyAdmin"><span class="toc-number">10.2.</span> <span class="toc-text">phpMyAdmin</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%8E%88%E6%9D%83"><span class="toc-number">11.</span> <span class="toc-text">用户授权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%88%E6%9D%83grant"><span class="toc-number">11.1.</span> <span class="toc-text">授权grant</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F-1"><span class="toc-number">11.1.1.</span> <span class="toc-text">命令格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8"><span class="toc-number">11.1.2.</span> <span class="toc-text">权限列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E5%90%8D"><span class="toc-number">11.1.3.</span> <span class="toc-text">库名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">11.1.4.</span> <span class="toc-text">用户名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%9C%B0%E5%9D%80"><span class="toc-number">11.1.5.</span> <span class="toc-text">客户端地址</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E5%BA%93"><span class="toc-number">12.</span> <span class="toc-text">授权库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E5%BA%93%E8%AE%B0%E5%BD%95%E6%8E%88%E6%9D%83%E4%BF%A1%E6%81%AF"><span class="toc-number">12.1.</span> <span class="toc-text">mysql库记录授权信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#user%E8%A1%A8"><span class="toc-number">12.2.</span> <span class="toc-text">user表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#db%E8%A1%A8"><span class="toc-number">12.3.</span> <span class="toc-text">db表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tables-priv%E8%A1%A8"><span class="toc-number">12.4.</span> <span class="toc-text">tables_priv表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#columns-priv%E8%A1%A8"><span class="toc-number">12.5.</span> <span class="toc-text">columns_priv表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%92%A4%E9%94%80%E6%9D%83%E9%99%90"><span class="toc-number">13.</span> <span class="toc-text">撤销权限</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">13.1.</span> <span class="toc-text">删除用户权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">13.2.</span> <span class="toc-text">相关命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#root%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86"><span class="toc-number">14.</span> <span class="toc-text">root密码管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81"><span class="toc-number">14.1.</span> <span class="toc-text">修改root密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3root%E5%AF%86%E7%A0%81-%E6%97%A0%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-number">14.2.</span> <span class="toc-text">破解root密码 - 无密码登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3%E7%BA%BF%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%99%A8root%E5%AF%86%E7%A0%81"><span class="toc-number">14.3.</span> <span class="toc-text">破解线上服务器root密码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD"><span class="toc-number">15.</span> <span class="toc-text">数据备份</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E6%96%B9%E5%BC%8F"><span class="toc-number">15.1.</span> <span class="toc-text">数据备份方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5"><span class="toc-number">15.2.</span> <span class="toc-text">数据备份策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5%E5%BA%94%E7%94%A8"><span class="toc-number">15.3.</span> <span class="toc-text">备份策略应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%A9%E7%90%86%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">15.4.</span> <span class="toc-text">物理备份与恢复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD"><span class="toc-number">15.5.</span> <span class="toc-text">逻辑备份</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">15.5.1.</span> <span class="toc-text">数据库完全备份与恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E5%90%8D%E8%A1%A8%E7%A4%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">15.5.2.</span> <span class="toc-text">库名表示方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#binlog%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="toc-number">16.</span> <span class="toc-text">binlog日志管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#binlog%E6%97%A5%E5%BF%97%E4%BB%8B%E7%BB%8D"><span class="toc-number">16.1.</span> <span class="toc-text">binlog日志介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%97%A5%E5%BF%97"><span class="toc-number">16.2.</span> <span class="toc-text">启动日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">16.3.</span> <span class="toc-text">创建新的日志文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%85%E7%90%86%E6%97%A5%E5%BF%97"><span class="toc-number">16.4.</span> <span class="toc-text">清理日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#binlog%E6%97%A5%E5%BF%97%E6%81%A2%E5%A4%8D"><span class="toc-number">16.5.</span> <span class="toc-text">binlog日志恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%97%A5%E5%BF%97%E6%81%A2%E5%A4%8D%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE"><span class="toc-number">16.5.1.</span> <span class="toc-text">使用日志恢复所有数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%97%A5%E5%BF%97%E6%81%A2%E5%A4%8D%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE"><span class="toc-number">16.5.2.</span> <span class="toc-text">使用日志恢复部分数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F-2"><span class="toc-number">16.5.3.</span> <span class="toc-text">命令格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="toc-number">16.6.</span> <span class="toc-text">日志格式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#innobackupex"><span class="toc-number">17.</span> <span class="toc-text">innobackupex</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84MySQL%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7"><span class="toc-number">17.1.</span> <span class="toc-text">常用的MySQL备份工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#innobackupex%E5%B7%A5%E5%85%B7"><span class="toc-number">17.2.</span> <span class="toc-text">innobackupex工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="toc-number">17.3.</span> <span class="toc-text">安装软件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD"><span class="toc-number">17.4.</span> <span class="toc-text">完全备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%85%A8%E6%81%A2%E5%A4%8D"><span class="toc-number">17.5.</span> <span class="toc-text">完全恢复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E5%8D%95%E5%BC%A0%E8%A1%A8"><span class="toc-number">17.6.</span> <span class="toc-text">恢复单张表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">17.7.</span> <span class="toc-text">增量备份和恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%EF%BC%9A%E5%A4%87%E4%BB%BD%E4%B8%8A%E6%AC%A1%E5%A4%87%E4%BB%BD%E5%90%8E%E4%BA%A7%E7%94%9F%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">17.7.1.</span> <span class="toc-text">增量备份：备份上次备份后产生的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">17.7.2.</span> <span class="toc-text">增量备份过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E9%87%8F%E6%81%A2%E5%A4%8D"><span class="toc-number">17.7.3.</span> <span class="toc-text">增量恢复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">18.</span> <span class="toc-text">MySQL主从数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0"><span class="toc-number">18.1.</span> <span class="toc-text">MySQL主从数据库概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E4%BB%8B%E7%BB%8D"><span class="toc-number">18.1.1.</span> <span class="toc-text">主从同步介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E7%BB%93%E6%9E%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.1.2.</span> <span class="toc-text">主从结构模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%BB%E4%B8%80%E4%BB%8E%E7%BB%93%E6%9E%84"><span class="toc-number">18.2.</span> <span class="toc-text">配置一主一从结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">18.2.1.</span> <span class="toc-text">配置主服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">18.2.2.</span> <span class="toc-text">配置从服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="toc-number">18.2.3.</span> <span class="toc-text">相关文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEMySQL%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E"><span class="toc-number">18.3.</span> <span class="toc-text">配置MySQL一主多从</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%85%E9%A1%BB%E7%A1%AE%E4%BF%9D%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4"><span class="toc-number">18.3.1.</span> <span class="toc-text">必须确保主从数据服务器数据一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="toc-number">18.3.2.</span> <span class="toc-text">配置从服务器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEMySQL%E4%B8%BB%E4%BB%8E%E4%BB%8E%E7%BB%93%E6%9E%84"><span class="toc-number">18.4.</span> <span class="toc-text">配置MySQL主从从结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="toc-number">18.4.1.</span> <span class="toc-text">配置主服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8-2"><span class="toc-number">18.4.2.</span> <span class="toc-text">配置从服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%8E%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">18.4.3.</span> <span class="toc-text">配置从从服务器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">18.5.</span> <span class="toc-text">MySQL主从同步复制模式介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6"><span class="toc-number">18.5.1.</span> <span class="toc-text">异步复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6"><span class="toc-number">18.5.2.</span> <span class="toc-text">半同步复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%85%8D%E7%BD%AE%EF%BC%88%E4%B8%B4%E6%97%B6%EF%BC%89"><span class="toc-number">18.5.3.</span> <span class="toc-text">半同步命令行配置（临时）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%B0%B8%E4%B9%85%E9%85%8D%E7%BD%AE"><span class="toc-number">18.5.4.</span> <span class="toc-text">半同步永久配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyCAT%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">19.</span> <span class="toc-text">MyCAT读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">19.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85JDK"><span class="toc-number">19.2.</span> <span class="toc-text">安装JDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85MyCAT"><span class="toc-number">19.3.</span> <span class="toc-text">安装MyCAT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEMyCAT%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">19.4.</span> <span class="toc-text">配置MyCAT读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E8%A7%84%E5%88%99"><span class="toc-number">19.4.1.</span> <span class="toc-text">配置读写分离规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="toc-number">19.4.2.</span> <span class="toc-text">配置用户访问规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8CMyCAT"><span class="toc-number">19.5.</span> <span class="toc-text">运行MyCAT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%83%BD%E6%AD%A3%E5%B8%B8%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%8F%AF%E6%9F%A5%E7%9C%8Bmycat%E6%97%A5%E5%BF%97"><span class="toc-number">19.5.1.</span> <span class="toc-text">如果不能正常启动服务可查看mycat日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">19.5.2.</span> <span class="toc-text">验证读写分离</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87"><span class="toc-number">20.</span> <span class="toc-text">数据分片</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87%E6%A6%82%E8%BF%B0"><span class="toc-number">20.1.</span> <span class="toc-text">数据分片概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mycat%E8%BD%AF%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">20.1.1.</span> <span class="toc-text">Mycat软件介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%89%87%E8%A7%84%E5%88%99"><span class="toc-number">20.1.2.</span> <span class="toc-text">分片规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">20.1.3.</span> <span class="toc-text">工作过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6-1"><span class="toc-number">20.1.4.</span> <span class="toc-text">安装软件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E7%89%87%E6%9C%8D%E5%8A%A1"><span class="toc-number">20.2.</span> <span class="toc-text">配置数据库分片服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mycat%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">20.2.1.</span> <span class="toc-text">mycat目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">20.2.2.</span> <span class="toc-text">重要配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E7%94%A8%E6%88%B7"><span class="toc-number">20.2.3.</span> <span class="toc-text">创建连接用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87"><span class="toc-number">20.2.4.</span> <span class="toc-text">配置数据分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">20.2.5.</span> <span class="toc-text">定义数据库服务器主机名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E5%99%A8IP%E5%9C%B0%E5%9D%80"><span class="toc-number">20.2.6.</span> <span class="toc-text">定义服务器IP地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%BA%93"><span class="toc-number">20.2.7.</span> <span class="toc-text">创建存储数据的库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">20.2.8.</span> <span class="toc-text">启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="toc-number">20.2.9.</span> <span class="toc-text">客户端访问</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%89%87%E8%A7%84%E5%88%99-%E6%9E%9A%E4%B8%BE%E6%B3%95"><span class="toc-number">20.3.</span> <span class="toc-text">分片规则-枚举法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sharding-by-intfile"><span class="toc-number">20.3.1.</span> <span class="toc-text">sharding-by-intfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">20.3.2.</span> <span class="toc-text">创建数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%89%87%E8%A7%84%E5%88%99-%E6%B1%82%E6%A8%A1%E6%B3%95"><span class="toc-number">20.4.</span> <span class="toc-text">分片规则-求模法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mod-long"><span class="toc-number">20.4.1.</span> <span class="toc-text">mod-long</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%BA%93%E6%96%B0%E8%A1%A8"><span class="toc-number">20.5.</span> <span class="toc-text">添加新库新表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%BA%93"><span class="toc-number">20.5.1.</span> <span class="toc-text">添加新库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%A1%A8"><span class="toc-number">20.5.2.</span> <span class="toc-text">添加新表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">20.5.3.</span> <span class="toc-text">客户端测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.</span> <span class="toc-text">存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%BB%8B%E7%BB%8D"><span class="toc-number">21.1.</span> <span class="toc-text">存储引擎介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-1"><span class="toc-number">21.1.1.</span> <span class="toc-text">存储引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.1.2.</span> <span class="toc-text">查看可用的存储引擎</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E8%AF%A5%E6%9C%8D%E5%8A%A1%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.2.</span> <span class="toc-text">修该服务存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%8C%87%E5%AE%9A%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.2.1.</span> <span class="toc-text">创建表时指定存储引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%B7%B2%E6%9C%89%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.2.2.</span> <span class="toc-text">修改已有表的存储引擎</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-number">21.3.</span> <span class="toc-text">常用存储引擎特点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#innodb%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.3.1.</span> <span class="toc-text">innodb存储引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#myisam%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.3.2.</span> <span class="toc-text">myisam存储引擎</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E9%94%81%E6%9C%BA%E5%88%B6"><span class="toc-number">21.4.</span> <span class="toc-text">MySQL锁机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E7%B2%92%E5%BA%A6"><span class="toc-number">21.4.1.</span> <span class="toc-text">锁粒度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">21.4.2.</span> <span class="toc-text">锁类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E7%AD%89%E5%BE%85%E8%8E%B7%E5%8F%96%E9%94%81%E8%AF%B7%E6%B1%82%E7%9A%84%E4%B8%AA%E6%95%B0"><span class="toc-number">21.4.3.</span> <span class="toc-text">显示等待获取锁请求的个数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7"><span class="toc-number">21.5.</span> <span class="toc-text">事务特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Atomic%EF%BC%9A%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="toc-number">21.5.1.</span> <span class="toc-text">Atomic：原子性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Consistency%EF%BC%9A%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">21.5.2.</span> <span class="toc-text">Consistency：一致性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Isolation%EF%BC%9A%E9%9A%94%E7%A6%BB%E6%80%A7"><span class="toc-number">21.5.3.</span> <span class="toc-text">Isolation：隔离性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Durability%EF%BC%9A%E6%8C%81%E4%B9%85%E6%80%A7"><span class="toc-number">21.5.4.</span> <span class="toc-text">Durability：持久性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7%E6%BC%94%E7%A4%BA"><span class="toc-number">21.5.5.</span> <span class="toc-text">事务特性演示</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/12/docker-push/" title="一键 docker 打标签 &amp; 上传到 Harbor"><img src="/../images/title/docker-sh.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一键 docker 打标签 &amp; 上传到 Harbor"/></a><div class="content"><a class="title" href="/2024/10/12/docker-push/" title="一键 docker 打标签 &amp; 上传到 Harbor">一键 docker 打标签 &amp; 上传到 Harbor</a><time datetime="2024-10-11T16:16:00.000Z" title="发表于 2024-10-12 00:16:00">2024-10-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/12/hadoop%E8%84%9A%E6%9C%AC/" title="基于完全分布式模式部署 Hadoop"><img src="/../images/title/hadoop-jb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于完全分布式模式部署 Hadoop"/></a><div class="content"><a class="title" href="/2024/10/12/hadoop%E8%84%9A%E6%9C%AC/" title="基于完全分布式模式部署 Hadoop">基于完全分布式模式部署 Hadoop</a><time datetime="2024-10-11T16:10:00.000Z" title="发表于 2024-10-12 00:10:00">2024-10-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/12/markdown%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/" title="markdown 文字效果"><img src="/../images/title/markdown.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="markdown 文字效果"/></a><div class="content"><a class="title" href="/2024/10/12/markdown%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/" title="markdown 文字效果">markdown 文字效果</a><time datetime="2024-10-11T16:00:00.000Z" title="发表于 2024-10-12 00:00:00">2024-10-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/23/Day05-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="常见文本处理工具和正则表达式"><img src="/../images/title/linux5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常见文本处理工具和正则表达式"/></a><div class="content"><a class="title" href="/2024/09/23/Day05-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="常见文本处理工具和正则表达式">常见文本处理工具和正则表达式</a><time datetime="2024-09-22T16:00:00.000Z" title="发表于 2024-09-23 00:00:00">2024-09-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By W</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>