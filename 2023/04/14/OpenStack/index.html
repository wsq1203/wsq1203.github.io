<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>私有云相关赛题 | CLOUD</title><meta name="author" content="W"><meta name="copyright" content="W"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="比赛时遇到的私有云相关赛题">
<meta property="og:type" content="article">
<meta property="og:title" content="私有云相关赛题">
<meta property="og:url" content="http://example.com/2023/04/14/OpenStack/index.html">
<meta property="og:site_name" content="CLOUD">
<meta property="og:description" content="比赛时遇到的私有云相关赛题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/jihu/wallpaper/used/openstack.jpg">
<meta property="article:published_time" content="2023-04-13T16:00:00.000Z">
<meta property="article:modified_time" content="2024-04-02T09:59:58.574Z">
<meta property="article:author" content="W">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/jihu/wallpaper/used/openstack.jpg"><link rel="shortcut icon" href="/../jihu/wallpaper/used/user.jpg"><link rel="canonical" href="http://example.com/2023/04/14/OpenStack/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '私有云相关赛题',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-02 17:59:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../jihu/wallpaper/used/user.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../jihu/wallpaper/used/openstack.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="CLOUD"><span class="site-name">CLOUD</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">私有云相关赛题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-13T16:00:00.000Z" title="发表于 2023-04-14 00:00:00">2023-04-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-02T09:59:58.574Z" title="更新于 2024-04-02 17:59:58">2024-04-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E7%AB%9E%E8%B5%9B/">云计算职业技能竞赛</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>44分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="私有云相关赛题"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="云计算三种模式"><a href="#云计算三种模式" class="headerlink" title="云计算三种模式"></a>云计算三种模式</h1><h2 id="iaas云"><a href="#iaas云" class="headerlink" title="iaas云"></a>iaas云</h2><ul>
<li>IaaS（Infrastructure as Service）基础设施及服务</li>
<li>提供给消费者的服务是对所有计算基础设施的使用</li>
<li>包括处理CPU、内存、存储、网络和其他基本的计算资源</li>
<li>用户能够部署和运行任意软件，包括操作系统和应用程序</li>
<li>IaaS通常分为三种用法：公有云，私有云和混合云</li>
</ul>
<h2 id="paas云"><a href="#paas云" class="headerlink" title="paas云"></a>paas云</h2><ul>
<li>PaaS（platform-as-a-Serevice）平台即服务</li>
<li>以服务器平台或者开发环境按需提供的服务</li>
<li>PaaS不仅仅是单纯的基础平台，话包括对该平台的技术支持，应用系统开发、优化等服务</li>
<li>简单地说，PaaS也可以说是中间件即服务</li>
</ul>
<h2 id="saas云"><a href="#saas云" class="headerlink" title="saas云"></a>saas云</h2><ul>
<li>SaaS（Software-as-a-Service）软件即服务</li>
<li>是一种通过Internet提供软件的模式</li>
<li>软件厂商将应用软件部署在服务器上，客户可以根据自己的实际需求，通过互联网自助购买所需的应用软件服务</li>
<li>SaaS云服务也可以说是一种软件云服务</li>
</ul>
<h1 id="openstack概述"><a href="#openstack概述" class="headerlink" title="openstack概述"></a>openstack概述</h1><h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a><strong>起源</strong></h2><p>Ø openstack是一个由NASA（美国国家航天局）和Rackspace合作研发并发起的项目</p>
<p>Ø openstack是一套Iaas解决方案</p>
<p>Ø open stack是一个开源的云计算管理平台</p>
<p>Ø 以Apache许可证为授权</p>
<p>Ø openstack组件</p>
<p><img src="../../../../jihu/image/CLOUD/OpenStack/1.jpg" alt="1.jpg"></p>
<h2 id="Horizon组件"><a href="#Horizon组件" class="headerlink" title="Horizon组件"></a><strong>Horizon组件</strong></h2><p>Ø Horizon为open stack服务的Web控制面板，他可以管理实例，镜像，创建密钥对，对实例添加卷，操作Swifi容器等</p>
<p>Ø Horizon具有如下一些特点：</p>
<p>Ø 实例管理：创建，终止实例，查看终端日志，VNC连接，添加卷等</p>
<p>Ø 访问与安全管理：创建完全群组，管理密钥对，设置浮动IP等</p>
<p>Ø 镜像管理：编辑或删除镜像</p>
<p>Ø 管理用户，配额及项目用途</p>
<h2 id="Keystone组件"><a href="#Keystone组件" class="headerlink" title="Keystone组件"></a><strong>Keystone组件</strong></h2><p>Ø 为其它服务提供认证和授权的集中身份管理服务</p>
<p>Ø 也提供集中目录服务</p>
<p>Ø 支持多种的身份认证模式，如密码认证，令牌认证，以及AWS（亚马逊Web服务）登录</p>
<p>Ø 为用户和其它服务提供了SSO认证服务</p>
<h2 id="Nova组件"><a href="#Nova组件" class="headerlink" title="Nova组件"></a><strong>Nova组件</strong></h2><p>Ø 在节点上用于管理虚拟机的服务</p>
<p>Ø Nova是一个分布式的服务，能够与Keystone交互实现认证，与Glance交互实现镜像管理</p>
<p>Ø Nova被设计成在标准硬件上能够进行水平扩展</p>
<p>Ø 启动实例时，如果有则需要下载镜像</p>
<h2 id="Glance组件"><a href="#Glance组件" class="headerlink" title="Glance组件"></a><strong>Glance组件</strong></h2><p>Ø 扮演虚拟机镜像注册的角色</p>
<p>Ø 允许用户直接存储拷贝服务器镜像</p>
<p>Ø 这些镜像可以用于新建虚拟机模板</p>
<h2 id="swift组件"><a href="#swift组件" class="headerlink" title="swift组件"></a><strong>swift组件</strong></h2><p>Ø 这是对象存储组件</p>
<p>Ø 对于大部分用户来说，swift组件不是必须的</p>
<p>Ø 只有存储数量到一定级别，而且是非结构化数据才有这样的需求</p>
<h2 id="Neutron组件"><a href="#Neutron组件" class="headerlink" title="Neutron组件"></a><strong>Neutron组件</strong></h2><p>Ø 一种软件定义网络服务</p>
<p>Ø 用于创建网络，子网，路由器，管理浮动ip地址</p>
<p>Ø 可以实现虚拟交换机，虚拟路由器</p>
<p>Ø 可由于在项目中创建VPN</p>
<h2 id="Cinder组件"><a href="#Cinder组件" class="headerlink" title="Cinder组件"></a><strong>Cinder组件</strong></h2><p>Ø 为虚拟机管理存储卷服务</p>
<p>Ø 为运行在Nova中的实例提供永久的块存储</p>
<p>Ø 可以通过快照进行数据备份</p>
<p>Ø 经常应用在实例存储环境中，如数据库文件</p>
<h2 id="项目及用户管理"><a href="#项目及用户管理" class="headerlink" title="项目及用户管理"></a>项目及用户管理</h2><h3 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h3><ul>
<li>项目是由admin角色的用户创建的</li>
<li>项目：一组隔离的资源和对象。由一组关联的用户进行管理</li>
<li>根据配置的需求，项目对应一个组织，一个公司或是一个使用客户等</li>
<li>项目中可以有多个用户，项目中的用户用来管理虚拟资源</li>
<li>项目相关的信息保存在数据库中</li>
</ul>
<h3 id="默认项目"><a href="#默认项目" class="headerlink" title="默认项目"></a>默认项目</h3><ul>
<li>缺省情况下，packstack安装的openstack中有两个独立项目</li>
<li>admin：为admin账户创建的项目</li>
<li>services：与安装的各个服务相关联</li>
</ul>
<h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><ul>
<li>用户在openstack中用于身份认证</li>
<li>管理用户admin一般在packstack安装过程中创建</li>
<li>其他用户由管理员用户创建，并制定可以访问的项目</li>
<li>非管理员用户创建后，保存到数据库中</li>
</ul>
<h3 id="用户权限"><a href="#用户权限" class="headerlink" title="用户权限"></a>用户权限</h3><p>非管理员用户具以下权限</p>
<ul>
<li>启动实例</li>
<li>创建卷和快照</li>
<li>创建镜像</li>
<li>分配浮动IP</li>
<li>创建网络和路由</li>
<li>创建防火墙以及规则、规则策略</li>
<li>查看网络拓扑、项目使用概况等</li>
</ul>
<h2 id="Glance镜像即云主机类型"><a href="#Glance镜像即云主机类型" class="headerlink" title="Glance镜像即云主机类型"></a>Glance镜像即云主机类型</h2><h3 id="镜像管理"><a href="#镜像管理" class="headerlink" title="镜像管理"></a>镜像管理</h3><ul>
<li>在红帽openstack平台中，镜像指的是虚拟磁盘文件</li>
<li>磁盘文件总应该已经安装了可用的操作系统</li>
<li>镜像管理功能由Glance服务提供</li>
<li>它形成了创建虚拟机实例最底层的块结构</li>
<li>镜像可以由用户自己创建，也可以通过红帽官方站点下载</li>
</ul>
<h3 id="镜像磁盘格式"><a href="#镜像磁盘格式" class="headerlink" title="镜像磁盘格式"></a>镜像磁盘格式</h3><ul>
<li>raw：非结构化磁盘镜像格式</li>
<li>vhd：VMware、Xen、Microsoft、Virtual Box等均支持的磁盘格式</li>
<li>vmdk：是Vmware的虚拟磁盘格式</li>
<li>vdi：VirtualBox虚拟机和QEMU支持磁盘格式</li>
<li>iso：光盘数据内容的归档格式</li>
<li>qcow2：QEMU支持的磁盘格式。空间自动扩展，并支持写时复制copy-on-write</li>
</ul>
<h3 id="cow介绍"><a href="#cow介绍" class="headerlink" title="cow介绍"></a>cow介绍</h3><ul>
<li>Copy On Write 写时复制</li>
<li>直接映射原始盘的数据内容</li>
<li>当数据有修改要求时，再修改之前自动将旧数据拷贝存入前端盘后，对前端盘进行修改</li>
<li>原始盘始终是只读的</li>
</ul>
<h3 id="云主机类型"><a href="#云主机类型" class="headerlink" title="云主机类型"></a>云主机类型</h3><ul>
<li>云主机类型就是资源的模板</li>
<li>它定义了一台云主机可以使用的资源，如内存大小、磁盘容量和CPU核心数等</li>
<li>管理员可以自定义云主机类型</li>
</ul>
<h2 id="Neutron网络管理"><a href="#Neutron网络管理" class="headerlink" title="Neutron网络管理"></a>Neutron网络管理</h2><ul>
<li><p>实例被分配到子网中，以实现网络联通</p>
</li>
<li><p>每个项目可以有一到多个子网</p>
</li>
<li><p>每个项目可以拥有多个私有网络</p>
</li>
<li><p>各个项目的私有网络互不干扰</p>
</li>
<li><p>网络间可用vlan隔离</p>
</li>
<li><p>提供商网络：</p>
<p>将实例连接到现有网络，实现虚拟机实例与外部系统共享同一二层网络</p>
</li>
</ul>
<h2 id="安全组"><a href="#安全组" class="headerlink" title="安全组"></a>安全组</h2><ul>
<li>安全组用于控制对虚拟机实例的访问</li>
<li>安全组在高层定义了哪些网络及哪些协议是被授权可以访问虚拟机实例的</li>
<li>每个项目都可以定义自己的安全组</li>
<li>项目成员可以编辑默认的安全组规则，也可以添加新的安全组规则</li>
<li>每个规则都有出和入两个方向</li>
<li>所有项目都有一个默认的default安全组</li>
</ul>
<h1 id="Oenstack搭建"><a href="#Oenstack搭建" class="headerlink" title="Oenstack搭建"></a>Oenstack搭建</h1><h2 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h2><p>（1）设置控制节点主机名为controller，设置计算节点主机名为compute；</p>
<p>（2）修改hosts文件将IP地址映射为主机名；</p>
<p>（3）关闭防火墙；</p>
<p>（4）将selinux改为宽容模式；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###修改主机名</span></span><br><span class="line">[root@controller ~]<span class="comment"># hostnamectl set-hostname controller    </span></span><br><span class="line">[root@compute ~]<span class="comment"># hostnamectl set-hostname compute                      ###计算节点为compute</span></span><br><span class="line"><span class="comment">###主机名映射</span></span><br><span class="line">[root@controller ~]<span class="comment"># cat /etc/hosts                       ###两个节点都需要配置</span></span><br><span class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.1.10 controller</span><br><span class="line">192.168.1.20 compute</span><br><span class="line"><span class="comment">###关闭防火墙</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl disable --now firewalld</span></span><br><span class="line">[root@compute ~]<span class="comment"># systemctl disable --now firewalld</span></span><br><span class="line"><span class="comment">###修改selinux模式   ###两个节点都需要配置</span></span><br><span class="line">[root@controller ~]<span class="comment"># setenforce 0                         ###临时修改</span></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/selinux/config              ###开机自动关闭</span></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>

<h2 id="YUM源配置"><a href="#YUM源配置" class="headerlink" title="YUM源配置"></a>YUM源配置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">###镜像源</span></span><br><span class="line">[root@controller ~]<span class="comment"># yum install vsftpd -y                              ###安装ftp服务器</span></span><br><span class="line">[root@controller ~]<span class="comment"># echo &quot;anon_root=/opt&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf   ###指定ftp目录</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable --now vsftpd                      ###启动ftp</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to </span><br><span class="line">/usr/lib/systemd/system/vsftpd.service.</span><br><span class="line"></span><br><span class="line">[root@compute ~]<span class="comment"># cat /etc/yum.repos.d/local.repo                       ###编写yum源</span></span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=ftp://controller/iaas/iaas-repo                       <span class="comment">###网络源修改此处改为网络源地址</span></span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>

<h2 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h2><p>在controller节点上部署chrony服务器，允许其他节点同步时间，启动服务并设置为开机启动；在compute节点上指定controller节点为上游NTP服务器，重启服务并设为开机启动。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">###安装chrony</span></span><br><span class="line">[root@controller ~]<span class="comment"># yum install chrony -y</span></span><br><span class="line">[root@compute ~]<span class="comment"># yum install chrony -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###配置时间同步服务器</span></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/chrony.conf</span></span><br><span class="line">server master iburst                                                    <span class="comment">###与哪个服务器同步</span></span><br><span class="line"><span class="comment"># Allow NTP client access from local network.                           ###同步的网段</span></span><br><span class="line">allow 192.168.0.0/16</span><br><span class="line"><span class="comment"># Serve time even if not synchronized to a time source.   ####即使未同步到时间源，也要提供时间</span></span><br><span class="line"><span class="built_in">local</span> stratum 10</span><br><span class="line"></span><br><span class="line">[root@compute ~]<span class="comment"># vim /etc/chrony.conf</span></span><br><span class="line">server master iburst</span><br><span class="line"></span><br><span class="line"><span class="comment">###测试</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable --now chronyd.service </span></span><br><span class="line">[root@compute ~]<span class="comment"># systemctl enable --now chronyd.service </span></span><br><span class="line"></span><br><span class="line">[root@compute ~]<span class="comment"># chronyc sources</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address Stratum Poll Reach LastRx Last sample </span><br><span class="line">===============================================================================</span><br><span class="line">^* controller 11 6 17 8 -5897ns[ -18us] +/- 399us</span><br><span class="line"><span class="comment">###*为成功同步，?为同步失败</span></span><br></pre></td></tr></table></figure>

<h2 id="计算节点分区"><a href="#计算节点分区" class="headerlink" title="计算节点分区"></a>计算节点分区</h2><p>在compute节点上利用空白分区划分2个20G分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###分区</span></span><br><span class="line">[root@compute ~]<span class="comment"># fdisk /dev/sda                ###磁盘名</span></span><br><span class="line">欢迎使用 fdisk (util-linux 2.23.2)。</span><br><span class="line"></span><br><span class="line">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class="line">使用写入命令前请三思。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n                 <span class="comment">###n为分区</span></span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">p primary (3 primary, 0 extended, 1 free)          <span class="comment">###主分区</span></span><br><span class="line">e extended                                         <span class="comment">###逻辑分区</span></span><br><span class="line">Select (default e): p</span><br><span class="line">已选择分区 4</span><br><span class="line">起始 扇区 (973088768-1468006399，默认为 973088768)：</span><br><span class="line">将使用默认值 973088768</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (973088768-1468006399，默认为 1468006399)：+20G</span><br><span class="line">分区 4 已设置为 Linux 类型，大小设为 20 GiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w                             <span class="comment">###保存退出</span></span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line"></span><br><span class="line">WARNING: Re-reading the partition table failed with error 16: 设备或资源忙.</span><br><span class="line">The kernel still uses the old table. The new table will be used at</span><br><span class="line">the next reboot or after you run partprobe(8) or kpartx(8)</span><br><span class="line">正在同步磁盘。</span><br><span class="line"></span><br><span class="line"><span class="comment">###手动同步磁盘</span></span><br><span class="line">[root@compute ~]<span class="comment"># partprobe</span></span><br><span class="line">Warning: 无法以读写方式打开 /dev/sr0 (只读文件系统)。/dev/sr0 已按照只读方式打开。</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看分区是否成功</span></span><br><span class="line">[root@compute ~]<span class="comment"># lsblk</span></span><br><span class="line">NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda 8:0 0 700G 0 disk </span><br><span class="line">├─sda1 8:1 0 3G 0 part /boot</span><br><span class="line">├─sda2 8:2 0 361G 0 part </span><br><span class="line">│ ├─centos_openstack-root 253:0 0 300G 0 lvm /</span><br><span class="line">│ ├─centos_openstack-swap 253:1 0 1G 0 lvm [SWAP]</span><br><span class="line">│ └─centos_openstack-home 253:2 0 60G 0 lvm /home</span><br><span class="line">├─sda3 8:3 0 100G 0 part </span><br><span class="line">└─sda4 8:4 0 20G 0 part</span><br><span class="line">sr0 11:0 1 4.2G 0 rom /opt/centos</span><br></pre></td></tr></table></figure>

<h2 id="openstack环境搭建"><a href="#openstack环境搭建" class="headerlink" title="openstack环境搭建"></a>openstack环境搭建</h2><p>在控制节点和计算节点上分别安装iaas-xiandian软件包，根据表2配置两个节点脚本文件中的基本变量（配置脚本文件为/etc/xiandian/openrc.sh）</p>
<table>
<thead>
<tr>
<th>服务名称</th>
<th>变量</th>
<th>参数/密码</th>
</tr>
</thead>
<tbody><tr>
<td>Mysql</td>
<td>root</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Keystone</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Glance</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Nova</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Neutron</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Heat</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Zun</td>
<td>000000</td>
</tr>
<tr>
<td>Keystone</td>
<td>DOMAIN_NAME</td>
<td>demo</td>
</tr>
<tr>
<td></td>
<td>Admin</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Rabbit</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Glance</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Nova</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Neutron</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Heat</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>Zun</td>
<td>000000</td>
</tr>
<tr>
<td>Neutron</td>
<td>Metadata</td>
<td>000000</td>
</tr>
<tr>
<td></td>
<td>External Network</td>
<td>eth1（第二块网卡名）</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###安装所需软件包</span></span><br><span class="line">[root@controller ~]<span class="comment"># yum install iaas-xiandian -y</span></span><br><span class="line">[root@compute ~]<span class="comment"># yum install iaas-xiandian -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###修改环境变量文件</span></span><br><span class="line">[root@compute ~]<span class="comment"># sed -i &quot;s/PASS=/PASS=000000/g&quot;  /etc/xiandian/openrc.sh</span></span><br><span class="line">[root@compute ~]<span class="comment"># sed -i &quot;s/#//&quot; /etc/xiandian/openrc.sh</span></span><br><span class="line">··········</span><br><span class="line"></span><br><span class="line"><span class="comment">###为安装openstack做环境初始化</span></span><br><span class="line">[root@compute ~]<span class="comment"># iaas-pre-host.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###后面就可以跑脚本###</span></span><br><span class="line"><span class="comment">###脚本位于/usr/local/bin/目录下###</span></span><br></pre></td></tr></table></figure>

<h2 id="把controller节点加入集群"><a href="#把controller节点加入集群" class="headerlink" title="把controller节点加入集群"></a>把controller节点加入集群</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@controller images]<span class="comment"># vim /etc/xiandian/openrc.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###修改compute改为controller</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------system Config--------------------##</span></span><br><span class="line"><span class="comment">#Controller Server Manager IP. example:x.x.x.x</span></span><br><span class="line">HOST_IP=192.168.1.10</span><br><span class="line"></span><br><span class="line"><span class="comment">#Controller HOST Password. example:000000 </span></span><br><span class="line">HOST_PASS=000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#Controller Server hostname. example:controller</span></span><br><span class="line">HOST_NAME=controller</span><br><span class="line"></span><br><span class="line"><span class="comment">#Compute Node Manager IP. example:x.x.x.x</span></span><br><span class="line">HOST_IP_NODE=192.168.1.10</span><br><span class="line"></span><br><span class="line"><span class="comment">#Compute HOST Password. example:000000 </span></span><br><span class="line">HOST_PASS_NODE=000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#Compute Node hostname. example:compute</span></span><br><span class="line">HOST_NAME_NODE=controller</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@controller images]<span class="comment"># iaas-install-nova-compute.sh</span></span><br></pre></td></tr></table></figure>

<h2 id="nova安装完成后需要修改配置文件"><a href="#nova安装完成后需要修改配置文件" class="headerlink" title="nova安装完成后需要修改配置文件"></a>nova安装完成后需要修改配置文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/nova/nova.conf </span></span><br><span class="line"><span class="comment">###可以通过检索 “=kvm”  找到</span></span><br><span class="line">virt_type=kvm</span><br><span class="line"><span class="comment">###改为 qemu 不然虚拟机打不开</span></span><br><span class="line">virt_type=qemu</span><br><span class="line"></span><br><span class="line"><span class="comment">###重启</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart openstack-nova-*</span></span><br></pre></td></tr></table></figure>

<h1 id="Openstack运维"><a href="#Openstack运维" class="headerlink" title="Openstack运维"></a>Openstack运维</h1><h2 id="openstack-命令自动补全"><a href="#openstack-命令自动补全" class="headerlink" title="openstack 命令自动补全"></a>openstack 命令自动补全</h2><p>openstack complete &gt; /etc/bash_completion.d/openstack &amp;&amp; bash</p>
<h2 id="Linux-系统调优"><a href="#Linux-系统调优" class="headerlink" title="Linux 系统调优"></a>Linux 系统调优</h2><h3 id="修改脏数据可用内存百分比为60，默认为30"><a href="#修改脏数据可用内存百分比为60，默认为30" class="headerlink" title="修改脏数据可用内存百分比为60，默认为30"></a>修改脏数据可用内存百分比为60，默认为30</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###sysctl -a 显示所有的内核参数</span></span><br><span class="line"><span class="comment">###sysctl -p 加载内核参数配置，永久有效</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># sysctl -a | grep dirty</span></span><br><span class="line">vm.dirty_background_bytes = 0</span><br><span class="line">vm.dirty_background_ratio = 10</span><br><span class="line">vm.dirty_bytes = 0</span><br><span class="line">vm.dirty_expire_centisecs = 3000</span><br><span class="line">vm.dirty_ratio = 30</span><br><span class="line">vm.dirty_writeback_centisecs = 500</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;vm.dirty_ratio = 60&#x27;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="修改文件句柄数"><a href="#修改文件句柄数" class="headerlink" title="修改文件句柄数"></a>修改文件句柄数</h3><p>Linux 服务器大并发时，往往需要预先调优 Linux 参数。默认情况下，Linux 最大文件 句柄数为 1024 个。当你的服务器在大并发达到极限时，就会报出“too many open files”。 创建一台云主机，修改相关配置，将控制节点的最大文件句柄数永久修改为 65535。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###临时生效</span></span><br><span class="line">[root@controller ~]<span class="comment"># ulimit -n 65535</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###永久生效</span></span><br><span class="line">[root@controller ~]<span class="comment"># cat &gt;&gt; /etc/security/limits.conf &lt;&lt;EOF</span></span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="防止-SYN-攻击"><a href="#防止-SYN-攻击" class="headerlink" title="防止 SYN 攻击"></a>防止 SYN 攻击</h3><p>修改 controller 节点的相关配置文件，开启 SYN cookie，防止 SYN 洪水攻击</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###默认的SYN相关配置</span></span><br><span class="line">[root@controller ~]<span class="comment"># sysctl -a | grep _syn</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 512</span><br><span class="line">net.ipv4.tcp_syn_retries = 6</span><br><span class="line">net.ipv4.tcp_synack_retries = 5</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line"><span class="comment">###参数释义</span></span><br><span class="line">tcp_max_syn_backlog是SYN队列的长度，加大SYN队列长度可以容纳更多等待连接的网络连接数。 </span><br><span class="line">tcp_syncookies是一个开关，是否打开SYN Cookie 功能，该功能可以防止部分SYN攻击。 </span><br><span class="line">tcp_synack_retries和tcp_syn_retries定义SYN 的重试连接次数，</span><br><span class="line">将默认的参数减小来控制SYN连接次数的尽量少。</span><br><span class="line"></span><br><span class="line"><span class="comment">###虽然默认是开启的，但是需要把配置添加到如下文件中</span></span><br><span class="line">[root@controller ~]<span class="comment"># echo &#x27;net.ipv4.tcp_syncookies = 1&#x27; &gt;&gt; /etc/sysctl.conf </span></span><br><span class="line"></span><br><span class="line"><span class="comment">###生效配置</span></span><br><span class="line">[root@controller ~]<span class="comment"># sysctl -p</span></span><br></pre></td></tr></table></figure>

<h3 id="配置controller节点禁止其他节点可以Ping它"><a href="#配置controller节点禁止其他节点可以Ping它" class="headerlink" title="配置controller节点禁止其他节点可以Ping它"></a>配置controller节点禁止其他节点可以Ping它</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># sysctl -a |grep icmp_echo</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_all = 0</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_all = 1</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># sysctl -p</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_all = 1</span><br><span class="line"></span><br><span class="line"><span class="comment">###验证</span></span><br><span class="line">[root@controller ~]<span class="comment"># cat /proc/sys/net/ipv4/icmp_echo_ignore_all</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="内核优化"><a href="#内核优化" class="headerlink" title="内核优化"></a>内核优化</h3><p>在使用 Linux 服务器的时候，TCP 协议规定，对于已经建立的连接，网络双方要进行四 次挥手才能成功断开连接，如果缺少了其中某个步骤，将会使连接处于假死状态，连接本身 占用的资源不会被释放。因为服务器程序要同时管理大量连接，所以很有必要保证无用的连 接完全断开，否则大量僵死的连接会浪费许多服务器资源。创建一台 CentOS7.9 云主机，修 改相应的配置文件，分别开启 SYN Cookies；允许将 TIME-WAIT sockets 重新用于新的 TCP 连接；开启 TCP 连接中 TIME-WAIT sockets 的快速回收；修改系統默认的 TIMEOUT 时间 为 30。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"><span class="comment">###表示开启SYN Cookies。当出现SYN等待队列溢出时，启用cookies来处理，可防范少量SYNxxx，</span></span><br><span class="line">默认为0，表示关闭</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"><span class="comment">###表示开启重用。允许将TIME-WAIT sockets重新用于新的TCP，默认为0，表示关闭；</span></span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line"><span class="comment">###表示TCP连接中TIME-WAIT sockets的快速回收，默认为0，表示关闭</span></span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line"><span class="comment">###表示如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间</span></span><br></pre></td></tr></table></figure>

<h2 id="数据库调优"><a href="#数据库调优" class="headerlink" title="数据库调优"></a>数据库调优</h2><h3 id="将memcache缓存修改为128"><a href="#将memcache缓存修改为128" class="headerlink" title="将memcache缓存修改为128"></a>将memcache缓存修改为128</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###修改配置文件将缓存CACHESIZE修改为128</span></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/sysconfig/memcached</span></span><br><span class="line">CACHESIZE=128</span><br><span class="line"></span><br><span class="line"><span class="comment">###重启服务</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart memcached</span></span><br></pre></td></tr></table></figure>

<h3 id="修改-etc-my-cnf-文件，完成下列要求"><a href="#修改-etc-my-cnf-文件，完成下列要求" class="headerlink" title="修改/etc/my.cnf 文件，完成下列要求"></a>修改/etc/my.cnf 文件，完成下列要求</h3><p>1.设置数据库支持大小写；</p>
<p>2.设置数据库缓存 innodb 表的索引，数据，插入数据时的缓冲为 4G；</p>
<p>3.设置数据库的 log buffer 为 64MB；</p>
<p>4.设置数据库的 redo log 大小为 256MB；</p>
<p>5.设置数据库的 redo log 文件组为 2。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###可以快速定位参数</span></span><br><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line">MariaDB [(none)]&gt; show variables like <span class="string">&#x27;innodb_log%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"><span class="comment">###数据库支持大小写</span></span><br><span class="line">lower_case_table_names =1</span><br><span class="line"><span class="comment">###数据库缓存</span></span><br><span class="line">innodb_buffer_pool_size = 4G</span><br><span class="line"><span class="comment">###数据库的log buffer即redo日志缓冲</span></span><br><span class="line">innodb_log_buffer_size = 64MB</span><br><span class="line"><span class="comment">###设置数据库的redo log即redo日志大小</span></span><br><span class="line">innodb_log_file_size = 256MB</span><br><span class="line"><span class="comment">###数据库的redo log文件组即redo日志的个数配置</span></span><br><span class="line">innodb_log_files_in_group = 2</span><br><span class="line"></span><br><span class="line"><span class="comment">###重启服务</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart mariadb</span></span><br></pre></td></tr></table></figure>

<h2 id="Keystone-服务"><a href="#Keystone-服务" class="headerlink" title="Keystone 服务"></a>Keystone 服务</h2><h3 id="创建一个tom用户-密码为000000-email为-97-100-x6d-x69-110-x40-49-x32-x33-x2e-99-x6f-x6d"><a href="#创建一个tom用户-密码为000000-email为-97-100-x6d-x69-110-x40-49-x32-x33-x2e-99-x6f-x6d" class="headerlink" title="创建一个tom用户 密码为000000 email为&#97;&#100;&#x6d;&#x69;&#110;&#x40;&#49;&#x32;&#x33;&#x2e;&#99;&#x6f;&#x6d;"></a>创建一个tom用户 密码为000000 email为<a href="mailto:&#97;&#100;&#x6d;&#x69;&#110;&#x40;&#49;&#x32;&#x33;&#x2e;&#99;&#x6f;&#x6d;">&#97;&#100;&#x6d;&#x69;&#110;&#x40;&#49;&#x32;&#x33;&#x2e;&#99;&#x6f;&#x6d;</a></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># source /etc/keystone/admin-openrch.sh</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack user create --domain demo --password 000000 \</span></span><br><span class="line">&gt; --email admin@123.com tom</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看user</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack user list</span></span><br></pre></td></tr></table></figure>

<h3 id="列出一个token"><a href="#列出一个token" class="headerlink" title="列出一个token"></a>列出一个token</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack token issue</span></span><br></pre></td></tr></table></figure>

<h3 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h3><p>在keystone中创建shop项目添加描述为“hello shop”，完成后使用open stack命令禁用该项目，最后使用openstack命令查看该项目</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###创建项目</span></span><br><span class="line">openstack project create --description <span class="string">&quot;hello shop&quot;</span> --domain demo shop </span><br><span class="line"></span><br><span class="line"><span class="comment">###禁用</span></span><br><span class="line">openstack project <span class="built_in">set</span> --<span class="built_in">disable</span> shop</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看</span></span><br><span class="line">openstack project show shop</span><br></pre></td></tr></table></figure>

<h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><p>使用nova命令查看admin租户的当前配额值，将admin租户的实例配额值提升到13</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查看</span></span><br><span class="line">nova quota-class-show admin</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Quota                | Limit |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| instances            | 10    |</span><br><span class="line">| cores                | 20    |</span><br><span class="line">| ram                  | 51200 |</span><br><span class="line">| metadata_items       | 128   |</span><br><span class="line">| key_pairs            | 100   |</span><br><span class="line">| server_groups        | 10    |</span><br><span class="line">| server_group_members | 10    |</span><br><span class="line">+----------------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">###修改</span></span><br><span class="line">nova quota-class-update admin --instances 13</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看</span></span><br><span class="line">nova quota-class-show admin</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Quota                | Limit |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| instances            | 13    |</span><br><span class="line">| cores                | 20    |</span><br><span class="line">| ram                  | 51200 |</span><br><span class="line">| metadata_items       | 128   |</span><br><span class="line">| key_pairs            | 100   |</span><br><span class="line">| server_groups        | 10    |</span><br><span class="line">| server_group_members | 10    |</span><br><span class="line">+----------------------+-------+</span><br></pre></td></tr></table></figure>

<h2 id="glance镜像服务"><a href="#glance镜像服务" class="headerlink" title="glance镜像服务"></a>glance镜像服务</h2><h3 id="将提供-的-cirros-0-3-4-x86-64-disk-img-镜像（该镜像在-HTTP-服务中，可自行下载）上传至平台，-命名为-cirros，并设置最小启动需要的硬盘为-10G，最小启动需要的内存为-1G。"><a href="#将提供-的-cirros-0-3-4-x86-64-disk-img-镜像（该镜像在-HTTP-服务中，可自行下载）上传至平台，-命名为-cirros，并设置最小启动需要的硬盘为-10G，最小启动需要的内存为-1G。" class="headerlink" title="将提供 的 cirros-0.3.4-x86_64-disk.img 镜像（该镜像在 HTTP 服务中，可自行下载）上传至平台， 命名为 cirros，并设置最小启动需要的硬盘为 10G，最小启动需要的内存为 1G。"></a>将提供 的 cirros-0.3.4-x86_64-disk.img 镜像（该镜像在 HTTP 服务中，可自行下载）上传至平台， 命名为 cirros，并设置最小启动需要的硬盘为 10G，最小启动需要的内存为 1G。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###下载镜像</span></span><br><span class="line">[root@controller ~]<span class="comment">#  curl -O http://10.18.4.100/cirros-0.3.4-x86_64-disk.img</span></span><br><span class="line">                                or</span><br><span class="line">[root@controller ~]<span class="comment">#  wget http://10.18.4.100/cirros-0.3.4-x86_64-disk.img</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###创建符合要求的镜像</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack image create --min-disk 10 --min-ram 1024 \</span></span><br><span class="line">&gt; --file cirros-0.3.3-x86_64-disk.img cirros</span><br><span class="line"></span><br><span class="line"><span class="comment">###验证</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack image list</span></span><br></pre></td></tr></table></figure>

<h3 id="OpenStack-开放镜像权限"><a href="#OpenStack-开放镜像权限" class="headerlink" title="OpenStack 开放镜像权限"></a>OpenStack 开放镜像权限</h3><p>使 用 OpenStack 私 有 云 平 台 ， 在 OpenStack 平台的 admin 项 目 中 使 用 cirros-0.3.4-x86_64-disk.img 镜像文件创建名为 glance-cirros 的镜像，通过 OpenStack 命令将 glance-cirros 镜像指定 demo 项目进行共享使用。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack image create --shared --project demo \</span></span><br><span class="line">&gt; --file cirros-0.3.4-x86_64-disk.img glance-cirros</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># glance member-create [镜像id] [域名id]</span></span><br><span class="line">[root@controller ~]<span class="comment"># glance member-update [镜像id] [域名id] accepted</span></span><br></pre></td></tr></table></figure>

<h3 id="后端配置文件管理"><a href="#后端配置文件管理" class="headerlink" title="后端配置文件管理"></a>后端配置文件管理</h3><p>进入到 glance 后端存储目录中，使用 qemu 命令查看任意的一个镜像信息。 使用 du 命令查看 nova 主配置文件大小。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># cd /var/lib/glance/image &amp;&amp; ls</span></span><br><span class="line">qemu-img info xxxxxxxx</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># du -sh /etc/nova/nova.conf</span></span><br></pre></td></tr></table></figure>

<p>请修改glance后端配置文件，将项目的映像存储限制为10G，完成后重启glance服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bc计算出10G</span><br><span class="line">1024^3*10</span><br><span class="line">10737418240</span><br><span class="line"></span><br><span class="line">vim /etc/glance/glance-api.conf (/user_storage)</span><br><span class="line">user_storage_quota = 10737418240</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-glance-*</span><br></pre></td></tr></table></figure>

<h3 id="OpenStack-Glance-镜像管理"><a href="#OpenStack-Glance-镜像管理" class="headerlink" title="OpenStack Glance 镜像管理"></a>OpenStack Glance 镜像管理</h3><p>使用自行搭建的 OpenStack 平台。在 HTTP 服务中存在一个镜像为 CentOS7.5-compress.qcow2 的镜像，请使用 qemu 相关命令，对该镜像进行压缩，压缩后的 镜像命名为 chinaskill-js-compress.qcow2 并存放在/root 目录下。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># qemu-img convert -c -O qcow2 centos7_33.qcow2 compress_newdisk.qcow2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###解释</span></span><br><span class="line"></span><br><span class="line">-c  压缩</span><br><span class="line"></span><br><span class="line">-O qcow2 输出格式为 qcow2</span><br><span class="line"></span><br><span class="line">centos7_33.qcow2被压缩文件路径</span><br><span class="line"></span><br><span class="line">compress_newdisk.qcow2压缩完成后文件路径</span><br></pre></td></tr></table></figure>

<p>使用qemu-img相关命令，查询Gmirror1镜像的compat版本，然后将Gmirror1镜像的campat版本修改为0.10（该操作是为了适配某些低版本的云平台）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># cd /var/lib/glance/images/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###修改campat版本</span></span><br><span class="line">[root@controller ~]<span class="comment"># qemu-img amend -f qcow2 -o compat=0.10 [镜像id]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###查看镜像信息</span></span><br><span class="line">[root@controller ~]<span class="comment"># qemu-img info [镜像id]</span></span><br></pre></td></tr></table></figure>

<p>某OpenStack云平台有两个租户，A租户与B租户，分别属于两个部门，该公司对镜像的管理比较严格， 镜像都由管理员进行上传和权限管理。通过管理员上传该镜像，并使用相关命令开放镜像权限给A租 户，B租户不可见。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># glance member-create 1fa9cbfe-392f-437e-ad18-f00987415b15 \</span></span><br><span class="line">&gt; df58511d2c914690b48e89f1e512ae6b</span><br><span class="line"></span><br><span class="line"><span class="comment">###镜像ID 1fa9cbfe-392f-437e-ad18-f00987415b15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###用户A ID df58511d2c914690b48e89f1e512ae6b</span></span><br><span class="line"></span><br><span class="line">[root@openstack ~]<span class="comment"># glance member-update 1fa9cbfe-392f-437e-ad18-f00987415b15</span></span><br><span class="line">df58511d2c914690b48e89f1e512ae6b accepted</span><br></pre></td></tr></table></figure>

<h3 id="改-glance-存储后端"><a href="#改-glance-存储后端" class="headerlink" title="改 glance 存储后端"></a>改 glance 存储后端</h3><p>使用赛项提供的 OpenStack 私有云平台，创建一台云主机（镜像使用 CentOS7.5，flavor 使用带临时 磁盘 50G 的），配置该主机为 nfs 的 server 端，将该云主机中的/mnt/test 目录进 行共享（目录不存 在可自行创建）。然后配置 controller 节点为 nfs 的 client 端，要求将/mnt/test 目录作为 glance 后端 存储的挂载目录。配置完成后提交 controller 控制节点的用户名、密码 和 IP 地址到答题框。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###创建一台云主机，创建成功如下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###安装nfs rpcbind软件包</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum install -y nfs-utils rpcbind</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /mnt/test</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/exports</span></span><br><span class="line">/mnt/test *(rw)</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl start rpcbind</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl enable rpcbind</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl start nfs</span></span><br><span class="line">[A[root@localhost ~]<span class="comment"># systemctl enable nfs</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># showmount -e 192.168.10.4</span></span><br><span class="line">Export list <span class="keyword">for</span> 192.168.10.4:</span><br><span class="line">/mnt/test *</span><br><span class="line"></span><br><span class="line"><span class="comment">###控制节点操作</span></span><br><span class="line">[root@controller ~]<span class="comment"># mount -t nfs 192.168.10.4:/mnt/test  \</span></span><br><span class="line">&gt;  /var/lib/glance/images/</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># chown -R glance:glance /var/lib/glance/</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># ls -ld /var/lib/glance/</span></span><br><span class="line">drwxr-xr-x. 3 glance glance 20 Nov 10 10:54 /var/lib/glance/</span><br><span class="line"></span><br><span class="line"><span class="comment">### mount查看一下效果</span></span><br><span class="line">[root@controller ~]<span class="comment"># mount </span></span><br><span class="line">192.168.10.4:/mnt/test on /var/lib/glance/images <span class="built_in">type</span> nfs4</span><br><span class="line">(rw,relatime,vers=4.1,rsize=262144,wsize=262144,namlen=255,hard,proto=tcp,po</span><br><span class="line">rt=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.10.130,local_lock=none,a</span><br><span class="line">ddr=192.168.10.4)</span><br></pre></td></tr></table></figure>

<h3 id="glance对接cinder"><a href="#glance对接cinder" class="headerlink" title="glance对接cinder"></a>glance对接cinder</h3><p>在自行搭建的 OpenStack平台中修改相关参数，使 glance 可以使用 cinder作为后端存储， 将镜像存储于 cinder 卷中。使用 cirros-0.3.4-x86_64-disk.img 文件创建 cirros-image 镜像存储 于 cirros-cinder 卷中，通过 cirros-image 镜像使用 cinder 卷启动盘的方式进行创建虚拟机。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###修改/etc/glance/glance-api.conf</span></span><br><span class="line"><span class="comment">###为了允许镜像服务使用cinder作为后端存储，在stores=file,http,swift中增加cinder</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/glance/glance-api.conf</span></span><br><span class="line">[glance_store]</span><br><span class="line">stores = file,http,swift,cinder</span><br><span class="line">default_store = cinder</span><br><span class="line">filesystem_store_datadir = /var/lib/glance/images/</span><br><span class="line"></span><br><span class="line"><span class="comment">###为了能够解析locations信息，需要将show_multiple_locations修改为True</span></span><br><span class="line"> <span class="comment">#show_multiple_locations = false</span></span><br><span class="line"><span class="comment">###取消注释改为True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###修改/etc/cinder/cinder.conf</span></span><br><span class="line"></span><br><span class="line">allowed_direct_url_schemes  修改为  cinder</span><br><span class="line">image_upload_use_cinder_backend  设置为  True</span><br><span class="line">image_upload_use_internal_tenant = True</span><br><span class="line"></span><br><span class="line"><span class="comment">###重启glance cinder 服务</span></span><br><span class="line"><span class="comment">###创建镜像查看locations项是否为cinder</span></span><br></pre></td></tr></table></figure>

<h3 id="将swift存储作为镜像服务的后端存储"><a href="#将swift存储作为镜像服务的后端存储" class="headerlink" title="将swift存储作为镜像服务的后端存储"></a>将swift存储作为镜像服务的后端存储</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/glance/glance-api.conf</span></span><br><span class="line">[glance_store]</span><br><span class="line">stores = glance.store.swift.Store</span><br><span class="line">default_store = swift</span><br><span class="line">swift_store_region = RegionOne</span><br><span class="line">swift_store_endpoint_type = internalURl</span><br><span class="line">swift_store_container = glance</span><br><span class="line">swift_store_large_object_size = 5120</span><br><span class="line">swift_store_large_object_chunk_size = 200</span><br><span class="line">swift_store_create_container_on_put = True</span><br><span class="line">swift_store_multi_tenant = True</span><br><span class="line">swift_store_admin_tenants = service</span><br><span class="line">swift_store_auth_address = http://controller:5000/v3.0/</span><br><span class="line">swift_store_user = glance</span><br><span class="line">swift_store_key = 000000</span><br></pre></td></tr></table></figure>

<h2 id="nova计算服务"><a href="#nova计算服务" class="headerlink" title="nova计算服务"></a>nova计算服务</h2><h3 id="使用nova命令创建一个名为t，id为5，内存为2048M，磁盘容量为10GB，vCPU数量为2的云主机类型。"><a href="#使用nova命令创建一个名为t，id为5，内存为2048M，磁盘容量为10GB，vCPU数量为2的云主机类型。" class="headerlink" title="使用nova命令创建一个名为t，id为5，内存为2048M，磁盘容量为10GB，vCPU数量为2的云主机类型。"></a>使用nova命令创建一个名为t，id为5，内存为2048M，磁盘容量为10GB，vCPU数量为2的云主机类型。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># nova flavor-create t 5 2048 10 2   </span></span><br><span class="line">                        or</span><br><span class="line">[root@controller ~]<span class="comment"># openstack flavor create --id 5 --ram 2048 --disk 10 --vcpus 2 t</span></span><br></pre></td></tr></table></figure>

<h3 id="修改-nova-相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不-到-IP-地址而报错失败的问题。"><a href="#修改-nova-相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不-到-IP-地址而报错失败的问题。" class="headerlink" title="修改 nova 相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不 到 IP 地址而报错失败的问题。"></a>修改 nova 相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不 到 IP 地址而报错失败的问题。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查找关键字</span></span><br><span class="line">[root@controller ~]<span class="comment"># cat /etc/nova/nova.conf |grep vif_plugging_is_fatal</span></span><br><span class="line">vif_plugging_is_fatal=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###重启</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart openstack-nova*</span></span><br></pre></td></tr></table></figure>

<h3 id="OpenStack-Nova-清除缓存"><a href="#OpenStack-Nova-清除缓存" class="headerlink" title="OpenStack Nova 清除缓存"></a>OpenStack Nova 清除缓存</h3><p>在 OpenStack 平台的一台计算节点创建虚拟机，若是第一次在该节点创建次虚拟机，会 先将镜像文件复制到该计算节点目录/var/lib/nova/instances/_base。长期下来，该目录会占用 比较大的磁盘空间而要清理。可以通过修改 nova 的配置文件来自动清理该缓存目录，即在 该节点没有使用某镜像启动的云主机，那么这个镜像在过一定的时间后会被自动删除。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###修改/etc/nova/nova.conf</span></span><br><span class="line"></span><br><span class="line">计算节点</span><br><span class="line"><span class="comment">###允许删除不再使用的、旧的image文件，以节省计算节点硬盘空间</span></span><br><span class="line">remove_unused_base_images = True </span><br><span class="line"></span><br><span class="line"><span class="comment">###如无instance使用，则原image文件在1天之后会被删除</span></span><br><span class="line">remove_unused_original_minimum_age_seconds = 86400 </span><br><span class="line"></span><br><span class="line"><span class="comment">###如无instance使用，resize过的image文件（cow格式）在1小时之后会被删除</span></span><br><span class="line">remove_unused_resized_minimum_age_seconds = 3600 </span><br><span class="line"></span><br><span class="line"><span class="comment">###镜像文件的存储路径，该目录是相对于state_path的路径名</span></span><br><span class="line">image_cache_subdirectory_name = _base </span><br><span class="line"></span><br><span class="line"><span class="comment">###重启nova服务</span></span><br></pre></td></tr></table></figure>

<h3 id="动态调整云主机类型"><a href="#动态调整云主机类型" class="headerlink" title="动态调整云主机类型"></a>动态调整云主机类型</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/nova/nova.conf</span></span><br><span class="line">allow_resize_to_same_hosts=True</span><br><span class="line">scheduler_default_filters=RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,</span><br><span class="line">ComputeCapabilitiesFilter,ImagePropertiesFilter,ServerGroupAntiAffinityFilter,</span><br><span class="line">ServerGroupAffinityFilter</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart openstack-nova-* libvirtd</span></span><br></pre></td></tr></table></figure>

<h3 id="云主机保存快照"><a href="#云主机保存快照" class="headerlink" title="云主机保存快照"></a>云主机保存快照</h3><p>给云主机做快照并保存在本机 /root/目录下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack server image create VM1 --name VM1-image-1</span><br><span class="line">openstack image save --file /root/VM1-image-1.qcow2 VM1-image-1</span><br></pre></td></tr></table></figure>

<p>在openstack私有云平台上，将云主机VM1保存为qcow2格式的快照并保存到controller节 点/root/cloudsave目录下，保存名字为csccvm.qcow2。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mkdir cloudsave</span></span><br><span class="line">[root@controller ~]<span class="comment"># nova image-create VM1 vm1</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack image list</span></span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 1cd8a7ee-26d3-4af9-a7d8-15d88cdfa1f5 | cirros | active |</span><br><span class="line">| d672affc-fefb-4af3-b185-96c009193045 | vm1    | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># openstack image save vm1 --file</span></span><br><span class="line">/root/cloudsave/csccvm.qcow2</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># ll cloudsave/</span></span><br><span class="line">total 21568</span><br><span class="line">-rw-r--r-- 1 root root 22085632 Aug 8 04:11 csccvm.qcow2</span><br></pre></td></tr></table></figure>

<h3 id="修改云主机内存"><a href="#修改云主机内存" class="headerlink" title="修改云主机内存"></a>修改云主机内存</h3><p>使用OpenStack私有云平台，找到virsh中ID为10的云主机（若不存在请自行创建）。在云主机所在的物 理节点，进入virsh交互式界面，使用virsh命令，将memory虚拟机的内存调整为5242880KB大小</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack server create --image cirros --flavor Fmin --network ext VM2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###计算节点操作</span></span><br><span class="line">[root@compute ~]<span class="comment"># virsh list --all</span></span><br><span class="line">[root@compute ~]<span class="comment"># virsh shutdown instance-00000002</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###编辑</span></span><br><span class="line">[root@compute ~]<span class="comment"># virsh edit instance-00000002</span></span><br><span class="line"></span><br><span class="line">[root@compute ~]<span class="comment"># virsh start instance-00000002</span></span><br></pre></td></tr></table></figure>

<h3 id="冷迁移"><a href="#冷迁移" class="headerlink" title="冷迁移"></a>冷迁移</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###拷贝虚拟机到新的计算节点</span></span><br><span class="line">[root@computer01 ~]<span class="comment"># scp -r e866c977-eb01-460e-bf12-5208d54600f5/  \</span></span><br><span class="line">&gt; 192.168.176.64:/var/lib/nova/instances/</span><br><span class="line"></span><br><span class="line"><span class="comment">###修改文件属性</span></span><br><span class="line">[root@computer02 ~]<span class="comment"># chown -R nova.nova e866c977-eb01-460e-bf12-5208d54600f5/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###更新数据库</span></span><br><span class="line">[root@node1 ~]<span class="comment"># use nova;</span></span><br><span class="line">update instances <span class="built_in">set</span> host=<span class="string">&#x27;controller&#x27;</span>, node=<span class="string">&#x27;controller&#x27;</span>, launched_on=<span class="string">&#x27;controller&#x27;</span> </span><br><span class="line"><span class="built_in">where</span> uuid=<span class="string">&#x27;c47aea85-6a9b-4d94-b1fd-aac2268c9913&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">###启动虚拟机</span></span><br></pre></td></tr></table></figure>

<h2 id="neutron网络服务"><a href="#neutron网络服务" class="headerlink" title="neutron网络服务"></a>neutron网络服务</h2><h3 id="创建外部网络ext-net和子网ext-subnet-创建内网int-net和子网int-subnet，创建路由router-1（并连通内外网）"><a href="#创建外部网络ext-net和子网ext-subnet-创建内网int-net和子网int-subnet，创建路由router-1（并连通内外网）" class="headerlink" title="创建外部网络ext-net和子网ext-subnet 创建内网int-net和子网int-subnet，创建路由router-1（并连通内外网）"></a>创建外部网络ext-net和子网ext-subnet 创建内网int-net和子网int-subnet，创建路由router-1（并连通内外网）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###创建外部网络</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack network create --external --enable ext-net</span></span><br><span class="line"><span class="comment">###创建子网</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack subnet create --network ext-net --subnet-range 192.168.x.0/24 \</span></span><br><span class="line">&gt; --allocation-pool start=192.168.x.100,end=192.168.x.200 --gateway 192.168.x.1 ext-subnet</span><br><span class="line"></span><br><span class="line"><span class="comment">###创建内部网络</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack network create --internal --enable int-net</span></span><br><span class="line"><span class="comment">###创建子网</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack subnet create --network int-net --subnet-range 10.10.x.0/24 \</span></span><br><span class="line">&gt; --allocation-pool start=10.10.x.100,end=10.10.x.200 --gateway 10.10.x.1 int-subnet</span><br><span class="line"></span><br><span class="line"><span class="comment">###创建路由</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack router create router-1</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack router add subnet router-1 ext-subnet</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack router add subnet router-1 int-subnet</span></span><br></pre></td></tr></table></figure>

<h3 id="安全组管理"><a href="#安全组管理" class="headerlink" title="安全组管理"></a>安全组管理</h3><p>创建名为“group_web”的安全组，该安全组描述为“Custom security group”，用openstack命令为安全组添加icmp规则和ssh规则允许任意IP地址访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###创建安全组</span></span><br><span class="line">openstack security group create --description <span class="string">&quot;Custom security group&quot;</span> group_web</span><br><span class="line"></span><br><span class="line"><span class="comment">###添加80访问</span></span><br><span class="line">openstack security group rule create --ingress --ethertype IPv4 --protocol tcp \</span><br><span class="line">&gt; --dst-port 80:80 group_web</span><br><span class="line"></span><br><span class="line"><span class="comment">###添加22访问</span></span><br><span class="line">openstack security group rule create --ingress --ethertype IPv4 --protocol tcp \</span><br><span class="line">&gt; --dst-port 22:22 group_web</span><br><span class="line"></span><br><span class="line"><span class="comment">###添加icmp规则</span></span><br><span class="line">openstack security group rule create --ingress --protocol icmp group_web</span><br></pre></td></tr></table></figure>

<h2 id="dashboard服务"><a href="#dashboard服务" class="headerlink" title="dashboard服务"></a>dashboard服务</h2><h3 id="修改nova配置文件使之能通过公网IP范文dashboard首页"><a href="#修改nova配置文件使之能通过公网IP范文dashboard首页" class="headerlink" title="修改nova配置文件使之能通过公网IP范文dashboard首页"></a>修改nova配置文件使之能通过公网IP范文dashboard首页</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/nova/nova.conf</span></span><br><span class="line"><span class="comment">###修改为master公网IP</span></span><br><span class="line">novncproxy_base_url=http://123.123.123.123:6080/vnc_auto.html  </span><br><span class="line"></span><br><span class="line"><span class="comment">###重启服务生效配置</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure>

<h3 id="将-Dashboard-中的-Django-数据修改为存储在文件中"><a href="#将-Dashboard-中的-Django-数据修改为存储在文件中" class="headerlink" title="将 Dashboard 中的 Django 数据修改为存储在文件中"></a>将 Dashboard 中的 Django 数据修改为存储在文件中</h3><p>（此种修改解决了 ALL-in-one 快照在其 他云平台 Dashboard 不能访问的问题）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># cat /etc/openstack-dashboard/local_settings |grep django</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line"><span class="comment">###默认存在cache里，改为file</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.file&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###重启服务生效配置</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure>

<h3 id="请使用-curl-指令获取-dashboard-首页信息"><a href="#请使用-curl-指令获取-dashboard-首页信息" class="headerlink" title="请使用 curl 指令获取 dashboard 首页信息"></a>请使用 curl 指令获取 dashboard 首页信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># curl -i http://192.168.44.10/dashboard</span></span><br></pre></td></tr></table></figure>

<h3 id="云平台安全策略提升"><a href="#云平台安全策略提升" class="headerlink" title="云平台安全策略提升"></a>云平台安全策略提升</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###下载所需软件</span></span><br><span class="line">[root@controller ~]<span class="comment"># yum install -y mod_wsgi mod_ssl</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/httpd/conf.d/ssl.conf</span></span><br><span class="line">SSLProtocol all -SSLv2 -SSLv3 删除-SSLv3 （75行）</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/openstack-dashboard/local_settings</span></span><br><span class="line">CSRF_COOKIE_SECURE = Ture (49行)</span><br><span class="line">SESSION_COOKIE_SECURE = Ture</span><br><span class="line">USE_SSL = Ture</span><br><span class="line">SESSION_COOKIE_HTTPONLY = Ture</span><br></pre></td></tr></table></figure>

<h2 id="swift服务"><a href="#swift服务" class="headerlink" title="swift服务"></a>swift服务</h2><h3 id="使用命令创建一个名叫-examcontainer-的容器，将-cirros-0-3-4-x86-64-disk-img-镜像上传到-examcontainer-容器中，并-设置分段存放，每一段大小为-10M。"><a href="#使用命令创建一个名叫-examcontainer-的容器，将-cirros-0-3-4-x86-64-disk-img-镜像上传到-examcontainer-容器中，并-设置分段存放，每一段大小为-10M。" class="headerlink" title="使用命令创建一个名叫 examcontainer 的容器，将 cirros-0.3.4-x86_64-disk.img 镜像上传到 examcontainer 容器中，并 设置分段存放，每一段大小为 10M。"></a>使用命令创建一个名叫 examcontainer 的容器，将 cirros-0.3.4-x86_64-disk.img 镜像上传到 examcontainer 容器中，并 设置分段存放，每一段大小为 10M。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack container create examcontainer</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack container list</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># swift post examcontainer</span></span><br><span class="line">[root@controller ~]<span class="comment"># swift list</span></span><br><span class="line"><span class="comment">###下载镜像</span></span><br><span class="line">[root@controller ~]<span class="comment"># curl -O http://10.18.4.46/cirros-0.3.4-x86_64-disk.img</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###swfit切片上传cirros</span></span><br><span class="line"><span class="comment">###-S 上载不大于&lt;size&gt;（字节）的段中的文件，然后创建一个“清单”文件，</span></span><br><span class="line">该文件将下载所有段，就像它是原始文件一样。</span><br><span class="line">[root@controller ~]<span class="comment"># swift upload examcontainer -S 10485760 cirros-0.3.4-x86_64-disk.img</span></span><br><span class="line">[root@controller ~]<span class="comment"># swift stat examcontainer</span></span><br></pre></td></tr></table></figure>

<h2 id="cinder服务"><a href="#cinder服务" class="headerlink" title="cinder服务"></a>cinder服务</h2><h3 id="请在计算节点，对块存储进行扩容操作，-即在计算节点再分出一个-5G-的分区，加入到-cinder-块存储的后端存储中去。"><a href="#请在计算节点，对块存储进行扩容操作，-即在计算节点再分出一个-5G-的分区，加入到-cinder-块存储的后端存储中去。" class="headerlink" title="请在计算节点，对块存储进行扩容操作， 即在计算节点再分出一个 5G 的分区，加入到 cinder 块存储的后端存储中去。"></a>请在计算节点，对块存储进行扩容操作， 即在计算节点再分出一个 5G 的分区，加入到 cinder 块存储的后端存储中去。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###创建物理卷</span></span><br><span class="line">[root@compute ~]<span class="comment"># pvcreate /dev/vdb4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###扩展cinder-volume卷组</span></span><br><span class="line">[root@compute ~]<span class="comment"># vgextend cinder-volumes /dev/vdb4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###验证</span></span><br><span class="line">[root@compute ~]<span class="comment"># vgdisplay</span></span><br></pre></td></tr></table></figure>

<h3 id="创建名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源，名字lvm-test，大小1G的云硬盘并查询该云硬盘的详细信息-并附加到云主机上"><a href="#创建名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源，名字lvm-test，大小1G的云硬盘并查询该云硬盘的详细信息-并附加到云主机上" class="headerlink" title="创建名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源，名字lvm_test，大小1G的云硬盘并查询该云硬盘的详细信息 并附加到云主机上"></a>创建名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源，名字lvm_test，大小1G的云硬盘并查询该云硬盘的详细信息 并附加到云主机上</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># cinder type-create lvm</span></span><br><span class="line">[root@controller ~]<span class="comment"># cinder type-key lvm set volume_backend_name=LVM</span></span><br><span class="line">[root@controller ~]<span class="comment"># cinder create --volume-type lvm --name lvm_test 1</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack server add volume server-1 lvm_test</span></span><br></pre></td></tr></table></figure>

<h2 id="Manila-服务"><a href="#Manila-服务" class="headerlink" title="Manila 服务"></a>Manila 服务</h2><h3 id="创建-default-share-type-共享类型（不使用驱动程序支持），接着创建一个大小为-2G-的共享存储名为-share01-并开放-share01-目录对-OpenStack-管理网段使用权限。"><a href="#创建-default-share-type-共享类型（不使用驱动程序支持），接着创建一个大小为-2G-的共享存储名为-share01-并开放-share01-目录对-OpenStack-管理网段使用权限。" class="headerlink" title="创建 default_share_type 共享类型（不使用驱动程序支持），接着创建一个大小为 2G 的共享存储名为 share01 并开放 share01 目录对 OpenStack 管理网段使用权限。"></a>创建 default_share_type 共享类型（不使用驱动程序支持），接着创建一个大小为 2G 的共享存储名为 share01 并开放 share01 目录对 OpenStack 管理网段使用权限。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###创建不适用驱动程序支持的default_share_type共享类型</span></span><br><span class="line">[root@controller ~]<span class="comment"># manila type-create default_share_type False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###创建共享卷</span></span><br><span class="line">[root@controller ~]<span class="comment"># manila create NFS 2 --name share01</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###开放share01目录对OpenStack管理网段使用权限</span></span><br><span class="line">[root@controller ~]<span class="comment"># manila access-allow share01 ip 10.18.4.0/24 --access-level rw</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###验证</span></span><br><span class="line">[root@controller ~]<span class="comment"># manila type-list</span></span><br><span class="line">[root@controller ~]<span class="comment"># manila list</span></span><br></pre></td></tr></table></figure>

<h2 id="Barbican-服务"><a href="#Barbican-服务" class="headerlink" title="Barbican 服务"></a>Barbican 服务</h2><h3 id="使用-openstack-命令创建一个名为-secret01-的密钥"><a href="#使用-openstack-命令创建一个名为-secret01-的密钥" class="headerlink" title="使用 openstack 命令创建一个名为 secret01 的密钥"></a>使用 openstack 命令创建一个名为 secret01 的密钥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###创建密钥</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack secret store --name secret01 --payload secretkey</span></span><br></pre></td></tr></table></figure>

<h2 id="Cloudkitty-服务"><a href="#Cloudkitty-服务" class="headerlink" title="Cloudkitty 服务"></a>Cloudkitty 服务</h2><h3 id="启用-hashmap-评级-模块，接着创建-volume-thresholds-组，创建服务匹配规则-volume-size，并设置每-GB-的价-格为-0-01。接下来对应大量数据设置应用折扣，在组-volume-thresholds-中创建阈值，设置-若超过-50GB-的阈值，应用-2-的折扣（0-98）。"><a href="#启用-hashmap-评级-模块，接着创建-volume-thresholds-组，创建服务匹配规则-volume-size，并设置每-GB-的价-格为-0-01。接下来对应大量数据设置应用折扣，在组-volume-thresholds-中创建阈值，设置-若超过-50GB-的阈值，应用-2-的折扣（0-98）。" class="headerlink" title="启用 hashmap 评级 模块，接着创建 volume_thresholds 组，创建服务匹配规则 volume.size，并设置每 GB 的价 格为 0.01。接下来对应大量数据设置应用折扣，在组 volume_thresholds 中创建阈值，设置 若超过 50GB 的阈值，应用 2%的折扣（0.98）。"></a>启用 hashmap 评级 模块，接着创建 volume_thresholds 组，创建服务匹配规则 volume.size，并设置每 GB 的价 格为 0.01。接下来对应大量数据设置应用折扣，在组 volume_thresholds 中创建阈值，设置 若超过 50GB 的阈值，应用 2%的折扣（0.98）。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###启用hashmap</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack rating module enable hashmap </span></span><br><span class="line"></span><br><span class="line"><span class="comment">###创建hashmap service</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack rating hashmap service create volume.size </span></span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">| Name        | Service ID                           |</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">| volume.size | 09da4a8b-b849-4715-a8e3-7cd12dfcf46e |</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">###创建hashmap service group</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack rating hashmap group create volume_thresholds </span></span><br><span class="line">openstack rating hashmap group create volume_thresholds </span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Name              | Group ID                             |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| volume_thresholds | 8b3dfe73-5efb-46ab-a93b-dc9519063ed6 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">###创建volume单价</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack rating hashmap mapping create \</span></span><br><span class="line">&gt; -s 09da4a8b-b849-4715-a8e3-7cd12dfcf46e -g 8b3dfe73-5efb-46ab-a93b-dc9519063ed6 \</span><br><span class="line">&gt; -t flat 0.01 </span><br><span class="line"></span><br><span class="line"><span class="comment">###创建service rule</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack rating hashmap threshold create \</span></span><br><span class="line">&gt; -s 09da4a8b-b849-4715-a8e3-7cd12dfcf46e -g 8b3dfe73-5efb-46ab-a93b-dc9519063ed6 \</span><br><span class="line">&gt; -t rate 50 0.98</span><br></pre></td></tr></table></figure>

<h2 id="OpenStack-平台内存优化"><a href="#OpenStack-平台内存优化" class="headerlink" title="OpenStack 平台内存优化"></a>OpenStack 平台内存优化</h2><h3 id="搭建完-OpenStack-平台后，关闭系统的内存共享，打开透明大页。"><a href="#搭建完-OpenStack-平台后，关闭系统的内存共享，打开透明大页。" class="headerlink" title="搭建完 OpenStack 平台后，关闭系统的内存共享，打开透明大页。"></a>搭建完 OpenStack 平台后，关闭系统的内存共享，打开透明大页。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###关闭系统的内存共享</span></span><br><span class="line">[root@controller ~]<span class="comment"># echo &#x27;never&#x27; &gt; /sys/kernel/mm/transparent_hugepage/defrag</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###验证</span></span><br><span class="line">[root@controller ~]<span class="comment"># cat /sys/kernel/mm/transparent_hugepage/defrag</span></span><br><span class="line">always madvise [never]</span><br></pre></td></tr></table></figure>

<h3 id="OpenStack-消息队列调优"><a href="#OpenStack-消息队列调优" class="headerlink" title="OpenStack 消息队列调优"></a>OpenStack 消息队列调优</h3><p>OpenStack 各服务内部通信都是通过 RPC 来交互，各 agent 都需要去连接 RabbitMQ； 随着各服务 agent 增多，MQ 的连接数会随之增多，最终可能会到达上限，成为瓶颈。使用 自行搭建的OpenStack私有云平台，分别通过用户级别、系统级别、配置文件来设置RabbitMQ 服务的最大连接数为 10240。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 1)用户级别的配置</span></span><br><span class="line"><span class="comment">###limits.conf 用于对用户资源进行限制，如进程数/文件数等等</span></span><br><span class="line">[root@controller ~]<span class="comment"># vim /etc/security/limits.conf </span></span><br><span class="line">* soft nofile 10240</span><br><span class="line">* hard nofile 10240</span><br><span class="line"></span><br><span class="line"><span class="comment">###退出登陆以下 才可以生效</span></span><br><span class="line">[root@controller ~]<span class="comment"># logout</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###检验是否生效</span></span><br><span class="line">[root@controller ~]<span class="comment"># ulimit -n #检验配置是否生效</span></span><br><span class="line">10240</span><br><span class="line"></span><br><span class="line"><span class="comment">### 2)系统级别的配置</span></span><br><span class="line"><span class="comment">###系统级别主要配置 sysctl.conf 这个文件</span></span><br><span class="line">[root@controller ~]<span class="comment"># vi /etc/sysctl.conf</span></span><br><span class="line">fs.file-max=10240</span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># sysctl -p #执行这个生效</span></span><br><span class="line">fs.file-max = 10240</span><br><span class="line"></span><br><span class="line"><span class="comment">###配置RabbitMQ的配置文件</span></span><br><span class="line">[root@controller ~]<span class="comment"># vim /usr/lib/systemd/system/rabbitmq-server.service</span></span><br><span class="line"><span class="comment">###在service模块下添加即可</span></span><br><span class="line">LimitNOFILE=10240</span><br><span class="line"></span><br><span class="line"><span class="comment">###重启服务生效</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart rabbitmq-server </span></span><br><span class="line"></span><br><span class="line"><span class="comment">###检验命令</span></span><br><span class="line">[root@controller ~]<span class="comment"># rabbitmqctl status</span></span><br><span class="line">[&#123;total_limit,10140&#125;, <span class="comment">###返回这个表示成功了</span></span><br><span class="line">    &#123;total_used,9&#125;,</span><br><span class="line">    &#123;sockets_limit,9124&#125;,</span><br><span class="line">    &#123;sockets_used,7&#125;]&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="kvm调优"><a href="#kvm调优" class="headerlink" title="kvm调优"></a>kvm调优</h3><p>在自行搭建的 OpenStack 私有云平台或赛项提供的 all-in-one 平台上，修改相关配置文 件，启用-device virtio-net-pci in kvm</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># vim /etc/nova/nova.conf</span></span><br><span class="line">[libvirt]</span><br><span class="line">use_virtio_for_bridges=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl restart openstack-nova*</span></span><br></pre></td></tr></table></figure>

<h3 id="常见优化配置"><a href="#常见优化配置" class="headerlink" title="常见优化配置"></a>常见优化配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">resume_guests_state_on_host_boot = <span class="literal">true</span></span><br><span class="line">在 nova-compute 进程启动时，启动应该处于运行状态的虚拟机，应该处于运行状态的</span><br><span class="line">意思是 nova 数据库中的虚拟机记录是运行状态，但在 Hypervisor 上该虚拟机没有运行，</span><br><span class="line">在计算节点重启时，该配置项具有很大的用处，它可以让节点上所有虚拟机都自动运行起来，</span><br><span class="line">节省运维人员手工处理的时间。</span><br><span class="line"></span><br><span class="line">api_rate_limit = <span class="literal">false</span></span><br><span class="line">不限制 API 访问频率，打开之后 API 的并发访问数量会受到限制，</span><br><span class="line">可以根据云平台的访问量及 API 进程的数量和承受能力来判断是否需要打开，</span><br><span class="line">如果关闭该选项，则大并发情况下 API 请求处理时间会比较久。</span><br><span class="line"></span><br><span class="line">osapi_max_limit = 5000</span><br><span class="line">nova-api-os-compute api 的最大返回数据长度限制，如果设置过短，会导致部分响应数据被截断。</span><br><span class="line"></span><br><span class="line">running_deleted_instance_action = reap</span><br><span class="line">nova-compute 定时任务发现在数据库中已经删除，</span><br><span class="line">但计算节点的 Hypervisor 中还存在的虚拟机（也即野虚拟机审计操作方式）后的处理动作，</span><br><span class="line">建议是选择 <span class="built_in">log</span> 或者 reap。<span class="built_in">log</span> 方式需要运维人员根据日志记录找到那些野虚拟机并手工执行后续的动作，</span><br><span class="line">这种方式比较保险，防止由于 nova 服务出现未知异常或者 bug 时导致用户虚拟机被清理掉等问题，</span><br><span class="line">而 reap 方式则可以节省运维人员的人工介入时间。</span><br><span class="line"></span><br><span class="line">until_refresh = 5</span><br><span class="line">用户配额与 instances 表中实际使用量的同步阈值，</span><br><span class="line">也即用户的配额被修改多少次后强制同步一次使用量到配额量记录</span><br><span class="line"></span><br><span class="line">max_age = 86400</span><br><span class="line">用户配额与实际使用量的同步时间间隔，也即距上次配额记录更新多少秒后，</span><br><span class="line">再次更新时会自动与实际使用量同步。</span><br></pre></td></tr></table></figure>

<h3 id="计算节点资源预留"><a href="#计算节点资源预留" class="headerlink" title="计算节点资源预留"></a>计算节点资源预留</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">vcpu_pin_set = 4-$</span><br><span class="line">虚拟机 vCPU 的绑定范围，可以防止虚拟机争抢宿主机进程的 CPU 资源，</span><br><span class="line">建议值是预留前几个物理 CPU，把后面的所有 CPU 分配给虚拟机使用，</span><br><span class="line">可以配合 cgroup 或者内核启动参数来实现宿主机进程不占用虚拟机使用的那些 CPU 资源。</span><br><span class="line"></span><br><span class="line">cpu_allocation_ratio = 4.0</span><br><span class="line">物理 CPU 超售比例，默认是 16 倍，超线程也算作一个物理 CPU，</span><br><span class="line">需要根据具体负载和物理 CPU 能力进行综合判断后确定具体的配置。</span><br><span class="line"></span><br><span class="line">ram_allocation_ratio = 1.0</span><br><span class="line">内存分配超售比例，默认是 1.5 倍，生产环境不建议开启超售。</span><br><span class="line"></span><br><span class="line">reserved_host_memory_mb = 4096</span><br><span class="line">内存预留量，这部分内存不能被虚拟机使用</span><br><span class="line"></span><br><span class="line">reserved_host_disk_mb = 10240</span><br><span class="line">磁盘预留空间，这部分空间不能被虚拟机使用</span><br><span class="line"></span><br><span class="line">service_down_time = 120</span><br><span class="line">服务下线时间阈值，如果一个节点上的 nova 服务超过这个时间没有上报心跳到数据库，</span><br><span class="line">api 服务会认为该服务已经下线，如果配置过短或过长，都会导致误判。</span><br><span class="line"></span><br><span class="line">report_interval=120</span><br><span class="line">定义了心跳的周期，即多长时间上报一次自己的心跳。</span><br><span class="line"></span><br><span class="line">rpc_response_timeout = 300</span><br><span class="line">RPC 调用超时时间，由于 Python 的单进程不能真正的并发，</span><br><span class="line">所以 RPC 请求可能不能及时响应，尤其是目标节点在执行耗时较长的定时任务时，</span><br><span class="line">所以需要综合考虑超时时间和等待容忍时间。</span><br><span class="line"></span><br><span class="line">multi_host = True</span><br><span class="line">是否开启 nova-network 的多节点模式，如果需要多节点部署，则该项需要设置为 True。</span><br></pre></td></tr></table></figure>

<h2 id="OpenStack-Heat-运维"><a href="#OpenStack-Heat-运维" class="headerlink" title="OpenStack Heat 运维"></a>OpenStack Heat 运维</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###列出heat版本</span></span><br><span class="line">[root@controller bin]<span class="comment"># openstack orchestration template version list</span></span><br><span class="line">heat_template_version.2018-03-02 | hot | </span><br><span class="line">heat_template_version.queens</span><br><span class="line"></span><br><span class="line"><span class="comment">###列出资源类型</span></span><br><span class="line">[root@controller bin]<span class="comment"># openstack orchestration resource type list</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###资源详细属性格式</span></span><br><span class="line">[root@controller bin]<span class="comment"># openstack orchestration resource type \</span></span><br><span class="line">&gt; show OS::Nova::Flavor | grep -vE <span class="string">&quot;^   &quot;</span>  <span class="comment">###四个空格</span></span><br></pre></td></tr></table></figure>

<h3 id="创建container（容器）"><a href="#创建container（容器）" class="headerlink" title="创建container（容器）"></a>创建container（容器）</h3><p>在自行搭建的 OpenStack 私 有 云 平 台 上 ， 在 /root 目录下编写 Heat 模 板 create_container.yaml，要求执行 yaml 文件可以创建名为 heat-swift 的容器。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># cat create_container.yaml </span></span><br><span class="line">heat_template_version: 2014-10-16</span><br><span class="line">resources:</span><br><span class="line">  container:</span><br><span class="line">    <span class="built_in">type</span>: OS::Swift::Container</span><br><span class="line">    properties:</span><br><span class="line">      name: heat-swift</span><br></pre></td></tr></table></figure>

<h3 id="创建flavor（云主机类型）"><a href="#创建flavor（云主机类型）" class="headerlink" title="创建flavor（云主机类型）"></a>创建flavor（云主机类型）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">heat_template_version: 2014-10-16</span><br><span class="line">description: create flavor</span><br><span class="line">resources:</span><br><span class="line">  flavor:</span><br><span class="line">    <span class="built_in">type</span>: OS::Nova::Flavor</span><br><span class="line">    properties:</span><br><span class="line">      name: m1.flavor</span><br><span class="line">      flavorid: 1234</span><br><span class="line">      ram: 1024</span><br><span class="line">      disk: 20</span><br><span class="line">      vcpus: 1</span><br></pre></td></tr></table></figure>

<h3 id="创建net（网络）"><a href="#创建net（网络）" class="headerlink" title="创建net（网络）"></a>创建net（网络）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">heat_template_version: 2014-10-16</span><br><span class="line">description: Generated template</span><br><span class="line">resources:</span><br><span class="line">  network_1:</span><br><span class="line">    <span class="built_in">type</span>: OS::Neutron::Net</span><br><span class="line">    properties:</span><br><span class="line">      admin_state_up: <span class="literal">true</span>          </span><br><span class="line">      name: Heat-Network    </span><br><span class="line">      shared: <span class="literal">false</span>                 </span><br><span class="line">  subnet_1:</span><br><span class="line">    <span class="built_in">type</span>: OS::Neutron::Subnet</span><br><span class="line">    properties:</span><br><span class="line">      allocation_pools:             </span><br><span class="line">      - end: 10.20.2.100</span><br><span class="line">        start: 10.20.2.10</span><br><span class="line">      cidr: 10.20.2.0/24</span><br><span class="line">      gateway_ip: 10.20.2.2         </span><br><span class="line">      enable_dhcp: <span class="literal">true</span>             </span><br><span class="line">      host_routes: []               </span><br><span class="line">      ip_version: 4                    </span><br><span class="line">      name: Heat-Subnet</span><br><span class="line">      network:              <span class="comment">#若是已有network不需要这一行只要在network：后跟network名</span></span><br><span class="line">        get_resource: network_1 <span class="comment">#这不是network名，而是上面创建的network类型名(type上面)</span></span><br></pre></td></tr></table></figure>

<h3 id="创建user（用户）"><a href="#创建user（用户）" class="headerlink" title="创建user（用户）"></a>创建user（用户）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">heat_template_version: 2014-10-16</span><br><span class="line">description: create user</span><br><span class="line">resources:</span><br><span class="line">  <span class="built_in">users</span>:</span><br><span class="line">    <span class="built_in">type</span>: OS::Keystone::User</span><br><span class="line">    properties:</span><br><span class="line">      name: heat-user</span><br><span class="line">      default_project: admin</span><br><span class="line">      domain: demo</span><br><span class="line">      password: 123456</span><br><span class="line">      roles: [&#123;<span class="string">&quot;role&quot;</span>:admin,<span class="string">&quot;project&quot;</span>:admin&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="创建image（镜像）"><a href="#创建image（镜像）" class="headerlink" title="创建image（镜像）"></a>创建image（镜像）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">heat_template_version: queens</span><br><span class="line">description: create image</span><br><span class="line">resources:</span><br><span class="line">  images:</span><br><span class="line">    <span class="built_in">type</span>: OS::Glance::Image</span><br><span class="line">    properties:</span><br><span class="line">      name: <span class="built_in">test</span></span><br><span class="line">      min_disk: 20 <span class="comment">#题目应该会有要求</span></span><br><span class="line">      min_ram: 2048</span><br><span class="line">      disk_format: qcow2</span><br><span class="line">      container_format: bare</span><br><span class="line">      location: http://192.168.100.10/cirros-0.5.1-x86_64-disk.img <span class="comment">#题目应该会给出一个url链接</span></span><br></pre></td></tr></table></figure>

<h3 id="创建server（云主机）"><a href="#创建server（云主机）" class="headerlink" title="创建server（云主机）"></a>创建server（云主机）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">heat_template_version: queens</span><br><span class="line">description: create server</span><br><span class="line">resources:</span><br><span class="line">  servers:</span><br><span class="line">    <span class="built_in">type</span>: OS::Nova::Server</span><br><span class="line">    properties:</span><br><span class="line">      name: vm1</span><br><span class="line">      image: cirros</span><br><span class="line">      flavor: <span class="built_in">test</span></span><br><span class="line">      networks: [&#123;<span class="string">&quot;uuid&quot;</span>:d546239c-53f1-4a6f-a116-872727a04d86&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="创建cinder（卷）"><a href="#创建cinder（卷）" class="headerlink" title="创建cinder（卷）"></a>创建cinder（卷）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">heat_template_version: queens</span><br><span class="line">description: create cinder</span><br><span class="line">resources:</span><br><span class="line">  cinder:</span><br><span class="line">    <span class="built_in">type</span>: OS::Cinder::Volume</span><br><span class="line">    properties:</span><br><span class="line">      name: cinder1</span><br><span class="line">      volume_type: lvm</span><br><span class="line">      size: 10</span><br></pre></td></tr></table></figure>

<h2 id="python程序对接openstack-api"><a href="#python程序对接openstack-api" class="headerlink" title="python程序对接openstack api"></a>python程序对接openstack api</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack image create  *** --debug <span class="comment">###调用整个创建过程</span></span><br><span class="line">再找到POST 和data行找到地址和创建内容</span><br><span class="line"></span><br><span class="line">[label]难写死了，建议用python软件写好，再复制进去，且这部分题指示冰山一角[/label]</span><br></pre></td></tr></table></figure>

<h3 id="安装python3"><a href="#安装python3" class="headerlink" title="安装python3"></a>安装python3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、yum install -y python3</span><br><span class="line">2、pip3 install certifi-2019.11.28-py2.py3-none-any.whl </span><br><span class="line">3、pip3 install urllib3-1.25.11-py3-none-any.whl </span><br><span class="line">4、pip3 install idna-2.8-py2.py3-none-any.whl </span><br><span class="line">5、pip3 install chardet-3.0.4-py2.py3-none-any.whl</span><br><span class="line">6、pip3 install requests-2.24.0-py2.py3-none-any.whl</span><br></pre></td></tr></table></figure>

<h3 id="创建flavor（云主机类型）-1"><a href="#创建flavor（云主机类型）-1" class="headerlink" title="创建flavor（云主机类型）"></a>创建flavor（云主机类型）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">osurl=<span class="string">&quot;http://192.168.1.10&quot;</span></span><br><span class="line">body=&#123;</span><br><span class="line">    <span class="string">&quot;auth&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;identity&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;methods&quot;</span>:[<span class="string">&quot;password&quot;</span>],</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;user&quot;</span>:&#123;</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;e1555f4c3aa340718241ccf6d985f464&quot;</span>,   <span class="comment">#admin用户id</span></span><br><span class="line">                    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;000000&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;scope&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;project&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="string">&quot;42db81677aea4462b41e5a4ab1aa09fd&quot;</span>    <span class="comment">#admin项目id</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">headers=&#123;&#125;</span><br><span class="line">def get_token():</span><br><span class="line">    url=osurl+<span class="string">&quot;:5000/v3/auth/tokens&quot;</span></span><br><span class="line">    re=requests.post(url,json=body,headers=headers).headers[<span class="string">&quot;X-Subject-Token&quot;</span>]</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">def create_flavor():</span><br><span class="line">    url=osurl+<span class="string">&quot;:8774/v2.1/flavors&quot;</span></span><br><span class="line">    headers[<span class="string">&quot;X-Auth_Token&quot;</span>]=get_token()</span><br><span class="line">    body=&#123;</span><br><span class="line">        <span class="string">&quot;flavor&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;python&quot;</span>,</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: 1234,</span><br><span class="line">            <span class="string">&quot;disk&quot;</span>: 10,</span><br><span class="line">            <span class="string">&quot;ram&quot;</span>: 2048,</span><br><span class="line">            <span class="string">&quot;vcpus&quot;</span>: 2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    re=requests.post(url,headers=headers,json=body).json()</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">create_flavor()</span><br></pre></td></tr></table></figure>

<h3 id="创建server（云主机）-1"><a href="#创建server（云主机）-1" class="headerlink" title="创建server（云主机）"></a>创建server（云主机）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">osurl = <span class="string">&quot;http://192.168.100.10&quot;</span></span><br><span class="line">body=&#123;</span><br><span class="line">    <span class="string">&quot;auth&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;identity&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;methods&quot;</span>:[<span class="string">&quot;password&quot;</span>],</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;user&quot;</span>:&#123;</span><br><span class="line">                   <span class="string">&quot;id&quot;</span>:<span class="string">&quot;d618c8ee2d234997889b62ee18562ee0&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;password&quot;</span>:<span class="string">&quot;000000&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;scope&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;project&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>:<span class="string">&quot;5e7709cbbd7c4c0e8733c3f7360d1d38&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;&#125;</span><br><span class="line">def get_token():</span><br><span class="line">    url = osurl+<span class="string">&quot;:5000/v3/auth/tokens&quot;</span></span><br><span class="line">    re = requests.post(url,headers=headers,json=body).headers[<span class="string">&quot;X-Subject-Token&quot;</span>]</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">def server_create():</span><br><span class="line">    url = osurl+<span class="string">&quot;:8774/v2.1/servers&quot;</span></span><br><span class="line">    headers[<span class="string">&quot;X-Auth-Token&quot;</span>] = get_token()</span><br><span class="line">    body=&#123;</span><br><span class="line">        <span class="string">&quot;server&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;psysewe&quot;</span>,</span><br><span class="line">            <span class="string">&quot;imageRef&quot;</span>: <span class="string">&quot;sdi3jnbf-nce8sm3slfk-cm8w3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;flavorRef&quot;</span>: <span class="string">&quot;sduifwj8-dnuvwi8-dnde83&quot;</span>,</span><br><span class="line">            <span class="string">&quot;networks&quot;</span>: [&#123;<span class="string">&quot;uuid&quot;</span>: <span class="string">&quot;bssiksju-sjejr3-sqksjj&quot;</span>&#125;],</span><br><span class="line">            <span class="string">&quot;security_groups&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;215a9641-784f-47b6-bcf4-ddd3c0d84494&quot;</span>&#125;]  <span class="comment">#只能是name,不能是uuid</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,headers=headers,json=body).json()</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">server_create()</span><br></pre></td></tr></table></figure>

<h3 id="创建user（用户）-1"><a href="#创建user（用户）-1" class="headerlink" title="创建user（用户）"></a>创建user（用户）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def create_user():</span><br><span class="line">    url = osurl+<span class="string">&quot;:35357/v3/users&quot;</span></span><br><span class="line">    headers[<span class="string">&quot;X-Auth-Token&quot;</span>] = get_tokens()</span><br><span class="line">    body=&#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;centos7&quot;</span>,</span><br><span class="line">            <span class="string">&quot;domain_id&quot;</span>: <span class="string">&quot;c71306cc8e9b40c093e6961d18ff85c6&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">&quot;000000&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,headers=headers,json=body).json()</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">create_user()</span><br></pre></td></tr></table></figure>

<h3 id="创建project（项目）"><a href="#创建project（项目）" class="headerlink" title="创建project（项目）"></a>创建project（项目）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def create_project():</span><br><span class="line">    url = osurl+<span class="string">&quot;:35357/v3/projects&quot;</span></span><br><span class="line">    headers[<span class="string">&quot;X-Auth-Token&quot;</span>] = get_tokens()</span><br><span class="line">    body=&#123;</span><br><span class="line">        <span class="string">&quot;project&quot;</span>:&#123;</span><br><span class="line">              <span class="string">&quot;name&quot;</span>: <span class="string">&quot;centos7&quot;</span>,</span><br><span class="line">              <span class="string">&quot;domain_id&quot;</span>: <span class="string">&quot;c71306cc8e9b40c093e6961d18ff85c6&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,headers=headers,json=body).json()</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">create_project()</span><br></pre></td></tr></table></figure>

<h3 id="创建volume（卷）"><a href="#创建volume（卷）" class="headerlink" title="创建volume（卷）"></a>创建volume（卷）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建卷类型</span></span><br><span class="line">def create_volume_type():</span><br><span class="line">    url=osurl+<span class="string">&quot;:8776/v2/af517df811524026aa0f25750e5ee022/types&quot;</span></span><br><span class="line">    headers[<span class="string">&quot;X-Auth_Token&quot;</span>]=get_token()</span><br><span class="line">    body=&#123;</span><br><span class="line">        <span class="string">&quot;volume_type&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;lvm&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    re=requests.post(url,headers=headers,json=body).json()</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">create_volume_type()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建卷</span></span><br><span class="line">def flavor_create():</span><br><span class="line">    url = osurl+<span class="string">&quot;:8776/v2/af517df811524026aa0f25750e5ee022/volumes&quot;</span></span><br><span class="line">    headers[<span class="string">&quot;X-Auth-Token&quot;</span>] = get_token()</span><br><span class="line">    body=&#123;</span><br><span class="line">        <span class="string">&quot;volume&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;psysewe&quot;</span>,</span><br><span class="line">            <span class="string">&quot;size&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;lvm&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,headers=headers,json=body).json()</span><br><span class="line">    <span class="built_in">print</span>(re)</span><br><span class="line">    <span class="built_in">return</span> re</span><br><span class="line">flavor_create()</span><br></pre></td></tr></table></figure>

<h2 id="Redis-一主二从三哨兵模式"><a href="#Redis-一主二从三哨兵模式" class="headerlink" title="Redis 一主二从三哨兵模式"></a>Redis 一主二从三哨兵模式</h2><p>使用提供的 OpenStack 私有云平台，申请三台 CentOS7.9 系统的云主机，使用提供的 http 源，在三个节点自行安装 Redis 服务并启动，配置 Redis 的访问需要密码，密码设置为 123456。然后将这三个 Redis 节点配置为 Redis 的一主二从三哨兵架构，即一个 Redis 主节 点，两个从节点，三个节点均为哨兵节点。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###通过iaas源直接下载redis或通过编译安装make|make install</span></span><br><span class="line"></span><br><span class="line">主节点</span><br><span class="line"><span class="comment">###修改配置文件/etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1     <span class="comment">### 修改为 bing 0.0.0.0 或注释</span></span><br><span class="line">requirepass 123456 <span class="comment">### 添加 通过搜索password可得</span></span><br><span class="line">protected-mode no  <span class="comment">### 关闭保护模式(只有同一个服务器才能连接)</span></span><br><span class="line"></span><br><span class="line">从节点</span><br><span class="line"><span class="comment">###修改/etc/redis.conf加入集群 </span></span><br><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"><span class="comment">###指定master</span></span><br><span class="line">replicaof redis-1 6379 </span><br><span class="line">slaveof redis-1 6379</span><br><span class="line"><span class="comment">###master密码</span></span><br><span class="line">masterauth 123456</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line"><span class="comment">###重启redis服务</span></span><br><span class="line">通过yum安装： </span><br><span class="line">systemctl restart redis</span><br><span class="line"></span><br><span class="line">源码安装： </span><br><span class="line">/etc/init.d/redis_6379 stop </span><br><span class="line">/etc/init.d/redis_6379 start </span><br><span class="line"></span><br><span class="line"><span class="comment">###检测</span></span><br><span class="line">[root@redis-1 redis-7.0.5]<span class="comment"># redis-cli </span></span><br><span class="line">127.0.0.1:6379&gt; AUTH 123456 <span class="comment">###认证</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; info replication <span class="comment">###查看信息</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=192.168.1.20,port=6379,state=online,offset=294,lag=1</span><br><span class="line">slave1:ip=192.168.1.30,port=6379,state=online,offset=294,lag=1</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:40b9e01fc3ef428ab7ab182b69d93f01ccfdfb87</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:294</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:294</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">###开启哨兵模式</span></span><br><span class="line">yum: </span><br><span class="line">/etc/redis-sentinel.conf</span><br><span class="line">源码安装: </span><br><span class="line">在包里有模板文件sentinel.conf将其拷贝值/etc/下</span><br><span class="line">protected-mode no</span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">sentinel monitor mymaster 192.168.1.10 6379 2</span><br><span class="line">sentinel auth-pass mymaster 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">###在没有启动哨兵服务时，文件中没有myid可以复制给其他主机使用</span></span><br><span class="line">systemctl start redis-sentinel</span><br><span class="line">redis-sentinel /etc/sentinel.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看</span></span><br><span class="line">[root@redis-1 etc]<span class="comment"># redis-cli -p 26379</span></span><br><span class="line">127.0.0.1:26379&gt; info sentinel</span><br><span class="line"><span class="comment"># Sentinel</span></span><br><span class="line">sentinel_masters:1</span><br><span class="line">sentinel_tilt:0</span><br><span class="line">sentinel_tilt_since_seconds:-1</span><br><span class="line">sentinel_running_scripts:0</span><br><span class="line">sentinel_scripts_queue_length:0</span><br><span class="line">sentinel_simulate_failure_flags:0</span><br><span class="line">master0:name=mymaster,status=ok,address=192.168.1.10:6379,slaves=2,sentinels=3</span><br></pre></td></tr></table></figure>

<h2 id="Redis-服务调优-AOF"><a href="#Redis-服务调优-AOF" class="headerlink" title="Redis 服务调优-AOF"></a>Redis 服务调优-AOF</h2><p>使用上一题安装的 Redis 服务。在 Redis 中，AOF 配置为以三种不同的方式在磁盘上执 行 write 或者 fsync。假设当前 Redis 压力过大，请配置 Redis 不执行 fsync。除此之外，避免 AOF 文件过大，Redis 会进行 AOF 重写，生成缩小的 AOF 文件。请修改配置，让 AOF 重 写时，不进行 fsync 操作。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 持久化技术：redis是运行在内存上的服务，一旦断电或重启，内存上的数据就会被删除，为了防止数据丢失，</span></span><br><span class="line">redis提供了一种安全策略--持久化</span><br><span class="line"></span><br><span class="line"><span class="comment"># 持久化就是把redis产生的数据或操作进行快照保存到磁盘上</span></span><br><span class="line"></span><br><span class="line">分类：RDB 一段时间内全量保存数据 redis datebase</span><br><span class="line">      AOF 一段时间内增量保存数据 append only file </span><br><span class="line"></span><br><span class="line">修改/etc/redis.conf文件</span><br><span class="line">```</span><br><span class="line">[root@controller ~]<span class="comment"># vi /etc/redis.conf</span></span><br><span class="line">appendonly <span class="built_in">yes</span> <span class="comment">###改为yes 开启AOF</span></span><br><span class="line">appendfsync no <span class="comment">###将原来的everysec修改为no,表示不执行fsync</span></span><br><span class="line">no-appendfsync-on-rewrite <span class="built_in">yes</span> <span class="comment">###将原来的no改为yes,表示进行aof重写不执行fsync</span></span><br><span class="line">```</span><br></pre></td></tr></table></figure>

<h2 id="Raid管理"><a href="#Raid管理" class="headerlink" title="Raid管理"></a>Raid管理</h2><p>在OpenStack私有云平台，创建一台云主机，并创建一个40G大小的cinder块存储，将块存储连接到云主机，然后在云主机上对云硬盘进行操作。要求分出4个大小为5G的分区，使用这4个分区，创建名为/dev/md5、raid级别为5的磁盘阵列加一个热备盘（使用最后一个分区作为热备盘）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># yum install -y mdadm gdisk</span></span><br><span class="line">[root@node ~]<span class="comment"># lsblk</span></span><br><span class="line">gdisk /dev/sdb</span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition number (1-128, default 1):            <span class="comment">###默认，直接回车 </span></span><br><span class="line">First sector (34-2047, default = 34) or &#123;+-&#125;size&#123;KMGTP&#125;:      <span class="comment">###默认直接回车</span></span><br><span class="line">Last sector (34-2047, default = 2047) or &#123;+-&#125;size&#123;KMGTP&#125;: +10G <span class="comment">###&#123;单位KMGTP&#125;</span></span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300): fd00      <span class="comment">###不清楚L命令查看 raid代码 fd00</span></span><br><span class="line">wq 保存</span><br><span class="line"></span><br><span class="line">查看</span><br><span class="line">[root@node ~]<span class="comment"># lsblk</span></span><br><span class="line"></span><br><span class="line">[root@node ~]<span class="comment"># mdadm -C -v /dev/md5 -l 5 -n 4 /dev/sdb&#123;1,2,3,4&#125; -x 1 /dev/sdb5</span></span><br><span class="line">Continue creating array? y <span class="comment">###y确定</span></span><br><span class="line">/dev/md0 raid路径位置</span><br><span class="line">-v 显示创建过程</span><br><span class="line">-C 创建</span><br><span class="line">-c 块设备大小 默认64 一般64、256、512</span><br><span class="line">-l 指定raid类型</span><br><span class="line">-n &#123;指定raid个数&#125; &#123;具体盘符&#125;</span><br><span class="line">-x 备份盘个数(即热备盘)</span><br><span class="line">-a 通知mdadm是否创建设备文件 默认<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">lsblk 查看</span><br><span class="line">mdadm -D /dev/md5 查看raid详情</span><br><span class="line"><span class="built_in">cat</span> /proc/mdstat 系统磁盘阵列情况</span><br><span class="line"></span><br><span class="line">mdadm --stop dev/md5 停用raid</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">W</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/04/14/OpenStack/">http://example.com/2023/04/14/OpenStack/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">CLOUD</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OpenStack/">OpenStack</a></div><div class="post_share"><div class="social-share" data-image="/../jihu/wallpaper/used/openstack.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/13/tedu-MySQL/" title="MySQL"><img class="cover" src="/../jihu/wallpaper/used/mysql.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/15/tedu-kubernetes/" title="Kubernetes"><img class="cover" src="/../jihu/wallpaper/used/k8s.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Kubernetes</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/10/1-%E5%9F%BA%E7%A1%80%E8%AE%AD%E7%BB%83%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/" title="私有云：(1)基础训练环境构建"><img class="cover" src="/../jihu/wallpaper/used/openstack1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(1)基础训练环境构建</div></div></a></div><div><a href="/2023/08/10/10-Redis%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/" title="私有云：(10)Redis集群部署与优化案例"><img class="cover" src="/../jihu/wallpaper/used/openstack10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(10)Redis集群部署与优化案例</div></div></a></div><div><a href="/2023/08/10/11-Ansible%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(11)Ansible集群服务部署案例"><img class="cover" src="/../jihu/wallpaper/used/openstack11.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(11)Ansible集群服务部署案例</div></div></a></div><div><a href="/2023/08/10/12-Python%E8%B0%83%E7%94%A8OpenStack_API%E6%A1%88%E4%BE%8B/" title="私有云：(12)Python调用OpenStack_API案例"><img class="cover" src="/../jihu/wallpaper/used/openstack12.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(12)Python调用OpenStack_API案例</div></div></a></div><div><a href="/2023/08/10/13-%E7%A7%81%E6%9C%89%E4%BA%91Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/" title="私有云：(13)私有云Python运维开发案例"><img class="cover" src="/../jihu/wallpaper/used/openstack13.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(13)私有云Python运维开发案例</div></div></a></div><div><a href="/2023/08/10/2-OpenStack%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/" title="私有云：(2)OpenStack基础平台部署案例"><img class="cover" src="/../jihu/wallpaper/used/openstack2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">私有云：(2)OpenStack基础平台部署案例</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../jihu/wallpaper/used/user.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">W</div><div class="author-info__description">Cloud Computing</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">云计算三种模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#iaas%E4%BA%91"><span class="toc-number">1.1.</span> <span class="toc-text">iaas云</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#paas%E4%BA%91"><span class="toc-number">1.2.</span> <span class="toc-text">paas云</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#saas%E4%BA%91"><span class="toc-number">1.3.</span> <span class="toc-text">saas云</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#openstack%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">openstack概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%B7%E6%BA%90"><span class="toc-number">2.1.</span> <span class="toc-text">起源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Horizon%E7%BB%84%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">Horizon组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Keystone%E7%BB%84%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">Keystone组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nova%E7%BB%84%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">Nova组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Glance%E7%BB%84%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">Glance组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#swift%E7%BB%84%E4%BB%B6"><span class="toc-number">2.6.</span> <span class="toc-text">swift组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Neutron%E7%BB%84%E4%BB%B6"><span class="toc-number">2.7.</span> <span class="toc-text">Neutron组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cinder%E7%BB%84%E4%BB%B6"><span class="toc-number">2.8.</span> <span class="toc-text">Cinder组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%8F%8A%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">2.9.</span> <span class="toc-text">项目及用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.9.1.</span> <span class="toc-text">项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.9.2.</span> <span class="toc-text">默认项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7"><span class="toc-number">2.9.3.</span> <span class="toc-text">用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">2.9.4.</span> <span class="toc-text">用户权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Glance%E9%95%9C%E5%83%8F%E5%8D%B3%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.10.</span> <span class="toc-text">Glance镜像即云主机类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86"><span class="toc-number">2.10.1.</span> <span class="toc-text">镜像管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.10.2.</span> <span class="toc-text">镜像磁盘格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cow%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.10.3.</span> <span class="toc-text">cow介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.10.4.</span> <span class="toc-text">云主机类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Neutron%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86"><span class="toc-number">2.11.</span> <span class="toc-text">Neutron网络管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%BB%84"><span class="toc-number">2.12.</span> <span class="toc-text">安全组</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Oenstack%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">Oenstack搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">基础环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YUM%E6%BA%90%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">YUM源配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5"><span class="toc-number">3.3.</span> <span class="toc-text">时间同步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E5%88%86%E5%8C%BA"><span class="toc-number">3.4.</span> <span class="toc-text">计算节点分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#openstack%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.5.</span> <span class="toc-text">openstack环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%8Acontroller%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4"><span class="toc-number">3.6.</span> <span class="toc-text">把controller节点加入集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nova%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E5%90%8E%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.</span> <span class="toc-text">nova安装完成后需要修改配置文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Openstack%E8%BF%90%E7%BB%B4"><span class="toc-number">4.</span> <span class="toc-text">Openstack运维</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#openstack-%E5%91%BD%E4%BB%A4%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="toc-number">4.1.</span> <span class="toc-text">openstack 命令自动补全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux-%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98"><span class="toc-number">4.2.</span> <span class="toc-text">Linux 系统调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%84%8F%E6%95%B0%E6%8D%AE%E5%8F%AF%E7%94%A8%E5%86%85%E5%AD%98%E7%99%BE%E5%88%86%E6%AF%94%E4%B8%BA60%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA30"><span class="toc-number">4.2.1.</span> <span class="toc-text">修改脏数据可用内存百分比为60，默认为30</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E5%8F%A5%E6%9F%84%E6%95%B0"><span class="toc-number">4.2.2.</span> <span class="toc-text">修改文件句柄数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E6%AD%A2-SYN-%E6%94%BB%E5%87%BB"><span class="toc-number">4.2.3.</span> <span class="toc-text">防止 SYN 攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEcontroller%E8%8A%82%E7%82%B9%E7%A6%81%E6%AD%A2%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E5%8F%AF%E4%BB%A5Ping%E5%AE%83"><span class="toc-number">4.2.4.</span> <span class="toc-text">配置controller节点禁止其他节点可以Ping它</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E4%BC%98%E5%8C%96"><span class="toc-number">4.2.5.</span> <span class="toc-text">内核优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B0%83%E4%BC%98"><span class="toc-number">4.3.</span> <span class="toc-text">数据库调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86memcache%E7%BC%93%E5%AD%98%E4%BF%AE%E6%94%B9%E4%B8%BA128"><span class="toc-number">4.3.1.</span> <span class="toc-text">将memcache缓存修改为128</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-etc-my-cnf-%E6%96%87%E4%BB%B6%EF%BC%8C%E5%AE%8C%E6%88%90%E4%B8%8B%E5%88%97%E8%A6%81%E6%B1%82"><span class="toc-number">4.3.2.</span> <span class="toc-text">修改&#x2F;etc&#x2F;my.cnf 文件，完成下列要求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Keystone-%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.4.</span> <span class="toc-text">Keystone 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAtom%E7%94%A8%E6%88%B7-%E5%AF%86%E7%A0%81%E4%B8%BA000000-email%E4%B8%BA-97-100-x6d-x69-110-x40-49-x32-x33-x2e-99-x6f-x6d"><span class="toc-number">4.4.1.</span> <span class="toc-text">创建一个tom用户 密码为000000 email为admin@123.com</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E4%B8%80%E4%B8%AAtoken"><span class="toc-number">4.4.2.</span> <span class="toc-text">列出一个token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86"><span class="toc-number">4.4.3.</span> <span class="toc-text">项目管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">4.4.4.</span> <span class="toc-text">用户管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#glance%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.5.</span> <span class="toc-text">glance镜像服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%8F%90%E4%BE%9B-%E7%9A%84-cirros-0-3-4-x86-64-disk-img-%E9%95%9C%E5%83%8F%EF%BC%88%E8%AF%A5%E9%95%9C%E5%83%8F%E5%9C%A8-HTTP-%E6%9C%8D%E5%8A%A1%E4%B8%AD%EF%BC%8C%E5%8F%AF%E8%87%AA%E8%A1%8C%E4%B8%8B%E8%BD%BD%EF%BC%89%E4%B8%8A%E4%BC%A0%E8%87%B3%E5%B9%B3%E5%8F%B0%EF%BC%8C-%E5%91%BD%E5%90%8D%E4%B8%BA-cirros%EF%BC%8C%E5%B9%B6%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%B0%8F%E5%90%AF%E5%8A%A8%E9%9C%80%E8%A6%81%E7%9A%84%E7%A1%AC%E7%9B%98%E4%B8%BA-10G%EF%BC%8C%E6%9C%80%E5%B0%8F%E5%90%AF%E5%8A%A8%E9%9C%80%E8%A6%81%E7%9A%84%E5%86%85%E5%AD%98%E4%B8%BA-1G%E3%80%82"><span class="toc-number">4.5.1.</span> <span class="toc-text">将提供 的 cirros-0.3.4-x86_64-disk.img 镜像（该镜像在 HTTP 服务中，可自行下载）上传至平台， 命名为 cirros，并设置最小启动需要的硬盘为 10G，最小启动需要的内存为 1G。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenStack-%E5%BC%80%E6%94%BE%E9%95%9C%E5%83%8F%E6%9D%83%E9%99%90"><span class="toc-number">4.5.2.</span> <span class="toc-text">OpenStack 开放镜像权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86"><span class="toc-number">4.5.3.</span> <span class="toc-text">后端配置文件管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenStack-Glance-%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86"><span class="toc-number">4.5.4.</span> <span class="toc-text">OpenStack Glance 镜像管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9-glance-%E5%AD%98%E5%82%A8%E5%90%8E%E7%AB%AF"><span class="toc-number">4.5.5.</span> <span class="toc-text">改 glance 存储后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#glance%E5%AF%B9%E6%8E%A5cinder"><span class="toc-number">4.5.6.</span> <span class="toc-text">glance对接cinder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86swift%E5%AD%98%E5%82%A8%E4%BD%9C%E4%B8%BA%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%8E%E7%AB%AF%E5%AD%98%E5%82%A8"><span class="toc-number">4.5.7.</span> <span class="toc-text">将swift存储作为镜像服务的后端存储</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.6.</span> <span class="toc-text">nova计算服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8nova%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BAt%EF%BC%8Cid%E4%B8%BA5%EF%BC%8C%E5%86%85%E5%AD%98%E4%B8%BA2048M%EF%BC%8C%E7%A3%81%E7%9B%98%E5%AE%B9%E9%87%8F%E4%B8%BA10GB%EF%BC%8CvCPU%E6%95%B0%E9%87%8F%E4%B8%BA2%E7%9A%84%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B%E3%80%82"><span class="toc-number">4.6.1.</span> <span class="toc-text">使用nova命令创建一个名为t，id为5，内存为2048M，磁盘容量为10GB，vCPU数量为2的云主机类型。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-nova-%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E8%A7%A3%E5%86%B3%E5%9B%A0%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4%E8%BF%87%E9%95%BF%E8%80%8C%E5%AF%BC%E8%87%B4%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%90%AF%E5%8A%A8%E8%B6%85%E6%97%B6%E4%BB%8E%E8%80%8C%E8%8E%B7%E5%8F%96%E4%B8%8D-%E5%88%B0-IP-%E5%9C%B0%E5%9D%80%E8%80%8C%E6%8A%A5%E9%94%99%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82"><span class="toc-number">4.6.2.</span> <span class="toc-text">修改 nova 相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不 到 IP 地址而报错失败的问题。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenStack-Nova-%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98"><span class="toc-number">4.6.3.</span> <span class="toc-text">OpenStack Nova 清除缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.6.4.</span> <span class="toc-text">动态调整云主机类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%91%E4%B8%BB%E6%9C%BA%E4%BF%9D%E5%AD%98%E5%BF%AB%E7%85%A7"><span class="toc-number">4.6.5.</span> <span class="toc-text">云主机保存快照</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BA%91%E4%B8%BB%E6%9C%BA%E5%86%85%E5%AD%98"><span class="toc-number">4.6.6.</span> <span class="toc-text">修改云主机内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%B7%E8%BF%81%E7%A7%BB"><span class="toc-number">4.6.7.</span> <span class="toc-text">冷迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#neutron%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.7.</span> <span class="toc-text">neutron网络服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9Cext-net%E5%92%8C%E5%AD%90%E7%BD%91ext-subnet-%E5%88%9B%E5%BB%BA%E5%86%85%E7%BD%91int-net%E5%92%8C%E5%AD%90%E7%BD%91int-subnet%EF%BC%8C%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1router-1%EF%BC%88%E5%B9%B6%E8%BF%9E%E9%80%9A%E5%86%85%E5%A4%96%E7%BD%91%EF%BC%89"><span class="toc-number">4.7.1.</span> <span class="toc-text">创建外部网络ext-net和子网ext-subnet 创建内网int-net和子网int-subnet，创建路由router-1（并连通内外网）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%BB%84%E7%AE%A1%E7%90%86"><span class="toc-number">4.7.2.</span> <span class="toc-text">安全组管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dashboard%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.8.</span> <span class="toc-text">dashboard服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9nova%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%BF%E4%B9%8B%E8%83%BD%E9%80%9A%E8%BF%87%E5%85%AC%E7%BD%91IP%E8%8C%83%E6%96%87dashboard%E9%A6%96%E9%A1%B5"><span class="toc-number">4.8.1.</span> <span class="toc-text">修改nova配置文件使之能通过公网IP范文dashboard首页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-Dashboard-%E4%B8%AD%E7%9A%84-Django-%E6%95%B0%E6%8D%AE%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%AD%98%E5%82%A8%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%AD"><span class="toc-number">4.8.2.</span> <span class="toc-text">将 Dashboard 中的 Django 数据修改为存储在文件中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E4%BD%BF%E7%94%A8-curl-%E6%8C%87%E4%BB%A4%E8%8E%B7%E5%8F%96-dashboard-%E9%A6%96%E9%A1%B5%E4%BF%A1%E6%81%AF"><span class="toc-number">4.8.3.</span> <span class="toc-text">请使用 curl 指令获取 dashboard 首页信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%91%E5%B9%B3%E5%8F%B0%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E6%8F%90%E5%8D%87"><span class="toc-number">4.8.4.</span> <span class="toc-text">云平台安全策略提升</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#swift%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.9.</span> <span class="toc-text">swift服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E5%8F%AB-examcontainer-%E7%9A%84%E5%AE%B9%E5%99%A8%EF%BC%8C%E5%B0%86-cirros-0-3-4-x86-64-disk-img-%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E5%88%B0-examcontainer-%E5%AE%B9%E5%99%A8%E4%B8%AD%EF%BC%8C%E5%B9%B6-%E8%AE%BE%E7%BD%AE%E5%88%86%E6%AE%B5%E5%AD%98%E6%94%BE%EF%BC%8C%E6%AF%8F%E4%B8%80%E6%AE%B5%E5%A4%A7%E5%B0%8F%E4%B8%BA-10M%E3%80%82"><span class="toc-number">4.9.1.</span> <span class="toc-text">使用命令创建一个名叫 examcontainer 的容器，将 cirros-0.3.4-x86_64-disk.img 镜像上传到 examcontainer 容器中，并 设置分段存放，每一段大小为 10M。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cinder%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.10.</span> <span class="toc-text">cinder服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E5%9C%A8%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%EF%BC%8C%E5%AF%B9%E5%9D%97%E5%AD%98%E5%82%A8%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9%E6%93%8D%E4%BD%9C%EF%BC%8C-%E5%8D%B3%E5%9C%A8%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E5%86%8D%E5%88%86%E5%87%BA%E4%B8%80%E4%B8%AA-5G-%E7%9A%84%E5%88%86%E5%8C%BA%EF%BC%8C%E5%8A%A0%E5%85%A5%E5%88%B0-cinder-%E5%9D%97%E5%AD%98%E5%82%A8%E7%9A%84%E5%90%8E%E7%AB%AF%E5%AD%98%E5%82%A8%E4%B8%AD%E5%8E%BB%E3%80%82"><span class="toc-number">4.10.1.</span> <span class="toc-text">请在计算节点，对块存储进行扩容操作， 即在计算节点再分出一个 5G 的分区，加入到 cinder 块存储的后端存储中去。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%90%8D%E4%B8%BAlvm%E7%9A%84%E5%8D%B7%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%88%9B%E5%BB%BA%E8%AF%A5%E7%B1%BB%E5%9E%8B%E8%A7%84%E6%A0%BC%E9%94%AE%E5%80%BC%E5%AF%B9%EF%BC%8C%E8%A6%81%E6%B1%82lvm%E5%8D%B7%E7%B1%BB%E5%9E%8B%E5%AF%B9%E5%BA%94cinder%E5%90%8E%E7%AB%AF%E9%A9%B1%E5%8A%A8lvm%E6%89%80%E7%AE%A1%E7%90%86%E7%9A%84%E5%AD%98%E5%82%A8%E8%B5%84%E6%BA%90%EF%BC%8C%E5%90%8D%E5%AD%97lvm-test%EF%BC%8C%E5%A4%A7%E5%B0%8F1G%E7%9A%84%E4%BA%91%E7%A1%AC%E7%9B%98%E5%B9%B6%E6%9F%A5%E8%AF%A2%E8%AF%A5%E4%BA%91%E7%A1%AC%E7%9B%98%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF-%E5%B9%B6%E9%99%84%E5%8A%A0%E5%88%B0%E4%BA%91%E4%B8%BB%E6%9C%BA%E4%B8%8A"><span class="toc-number">4.10.2.</span> <span class="toc-text">创建名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源，名字lvm_test，大小1G的云硬盘并查询该云硬盘的详细信息 并附加到云主机上</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Manila-%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.11.</span> <span class="toc-text">Manila 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-default-share-type-%E5%85%B1%E4%BA%AB%E7%B1%BB%E5%9E%8B%EF%BC%88%E4%B8%8D%E4%BD%BF%E7%94%A8%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%94%AF%E6%8C%81%EF%BC%89%EF%BC%8C%E6%8E%A5%E7%9D%80%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A4%A7%E5%B0%8F%E4%B8%BA-2G-%E7%9A%84%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E5%90%8D%E4%B8%BA-share01-%E5%B9%B6%E5%BC%80%E6%94%BE-share01-%E7%9B%AE%E5%BD%95%E5%AF%B9-OpenStack-%E7%AE%A1%E7%90%86%E7%BD%91%E6%AE%B5%E4%BD%BF%E7%94%A8%E6%9D%83%E9%99%90%E3%80%82"><span class="toc-number">4.11.1.</span> <span class="toc-text">创建 default_share_type 共享类型（不使用驱动程序支持），接着创建一个大小为 2G 的共享存储名为 share01 并开放 share01 目录对 OpenStack 管理网段使用权限。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Barbican-%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.12.</span> <span class="toc-text">Barbican 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-openstack-%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BA-secret01-%E7%9A%84%E5%AF%86%E9%92%A5"><span class="toc-number">4.12.1.</span> <span class="toc-text">使用 openstack 命令创建一个名为 secret01 的密钥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cloudkitty-%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.13.</span> <span class="toc-text">Cloudkitty 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-hashmap-%E8%AF%84%E7%BA%A7-%E6%A8%A1%E5%9D%97%EF%BC%8C%E6%8E%A5%E7%9D%80%E5%88%9B%E5%BB%BA-volume-thresholds-%E7%BB%84%EF%BC%8C%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99-volume-size%EF%BC%8C%E5%B9%B6%E8%AE%BE%E7%BD%AE%E6%AF%8F-GB-%E7%9A%84%E4%BB%B7-%E6%A0%BC%E4%B8%BA-0-01%E3%80%82%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%AF%B9%E5%BA%94%E5%A4%A7%E9%87%8F%E6%95%B0%E6%8D%AE%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E6%8A%98%E6%89%A3%EF%BC%8C%E5%9C%A8%E7%BB%84-volume-thresholds-%E4%B8%AD%E5%88%9B%E5%BB%BA%E9%98%88%E5%80%BC%EF%BC%8C%E8%AE%BE%E7%BD%AE-%E8%8B%A5%E8%B6%85%E8%BF%87-50GB-%E7%9A%84%E9%98%88%E5%80%BC%EF%BC%8C%E5%BA%94%E7%94%A8-2-%E7%9A%84%E6%8A%98%E6%89%A3%EF%BC%880-98%EF%BC%89%E3%80%82"><span class="toc-number">4.13.1.</span> <span class="toc-text">启用 hashmap 评级 模块，接着创建 volume_thresholds 组，创建服务匹配规则 volume.size，并设置每 GB 的价 格为 0.01。接下来对应大量数据设置应用折扣，在组 volume_thresholds 中创建阈值，设置 若超过 50GB 的阈值，应用 2%的折扣（0.98）。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenStack-%E5%B9%B3%E5%8F%B0%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96"><span class="toc-number">4.14.</span> <span class="toc-text">OpenStack 平台内存优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%AE%8C-OpenStack-%E5%B9%B3%E5%8F%B0%E5%90%8E%EF%BC%8C%E5%85%B3%E9%97%AD%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%86%85%E5%AD%98%E5%85%B1%E4%BA%AB%EF%BC%8C%E6%89%93%E5%BC%80%E9%80%8F%E6%98%8E%E5%A4%A7%E9%A1%B5%E3%80%82"><span class="toc-number">4.14.1.</span> <span class="toc-text">搭建完 OpenStack 平台后，关闭系统的内存共享，打开透明大页。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenStack-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E8%B0%83%E4%BC%98"><span class="toc-number">4.14.2.</span> <span class="toc-text">OpenStack 消息队列调优</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kvm%E8%B0%83%E4%BC%98"><span class="toc-number">4.14.3.</span> <span class="toc-text">kvm调优</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E4%BC%98%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">4.14.4.</span> <span class="toc-text">常见优化配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E8%B5%84%E6%BA%90%E9%A2%84%E7%95%99"><span class="toc-number">4.14.5.</span> <span class="toc-text">计算节点资源预留</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenStack-Heat-%E8%BF%90%E7%BB%B4"><span class="toc-number">4.15.</span> <span class="toc-text">OpenStack Heat 运维</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAcontainer%EF%BC%88%E5%AE%B9%E5%99%A8%EF%BC%89"><span class="toc-number">4.15.1.</span> <span class="toc-text">创建container（容器）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAflavor%EF%BC%88%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B%EF%BC%89"><span class="toc-number">4.15.2.</span> <span class="toc-text">创建flavor（云主机类型）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAnet%EF%BC%88%E7%BD%91%E7%BB%9C%EF%BC%89"><span class="toc-number">4.15.3.</span> <span class="toc-text">创建net（网络）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAuser%EF%BC%88%E7%94%A8%E6%88%B7%EF%BC%89"><span class="toc-number">4.15.4.</span> <span class="toc-text">创建user（用户）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAimage%EF%BC%88%E9%95%9C%E5%83%8F%EF%BC%89"><span class="toc-number">4.15.5.</span> <span class="toc-text">创建image（镜像）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAserver%EF%BC%88%E4%BA%91%E4%B8%BB%E6%9C%BA%EF%BC%89"><span class="toc-number">4.15.6.</span> <span class="toc-text">创建server（云主机）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAcinder%EF%BC%88%E5%8D%B7%EF%BC%89"><span class="toc-number">4.15.7.</span> <span class="toc-text">创建cinder（卷）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E7%A8%8B%E5%BA%8F%E5%AF%B9%E6%8E%A5openstack-api"><span class="toc-number">4.16.</span> <span class="toc-text">python程序对接openstack api</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85python3"><span class="toc-number">4.16.1.</span> <span class="toc-text">安装python3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAflavor%EF%BC%88%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B%EF%BC%89-1"><span class="toc-number">4.16.2.</span> <span class="toc-text">创建flavor（云主机类型）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAserver%EF%BC%88%E4%BA%91%E4%B8%BB%E6%9C%BA%EF%BC%89-1"><span class="toc-number">4.16.3.</span> <span class="toc-text">创建server（云主机）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAuser%EF%BC%88%E7%94%A8%E6%88%B7%EF%BC%89-1"><span class="toc-number">4.16.4.</span> <span class="toc-text">创建user（用户）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAproject%EF%BC%88%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="toc-number">4.16.5.</span> <span class="toc-text">创建project（项目）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAvolume%EF%BC%88%E5%8D%B7%EF%BC%89"><span class="toc-number">4.16.6.</span> <span class="toc-text">创建volume（卷）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%8E%E4%B8%89%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.17.</span> <span class="toc-text">Redis 一主二从三哨兵模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E6%9C%8D%E5%8A%A1%E8%B0%83%E4%BC%98-AOF"><span class="toc-number">4.18.</span> <span class="toc-text">Redis 服务调优-AOF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Raid%E7%AE%A1%E7%90%86"><span class="toc-number">4.19.</span> <span class="toc-text">Raid管理</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/12/6-%E8%BE%B9%E7%BC%98%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/" title="公有云：(6)边缘计算平台部署应用"><img src="/../jihu/wallpaper/used/gy6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="公有云：(6)边缘计算平台部署应用"/></a><div class="content"><a class="title" href="/2023/08/12/6-%E8%BE%B9%E7%BC%98%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/" title="公有云：(6)边缘计算平台部署应用">公有云：(6)边缘计算平台部署应用</a><time datetime="2023-08-11T22:00:00.000Z" title="发表于 2023-08-12 06:00:00">2023-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/12/5-%E5%85%AC%E6%9C%89%E4%BA%91Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/" title="公有云：(5)公有云Python运维开发案例"><img src="/../jihu/wallpaper/used/gy5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="公有云：(5)公有云Python运维开发案例"/></a><div class="content"><a class="title" href="/2023/08/12/5-%E5%85%AC%E6%9C%89%E4%BA%91Python%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B/" title="公有云：(5)公有云Python运维开发案例">公有云：(5)公有云Python运维开发案例</a><time datetime="2023-08-11T21:00:00.000Z" title="发表于 2023-08-12 05:00:00">2023-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/12/4-%E5%85%AC%E6%9C%89%E4%BA%91Helm%E6%A8%A1%E6%9D%BF%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/" title="公有云：(4)公有云Helm模板使用案例"><img src="/../jihu/wallpaper/used/gy4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="公有云：(4)公有云Helm模板使用案例"/></a><div class="content"><a class="title" href="/2023/08/12/4-%E5%85%AC%E6%9C%89%E4%BA%91Helm%E6%A8%A1%E6%9D%BF%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/" title="公有云：(4)公有云Helm模板使用案例">公有云：(4)公有云Helm模板使用案例</a><time datetime="2023-08-11T20:00:00.000Z" title="发表于 2023-08-12 04:00:00">2023-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/12/3-%E5%85%AC%E6%9C%89%E4%BA%91CCE%E9%9B%86%E7%BE%A4%E6%93%8D%E4%BD%9C%E6%A1%88%E4%BE%8B/" title="公有云：(3)公有云CCE集群操作案例"><img src="/../jihu/wallpaper/used/gy3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="公有云：(3)公有云CCE集群操作案例"/></a><div class="content"><a class="title" href="/2023/08/12/3-%E5%85%AC%E6%9C%89%E4%BA%91CCE%E9%9B%86%E7%BE%A4%E6%93%8D%E4%BD%9C%E6%A1%88%E4%BE%8B/" title="公有云：(3)公有云CCE集群操作案例">公有云：(3)公有云CCE集群操作案例</a><time datetime="2023-08-11T19:00:00.000Z" title="发表于 2023-08-12 03:00:00">2023-08-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By W</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>