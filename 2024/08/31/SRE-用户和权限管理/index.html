<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>用户和权限管理 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Site Reliability Engineering">
<meta property="og:type" content="article">
<meta property="og:title" content="用户和权限管理">
<meta property="og:url" content="http://example.com/2024/08/31/SRE-%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="Site Reliability Engineering">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/TITLE/linux4.jpg">
<meta property="article:published_time" content="2024-08-30T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-01T11:34:55.975Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="SRE">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/TITLE/linux4.jpg"><link rel="shortcut icon" href="/../images/TITLE/user.webp"><link rel="canonical" href="http://example.com/2024/08/31/SRE-%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '用户和权限管理',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2025-04-01 19:34:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/TITLE/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">97</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/TITLE/linux4.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">用户和权限管理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-30T16:00:00.000Z" title="发表于 2024-08-31 00:00:00">2024-08-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-01T11:34:55.975Z" title="更新于 2025-04-01 19:34:55">2025-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>67分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="用户和权限管理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Linux安全模型"><a href="#Linux安全模型" class="headerlink" title="Linux安全模型"></a>Linux安全模型</h1><p>资源分派： </p>
<ul>
<li>Authentication：认证，验证用户身份  </li>
<li>Authorization：授权，不同的用户设置不同权限  </li>
<li>Accouting|Audition：审计 </li>
</ul>
<p>在Linux系统中，当用户登录成功时，系统会自动分配令牌 token，包括：用户标识和组成员等信息。</p>
<p>3A认证： 又称AAA认证，是一套针对网络设备的网络访问控制策略安全模型。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用于审计的登录日志</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rocky8.5</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat /var/log/secure</span></span><br><span class="line"> Jun 25 07:50:35 rocky8 polkitd[965]: Registered Authentication Agent <span class="keyword">for</span> unix-session:c1 (system bus name </span><br><span class="line">:1.52 [/usr/bin/gnome-shell], object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale en_US.UTF-8)</span><br><span class="line"> Jun 25 07:51:52 rocky8 sshd[2413]: Accepted password <span class="keyword">for</span> root from 10.0.0.1 port 53734 ssh2</span><br><span class="line"> Jun 25 07:51:52 rocky8 systemd[2420]: pam_unix(systemd-user:session): session opened <span class="keyword">for</span> user root by (uid=0)</span><br><span class="line"> Jun 25 07:51:52 rocky8 sshd[2413]: pam_unix(sshd:session): session opened <span class="keyword">for</span> user root by (uid=0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#centos7用错误密码尝试远程连接之后的日志</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cat /var/log/secure</span></span><br><span class="line"> Jun 25 09:58:18 centos7 sshd[16194]: Nasty PTR record <span class="string">&quot;10.0.0.1&quot;</span> is <span class="built_in">set</span> up <span class="keyword">for</span> 10.0.0.1, ignoring</span><br><span class="line"> Jun 25 09:58:21 centos7 unix_chkpwd[16196]: password check failed <span class="keyword">for</span> user (root)</span><br><span class="line"> Jun 25 09:58:21 centos7 sshd[16194]: pam_unix(sshd:auth): authentication failure; <span class="built_in">logname</span>= uid=0 euid=0 </span><br><span class="line"><span class="built_in">tty</span>=ssh ruser= rhost=10.0.0.1  user=root</span><br><span class="line"> Jun 25 09:58:21 centos7 sshd[16194]: pam_succeed_if(sshd:auth): requirement <span class="string">&quot;uid &gt;= 1000&quot;</span> not met by user </span><br><span class="line"><span class="string">&quot;root&quot;</span></span><br><span class="line"> Jun 25 09:58:24 centos7 sshd[16194]: Failed password <span class="keyword">for</span> root from 10.0.0.1 port 55301 ssh2</span><br><span class="line"> Jun 25 09:58:25 centos7 sshd[16194]: error: Received disconnect from 10.0.0.1 port 55301:0:  [preauth]</span><br><span class="line"> Jun 25 09:58:25 centos7 sshd[16194]: Disconnected from 10.0.0.1 port 55301 [preauth]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">#ubuntu20.04.4</span></span><br><span class="line"> root@ubuntu20:~<span class="comment"># cat /var/log/auth.log</span></span><br><span class="line"> Jun 25 09:53:58 ubuntu20 systemd-logind[871]: Watching system buttons on /dev/input/event1 (AT Translated Set </span><br><span class="line">2 keyboard)</span><br><span class="line"> Jun 25 09:55:29 ubuntu20 sshd[1238]: Accepted password <span class="keyword">for</span> jose from 10.0.0.1 port 55262 ssh2</span><br><span class="line"> Jun 25 09:55:29 ubuntu20 sshd[1238]: pam_unix(sshd:session): session opened <span class="keyword">for</span> user jose by (uid=0)</span><br><span class="line"> Jun 25 09:55:30 ubuntu20 systemd-logind[871]: New session 1 of user jose.</span><br><span class="line"> Jun 25 09:55:30 ubuntu20 systemd: pam_unix(systemd-user:session): session opened <span class="keyword">for</span> user jose by (uid=0)</span><br><span class="line"> Jun 25 09:55:37 ubuntu20 sudo:     jose : TTY=pts/0 ; PWD=/home/jose ; USER=root ; COMMAND=/bin/bash</span><br><span class="line"> Jun 25 09:55:37 ubuntu20 sudo: pam_unix(sudo:session): session opened <span class="keyword">for</span> user root by jose(uid=0)</span><br></pre></td></tr></table></figure>

<h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><p>Linux系统是多用户系统，可以同时存在多个用户，每个用户之间都是互相隔离的。</p>
<p>在Linux系统中，每个用户是通过User Id （UID）来唯一标识的。</p>
<p><img src="../../../../images/SRE/day04/1.png" alt="1"></p>
<ul>
<li><p>管理员：root， 0 </p>
</li>
<li><p>普通用户：1-60000 自动分配</p>
<p>系统用户：1-499 （CentOS 6以前）， 1-999 （CentOS 7以后） 对守护进程获取资源进行权限分配</p>
<p>登录用户：500+ （CentOS6以前）, 1000+（CentOS7以后） 给用户进行交互式登录使用</p>
</li>
</ul>
<p>在Linux中，root以下，都是普通用户，其用户id为1-60000</p>
<table>
<thead>
<tr>
<th>用户类型</th>
<th>用户名</th>
<th>用户id（uid）</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>超级管理员</td>
<td>root(可改)</td>
<td>0</td>
<td>超级管理员</td>
</tr>
<tr>
<td>普通用户–系统用户</td>
<td>自定义</td>
<td>1-499 （CentOS 6以前）<br />1-999 （CentOS 7以后）</td>
<td>给后台程序使用，像nginx，mysql等</td>
</tr>
<tr>
<td>普通用户–登录用户</td>
<td>自定义</td>
<td>500+ （CentOS6以前）<br /> 1000+（CentOS7以后）</td>
<td>给用户进行交互式登录</td>
</tr>
</tbody></table>
<h2 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h2><p>Linux中可以将一个或多个用户加入用户组中，组就是包含0个或多个用户的集合，用户组是通过Group ID（GID） 来唯一标识的。</p>
<p><img src="../../../../images/SRE/day04/2.png" alt="2"></p>
<ul>
<li><p>管理员组：root， 0 </p>
</li>
<li><p>普通组： </p>
<p>系统组：1-499（CentOS 6以前）， 1-999（CentOS7以后）， 对守护进程获取资源进行权限分配 </p>
<p>普通组：500+（CentOS 6以前），1000+（CentOS7以后）， 给用户使用</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>组类型</th>
<th>组名</th>
<th>组id（gid）</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>超级管理员组</td>
<td>root</td>
<td>0</td>
<td>给超级管理员使用</td>
</tr>
<tr>
<td>普通用户组–系统组</td>
<td>自定义</td>
<td>1-499 （CentOS 6以前）<br />1-999 （CentOS 7以后）</td>
<td>给后台用户使用</td>
</tr>
<tr>
<td>普通用户组–普通组</td>
<td>自定义</td>
<td>500+ （CentOS6以前）<br /> 1000+（CentOS7以后）</td>
<td>给登录用户使用</td>
</tr>
</tbody></table>
<h2 id="用户和组的关系"><a href="#用户和组的关系" class="headerlink" title="用户和组的关系"></a>用户和组的关系</h2><ul>
<li>一个用户至少有一个组，也可以有多个组；</li>
<li>一个组至少有0个用户，也可以有多个用户； </li>
<li>用户的主要组(primary group)：又称私有组，一个用户必须属于且只有一个主组，创建用户时，默认会创建与其同名的组作为主组； </li>
<li>用户的附加组(supplementary group)：又称辅助组，一个用户可以属于0个或多个附加组； </li>
<li>使用组，可以对用户进行批量管理，比如对一个组授权，则该组下所有的用户能能继承这个组的权限；</li>
</ul>
<h2 id="安全上下文"><a href="#安全上下文" class="headerlink" title="安全上下文"></a>安全上下文</h2><p><strong>Linux安全上下文Context：</strong></p>
<p>在Linux系统中，运行中的程序（即进程process），都是以进程发起者的身份运行；</p>
<p>进程所能够访问的资源权限取决于进程的运行者的身份； </p>
<p><strong>首先，什么是程序</strong> </p>
<p>一个程序或一个命令，本质上也是一个可执行的二进制文件或一个可执行的脚本文件； </p>
<p>在服务器上有很多文件，只有那些特定的，可以被执行的二进制文件，才能被称为程序； </p>
<p><strong>其次，什么是进程</strong> </p>
<p>运行中的程序，就是进程；</p>
<p><strong>第三，程序，进程，用户之间的关系是怎样的</strong> </p>
<p>只有可以被执行的文件，才能叫作程序； </p>
<p>对于同一个程序，也不是所有用户都可以运行的，这要取决于当前用户对该程序有没有可执行权限； </p>
<p>用户张三，运行了某个程序，那么，张三就发起了一个进程，该进程的发起者，就是张三，该进程是以张三的身份在运行；</p>
<p>打个比方，在交通工具中，只有能在天上飞的，才能叫作飞机； </p>
<p>对于同一架飞机，也不是所有人都能上去的，这要取决于有没有买机票，有没有登机牌；</p>
<p><strong>第四，进程的访问资源</strong> </p>
<p>一个进程能不能访问某些资源，是由进程发起者决定的（跟进程本身的程序文件无关），比如某进程要读写某个文件，则要看该进程发起者 有没有权限读取该文件； </p>
<p>一个旅客能不能坐头等舱，是由旅客自己决定的，跟飞机本身无关；</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#reboot命令，只有root用户才有权限执行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># reboot</span></span><br><span class="line"> Connection closing...Socket close.</span><br><span class="line"> Connection closed by foreign host.</span><br><span class="line"> Disconnected from remote host(rocky8.5-2-153) at 11:19:02.</span><br><span class="line"> Type `<span class="built_in">help</span><span class="string">&#x27; to learn how to use Xshell prompt.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#普通用户无权限执行</span></span><br><span class="line"><span class="string">[root@rocky8 ~]# su - jose</span></span><br><span class="line"><span class="string">[jose@rocky8 ~]$ reboot</span></span><br><span class="line"><span class="string"> User root is logged in on sshd.</span></span><br><span class="line"><span class="string"> Please retry operation after closing inhibitors and logging out other users.</span></span><br><span class="line"><span class="string"> Alternatively, ignore inhibitors and users with &#x27;</span>systemctl reboot -i<span class="string">&#x27;.</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#root 和普通用户都能执行cat命令，但对于某些文件，只有root 用户才能打开</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat /etc/shadow</span></span><br><span class="line"> root:$6$10pvyo2c4EI8tYh1<span class="variable">$PT2yiAT6nrxs9rtjhQFWfDuHyFaV5HARXzn9YZ6wpJKveHccpl5Qoljt7iIlmHxWuy</span>//::0:99999:7:::</span><br><span class="line"> bin:*:18700:0:99999:7:::</span><br><span class="line"> daemon:*:18700:0:99999:7:::</span><br><span class="line"> adm:*:18700:0:99999:7:::</span><br><span class="line"> ......</span><br><span class="line"> </span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">cat</span> /etc/shadow</span><br><span class="line"> <span class="built_in">cat</span>: /etc/shadow: Permission denied</span><br></pre></td></tr></table></figure>

<h1 id="用户和组的配置文件"><a href="#用户和组的配置文件" class="headerlink" title="用户和组的配置文件"></a>用户和组的配置文件</h1><h2 id="用户和组的主要配置文件"><a href="#用户和组的主要配置文件" class="headerlink" title="用户和组的主要配置文件"></a>用户和组的主要配置文件</h2><ul>
<li>etc/passwd：用户及其属性信息(名称、UID、主组ID等）  </li>
<li>/etc/shadow：用户密码及其相关属性  </li>
<li>/etc/group：组及其属性信息  </li>
<li>/etc/gshadow：组密码及其相关属性</li>
</ul>
<h2 id="passwd文件格式"><a href="#passwd文件格式" class="headerlink" title="passwd文件格式"></a>passwd文件格式</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">whatis passwd</span><br><span class="line"> openssl-passwd (1ssl) - compute password hashes</span><br><span class="line"> passwd (1)           - update user<span class="string">&#x27;s authentication tokens</span></span><br><span class="line"><span class="string"> passwd (5)           - password file</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> man 5 passwd #查看帮助手册</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#文件格式</span></span><br><span class="line"><span class="string">#login name:password:UID:GID:GECOS:directory:shell</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> root:x:0:0:root:/root:/bin/bash</span></span><br><span class="line"><span class="string"> ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span></span><br><span class="line"><span class="string"> mage:x:1002:1002::/home/mage:/bin/bash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">login name      #登录用户名</span></span><br><span class="line"><span class="string">password        #密码位，x只是表示一个占位符，可为空</span></span><br><span class="line"><span class="string">UID             #用户ID，0 表示超级管理员</span></span><br><span class="line"><span class="string">GID             #所属组ID</span></span><br><span class="line"><span class="string">GECOS           #用户全名或注释，描述信息，可为空</span></span><br><span class="line"><span class="string">directory       #用户家目录，在创建用户时，默认会创建在/home 目录下</span></span><br><span class="line"><span class="string">shell           #用户默认shell，/sbin/nologin 表示不用登录的 shell，一般用 chsh 命令修改 chsh -s /bin/csh mage</span></span><br></pre></td></tr></table></figure>

<p>修改用户shell</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># getent passwd jose</span></span><br><span class="line"> jose:x:1000:1000:jose:/home/jose:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># chsh -s /bin/sh jose</span></span><br><span class="line"> Changing shell <span class="keyword">for</span> jose.</span><br><span class="line"> Shell changed.</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent passwd jose</span></span><br><span class="line"> jose:x:1000:1000:jose:/home/jose:/bin/sh</span><br></pre></td></tr></table></figure>

<h2 id="shadow文件格式"><a href="#shadow文件格式" class="headerlink" title="shadow文件格式"></a>shadow文件格式</h2><p>此文件中存储的是用户密码信息，任何用户都无权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ll /etc/shadow----------. 1 root root 1426 Jun 25 11:35 /etc/shadow</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">whatis shadow</span><br><span class="line"></span><br><span class="line">shadow (5)           - shadowed password file</span><br><span class="line">shadow (3)           - encrypted password file routines</span><br><span class="line"></span><br><span class="line">man 5 shadow</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件格式</span></span><br><span class="line"><span class="comment">#login name:encrypted password:date of last password change:minimum password age:maximum password age:password warning period:password inactivity period:account expiration date:reserved field</span></span><br><span class="line"></span><br><span class="line">root:$6$lwdNTBEpfKFnUipo<span class="variable">$Zm4JTG7vVVg6lJaMJ7sPTqmbc</span>/I6GGMIjp7yO.rd6TsKb0lEeRHn4q7Z/LWJvV/FAWgTJVta9Gd78NPVNfld.1::0:99999:7:::</span><br><span class="line">ftp:*:18700:0:99999:7:::</span><br><span class="line">jose:$6<span class="variable">$Cvfl7WE8khYDd</span>/xb<span class="variable">$4pNMm</span>.C46MEOUElWyFbRvO2FcGFv/a.EdD9rtWa0jvZdoThq8spMGw4rPbcQzqsY99hW3aImVK4SPR/KJaoSh0:19168:0:99999:7:::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">login name                    <span class="comment">#登录用户名</span></span><br><span class="line">encrypted password            <span class="comment">#加密后的密文，一般用sha512加密，可为空，!表示该用户被锁定，不能登录系统</span></span><br><span class="line"><span class="built_in">date</span> of last password change  <span class="comment">#上次修改密码的时间，自1970年开始，0表示下次登录之后就要改密码，为空表示密码时效功能无效</span></span><br><span class="line">minimum password age          <span class="comment">#最小时间间隔，当前密码最少能使用多少天，0表示随时可被变更</span></span><br><span class="line">maximum password age          <span class="comment">#最大时间间隔，当前密码最多能使用多少天，99999表示可以一直使用</span></span><br><span class="line">password warning period       <span class="comment">#警告时间，密码过期前几天开始提醒用户，默认为7</span></span><br><span class="line">password inactivity period    <span class="comment">#不活动时间，密码过期几天后帐号会被锁定，在此期间，用户仍然可以登录，为空表示不使用此规则</span></span><br><span class="line">account expiration <span class="built_in">date</span>       <span class="comment">#失效时间，从1970年1月1日算起，多少天后帐号失效，为空表示永不过期</span></span><br><span class="line">reserved field                <span class="comment">#保留字段，无意义</span></span><br></pre></td></tr></table></figure>

<p>所有伪用户的密码都是 “!!” 或 “*”，代表没有密码是不能登录的，新建用户还没设密码时为!!，禁用账号，可以直接在密码字段前加 !</p>
<h2 id="group文件格式"><a href="#group文件格式" class="headerlink" title="group文件格式"></a>group文件格式</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">man group</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件格式</span></span><br><span class="line"><span class="comment">#group_name:password:GID:user_list</span></span><br><span class="line"></span><br><span class="line"> ftp:x:50:</span><br><span class="line"> mage:x:1002:</span><br><span class="line"> </span><br><span class="line">group_name      <span class="comment">#组名</span></span><br><span class="line">password        <span class="comment">#组密码，当用户加组时，需要用此密码验证</span></span><br><span class="line">GID             <span class="comment">#组ID</span></span><br><span class="line">user_list       <span class="comment">#用户列表，多个用户用,分隔, 此处的用户将当前组作为附加组</span></span><br></pre></td></tr></table></figure>

<h2 id="gshdow文件格式"><a href="#gshdow文件格式" class="headerlink" title="gshdow文件格式"></a>gshdow文件格式</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">man gshadow</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件格式</span></span><br><span class="line"><span class="comment">#group name:encrypted password:administrators:members</span></span><br><span class="line"> ftp:::</span><br><span class="line"> mage:!::</span><br><span class="line"></span><br><span class="line">group name              <span class="comment">#组名</span></span><br><span class="line">encrypted password      <span class="comment">#组密码，加密后的密文，!表示还没设密码</span></span><br><span class="line">administrators          <span class="comment">#组管理员</span></span><br><span class="line">members                 <span class="comment">#用户列表，多个用户用,分隔, 此处的用户将当前组作为附加组</span></span><br></pre></td></tr></table></figure>

<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><p>可以直接用编辑工具来修改上述文件，但由于跟用户和权限有关的文件具有敏感性，所以系统提供了专用的工具来修改这几个文件。</p>
<p><strong>vipw &amp; vigr</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vipw|vigr</span></span><br><span class="line"><span class="comment">#编辑 /etc/passwd，/etc/group，/etc/shadow，/etc/gshadow</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#vipw  默认编辑 /etc/passwd 文件</span></span><br><span class="line"><span class="comment">#vigr   默认编辑 /etc/group 文件</span></span><br><span class="line"></span><br><span class="line">-g|--group              <span class="comment">#编辑 group 文件</span></span><br><span class="line">-p|--passwd             <span class="comment">#编辑 passwd 文件</span></span><br><span class="line">-s|--shadow             <span class="comment">#编辑 /etc/shadow 或 /etc/gshadow 文件</span></span><br></pre></td></tr></table></figure>

<p><strong>pwck &amp; grpck</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pwck [options] [passwd [shadow]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对用户相关配置文件进行检查，默认检查文件为 /etc/passwd，/etc/shadow</span></span><br><span class="line"></span><br><span class="line">-q|--quiet              <span class="comment">#只报告错误，忽略警告</span></span><br><span class="line">-r|--read-only          <span class="comment">#显示错误和警告，但不改变文件</span></span><br><span class="line">-R|--root CHROOT_DIR    <span class="comment">#chroot 到的目录</span></span><br><span class="line">-s|--<span class="built_in">sort</span>               <span class="comment">#通过 UID 排序项目</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#grpck [options] [group [gshadow]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对用户组相关配置文件进行检查，默认检查文件为 /etc/group，/etc/gshadow</span></span><br><span class="line"></span><br><span class="line">-r|--read-only          <span class="comment">#显示错误和警告，但不改变文件</span></span><br><span class="line">-R|--root CHROOT_DIR    <span class="comment">#chroot 到的目录</span></span><br><span class="line">-s|--<span class="built_in">sort</span>               <span class="comment">#通过 UID 排序项目</span></span><br></pre></td></tr></table></figure>

<h1 id="用户和组管理命令"><a href="#用户和组管理命令" class="headerlink" title="用户和组管理命令"></a>用户和组管理命令</h1><h2 id="用户创建"><a href="#用户创建" class="headerlink" title="用户创建"></a>用户创建</h2><p>useradd 命令可以创建新的Linux用户 </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">useradd [options] LOGIN</span><br><span class="line">useradd -D</span><br><span class="line">useradd -D [options]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-u|--uid UID                <span class="comment">#指定UID</span></span><br><span class="line">-g|--gid GID                <span class="comment">#指定用户组，-g groupname|--gid GID</span></span><br><span class="line">-c|--comment COMMENT        <span class="comment">#新账户的 GECOS 字段</span></span><br><span class="line">-d|--home-dir HOME_DIR      <span class="comment">#指定家目录，可以是不存在的，指定家目录，并不代表创建家目录</span></span><br><span class="line">-s|--shell SHELL            <span class="comment">#指定 shell，可用shell在/etc/shells 中可以查看</span></span><br><span class="line">-r|--system                 <span class="comment">#创建系统用户,CentOS 6之前 ID&lt;500，CentOS7 以后ID&lt;1000，不会创建登录用户相关信息</span></span><br><span class="line">-m|--create-home            <span class="comment">#创建家目录，一般用于登录用户</span></span><br><span class="line">-M|--no-create-home         <span class="comment">#不创建家目录，一般用于不用登录的用户</span></span><br><span class="line">-p|--password PASSWORD      <span class="comment">#设置密码，这里的密码是以明文的形式存在于/etc/shadow 文件中</span></span><br><span class="line">-o|--non-unique             <span class="comment">#允许使用重复的 UID 创建用户</span></span><br><span class="line">-G|--<span class="built_in">groups</span> GROUP1[,GROUP2,...] <span class="comment">#为用户指明附加组，组须事先存在</span></span><br><span class="line">-N|--no-user-group          <span class="comment">#不创建同名的组,使用users组做主组</span></span><br><span class="line">-D|--defaults               <span class="comment">#显示或更改默认的 useradd 配置，默认配置文件是 /etc/default/useradd</span></span><br><span class="line">-e|--expiredate EXPIRE_DATE <span class="comment">#指定账户的过期日期  YYYY-MM-DD 格式</span></span><br><span class="line">-f|--inactive INACTIVE      <span class="comment">#密码过期之后，账户被彻底禁用之前的天数，0 表示密码过期立即禁用，-1表示不使用此功能 </span></span><br><span class="line">-k|--skel SKEL_DIR          <span class="comment">#指定家目录模板，创建家目录，会生成一些默认文件，如果指定，就从该目录复制文件，默认是/etc/skel/，要配合-m</span></span><br><span class="line">-K|--key KEY=VALUE          <span class="comment">#不使用 /etc/login.defs 中的默认值，自己指定，比如 -K UID_MIN=100</span></span><br><span class="line">-l|--no-log-init            <span class="comment">#不将用户添加到最近登录和登录失败记录，前面讲到的3a认证审计，就在此处lastlog|lastb|cat /var/log/secure</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment">#rpm -q --scripts postfix</span></span><br><span class="line"> preinstall scriptlet (using /bin/sh):</span><br><span class="line"> <span class="comment"># Add user and groups if necessary</span></span><br><span class="line"> /usr/sbin/groupadd -g 90 -r postdrop 2&gt;/dev/null</span><br><span class="line"> /usr/sbin/groupadd -g 89 -r postfix 2&gt;/dev/null</span><br><span class="line"> /usr/sbin/groupadd -g 12 -r mail 2&gt;/dev/null</span><br><span class="line"> /usr/sbin/useradd -d /var/spool/postfix -s </span><br><span class="line"> /sbin/nologin -g postfix -G mail -M -r -u 89 postfix 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建用户前先建组，可以确保组ID是己知的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不可占用己存在的组ID</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupadd -g 33 mysql</span></span><br><span class="line"> groupadd: GID <span class="string">&#x27;33&#x27;</span> already exists</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建系统组</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupadd -g 336 -r mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent group mysql</span></span><br><span class="line"> mysql:x:336:</span><br><span class="line"> </span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent gshadow mysql</span></span><br><span class="line"> mysql:!::</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd -u 336 -g mysql -s /sbin/nologin -d /data/mysql -M -r mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent passwd mysql</span></span><br><span class="line"> mysql:x:336:336::/data/mysql:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow mysql</span></span><br><span class="line"> mysql:!!:19168::::::</span><br></pre></td></tr></table></figure>

<p>默认创建</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># useradd tom</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent passwd tom</span></span><br><span class="line"> tom:x:1003:1003::/home/tom:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow tom</span></span><br><span class="line"> tom:!!:19168:0:99999:7:::</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent group tom</span></span><br><span class="line"> tom:x:1003:</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent gshadow tom</span></span><br><span class="line"> tom:!::</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls -a /home/tom/</span></span><br><span class="line"> .  ..  .bash_logout  .bash_profile  .bashrc</span><br></pre></td></tr></table></figure>

<p>useradd 命令默认值设定由/etc/default/useradd定义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat /etc/default/useradd</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># useradd defaults file</span></span><br><span class="line"> GROUP=100              <span class="comment">#useradd不指定组,且/etc/login.defs中的USERGROUPS_ENAB为no或useradd -N时，group 为100</span></span><br><span class="line"> HOME=/home             <span class="comment">#默认家目录父目录</span></span><br><span class="line">INACTIVE=-1             <span class="comment">#对应/etc/shadow文件第7列，即用户密码过期后的帐号锁定的宽限期,-1表示不锁定</span></span><br><span class="line">EXPIRE=                 <span class="comment">#对应/etc/shadow文件第8列，即用户帐号的有效期</span></span><br><span class="line">SHELL=/bin/bash         <span class="comment">#默认bash</span></span><br><span class="line">SKEL=/etc/skel          <span class="comment">#用于生成新建用户家目录的模版文件</span></span><br><span class="line">CREATE_MAIL_SPOOL=<span class="built_in">yes</span>   <span class="comment">#默认创建收件箱</span></span><br></pre></td></tr></table></figure>

<p>显示或更改默认设置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#useradd -D </span></span><br><span class="line"><span class="comment">#useradd –D -s SHELL</span></span><br><span class="line"><span class="comment">#useradd –D –b BASE_DIR</span></span><br><span class="line"><span class="comment">#useradd –D –g GROUP</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd -D</span></span><br><span class="line"> GROUP=100</span><br><span class="line"> HOME=/home</span><br><span class="line"> INACTIVE=-1</span><br><span class="line"> EXPIRE=</span><br><span class="line"> SHELL=/bin/bash</span><br><span class="line"> SKEL=/etc/skel</span><br><span class="line"> CREATE_MAIL_SPOOL=<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更改默认 shell</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd -D -s /bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次更改</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd -D</span></span><br><span class="line"> GROUP=100</span><br><span class="line"> HOME=/home</span><br><span class="line"> INACTIVE=-1</span><br><span class="line"> EXPIRE=</span><br><span class="line"> SHELL=/bin/sh</span><br><span class="line"> SKEL=/etc/skel</span><br><span class="line"> CREATE_MAIL_SPOOL=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<p>家目录模板</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ls -a /etc/skel/</span></span><br><span class="line">.  ..  .bash_logout  .bash_profile  .bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改此目录内容后，新创建的用户家目录中的内容会发生改变</span></span><br></pre></td></tr></table></figure>

<p>新建用户的相关文件 </p>
<ul>
<li>/etc/default/useradd   </li>
<li>/etc/skel/*   </li>
<li>/etc/login.defs</li>
</ul>
<p>批量创建用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newusers file </span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat user.txt </span></span><br><span class="line"> u1:123456:1024:1024::/home/u1:/bin/bash</span><br><span class="line"> u2:123456:1025:1025::/home/u2:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># newusers user.txt</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># id u1</span></span><br><span class="line"> uid=1024(u1) gid=1024(u1) <span class="built_in">groups</span>=1024(u1)</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># id u2</span></span><br><span class="line"> uid=1025(u2) gid=1025(u2) <span class="built_in">groups</span>=1025(u2)</span><br></pre></td></tr></table></figure>

<p>批量修改用户口令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chpasswd &lt; file</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat pwd.txt</span></span><br><span class="line"> u1:1234567</span><br><span class="line"> u2:1234567</span><br><span class="line"></span><br><span class="line"><span class="comment">#标准输入重定向</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># chpasswd &lt; pwd.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#多行重定向</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># chpasswd &lt;&lt;EOF</span></span><br><span class="line"> &gt; u1:1234567</span><br><span class="line"> &gt; u2:1234567</span><br><span class="line"> &gt; EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#管道重定向</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo u1:123456 | chpasswd</span></span><br></pre></td></tr></table></figure>

<p>范例: CentOS8 生成sha512加密密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#openssl passwd -6 magedu</span></span><br><span class="line"> $6<span class="variable">$UOyYOao</span>.iM2.rPnM<span class="variable">$jCpTnBVIQBuGCLOm4N5hqh5YUc3wWXcDzkDMddthpKNL3scOZjTHh9fXds8Eu6gNdEQqLMQgOboipZ08mnz2V</span>.</span><br></pre></td></tr></table></figure>

<p>范例: CentOS7 利用Python程序在 生成sha512加密密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#python -c &#x27;import crypt,getpass;pw=&quot;magedu&quot;;print(crypt.crypt(pw))&#x27;</span></span><br><span class="line"> $6$pt0SFMf6YqKea3mh$.7Hkslg17uI.Wu7BcMJStVVtkzrwktXrOC8DxcMFC4JO1igrqR7VAi87H5PHOuLTUEjl7eJqKUhMT1e9ixojn1</span><br></pre></td></tr></table></figure>

<p>范例: CentOS 6 创建并指定基于sha512的用户密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="comment">#grub-crypt --help</span></span><br><span class="line"> Usage: grub-crypt [OPTION]...</span><br><span class="line"> Encrypt a password.</span><br><span class="line"> </span><br><span class="line"> -h, --<span class="built_in">help</span>             Print this message and <span class="built_in">exit</span></span><br><span class="line"> -v, --version          Print the version information and <span class="built_in">exit</span></span><br><span class="line"> --md5                  Use MD5 to encrypt the password</span><br><span class="line"> --sha-256              Use SHA-256 to encrypt the password</span><br><span class="line"> --sha-512              Use SHA-512 to encrypt the password (default)</span><br><span class="line">           </span><br><span class="line">              </span><br><span class="line">  Report bugs to &lt;bug-grub@gnu.org&gt;.</span><br><span class="line"> EOF</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@centos6 ~]<span class="comment">#grub-crypt --sha-512</span></span><br><span class="line"> Password: </span><br><span class="line"> Retype password: </span><br><span class="line"> $6<span class="variable">$v9A2</span>/xUNwAWwEmHN<span class="variable">$q7Wz</span>.uscsV/8J5Gss3KslX8hKXOoaP3hDpOBWeBfMQHVIRZiwHUUkii84cvQWIMnvtnXYsdVHuLO4KhOiSOMh/</span><br><span class="line"> </span><br><span class="line">[root@centos6 ~]<span class="comment">#useradd -p </span></span><br><span class="line"><span class="string">&#x27;$6$v9A2/xUNwAWwEmHN$q7Wz.uscsV/8J5Gss3KslX8hKXOoaP3hDpOBWeBfMQHVIRZiwHUUkii84cvQWIMnvtnXYsdVHuLO4KhOiSOMh/&#x27;</span> <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#getent shadow test</span></span><br><span class="line"> <span class="built_in">test</span>:$6<span class="variable">$v9A2</span>/xUNwAWwEmHN<span class="variable">$q7Wz</span>.uscsV/8J5Gss3KslX8hKXOoaP3hDpOBWeBfMQHVIRZiwHUUkii84cvQWIMnvtnXYsdVHuLO4KhOiSOMh/:18459:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>范例: Ubuntu18.04 创建sha512加密密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment">#openssl passwd -6 123456</span></span><br><span class="line"> $6<span class="variable">$RyaXh7L</span>.7fORQBjB<span class="variable">$0WXRATSjh3IU</span>.eufhsY5uJpKZwCAGjyAj5r/et9ymohEKsTdMvagEW92t1IAkNte0yVZ88YyMUqx1b6uHIrxM/</span><br></pre></td></tr></table></figure>

<h2 id="用户属性修改"><a href="#用户属性修改" class="headerlink" title="用户属性修改"></a>用户属性修改</h2><p>usermod 命令可以修改用户属性</p>
<p>格式:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">usermod [options] LOGIN</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-c|--comment COMMENT            <span class="comment">#修改注释 </span></span><br><span class="line">-d|--home HOME_DIR              <span class="comment">#修改家目录</span></span><br><span class="line">-e|--expiredate EXPIRE_DATE     <span class="comment">#修改过期的日期，YYYY-MM-DD 格式</span></span><br><span class="line">-f|--inactive INACTIVE          <span class="comment">#密码过期之后，账户被彻底禁用之前的天数，0 表示密码过期立即禁用，-1表示不使用此功能</span></span><br><span class="line">-g|--gid GROUP                  <span class="comment">#修改组</span></span><br><span class="line">-G|--<span class="built_in">groups</span> GROUPS              <span class="comment">#groupName|GID... 新附加组，原来的附加组将会被覆盖；若保留原有，则要同时使用-a选项</span></span><br><span class="line">-a|--append GROUP               <span class="comment">#将用户追加至上边 -G 中提到的附加组中，并不从其它组中删除此用户</span></span><br><span class="line">-l|--login LOGIN                <span class="comment">#新的登录名称</span></span><br><span class="line">-L|--lock                       <span class="comment">#锁定用户帐号，在/etc/shadow 密码栏的增加 !</span></span><br><span class="line">-m|--move-home                  <span class="comment">#将家目录内容移至新位置，和 -d 一起使用</span></span><br><span class="line">-o|--non-unique                 <span class="comment">#允许使用重复的(非唯一的) UID</span></span><br><span class="line">-p|--password PASSWORD          <span class="comment">#修改密码，这里是明文，如果要在此处修改密码，则要用加密后的字符串</span></span><br><span class="line">-s|--shell SHELL                <span class="comment">#修改 shell</span></span><br><span class="line">-u|--uid UID                    <span class="comment">#修改 UID-U|--unlock</span></span><br><span class="line">-U|--unlock                     <span class="comment">#解锁用户帐号，将 /etc/shadow 密码栏的!拿掉</span></span><br></pre></td></tr></table></figure>

<p>修改用户信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># id tom</span></span><br><span class="line"> uid=1003(tom) gid=1003(tom) <span class="built_in">groups</span>=1003(tom)</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># usermod -c &quot;tom to jerry&quot; -l jerry tom</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id tom</span></span><br><span class="line"><span class="built_in">id</span>: ‘tom’: no such user</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id jerry</span></span><br><span class="line"> uid=1003(jerry) gid=1003(tom) <span class="built_in">groups</span>=1003(tom)</span><br></pre></td></tr></table></figure>

<p>锁定用户 </p>
<p>用户被锁定之后将无法登录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow jose</span></span><br><span class="line"> jose:$6$1gfAZcky1hjTfVX0<span class="variable">$dcImV6yr9xWzfcfeUI0zXH3p0t0OG71nzUcqD7MoLID8bzsoPKS60CuoGbWv</span>.e.qXzzXknAqTfTWvMlZzpp.i/:19158:0:99999:7:::</span><br><span class="line"> </span><br><span class="line">[root@rocky8 ~]<span class="comment"># usermod -L jose</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow jose</span></span><br><span class="line"> jose:!$6$1gfAZcky1hjTfVX0<span class="variable">$dcImV6yr9xWzfcfeUI0zXH3p0t0OG71nzUcqD7MoLID8bzsoPKS60CuoGbWv</span>.e.qXzzXknAqTfTWvMlZzpp.i/:19158:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>解锁用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># usermod -U jose</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow jose</span></span><br><span class="line"> jose:$6$1gfAZcky1hjTfVX0<span class="variable">$dcImV6yr9xWzfcfeUI0zXH3p0t0OG71nzUcqD7MoLID8bzsoPKS60CuoGbWv</span>.e.qXzzXknAqTfTWvMlZzpp.i/:19158:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>centos 允许空密码用户登录，所以两个 !!，无法用 -U 选项解锁</p>
<p>所谓解锁，只针对于有密码的用户来说，但是，可以直接修改/etc/shadow 文件，将密码栏置空产生空密码用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow jerry</span></span><br><span class="line"> jerry:!!:19168:0:99999:7:::</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># usermod -U jerry</span></span><br><span class="line"> usermod: unlocking the user<span class="string">&#x27;s password would result in a passwordless account.</span></span><br><span class="line"><span class="string"> You should set a password with usermod -p to unlock this user&#x27;</span>s password.</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow jerry</span></span><br><span class="line"> jerry:!!:19168:0:99999:7:::</span><br></pre></td></tr></table></figure>

<h2 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h2><p>userdel 可删除Linux 用户</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">userdel [options] LOGIN</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-f|--force      <span class="comment">#强制删除，哪怕用户正在登录状态</span></span><br><span class="line">-r|--remove     <span class="comment">#删除家目录和邮件目录</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建用户并设置密码</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd zhangsan</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># passwd zhangsan</span></span><br><span class="line"> Changing password <span class="keyword">for</span> user zhangsan.</span><br><span class="line"> New password: </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看相关数据</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id zhangsan</span></span><br><span class="line">uid=1027(zhangsan) gid=1027(zhangsan) <span class="built_in">groups</span>=1027(zhangsan)</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll -a /home/zhangsan/</span></span><br><span class="line">total 12</span><br><span class="line">drwx------. 2 zhangsan zhangsan  62 Aug 28 16:13 .</span><br><span class="line">drwxr-xr-x. 9 root     root      87 Aug 28 16:13 ..</span><br><span class="line">-rw-r--r--. 1 zhangsan zhangsan  18 Jul 27  2021 .bash_logout</span><br><span class="line">-rw-r--r--. 1 zhangsan zhangsan 141 Jul 27  2021 .bash_profile</span><br><span class="line">-rw-r--r--. 1 zhangsan zhangsan 376 Jul 27  2021 .bashrc</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /var/spool/mail/zhangsan </span></span><br><span class="line">-rw-rw----. 1 zhangsan mail 0 Aug 28 16:13 /var/spool/mail/zhangsan</span><br><span class="line"></span><br><span class="line"> <span class="comment">#在另一个终端登录zhangsan</span></span><br><span class="line">[zhangsan@rocky8 ~]$ <span class="built_in">whoami</span></span><br><span class="line"> zhangsan</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除登录中的用户失败</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># userdel zhangsan</span></span><br><span class="line">userdel: user zhangsan is currently used by process 3325</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id zhangsan</span></span><br><span class="line">uid=1027(zhangsan) gid=1027(zhangsan) <span class="built_in">groups</span>=1027(zhangsan)</span><br><span class="line"></span><br><span class="line"><span class="comment">#强制删除</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># userdel -f zhangsan</span></span><br><span class="line">userdel: user zhangsan is currently used by process 3325</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id zhangsan</span></span><br><span class="line"><span class="built_in">id</span>: ‘zhangsan’: no such user</span><br><span class="line"></span><br><span class="line"><span class="comment">#报错</span></span><br><span class="line">[zhangsan@rocky8 ~]$ <span class="built_in">whoami</span></span><br><span class="line"> <span class="built_in">whoami</span>: cannot find name <span class="keyword">for</span> user ID 1027</span><br></pre></td></tr></table></figure>

<p>用户被删除后，其名下的文件无法显示属主属组，只能显示UID</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ll -a /home/zhangsan/</span></span><br><span class="line">total 12</span><br><span class="line">drwx------. 2 1027 1027  62 Aug 28 16:13 .</span><br><span class="line">drwxr-xr-x. 9 root root  87 Aug 28 16:13 ..</span><br><span class="line">-rw-r--r--. 1 1027 1027  18 Jul 27  2021 .bash_logout</span><br><span class="line">-rw-r--r--. 1 1027 1027 141 Jul 27  2021 .bash_profile</span><br><span class="line">-rw-r--r--. 1 1027 1027 376 Jul 27  2021 .bashrc</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /var/spool/mail/zhangsan </span></span><br><span class="line">-rw-rw----. 1 1027 mail 0 Aug 28 16:13 /var/spool/mail/zhangsan</span><br></pre></td></tr></table></figure>

<p>如果新建用户，使用了原用户的UID，则可以继承原用户文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># useradd -u 1027 lisa</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /home/</span></span><br><span class="line">total 0</span><br><span class="line">drwx------. 2 lisa  lisa 62 Aug 28 16:19 lisa</span><br><span class="line">drwx------. 2 lisa  lisa 62 Aug 28 16:13 zhangsan</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /var/spool/mail/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-rw----. 1 lisa  mail 0 Aug 28 16:19 lisa</span><br><span class="line">-rw-rw----. 1 lisa  mail 0 Aug 28 16:13 zhangsan</span><br></pre></td></tr></table></figure>

<p>删除用户文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># userdel -rf lisa</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /home/lisa</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;/home/lisa&#x27;</span>: No such file or directory</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /var/spool/mail/lisa</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;/var/spool/mail/lisa&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>

<h2 id="查看用户相关的ID信息"><a href="#查看用户相关的ID信息" class="headerlink" title="查看用户相关的ID信息"></a>查看用户相关的ID信息</h2><p>id 命令可以查看用户的UID，GID等信息</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> [OPTION]... [USER]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-a              <span class="comment">#显示详细信息，默认选项</span></span><br><span class="line">-Z|--context    <span class="comment">#仅显示安全上下文信息，要开启selinux 配置才有</span></span><br><span class="line">-g|--group      <span class="comment">#仅显示GID，就是只显示主组ID</span></span><br><span class="line">-G|--<span class="built_in">groups</span>     <span class="comment">#显示主组和附加组ID，就是所有组ID</span></span><br><span class="line">-n|--name       <span class="comment">#显示用户名或组名，要组合使用 -nu|-ng|-nG</span></span><br><span class="line">-u|--user       <span class="comment">#仅显示UID</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id -a</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id -nu</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id postfix </span></span><br><span class="line">uid=89(postfix) gid=89(postfix) <span class="built_in">groups</span>=89(postfix),12(mail)</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id -G postfix </span></span><br><span class="line">89 12</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id -nG postfix </span></span><br><span class="line">postfix mail</span><br></pre></td></tr></table></figure>

<h2 id="切换用户或以其他用户身份执行命令"><a href="#切换用户或以其他用户身份执行命令" class="headerlink" title="切换用户或以其他用户身份执行命令"></a>切换用户或以其他用户身份执行命令</h2><p>如果在当前登录终端中，要执行某条命令，但当前登录用户又没有可执行权限或没有某些资源权限； </p>
<p>则在此种情况下，我们可以：</p>
<ol>
<li>让有权限的用户登录终端，再执行相应的操作；</li>
<li>在当前终端终，临时切换，以有权限的用户的身份去执行命令；</li>
</ol>
<p>su: 即 switch user，命令可以切换用户身份，并且以指定用户的身份执行命令</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">su [options...] [-] [user [args...]]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-m|-p|--preserve-environment    <span class="comment">#不重置环境变量</span></span><br><span class="line">-g|--group group                <span class="comment">#指定主组，只有root 切普通用户才能指定此参数</span></span><br><span class="line">-|-l|--login                    <span class="comment">#完全切换</span></span><br><span class="line">-c|--<span class="built_in">command</span> <span class="built_in">command</span>            <span class="comment">#不切换用户，而是临时使用该用户权限和环境执行命令</span></span><br><span class="line">--session-command <span class="built_in">command</span>       <span class="comment">#使用上同 -c 选项，但不会创建会话</span></span><br><span class="line">-f|--fast                       <span class="comment">#向shell 传递 -f 选项(csh 或 tcsh)</span></span><br><span class="line">-s|--shell shell                <span class="comment">#切换用户后，指定新环境的shell环境，必须在 /etc/shells 中存在</span></span><br><span class="line">-P|--pty                        <span class="comment">#开一个新的终端</span></span><br></pre></td></tr></table></figure>

<p>切换用户的方式： </p>
<ul>
<li>su UserName：非登录式切换，即不会读取目标用户的配置文件，不改变当前工作目录，即不完全切换 </li>
<li>su - UserName：登录式切换，会读取目标用户的配置文件，切换至自已的家目录，即完全切换 </li>
</ul>
<p>说明：root su至其他用户无须密码；非root用户切换时需要密码 </p>
<p>注意：su 切换新用户后，使用 exit 退回至旧的用户身份，而不要再用 su 切换至旧用户，否则会生成很多的bash子进程，环境可能会混乱。 </p>
<p>完全切换和不完全切换的区别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[jose@rocky8 ~]$ <span class="built_in">pwd</span></span><br><span class="line"> /home/jose</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/home/jose/.local/bin:/home/jose/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment">#不完全切换</span></span><br><span class="line">[jose@rocky8 ~]$ su root</span><br><span class="line"> Password: </span><br><span class="line"></span><br><span class="line">[root@rocky8 jose]<span class="comment"># pwd</span></span><br><span class="line"> /home/jose</span><br><span class="line"></span><br><span class="line">[root@rocky8 jose]<span class="comment"># echo $PATH</span></span><br><span class="line">/home/jose/.local/bin:/home/jose/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">pwd</span></span><br><span class="line"> /home/jose</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/home/jose/.local/bin:/home/jose/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment">#完全切换</span></span><br><span class="line">[jose@rocky8 ~]$ su - root</span><br><span class="line"> Password: </span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># pwd</span></span><br><span class="line"> /root</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo $PATH</span></span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>

<p>直接以另一个用户执行命令，而不切换用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># su - jose</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">touch</span> jose-1.txt</span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">exit</span></span><br><span class="line"> <span class="built_in">logout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#三步变一步</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># su - jose -c &quot;touch jose-2.txt&quot;</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /home/jose/jose*</span></span><br><span class="line">-rw-rw-r--. 1 jose jose 0 Jun 25 16:14 /home/jose/jose-1.txt-rw-rw-r--. 1 jose jose 0 Jun 25 16:16 /home/jose/jose-2.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># su - jose</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">id</span></span><br><span class="line"> uid=1000(jose) gid=1000(jose) <span class="built_in">groups</span>=1000(jose)</span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">exit</span></span><br><span class="line"> <span class="built_in">logout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#三步变一步</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># su - jose -c &quot;id&quot;</span></span><br><span class="line"> uid=1000(jose) gid=1000(jose) <span class="built_in">groups</span>=1000(jose)</span><br></pre></td></tr></table></figure>

<p>使用/sbin/nologin shell的用户无法切换，ubnutn 中 使用/bin/false shell的用户同样无法切换</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># getent passwd mysql </span></span><br><span class="line">mysql:x:336:336::/data/mysql:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># su - mysql</span></span><br><span class="line">This account is currently not available.</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># su - mysql -c &quot;echo nologin&quot;</span></span><br><span class="line">This account is currently not available.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#但可以指定可切换的Shell</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># su - mysql -s /bin/bash</span></span><br><span class="line"></span><br><span class="line">[mysql@rocky8 ~]$ <span class="built_in">id</span></span><br><span class="line">uid=336(mysql) gid=336(mysql) <span class="built_in">groups</span>=336(mysql)</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># su - mysql -s /bin/bash -c &quot;echo nologin&quot;</span></span><br><span class="line">nologin</span><br></pre></td></tr></table></figure>

<h2 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h2><p>passwd 可以修改用户密码</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">passwd [OPTION...] &lt;accountName&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-k|--keep-tokens            <span class="comment">#保持身份验证令牌不过期</span></span><br><span class="line">-d|--delete                 <span class="comment">#删除用户密码，也删除密码锁，仅root有权限操作</span></span><br><span class="line">-l|--lock                   <span class="comment">#锁定用户密码，仅root有权限操作</span></span><br><span class="line">-u|--unlock                 <span class="comment">#解锁用户密码，仅root有权限操作</span></span><br><span class="line">-e|--expire                 <span class="comment">#终止用户密码，此操作完成后，用户下次登录成功后要立马修改，仅root有权限操作</span></span><br><span class="line">-f|--force                  <span class="comment">#强制执行操作</span></span><br><span class="line">-x|--maximum=DAYS           <span class="comment">#指定用户密码最长有效期，仅root有权限操作</span></span><br><span class="line">-n|--minimum=DAYS           <span class="comment">#指定用户密码最短有效期，仅root有权限操作</span></span><br><span class="line">-w|--warning=DAYS           <span class="comment">#在密码过期前多少天开始提醒用户，仅root有权限操作</span></span><br><span class="line">-i|--inactive=DAYS          <span class="comment">#当密码过期后经过多少天该用户账号会被禁用，仅root有权限操作</span></span><br><span class="line">-S|--status                 <span class="comment">#查询用户的密码状态，仅root有权限操作</span></span><br><span class="line">--stdin                     <span class="comment">#从标准输入接收密码，Ubuntu无此选项</span></span><br></pre></td></tr></table></figure>

<p>普通用户修改自己密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[jose@rocky8 ~]$ passwd</span><br><span class="line"> Changing password <span class="keyword">for</span> user jose.</span><br><span class="line"> Current password: </span><br><span class="line">New password: </span><br><span class="line">Retype new password: </span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<p> root修改其它用户密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># passwd jose</span></span><br><span class="line"> Changing password <span class="keyword">for</span> user jose.</span><br><span class="line"> New password: </span><br><span class="line">Retype new password: </span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<p>修改密码其实就是更新 /etc/shadow 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@rocky8 ~]<span class="comment"># ll /etc/shadow</span></span><br><span class="line">----------. 1 root root 1475 Jun 25 17:16 /etc/shadow</span><br></pre></td></tr></table></figure>

<p>非交互式修改用户密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#适用于红帽系列的Linux版本</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &#x27;123456&#x27; | passwd --stdin jose</span></span><br><span class="line"> Changing password <span class="keyword">for</span> user jose.</span><br><span class="line"> passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># passwd --stdin jose &lt;&lt;&lt;123456</span></span><br><span class="line"> Changing password <span class="keyword">for</span> user jose.</span><br><span class="line"> passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Ubuntu中 passwd 无 --stdin 选项</span></span><br><span class="line"><span class="comment">#此写法在centos中也支持,更通用</span></span><br><span class="line">root@ubuntu20:~<span class="comment"># echo -e &#x27;123456\n123456&#x27; | passwd jose</span></span><br><span class="line"> New password: Retype new password: passwd: password updated successfully</span><br></pre></td></tr></table></figure>

<p>设置用户下次必须更改密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># passwd -e jose</span></span><br><span class="line"> Expiring password <span class="keyword">for</span> user jose.</span><br><span class="line"> passwd: Success</span><br><span class="line"> </span><br><span class="line"><span class="comment">#jose 用户登录后提示</span></span><br><span class="line">WARNING: Your password has expired.</span><br><span class="line"> You must change your password now and login again!</span><br><span class="line"> Changing password <span class="keyword">for</span> user jose.</span><br><span class="line"> Current password: </span><br></pre></td></tr></table></figure>

<h2 id="修改用户密码策略"><a href="#修改用户密码策略" class="headerlink" title="修改用户密码策略"></a>修改用户密码策略</h2><p>chage 可以修改用户密码策略</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">chage [options] LOGIN</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-d LAST_DAY                     <span class="comment">#更改密码的时间</span></span><br><span class="line">-m|--mindays MIN_DAYS</span><br><span class="line">-M|--maxdays MAX_DAYS</span><br><span class="line">-W|--warndays WARN_DAYS</span><br><span class="line">-I|--inactive INACTIVE          <span class="comment">#密码过期后的宽限期</span></span><br><span class="line">-E|--expiredate EXPIRE_DATE     <span class="comment">#用户的有效期</span></span><br><span class="line">-l                              <span class="comment">#显示密码策略</span></span><br></pre></td></tr></table></figure>

<p>查看用户密码策略</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># chage -l jose</span></span><br><span class="line">Last password change				: Aug 28, 2024</span><br><span class="line">Password expires					: never</span><br><span class="line">Password inactive					: never</span><br><span class="line">Account expires						: never</span><br><span class="line">Minimum number of days between password change		: 0</span><br><span class="line">Maximum number of days between password change		: 99999</span><br><span class="line">Number of days of warning before password expires	: 7</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># chage  jose</span></span><br><span class="line">Changing the aging information <span class="keyword">for</span> jose</span><br><span class="line">Enter the new value, or press ENTER <span class="keyword">for</span> the default</span><br><span class="line"></span><br><span class="line">	Minimum Password Age [0]: 3</span><br><span class="line">	Maximum Password Age [99999]: 42</span><br><span class="line">	Last Password Change (YYYY-MM-DD) [2024-08-28]: 2024-09-28</span><br><span class="line">	Password Expiration Warning [7]: 10</span><br><span class="line">	Password Inactive [-1]: 20</span><br><span class="line">	Account Expiration Date (YYYY-MM-DD) [-1]: 2025-09-28</span><br><span class="line">	</span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow jose</span></span><br><span class="line">jose:$6<span class="variable">$MTmNRV3dYLAyImT</span>/<span class="variable">$BmrAmj7CPB0UoGaT9Yx0EnRp7524hu92Z3fct19Ok1F1EPJTxrXYzTQ7jezSX3LeEIuIiysy7VxaNpXJ7Rp0I0</span>:19994:3:42:10:20:20359:</span><br><span class="line"></span><br><span class="line"> <span class="comment">#只修改单项</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow jose</span></span><br><span class="line">jose:$6<span class="variable">$MTmNRV3dYLAyImT</span>/<span class="variable">$BmrAmj7CPB0UoGaT9Yx0EnRp7524hu92Z3fct19Ok1F1EPJTxrXYzTQ7jezSX3LeEIuIiysy7VxaNpXJ7Rp0I0</span>:20021:3:42:10:20:20359:</span><br></pre></td></tr></table></figure>

<p>密码文件中各时间字段的表示：</p>
<p><img src="../../../../images/SRE/day04/3.png" alt="3"></p>
<h2 id="创建组"><a href="#创建组" class="headerlink" title="创建组"></a>创建组</h2><p>groupadd实现创建组</p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">groupadd [options] GROUP</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-f|--force              <span class="comment">#如果组已经存在则成功退出</span></span><br><span class="line">-g|--gid GID            <span class="comment">#新建组时指定组ID，默认是系统分配，指定值不要超过[GID_MIN，GID_MAX]</span></span><br><span class="line">-K|--key KEY=VALUE      <span class="comment">#不使用 /etc/login.defs 中的默认值，自己指定，比如 -K GID_MIN=100</span></span><br><span class="line">-o|--non-unique         <span class="comment">#允许创建有重复 GID 的组</span></span><br><span class="line">-p|--password PASSWORD  <span class="comment">#为新组使用此加密过的密码，这里要用加密后的密文，不然就是直接是明文在/etc/gshadow 里面</span></span><br><span class="line">-r|--system             <span class="comment">#创建一个系统组 CentOS 6之前: ID&lt;500，CentOS 7以后: ID&lt;1000</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># groupadd -g 48 -r apache</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent group apache</span></span><br><span class="line"> apache:x:48:</span><br><span class="line"></span><br><span class="line"><span class="comment">#不加 -f 会提示己存在</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupadd apache</span></span><br><span class="line"> groupadd: group <span class="string">&#x27;apache&#x27;</span> already exists</span><br><span class="line"></span><br><span class="line"><span class="comment"># -f 直接结束</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupadd -f apache</span></span><br></pre></td></tr></table></figure>

<h2 id="修改组"><a href="#修改组" class="headerlink" title="修改组"></a>修改组</h2><p>groupmod 组属性修改</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">groupmod [options] GROUP</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-g|--gid GID                <span class="comment">#将组 ID 改为 GID</span></span><br><span class="line">-n|--new-name NEW_GROUP     <span class="comment">#改名为 NEW_GROUP</span></span><br><span class="line">-o|--non-unique             <span class="comment">#允许使用重复的 GID-p|--password PASSWORD</span></span><br><span class="line">-p|--password PASSWORD      <span class="comment">#将密码更改为(加密过的) PASSWORD</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># getent group apache</span></span><br><span class="line"> apache:x:48:</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmod -g 123 apache</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent group apache</span></span><br><span class="line"> apache:x:123:</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmod -n apache2 apache</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent group apache2</span></span><br><span class="line"> apache2:x:123:</span><br></pre></td></tr></table></figure>

<h2 id="组删除"><a href="#组删除" class="headerlink" title="组删除"></a>组删除</h2><p>groupdel 可以删除组</p>
<p>格式:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupdel [options] GROUP</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-f|--force	<span class="comment">#强制删除，即使是用户的主组也强制删除组,但会导致无主组的用户不可用无法登录</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># groupdel apache2</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent group apache2</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupdel jose</span></span><br><span class="line"> groupdel: cannot remove the primary group of user <span class="string">&#x27;jose&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-f 强制删除有用户的组</span></span><br><span class="line"><span class="comment">#强制删除之后，显示该组名的地方，只能显示该组ID，如果此时新建与组ID相同的新组，则被删除的组的数据会被新组关联</span></span><br><span class="line"></span><br><span class="line">groupdel -f jose</span><br></pre></td></tr></table></figure>

<h2 id="更改组成员和密码"><a href="#更改组成员和密码" class="headerlink" title="更改组成员和密码"></a>更改组成员和密码</h2><p>gpasswd命令，可以更改组密码，也可以修改附加组的成员关系 </p>
<p>组没有密码的情况下，加组只能由root来操作</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gpasswd [option] GROUP</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-a|--add USER                   <span class="comment">#向组中添加用户</span></span><br><span class="line">-d|--delete USER                <span class="comment">#从组中移除用户</span></span><br><span class="line">-r|--delete-password            <span class="comment">#删除组密码</span></span><br><span class="line">-R|--restrict                   <span class="comment">#向其成员限制访问组 GROUP</span></span><br><span class="line">-M|--members USER,...           <span class="comment">#批量加组</span></span><br><span class="line">-A|--administrators ADMIN,...   <span class="comment">#批量设组管理员</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># groupadd group1</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent gshadow group1</span></span><br><span class="line"> group1:!::</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groups jose</span></span><br><span class="line"> jose : jose</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id jose</span></span><br><span class="line"> uid=1000(jose) gid=1000(jose) <span class="built_in">groups</span>=1000(jose)</span><br><span class="line"></span><br><span class="line"><span class="comment">#加组</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># gpasswd -a jose group1</span></span><br><span class="line"> Adding user jose to group group1</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent gshadow group1</span></span><br><span class="line"> group1:!::jose</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groups jose</span></span><br><span class="line"> jose : jose group1</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id jose</span></span><br><span class="line"> uid=1000(jose) gid=1000(jose) <span class="built_in">groups</span>=1000(jose),1004(group1)</span><br></pre></td></tr></table></figure>

<p>范例:设置组密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># gpasswd group1</span></span><br><span class="line"> Changing the password <span class="keyword">for</span> group group1</span><br><span class="line"> New Password: </span><br><span class="line"> Re-enter new password: </span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent gshadow group1</span></span><br><span class="line"> group1:$6$rzTQ3ausQlnwJ7<span class="variable">$keMsE9m3u</span>.GeBfrOoEsFUty6hRxJbzOC4s88aE/5MTGjpvyjtYljM8tf59AvrKdbNKLL.bdcU.i/KAhXN8CbZ.::jose</span><br></pre></td></tr></table></figure>

<p>范例：移除组成员</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># gpasswd -d jose group1</span></span><br><span class="line"> Removing user jose from group group1</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groups jose</span></span><br><span class="line"> jose : jose</span><br></pre></td></tr></table></figure>

<h2 id="更改和查看组成员"><a href="#更改和查看组成员" class="headerlink" title="更改和查看组成员"></a>更改和查看组成员</h2><p>groupmems 可以管理附加组的成员关系</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">groupmems [options] [action]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-g|--group groupname    <span class="comment">#更改为指定组 (只有root)</span></span><br><span class="line">-a|--add username       <span class="comment">#指定用户加入组</span></span><br><span class="line">-d|--delete username    <span class="comment">#从组中删除用户</span></span><br><span class="line">-p|--purge              <span class="comment">#从组中清除所有成员</span></span><br><span class="line">-l|--list               <span class="comment">#显示组成员列表</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出以group1 组为附加组的用户</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g group1 -l</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">##将jose 加到group1 组</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g group1 -a jose</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g group1 -l</span></span><br><span class="line"> jose </span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># id jose</span></span><br><span class="line"> uid=1000(jose) gid=1000(jose) <span class="built_in">groups</span>=1000(jose),1004(group1)</span><br></pre></td></tr></table></figure>

<p>groups 可查看用户组关系</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看用户所属组列表</span></span><br><span class="line"><span class="built_in">groups</span> [OPTION].[USERNAME]... </span><br></pre></td></tr></table></figure>

<p>临时切换组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#newgrp [-] [group]</span></span><br><span class="line"><span class="comment">#临时切换用户组，这里就要用到上面 gpasswd 给组设置的密码</span></span><br><span class="line"><span class="comment">#普通用户切组需要密码，root用户切组不需要密码</span></span><br><span class="line"></span><br><span class="line">newprp mage</span><br><span class="line"><span class="comment">#切换之后创建的文件属组就是mage</span></span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><ol>
<li>创建用户 gentoo，附加组为 bin 和 root，默认shell为/bin/csh，注释信息为”Gentoo Distribution” </li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># useradd -c &quot;Gentoo Distribution&quot; -s /bin/csh gentoo</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g bin -a gentoo</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g root -a gentoo</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent passwd gentoo </span></span><br><span class="line"> gentoo:x:1027:1028:Gentoo Distribution:/home/gentoo:/bin/csh</span><br><span class="line">[root@rocky8 ~]<span class="comment"># groups gentoo</span></span><br><span class="line"> gentoo : gentoo bin root</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>创建下面的用户、组和组成员关系</p>
<p>名字为webs 的组</p>
<p>用户nginx，使用webs 作为附加组</p>
<p>用户varnish，使用webs 作为附加组</p>
<p>用户mysql，不可交互登录系统，且不是webs 的成员，</p>
<p>nginx，varnish，mysql密码都是magedu</p>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># groupadd webs</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd nginx -pmagedu</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd varnish -pmagedu</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># useradd mysql -r  -pmagedu</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g webs -a nginx</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g webs -a varnish </span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groupmems -g webs -a mysql </span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># groups &#123;nginx,varnish,mysql&#125;</span></span><br><span class="line"> nginx : nginx webs</span><br><span class="line"> varnish : varnish webs</span><br><span class="line"> mysql : mysql webs</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow nginx</span></span><br><span class="line">nginx:magedu:19964:0:99999:7:::</span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow varnish</span></span><br><span class="line">varnish:magedu:19964:0:99999:7:::</span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow mysql</span></span><br><span class="line">mysql:magedu:19964::::::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># for i in &#123;nginx,varnish,mysql&#125;;do echo $i:magedu|chpasswd;done</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow nginx</span></span><br><span class="line">nginx:$6<span class="variable">$fdJmB3</span>/eHJtA9K<span class="variable">$njLiITa6Q</span>.KSGRXXXKeU3Dt1sxPeNTgmbRoP21PBUu/w2zSN/GfRFYsOXuuKPNUxijWpgvF5VADgfQh9ytUGo.:19964:0:99999:7:::</span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow varnish</span></span><br><span class="line">varnish:$6<span class="variable">$Vp0OM7Q</span>/Zp/jhqi<span class="variable">$ltPfhm4C8Dw</span>.UYCF/KlaCZfSoVAQ0O9yApyh.8vuJdGtC9nQltQl2RCBDZbQ/Lve6oJy5GPL1CKvCprPDfzr6/:19964:0:99999:7:::</span><br><span class="line">[root@rocky8 ~]<span class="comment"># getent shadow mysql</span></span><br><span class="line">mysql:$6<span class="variable">$xPotg</span>/k5<span class="variable">$MsNdG4ZR4u</span>/Drekp4GPFy/SmgG8HedQfPxa1mhC98hnk1mDHLi9SRaq5pHsshPkucseces2CdJKloON2btIDt0:19964::::::</span><br></pre></td></tr></table></figure>

<h1 id="文件权限管理"><a href="#文件权限管理" class="headerlink" title="文件权限管理"></a>文件权限管理</h1><h2 id="Linux中的权限体系介绍"><a href="#Linux中的权限体系介绍" class="headerlink" title="Linux中的权限体系介绍"></a>Linux中的权限体系介绍</h2><p>在Linux系统中，一切皆文件；</p>
<p>对文件来讲，系统中的用户，分属于三类不同的角色，分别是属主，属组，其它用户；</p>
<p>而每个角色用户，对该文件的权限，也分三种，分别是读，写，执行；</p>
<p><img src="../../../../images/SRE/day04/4.png" alt="4"></p>
<p>三种角色：</p>
<table>
<thead>
<tr>
<th>角色</th>
<th>英文表示</th>
<th>字符表示</th>
</tr>
</thead>
<tbody><tr>
<td>属主：所有者</td>
<td>owner|OWNER|user</td>
<td>u</td>
</tr>
<tr>
<td>属组：属于哪个组</td>
<td>group|GROUP</td>
<td>g</td>
</tr>
<tr>
<td>其他用户：不是所有者，<br />也不再属组中的用户</td>
<td>other|OTHER</td>
<td>o</td>
</tr>
</tbody></table>
<p>三种权限：</p>
<table>
<thead>
<tr>
<th>权限</th>
<th>英文表示</th>
<th>字符表示</th>
<th>八进制表示</th>
</tr>
</thead>
<tbody><tr>
<td>读权限</td>
<td>read|Readable</td>
<td>r</td>
<td>4</td>
</tr>
<tr>
<td>写权限</td>
<td>write|Writable</td>
<td>w</td>
<td>2</td>
</tr>
<tr>
<td>执行权限</td>
<td>execute|eXcutable</td>
<td>x</td>
<td>1</td>
</tr>
</tbody></table>
<p>程序访问文件时的权限，取决于此程序的发起者</p>
<ul>
<li>进程的发起者，同文件的属主：则应用文件属主权限</li>
<li>进程的发起者，属于文件属组；则应用文件属组权限</li>
<li>应用文件“其它”权限</li>
</ul>
<p><img src="../../../../images/SRE/day04/5.png" alt="5"></p>
<h2 id="文件所有者和属组属性操作"><a href="#文件所有者和属组属性操作" class="headerlink" title="文件所有者和属组属性操作"></a>文件所有者和属组属性操作</h2><h3 id="设置文件的所有者chown"><a href="#设置文件的所有者chown" class="headerlink" title="设置文件的所有者chown"></a>设置文件的所有者chown</h3><p>chown 命令可以修改文件的属主，也可以修改文件属组</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> [OPTION]... [OWNER][:[GROUP]] FILE...</span><br><span class="line"><span class="built_in">chown</span> [OPTION]... --reference=RFILE FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">#用法说明</span></span><br><span class="line">OWNER           <span class="comment">#只修改所有者</span></span><br><span class="line">OWNER:GROUP     <span class="comment">#同时修改所有者和属组</span></span><br><span class="line">:GROUP          <span class="comment">#只修改属组，冒号也可用 . 替换</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-c|--changes            <span class="comment">#同-v选项，但只显示更新成功的信息</span></span><br><span class="line">-f|--silent|--quiet     <span class="comment">#不显示错误信息</span></span><br><span class="line">-v|--verbose            <span class="comment">#显示过程</span></span><br><span class="line">--dereference           <span class="comment">#修改的是符号链接指向的文件，而不是链接文件本身</span></span><br><span class="line">-h|--no-dereference     <span class="comment">#修改的是符号链接文件，而不是其指向的目标文件(只有当前系统支持修改符号链接文件属性时，此项才有效)</span></span><br><span class="line">--from=user:group       <span class="comment">#根据原属主属组来修改，相当于一个查询条件</span></span><br><span class="line">--no-preserve-root      <span class="comment">#不特别对待“/”，意思就是将根目录当成普通目录来执行，默认如此，所以不要对根目录进行操作</span></span><br><span class="line">--preserve-root         <span class="comment">#不允许在&quot;/&quot;上递归操作</span></span><br><span class="line">--reference=RFILE       <span class="comment">#根据其它文件权限来操作，就是复制该文件的属主属组信息给指定文件</span></span><br><span class="line">-R|--recursive          <span class="comment">#递归操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#下列选项配合 -R 使用</span></span><br><span class="line">-H              <span class="comment">#如果参数是指向目录的软链接，则只修改指向的目录，不改变目录里面文件的属主属组</span></span><br><span class="line">-L              <span class="comment">#更改所有遇到的符号链接指向的目录</span></span><br><span class="line">-P              <span class="comment">#不更改符号链接指向的目录</span></span><br></pre></td></tr></table></figure>

<p>范例：修改属主</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 0626]<span class="comment"># ll</span></span><br><span class="line"> total 0</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a1.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a2.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a3.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a4.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a5.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a6.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a7.txt</span><br><span class="line"> </span><br><span class="line"><span class="comment">#修改属主</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown jose a1.txt       #只修改属主</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown jose. a2.txt      #同时修改属主和属组</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown jose: a3.txt      #同时修改属主和属组</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll a1.txt a2.txt a3.txt</span></span><br><span class="line"> -rw-r--r--. 1 jose root 0 Jun 26 10:34 a1.txt</span><br><span class="line"> -rw-r--r--. 1 jose jose 0 Jun 26 10:34 a2.txt</span><br><span class="line"> -rw-r--r--. 1 jose jose 0 Jun 26 10:34 a3.txt</span><br><span class="line"> </span><br><span class="line"><span class="comment">#上述写法，使用的组，是属主用户的主组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用UID来修改属主,UID不支持省略写法</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown 1000 a4.txt</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown 1000. a5.txt</span></span><br><span class="line"> <span class="built_in">chown</span>: invalid user: ‘1000.’</span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown 1000: a6.txt</span></span><br><span class="line"> <span class="built_in">chown</span>: invalid spec: ‘1000:’</span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll a4.txt a5.txt a6.txt</span></span><br><span class="line"> -rw-r--r--. 1 jose root 0 Jun 26 10:34 a4.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a5.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:34 a6.txt</span><br></pre></td></tr></table></figure>

<p>范例：修改属组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 0626]<span class="comment"># touch b&#123;1..6&#125;.txt</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll b*</span></span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:40 b1.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:40 b2.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:40 b3.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:40 b4.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:40 b5.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:40 b6.txt</span><br><span class="line"> </span><br><span class="line"><span class="comment">#以组名修改</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown .jose b1.txt</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown :jose b2.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll b1.txt b2.txt</span></span><br><span class="line"> -rw-r--r--. 1 root jose 0 Jun 26 10:40 b1.txt</span><br><span class="line"> -rw-r--r--. 1 root jose 0 Jun 26 10:40 b2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#以GID修改</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown .1000 b4.txt</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown :1000 b5.txt</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown .789 b6.txt</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll b4.txt b5.txt b6.txt</span></span><br><span class="line"> -rw-r--r--. 1 root jose 0 Jun 26 10:40 b4.txt</span><br><span class="line"> -rw-r--r--. 1 root jose 0 Jun 26 10:40 b5.txt</span><br><span class="line"> -rw-r--r--. 1 root  789 0 Jun 26 10:40 b6.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 b]<span class="comment"># groupadd -g 789 test</span></span><br><span class="line">[root@rocky8 b]<span class="comment"># ll b6.txt</span></span><br><span class="line"> -rw-r--r--. 1 root <span class="built_in">test</span> 0 Aug 29 16:48 b6.txt</span><br></pre></td></tr></table></figure>

<p>范例：同时修改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 0626]<span class="comment"># ll c*</span></span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:46 c1.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:46 c2.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:46 c3.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:46 c4.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 10:46 c5.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown jose:tom c1.txt </span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown jose.123 c2.txt</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown jose:nogroup c3.txt    #组不存在会报错</span></span><br><span class="line"><span class="built_in">chown</span>: invalid group: ‘jose:nogroup’</span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown 1003.jose c4.txt</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown 123:456 c5.txt</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll c*</span></span><br><span class="line"> -rw-r--r--. 1 jose  tom  0 Jun 26 10:58 c1.txt</span><br><span class="line"> -rw-r--r--. 1 jose  123  0 Jun 26 10:58 c2.txt</span><br><span class="line"> -rw-r--r--. 1 root  root 0 Jun 26 10:58 c3.txt</span><br><span class="line"> -rw-r--r--. 1 jerry jose 0 Jun 26 10:58 c4.txt</span><br><span class="line"> -rw-r--r--. 1 123   456  0 Jun 26 10:58 c5.tx</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 0626]<span class="comment"># ll f*</span></span><br><span class="line"> -rw-r--r--. 1  123  456 0 Jun 26 11:02 f1.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 11:02 f2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据文件修改</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chown --reference=f1.txt f2.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll f*</span></span><br><span class="line"> -rw-r--r--. 1  123  456 0 Jun 26 11:02 f1.txt</span><br><span class="line"> -rw-r--r--. 1  123  456 0 Jun 26 11:02 f2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#递归写法</span></span><br><span class="line"><span class="built_in">chown</span> -R jose.tom dir1/</span><br></pre></td></tr></table></figure>

<h3 id="设置文件的属组信息chgrp"><a href="#设置文件的属组信息chgrp" class="headerlink" title="设置文件的属组信息chgrp"></a>设置文件的属组信息chgrp</h3><p>chgrp 命令可以只修改文件的属组</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">chgrp</span> [OPTION]... GROUP FILE...</span><br><span class="line"> <span class="built_in">chgrp</span> [OPTION]... --reference=RFILE FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-c|--changes            <span class="comment">#同-v选项，但只显示更新成功的信息</span></span><br><span class="line">-f|--silent|--quiet     <span class="comment">#不显示错误信息</span></span><br><span class="line">-v|--verbose            <span class="comment">#显示过程</span></span><br><span class="line">--dereference           <span class="comment">#修改的是符号链接指向的文件，而不是链接文件本身</span></span><br><span class="line">-h|--no-dereference     <span class="comment">#修改的是符号链接文件，而不是其指向的目标文件(只有当前系统支持修改符号链接文件属性时，此项才有效)</span></span><br><span class="line">--no-preserve-root      <span class="comment">#不特别对待“/”，意思就是将家目录当成普通目录来执行，默认如此，所以不要对根目录进行操作</span></span><br><span class="line">--preserve-root         <span class="comment">#不允许在&quot;/&quot;上递归操作</span></span><br><span class="line">--reference=RFILE       <span class="comment">#根据其它文件权限来操作，就是复制该文件的属主属组信息给指定文件</span></span><br><span class="line">-R|--recursive          <span class="comment">#递归操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#下列选项配合 -R 使用</span></span><br><span class="line">-H          <span class="comment">#如果参数是指向目录的软链接，则只修改指向的目录，不改变目录里面文件的属主属组</span></span><br><span class="line">-L          <span class="comment">#更改所有遇到的符号链接指向的目录</span></span><br><span class="line">-P          <span class="comment">#不更改符号链接指向的目录</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 0626]<span class="comment"># ll</span></span><br><span class="line"> total 0</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 11:14 f1.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 11:14 f2.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 11:14 f3.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chgrp jose f1.txt </span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chgrp 123 f2.txt</span></span><br><span class="line"> </span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll</span></span><br><span class="line"> total 0</span><br><span class="line"> -rw-r--r--. 1 root jose 0 Jun 26 11:14 f1.txt</span><br><span class="line"> -rw-r--r--. 1 root  123 0 Jun 26 11:14 f2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#将 dir1 及其目录内的所有文件属组都改为 mage</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chgrp mage -R dir1/     </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll</span></span><br><span class="line"> total 0</span><br><span class="line"> -rw-r--r--. 1 root root 0 Jun 26 11:17 a</span><br><span class="line"> lrwxrwxrwx. 1 root root 1 Jun 26 11:17 a.link -&gt; a</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#修改a.link 指向的文件的属主属组</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chgrp mage --dereference a.link  </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll</span></span><br><span class="line"> total 0</span><br><span class="line"> -rw-r--r--. 1 root mage 0 Jun 26 11:17 a</span><br><span class="line"> lrwxrwxrwx. 1 root root 1 Jun 26 11:17 a.link -&gt; a</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改a.link 本身的属主属组</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chgrp 123 --no-dereference a.link   </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 0626]<span class="comment"># ll</span></span><br><span class="line"> total 0</span><br><span class="line"> -rw-r--r--. 1 root mage 0 Jun 26 11:17 a</span><br><span class="line"> lrwxrwxrwx. 1 root  123 1 Jun 26 11:17 a.link -&gt; a</span><br></pre></td></tr></table></figure>

<h2 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h2><h3 id="文件权限说明"><a href="#文件权限说明" class="headerlink" title="文件权限说明"></a>文件权限说明</h3><p><strong>角色定义</strong></p>
<table>
<thead>
<tr>
<th>角色</th>
<th>在命令中的字符</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>owner</td>
<td>u</td>
<td>属主</td>
</tr>
<tr>
<td>group</td>
<td>g</td>
<td>属组</td>
</tr>
<tr>
<td>other</td>
<td>o</td>
<td>其他用户</td>
</tr>
<tr>
<td>all</td>
<td>a</td>
<td>所有人，包括属主属组和其他用户</td>
</tr>
</tbody></table>
<p><strong>赋值写法</strong></p>
<table>
<thead>
<tr>
<th>在命令中的字符</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>增加某些权限</td>
</tr>
<tr>
<td>-</td>
<td>删除某些权限</td>
</tr>
<tr>
<td>=</td>
<td>只保留某些权限，覆盖写法</td>
</tr>
</tbody></table>
<p><strong>权限表示方法</strong></p>
<table>
<thead>
<tr>
<th>权限</th>
<th>在命令中的字符</th>
<th>八进制数字表示</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>Readable</td>
<td>r</td>
<td>4</td>
<td>读权限</td>
</tr>
<tr>
<td>Writable</td>
<td>w</td>
<td>2</td>
<td>写权限</td>
</tr>
<tr>
<td>eXcutable</td>
<td>x</td>
<td>1</td>
<td>执行权限</td>
</tr>
</tbody></table>
<p><strong>常用写法</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">u+r         <span class="comment">#属主加读权限</span></span><br><span class="line">g-x         <span class="comment">#属组去掉执行权限</span></span><br><span class="line">ug=rx       <span class="comment">#属主属组权限改为读和执行</span></span><br><span class="line">o=          <span class="comment">#other用户无任何权限 </span></span><br><span class="line">a=rwx       <span class="comment">#所有用户都有读写执行权限</span></span><br></pre></td></tr></table></figure>

<p>注意： </p>
<ul>
<li>用户的最终权限，是从左向右进行顺序匹配，即，所有者，所属组，其他人，一旦匹配权限立即生效，不再向右查看其权限</li>
<li>r和w权限对root 用户无效，对没有读写权限的文件，root用户也可读可写</li>
<li>只要所有者，所属组或other三者之一有x权限，root就可以执行</li>
</ul>
<p><strong>权限作用</strong></p>
<table>
<thead>
<tr>
<th>权限</th>
<th>对文件</th>
<th>对目录</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>可查看文件内容</td>
<td>可读取目录中的文件名，但文件元数据无法查看</td>
</tr>
<tr>
<td>w</td>
<td>可修改文件内容</td>
<td>可在目录中创建文件和删除文件</td>
</tr>
<tr>
<td>x</td>
<td>可执行，发起为一个进程</td>
<td>可进入目录，查看文件元数据，<br />可查看文件内容，属于目录最小权限</td>
</tr>
</tbody></table>
<p>面试题：</p>
<p>Linux中的目录和文件的权限区别？分别说明读，写和执行权限的区别</p>
<p><strong>数学法的权限</strong></p>
<p><img src="../../../../images/SRE/day04/6.png" alt="6"></p>
<table>
<thead>
<tr>
<th>字符表示</th>
<th>二进制表示</th>
<th>八进制表示</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>—</td>
<td>000</td>
<td>0</td>
<td>无任何权限</td>
</tr>
<tr>
<td>–x</td>
<td>001</td>
<td>1</td>
<td>可执行</td>
</tr>
<tr>
<td>-w-</td>
<td>010</td>
<td>2</td>
<td>可写</td>
</tr>
<tr>
<td>-wx</td>
<td>011</td>
<td>3</td>
<td>可写可执行</td>
</tr>
<tr>
<td>r–</td>
<td>100</td>
<td>4</td>
<td>可读</td>
</tr>
<tr>
<td>r-x</td>
<td>101</td>
<td>5</td>
<td>可读可执行</td>
</tr>
<tr>
<td>rw-</td>
<td>110</td>
<td>6</td>
<td>可读可写</td>
</tr>
<tr>
<td>rwx</td>
<td>111</td>
<td>7</td>
<td>可读可写可执行</td>
</tr>
</tbody></table>
<p>示例：</p>
<table>
<thead>
<tr>
<th>字符表示</th>
<th>八进制数字表示</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>rw-r—–</td>
<td>640</td>
<td>属主可读写，属组可读，其他用户无任何权限</td>
</tr>
<tr>
<td>rw-r–r–</td>
<td>644</td>
<td>属主可读写，属组可读，其他用户可读</td>
</tr>
<tr>
<td>rwxr-xr-x</td>
<td>755</td>
<td>属主可读写，可执行，属组可读可执行，其他用户可读可执行</td>
</tr>
</tbody></table>
<h3 id="修改文件权限chmod"><a href="#修改文件权限chmod" class="headerlink" title="修改文件权限chmod"></a>修改文件权限chmod</h3><p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> [OPTION]... MODE[,MODE]... FILE...</span><br><span class="line"><span class="built_in">chmod</span> [OPTION]... OCTAL-MODE FILE...</span><br><span class="line"><span class="built_in">chmod</span> [OPTION]... --reference=RFILE FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-c|--changes            <span class="comment">#同-v选项，但只显示更新成功的信息</span></span><br><span class="line">-f|--silent|--quiet     <span class="comment">#不显示错误信息</span></span><br><span class="line">-v|--verbose            <span class="comment">#显示过程</span></span><br><span class="line">--no-preserve-root      <span class="comment">#不特别对待“/”，意思就是将家目录当成普通目录来执行，默认如此，所以不要对根目录进行操作</span></span><br><span class="line">--preserve-root         <span class="comment">#不允许在&quot;/&quot;上递归操作</span></span><br><span class="line">--reference=RFILE       <span class="comment">#根据其它文件权限来操作,就是复制该文件的权限信息给指定文件</span></span><br><span class="line">-R|--recursive          <span class="comment">#递归操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#MODE</span></span><br><span class="line"> <span class="built_in">who</span> opt permisson</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">who</span>                    <span class="comment">#  u|g|o|a</span></span><br><span class="line"> opt                    <span class="comment">#  +|-|=</span></span><br><span class="line"> permission             <span class="comment">#  r|w|x</span></span><br></pre></td></tr></table></figure>

<p>范例：修改权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 t]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:20 f1</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:20 f2</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:20 f3</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:20 f4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 t]<span class="comment"># chmod a= f1</span></span><br><span class="line">[root@rocky8 t]<span class="comment"># chmod u=r,g=w,o=x f2</span></span><br><span class="line">[root@rocky8 t]<span class="comment"># chmod u+w,g-x,o-r f3</span></span><br><span class="line">[root@rocky8 t]<span class="comment"># chmod a=rwx f4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 t]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">----------. 1 root root 0 Aug 30 17:20 f1</span><br><span class="line">-r---w---x. 1 root root 0 Aug 30 17:20 f2</span><br><span class="line">-rw-r-----. 1 root root 0 Aug 30 17:20 f3</span><br><span class="line">-rwxrwxrwx. 1 root root 0 Aug 30 17:20 f4</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 t]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:23 a1</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:23 a2</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:23 a3</span><br><span class="line"></span><br><span class="line">[root@rocky8 t]<span class="comment"># chmod 644 a1</span></span><br><span class="line">[root@rocky8 t]<span class="comment"># chmod 0 a2</span></span><br><span class="line">[root@rocky8 t]<span class="comment"># chmod 777 a3</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 t]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Aug 30 17:23 a1</span><br><span class="line">----------. 1 root root 0 Aug 30 17:23 a2</span><br><span class="line">-rwxrwxrwx. 1 root root 0 Aug 30 17:23 a3</span><br></pre></td></tr></table></figure>

<p>范例：错误写法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 t]<span class="comment"># chmod u+4 a1</span></span><br><span class="line"><span class="built_in">chmod</span>: invalid mode: ‘u+4’</span><br><span class="line">Try <span class="string">&#x27;chmod --help&#x27;</span> <span class="keyword">for</span> more information.</span><br></pre></td></tr></table></figure>

<p>范例：递归操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 0626]<span class="comment"># chmod o+rwx -R dir1/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#大写X,只会给子目录加x权限</span></span><br><span class="line">[root@rocky8 0626]<span class="comment"># chmod o+X -R dir1/</span></span><br></pre></td></tr></table></figure>

<p>范例：目录权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[jose@rocky8 ~]$ ll -d dir1/</span><br><span class="line"> drwxrwxr-x. 2 jose jose 24 Aug 30 17:37 dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ ll dir1/</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 jose jose 0 Aug 30 17:37 a</span><br><span class="line">-rw-rw-r--. 1 jose jose 0 Aug 30 17:37 b</span><br><span class="line"></span><br><span class="line"><span class="comment">#去掉目录所有权限</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">chmod</span> a= dir1/</span><br><span class="line">[jose@rocky8 ~]$ ll -d dir1/</span><br><span class="line"> d---------. 2 jose jose 24 Aug 30 17:37 dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">ls</span> dir1/</span><br><span class="line"><span class="built_in">ls</span>: cannot open directory <span class="string">&#x27;dir1/&#x27;</span>: Permission denied</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">stat</span> dir1/a</span><br><span class="line"><span class="built_in">stat</span>: cannot statx <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">rm</span> dir1/a</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#+r权限</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">chmod</span> u+r dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">ls</span> dir1/</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;dir1/b&#x27;</span>: Permission denied</span><br><span class="line">a  b</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">stat</span> dir1/a</span><br><span class="line"><span class="built_in">stat</span>: cannot statx <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">rm</span> dir1/a</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">cd</span> dir1/</span><br><span class="line">-bash: <span class="built_in">cd</span>: dir1/: Permission denied</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#+w权限</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">chmod</span> u+w dir1/</span><br><span class="line">[jose@rocky8 ~]$ ll -d dir1/</span><br><span class="line"> drw-------. 2 jose jose 24 Aug 30 17:37 dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">ls</span> dir1/</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;dir1/b&#x27;</span>: Permission denied</span><br><span class="line">a  b</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ ll dir1/</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;dir1/b&#x27;</span>: Permission denied</span><br><span class="line">total 0</span><br><span class="line">-????????? ? ? ? ?            ? a</span><br><span class="line">-????????? ? ? ? ?            ? b</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">cd</span> dir1/</span><br><span class="line">-bash: <span class="built_in">cd</span>: dir1/: Permission denied</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">rm</span> dir1/a</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;dir1/a&#x27;</span>: Permission denied</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">touch</span> dir1/c</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> <span class="string">&#x27;dir1/c&#x27;</span>: Permission denied</span><br><span class="line"></span><br><span class="line"> <span class="comment">#+x权限</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">chmod</span> u+x dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ ll -d dir1/</span><br><span class="line">drwx------. 2 jose jose 24 Aug 30 17:37 dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ ll dir1/</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 jose jose 0 Aug 30 17:37 a</span><br><span class="line">-rw-rw-r--. 1 jose jose 0 Aug 30 17:37 b</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">cd</span> dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 dir1]$ <span class="built_in">touch</span> c</span><br><span class="line"></span><br><span class="line">[jose@rocky8 dir1]$ <span class="built_in">rm</span> a</span><br><span class="line"></span><br><span class="line">[jose@rocky8 dir1]$ <span class="built_in">ls</span></span><br><span class="line">b  c</span><br></pre></td></tr></table></figure>

<p>范例：面试题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">执行 <span class="built_in">cp</span> /etc/issue /data/dir/ 所需要的最小权限？</span><br><span class="line">/bin/cp 需要x权限</span><br><span class="line">/etc/ 需要x权限</span><br><span class="line">/etc/issue 需要r权限</span><br><span class="line">/data 需要x权限</span><br><span class="line">/data/dir 需要w,x权限</span><br></pre></td></tr></table></figure>

<h2 id="新建文件和目录的默认权限"><a href="#新建文件和目录的默认权限" class="headerlink" title="新建文件和目录的默认权限"></a>新建文件和目录的默认权限</h2><p>在linux 系统中，新建文件或目录，都有一个默认权限；</p>
<p>umask 值间接影响新建文件和新建目录的权限：</p>
<ul>
<li>新建文件：666-umask，按位对应相减，如果所得结果某位存在执行（奇数）权限，则该位+1；</li>
<li>新建目录：777-umask；</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">umask</span> [-p] [-S] [mode]</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示或设定文件模式掩码。</span></span><br><span class="line"></span><br><span class="line">-p      <span class="comment">#如果省略 MODE 模式，以可重用为输入的格式输入</span></span><br><span class="line">-S      <span class="comment">#以字符显示</span></span><br></pre></td></tr></table></figure>

<p>范例：查看umask</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># umask </span></span><br><span class="line">0022</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># umask -p</span></span><br><span class="line"><span class="built_in">umask</span> 0022</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># umask -S</span></span><br><span class="line">u=rwx,g=rx,o=rx</span><br><span class="line"></span><br><span class="line"><span class="comment">#全部权限是777，设置为022，相当于777-022=755</span></span><br><span class="line"><span class="comment">#u:7=rwx，g:5=rx，o:5=rx</span></span><br><span class="line"><span class="comment">#文件默认是666，目录默认是777</span></span><br></pre></td></tr></table></figure>

<p>范例：修改umask</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># umask 123</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># umask </span></span><br><span class="line">0123</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># umask -S</span></span><br><span class="line">u=rw,g=rx,o=r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># umask u=rw,g=r,o=</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># umask</span></span><br><span class="line">0137</span><br></pre></td></tr></table></figure>

<p>非特权用户umask默认是 002</p>
<p>root的umask 默认是 022</p>
<p>持久保存umask </p>
<ul>
<li>全局设置：/etc/bashrc </li>
<li>用户设置：~/.bashrc</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># umask</span></span><br><span class="line">0022</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># (umask 666;touch /data/f1.txt)</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># umask </span></span><br><span class="line">0022</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /data/f1.txt </span></span><br><span class="line">----------. 1 root root 0 Aug 31 10:01 /data/f1.txt</span><br></pre></td></tr></table></figure>

<h2 id="Linux文件系统上的特殊权限"><a href="#Linux文件系统上的特殊权限" class="headerlink" title="Linux文件系统上的特殊权限"></a>Linux文件系统上的特殊权限</h2><p>在Linux中，除了rwx 这三种常⻅的权限之外，还有三个特殊权限，分别是 SUID， SGID，Sticky；这三个特殊权限独⽴于rwx权限体系； </p>
<p>特殊权限 </p>
<ul>
<li><p>SUID：  作用于二进制可执行文件上，用户将继承此程序所有者的权限； </p>
</li>
<li><p>SGID：作用于二进制可执行文件上，用户将继承此程序所有组的权限； </p>
<p>​              作用于目录上，此目录中新建的文件的所属组将自动从此目录继承； </p>
</li>
<li><p>STICKY：作用于目录上，此目录中的文件只能由所有者自已和root来删除；</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>权限</th>
<th>字符表示</th>
<th>八进制表示</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>SUID</td>
<td>s</td>
<td>4</td>
<td>如果原属主没有可执行权限，再加SUID权限，则显示为S</td>
</tr>
<tr>
<td>SGID</td>
<td>s</td>
<td>2</td>
<td>如果原属组没有可执行权限，再加SGID权限，则显示为S</td>
</tr>
<tr>
<td>STICKY</td>
<td>t</td>
<td>1</td>
<td>如果other没有可执行权限，再加STICKY权限，则显示为T</td>
</tr>
</tbody></table>
<h3 id="特殊权限SUID"><a href="#特殊权限SUID" class="headerlink" title="特殊权限SUID"></a>特殊权限SUID</h3><p>前提：进程有属主和属组；文件有属主和属组 </p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程，取决发起者对程序文件是否拥有执行权限 </li>
<li>启动为进程之后，其进程的属主为发起者，进程的属组为发起者所属的组</li>
<li>进程访问文件时的权限，取决于进程的发起者</li>
</ul>
<p>二进制的可执行文件上SUID权限功能： </p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程：取决发起者对程序文件是否拥有执行权限</li>
<li>启动为进程之后，其进程的属主为原程序文件的属主</li>
<li>SUID只对二进制可执行程序有效</li>
<li>SUID设置在目录上无意义</li>
</ul>
<p>SUID权限设定：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u+s FILE...</span><br><span class="line"><span class="built_in">chmod</span> 4xxx FILE</span><br><span class="line"><span class="built_in">chmod</span> u-s FILE...</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[jose@rocky8 ~]$ ll /etc/shadow</span><br><span class="line">----------. 1 root root 1475 Jun 26 14:02 /etc/shadow</span><br><span class="line"></span><br><span class="line"><span class="comment">#普通用户无法打开 /etc/shadow文件,因为没有任何权限，根据前面的学习，我们知道，此文件存放的是用户密码</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">cat</span> /etc/shadow</span><br><span class="line"> <span class="built_in">cat</span>: /etc/shadow: Permission denied</span><br><span class="line"></span><br><span class="line"><span class="comment">#但是可以通过passwd 命令来修改密码，也就是说，普通用户可以通过 passwd 命令来修改 /etc/shadow 文件</span></span><br><span class="line">[jose@rocky8 ~]$ passwd</span><br><span class="line"> Changing password <span class="keyword">for</span> user jose.</span><br><span class="line"> Current password: </span><br><span class="line"> New password: </span><br><span class="line"> Retype new password: </span><br><span class="line"> passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day04/7.png" alt="7"></p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># chmod u+s /usr/bin/cat</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day04/8.png" alt="8"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#有权限了</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">cat</span> /etc/shadow</span><br><span class="line">root:$6<span class="variable">$fdNu</span>..2c3pyXSdCH<span class="variable">$nnaRho78</span>/QFuPTvvoYirO6t44KAeMTEOIjgjypBXHAlgEWaBtXxMYf1/JQbySwC6OPekLERPlYn7NXRABRiGa.::0:99999:7:::</span><br><span class="line">bin:*:18700:0:99999:7:::</span><br><span class="line">daemon:*:18700:0:99999:7:::</span><br><span class="line">adm:*:18700:0:99999:7:::</span><br></pre></td></tr></table></figure>

<h3 id="特殊权限SGID"><a href="#特殊权限SGID" class="headerlink" title="特殊权限SGID"></a>特殊权限SGID</h3><p>二进制的可执行文件上SGID权限功能：</p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程：取决发起者对程序文件是否拥有执行权限</li>
<li>启动为进程之后，其进程的属组为原程序文件的属组</li>
</ul>
<p>SGID权限设定：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> g+s FILE... </span><br><span class="line"><span class="built_in">chmod</span> 2xxx FILE</span><br><span class="line"><span class="built_in">chmod</span> g-s FILE...</span><br></pre></td></tr></table></figure>

<p>目录上的SGID权限功能： </p>
<p>默认情况下，用户创建文件时，其属组为此用户所属的主组，一旦某目录被设定了SGID，则对此目录有写权限的用户在此目录中创建的文件 所属的组为此目录的属组，通常用于创建一个协作目录</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[jose@rocky8 ~]$ ll -d dir1/</span><br><span class="line"> drwxrwxr-x. 2 jose jose 42 Aug 31 10:38 dir1/</span><br><span class="line">[jose@rocky8 ~]$ ll dir1/</span><br><span class="line"> total 0</span><br><span class="line"> -rw-rw-r--. 1 jose jose 0 Aug 31 10:38 jose-1.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Aug 31 10:38 root-1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#加权限</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">chmod</span> g+s dir1/</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建文件</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">touch</span> dir1/jose-2.txt </span><br><span class="line">[jose@rocky8 ~]$ su root -c <span class="string">&quot;touch dir1/root-2.txt&quot;</span></span><br><span class="line"> </span><br><span class="line">[jose@rocky8 ~]$ ll dir1/ -d</span><br><span class="line"> drwxrwsr-x. 2 jose jose 78 Aug 31 10:40 dir1/</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ ll dir1/</span><br><span class="line"> total 0</span><br><span class="line"> -rw-rw-r--. 1 jose jose 0 Aug 31 10:38 jose-1.txt</span><br><span class="line"> -rw-rw-r--. 1 jose jose 0 Aug 31 10:39 jose-2.txt</span><br><span class="line"> -rw-r--r--. 1 root root 0 Aug 31 10:38 root-1.txt</span><br><span class="line"> -rw-r--r--. 1 root jose 0 Aug 31 10:40 root-2.txt</span><br><span class="line"> <span class="comment">#新建文件属组变成了目录属组</span></span><br></pre></td></tr></table></figure>

<h3 id="特殊权限-Sticky-位"><a href="#特殊权限-Sticky-位" class="headerlink" title="特殊权限 Sticky 位"></a>特殊权限 Sticky 位</h3><p>具有写权限的目录通常用户可以删除该目录中的任何文件，无论用户是否对文件有权限</p>
<p>在目录设置Sticky 位，只有文件的所有者或root可以删除该文件</p>
<p>sticky 设置在文件上无意义</p>
<p>Sticky权限设定：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> o+t DIR...</span><br><span class="line"><span class="built_in">chmod</span> 1xxx DIR</span><br><span class="line"><span class="built_in">chmod</span> o-t DIR...</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 /]<span class="comment"># mkdir dir1</span></span><br><span class="line">[root@rocky8 /]<span class="comment"># chmod a=rwx dir1/</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 /]<span class="comment"># touch dir1/root-1.txt</span></span><br><span class="line">[root@rocky8 /]<span class="comment"># su - jerry -c &quot;touch /dir1/jerry-1.txt&quot;</span></span><br><span class="line">[root@rocky8 /]<span class="comment"># su - jose -c &quot;touch /dir1/jose-1.txt&quot;</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 /]<span class="comment"># ll -d dir1/</span></span><br><span class="line">drwxrwxrwx. 2 root root 61 Aug 31 10:52 dir1/</span><br><span class="line"></span><br><span class="line">[root@rocky8 /]<span class="comment"># ll dir1/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 jerry tom  0 Aug 31 10:52 jerry-1.txt</span><br><span class="line">-rw-rw-r--. 1 jose  jose 0 Aug 31 10:52 jose-1.txt</span><br><span class="line">-rw-r--r--. 1 root  root 0 Aug 31 10:51 root-1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#普通用户可以删除其它用户的文件</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">rm</span> -f /dir1/root-1.txt </span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">rm</span> -f /dir1/jerry-1.txt </span><br><span class="line">[jose@rocky8 ~]$ ll /dir1/</span><br><span class="line"> total 0</span><br><span class="line"> -rw-rw-r--. 1 jose jose 0 Aug 31 10:52 jose-1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#加权限</span></span><br><span class="line">[root@rocky8 /]<span class="comment"># chmod o+t /dir1/</span></span><br><span class="line">[root@rocky8 /]<span class="comment"># ll -d /dir1/</span></span><br><span class="line"> drwxrwxrwt. 2 root root 24 Aug 31 10:54 /dir1/</span><br><span class="line"></span><br><span class="line"><span class="comment">#再新建文件</span></span><br><span class="line">[root@rocky8 /]<span class="comment"># su - jerry -c &quot;touch /dir1/jerry-2.txt&quot;</span></span><br><span class="line">[root@rocky8 /]<span class="comment"># touch dir1/root-2.txt</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 /]<span class="comment"># ll /dir1/</span></span><br><span class="line"> total 0</span><br><span class="line"> -rw-r--r--. 1 jerry tom  0 Aug 31 10:55 jerry-2.txt</span><br><span class="line"> -rw-rw-r--. 1 jose  jose 0 Aug 31 10:52 jose-1.txt</span><br><span class="line"> -rw-r--r--. 1 root  root 0 Aug 31 10:55 root-2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#现在就不能删除其它用户的文件了</span></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">rm</span> -f /dir1/jerry-2.txt </span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;/dir1/jerry-2.txt&#x27;</span>: Operation not permitted</span><br><span class="line"></span><br><span class="line">[jose@rocky8 ~]$ <span class="built_in">rm</span> -f /dir1/root-2.txt</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;/dir1/root-2.txt&#x27;</span>: Operation not permitted</span><br></pre></td></tr></table></figure>

<p>范例：查看目录中的sticky权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 /]<span class="comment"># ll -d /dir1/</span></span><br><span class="line">drwxrwxrwt. 2 root root 61 Aug 31 10:55 /dir1/</span><br><span class="line"></span><br><span class="line">[root@rocky8 /]<span class="comment"># file dir1/</span></span><br><span class="line">dir1/: sticky, directory</span><br></pre></td></tr></table></figure>

<h3 id="特殊权限数字法"><a href="#特殊权限数字法" class="headerlink" title="特殊权限数字法"></a>特殊权限数字法</h3><table>
<thead>
<tr>
<th>字符表示</th>
<th>二进制表示</th>
<th>八进制表示</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>———</td>
<td>000</td>
<td>0</td>
<td>无任何特殊权限</td>
</tr>
<tr>
<td>——–t</td>
<td>001</td>
<td>1</td>
<td>Sticky</td>
</tr>
<tr>
<td>—–s—</td>
<td>010</td>
<td>2</td>
<td>SGID</td>
</tr>
<tr>
<td>—–s–t</td>
<td>011</td>
<td>3</td>
<td>SGID,Sticky</td>
</tr>
<tr>
<td>–s——</td>
<td>100</td>
<td>4</td>
<td>SUID</td>
</tr>
<tr>
<td>–s—–t</td>
<td>101</td>
<td>5</td>
<td>SUID,Sticky</td>
</tr>
<tr>
<td>–s–s—</td>
<td>110</td>
<td>6</td>
<td>SUID,SGID</td>
</tr>
<tr>
<td>–s–s–t</td>
<td>111</td>
<td>7</td>
<td>SUID,SGID,Sticky</td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 4777 /tmp/a.txt</span><br></pre></td></tr></table></figure>

<p>权限位映射 </p>
<p>SUID: user,占据属主的执行权限位 </p>
<p>​            s：属主拥有x权限</p>
<p>​            S：属主没有x权限</p>
<p>SGID: group,占据属组的执行权限位</p>
<p>​            s： group拥有x权限</p>
<p>​            S：group没有x权限</p>
<p>Sticky: other,占据other的执行权限位</p>
<p>​            t：other拥有x权限</p>
<p>​            T：other没有x权限</p>
<h3 id="设定文件特殊属性"><a href="#设定文件特殊属性" class="headerlink" title="设定文件特殊属性"></a>设定文件特殊属性</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">chattr [-pRVf] [-+=aAcCdDeijPsStTuF] [-v version] files...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-p project      <span class="comment">#设置文件项目编号</span></span><br><span class="line">-R              <span class="comment">#递归执行</span></span><br><span class="line">-V              <span class="comment">#显示过程，并输出chattr 版本</span></span><br><span class="line">-f              <span class="comment">#不输出错误信息</span></span><br><span class="line">-v version      <span class="comment">#设置版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#操作符</span></span><br><span class="line">+attribute      <span class="comment">#添加该属性</span></span><br><span class="line">-attribute      <span class="comment">#去掉该属性</span></span><br><span class="line">=attribute      <span class="comment">#仅有该属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用属性</span></span><br><span class="line">a               <span class="comment">#对文件：可追加内容，不可被删除，不可被修改，不可被重命名；对目录，可新建，修改文件，但不可删除文件</span></span><br><span class="line">A               <span class="comment">#不更新atime，节省IO</span></span><br><span class="line">c               <span class="comment">#文件会被压缩保存</span></span><br><span class="line">i               <span class="comment">#对文件：不可被删除不可被修改不可重命名；对目录：可修改查看目录中的文件，不可新建文件，不可删除文件</span></span><br><span class="line">s               <span class="comment">#彻底删除文件，用0填充原来的数据块</span></span><br><span class="line">u               <span class="comment">#防止误删除，这里是指原来存储该文件的块不会被新的数据覆盖</span></span><br></pre></td></tr></table></figure>

<p>显示文件特殊属性</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsattr [-RVadlpv] [files...]</span><br></pre></td></tr></table></figure>

<p>范例：+i 防止误删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;abcd&quot;&gt;a.txt</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># chattr +i a.txt </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll a.txt</span></span><br><span class="line"> -rw-r-----. 1 root root 5 Jun 26 14:43 a.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># lsattr a.txt</span></span><br><span class="line"> ----i--------------- a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#不可删除</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># rm -f a.txt </span></span><br><span class="line"> <span class="built_in">rm</span>: cannot remove <span class="string">&#x27;a.txt&#x27;</span>: Operation not permitted</span><br><span class="line"></span><br><span class="line"><span class="comment">#不可覆盖</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;1234&quot; &gt; a.txt</span></span><br><span class="line"> -bash: a.txt: Operation not permitted</span><br><span class="line"></span><br><span class="line"><span class="comment">#不可追加</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;1234&quot; &gt;&gt; a.txt</span></span><br><span class="line"> -bash: a.txt: Operation not permitted</span><br><span class="line"> </span><br><span class="line"><span class="comment">#可复制</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cp a.txt /tmp/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不可移动</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># mv a.txt /tmp/</span></span><br><span class="line"> <span class="built_in">mv</span>: cannot move <span class="string">&#x27;a.txt&#x27;</span> to <span class="string">&#x27;/tmp/a.txt&#x27;</span>: Operation not permitted</span><br><span class="line"></span><br><span class="line"><span class="comment">#可读</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat a.txt </span></span><br><span class="line"> abcd</span><br></pre></td></tr></table></figure>

<p>范例：+a 一般用于日志文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;abcd&quot;&gt;b.txt</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># chattr +a b.txt</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll b.txt</span></span><br><span class="line"> -rw-r-----. 1 root root 5 Jun 26 14:49 b.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># lsattr b.txt</span></span><br><span class="line"> -----a-------------- b.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#不可删除</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># rm -f b.txt </span></span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;b.txt&#x27;</span>: Operation not permitted</span><br><span class="line"></span><br><span class="line"><span class="comment">#不可覆盖</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;1234&quot; &gt; b.txt</span></span><br><span class="line"> -bash: b.txt: Operation not permitted</span><br><span class="line"> </span><br><span class="line"><span class="comment">#可追加</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;1234&quot; &gt;&gt; b.txt</span></span><br></pre></td></tr></table></figure>

<h2 id="访问控制列表-ACL"><a href="#访问控制列表-ACL" class="headerlink" title="访问控制列表 ACL"></a>访问控制列表 ACL</h2><h3 id="ACL权限功能"><a href="#ACL权限功能" class="headerlink" title="ACL权限功能"></a>ACL权限功能</h3><p>rwx 权限体系中，仅仅只能将用户分成三种角色，如果要对单独用户设置额外的权限，则无法完成；</p>
<p>而ACL可以单独对指定的用户设定各不相同的权限；提供颗粒度更细的权限控制；</p>
<p>CentOS7 默认创建的xfs和ext4文件系统具有ACL功能</p>
<p>CentOS7 之前版本，默认手工创建的ext4文件系统无ACL功能，需手动增加</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tune2fs –o acl /dev/sdb1</span><br><span class="line">mount –o acl /dev/sdb1 /mnt/test</span><br></pre></td></tr></table></figure>

<p><strong>ACL生效顺序：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所有者，自定义用户，所属组|自定义组，其他人</span><br></pre></td></tr></table></figure>

<h3 id="ACL相关命令"><a href="#ACL相关命令" class="headerlink" title="ACL相关命令"></a>ACL相关命令</h3><p>setfacl 可设置ACL权限</p>
<p>getfacl 可查看设置的ACL权限</p>
<p>范例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">setfacl [-bkndRLPvh] [&#123;-m|-x&#125; acl_spec] [&#123;-M|-X&#125; acl_file] file ...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-m|--modify=acl             <span class="comment">#修改acl权限</span></span><br><span class="line">-M|--modify-file=file       <span class="comment">#从文件读取规则</span></span><br><span class="line">-x|--remove=acl             <span class="comment">#删除文件acl 权限</span></span><br><span class="line">-X|--remove-file=file       <span class="comment">#从文件读取规则</span></span><br><span class="line">-b|--remove-all             <span class="comment">#删除文件所有acl权限</span></span><br><span class="line">-k|--remove-default         <span class="comment">#删除默认acl规则</span></span><br><span class="line">--<span class="built_in">set</span>=acl                   <span class="comment">#用新规则替换旧规则，会删除原有ACL项，用新的替代，一定要包含UGO的设置，不能象 -m一样只有 ACL</span></span><br><span class="line">--set-file=file             <span class="comment">#从文件读取新规则</span></span><br><span class="line">--mask                      <span class="comment">#重新计算mask值</span></span><br><span class="line">-n|--no-mask                <span class="comment">#不重新计算mask值</span></span><br><span class="line">-d|--default                <span class="comment">#在目录上设置默认acl</span></span><br><span class="line">-R|--recursive              <span class="comment">#递归执行</span></span><br><span class="line">-L|--logical                <span class="comment">#将acl 应用在软链接指向的目标文件上，与-R一起使用</span></span><br><span class="line">-P|--physical               <span class="comment">#将acl 不应用在软链接指向的目标文件上，与-R一起使用</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 tmp]<span class="comment"># echo &quot;abcd&quot;&gt;f1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># ll f1</span></span><br><span class="line"> -rw-r--r--. 1 root root 5 Jun 26 19:59 f1</span><br><span class="line"></span><br><span class="line"><span class="comment">#other 用户可读</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># su - mage -c &quot;cat /tmp/f1&quot;</span></span><br><span class="line"> abcd</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置 mage 无任何权限</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># setfacl -m u:mage:- f1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1</span></span><br><span class="line"> <span class="comment"># file: f1</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:mage:---</span><br><span class="line"> group::r--</span><br><span class="line"> mask::r--</span><br><span class="line"> other::r--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件，多了一个小 +</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># ll f1</span></span><br><span class="line"> -rw-r--r--+ 1 root root 5 Jun 26 19:59 f1</span><br><span class="line"></span><br><span class="line"><span class="comment">#mage不可读</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># su - mage -c &quot;cat /tmp/f1&quot;</span></span><br><span class="line"> <span class="built_in">cat</span>: /tmp/f1: Permission denied</span><br><span class="line"></span><br><span class="line"><span class="comment">#同为other 的jerry可读</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># su - jerry -c &quot;cat /tmp/f1&quot;</span></span><br><span class="line"> abcd</span><br><span class="line"></span><br><span class="line"><span class="comment">#但jerry 不可写</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># su - jerry -c &quot;echo 1234 &gt;&gt; /tmp/f1&quot;</span></span><br><span class="line"> -bash: /tmp/f1: Permission denied</span><br><span class="line"></span><br><span class="line"><span class="comment">#给 jerry 加写权限</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># setfacl -m u:jerry:rw f1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1</span></span><br><span class="line"> <span class="comment"># file: f1</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:mage:---</span><br><span class="line"> user:jerry:rw-</span><br><span class="line"> group::r--</span><br><span class="line"> mask::rw-</span><br><span class="line"> other::r--</span><br><span class="line"></span><br><span class="line"><span class="comment">#可写</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># su - jerry -c &quot;echo 1234 &gt;&gt; /tmp/f1&quot;</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># su - jerry -c &quot;cat /tmp/f1&quot;</span></span><br><span class="line"> abcd</span><br><span class="line"> 1234</span><br></pre></td></tr></table></figure>

<p>范例：给组加ACL</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 tmp]<span class="comment"># setfacl -m g:tom:rwx f1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1</span></span><br><span class="line"><span class="comment"># file: f1</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line">user::rw-</span><br><span class="line">user:mage:---</span><br><span class="line">user:jerry:rw-</span><br><span class="line">group::r--</span><br><span class="line">group:tom:rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::r--</span><br></pre></td></tr></table></figure>

<p>范例：从文件复制ACL</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1 f2</span></span><br><span class="line"> <span class="comment"># file: f1</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:mage:---</span><br><span class="line"> user:jerry:rw-</span><br><span class="line"> group::r--</span><br><span class="line"> group:tom:rwx</span><br><span class="line"> mask::rwx</span><br><span class="line"> other::r--</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># file: f2</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> group::r--</span><br><span class="line"> other::r--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1 | setfacl --set-file=-  f2</span></span><br><span class="line"><span class="comment"># “-”表示从标准输入获取ACL信息</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1 f2</span></span><br><span class="line"> <span class="comment"># file: f1</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:mage:---</span><br><span class="line"> user:jerry:rw-</span><br><span class="line"> group::r--</span><br><span class="line"> group:tom:rwx</span><br><span class="line"> mask::rwx</span><br><span class="line"> other::r--</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># file: f2</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:mage:---</span><br><span class="line"> user:jerry:rw-</span><br><span class="line"> group::r--</span><br><span class="line"> group:tom:rwx</span><br><span class="line"> mask::rwx</span><br><span class="line"> other::r--</span><br></pre></td></tr></table></figure>

<p>范例：移除ACL权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 tmp]<span class="comment"># setfacl -x u:mage f1</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># setfacl -x g:tom f1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1</span></span><br><span class="line"> <span class="comment"># file: f1</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:jerry:rw-</span><br><span class="line"> group::r--</span><br><span class="line"> mask::rw-</span><br><span class="line"> other::r--</span><br></pre></td></tr></table></figure>

<p>范例：移除文件上所有ACL权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 tmp]<span class="comment"># ll f1</span></span><br><span class="line"> -rw-rw-r--+ 1 root root 10 Jun 26 20:19 f1</span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># setfacl -b f1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f1</span></span><br><span class="line"> <span class="comment"># file: f1</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> group::r--</span><br><span class="line"> other::r--</span><br><span class="line"></span><br><span class="line"><span class="comment">#小+号没了</span></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># ll f1</span></span><br><span class="line"> -rw-r--r--. 1 root root 10 Jun 26 20:19 f1</span><br></pre></td></tr></table></figure>

<p>范例：–set替换</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 tmp]<span class="comment"># ll f2</span></span><br><span class="line"> -rw-rwxr--+ 1 root root 3 Jun 26 20:17 f2</span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f2</span></span><br><span class="line"> <span class="comment"># file: f2</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:mage:---</span><br><span class="line"> user:jerry:rw-</span><br><span class="line"> group::r--</span><br><span class="line"> group:tom:rwx</span><br><span class="line"> mask::rwx</span><br><span class="line"> other::r--</span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># setfacl --set u::rw,u:jerry:-,g::-,o::- f2</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># ll f2</span></span><br><span class="line"> -rw-------+ 1 root root 3 Jun 26 20:17 f2</span><br><span class="line"></span><br><span class="line">[root@rocky8 tmp]<span class="comment"># getfacl f2</span></span><br><span class="line"> <span class="comment"># file: f2</span></span><br><span class="line"> <span class="comment"># owner: root</span></span><br><span class="line"> <span class="comment"># group: root</span></span><br><span class="line"> user::rw-</span><br><span class="line"> user:jerry:---</span><br><span class="line"> group::---</span><br><span class="line"> mask::---</span><br><span class="line"> other::---</span><br></pre></td></tr></table></figure>

<p><strong>mask 权限</strong></p>
<ul>
<li>mask只影响除所有者和other的之外的人和组的最大权限</li>
<li>mask需要与用户的权限进行逻辑与运算后，才能变成有限的权限(Effective Permission)</li>
<li>用户或组的设置必须存在于mask权限设定范围内才会生效 </li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m mask::rx file</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/08/31/SRE-%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">http://example.com/2024/08/31/SRE-用户和权限管理/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SRE/">SRE</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="/../images/TITLE/linux4.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/27/Blog%E6%90%AD%E5%BB%BA/" title="Bolg搭建"><img class="cover" src="/../images/TITLE/butterfiy.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Bolg搭建</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/23/SRE-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="常见文本处理工具和正则表达式"><img class="cover" src="/../images/TITLE/linux5.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">常见文本处理工具和正则表达式</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/08/27/SRE-Linux%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%92%8CIO%E9%87%8D%E5%AE%9A%E5%90%91/" title="Linux文件管理和IO重定向"><img class="cover" src="/../images/TITLE/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="title">Linux文件管理和IO重定向</div></div></a></div><div><a href="/2024/04/24/SRE-Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%92%8C%E5%B8%AE%E5%8A%A9/" title="Linux基本操作和帮助"><img class="cover" src="/../images/TITLE/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="title">Linux基本操作和帮助</div></div></a></div><div><a href="/2024/12/08/SRE-Linux%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img class="cover" src="/../images/SRE/day17/12.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="title">Linux防火墙</div></div></a></div><div><a href="/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="shell脚本编程"><img class="cover" src="/../images/TITLE/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-05</div><div class="title">shell脚本编程</div></div></a></div><div><a href="/2024/12/08/SRE-linux%E5%91%BD%E4%BB%A4%E7%B4%A2%E5%BC%95/" title="linux命令索引"><img class="cover" src="/../images/TITLE/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="title">linux命令索引</div></div></a></div><div><a href="/2024/12/04/SRE-%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" title="加密和安全"><img class="cover" src="/../images/SRE/day15/13.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-04</div><div class="title">加密和安全</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/TITLE/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">97</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">Linux安全模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7"><span class="toc-number">1.1.</span> <span class="toc-text">用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">1.2.</span> <span class="toc-text">用户组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.3.</span> <span class="toc-text">用户和组的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">1.4.</span> <span class="toc-text">安全上下文</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">用户和组的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%9A%84%E4%B8%BB%E8%A6%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">用户和组的主要配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#passwd%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">passwd文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shadow%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">shadow文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">group文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gshdow%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">gshdow文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">2.6.</span> <span class="toc-text">文件操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">用户和组管理命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%88%9B%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text">用户创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%B1%9E%E6%80%A7%E4%BF%AE%E6%94%B9"><span class="toc-number">3.2.</span> <span class="toc-text">用户属性修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">3.3.</span> <span class="toc-text">删除用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E7%9B%B8%E5%85%B3%E7%9A%84ID%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.</span> <span class="toc-text">查看用户相关的ID信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E6%88%96%E4%BB%A5%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.5.</span> <span class="toc-text">切换用户或以其他用户身份执行命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-number">3.6.</span> <span class="toc-text">设置密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5"><span class="toc-number">3.7.</span> <span class="toc-text">修改用户密码策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84"><span class="toc-number">3.8.</span> <span class="toc-text">创建组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%BB%84"><span class="toc-number">3.9.</span> <span class="toc-text">修改组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%88%A0%E9%99%A4"><span class="toc-number">3.10.</span> <span class="toc-text">组删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E7%BB%84%E6%88%90%E5%91%98%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">3.11.</span> <span class="toc-text">更改组成员和密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%92%8C%E6%9F%A5%E7%9C%8B%E7%BB%84%E6%88%90%E5%91%98"><span class="toc-number">3.12.</span> <span class="toc-text">更改和查看组成员</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">3.13.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">文件权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E4%B8%AD%E7%9A%84%E6%9D%83%E9%99%90%E4%BD%93%E7%B3%BB%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">Linux中的权限体系介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%89%80%E6%9C%89%E8%80%85%E5%92%8C%E5%B1%9E%E7%BB%84%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">文件所有者和属组属性操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%80%E6%9C%89%E8%80%85chown"><span class="toc-number">4.2.1.</span> <span class="toc-text">设置文件的所有者chown</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%B1%9E%E7%BB%84%E4%BF%A1%E6%81%AFchgrp"><span class="toc-number">4.2.2.</span> <span class="toc-text">设置文件的属组信息chgrp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="toc-number">4.3.</span> <span class="toc-text">文件权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E8%AF%B4%E6%98%8E"><span class="toc-number">4.3.1.</span> <span class="toc-text">文件权限说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90chmod"><span class="toc-number">4.3.2.</span> <span class="toc-text">修改文件权限chmod</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95%E7%9A%84%E9%BB%98%E8%AE%A4%E6%9D%83%E9%99%90"><span class="toc-number">4.4.</span> <span class="toc-text">新建文件和目录的默认权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8A%E7%9A%84%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90"><span class="toc-number">4.5.</span> <span class="toc-text">Linux文件系统上的特殊权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90SUID"><span class="toc-number">4.5.1.</span> <span class="toc-text">特殊权限SUID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90SGID"><span class="toc-number">4.5.2.</span> <span class="toc-text">特殊权限SGID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90-Sticky-%E4%BD%8D"><span class="toc-number">4.5.3.</span> <span class="toc-text">特殊权限 Sticky 位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90%E6%95%B0%E5%AD%97%E6%B3%95"><span class="toc-number">4.5.4.</span> <span class="toc-text">特殊权限数字法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E5%AE%9A%E6%96%87%E4%BB%B6%E7%89%B9%E6%AE%8A%E5%B1%9E%E6%80%A7"><span class="toc-number">4.5.5.</span> <span class="toc-text">设定文件特殊属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8-ACL"><span class="toc-number">4.6.</span> <span class="toc-text">访问控制列表 ACL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACL%E6%9D%83%E9%99%90%E5%8A%9F%E8%83%BD"><span class="toc-number">4.6.1.</span> <span class="toc-text">ACL权限功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACL%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">4.6.2.</span> <span class="toc-text">ACL相关命令</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/16/SRE-Keepalived/" title="高可用性集群Keepalived"><img src="/../images/SRE/day48/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高可用性集群Keepalived"/></a><div class="content"><a class="title" href="/2025/04/16/SRE-Keepalived/" title="高可用性集群Keepalived">高可用性集群Keepalived</a><time datetime="2025-04-16T09:15:13.000Z" title="发表于 2025-04-16 17:15:13">2025-04-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/15/SRE-HAProxy/" title="高可用性集群HAProxy"><img src="/../images/SRE/day47/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高可用性集群HAProxy"/></a><div class="content"><a class="title" href="/2025/04/15/SRE-HAProxy/" title="高可用性集群HAProxy">高可用性集群HAProxy</a><time datetime="2025-04-15T15:51:45.000Z" title="发表于 2025-04-15 23:51:45">2025-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/SRE-docker/" title="企业级容器技术Docker"><img src="/../images/SRE/day46/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="企业级容器技术Docker"/></a><div class="content"><a class="title" href="/2025/04/13/SRE-docker/" title="企业级容器技术Docker">企业级容器技术Docker</a><time datetime="2025-04-13T09:39:38.000Z" title="发表于 2025-04-13 17:39:38">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/01/SRE-kvm/" title="企业级Linux虚拟化KVM"><img src="/../images/SRE/day41/21.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="企业级Linux虚拟化KVM"/></a><div class="content"><a class="title" href="/2025/04/01/SRE-kvm/" title="企业级Linux虚拟化KVM">企业级Linux虚拟化KVM</a><time datetime="2025-04-01T09:21:21.000Z" title="发表于 2025-04-01 17:21:21">2025-04-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="../images/BEIAN/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="../images/BEIAN/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>