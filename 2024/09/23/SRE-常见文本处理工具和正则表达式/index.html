<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>常见文本处理工具和正则表达式 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="老马 2023 SRE">
<meta property="og:type" content="article">
<meta property="og:title" content="常见文本处理工具和正则表达式">
<meta property="og:url" content="http://example.com/2024/09/23/SRE-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="老马 2023 SRE">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/title/linux5.jpg">
<meta property="article:published_time" content="2024-09-22T16:00:00.000Z">
<meta property="article:modified_time" content="2024-11-08T11:57:09.734Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="SRE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/title/linux5.jpg"><link rel="shortcut icon" href="/../images/title/user.webp"><link rel="canonical" href="http://example.com/2024/09/23/SRE-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '常见文本处理工具和正则表达式',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-11-08 19:57:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/title/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/title/linux5.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">常见文本处理工具和正则表达式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-22T16:00:00.000Z" title="发表于 2024-09-23 00:00:00">2024-09-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-08T11:57:09.734Z" title="更新于 2024-11-08 19:57:09">2024-11-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9D%E5%89%91%E9%94%8B%E4%BB%8E%E7%A3%A8%E7%A0%BA%E5%87%BA/">宝剑锋从磨砺出</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">27.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>129分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="常见文本处理工具和正则表达式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="文本编辑工具之神VIM"><a href="#文本编辑工具之神VIM" class="headerlink" title="文本编辑工具之神VIM"></a>文本编辑工具之神VIM</h1><p><img src="../../../../images/image/SRE/day05/1.png" alt="1"></p>
<h2 id="vi和vim简介"><a href="#vi和vim简介" class="headerlink" title="vi和vim简介"></a>vi和vim简介</h2><p>在Linux中我们经常编辑修改文本文件，即由ASCII, Unicode 或其它编码的纯文字的文件。之前介绍过nano，实际工作中我们会使用更为专业，功能强大的工具</p>
<p>文本编辑种类：</p>
<ul>
<li>全屏编辑器：nano（字符工具），gedit(图形化工具)，vi，vim </li>
<li>行编辑器：sed</li>
</ul>
<p><strong>VI</strong> </p>
<p>Visual editor，文本编辑器，是 Linux 必备工具之一，功能强大，学习曲线较陡峭，学习难度大</p>
<p><strong>VIM</strong></p>
<p>VIsual editor iMproved ，和 vi 使用方法一致，但功能更为强大，不是必备软件</p>
<p>VIM 官网    <a target="_blank" rel="noopener" href="https://www.vim.org/">https://www.vim.org</a></p>
<p>其他相关编辑器：gvim 一个Vim编辑器的图形版本</p>
<p>VIM 小抄</p>
<p><img src="../../../../images/image/SRE/day05/2.png" alt="2"></p>
<p>参考链接：  <a target="_blank" rel="noopener" href="https://www.w3cschool.cn/vim/">https://www.w3cschool.cn/vim/</a></p>
<p><strong>如何退出VIM</strong></p>
<h2 id="使用-vim-初步"><a href="#使用-vim-初步" class="headerlink" title="使用 vim 初步"></a>使用 vim 初步</h2><h3 id="vim-命令格式"><a href="#vim-命令格式" class="headerlink" title="vim 命令格式"></a>vim 命令格式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim [OPTION]... FILE...</span><br></pre></td></tr></table></figure>

<p>常用选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+N                  <span class="comment">#打开文件后让光标处于第N行的行首，+默认尾行</span></span><br><span class="line">+/PATTERN           <span class="comment">#让光标处于第一个被PATTERN匹配到的行行首</span></span><br><span class="line">-b file             <span class="comment">#二进制方式打开文件</span></span><br><span class="line">-d file1 file2…     <span class="comment">#比较多个文件，相当于 vimdiff</span></span><br><span class="line">-m file             <span class="comment">#只读打开文件</span></span><br><span class="line">-e file             <span class="comment">#直接进入ex模式，相当于执行ex file </span></span><br><span class="line">-y file             <span class="comment">#Easy mode (like &quot;evim&quot;, modeless)，直接可以操作文件，ctrl+o:wq|q! 保存和不保存退出</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>如果该文件存在，文件被打开并显示内容</li>
<li>如果该文件不存在，当编辑后第一次存盘时创建它</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># vim f1.txt         #光标在第一行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># vim +3 f1.txt      #光标在第3行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># vim + f1.txt       #光标在最后一行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># vim +/^abc f2.txt  #模式匹配定位</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># vim +/^bc* f2.txt  #模式匹配定位</span></span><br></pre></td></tr></table></figure>

<h3 id="三种主要模式和转换"><a href="#三种主要模式和转换" class="headerlink" title="三种主要模式和转换"></a>三种主要模式和转换</h3><p>vim 是 一个模式编辑器，击键行为是依赖于 vim的 的“模式”</p>
<p>三种模式：</p>
<ul>
<li>命令或普通(Normal)模式：默认模式，可以实现移动光标，剪切/粘贴文本</li>
<li>插入(Insert)或编辑模式：用于修改文本</li>
<li>扩展命令(extended command )或命令(末)行模式：保存，退出等</li>
</ul>
<p><img src="../../../../images/image/SRE/day05/3.png" alt="3"></p>
<p><strong>三种模式之间的切换：</strong> </p>
<p>vim 是 一个模式编辑器，击键行为是依赖于 vim的“模式”，就是说，在不同模式下，相同的按键，是不同的意思；</p>
<p>插入模式和扩展命令模式之间不能直接切换，要走命令模式中转； </p>
<p>打开vim 默认就是命令模式；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#命令模式 --------------------------&gt; 插入模式</span></span><br><span class="line"><span class="comment">#下列按键皆可</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#i      insert, 在光标所在处输入</span></span><br><span class="line"><span class="comment">#I      在当前光标所在行的行首输入</span></span><br><span class="line"><span class="comment">#a      append, 在光标所在处后面输入</span></span><br><span class="line"><span class="comment">#A      在当前光标所在行的行尾输入</span></span><br><span class="line"><span class="comment">#o      在当前光标所在行的下方打开一个新行</span></span><br><span class="line"><span class="comment">#O      在当前光标所在行的上方打开一个新行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#命令模式 --------------------------&gt; 扩展命令模式</span></span><br><span class="line"><span class="comment">#直接敲冒号 :</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#插入模式 -------------------------&gt; 命令模式</span></span><br><span class="line"><span class="comment">#按ESC键</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#插入模式 -------------------------&gt; 扩展命令模式</span></span><br><span class="line"><span class="comment">#按ESC到命令模式，再按冒号 : 到扩展命令模式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#扩展命令模式 ----------------------&gt; 命令模式</span></span><br><span class="line"><span class="comment">#ESC键或Enter键或退格健</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#扩展命令模式 ---------------------&gt; 插入模式</span></span><br><span class="line"><span class="comment">#ESC|Enter|退格键 到命令模式，再i|I|a|A|o|O 到插入模式</span></span><br></pre></td></tr></table></figure>

<p>范例: 插入颜色字符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo -e &#x27;\e[1;31mhello\e[0m&#x27;</span></span><br></pre></td></tr></table></figure>

<p> vim 中实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 切换至插入模式</span><br><span class="line">2 按ctrl+v+[ 三个键,显示^[</span><br><span class="line">3 后续输入颜色信息,如:^[[32mhello^[[0m</span><br><span class="line">4 切换至扩展命令模式,保存退出</span><br><span class="line">5 <span class="built_in">cat</span> 文件可以看到下面显示</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">^[[1;31mhello vim^[[0m</span><br><span class="line">^[[1;32mGreen ^[[0m</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/image/SRE/day05/4.png" alt="4"></p>
<h2 id="扩展命令模式"><a href="#扩展命令模式" class="headerlink" title="扩展命令模式"></a>扩展命令模式</h2><p>按：进入Ex模式 ，创建一个命令提示符:  处于底部的屏幕左侧</p>
<h3 id="扩展命令模式基本命令"><a href="#扩展命令模式基本命令" class="headerlink" title="扩展命令模式基本命令"></a>扩展命令模式基本命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">w               <span class="comment">#写（存）磁盘文件</span></span><br><span class="line">wq              <span class="comment">#写入并退出</span></span><br><span class="line">x               <span class="comment">#写入并退出</span></span><br><span class="line">X               <span class="comment">#加密</span></span><br><span class="line">q               <span class="comment">#退出</span></span><br><span class="line">q！             <span class="comment">#不存盘退出，即使更改都将丢失</span></span><br><span class="line">r filename      <span class="comment">#读文件内容到当前文件中</span></span><br><span class="line">w filename      <span class="comment">#将当前文件内容写入另一个文件</span></span><br><span class="line">!<span class="built_in">command</span>        <span class="comment">#执行命令</span></span><br><span class="line">r!<span class="built_in">command</span>       <span class="comment">#读入命令的输出</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">:w              <span class="comment">#保存当前更改，不退出</span></span><br><span class="line">:q!             <span class="comment">#不保存退出</span></span><br><span class="line">:r /etc/fstab   <span class="comment">#将/etc/fstable</span></span><br><span class="line">:w <span class="built_in">test</span>         <span class="comment">#将当前打开的文件保存至另外一个文件</span></span><br><span class="line">:!hostname      <span class="comment">#执行hostname</span></span><br><span class="line">:r!<span class="built_in">uname</span> -a     <span class="comment">#将 uname -a 的命令执行结果读到当前文件中</span></span><br><span class="line"></span><br><span class="line">:X              <span class="comment">#加密码</span></span><br><span class="line">Enter encryption key: ******</span><br><span class="line">Enter same key again: ******</span><br></pre></td></tr></table></figure>

<h3 id="地址定界"><a href="#地址定界" class="headerlink" title="地址定界"></a>地址定界</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:start_pos,end_pos CMD</span><br></pre></td></tr></table></figure>

<h4 id="地址定界格式"><a href="#地址定界格式" class="headerlink" title="地址定界格式"></a>地址定界格式</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">N               <span class="comment">#具体第N行，例如2表示第2行</span></span><br><span class="line">M,N             <span class="comment">#从左侧M表示起始行，到右侧N表示结尾行 </span></span><br><span class="line">M,+N            <span class="comment">#从左侧M表示起始行，右侧表示从光标所在行开始，再往后+N行结束</span></span><br><span class="line">M,-N            <span class="comment">#从左侧M表示起始行，右侧表示从光标所在行开始，-N所在的行行结束</span></span><br><span class="line">M;+N            <span class="comment">#从第M行处开始，往后数N行，2;+3 表示第2行到第5行，总共取4行</span></span><br><span class="line">M;-N            <span class="comment">#从第M-N行开始，到第M行结束</span></span><br><span class="line">.               <span class="comment">#当前行</span></span><br><span class="line">$               <span class="comment">#最后一行</span></span><br><span class="line">.,$-1           <span class="comment">#当前行到倒数第二行</span></span><br><span class="line">%               <span class="comment">#全文, 相当于1,$</span></span><br><span class="line">/pattern/       <span class="comment">#从当前行向下查找，直到匹配pattern的第一行,即正则匹配</span></span><br><span class="line">/pat1/,/pat2/   <span class="comment">#从第一次被pat1模式匹配到的行开始，一直到第一次被pat2匹配到的行结束</span></span><br><span class="line">N,/pat/         <span class="comment">#从指定行开始，一直找到第一个匹配pattern的行结束</span></span><br><span class="line">/pat/,$         <span class="comment">#向下找到第一个匹配patttern的行到整个文件的结尾的所有行</span></span><br></pre></td></tr></table></figure>

<h4 id="地址定界后跟一个编辑命令"><a href="#地址定界后跟一个编辑命令" class="headerlink" title="地址定界后跟一个编辑命令"></a>地址定界后跟一个编辑命令</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p               <span class="comment">#输出</span></span><br><span class="line">d               <span class="comment">#删除</span></span><br><span class="line">y               <span class="comment">#复制</span></span><br><span class="line">w file          <span class="comment">#将范围内的行另存至指定文件中</span></span><br><span class="line">r file          <span class="comment">#在指定位置插入指定文件中的所有内容</span></span><br><span class="line">t行号            <span class="comment">#将前面指定的行复制到N行后</span></span><br><span class="line">m行号            <span class="comment">#将前面指定的行移动到N行后</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 &gt; 10.txt</span></span><br><span class="line">:2d             <span class="comment">#删除第2行</span></span><br><span class="line">:2,4d           <span class="comment">#删除第2到第4行</span></span><br><span class="line">:2;+3y          <span class="comment">#复制第2到第5行，总共4行</span></span><br><span class="line">:3;+4w <span class="built_in">test</span>     <span class="comment">#将第2到第5行，总共4行内容写入新文件</span></span><br><span class="line">:5r /etc/issue  <span class="comment">#将/etc/issue 文件读取到第5行</span></span><br><span class="line">:t2             <span class="comment">#将光标所在行复制到第2行之后的行   </span></span><br><span class="line">:2,+3t10        <span class="comment">#将第2到第5行，总共4行内容复制到第10行之后</span></span><br><span class="line">:.d             <span class="comment">#删除光标所在行</span></span><br><span class="line">:<span class="variable">$y</span>             <span class="comment">#复制最后一行</span></span><br></pre></td></tr></table></figure>

<h3 id="查找并替换"><a href="#查找并替换" class="headerlink" title="查找并替换"></a>查找并替换</h3><p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:s/要查找的内容/替换为的内容/修饰符</span><br><span class="line">:%s 表示全文查找替换</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">要查找的内容：可使用基本正则表达式模式</span><br><span class="line">替换为的内容：不能使用模式，但可以使用\1, \2, ...等后向引用符号；还可以使用“&amp;”引用前面查找时查找到的整个内容</span><br></pre></td></tr></table></figure>

<p>修饰符：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i                   <span class="comment">#忽略大小写</span></span><br><span class="line">g                   <span class="comment">#全局替换，默认情况下，每一行只替换第一次出现</span></span><br><span class="line">gc                  <span class="comment">#全局替换，每次替换前询问</span></span><br></pre></td></tr></table></figure>

<p>查找替换中的分隔符/可替换为其它字符，如：#，@ </p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">:s/root/ROOT/       <span class="comment">#替换当前行第一个root</span></span><br><span class="line">:s/root/ROOT/g      <span class="comment">#替换当前行所有root</span></span><br><span class="line">:%s/root/ROOT/g     <span class="comment">#全文替换</span></span><br><span class="line">:%s/root/test/ig    <span class="comment">#不区分大小写全文替换</span></span><br><span class="line"></span><br><span class="line">:%s/<span class="comment">#//             #将每行第一个#替换成空</span></span><br></pre></td></tr></table></figure>

<h3 id="定制vim的工作特性"><a href="#定制vim的工作特性" class="headerlink" title="定制vim的工作特性"></a>定制vim的工作特性</h3><p>扩展命令模式的配置只是对当前vim进程有效，可将配置存放在文件中持久保存； </p>
<p>写配置文件必须保证能识别，有些短格式在 配置文件；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/vimrc              <span class="comment">#全局配置        </span></span><br><span class="line">~/.vimrc                <span class="comment">#个人配置</span></span><br></pre></td></tr></table></figure>

<h4 id="行号"><a href="#行号" class="headerlink" title="行号"></a>行号</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> number|<span class="built_in">set</span> nu           <span class="comment">#显示行号</span></span><br><span class="line">:<span class="built_in">set</span> nonumber|<span class="built_in">set</span> nonu       <span class="comment">#取消显示行号</span></span><br></pre></td></tr></table></figure>

<h4 id="忽略字符的大小写"><a href="#忽略字符的大小写" class="headerlink" title="忽略字符的大小写"></a>忽略字符的大小写</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> ignorecase|<span class="built_in">set</span> ic            <span class="comment">#忽略字符大小写</span></span><br><span class="line">:<span class="built_in">set</span> noignorecase|<span class="built_in">set</span> noic        <span class="comment">#不忽略</span></span><br></pre></td></tr></table></figure>

<h4 id="自动缩进"><a href="#自动缩进" class="headerlink" title="自动缩进"></a>自动缩进</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> autoindent|<span class="built_in">set</span> ai              <span class="comment">#启用自动缩进</span></span><br><span class="line">:<span class="built_in">set</span> noautoindent|<span class="built_in">set</span> noai          <span class="comment">#禁用自动缩进</span></span><br></pre></td></tr></table></figure>

<h4 id="复制保留格式"><a href="#复制保留格式" class="headerlink" title="复制保留格式"></a>复制保留格式</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> <span class="built_in">paste</span>                <span class="comment">#复制时保留格式</span></span><br><span class="line">:<span class="built_in">set</span> nopaste              <span class="comment">#禁用复制时保留格式选项</span></span><br></pre></td></tr></table></figure>

<h4 id="显示Tab-I和换行符-和-显示"><a href="#显示Tab-I和换行符-和-显示" class="headerlink" title="显示Tab ^I和换行符 和$显示"></a>显示Tab ^I和换行符 和$显示</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> list                 <span class="comment">#显示系统字符</span></span><br><span class="line">:<span class="built_in">set</span> nolist               <span class="comment">#隐藏系统字符</span></span><br></pre></td></tr></table></figure>

<h4 id="高亮搜索"><a href="#高亮搜索" class="headerlink" title="高亮搜索"></a>高亮搜索</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> hlsearch                  <span class="comment">#高亮显示搜索结果</span></span><br><span class="line">:<span class="built_in">set</span> nohlsearch|nohl           <span class="comment">#不高亮显示搜索结果</span></span><br></pre></td></tr></table></figure>

<h4 id="语法高亮"><a href="#语法高亮" class="headerlink" title="语法高亮"></a>语法高亮</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:syntax on               <span class="comment">#语法高亮</span></span><br><span class="line">:syntax off              <span class="comment">#关闭语法高亮</span></span><br></pre></td></tr></table></figure>

<h4 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> fileformat=dos|<span class="built_in">set</span> ff=doc      <span class="comment">#启用windows格式</span></span><br><span class="line">:<span class="built_in">set</span> fileformat=unix|<span class="built_in">set</span> ff=unix    <span class="comment">#启用unix格式</span></span><br></pre></td></tr></table></figure>

<h4 id="Tab-用空格代替"><a href="#Tab-用空格代替" class="headerlink" title="Tab 用空格代替"></a>Tab 用空格代替</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> expandtab|<span class="built_in">set</span> et               <span class="comment">#使用空格代替Tab，默认8个空格</span></span><br><span class="line">:<span class="built_in">set</span> noexpandtab|<span class="built_in">set</span> noet           <span class="comment">#禁用空格代替Tab</span></span><br></pre></td></tr></table></figure>

<h4 id="Tab用指定空格的个数代替"><a href="#Tab用指定空格的个数代替" class="headerlink" title="Tab用指定空格的个数代替"></a>Tab用指定空格的个数代替</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> tabstop=N|<span class="built_in">set</span> ts=N         <span class="comment">#指定N个空格代替Tab</span></span><br></pre></td></tr></table></figure>

<h4 id="设置缩进宽度"><a href="#设置缩进宽度" class="headerlink" title="设置缩进宽度"></a>设置缩进宽度</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;                            <span class="comment">#向右缩进 命令模式</span></span><br><span class="line">&lt;&lt;                            <span class="comment">#向左缩进 命令模式</span></span><br><span class="line"></span><br><span class="line">:<span class="built_in">set</span> shiftwidth=4             <span class="comment">#设置缩进为4个字符</span></span><br></pre></td></tr></table></figure>

<h4 id="设置光标所在行的标识线"><a href="#设置光标所在行的标识线" class="headerlink" title="设置光标所在行的标识线"></a>设置光标所在行的标识线</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> cursorline|<span class="built_in">set</span> cul             <span class="comment">#给光标所在行加下划线</span></span><br><span class="line">:<span class="built_in">set</span> nocursorline|<span class="built_in">set</span> nocul         <span class="comment">#取消光标下划线</span></span><br></pre></td></tr></table></figure>

<h4 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> key=password                   <span class="comment">#加密文档</span></span><br><span class="line">:<span class="built_in">set</span> key=                           <span class="comment">#取消加密</span></span><br></pre></td></tr></table></figure>

<h4 id="了解更多"><a href="#了解更多" class="headerlink" title="了解更多"></a>了解更多</h4><p><strong>set 帮助</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">help</span> option-list </span><br><span class="line">:<span class="built_in">set</span>|:<span class="built_in">set</span> all</span><br></pre></td></tr></table></figure>

<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>命令模式，又称为Normal模式，功能强大，但是在此模式下输入的命令不会在屏幕上显示，只能靠记忆记住到底输入了什么，所以此处我们 要记住大量快捷键；</p>
<h3 id="退出VIM"><a href="#退出VIM" class="headerlink" title="退出VIM"></a>退出VIM</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZZ              <span class="comment">#保存退出</span></span><br><span class="line">ZQ              <span class="comment">#不保存退出</span></span><br></pre></td></tr></table></figure>

<h3 id="光标跳转"><a href="#光标跳转" class="headerlink" title="光标跳转"></a>光标跳转</h3><p><strong>字符间跳转：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h               <span class="comment">#左</span></span><br><span class="line">L               <span class="comment">#右,小写字母</span></span><br><span class="line">j               <span class="comment">#下</span></span><br><span class="line">k               <span class="comment">#上</span></span><br><span class="line">Nh|Nl|Nj|Nk     <span class="comment">#每次跳转N个长度 2h表示向左移两个字符，3j表示向下走3行</span></span><br></pre></td></tr></table></figure>

<p><strong>单词间跳转</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w               <span class="comment">#下一个单词的词首</span></span><br><span class="line">e               <span class="comment">#当前或下一单词的词尾</span></span><br><span class="line">b               <span class="comment">#当前或前一个单词的词首</span></span><br><span class="line">Nw|Ne|Nb        <span class="comment">#一次跳N个单词</span></span><br></pre></td></tr></table></figure>

<p><strong>当前页跳转：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">H               <span class="comment">#页首</span></span><br><span class="line">M               <span class="comment">#页中间行</span></span><br><span class="line">L               <span class="comment">#页底</span></span><br><span class="line">zt              <span class="comment">#将光标所在当前行移到屏幕顶端</span></span><br><span class="line">zz              <span class="comment">#将光标所在当前行移到屏幕中间</span></span><br><span class="line">zb              <span class="comment">#将光标所在当前行移到屏幕底端</span></span><br></pre></td></tr></table></figure>

<p><strong>行首行尾跳转：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">^               <span class="comment">#跳转至行首的第一个非空白字符</span></span><br><span class="line">0               <span class="comment">#跳转至行首</span></span><br><span class="line">$               <span class="comment">#跳转至行尾</span></span><br></pre></td></tr></table></figure>

<p><strong>行间移动：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NG|:N           <span class="comment">#跳转至指定行,N表示正整数，比如 10G,或在扩展命令模式下:10,都表示跳转到第10行</span></span><br><span class="line">G               <span class="comment">#最后一行</span></span><br><span class="line">gg|1G           <span class="comment">#第一行</span></span><br></pre></td></tr></table></figure>

<p><strong>句间移动：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(               <span class="comment">#上一句</span></span><br><span class="line">)               <span class="comment">#下一句</span></span><br></pre></td></tr></table></figure>

<p><strong>段落间移动：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;               <span class="comment">#上一段</span></span><br><span class="line">&#125;               <span class="comment">#下一段</span></span><br></pre></td></tr></table></figure>

<p><strong>命令模式翻屏操作</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+f          <span class="comment">#向文件尾部翻一屏,相当于Pagedown</span></span><br><span class="line">Ctrl+b          <span class="comment">#向文件首部翻一屏,相当于Pageup</span></span><br><span class="line">Ctrl+d          <span class="comment">#向文件尾部翻半屏</span></span><br><span class="line">Ctrl+u          <span class="comment">#向文件首部翻半屏</span></span><br></pre></td></tr></table></figure>

<h3 id="字符编辑"><a href="#字符编辑" class="headerlink" title="字符编辑"></a>字符编辑</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x               <span class="comment">#剪切光标处的字符</span></span><br><span class="line">Nx              <span class="comment">#剪切光标处起始的N个字符,N为正整数</span></span><br><span class="line">xp              <span class="comment">#交换光标所在处的字符及其后面字符的位置,本质是先剪切，再粘贴</span></span><br><span class="line">~               <span class="comment">#转换大小写</span></span><br><span class="line">J               <span class="comment">#删除当前行后的换行符，就是把下一行接到当前行后面</span></span><br></pre></td></tr></table></figure>

<h3 id="替换命令-replace"><a href="#替换命令-replace" class="headerlink" title="替换命令(replace)"></a>替换命令(replace)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r               <span class="comment">#只替换光标所在处的一个字符,先敲r,再输入想要替换的新字符</span></span><br><span class="line">R               <span class="comment">#切换成REPLACE模式（在末行出现-- REPLACE -- 提示）,按ESC回到命令模式</span></span><br></pre></td></tr></table></figure>

<h3 id="删除命令-delete"><a href="#删除命令-delete" class="headerlink" title="删除命令(delete)"></a>删除命令(delete)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">d               <span class="comment">#删除命令，可结合光标跳转字符，实现范围删除</span></span><br><span class="line"></span><br><span class="line">d$|D            <span class="comment">#删除光标处到行尾</span></span><br><span class="line">d^              <span class="comment">#删除光标处到非空行首</span></span><br><span class="line">d0              <span class="comment">#删除光标处到处行首</span></span><br><span class="line">dw              <span class="comment">#从光标处删到下一个单词的词首</span></span><br><span class="line">de              <span class="comment">#从光标处删到当前单词词尾或下一单词的词尾</span></span><br><span class="line">db              <span class="comment">#从光标处删到当前单词词首或下一单词的词首</span></span><br><span class="line">dG              <span class="comment">#删除光标到文件末尾</span></span><br><span class="line">dgg             <span class="comment">#删除光标到文件开始</span></span><br><span class="line"><span class="built_in">dd</span>              <span class="comment">#删除光标所在行</span></span><br><span class="line">Ndd             <span class="comment">#从当前行开始，删N行，N表示正整数，2dd表示从当前行开始，总共删2行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这些内容都在缓冲区，可以用p键粘贴出来</span></span><br></pre></td></tr></table></figure>

<h3 id="复制命令-yank"><a href="#复制命令-yank" class="headerlink" title="复制命令(yank)"></a>复制命令(yank)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">y               <span class="comment">#复制，行为相似于d命令</span></span><br><span class="line"></span><br><span class="line">y$              <span class="comment">#复制光标处到行尾</span></span><br><span class="line">y0              <span class="comment">#复制光标处到行首</span></span><br><span class="line">y^              <span class="comment">#复制光标处到非空行首</span></span><br><span class="line">yy|Y            <span class="comment">#复制整行,yy前面加数字，表示从当前处往后复制多少行； 3yy 表示往下复制3行</span></span><br><span class="line">Nyy             <span class="comment">#从当前处往后复制N行, N表示正整数，2yy表示从当前行开始，总共复制2行</span></span><br><span class="line">yw              <span class="comment">#从光标处复制到下一个单词的词首</span></span><br><span class="line">ye              <span class="comment">#从光标处复制到当前单词词尾或下一单词的词尾</span></span><br><span class="line">yb              <span class="comment">#从光标处复制到当前单词词首或下一单词的词首</span></span><br></pre></td></tr></table></figure>

<h3 id="粘贴命令-paste"><a href="#粘贴命令-paste" class="headerlink" title="粘贴命令(paste)"></a>粘贴命令(paste)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p               <span class="comment">#缓冲区存的如果为整行，则粘贴当前光标所在行的下方；否则，则粘贴至当前光标所在处的后面</span></span><br><span class="line">P               <span class="comment">#缓冲区存的如果为整行，则粘贴当前光标所在行的上方；否则，则粘贴至当前光标所在处的前面</span></span><br></pre></td></tr></table></figure>

<h3 id="改变命令-change"><a href="#改变命令-change" class="headerlink" title="改变命令(change)"></a>改变命令(change)</h3><p>命令 c 删除后切换成插入模式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c$|C            <span class="comment">#删除光标处到行尾，并切换成插入模式</span></span><br><span class="line">c^              <span class="comment">#删除光标处到非空行首，并切换成插入模式</span></span><br><span class="line">c0              <span class="comment">#删除光标处到行首，并切换成插入模式</span></span><br><span class="line">cc              <span class="comment">#删除当前行并输入新内容，相当于S，加数字表示向下删除多少行，然后切换成插入模式</span></span><br><span class="line">Ncc             <span class="comment">#N表示正整数</span></span><br><span class="line">cw              <span class="comment">#从光标处删到下一个单词的词首，并切换成插入模式</span></span><br><span class="line">ce              <span class="comment">#从光标处删到当前单词词尾或下一单词的词尾，并切换成插入模式</span></span><br><span class="line">cb              <span class="comment">#从光标处删到当前单词词首或下一单词的词首，并切换成插入模式</span></span><br></pre></td></tr></table></figure>

<p><strong>命令模式操作文本总结</strong></p>
<p><img src="../../../../images/image/SRE/day05/5.png" alt="5"></p>
<h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/PATTERN        <span class="comment">#从当前光标所在处向文件尾部查找</span></span><br><span class="line">?PATTERN        <span class="comment">#从当前光标所在处向文件首部查找</span></span><br><span class="line">n               <span class="comment">#与命令同方向</span></span><br><span class="line">N               <span class="comment">#与命令反方向</span></span><br></pre></td></tr></table></figure>

<h3 id="撤消更改"><a href="#撤消更改" class="headerlink" title="撤消更改"></a>撤消更改</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">u               <span class="comment">#撤销最近的更改，相当于windows中ctrl+z</span></span><br><span class="line">Nu              <span class="comment">#撤销之前多次更改,N表示正整数</span></span><br><span class="line">U               <span class="comment">#撤消光标落在这行后所有此行的更改</span></span><br><span class="line">Ctrl+r          <span class="comment">#重做最后的“撤消”更改，相当于windows中crtl+y</span></span><br><span class="line">.               <span class="comment">#重复前一个操作</span></span><br><span class="line">N.              <span class="comment">#重复前一个操作N次，N为正整数</span></span><br></pre></td></tr></table></figure>

<h3 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;start position&gt;&lt;<span class="built_in">command</span>&gt;&lt;end position&gt;</span><br></pre></td></tr></table></figure>

<p>常见Command：y 复制、d 删除、gU 变大写、gu 变小写</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#START COMMAND END</span></span><br><span class="line"></span><br><span class="line">0y$             <span class="comment">#复制整行,0表示到行首，y表示复制，$表示行尾，连起来就是复制整行</span></span><br><span class="line">di<span class="string">&quot;&quot;</span>            <span class="comment">#光标在&quot; &quot;之间，则删除&quot; &quot;之间的内容</span></span><br><span class="line">yi()            <span class="comment">#光标在()之间，则复制()之间的内容</span></span><br><span class="line">vi[]            <span class="comment">#光标在[]之间，则选中[]之间的内容</span></span><br><span class="line">dtx             <span class="comment">#删除字符直到遇见光标之后的第一个 x 字符</span></span><br><span class="line">ytx             <span class="comment">#复制字符直到遇见光标之后的第一个 x 字符</span></span><br><span class="line">10iabc ESC      <span class="comment">#在光标处插入10个abc</span></span><br></pre></td></tr></table></figure>

<h2 id="可视化模式"><a href="#可视化模式" class="headerlink" title="可视化模式"></a>可视化模式</h2><p>在末行有“– VISUAL –” 指示，表示在可视化模式</p>
<p>允许选择的文本块</p>
<ul>
<li>v 面向字符，– VISUAL –  </li>
<li>V 面向整行，– VISUAL LINE –   </li>
<li>ctrl-v 面向块，– VISUAL BLOCK – </li>
</ul>
<p>可视化键可用于与移动键结合使用</p>
<p>w ) } 箭头等</p>
<p>突出显示的文字可被删除，复制，变更，过滤，搜索，替换等</p>
<p>范例：在文件指定行的行首插入#</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、先将光标移动到指定的第一行的行首</span><br><span class="line">2、输入ctrl+v 进入可视化模式</span><br><span class="line">3、向下移动光标，选中希望操作的每一行的第一个字符</span><br><span class="line">4、输入大写字母 I 切换至插入模式</span><br><span class="line">5、输入 <span class="comment"># </span></span><br><span class="line">6、按 ESC 键</span><br></pre></td></tr></table></figure>

<p>范例：在指定的块位置插入相同的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、光标定位到要操作的地方</span><br><span class="line">2、CTRL+v 进入“可视块”模式，选取这一列操作多少行</span><br><span class="line">3、SHIFT+i(I)</span><br><span class="line">4、输入要插入的内容</span><br><span class="line">5、按 ESC 键</span><br></pre></td></tr></table></figure>

<h2 id="多窗口模式"><a href="#多窗口模式" class="headerlink" title="多窗口模式"></a>多窗口模式</h2><h3 id="多文件分割"><a href="#多文件分割" class="headerlink" title="多文件分割"></a>多文件分割</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim FILE1 FILE2...</span><br><span class="line"></span><br><span class="line"><span class="comment">#多文件之间切换</span></span><br><span class="line">:next</span><br><span class="line">:prev</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim -o|-O FILE1 FILE2 ...</span><br><span class="line"></span><br><span class="line">-o                  <span class="comment">#水平或上下分割</span></span><br><span class="line">-O                  <span class="comment">#垂直或左右分割（vim only）</span></span><br><span class="line"></span><br><span class="line">:wqall              <span class="comment">#退出</span></span><br><span class="line">Ctrl+w, Arrow       <span class="comment">#在窗口间切换</span></span><br></pre></td></tr></table></figure>

<h3 id="单文件窗口分割"><a href="#单文件窗口分割" class="headerlink" title="单文件窗口分割"></a>单文件窗口分割</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+w,s            <span class="comment">#split, 水平分割，上下分屏</span></span><br><span class="line">Ctrl+w,v            <span class="comment">#vertical, 垂直分割，左右分屏</span></span><br><span class="line">ctrl+w,q            <span class="comment">#取消相邻窗口</span></span><br><span class="line">ctrl+w,o            <span class="comment">#取消全部窗口</span></span><br><span class="line">:wqall              <span class="comment">#退出</span></span><br><span class="line">Ctrl+w, Arrow       <span class="comment">#在窗口间切换</span></span><br></pre></td></tr></table></figure>

<h2 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">help</span></span><br><span class="line">:<span class="built_in">help</span> topic         <span class="comment">#topic 是指主题，比如 :help yy 就表示查看yy命令的用法</span></span><br><span class="line"></span><br><span class="line">:q                  <span class="comment">#退出help</span></span><br><span class="line"></span><br><span class="line">:<span class="built_in">help</span> index         <span class="comment">#列出所有主题</span></span><br></pre></td></tr></table></figure>

<p>vim 帮助程序</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># vimtutor</span></span><br></pre></td></tr></table></figure>

<h2 id="vim-总结图"><a href="#vim-总结图" class="headerlink" title="vim 总结图"></a>vim 总结图</h2><p><img src="../../../../images/image/SRE/day05/6.png" alt="6"></p>
<p><img src="../../../../images/image/SRE/day05/7.png" alt="7"></p>
<p><img src="../../../../images/image/SRE/day05/8.png" alt="8"></p>
<h1 id="文本常见处理工具"><a href="#文本常见处理工具" class="headerlink" title="文本常见处理工具"></a>文本常见处理工具</h1><h2 id="文件内容查看命令"><a href="#文件内容查看命令" class="headerlink" title="文件内容查看命令"></a>文件内容查看命令</h2><h3 id="查看文本文件内容"><a href="#查看文本文件内容" class="headerlink" title="查看文本文件内容"></a>查看文本文件内容</h3><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><p>cat 可以查看文本内容</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-E|--show-ends          <span class="comment">#显示行结束符$</span></span><br><span class="line">-A|--show-all           <span class="comment">#显示所有控制符</span></span><br><span class="line">-n|--number             <span class="comment">#对显示出的每一行进行编号</span></span><br><span class="line">-b|--number-nonblank    <span class="comment">#非空行编号</span></span><br><span class="line">-s|--squeeze-blank      <span class="comment">#压缩连续的空行成一行</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat -A /data/fa.txt</span></span><br><span class="line"> a   b$</span><br><span class="line"> c $</span><br><span class="line"> d^Ib^Ic$</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /data/fa.txt</span></span><br><span class="line"> a   b</span><br><span class="line"> c</span><br><span class="line"> d       b       c</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /data/fb.txt</span></span><br><span class="line"> a</span><br><span class="line"> b</span><br><span class="line"> c</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># hexdump -C /data/fb.txt</span></span><br><span class="line"> 00000000  61 0d 0a 62 0d 0a 63 0d 0a                        |a..b..c..|</span><br><span class="line"> 00000009</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat -A /data/fb.txt</span></span><br><span class="line"> a^M$</span><br><span class="line"> b^M$</span><br><span class="line"> c^M$</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># file /data/fb.txt</span></span><br><span class="line"> /data/fb.txt: ASCII text, with CRLF line terminators</span><br></pre></td></tr></table></figure>

<h4 id="nl"><a href="#nl" class="headerlink" title="nl"></a>nl</h4><p>显示行号，相当于cat -b</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat /data/f1.txt</span></span><br><span class="line"> a</span><br><span class="line"> b</span><br><span class="line"> c</span><br><span class="line"> d</span><br><span class="line"> e</span><br><span class="line"> f</span><br><span class="line"> g</span><br><span class="line"> h</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># nl /data/f1.txt</span></span><br><span class="line"> 1 a</span><br><span class="line"> 2 b</span><br><span class="line"> 3 c</span><br><span class="line"> 4 d</span><br><span class="line"> 5 e</span><br><span class="line"> 6 f</span><br><span class="line"> 7 g</span><br><span class="line"> 8 h</span><br></pre></td></tr></table></figure>

<h4 id="tac"><a href="#tac" class="headerlink" title="tac"></a>tac</h4><p>逆向显示文本内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat /data/fa.txt</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"> 5</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># tac /data/fa.txt</span></span><br><span class="line"> 5</span><br><span class="line"> 4</span><br><span class="line"> 3</span><br><span class="line"> 2</span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># tac</span></span><br><span class="line"> a</span><br><span class="line"> bb</span><br><span class="line"> ccc 按ctrl+d</span><br><span class="line"> ccc</span><br><span class="line"> bb</span><br><span class="line"> a</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 10 | tac</span></span><br><span class="line"> 10</span><br><span class="line"> 9</span><br><span class="line"> 8</span><br><span class="line"> 7</span><br><span class="line"> 6</span><br><span class="line"> 5</span><br><span class="line"> 4</span><br><span class="line"> 3</span><br><span class="line"> 2</span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>

<h4 id="rev"><a href="#rev" class="headerlink" title="rev"></a>rev</h4><p>将同一行的内容逆向显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat /data/fa.txt</span></span><br><span class="line"> 1 2 3 4 5</span><br><span class="line"> a b c</span><br><span class="line"></span><br><span class="line"><span class="comment">#上下顺序逆向</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># tac /data/fa.txt</span></span><br><span class="line"> a b c</span><br><span class="line"> 1 2 3 4 5</span><br><span class="line"></span><br><span class="line"><span class="comment">#逐行逆向</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># rev /data/fa.txt</span></span><br><span class="line"> 5 4 3 2 1</span><br><span class="line"> c b a</span><br><span class="line"></span><br><span class="line"><span class="comment">#标准输入</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># rev</span></span><br><span class="line"> abcdef</span><br><span class="line"> fedcba</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &#123;1..10&#125; |rev</span></span><br><span class="line"> 01 9 8 7 6 5 4 3 2 1</span><br></pre></td></tr></table></figure>

<h3 id="查看非文本文件内容"><a href="#查看非文本文件内容" class="headerlink" title="查看非文本文件内容"></a>查看非文本文件内容</h3><p>范例：hexdump</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># hexdump -C -n 512 /dev/sda</span></span><br><span class="line">00000000  eb 63 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.c..............|</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &#123;a..z&#125; | tr -d &#x27; &#x27;|hexdump -C</span></span><br><span class="line">00000000  61 62 63 64 65 66 67 68  69 6a 6b 6c 6d 6e 6f 70  |abcdefghijklmnop|</span><br><span class="line">00000010  71 72 73 74 75 76 77 78  79 7a 0a                 |qrstuvwxyz.|</span><br><span class="line">0000001b</span><br></pre></td></tr></table></figure>

<h2 id="分页查看文件内容"><a href="#分页查看文件内容" class="headerlink" title="分页查看文件内容"></a>分页查看文件内容</h2><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p>可以实现分页查看文件，可以配合管道实现输出信息的分页</p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">more [OPTIONS...] FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-d          <span class="comment">#在底部显示提示</span></span><br><span class="line">-s          <span class="comment">#压缩连续空行</span></span><br></pre></td></tr></table></figure>

<p>命令选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">空格键             <span class="comment">#翻页</span></span><br><span class="line">回车键             <span class="comment">#下一行</span></span><br><span class="line">!cmd              <span class="comment">#执行命令</span></span><br><span class="line">h                 <span class="comment">#显示帮助</span></span><br><span class="line">:f                <span class="comment">#显示文件名和当前行号</span></span><br><span class="line">=                 <span class="comment">#显示行号</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># more /var/log/messages</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /var/log/messages | more</span></span><br></pre></td></tr></table></figure>

<h3 id="less"><a href="#less" class="headerlink" title="less"></a>less</h3><p>less 也可以实现分页查看文件或STDIN输出，less 命令是man命令使用的分页器</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">less [OPTIONS...] FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-e          <span class="comment">#显示完成后自动退出</span></span><br><span class="line">-N          <span class="comment">#显示行号</span></span><br><span class="line">-s          <span class="comment">#压缩连续空行</span></span><br><span class="line">-S          <span class="comment">#不换行显示较长的内容</span></span><br></pre></td></tr></table></figure>

<p>命令选项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:h              <span class="comment">#显示帮助</span></span><br><span class="line">/string         <span class="comment">#搜索</span></span><br><span class="line">:!cmd           <span class="comment">#执行命令</span></span><br><span class="line">b               <span class="comment">#向上翻</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># less -N /etc/init.d/functions</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># tree / -d | less</span></span><br></pre></td></tr></table></figure>

<h2 id="显示文本前面或后面的行内容"><a href="#显示文本前面或后面的行内容" class="headerlink" title="显示文本前面或后面的行内容"></a>显示文本前面或后面的行内容</h2><h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><p>可以显示文件或标准输入的前面行</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">head</span> [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-c|--bytes=N                <span class="comment">#指定获取前N字节</span></span><br><span class="line">-n|--lines=N                <span class="comment">#指定获取前N行,N如果为负数,表示从文件头取到倒数第N前</span></span><br><span class="line">-N                          <span class="comment">#同上</span></span><br><span class="line">-q|--quiet|--silent         <span class="comment">#不输出文件名</span></span><br><span class="line">-v|--verbose                <span class="comment">#输出文件名</span></span><br><span class="line">-z|--zero-terminated        <span class="comment">#以NULL字符而非换行符作为行尾分隔符</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># head -n 3 /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># head -3 /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo a我b|head -c 4</span></span><br><span class="line">a我</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat /dev/urandom | tr -dc &#x27;[:alnum:]&#x27;|head -c 10</span></span><br><span class="line">b6TeJQlZBJ</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat /dev/urandom | tr -dc &#x27;[:alnum:]&#x27;|head -c 10 |tee pass.txt|passwd --stdin jerry</span></span><br><span class="line">Changing password <span class="keyword">for</span> user jerry.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># cat seq.log</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"> 5</span><br><span class="line"> 6</span><br><span class="line"> 7</span><br><span class="line"> 8</span><br><span class="line"> 9</span><br><span class="line"> 10</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># head -n 3 seq.log</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># head -n -3 seq.log</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"> 5</span><br><span class="line"> 6</span><br><span class="line"> 7</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># head -n +3 seq.log</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br></pre></td></tr></table></figure>

<h3 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h3><p>tail 和head 相反，查看文件或标准输入的倒数行</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-c|--bytes=N                <span class="comment">#指定获取后N字节</span></span><br><span class="line">-n|--lines=N                <span class="comment">#指定获取后N行,如果写成+N,表示从第N行开始到文件结束</span></span><br><span class="line">-N                          <span class="comment">#同上</span></span><br><span class="line">-f|--follow=descriptor      <span class="comment">#跟踪显示文件fd新追加的内容,常用日志监控，当删除再新建同名文件,将无法继续跟踪</span></span><br><span class="line">-F|--follow=name --retry    <span class="comment">#跟踪文件名，相当于--follow=name --retry，当删除文件再新建同名文件，可继续追踪</span></span><br><span class="line">-q|--quiet|--silent         <span class="comment">#不输出文件名</span></span><br><span class="line">-z|--zero-terminated        <span class="comment">#以 NULL字符而非换行符作为行尾分隔符</span></span><br><span class="line"></span><br><span class="line">tailf                       <span class="comment">#类似 tail –f，当文件不增长时并不访问文件,节约资源,CentOS8已经无此工具</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat /data/f1.txt</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"> 5</span><br><span class="line"> 6</span><br><span class="line"> 7</span><br><span class="line"> 8</span><br><span class="line"> 9</span><br><span class="line"> 10</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># tail -n 3 /data/f1.txt</span></span><br><span class="line"> 8</span><br><span class="line"> 9</span><br><span class="line"> 10</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># tail -n +3 /data/f1.txt</span></span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"> 5</span><br><span class="line"> 6</span><br><span class="line"> 7</span><br><span class="line"> 8</span><br><span class="line"> 9</span><br><span class="line"> 10</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># tail -3 /var/log/messages</span></span><br><span class="line">Sep  5 14:04:24 rocky8 systemd[1]: openvpn-server@server.service: Main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Sep  5 14:04:24 rocky8 systemd[1]: openvpn-server@server.service: Failed with result <span class="string">&#x27;exit-code&#x27;</span>.</span><br><span class="line">Sep  5 14:04:24 rocky8 systemd[1]: Failed to start OpenVPN service <span class="keyword">for</span> server.</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># tail -f /var/log/messages</span></span><br><span class="line">Sep  5 14:04:55 rocky8 openvpn[1798]: Options error: --ca fails with <span class="string">&#x27;ca.crt&#x27;</span>: No such file or directory (errno=2)</span><br><span class="line">Sep  5 14:04:55 rocky8 openvpn[1798]: Options error: --cert fails with <span class="string">&#x27;server_A7r9AfMWXrKibJBp.crt&#x27;</span>: No such file or directory (errno=2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#只查看最新发生的日志</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># tail -fn0 /var/log/messages</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># tail -0f /var/log/messages</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#取IP行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | head -2 | tail -1</span></span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | head -2 | tail -1 | tr -s &#x27; &#x27;| cut -d &#x27; &#x27; -f 3</span></span><br><span class="line">192.168.1.11</span><br></pre></td></tr></table></figure>

<h3 id="head-和-tail-总结"><a href="#head-和-tail-总结" class="headerlink" title="head 和 tail 总结"></a>head 和 tail 总结</h3><table>
<thead>
<tr>
<th>命令</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>head -n k file</td>
<td>取 file 前 k 行内容</td>
<td>head -n 3 /etc/passwd</td>
</tr>
<tr>
<td>head -k file</td>
<td>取 file 前 k 行内容</td>
<td>head -3 /etc/passwd</td>
</tr>
<tr>
<td>head -n +k file</td>
<td>取 file 前 k 行内容</td>
<td>head -n +3 /etc/passwd</td>
</tr>
<tr>
<td>head -n -k file</td>
<td>取 file 第一行到倒数第 k 行内容</td>
<td>head -n -3 /etc/passwd</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>tail -n k file</td>
<td>从后往前数，取 file 第一行到第 k 行内容</td>
<td>tail -n 3 /etc/passwd</td>
</tr>
<tr>
<td>tail -k file</td>
<td>从后往前数，取 file 第一行到第 k 行内容</td>
<td>tail -3 /etc/passwd</td>
</tr>
<tr>
<td>tail -n -k file</td>
<td>从后往前数，取 file 第一行到第 k 行内容</td>
<td>tail -n -3 /etc/passwd</td>
</tr>
<tr>
<td>tail -n +k file</td>
<td>从后往前数，取 file 第一行到倒数第 k 行内容</td>
<td>tail -n +3 /etc/passwd</td>
</tr>
</tbody></table>
<p><img src="../../../../images/image/SRE/day05/9.png" alt="9"></p>
<p>范例: 显示第6行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># seq 20 | head -n 6 | tail -n 1</span></span><br><span class="line">6</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 20 | tail -n +6 | head -n 1</span></span><br><span class="line">6</span><br></pre></td></tr></table></figure>

<h2 id="按列抽取文本-cut"><a href="#按列抽取文本-cut" class="headerlink" title="按列抽取文本 cut"></a>按列抽取文本 cut</h2><p>cut 命令可以提取文本文件或 STDIN 数据的指定列</p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cut</span> OPTION... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-b|--bytes=LIST              <span class="comment">#以字节分割，指定要显示的列</span></span><br><span class="line">-c|--characters=LIST         <span class="comment">#以字符分割，指定要显示的列</span></span><br><span class="line">-d|--delimiter=DELIM         <span class="comment">#指定分割符，默认是tab</span></span><br><span class="line">-f|--fields=LIST             <span class="comment">#要显示的列，-f1,  -f1,2,3,  -f 1-3,4</span></span><br><span class="line">-s|--only-delimited          <span class="comment">#不显示没有包括分割符的内容</span></span><br><span class="line">--output-delimiter=STRING    <span class="comment">#输出的时候用指定字符代替分割符</span></span><br><span class="line">-z|--zero-terminated         <span class="comment">#以 NUL 字符而非换行符作为行尾分隔符</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cut -d : -f 1,3-4,7 /etc/passwd</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | head -n 2 | tail -n 1 | cut -d &quot; &quot; -f 10</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | head -n 2 | tail -n 1 | tr -s &quot; &quot; | cut -d &quot; &quot; -f 3</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f 5 | tr -dc &quot;[0-9\n]&quot;</span></span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">21</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; % | cut -d % -f 5 | tr -d &#x27;[:alpha:]&#x27;</span></span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">21</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | cut -c49-51 | tr -d &#x27;[:alpha:]&#x27;</span></span><br><span class="line"><span class="comment"># 49-51 是指</span></span><br><span class="line"><span class="comment"># devtmpfs               897456       0    897456   0% /dev</span></span><br><span class="line"><span class="comment"># 从头开始数第49个字符到第51个字符，根据实际情况看%前面的就行</span></span><br><span class="line">  0</span><br><span class="line">  0</span><br><span class="line">  1</span><br><span class="line">  0</span><br><span class="line">  3</span><br><span class="line">  1</span><br><span class="line"> 21</span><br><span class="line">  0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cut -d : -f 1,3,7 --output-delimiter=&quot;---&quot; /etc/passwd</span></span><br><span class="line">root---0---/bin/bash</span><br><span class="line">bin---1---/sbin/nologin</span><br><span class="line">daemon---2---/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 dict]<span class="comment"># echo &#123;1..10&#125; | cut -d &#x27; &#x27; -f 1-10 --output-delimiter=&quot;+&quot; | bc</span></span><br><span class="line">55</span><br></pre></td></tr></table></figure>

<p>范例: 取分区利用率</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#取分区利用率</span></span><br><span class="line">[root@rocky8 dict]<span class="comment"># df | tr -s &#x27; &#x27;| cut -d &#x27; &#x27; -f 5 | tr -d %</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; &#x27;%&#x27;|cut -d % -f 5</span></span><br><span class="line">Use</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">21</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | cut -c49-51 | tail -n +2</span></span><br><span class="line">  0</span><br><span class="line">  0</span><br><span class="line">  2</span><br><span class="line">  0</span><br><span class="line">  3</span><br><span class="line">  1</span><br><span class="line"> 21</span><br><span class="line">  0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tail -n +2 | tr -s &#x27; &#x27; % | cut -d % -f 5</span></span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">0</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">21</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tail -n +2 | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f 5 |tr -d %</span></span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">0</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">21</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="合并多个文件-paste"><a href="#合并多个文件-paste" class="headerlink" title="合并多个文件 paste"></a>合并多个文件 paste</h2><p>paste 合并多个文件同行号的列到一行</p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">paste</span> [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-d|--delimiters=LIST        <span class="comment">#指定分割符，默认用TAB</span></span><br><span class="line">-s|--serial                 <span class="comment">#合成一行显示</span></span><br><span class="line">-z|--zero-terminated        <span class="comment">#以 NUL 字符而非换行符作为行尾分隔符</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo &#123;a..h&#125; | tr &#x27; &#x27; &quot;\n&quot; &gt; alpha.log</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat alpha.log </span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br><span class="line">f</span><br><span class="line">g</span><br><span class="line">h</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 5 &gt; seq.log</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat seq.log </span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat alpha.log seq.log </span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br><span class="line">f</span><br><span class="line">g</span><br><span class="line">h</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste alpha.log seq.log </span></span><br><span class="line">a	1</span><br><span class="line">b	2</span><br><span class="line">c	3</span><br><span class="line">d	4</span><br><span class="line">e	5</span><br><span class="line">f	</span><br><span class="line">g	</span><br><span class="line">h	</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -d &quot;:&quot; alpha.log seq.log </span></span><br><span class="line">a:1</span><br><span class="line">b:2</span><br><span class="line">c:3</span><br><span class="line">d:4</span><br><span class="line">e:5</span><br><span class="line">f:</span><br><span class="line">g:</span><br><span class="line">h:</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -s alpha.log </span></span><br><span class="line">a	b	c	d	e	f	g	h</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -s seq.log</span></span><br><span class="line">1	2	3	4	5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -s alpha.log seq.log </span></span><br><span class="line">a	b	c	d	e	f	g	h</span><br><span class="line">1	2	3	4	5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat title.txt </span></span><br><span class="line">ceo</span><br><span class="line">coo</span><br><span class="line">cto</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat emp.txt </span></span><br><span class="line">mage</span><br><span class="line">zhang</span><br><span class="line">wang</span><br><span class="line">xu</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste title.txt emp.txt </span></span><br><span class="line">ceo	mage</span><br><span class="line">coo	zhang</span><br><span class="line">cto	wang</span><br><span class="line">	xu</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -s title.txt emp.txt </span></span><br><span class="line">ceo	coo	cto</span><br><span class="line">mage	zhang	wang	xu</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat f1.log </span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat f2.log </span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br><span class="line">f</span><br><span class="line">g</span><br><span class="line">h</span><br><span class="line">i</span><br><span class="line">j</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -s -d : f1.log f2.log </span></span><br><span class="line">1:2:3:4:5:6:7:8:9:10</span><br><span class="line">a:b:c:d:e:f:g:h:i:j</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | paste -s -d + |bc</span></span><br><span class="line">55</span><br></pre></td></tr></table></figure>

<p>范例: 批量修改密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat &gt; user.txt &lt;&lt;EOF</span></span><br><span class="line">&gt; jose</span><br><span class="line">&gt; jerry</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat &gt; pass.txt &lt;&lt;EOF</span></span><br><span class="line">&gt; 123456</span><br><span class="line">&gt; 000000</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -d : user.txt pass.txt </span></span><br><span class="line">jose:123456</span><br><span class="line">jerry:000000</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># paste -d : user.txt pass.txt | chpasswd </span></span><br></pre></td></tr></table></figure>

<h2 id="分析文本的工具"><a href="#分析文本的工具" class="headerlink" title="分析文本的工具"></a>分析文本的工具</h2><p>文本数据统计：wc  </p>
<p>整理文本：sort  </p>
<p>比较文件：diff和patch</p>
<h3 id="收集文本统计数据-wc"><a href="#收集文本统计数据-wc" class="headerlink" title="收集文本统计数据 wc"></a>收集文本统计数据 wc</h3><p>wc 命令可用于统计文件的行总数、单词总数、字节总数和字符总数，可以对文件或STDIN中的数据统计</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wc</span> [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-l|--lines              <span class="comment">#只计数行数</span></span><br><span class="line">-w|--words              <span class="comment">#只计数单词总数</span></span><br><span class="line">-c|--bytes              <span class="comment">#只计数字节总数</span></span><br><span class="line">-m|--chars              <span class="comment">#只计数字符总数</span></span><br><span class="line">-L|--max-line-length    <span class="comment">#显示文件中最长行的长度</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wc</span> story.txt </span><br><span class="line">39     237    1901 story.txt</span><br><span class="line">行数   单词数   字节数</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat title.txt </span></span><br><span class="line">ceo</span><br><span class="line">coo</span><br><span class="line">cto</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># wc title.txt </span></span><br><span class="line"> 3  3 12 title.txt</span><br><span class="line"> </span><br><span class="line"><span class="comment">#仅显示行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># wc -l title.txt </span></span><br><span class="line">3 title.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#管道重定向</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat title.txt | wc -l</span></span><br><span class="line">3</span><br><span class="line"></span><br><span class="line"><span class="comment">#不显示第一行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tail -n $(echo `df|wc -l` -1|bc)</span></span><br><span class="line">devtmpfs               897456       0    897456   0% /dev</span><br><span class="line">tmpfs                  916616       0    916616   0% /dev/shm</span><br><span class="line">tmpfs                  916616   20332    896284   3% /run</span><br><span class="line">tmpfs                  916616       0    916616   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root 136248320 3148716 133099604   3% /</span><br><span class="line">/dev/mapper/rl-home  68124160  508224  67615936   1% /home</span><br><span class="line">/dev/sda1             1038336  216736    821600  21% /boot</span><br><span class="line">tmpfs                  183320       0    183320   0% /run/user/0</span><br></pre></td></tr></table></figure>

<h3 id="文本排序-sort"><a href="#文本排序-sort" class="headerlink" title="文本排序 sort"></a>文本排序 sort</h3><p>把整理过的文本显示在STDOUT，不改变原始文件</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span> [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-b|--ignore-leading-blanks      <span class="comment">#忽略文件中的空白</span></span><br><span class="line">-f|--ignore-case                <span class="comment">#忽略大小写</span></span><br><span class="line">-h|--human-numeric-sort         <span class="comment">#人类可读排序</span></span><br><span class="line">-M|--month-sort                 <span class="comment">#以月份排序</span></span><br><span class="line">-n|--numeric-sort               <span class="comment">#以数字大小排序</span></span><br><span class="line">-R|--random-sort                <span class="comment">#随机排序</span></span><br><span class="line">-r|-reverse                     <span class="comment">#倒序</span></span><br><span class="line">-t|--field-separator=SEP        <span class="comment">#指定列分割符</span></span><br><span class="line">-k|--key=KEYDEF                 <span class="comment">#指定排序列</span></span><br><span class="line">-u|--unique                     <span class="comment">#去重</span></span><br><span class="line">-z|--zero-terminated            <span class="comment">#以 NUL 字符而非换行符作为行尾分隔符</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cut -d : -f 1,3 /etc/passwd | sort -t : -k 2 -nr | head -3</span></span><br><span class="line">nobody:65534</span><br><span class="line">varnish:1029</span><br><span class="line">nginx:1028</span><br><span class="line"></span><br><span class="line"><span class="comment">#统计日志访问量</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cut -d&quot; &quot; -f1 /var/log/nginx/access_log |sort -u|wc -l</span></span><br><span class="line">202</span><br></pre></td></tr></table></figure>

<p>范例：统计分区利用率</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># df</span></span><br><span class="line">Filesystem          1K-blocks    Used Available Use% Mounted on</span><br><span class="line">devtmpfs               897456       0    897456   0% /dev</span><br><span class="line">tmpfs                  916616       0    916616   0% /dev/shm</span><br><span class="line">tmpfs                  916616   20332    896284   3% /run</span><br><span class="line">tmpfs                  916616       0    916616   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root 136248320 3149228 133099092   3% /</span><br><span class="line">/dev/mapper/rl-home  68124160  508224  67615936   1% /home</span><br><span class="line">/dev/sda1             1038336  216736    821600  21% /boot</span><br><span class="line">tmpfs                  183320       0    183320   0% /run/user/0</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看分区最高利用率</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; % |cut -d % -f 5|tr -d &#x27;[:alpha:]&#x27;|sort -rn|head -1</span></span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; % |cut -d % -f 5|tr -d &#x27;[:alpha:]&#x27;|sort -r</span></span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">21</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; % |cut -d % -f 5|tr -d &#x27;[:alpha:]&#x27;|sort -n</span></span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; % |cut -d % -f 5|tr -d &#x27;[:alpha:]&#x27;|sort -n|tail -n 1</span></span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; % |cut -d % -f 5|tr -d &#x27;[:alpha:]&#x27;|sort -nr|head -n 1</span></span><br><span class="line">21</span><br></pre></td></tr></table></figure>

<p>面试题：有两个文件，a.txt与b.txt ，合并两个文件，并输出时确保每个数字也唯一</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat 1.txt </span></span><br><span class="line">1111</span><br><span class="line">222</span><br><span class="line">33</span><br><span class="line">4444</span><br><span class="line">5</span><br><span class="line">666</span><br><span class="line">77</span><br><span class="line">8</span><br><span class="line">9999</span><br><span class="line">100000</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat 2.txt </span></span><br><span class="line">8</span><br><span class="line">1111</span><br><span class="line">33</span><br><span class="line">222</span><br><span class="line">100000</span><br><span class="line">77</span><br><span class="line">159</span><br><span class="line">666</span><br><span class="line">137</span><br><span class="line">189</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat 1.txt 2.txt |sort -n |uniq</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat 1.txt 2.txt |sort -nu</span></span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">33</span><br><span class="line">77</span><br><span class="line">137</span><br><span class="line">159</span><br><span class="line">189</span><br><span class="line">222</span><br><span class="line">666</span><br><span class="line">1111</span><br><span class="line">4444</span><br><span class="line">9999</span><br><span class="line">100000</span><br></pre></td></tr></table></figure>

<h3 id="去重-uniq"><a href="#去重-uniq" class="headerlink" title="去重 uniq"></a>去重 uniq</h3><p>uniq命令从输入中删除前后相接的重复的行，常和 sort 配合使用</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uniq</span> [OPTION]... [INPUT [OUTPUT]]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项</span></span><br><span class="line">-c|--count                  <span class="comment">#显示每行出现次数</span></span><br><span class="line">-d|--repeated               <span class="comment">#仅显示有重复行</span></span><br><span class="line">-D                          <span class="comment">#显示所有重复行具体内容</span></span><br><span class="line">-u|--unique                 <span class="comment">#仅显示不重复的行</span></span><br><span class="line">-z|--zero-terminated        <span class="comment">#以 NUL 字符而非换行符作为行尾分隔符</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sort -n 1.txt 2.txt |uniq -c</span></span><br><span class="line">      1 5</span><br><span class="line">      2 8</span><br><span class="line">      2 33</span><br><span class="line">      2 77</span><br><span class="line">      1 137</span><br><span class="line">      1 159</span><br><span class="line">      1 189</span><br><span class="line">      2 222</span><br><span class="line">      2 666</span><br><span class="line">      2 1111</span><br><span class="line">      1 4444</span><br><span class="line">      1 9999</span><br><span class="line">      2 100000</span><br></pre></td></tr></table></figure>

<p>范例：统计日志访问量最多的前三名的请求</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># lastb | head -n $(echo `lastb | wc -l`-2 | bc) | tr -s &#x27; &#x27; | cut -d &quot; &quot; -f3 | sort | uniq -c | sort -nr | head -3</span></span><br><span class="line"> 17 10.0.0.1</span><br></pre></td></tr></table></figure>

<p>范例：取两个文件的相同和不同的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#取相同行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat 1.txt 2.txt  | sort | uniq -d</span></span><br><span class="line"> 100000</span><br><span class="line"> 1111</span><br><span class="line"> 222</span><br><span class="line"> 33</span><br><span class="line"> 666</span><br><span class="line"> 77</span><br><span class="line"> 8</span><br><span class="line"></span><br><span class="line"><span class="comment">#取文件的不同行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat 1.txt 2.txt  | sort | uniq -u</span></span><br><span class="line"> 137</span><br><span class="line"> 159</span><br><span class="line"> 189</span><br><span class="line"> 4444</span><br><span class="line"> 5</span><br><span class="line"> 9999</span><br></pre></td></tr></table></figure>

<h3 id="比较文件"><a href="#比较文件" class="headerlink" title="比较文件"></a>比较文件</h3><h4 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h4><p>diff 命令比较两个文件之间的区别</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">diff [OPTION]... FILES</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-u		<span class="comment">#选项来输出“统一的（unified）”diff格式文件，最适用于补丁文件</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat f1.txt </span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat f2.txt </span></span><br><span class="line">3</span><br><span class="line">7</span><br><span class="line">2</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># diff -u f1.txt f2.txt </span></span><br><span class="line">--- f1.txt	2024-09-08 16:54:47.648321426 +0800</span><br><span class="line">+++ f2.txt	2024-09-08 16:55:03.037322301 +0800</span><br><span class="line">@@ -1,3 +1,4 @@             <span class="comment">#比较结果，- 表示第一个文件， + 表示第二个文件，第一个文件有3行，第二个文件有4行</span></span><br><span class="line">-1                          <span class="comment">#第一个文件此行去掉</span></span><br><span class="line">-2                          <span class="comment">#第一个文件此行去掉</span></span><br><span class="line"> 3</span><br><span class="line">+7                          <span class="comment">#第一个文件加上此行内容</span></span><br><span class="line">+2                          <span class="comment">#第一个文件加上此行内容</span></span><br><span class="line">+5                          <span class="comment">#第一个文件加上此行内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将对比结果保存至文件</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># diff -u f1.txt f2.txt &gt; f.patch</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># rm -f f2.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用来还原</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># patch -b f1.txt f.patch </span></span><br><span class="line">patching file f1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#原还出来的是 f2</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat f1.txt</span></span><br><span class="line">3</span><br><span class="line">7</span><br><span class="line">2</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat f1.txt.orig </span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h4 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h4><p>patch　复制在其它文件中进行的改变（要谨慎使用） </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">patch [OPTION]... [ORIGFILE [PATCHFILE]]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-b|--backup   <span class="comment">#备份</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># patch -b f1.txt f.patch </span></span><br><span class="line">patching file f1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#用f1.txt和 f.patch 生成一个名为f1.txt的文件，但内容是原来f2.txt文件中的内容，</span></span><br><span class="line"><span class="comment">#-b 选项则备份了现有的 f1.txt</span></span><br></pre></td></tr></table></figure>

<h4 id="vimdiff"><a href="#vimdiff" class="headerlink" title="vimdiff"></a>vimdiff</h4><p>相当于 vim -d</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># which vimdiff </span></span><br><span class="line"> /usr/bin/vimdiff</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /usr/bin/vimdiff </span></span><br><span class="line"> lrwxrwxrwx. 1 root root 3 Aug  2  2022 /usr/bin/vimdiff -&gt; vim</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># vimdiff f1.txt f2.txt</span></span><br></pre></td></tr></table></figure>

<h4 id="cmp"><a href="#cmp" class="headerlink" title="cmp"></a>cmp</h4><p>范例：查看二进制文件的不同</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ll /usr/bin/dir /usr/bin/ls</span></span><br><span class="line">-rwxr-xr-x. 1 root root 143400 Oct 21  2021 /usr/bin/dir</span><br><span class="line">-rwxr-xr-x. 1 root root 143400 Oct 21  2021 /usr/bin/ls</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll /usr/bin/dir /usr/bin/ls -i</span></span><br><span class="line">267929 -rwxr-xr-x. 1 root root 143400 Oct 21  2021 /usr/bin/dir</span><br><span class="line">267950 -rwxr-xr-x. 1 root root 143400 Oct 21  2021 /usr/bin/ls</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># diff /usr/bin/dir /usr/bin/ls</span></span><br><span class="line">Binary files /usr/bin/dir and /usr/bin/ls differ</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cmp /bin/dir /bin/ls</span></span><br><span class="line">/bin/dir /bin/ls differ: byte 793, line 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#跳过前735个字节,观察后面30个字节</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># hexdump -s 735 -Cn 30 /bin/ls</span></span><br><span class="line">000002df  00 03 00 00 00 00 00 00  00 04 00 00 00 10 00 00  |................|</span><br><span class="line">000002ef  00 01 00 00 00 47 4e 55  00 00 00 00 00 03        |.....GNU......|</span><br><span class="line">000002fd</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># hexdump -s 735 -Cn 30 /bin/dir</span></span><br><span class="line">000002df  00 03 00 00 00 00 00 00  00 04 00 00 00 10 00 00  |................|</span><br><span class="line">000002ef  00 01 00 00 00 47 4e 55  00 00 00 00 00 03        |.....GNU......|</span><br><span class="line">000002fd</span><br></pre></td></tr></table></figure>

<p><strong>练习</strong></p>
<ol>
<li>找出ifconfig “网卡名” 命令结果中本机的IPv4地址 </li>
<li>查出分区空间使用率的最大百分比值  </li>
<li>查出用户UID最大值的用户名、UID及shell类型  </li>
<li>查出/tmp的权限，以数字方式显示 </li>
<li>统计当前连接本机的每个远程主机IP的连接数，并按从大到小排序</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | head -2 | tail -1 | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f 3</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | tr -s &#x27; &#x27; % | cut -d % -f 5 | tr -d &quot;[:alpha:]&quot; | sort -nr | head -1</span></span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># cut -d : -f 1,3-4,7 /etc/passwd | sort -t : -k 2 -nr | head -1</span></span><br><span class="line">nobody:65534:65534:/sbin/nologin</span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># stat /tmp/ | tail -n +4 | head -1 | tr -d &quot;[:alpha:]&quot; | cut -d : -f 2 | tr -d &quot;(/)&quot; </span></span><br><span class="line"> 1777</span><br><span class="line"></span><br><span class="line">5.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># lastb | head -n $(echo `lastb | wc -l`-2 | bc) | tr -s &#x27; &#x27; | cut -d &quot; &quot; -f3 | sort | uniq -c | sort -nr | head -3</span></span><br></pre></td></tr></table></figure>

<h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><p>REGEXP： Regular Expressions，由一类特殊字符及文本字符所编写的模式；其中有些字符（元字符）不表示字符字面意义，而表示控制或 通配的功能，类似于增强版的通配符功能；但与通配符不同，<strong>通配符功能是用来处理文件名，而正则表达式是处理文本内容中字符；</strong> </p>
<p>正则表达式被很多程序和开发语言所广泛支持：vim, less,grep,sed,awk, nginx,mysql 等; </p>
<p>正则表达式分两类：</p>
<ul>
<li>基本正则表达式：BRE Basic Regular Expressions； </li>
<li>扩展正则表达式：ERE Extended Regular Expressions；</li>
</ul>
<p>正则表达式引擎： </p>
<p>采用不同算法，检查处理正则表达式的软件模块，如：PCRE（Perl Compatible Regular Expressions） </p>
<p>正则表达式的元字符分类： </p>
<p>字符匹配、匹配次数、位置锚定、分组 </p>
<p>帮助：man 7 regex</p>
<h2 id="基本正则表达式元字符"><a href="#基本正则表达式元字符" class="headerlink" title="基本正则表达式元字符"></a>基本正则表达式元字符</h2><h3 id="字符匹配"><a href="#字符匹配" class="headerlink" title="字符匹配"></a>字符匹配</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.               <span class="comment">#匹配任意单个字符(除了\n)，可以是一个汉字或其它国家的文字</span></span><br><span class="line">[]              <span class="comment">#匹配指定范围内的任意单个字符，示例：[wang]   [0-9]   [a-z]   [a-zA-Z]</span></span><br><span class="line">[^]             <span class="comment">#匹配指定范围外的任意单个字符,示例：[^wang]</span></span><br><span class="line">[:alnum:]       <span class="comment">#字母和数字</span></span><br><span class="line">[:alpha:]       <span class="comment">#代表任何英文大小写字符，亦即 A-Z, a-z</span></span><br><span class="line">[:lower:]       <span class="comment">#小写字母,示例:[[:lower:]],相当于[a-z]</span></span><br><span class="line">[:upper:]       <span class="comment">#大写字母</span></span><br><span class="line">[:blank:]       <span class="comment">#空白字符（空格和制表符）</span></span><br><span class="line">[:space:]       <span class="comment">#包括空格、制表符(水平和垂直)、换行符、回车符等各种类型的空白,比[:blank:]包含的范围广</span></span><br><span class="line">[:cntrl:]       <span class="comment">#不可打印的控制字符（退格、删除、警铃...）</span></span><br><span class="line">[:digit:]       <span class="comment">#十进制数字</span></span><br><span class="line">[:xdigit:]      <span class="comment">#十六进制数字</span></span><br><span class="line">[:graph:]       <span class="comment">#可打印的非空白字符</span></span><br><span class="line">[:<span class="built_in">print</span>:]       <span class="comment">#可打印字符</span></span><br><span class="line">[:punct:]       <span class="comment">#标点符号</span></span><br><span class="line"></span><br><span class="line">--------------------------------------</span><br><span class="line"></span><br><span class="line">\s              <span class="comment">#匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [\f\r\t\v], Unicode正则表达式会匹配全角空格符</span></span><br><span class="line">\S              <span class="comment">#匹配任何非空白字符。等价于 [^\f\r\t\v]</span></span><br><span class="line">\w              <span class="comment">#匹配一个字母,数字,下划线,汉字,其它国家文字的字符，等价于[_[:alnum:]字]</span></span><br><span class="line">\W              <span class="comment">#匹配一个非字母,数字,下划线,汉字,其它国家文字的字符，等价于[^_[:alnum:]字]</span></span><br></pre></td></tr></table></figure>

<p>范例：匹配任意单个字符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;r.t&quot; /etc/passwd</span></span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;r..t&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo a你好b | grep a..b</span></span><br><span class="line">a你好b</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo aaa你好b | grep a..b</span></span><br><span class="line">aaa你好b</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo aaa你-b | grep a..b</span></span><br><span class="line">aaa你-b</span><br></pre></td></tr></table></figure>

<p>范例：范围匹配</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ls /etc/ | grep &#x27;rc[.0-6]&#x27;</span></span><br><span class="line">rc0.d</span><br><span class="line">rc1.d</span><br><span class="line">rc2.d</span><br><span class="line">rc3.d</span><br><span class="line">rc4.d</span><br><span class="line">rc5.d</span><br><span class="line">rc6.d</span><br><span class="line">rc.d</span><br><span class="line">rc.local</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls /etc/ | grep &#x27;rc[.0-6].&#x27;</span></span><br><span class="line">rc0.d</span><br><span class="line">rc1.d</span><br><span class="line">rc2.d</span><br><span class="line">rc3.d</span><br><span class="line">rc4.d</span><br><span class="line">rc5.d</span><br><span class="line">rc6.d</span><br><span class="line">rc.d</span><br><span class="line">rc.local</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls /etc/ | grep &#x27;rc[.0-6]\.&#x27;</span></span><br><span class="line">rc0.d</span><br><span class="line">rc1.d</span><br><span class="line">rc2.d</span><br><span class="line">rc3.d</span><br><span class="line">rc4.d</span><br><span class="line">rc5.d</span><br><span class="line">rc6.d</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo ma | grep [lmn]</span></span><br><span class="line">ma</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo ma | grep [^lmn]</span></span><br><span class="line">ma</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab1c2d3e4444fABCg$%^&quot; | grep &quot;[0-Z]&quot;</span></span><br><span class="line">ab1c2d3e4444fABCg$%^</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab1c2d3e4444fABCg$%^&quot; | grep &quot;[0-z]&quot;</span></span><br><span class="line">ab1c2d3e4444fABCg$%^</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab1c2d3e4444fABCg$%^&quot; | grep &quot;[0-9]&quot;</span></span><br><span class="line">ab1c2d3e4444fABCg$%^</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab1c2d3e4444fABCg$%^&quot; | grep &quot;[a-z]&quot;</span></span><br><span class="line">ab1c2d3e4444fABCg$%^</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab1c2d3e4444fABCg$%^&quot; | grep &quot;[A-Z]&quot;</span></span><br><span class="line">ab1c2d3e4444fABCg$%^</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab1c2d3e4444fABCg$%^&quot; | grep &quot;[^0-Z]&quot;</span></span><br><span class="line">ab1c2d3e4444fABCg$%^</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab1c2d3e4444fABCg$%^&quot; | grep &quot;[[:punct:]]&quot;</span></span><br><span class="line">ab1c2d3e4444fABCg$%^</span><br><span class="line"></span><br><span class="line"><span class="comment">#匹配空格</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;1 2 3&quot; | grep &quot;[[:blank:]]&quot;</span></span><br><span class="line">1 2 3</span><br><span class="line"></span><br><span class="line"><span class="comment">#匹配非空格</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;1 2 3&quot; | grep &quot;[^[:blank:]]&quot;</span></span><br><span class="line">1 2 3</span><br></pre></td></tr></table></figure>

<h3 id="匹配次数"><a href="#匹配次数" class="headerlink" title="匹配次数"></a>匹配次数</h3><p>用在要指定次数的字符后面，用于指定前面的字符要出现的次数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*           <span class="comment">#匹配前面的字符任意次，包括0次，贪婪模式：尽可能长的匹配</span></span><br><span class="line">.*          <span class="comment">#任意长度的任意字符</span></span><br><span class="line">\?          <span class="comment">#匹配其前面的字符出现0次或1次,即:可有可无</span></span><br><span class="line">\+          <span class="comment">#匹配其前面的字符出现最少1次,即:肯定有且 &gt;=1 次 </span></span><br><span class="line">\&#123;n\&#125;       <span class="comment">#匹配前面的字符n次</span></span><br><span class="line">\&#123;m,n\&#125;     <span class="comment">#匹配前面的字符至少m次，至多n次</span></span><br><span class="line">\&#123;,n\&#125;      <span class="comment">#匹配前面的字符至多n次,&lt;=n</span></span><br><span class="line">\&#123;n,\&#125;      <span class="comment">#匹配前面的字符至少n次</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;rt&quot; | grep &quot;ro*t&quot;</span></span><br><span class="line">rt</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;rot&quot; | grep &quot;ro*t&quot;</span></span><br><span class="line">rot</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;root&quot; | grep &quot;ro*t&quot;</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;rooooooot&quot; | grep &quot;ro*t&quot;</span></span><br><span class="line">rooooooot</span><br></pre></td></tr></table></figure>

<p>范例：任意长度任意字符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;r.*t&quot; /etc/passwd</span></span><br></pre></td></tr></table></figure>

<p>范例：0次或1次</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo /etc/ | grep &quot;/etc/\?&quot;</span></span><br><span class="line">/etc/</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo /etc | grep &quot;/etc/\?&quot;</span></span><br><span class="line">/etc</span><br></pre></td></tr></table></figure>

<p>范例：1次或多次</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo google | grep &quot;go\+gle&quot;</span></span><br><span class="line">google</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo gogle | grep &quot;go\+gle&quot;</span></span><br><span class="line">gogle</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo ggle | grep &quot;go\+gle&quot;</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo gooogle | grep &quot;go\+gle&quot;</span></span><br><span class="line">gooogle</span><br></pre></td></tr></table></figure>

<p>范例：自定义次数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo google | grep &quot;go\&#123;2\&#125;gle&quot;</span></span><br><span class="line"> google</span><br><span class="line"></span><br><span class="line"><span class="comment">#2次到5次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo google | grep &quot;go\&#123;2,5\&#125;gle&quot;</span></span><br><span class="line"> google</span><br><span class="line"></span><br><span class="line"><span class="comment">#2次到多次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo google | grep &quot;go\&#123;2,\&#125;gle&quot;</span></span><br><span class="line"> google</span><br><span class="line"></span><br><span class="line"><span class="comment">#0次到2次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo google | grep &quot;go\&#123;,2\&#125;gle&quot;</span></span><br><span class="line"> google</span><br></pre></td></tr></table></figure>

<p>范例: 匹配正负数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo -1 -2 123 -123 234 | grep &#x27;-\?[0-9]\+&#x27;</span></span><br><span class="line">grep: invalid option -- <span class="string">&#x27;\&#x27;</span></span><br><span class="line">Usage: grep [OPTION]... PATTERN [FILE]...</span><br><span class="line">Try <span class="string">&#x27;grep --help&#x27;</span> <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要把 - 转义</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo -1 -2 123 -123 234 | grep &#x27;\-\?[0-9]\+&#x27;</span></span><br><span class="line">-1 -2 123 -123 234</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo -1 -2 123 -123 234 | grep -E &#x27;-?[0-9]+&#x27;</span></span><br><span class="line">grep: invalid option -- <span class="string">&#x27;?&#x27;</span></span><br><span class="line">Usage: grep [OPTION]... PATTERN [FILE]...</span><br><span class="line">Try <span class="string">&#x27;grep --help&#x27;</span> <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo -1 -2 123 -123 234 | grep -E &#x27;\-?[0-9]+&#x27;</span></span><br><span class="line">-1 -2 123 -123 234</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo -1 -2 123 -123 234 | grep -E -- &#x27;-?[0-9]+&#x27;</span></span><br><span class="line">-1 -2 123 -123 234</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo -1 -2 123 -123 234 | grep -E &#x27;(-)?[0-9]+&#x27;</span></span><br><span class="line">-1 -2 123 -123 234</span><br></pre></td></tr></table></figure>

<p>范例: 取IP地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160</span></span><br><span class="line">ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 fe80::20c:29ff:fe51:f282  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:51:f2:82  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 2128  bytes 179640 (175.4 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 1506  bytes 144441 (141.0 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | grep -o &#x27;[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;&#x27; | head -1</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep -o 只输出匹配到的</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | grep netmask | grep -o &#x27;[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;&#x27; | head -1</span></span><br><span class="line">192.168.1.11</span><br></pre></td></tr></table></figure>

<h3 id="位置锚定"><a href="#位置锚定" class="headerlink" title="位置锚定"></a>位置锚定</h3><p>位置锚定可以用于定位出现的位置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">^               <span class="comment">#行首锚定, 用于模式的最左侧</span></span><br><span class="line">$               <span class="comment">#行尾锚定，用于模式的最右侧</span></span><br><span class="line">^PATTERN$       <span class="comment">#用于模式匹配整行</span></span><br><span class="line">^$              <span class="comment">#空行</span></span><br><span class="line">^[[:space:]]*$  <span class="comment">#空白行</span></span><br><span class="line">\&lt; 或 \b        <span class="comment">#词首锚定，用于单词模式的左侧</span></span><br><span class="line">\&gt; 或 \b        <span class="comment">#词尾锚定，用于单词模式的右侧</span></span><br><span class="line">\&lt;PATTERN\&gt;     <span class="comment">#匹配整个单词</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意: 单词是由字母,数字,下划线组成</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#以 # 开头</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^#&quot; /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以 bash 结尾</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;bash$&quot; /etc/passwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#所有空行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^$&quot; /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#所有非空行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;^$&quot; /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#所有非注释行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^[^#]&quot; /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#排除所有空行和注释行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;^$&quot; /etc/profile | grep -v &quot;^#&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同上</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v -e &quot;^$&quot; -v -e &quot;^#&quot; /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同上</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v  &quot;^$\|^#&quot; /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#匹配单词</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo mage | grep &quot;\&lt;mage\&gt;&quot;</span></span><br><span class="line">mage</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo mage- | grep &quot;\&lt;mage\&gt;&quot;</span></span><br><span class="line">mage-</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo magee | grep &quot;\&lt;mage\&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep &#x27;^[^#]&#x27; /etc/fstab </span></span><br><span class="line">/dev/mapper/rl-root     /                       xfs     defaults        0 0</span><br><span class="line">UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07 /boot                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-swap     none                    swap    defaults        0 0</span><br></pre></td></tr></table></figure>

<h3 id="分组其它"><a href="#分组其它" class="headerlink" title="分组其它"></a>分组其它</h3><h4 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h4><p>分组：() 将多个字符捆绑在一起，当作一个整体处理，如：(root)+  </p>
<p>后向引用：分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部的变量中，这些变量的命名方式为: \1, \2, \3, …  </p>
<p>\1 表示从左侧起第一个左括号以及与之匹配右括号之间的模式所匹配到的字符  </p>
<p>注意: \0 表示正则表达式匹配的所有字符</p>
<p>示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ab,然后c出现3次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo abccc | grep &quot;abc\&#123;3\&#125;&quot;</span></span><br><span class="line">abccc</span><br><span class="line"></span><br><span class="line"><span class="comment">#abc作为一个整体出现3次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo abcabcabc | grep &quot;\(abc\)\&#123;3\&#125;&quot;</span></span><br><span class="line">abcabcabc</span><br><span class="line"></span><br><span class="line"><span class="comment">#后向引用</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo abcabcabc | grep &quot;\(abc\)\1&quot;</span></span><br><span class="line">abcabcabc</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo abcabcabc | grep &quot;\(abc\)\1\1&quot;</span></span><br><span class="line">abcabcabc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#\1表示引用第一个分组的内容，即 abc</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;abcdefabc&quot; | grep &quot;\(abc\)def\1&quot;</span></span><br><span class="line">abcdefabc</span><br><span class="line"></span><br><span class="line"><span class="comment">#\1表示引用第一个分组的内容，即abc,\&#123;3\&#125;表示引用内容出现3次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;abc-def-abcabcabc&quot; | grep &quot;\(abc\)-\(def\)-\1\&#123;3\&#125;&quot;</span></span><br><span class="line">abc-def-abcabcabc</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo abc-def-abcabcabc-def-abc-defdef | grep &quot;^\(abc\)-\(def\)-\1\&#123;3\&#125;-\2-\1-\2\&#123;2\&#125;&quot;</span></span><br><span class="line">abc-def-abcabcabc-def-abc-defdef</span><br><span class="line"></span><br><span class="line"><span class="comment">#取IP</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | grep -o &quot;\([0-9]\&#123;1,3\&#125;\.\)\&#123;3\&#125;[0-9]\&#123;1,3\&#125;&quot;|head -1</span></span><br><span class="line">192.168.1.11</span><br></pre></td></tr></table></figure>

<p>注意： 后向引用引用前面的分组括号中的模式所匹配字符，而非模式本身</p>
<h4 id="或者"><a href="#或者" class="headerlink" title="或者"></a>或者</h4><p>或者：|  </p>
<p>示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">a\|b			<span class="comment">#a或b</span></span><br><span class="line">C\|<span class="built_in">cat</span>			<span class="comment">#C或cat</span></span><br><span class="line">\(C\|c\)at		<span class="comment">#Cat或cat</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#a或b	a\|b</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;a&quot; | grep &quot;a\|b&quot;</span></span><br><span class="line"> a</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;b&quot; | grep &quot;a\|b&quot;</span></span><br><span class="line"> b</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;ab&quot; | grep &quot;a\|b&quot;</span></span><br><span class="line"> ab</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;abc&quot; | grep &quot;a\|b&quot;</span></span><br><span class="line"> abc</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;cab&quot; | grep &quot;a\|b&quot;</span></span><br><span class="line"> cab</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;acb&quot; | grep &quot;a\|b&quot;</span></span><br><span class="line"> acb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#12a 或 b   12a\|b</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12a&quot; | grep &quot;12a\|b&quot;</span></span><br><span class="line"> 12a</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;b&quot; | grep &quot;12a\|b&quot;</span></span><br><span class="line"> b</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ab&quot; | grep &quot;12a\|b&quot;</span></span><br><span class="line"> 12ab</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ba&quot; | grep &quot;12a\|b&quot;</span></span><br><span class="line"> 12ba</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#12a 或 12b   12a\|12b</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12a&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12a</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12b&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12b</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ab&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12ab</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ba&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12ba</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#12a 或 12b   12\(a\|b\)</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12a&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12a</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12b&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12b</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ab&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12ab</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ba&quot; | grep &quot;12\(a\|b\)&quot;</span></span><br><span class="line"> 12ba</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#12a 或 12b   12[ab]</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12a&quot; | grep &quot;12[ab]&quot;</span></span><br><span class="line"> 12a</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12b&quot; | grep &quot;12[ab]&quot;</span></span><br><span class="line"> 12b</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ab&quot; | grep &quot;12[ab]&quot;</span></span><br><span class="line"> 12ab</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;12ba&quot; | grep &quot;12[ab]&quot;</span></span><br><span class="line"> 12ba</span><br></pre></td></tr></table></figure>

<p>范例：排除空行和#开头的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;^#&quot; /etc/httpd/conf/httpd.conf | grep -v ^$</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &#x27;^#\|^$&#x27; /etc/httpd/conf/httpd.conf</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &#x27;^\(#\|$\)&#x27; /etc/httpd/conf/httpd.conf</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^[^#]&quot; /etc/httpd/conf/httpd.conf</span></span><br></pre></td></tr></table></figure>

<h3 id="正则表达式练习"><a href="#正则表达式练习" class="headerlink" title="正则表达式练习"></a>正则表达式练习</h3><ol>
<li>显示/proc/meminfo文件中以大小s开头的行(要求：使用两种方法)</li>
<li>显示/etc/passwd文件中不以/bin/bash结尾的行 </li>
<li>显示用户rpc默认的shell程序 </li>
<li>找出/etc/passwd中的两位或三位数 </li>
<li>显示CentOS7的/etc/grub2.cfg文件中，至少以一个空白字符开头的且后面有非空白字符的行</li>
<li>找出“netstat -tan”命令结果中以LISTEN后跟任意多个空白字符结尾的行 </li>
<li>显示CentOS7上所有UID小于1000以内的用户名和UID </li>
<li>添加用户bash、testbash、basher、sh、nologin(其shell为/sbin/nologin),找出/etc/passwd用户名 和shell同名的行</li>
<li>利用df和grep，取出磁盘各分区利用率，并从大到小排序</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^\(s\|S\)&quot; /proc/meminfo </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^[sS]&quot; /proc/meminfo </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;/bin/bash$&quot; /etc/passwd | grep bin/bash</span></span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep rpc /etc/passwd | cut -d : -f 7</span></span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;:\([0-9]\&#123;2\&#125;\|[0-9]\&#123;3\&#125;\):&quot; /etc/passwd</span></span><br><span class="line"></span><br><span class="line">5.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^ \+&quot; /etc/grub2.cfg</span></span><br><span class="line"></span><br><span class="line">6.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># netstat -tan | grep &quot;LISTEN \+$&quot;</span></span><br><span class="line"></span><br><span class="line">7.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;[0-9]\&#123;4\&#125;&quot; /etc/passwd | cut -d : -f 1,3</span></span><br><span class="line"></span><br><span class="line">8.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># cut -d : -f 1,7 /etc/passwd | grep -E &quot;^([^:]+):/s?bin/\\1$&quot;</span></span><br><span class="line"></span><br><span class="line">9.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | grep -o &quot;[0-9]\&#123;,4\&#125;%&quot; | tail -n +2 | sort -nr</span></span><br></pre></td></tr></table></figure>

<h2 id="扩展正则表达式元字符"><a href="#扩展正则表达式元字符" class="headerlink" title="扩展正则表达式元字符"></a>扩展正则表达式元字符</h2><h3 id="字符匹配-1"><a href="#字符匹配-1" class="headerlink" title="字符匹配"></a>字符匹配</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.               <span class="comment">#任意单个字符</span></span><br><span class="line">[wang]          <span class="comment">#指定范围的字符</span></span><br><span class="line">[^wang]         <span class="comment">#不在指定范围的字符</span></span><br><span class="line">[:alnum:]       <span class="comment">#字母和数字</span></span><br><span class="line">[:alpha:]       <span class="comment">#代表任何英文大小写字符，亦即 A-Z, a-z</span></span><br><span class="line">[:lower:]       <span class="comment">#小写字母,示例:[[:lower:]],相当于[a-z]</span></span><br><span class="line">[:upper:]       <span class="comment">#大写字母</span></span><br><span class="line">[:blank:]       <span class="comment">#空白字符（空格和制表符）</span></span><br><span class="line">[:space:]       <span class="comment">#水平和垂直的空白字符（比[:blank:]包含的范围广）</span></span><br><span class="line">[:cntrl:]       <span class="comment">#不可打印的控制字符（退格、删除、警铃...）</span></span><br><span class="line">[:digit:]       <span class="comment">#十进制数字</span></span><br><span class="line">[:xdigit:]      <span class="comment">#十六进制数字</span></span><br><span class="line">[:graph:]       <span class="comment">#可打印的非空白字符</span></span><br><span class="line">[:<span class="built_in">print</span>:]       <span class="comment">#可打印字符</span></span><br><span class="line">[:punct:]       <span class="comment">#标点符号</span></span><br></pre></td></tr></table></figure>

<h3 id="匹配次数-1"><a href="#匹配次数-1" class="headerlink" title="匹配次数"></a>匹配次数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*               <span class="comment">#匹配前面字符任意次</span></span><br><span class="line">?               <span class="comment">#0或1次</span></span><br><span class="line">+               <span class="comment">#1次或多次</span></span><br><span class="line">&#123;n&#125;             <span class="comment">#匹配n次</span></span><br><span class="line">&#123;m,n&#125;           <span class="comment">#至少m，至多n次</span></span><br></pre></td></tr></table></figure>

<h3 id="位置锚定-1"><a href="#位置锚定-1" class="headerlink" title="位置锚定"></a>位置锚定</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">^           <span class="comment">#行首</span></span><br><span class="line">$           <span class="comment">#行尾</span></span><br><span class="line">\&lt;, \b      <span class="comment">#词首</span></span><br><span class="line">\&gt;, \b      <span class="comment">#词尾</span></span><br></pre></td></tr></table></figure>

<h3 id="分组其它-1"><a href="#分组其它-1" class="headerlink" title="分组其它"></a>分组其它</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">() 分组         <span class="comment">#后向引用：\1, \2, ... 注意: \0 表示正则表达式匹配的所有字符</span></span><br><span class="line">|              <span class="comment">#或者</span></span><br><span class="line">a|b            <span class="comment">#a或b</span></span><br><span class="line">C|<span class="built_in">cat</span>          <span class="comment">#C或cat</span></span><br><span class="line">(C|c)at        <span class="comment">#Cat或cat</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | grep -Ewo &quot;(([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\.)&#123;3&#125;([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])&quot;|head -1</span></span><br><span class="line">192.168.1.11</span><br></pre></td></tr></table></figure>

<h3 id="扩展正则表达式练习"><a href="#扩展正则表达式练习" class="headerlink" title="扩展正则表达式练习"></a>扩展正则表达式练习</h3><ol>
<li>显示三个用户root、mage、wang的UID和默认shell</li>
<li>找出/etc/rc.d/init.d/functions文件中行首为某单词(包括下划线)后面跟一个小括号的行</li>
<li>使用egrep取出/etc/rc.d/init.d/functions中其基名</li>
<li>使用egrep取出上面路径的目录名</li>
<li>统计last命令中以root登录的每个主机IP地址登录次数</li>
<li>利用扩展正则表达式分别表示0-9、10-99、100-199、200-249、250-255</li>
<li>显示ifconfig命令结果中所有IPv4地址</li>
<li>将此字符串：welcome to magedu linux 中的每个字符去重并排序，重复次数多的排到前面</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^\(root\|mage\|wang\)&quot; /etc/passwd | cut -d : -f 1,7</span></span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep &quot;^[[:alpha:]]*()&quot; /etc/rc.d/init.d/functions</span></span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;/etc/rc.d/init.d/functions&quot; | egrep -o &#x27;[^/]+$&#x27;</span></span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;/etc/rc.d/init.d/functions&quot; | egrep -o &#x27;^/.*/&#x27;</span></span><br><span class="line"></span><br><span class="line">5.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># last | grep root | awk &#x27;&#123;print $3&#125;&#x27; | grep -oP &#x27;\b(?:[0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&#x27; | sort | uniq -c</span></span><br><span class="line"></span><br><span class="line">6.</span><br><span class="line">[0-9]	1[0-9][0-9]	2[0-4][0-9]	25[0-5]</span><br><span class="line"></span><br><span class="line">7.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | grep -Eo &quot;(([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\.)&#123;3&#125;([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])&quot;</span></span><br><span class="line"></span><br><span class="line">8.</span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;welcome to megedu linux&quot; | fold -w1 | grep -v &quot;^ $&quot; | sort | uniq -c | sort -nr</span></span><br><span class="line">      4 e</span><br><span class="line">      2 u</span><br><span class="line">      2 o</span><br><span class="line">      2 m</span><br><span class="line">      2 l</span><br><span class="line">      1 x</span><br><span class="line">      1 w</span><br><span class="line">      1 t</span><br><span class="line">      1 n</span><br><span class="line">      1 i</span><br><span class="line">      1 g</span><br><span class="line">      1 d</span><br><span class="line">      1 c</span><br></pre></td></tr></table></figure>

<h1 id="文本处理三剑客"><a href="#文本处理三剑客" class="headerlink" title="文本处理三剑客"></a>文本处理三剑客</h1><p>grep 命令主要对文本的（正则表达式）行基于模式进行过滤  </p>
<p>sed：stream editor，文本编辑工具  </p>
<p>awk：Linux上的实现gawk，文本报告生成器</p>
<h2 id="文本处理三剑客之-grep"><a href="#文本处理三剑客之-grep" class="headerlink" title="文本处理三剑客之 grep"></a>文本处理三剑客之 grep</h2><p>grep:  Global search REgular expression and Print out the line </p>
<p>作用：文本搜索工具，根据用户指定的 “模式” 对目标文本逐行进行匹配检查；打印匹配到的行 </p>
<p>模式：由正则表达式字符及文本字符所编写的过滤条件 </p>
<p>帮助</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://man7.org/linux/man-pages/man1/grep.1.html</span><br></pre></td></tr></table></figure>

<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">grep [OPTIONS] PATTERN [FILE...]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常见选项：</span></span><br><span class="line">-E|--extended-regexp        <span class="comment">#使用ERE，相当于egrep</span></span><br><span class="line">-F|--fixed-strings          <span class="comment">#不支持正则表达式，相当于fgrep</span></span><br><span class="line">-G|--basic-regexp           <span class="comment">#将样式视为普通的表示法来使用</span></span><br><span class="line">-P|--perl-regexp            <span class="comment">#支持Perl格式的正则表达式</span></span><br><span class="line">-e|--regexp=PATTERN         <span class="comment">#实现多个选项间的逻辑or关系,如：grep –e ‘cat &#x27; -e ‘dog&#x27; file</span></span><br><span class="line">-f|--file=FILE              <span class="comment">#从文件中读取匹配规则，每行一条</span></span><br><span class="line">-i|--ignore-case            <span class="comment">#忽略字符大小写</span></span><br><span class="line">-w|--word-regexp            <span class="comment">#匹配整个单词</span></span><br><span class="line">-x|--line-regexp            <span class="comment">#整行匹配</span></span><br><span class="line">-s|--no-messages            <span class="comment">#不显示错误信息</span></span><br><span class="line">-v|--invert-match           <span class="comment">#显示没有被匹配上的行，即取反</span></span><br><span class="line">-B|--before-context=N       <span class="comment">#显示匹配到的字符串所在的行及其前N行</span></span><br><span class="line">-A|--after-context=N        <span class="comment">#显示匹配到的字符串所在的行及其后n行</span></span><br><span class="line">-C|--context=N              <span class="comment">#显示匹配到的字符串所在的行及其前后各N行</span></span><br><span class="line">-N                          <span class="comment">#同 --context=N</span></span><br><span class="line">--color=auto                <span class="comment">#对匹配到的内容高亮显示[always|never|auto]</span></span><br><span class="line">-m|--max-count=N            <span class="comment">#只匹配N行，是行，不是次数，一行可能匹配两个，但是，这里是行</span></span><br><span class="line">-b|--byte-offset            <span class="comment">#显示匹配行第一个字符的编号</span></span><br><span class="line">-n|--line-number            <span class="comment">#显示匹配的行号</span></span><br><span class="line">-H|--with-filename          <span class="comment">#显示匹配行所在的文件名</span></span><br><span class="line">-h|--no-filename            <span class="comment">#不显示匹配行所在的文件名</span></span><br><span class="line">-o|--only-matching          <span class="comment">#仅显示匹配到的字符串</span></span><br><span class="line">-q|--quiet|--silent         <span class="comment">#静默模式，不输出任何信息，结果要从变量$0拿</span></span><br><span class="line">--binary-files=TYPE         <span class="comment">#指定二进制文件类型 [binary|text|without-match]</span></span><br><span class="line">-a|--text                   <span class="comment">#同 --binary-files=text</span></span><br><span class="line">-I                          <span class="comment">#同 --binary-files=without-match</span></span><br><span class="line">-d|--directories=ACTION     <span class="comment">#怎样查找目录 [read|recurse|skip]</span></span><br><span class="line">-D|--devices=ACTION         <span class="comment">#怎样查找设备文件 [read|skip]</span></span><br><span class="line">-r|--recursive              <span class="comment">#递归目录，但不处理软链接</span></span><br><span class="line">-R|--dereference-recursive  <span class="comment">#递归目录，但处理软链接</span></span><br><span class="line">-L|--files-without-match    <span class="comment">#显示没有匹配上的文件名，只显示文件名</span></span><br><span class="line">-l|--files-with-matches     <span class="comment">#显示匹配上的文件名，只显示文件名</span></span><br><span class="line">-c|--count                  <span class="comment">#统计匹配的行数，是行数，一行可以匹配一次到多次</span></span><br></pre></td></tr></table></figure>

<p>范例：标准输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep hello</span></span><br><span class="line"> 123hello456</span><br><span class="line"> 123hello456</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># grep hello -</span></span><br><span class="line"> 123hello456 </span><br><span class="line"> 123hello456</span><br></pre></td></tr></table></figure>

<p>范例：处理文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep root /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：管道</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat /etc/passwd | grep root</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：标准输入重定向</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep root &lt; /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：取前三行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -m 3 bin /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line"> daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：取反，取不匹配的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -v nologin /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> <span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line"> shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line"> halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line"> jose:x:1010:1010::/home/jose:/bin/bash</span><br><span class="line"> jerry:x:1011:1011::/home/jerry:/bin/bash</span><br><span class="line"> mage:x:1000:1000::/home/mage:/bin/bash</span><br><span class="line"> </span><br><span class="line"><span class="comment">#不看注释行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># grep -v &quot;#&quot; /etc/fstab </span></span><br></pre></td></tr></table></figure>

<p>范例：不区分大小写</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -i ROOt /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：显示行号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep  -n root /etc/passwd</span></span><br><span class="line"> 1:root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> 10:operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：显示匹配的行数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -c root /etc/passwd</span></span><br><span class="line"> 2</span><br></pre></td></tr></table></figure>

<p>范例：仅显示匹配到的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -o root /etc/passwd</span></span><br><span class="line"> root</span><br><span class="line"> root</span><br><span class="line"> root</span><br><span class="line"> root</span><br></pre></td></tr></table></figure>

<p>范例：静默模式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -q root /etc/passwd</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0 为执行成功，1 为执行失败</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># grep -q roottttttt /etc/passwd</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>

<p>范例：显示匹配到的行及后两行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -A 2 root /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line"> daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"> --</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"> games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line"> ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：显示匹配到的行及前两行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -C 2 root /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line"> daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"> --</span><br><span class="line"> halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line"> mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"> games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line"> ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：显示匹配root的行或匹配 bash 的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -e root -e bash /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"> jose:x:1010:1010::/home/jose:/bin/bash</span><br><span class="line"> jerry:x:1011:1011::/home/jerry:/bin/bash</span><br><span class="line"> mage:x:1000:1000::/home/mage:/bin/bash</span><br></pre></td></tr></table></figure>

<p>范例：显示匹配root的行且匹配 bash 的行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep root /etc/passwd | grep bash</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>范例：从文件读取匹配规则</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat test.txt </span></span><br><span class="line"> root</span><br><span class="line"> bash</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># grep -f test.txt /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"> jose:x:1010:1010::/home/jose:/bin/bash</span><br><span class="line"> jerry:x:1011:1011::/home/jerry:/bin/bash</span><br><span class="line"> mage:x:1000:1000::/home/mage:/bin/bash</span><br></pre></td></tr></table></figure>

<p>范例：递归匹配</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不处理链接</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># grep -r root  /etc/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#处理链接</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># grep -R root  /etc/*</span></span><br></pre></td></tr></table></figure>

<p>范例：只显示有匹配到的文件的文件名，不显示具体内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep root -l /etc/passwd /etc/sudoers /etc/my.cnf /etc/issue</span></span><br><span class="line"> /etc/passwd</span><br><span class="line"> /etc/sudoers</span><br></pre></td></tr></table></figure>

<p>范例：显示内容来自于哪个文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -H root /etc/passwd /etc/sudoers /etc/my.cnf /etc/issue</span></span><br><span class="line"> /etc/passwd:root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> /etc/passwd:operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"> /etc/sudoers:<span class="comment">## the root user, without needing the root password.</span></span><br><span class="line"> /etc/sudoers:<span class="comment">## Allow root to run any commands anywhere </span></span><br><span class="line"> /etc/sudoers:root   ALL=(ALL)   ALL</span><br><span class="line"> /etc/sudoers:<span class="comment">## cdrom as root</span></span><br></pre></td></tr></table></figure>

<p>范例：命令行展开</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep `whoami` /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># grep $(whoami) /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo Linux123 | grep $(uname) </span></span><br><span class="line"> Linux123</span><br></pre></td></tr></table></figure>

<p>范例：变量展开</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep &quot;$USER&quot; /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：取CPU核数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># grep -c processor /proc/cpuinfo</span></span><br><span class="line"> 2</span><br></pre></td></tr></table></figure>

<p>范例: 分区利用率最大的值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># df | grep &#x27;^/dev/sd&#x27; | tr -s &#x27; &#x27; % | cut -d % -f 5 | sort -n | tail -1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | grep &#x27;^/dev/sd&#x27; | grep -oE &#x27;\&lt;[0-9]&#123;,3&#125;%&#x27; | tr -d % | sort -nr | head -1</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | grep &#x27;^/dev/sd&#x27; | grep -oE &#x27;\&lt;[0-9]&#123;,3&#125;%&#x27; | grep -Eo &#x27;[0-9]+&#x27; | sort -nr | head -1</span></span><br></pre></td></tr></table></figure>

<p>范例: 哪个IP和当前主机连接数最多的前三位</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ss -nt | grep &quot;^ESTAB&quot; |tr -s &#x27; &#x27; : |cut -d: -f6|sort |uniq -c|sort -nr|head -n3</span></span><br></pre></td></tr></table></figure>

<p>范例: 连接状态的统计</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ss -nta | grep -v &#x27;^State&#x27; |cut -d&quot; &quot; -f1|sort |uniq -c</span></span><br><span class="line">      1 ESTAB</span><br><span class="line">      3 LISTEN</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ss -nta | tail -n +2 |cut -d&quot; &quot; -f1|sort |uniq -c</span></span><br><span class="line">      1 ESTAB</span><br><span class="line">      3 LISTEN</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;^#&quot; /etc/profile | grep -v &quot;^$&quot;</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;^#\|^$&quot; /etc/profile</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -v &quot;^\(#\|$\)&quot; /etc/profile</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -Ev &quot;^(#|$)&quot; /etc/profile</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># egrep -v &quot;^(#|$)&quot; /etc/profile</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># egrep -v &#x27;^(#|$)&#x27; /etc/httpd/conf/httpd.conf</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep -o r..t /etc/passwd</span></span><br><span class="line"> root</span><br><span class="line"> root</span><br><span class="line"> root</span><br><span class="line"> root</span><br><span class="line"> r/ft</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | grep -E &#x27;[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;&#x27;</span></span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.25</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | grep -E &#x27;([0-9]&#123;1,3&#125;.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27;</span></span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.25</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | grep -Eo &#x27;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27; | head -1</span></span><br><span class="line"> 192.168.1.11</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat &gt; regex.txt &lt;&lt; EOF</span></span><br><span class="line">&gt; ([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig | grep -oEf regex.txt </span></span><br><span class="line"> 192.168.1.11</span><br><span class="line"> 255.255.255.0</span><br><span class="line"> 192.168.1.255</span><br><span class="line"> 127.0.0.1</span><br><span class="line"> 255.0.0.0</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep -E &#x27;root|bash&#x27; /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"> jose:x:1000:1000::/home/jose:/bin/bash</span><br><span class="line"> u1:x:1024:1024::/home/u1:/bin/bash</span><br><span class="line"> u2:x:1025:1025::/home/u2:/bin/bash</span><br><span class="line"> u3:x:1026:1026::/home/u3:/bin/bash</span><br><span class="line"> jerry:x:1001:1001:tom to jerry:/home/tom:/bin/bash</span><br><span class="line"> bash:x:1030:1032::/home/bash:/sbin/nologin</span><br><span class="line"> basher:x:1031:1033::/home/basher:/sbin/nologin</span><br><span class="line"> testbash:x:1034:1036::/home/testbash:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -e &#x27;root&#x27; -e &#x27;bash&#x27; /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"> jose:x:1000:1000::/home/jose:/bin/bash</span><br><span class="line"> u1:x:1024:1024::/home/u1:/bin/bash</span><br><span class="line"> u2:x:1025:1025::/home/u2:/bin/bash</span><br><span class="line"> u3:x:1026:1026::/home/u3:/bin/bash</span><br><span class="line"> jerry:x:1001:1001:tom to jerry:/home/tom:/bin/bash</span><br><span class="line"> bash:x:1030:1032::/home/bash:/sbin/nologin</span><br><span class="line"> basher:x:1031:1033::/home/basher:/sbin/nologin</span><br><span class="line"> testbash:x:1034:1036::/home/testbash:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep -w root /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep  &#x27;\&lt;root\&gt;&#x27; /etc/passwd</span></span><br><span class="line"> root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep &#x27;^\(.*\)\&gt;.*\&lt;\1$&#x27; /etc/passwd</span></span><br><span class="line"> <span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line"> shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line"> halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line"> nologin:x:1033:1035::/home/nologin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -E &quot;^(.*)\&gt;.*\&lt;\1$&quot; /etc/passwd</span></span><br><span class="line"> <span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line"> shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line"> halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line"> nologin:x:1033:1035::/home/nologin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># egrep &quot;^(.*)\&gt;.*\&lt;\1$&quot; /etc/passwd</span></span><br><span class="line"> <span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line"> shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line"> halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line"> nologin:x:1033:1035::/home/nologin:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例: 过滤掉文件的注释(包括#号的行)和空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># grep -Ev &quot;#|^$)&quot; /etc/fstab </span></span><br><span class="line"></span><br><span class="line">/dev/mapper/rl-root     /                       xfs     defaults        0 0</span><br><span class="line">UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07 /boot                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-swap     none                    swap    defaults        0 0</span><br></pre></td></tr></table></figure>

<p>范例：面试题，算出所有人的年龄总和</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat age.txt </span></span><br><span class="line"> xiaoming=20</span><br><span class="line"> xiaohong=18</span><br><span class="line"> xiaoqiang=22</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cut -d = -f 2 age.txt | tr &#x27;\n&#x27; + | grep -Eo &quot;.*[0-9]&quot; | bc</span></span><br><span class="line">60</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -Eo &quot;[0-9]+&quot; age.txt | tr &#x27;\n&#x27; + | grep -Eo &quot;.*[0-9]&quot; | bc</span></span><br><span class="line">60</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -Eo &quot;[0-9]+&quot; age.txt | paste -s -d + | bc</span></span><br><span class="line">60</span><br></pre></td></tr></table></figure>

<h2 id="文本处理三剑客之-sed"><a href="#文本处理三剑客之-sed" class="headerlink" title="文本处理三剑客之 sed"></a>文本处理三剑客之 sed</h2><h3 id="sed-工作原理"><a href="#sed-工作原理" class="headerlink" title="sed 工作原理"></a>sed 工作原理</h3><p>sed 即 Stream EDitor，和 vi 不同，sed是行编辑器</p>
<p><img src="../../../../images/image/SRE/day05/10.png" alt="10"></p>
<p>Sed是从文件或管道中读取一行，处理一行，输出一行；再读取一行，再处理一行，再输出一行，直到最后一行。 </p>
<p>每当处理一行时，把当前处理的行存储在临时缓冲区 <strong>模式空间（Pattern Space）</strong> 中，接着用sed命令处理缓冲区中的内容，处理完成后， 把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。 </p>
<p>一次处理一行的设计模式使得sed性能很高，sed在读取大文件时不会出现卡顿的现象。 </p>
<p>如果使用vi命令打开几十M上百M的文件，明显会出现有卡顿的现象，这是因为vi命令打开文件是一次性将文件加载到内存，然后再打开。 Sed就避免了这种情况，一行一行的处理，打开速度非常快，执行速度也很快。</p>
<p>相关文档 </p>
<p><a target="_blank" rel="noopener" href="http://sed.sourceforge.net/">http://sed.sourceforge.net/</a> </p>
<p><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man1/sed.1.html">https://man7.org/linux/man-pages/man1/sed.1.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.gnu.org/software/sed/manual/sed.html">http://www.gnu.org/software/sed/manual/sed.html</a></p>
<h3 id="sed-基本用法"><a href="#sed-基本用法" class="headerlink" title="sed 基本用法"></a>sed 基本用法</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sed [OPTION]... &#123;script-only-if-no-other-script&#125; [input-file]...</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-n|--quiet|--silent                     <span class="comment">#不输出模式空间内容到屏幕，即不自动打印</span></span><br><span class="line">-e script|--expression=script           <span class="comment">#多个script，or 的关系</span></span><br><span class="line">-f script-file|--file=script-file       <span class="comment">#从指定文件中读取编辑脚本</span></span><br><span class="line">-i[SUFFIX]|--in-place[=SUFFIX]          <span class="comment">#-i 直接修改文件，-i.bak 以.bak后缀备份原文件</span></span><br><span class="line">-c|--copy                               <span class="comment">#配合i一起使用，保留原文件</span></span><br><span class="line">-l N|--line-length=N                    <span class="comment">#指定每行长度，如果过长，就拆分成多行，要加 -l</span></span><br><span class="line">--posix                                 <span class="comment">#禁用GNU扩展</span></span><br><span class="line">-E|-r|--regexp-extended                 <span class="comment">#扩展正则表达式</span></span><br><span class="line">-s|--separate                           <span class="comment">#将多个文件视为独立文件，而不是单个连续的长文件流</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-ir                <span class="comment">#此组合不支持</span></span><br><span class="line">-ri                <span class="comment">#支持</span></span><br><span class="line">-i -r              <span class="comment">#支持</span></span><br><span class="line">-ni                <span class="comment">#此组合危险，会清空文件</span></span><br></pre></td></tr></table></figure>

<p>script 格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;AddrCmd&#x27;</span>          <span class="comment">#地址命令 在哪些行，执行什么操作</span></span><br></pre></td></tr></table></figure>

<p>地址格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为空，则表示对全文进行处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#单地址,指定行</span></span><br><span class="line">N                           <span class="comment">#具体行号</span></span><br><span class="line">$                           <span class="comment">#最后一行</span></span><br><span class="line">/pattern/                   <span class="comment">#能被匹配到的每一行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#范围地址</span></span><br><span class="line">M,N                         <span class="comment">#第M行到第N行</span></span><br><span class="line">M,+N                        <span class="comment">#第M行到第M+N行 3,+4 表示从第3行到第7行</span></span><br><span class="line">/pattern1/,/pattern2/       <span class="comment">#从第一个匹配行开始，到第二个匹配行中间的行</span></span><br><span class="line">M,/pattern/                 <span class="comment">#行号开始，匹配结束</span></span><br><span class="line">/pattern/,N                 <span class="comment">#匹配开始，行号结束</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#步长</span></span><br><span class="line">1~2                         <span class="comment">#奇数行</span></span><br><span class="line">2~2                         <span class="comment">#偶数行</span></span><br></pre></td></tr></table></figure>

<p>命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p               <span class="comment">#打印当前模式空间内容，追加到默认输出之后</span></span><br><span class="line">Ip              <span class="comment">#忽略大小写输出</span></span><br><span class="line">d               <span class="comment">#删除模式空间匹配的行，并立即启用下一轮循环</span></span><br><span class="line">a [\]text       <span class="comment">#在指定行后面追加文本，支持使用\n实现多行追加</span></span><br><span class="line">i [\]text       <span class="comment">#在行前面插入文本</span></span><br><span class="line">c [\]text       <span class="comment">#替换行为单行或多行文本</span></span><br><span class="line">w file          <span class="comment">#保存模式匹配的行至指定文件</span></span><br><span class="line">r file          <span class="comment">#读取指定文件的文本至模式空间中匹配到的行后</span></span><br><span class="line">=               <span class="comment">#为模式空间中的行打印行号</span></span><br><span class="line">!               <span class="comment">#模式空间中匹配行取反处理</span></span><br><span class="line">q               <span class="comment">#结束或退出sed</span></span><br></pre></td></tr></table></figure>

<p>查找替代</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">s/pattern/replace/修饰符    <span class="comment">#查找替换,支持使用其它分隔符，可以是其它形式：s@@@，s###</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#修饰符</span></span><br><span class="line">g               <span class="comment">#行内全局替换</span></span><br><span class="line">p               <span class="comment">#显示替换成功的行</span></span><br><span class="line">w file          <span class="comment">#将替换成功的行保存至文件中</span></span><br><span class="line">I|i             <span class="comment">#忽略大小写</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#后向引用</span></span><br><span class="line">\1              <span class="comment">#第一个分组</span></span><br><span class="line">\2              <span class="comment">#第二个分组</span></span><br><span class="line">\N              <span class="comment">#第N个分组</span></span><br><span class="line">&amp;               <span class="comment">#所有搜索内容</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#等待标准输入,script为空，默认是直接输出</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;&#x27;</span></span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;&#x27; -</span></span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line"></span><br><span class="line"><span class="comment">#script为空，默认输出内容</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;&#x27; /etc/issue</span></span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line"><span class="comment">#script 中执行p命令，再加上默认输出，所有每行都显示了两次</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;p&#x27; /etc/issue</span></span><br><span class="line">\S</span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭默认输出，script 为空，则无任何输出</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;&#x27; /etc/issue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用 -n 选项关闭默认输出，script 中执行p命令</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;p&#x27; /etc/issue</span></span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出第一行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;1p&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出最后一行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;$p&#x27; /etc/passwd</span></span><br><span class="line">testbash:x:1034:1036::/home/testbash:/sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#正则匹配，输出包含root的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;/root/p&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#正则匹配，输出以root开头的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;/^root/p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#正则匹配，输出以bash结尾的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;/bash$/p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">jose:x:1000:1000::/home/jose:/bin/bash</span><br><span class="line">jerry:x:1001:1001:tom to jerry:/home/tom:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#正则匹配，显示注释行行号</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;/^#/=&#x27; /etc/fstab </span></span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line"></span><br><span class="line"><span class="comment">#行号开始，正则结束</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;8,/root/p&#x27; /etc/passwd</span></span><br><span class="line"> halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line"> mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line"> operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：添加内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat &gt; test.txt &lt;&lt;EOF</span></span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line">ccc</span><br><span class="line">bbb</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#匹配行后插入</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;/bbb/a\---&#x27; test.txt</span></span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line">---</span><br><span class="line">ccc</span><br><span class="line">bbb</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定行前插入</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;2i\---&#x27; test.txt </span></span><br><span class="line"> aaa</span><br><span class="line"> ---</span><br><span class="line"> bbb</span><br><span class="line"> ccc</span><br><span class="line"> bbb</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;2,4i\---&#x27; test.txt </span></span><br><span class="line"> aaa</span><br><span class="line"> ---</span><br><span class="line"> bbb</span><br><span class="line"> ---</span><br><span class="line"> ccc</span><br><span class="line"> ---</span><br><span class="line"> bbb</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换，第一行替换成 ---</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &quot;1c\---&quot; test.txt </span></span><br><span class="line">---</span><br><span class="line">bbb</span><br><span class="line">ccc</span><br><span class="line">bbb</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换，第一行替换成两行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &quot;1c\---\n+++&quot; test.txt </span></span><br><span class="line"> ---</span><br><span class="line"> +++</span><br><span class="line"> bbb</span><br><span class="line"> ccc</span><br><span class="line"> bbb</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换，多行替换成一行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &quot;1,2c\---&quot; test.txt </span></span><br><span class="line"> ---</span><br><span class="line"> ccc</span><br><span class="line"> bbb</span><br><span class="line"></span><br><span class="line"><span class="comment"># \ 的作用</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;2a **********&#x27; test.txt </span></span><br><span class="line"> aaa</span><br><span class="line"> bbb</span><br><span class="line"> **********</span><br><span class="line"> ccc</span><br><span class="line"> bbb</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;2a\ **********&#x27; test.txt </span></span><br><span class="line"> aaa</span><br><span class="line"> bbb</span><br><span class="line">  **********</span><br><span class="line"> ccc</span><br><span class="line"> bbb</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#取IP行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | head -n 2 | tail -n 1</span></span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -n &#x27;2p&#x27;</span></span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -n &#x27;/netmask/p&#x27;</span></span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255</span><br></pre></td></tr></table></figure>

<p>范例：命令展开</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;/$(whoami)/p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#第1行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;$[$(id -u)+1]p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#倒数第2行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;$(echo $[`cat /etc/passwd|wc -l`-1])p&quot; /etc/passwd</span></span><br><span class="line">nologin:x:1033:1035::/home/nologin:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：变量展开</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;/$USER/p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># number=1;sed -n &quot;$&#123;number&#125;p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>范例：变量和命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;$(echo $UID+1|bc)p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &quot;$(echo $UID + 1|bc),$(echo $UID + 3|bc)p&quot; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># df | sed -n &quot;/^\/dev\/sd/p&quot;</span></span><br><span class="line">/dev/sda1             1038336  216736    821600  21% /boot</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;2,4p&#x27;</span></span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;2,+4p&#x27;</span></span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"> 5</span><br><span class="line"> 6</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;8,$p&#x27;</span></span><br><span class="line"> 8</span><br><span class="line"> 9</span><br><span class="line"> 10</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;1~2p&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 3</span><br><span class="line"> 5</span><br><span class="line"> 7</span><br><span class="line"> 9</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;2~2p&#x27;</span></span><br><span class="line"> 2</span><br><span class="line"> 4</span><br><span class="line"> 6</span><br><span class="line"> 8</span><br><span class="line"> 10</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除奇数行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed  &#x27;1~2d&#x27;</span></span><br><span class="line"> 2</span><br><span class="line"> 4</span><br><span class="line"> 6</span><br><span class="line"> 8</span><br><span class="line"> 10</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除偶数行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed  &#x27;2~2d&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 3</span><br><span class="line"> 5</span><br><span class="line"> 7</span><br><span class="line"> 9</span><br><span class="line"></span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed  -e &#x27;2d&#x27; -e &#x27;4d&#x27;</span></span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line"><span class="comment">#多个script 写在一起</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed  &#x27;2d;4d&#x27;</span></span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line"><span class="comment">#只显示非#开头的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -n &#x27;/^#/!p&#x27; /etc/fstab </span></span><br><span class="line"></span><br><span class="line">/dev/mapper/rl-root     /                       xfs     defaults        0 0</span><br><span class="line">UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07 /boot                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-swap     none                    swap    defaults        0 0</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不显示注释行和空行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed &#x27;/^$/d;/^#/d&#x27; /etc/fstab </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -En &#x27;/^(#|$)/!p&#x27; /etc/fstab</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grep -Ev &quot;^(#|$)&quot; /etc/fstab</span></span><br></pre></td></tr></table></figure>

<p>范例：修改文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改前备份</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 &gt; 10.txt</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -i.bak &#x27;2,7d&#x27; 10.txt </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll 10*</span></span><br><span class="line">-rw-r--r--. 1 root root  9 Sep 14 13:04 10.txt</span><br><span class="line">-rw-r--r--. 1 root root 21 Sep 14 13:04 10.txt.bak</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat 10.txt</span></span><br><span class="line">1</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat 10.txt.bak </span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line"><span class="comment">#不备份</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># rm 10.txt.bak </span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 &gt; 10.txt </span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -i &quot;2,7d&quot; 10.txt </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ll 10*</span></span><br><span class="line"> -rw-r--r--. 1 root root 9 Sep 14 13:06 10.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat 10.txt </span></span><br><span class="line">1</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<p>范例：删除注释行和空行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed -i &quot;/^#/d;/^$/d&quot; /etc/fstab</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -i &quot;/^\(#\|$\)/d&quot; /etc/fstab</span></span><br></pre></td></tr></table></figure>

<p>范例: 搜索替换和&amp;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed  -n &#x27;s/root/ROOT/gp&#x27; /etc/passwd</span></span><br><span class="line"> ROOT:x:0:0:ROOT:/ROOT:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/ROOT:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed  -n &#x27;s/root/&amp;er/gp&#x27; /etc/passwd</span></span><br><span class="line"> rooter:x:0:0:rooter:/rooter:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/rooter:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed  -n &#x27;s/r..t/&amp;er/gp&#x27; /etc/passwd</span></span><br><span class="line"> rooter:x:0:0:rooter:/rooter:/bin/bash</span><br><span class="line"> operator:x:11:0:operator:/rooter:/sbin/nologin</span><br><span class="line"> ftp:x:14:50:FTP User:/var/fterp:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>范例: 除指定文件外其余删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ls</span></span><br><span class="line">f-1.txt  f-2.txt  f-3.txt  f-4.txt  f-5.txt  f-6.txt  f-7.txt  f-8.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#取非 1|3|5|7</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls | grep -Ev &quot;f-(1|3|5|7).txt&quot;</span></span><br><span class="line">f-2.txt</span><br><span class="line">f-4.txt</span><br><span class="line">f-6.txt</span><br><span class="line">f-8.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除非1|3|5|7</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># rm -f `ls | grep -Ev &quot;f-(1|3|5|7)\.txt&quot;`</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls</span></span><br><span class="line">f-1.txt  f-3.txt  f-5.txt  f-7.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#取非 1|3|5|7</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls | sed -n &quot;/f-[^1357]\.txt/p&quot;</span></span><br><span class="line">f-2.txt</span><br><span class="line">f-4.txt</span><br><span class="line">f-6.txt</span><br><span class="line">f-8.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除非1|3|5|7</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># rm -f `ls | sed -n &quot;/f-[^1357]\.txt/p&quot;`</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls</span></span><br><span class="line">f-1.txt  f-3.txt  f-5.txt  f-7.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls | grep -Ev &#x27;f-(1|3|5|7)\.txt&#x27; | sed -n &#x27;s/.*/rm &amp;/p&#x27;</span></span><br><span class="line"><span class="built_in">rm</span> f-2.txt</span><br><span class="line"><span class="built_in">rm</span> f-4.txt</span><br><span class="line"><span class="built_in">rm</span> f-6.txt</span><br><span class="line"><span class="built_in">rm</span> f-8.txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls | grep -Ev &#x27;f-(1|3|5|7)\.txt&#x27; | sed -n &#x27;s/.*/rm &amp;/p&#x27; | bash</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ls</span></span><br><span class="line">f-1.txt  f-3.txt  f-5.txt  f-7.txt</span><br></pre></td></tr></table></figure>

<p>范例: 获取分区利用率</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># df | sed -En &#x27;/^\/dev\/sd/s/.* ([0-9]+)%.*/\1/p&#x27;</span></span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | sed -En &#x27;s/^\/dev.* ([0-9]+)%.*/\1/p&#x27; | sort -nr</span></span><br><span class="line">21</span><br><span class="line">3</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>范例：取IP 地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -nr &quot;2s/[^0-9]+([0-9.]+).*/\1/p&quot;</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -nE &quot;2s/[^0-9]+([0-9.]&#123;7,15&#125;).*/\1/p&quot;</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -nr &quot;2s/[^0-9]+([0-9.]+) .*$/\1/p&quot;</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -n &quot;2s/^.*inet //p&quot; | sed -n &quot;s/ netmask.*//p&quot;</span></span><br><span class="line">192.168.1.11 </span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -n &quot;2s/^.*inet //;s/ netmask.*//p&quot; </span></span><br><span class="line">192.168.1.11 </span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | sed -rn &quot;2s/(.*inet )([0-9].*)( netmask.*)/\2/p&quot;</span></span><br><span class="line">192.168.1.11</span><br></pre></td></tr></table></figure>

<p>范例：取基名和目录名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#取基名</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># basename /etc/sysconfig/network-scripts/</span></span><br><span class="line">network-scripts</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;/etc/sysconfig/network-scripts/&quot; | sed -nE &#x27;s#(^/.*/)([^/]+)/?#\2#p&#x27;</span></span><br><span class="line">network-scripts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#取目录</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># dirname /etc/sysconfig/network-scripts/</span></span><br><span class="line">/etc/sysconfig</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;/etc/sysconfig/network-scripts/&quot; | sed -nE &#x27;s#(^/.*/)([^/]+)/?#\1#p&#x27;</span></span><br><span class="line">/etc/sysconfig/</span><br></pre></td></tr></table></figure>

<p>范例: 取文件的前缀和后缀</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># echo a.txt | sed -En &#x27;s/(.*)\.([^.]+)$/\1   \2/p&#x27;</span></span><br><span class="line">a   txt</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo a.tar.gz.txt | sed -En &#x27;s/(.*)\.([^.]+)$/\1   \2/p&#x27; </span></span><br><span class="line">a.tar.gz   txt</span><br></pre></td></tr></table></figure>

<p>范例：将非#开头的行加#</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed -rn &#x27;s/^[^#]/#&amp;/p&#x27; /etc/fstab </span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-root     /                       xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07 /boot                   xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-swap     none                    swap    defaults        0 0</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -rn &#x27;s/^([^#])(.*)/#\1\2/p&#x27; /etc/fstab </span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-root     /                       xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07 /boot                   xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-swap     none                    swap    defaults        0 0</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -rn &#x27;/^#/!s@^@#@p&#x27; /etc/fstab </span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-root     /                       xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07 /boot                   xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span></span><br><span class="line"><span class="comment">#/dev/mapper/rl-swap     none                    swap    defaults        0 0</span></span><br></pre></td></tr></table></figure>

<p>范例：将#开头的行删除#</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed -ri.bak &#x27;/^#/s/^#//&#x27; /etc/fstab</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -E -i.bak &#x27;s/^#(.*)/\1/&#x27; /etc/fstab</span></span><br></pre></td></tr></table></figure>

<p>范例：取分区利用率</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># df | sed -nr &#x27;/^\/dev/  s# .* ([0-9]+)%.*# \1# p&#x27;</span></span><br><span class="line">/dev/mapper/rl-root 3</span><br><span class="line">/dev/mapper/rl-home 1</span><br><span class="line">/dev/sda1 21</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | sed -rn &#x27;/^\/dev/ s#([^[:space:]]+[[:space:]]+)&#123;4&#125;(.*)%.*#\2#p&#x27;</span></span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># df | sed -rn &#x27;/^\/dev/ s#(\S+\s+)&#123;4&#125;(.*)%.*#\2#p&#x27;</span></span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">21</span><br></pre></td></tr></table></figure>

<p>范例：修改网卡名称</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># sed -Ei.bak &#x27;s/^(GRUB_CMDLINE_LINUX=.*)&quot;$/\1 net.ifname=0&quot;/&#x27; /etc/default/grub </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cd /etc/default/</span></span><br><span class="line">[root@rocky8 default]<span class="comment"># ls</span></span><br><span class="line">grub  grub.bak  useradd  useradd-</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -Ei &#x27;/^GRUB_CMDLINE_LINUX/s#&quot;$# net.ifnames=0&quot;#&#x27; /etc/default/grub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改完成后重启生效</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># grub2-mkconfig -o /etc/grub2.cfg; reboot; init 6</span></span><br></pre></td></tr></table></figure>

<p>范例：修改selinux配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cp /etc/selinux/config .</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -i.bak &#x27;/SELINUX=enforcing/c SELINUX=disabled&#x27; config </span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -i.bak &#x27;/^SELINUX=enforcing/c SELINUX=disabled/&#x27; config</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -Ei.bak &#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27; config</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed -Ei.bak &#x27;s/^(SELINUX=)(.*)/\1disabled/&#x27; config</span></span><br></pre></td></tr></table></figure>

<p>范例: 显示前4行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 &gt; test.txt</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># sed 4q test.txt </span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<h3 id="sed-高级用法"><a href="#sed-高级用法" class="headerlink" title="sed 高级用法"></a>sed 高级用法</h3><p>sed 中除了模式空间，还另外还支持保持空间（Hold Space），利用此空间，可以将模式空间中的数据， 临时保存至保持空间，从而后续接着处理，实现更为强大的功能。</p>
<p><img src="../../../../images/image/SRE/day05/11.png" alt="11"></p>
<p>常见的高级命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">P           <span class="comment">#打印模式空间开端至\n内容，并追加到默认输出之前</span></span><br><span class="line">h           <span class="comment">#把模式空间中的内容覆盖至保持空间中</span></span><br><span class="line">H           <span class="comment">#把模式空间中的内容追加至保持空间中</span></span><br><span class="line">g           <span class="comment">#从保持空间取出数据覆盖至模式空间</span></span><br><span class="line">G           <span class="comment">#从保持空间取出内容追加至模式空间</span></span><br><span class="line">x           <span class="comment">#把模式空间中的内容与保持空间中的内容进行互换</span></span><br><span class="line">n           <span class="comment">#读取匹配到的行的下一行覆盖至模式空间</span></span><br><span class="line">N           <span class="comment">#读取匹配到的行的下一行追加至模式空间</span></span><br><span class="line">d           <span class="comment">#删除模式空间中的行</span></span><br><span class="line">D           <span class="comment">#如果模式空间包含换行符，则删除直到第一个换行符的模式空间中的文本，并不会读取新的输入行，</span></span><br><span class="line">            <span class="comment">#而使用合成的模式空间重新启动循环。如果模式空间不包含换行符，则会像发出d命令那样启动正常的新循环</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;n;p&#x27;</span> FILE</span><br><span class="line"><span class="built_in">seq</span> 10 | sed <span class="string">&#x27;N;s/\n//&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;1!G;h;$!d&#x27;</span> FILE</span><br><span class="line"><span class="built_in">seq</span> 10 | sed -n <span class="string">&#x27;/3/&#123;g;1!p;&#125;;h&#x27;</span>       <span class="comment">#前一行</span></span><br><span class="line"><span class="built_in">seq</span> 10 | sed -nr <span class="string">&#x27;/3/&#123;n;p&#125;&#x27;</span>           <span class="comment">#后一行</span></span><br><span class="line">sed  <span class="string">&#x27;N;D&#x27;</span>FILE</span><br><span class="line"><span class="built_in">seq</span> 10 |sed  <span class="string">&#x27;3h;9G;9!d&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;$!N;$!D&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;$!d&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;G&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;g&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;/^$/d;G&#x27;</span> FILE</span><br><span class="line">sed <span class="string">&#x27;n;d&#x27;</span> FILE </span><br><span class="line">sed -n <span class="string">&#x27;1!G;h;$p&#x27;</span> FILE</span><br></pre></td></tr></table></figure>

<p>范例: 打印偶数行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;n;p&#x27;</span></span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;2~2p&#x27;</span></span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed  &#x27;1~2d&#x27;</span></span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 10 | sed -n &#x27;1~2!p&#x27;</span></span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<p>练习： </p>
<ol>
<li>删除centos7系统/etc/grub2.cfg文件中所有以空白开头的行行首的空白字符</li>
<li>删除/etc/fstab文件中所有以#开头，后面至少跟一个空白字符的行的行首的#和空白字符</li>
<li>在centos6系统/root/install.log每一行行首增加#号</li>
<li>在/etc/fstab文件中不以#开头的行的行首增加#号</li>
<li>处理/etc/fstab路径,使用sed命令取出其目录名和基名</li>
<li>利用sed 取出ifconfig命令中本机的IPv4地址</li>
<li>统计centos安装光盘中Package目录下的所有rpm文件的以.分隔倒数第二个字段的重复次数</li>
<li>统计/etc/init.d/functions文件中每个单词的出现次数，并排序（用grep和sed两种方法分别实现）</li>
<li>将文本文件的n和n+1行合并为一行，n为奇数行</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1. </span><br><span class="line">sed -i <span class="string">&#x27;s/^[[:space:]]*//;T&#x27;</span> /etc/grub2.cfg</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">sed -i <span class="string">&quot;s/^#[[:space:]]+//&quot;</span> /etc/fstab</span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">sed -i <span class="string">&quot;s/^/#/&quot;</span> /root/install.log</span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">sed -i <span class="string">&quot;s/^#*/#/&quot;</span> /etc/fstab</span><br><span class="line"></span><br><span class="line">5.</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/fstab&quot;</span> | sed -nE <span class="string">&#x27;s#(^/.*/)([^/]+)/?#\2#p&#x27;</span></span><br><span class="line">fstab</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/fstab&quot;</span> | sed -nE <span class="string">&#x27;s#(^/.*/)([^/]+)/?#\1#p&#x27;</span></span><br><span class="line">/etc/</span><br><span class="line"></span><br><span class="line">6.</span><br><span class="line">ifconfig ens160 | sed -nE <span class="string">&#x27;s/.*inet ([0-9.]+).*/\1/p&#x27;</span></span><br><span class="line">192.168.1.11</span><br><span class="line"></span><br><span class="line">7.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文本处理三剑客之-awk"><a href="#文本处理三剑客之-awk" class="headerlink" title="文本处理三剑客之 awk"></a>文本处理三剑客之 awk</h2><p><img src="../../../../images/image/SRE/day05/12.png" alt="12"></p>
<h3 id="awk-工作原理和基本用法说明"><a href="#awk-工作原理和基本用法说明" class="headerlink" title="awk 工作原理和基本用法说明"></a>awk 工作原理和基本用法说明</h3><p>​                awk：Aho, Weinberger, Kernighan，报告生成器，格式化文本输出，GNU/Linux发布的AWK目前由自由软件基金会（FSF）进行开发和维护，通常也称它为 GNU AWK</p>
<p> AWK有多种版本： </p>
<ul>
<li>AWK：原先来源于 AT &amp; T 实验室的的AWK</li>
<li>NAWK：New awk，AT &amp; T 实验室的AWK的升级版</li>
<li>GAWK：即GNU AWK。所有的GNU/Linux发布版都自带GAWK，它与AWK和NAWK完全兼容</li>
</ul>
<p>目前主流发行版LINUX中使用的都是GAWK</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># ll `which awk`</span></span><br><span class="line">lrwxrwxrwx. 1 root root 4 May 19  2021 /usr/bin/awk -&gt; gawk</span><br></pre></td></tr></table></figure>



<p> GNU AWK 用户手册文档</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.gnu.org/software/gawk/manual/gawk.html</span><br><span class="line">https://man7.org/linux/man-pages/man1/awk.1p.html</span><br></pre></td></tr></table></figure>



<p> gawk：模式扫描和处理语言，可以实现下面功能</p>
<ul>
<li>文本处理</li>
<li>输出格式化的文本报表</li>
<li>执行算数运算</li>
<li>执行字符串操作</li>
</ul>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk [options]       <span class="string">&#x27;program&#x27;</span> var=value   file…</span><br><span class="line">awk [options]        -f programfile  var=value file…</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-f progfile|--file progfile                    <span class="comment">#从文件中读入program</span></span><br><span class="line">-F fs|--field-separator fs                     <span class="comment">#指定分隔符，默认是空白符,可以指定多个</span></span><br><span class="line">-v var=val|--asign var=val                     <span class="comment">#设置变量</span></span><br></pre></td></tr></table></figure>

<p> <strong>program用法</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">program 通常放在单引号中，由三部份组成，分别是BEGIN&#123;&#125;[pattern]&#123;COMMAND&#125;END&#123;&#125;,这三部份可以没有或都有</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#x27;</span>  /etc/issue</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print &quot;begin&quot;&#125;&#x27;</span>  /etc/issue</span><br><span class="line">awk <span class="string">&#x27;&#123;print $0&#125;&#x27;</span>            /etc/issue</span><br><span class="line">awk <span class="string">&#x27;END&#123;print &quot;end&quot;&#125;&#x27;</span>      /etc/issue</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print &quot;begin&quot;&#125;&#123;print $0&#125;END&#123;print &quot;end&quot;&#125;&#x27;</span>   /etc/issue</span><br></pre></td></tr></table></figure>



<p><strong>Program格式：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pattern&#123;action statements;..&#125;</span><br><span class="line"></span><br><span class="line">pattern                            <span class="comment">#定义条件，只有符合条件的记录，才会执行后面的action</span></span><br><span class="line">action statements                  <span class="comment">#处理数据的方式，常见如 print,printf等 </span></span><br></pre></td></tr></table></figure>



<p><strong>awk 工作过程</strong></p>
<p><img src="../../../../images/image/SRE/day05/13.png" alt="13"></p>
<ol>
<li>执行BEGIN{action;… }语句块中的语句 </li>
<li>从文件或标准输入(stdin)读取一行，然后执行pattern{ action;… }语句块，它逐行扫描文件，从 第一行到最后一行重复这个过程，直到 文件全部被读取完毕。</li>
<li>当读至输入流末尾时，执行END{action;…}语句块 </li>
</ol>
<p>​        BEGIN语句块在awk开始从输入流中读取行之前被执行，这是一个可选的语句块，比如变量初始化、打 印输出表格的表头等语句通常可以写 在BEGIN语句块中</p>
<p>​        END语句块在awk从输入流中读取完所有的行之后即被执行，比如打印所有行的分析结果这类信息汇总 都是在END语句块中完成，它也是一 个可选语句块 </p>
<p>​        pattern语句块中的通用命令是最重要的部分，也是可选的。如果没有提供pattern语句块，则默认执行{  print }，即打印每一个读取到的行，awk读取的每一行都会执行该语句块</p>
<p><strong>分割符、域和记录</strong></p>
<ul>
<li>文件的每一行称为记录 record</li>
<li>记录可以由指定的分隔符分隔成多个字段（列 column，域 field），由$1，$2…$N 来标识每一个字段，$0 表示一整行</li>
</ul>
<h3 id="awk-变量"><a href="#awk-变量" class="headerlink" title="awk 变量"></a>awk 变量</h3><p>awk中的变量分为内置和自定义变量两种</p>
<p>变量的作用在于可以一次定义多次调用</p>
<h4 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h4><p>常用内置变量</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>FILENAME</td>
<td>当前文件名</td>
</tr>
<tr>
<td>FS</td>
<td>字段分隔符，默认为空白字符，功能相当于-F</td>
</tr>
<tr>
<td>RS</td>
<td>换行符，用于分割指定文件的行，默认是换行符</td>
</tr>
<tr>
<td>OFS</td>
<td>输出字段分隔符，默认为空白字符</td>
</tr>
<tr>
<td>ORS</td>
<td>输出换行符，输出时用指定符号代替换行符</td>
</tr>
<tr>
<td>OFMT</td>
<td>数字的输出格式，默认值是%.6g</td>
</tr>
<tr>
<td>NF</td>
<td>一条记录的字段数量</td>
</tr>
<tr>
<td>NR</td>
<td>已经读出的记录数，就是行号，从1开始</td>
</tr>
<tr>
<td>FNR</td>
<td>各文件分别记录行号</td>
</tr>
<tr>
<td>ARGC</td>
<td>命令行参数的个数</td>
</tr>
<tr>
<td>ARGV</td>
<td>数组，保存的是命令行所给定的各参数，每一个参数：ARGV[0], ….., ARGV[n]</td>
</tr>
</tbody></table>
<p>范例：FILENAME</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#begin中拿不到FILENAME</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print FILENAME&#125;&#x27; /etc/issue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print FILENAME&#125;&#123;print &quot;test&quot;&#125;END&#123;print FILENAME&#125;&#x27; /etc/issue</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">/etc/issue</span><br></pre></td></tr></table></figure>

<p>范例：FS</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; &#x27;BEGIN&#123;print FS&#125;&#123;print $1,$1&#125;&#x27; /etc/passwd:</span></span><br><span class="line">root root</span><br><span class="line">bin bin</span><br><span class="line">daemon daemon</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; &#x27;BEGIN&#123;print FS&#125;&#123;print $1FS$1&#125;&#x27; /etc/passwd</span></span><br><span class="line">:</span><br><span class="line">root:root</span><br><span class="line">bin:bin</span><br><span class="line">daemon:daemon</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用-F选项指定</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F : &#x27;BEGIN&#123;print FS&#125;&#123;print $1FS$1&#125;&#x27; /etc/passwd</span></span><br><span class="line">:</span><br><span class="line">root:root</span><br><span class="line">bin:bin</span><br><span class="line">daemon:daemon</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#从shell变量中获取</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># str=&quot;:&quot;;awk -v FS=$str &#x27;BEGIN&#123;print FS&#125;&#123;print $1FS$1&#125;&#x27; /etc/passwd</span></span><br><span class="line">:</span><br><span class="line">root:root</span><br><span class="line">bin:bin</span><br><span class="line">daemon:daemon</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-F和FS变量功能一样，同时使用后面会覆盖前面的</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; -F &quot;;&quot; &#x27;BEGIN&#123;print FS&#125;&#x27; /etc/passwd</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F &quot;;&quot; -v FS=&quot;:&quot; &#x27;BEGIN&#123;print FS&#125;&#x27; /etc/passwd</span></span><br><span class="line">:</span><br></pre></td></tr></table></figure>

<p>范例：RS</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat test.txt -A</span></span><br><span class="line">a b c;1 2 3;x y z$</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;&#123;print $0&#125;&#x27; test.txt </span></span><br><span class="line">a b c;1 2 3;x y z</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v RS=&quot;;&quot; &#x27;&#123;print $0&#125;&#x27; test.txt </span></span><br><span class="line">a b c</span><br><span class="line">1 2 3</span><br><span class="line">x y z</span><br></pre></td></tr></table></figure>

<p>范例：OFS</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; &#x27;&#123;print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">root 0</span><br><span class="line">bin 1</span><br><span class="line">daemon 2</span><br><span class="line">adm 3</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; -v OFS=&quot;---&quot; &#x27;&#123;print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">root---0</span><br><span class="line">bin---1</span><br><span class="line">daemon---2</span><br><span class="line">adm---3</span><br></pre></td></tr></table></figure>

<p>范例：ORS</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat -A test.txt </span></span><br><span class="line">123$</span><br><span class="line">456$</span><br><span class="line">789$</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;&#123;print $0&#125;&#x27; test.txt </span></span><br><span class="line">123</span><br><span class="line">456</span><br><span class="line">789</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v ORS=&quot;---&quot; &#x27;&#123;print $0&#125;&#x27; test.txt </span></span><br><span class="line">123---456---789---[root@rocky8 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>范例：OFMT</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;PI=3.1415926;print PI;OFMT=&quot;%.1g&quot;;print PI;OFMT=&quot;%.2g&quot;;print PI;OFMT=&quot;%.8g&quot;;print PI;OFMT=&quot;%.8f&quot;;print PI&#125;&#x27;</span></span><br><span class="line">3.14159</span><br><span class="line">3</span><br><span class="line">3.1</span><br><span class="line">3.1415926</span><br><span class="line">3.14159260</span><br></pre></td></tr></table></figure>

<p>范例：NF</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; &#x27;&#123;print NF&#125;&#x27; /etc/passwd</span></span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; &#x27;&#123;print $NF&#125;&#x27; /etc/passwd</span></span><br><span class="line">/bin/bash</span><br><span class="line">/sbin/nologin</span><br><span class="line">/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v FS=&quot;:&quot; &#x27;&#123;print $(NF-1)&#125;&#x27; /etc/passwd</span></span><br><span class="line">/root</span><br><span class="line">/bin</span><br><span class="line">/sbin</span><br></pre></td></tr></table></figure>

<p>范例：NR</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;&#123;print NR,$0&#125;&#x27; /etc/issue</span></span><br><span class="line">1 \S</span><br><span class="line">2 Kernel \r on an \m</span><br><span class="line">3 </span><br></pre></td></tr></table></figure>

<p>范例：FNR</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;&#123;print NR,FNR,$0&#125;&#x27; /etc/issue /etc/redhat-release </span></span><br><span class="line">1 1 \S</span><br><span class="line">2 2 Kernel \r on an \m</span><br><span class="line">3 3 </span><br><span class="line">4 1 Rocky Linux release 8.5 (Green Obsidian)</span><br></pre></td></tr></table></figure>

<p>范例：ARGC</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print ARGC&#125;&#x27; </span></span><br><span class="line">1</span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print ARGC&#125;&#x27; /etc/issue</span></span><br><span class="line">2</span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print ARGC&#125;&#x27; /etc/issue /etc/os-release </span></span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>范例：ARGV</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print ARGC,&quot;---&quot;,ARGV[0],&quot;---&quot;,ARGV[1],&quot;---&quot;,ARGV[2]&#125;&#x27; /etc/issue /etc/os-release </span></span><br><span class="line">3 --- awk --- /etc/issue --- /etc/os-release</span><br></pre></td></tr></table></figure>

<h4 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h4><p>AWK中的自定义变量命名要区分大小写</p>
<p>用 -v 选项定义自定义变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -v var1=abc &#x27;BEGIN&#123;print var1&#125;&#x27;</span></span><br><span class="line">abc</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v var1=abc -v VAR1=123 &#x27;BEGIN&#123;print var1;print VAR1&#125;&#x27;</span></span><br><span class="line">abc</span><br><span class="line">123</span><br></pre></td></tr></table></figure>



<p>在program中定义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -v var1=abc &#x27;BEGIN&#123;print var1;var1=def;print var1&#125;&#x27;</span></span><br><span class="line">abc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">#定义的时候要加双引号</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v var1=abc &#x27;BEGIN&#123;print var1;var1=&quot;def&quot;;print var1&#125;&#123;print var1&#125;&#x27; /etc/issue</span></span><br><span class="line">abc</span><br><span class="line">def</span><br><span class="line">def</span><br><span class="line">def</span><br></pre></td></tr></table></figure>

<h3 id="动作-print"><a href="#动作-print" class="headerlink" title="动作 print"></a>动作 print</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> item1,item2, ...</span><br></pre></td></tr></table></figure>



<p>说明： </p>
<ul>
<li>逗号分隔符</li>
<li>输出item可以字符串，也可是数值；当前记录的字段、变量或awk的表达式</li>
<li>如省略item，相当于print $0</li>
<li>固定字符符需要用“ ” 引起来，而变量和数字不需要</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print &quot;hello world&quot;&#125;&#x27;</span></span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 3 | awk &#x27;&#123;print &quot;hello world&quot;&#125;&#x27;</span></span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 3 | awk &#x27;&#123;print $0&#125;&#x27;</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;print 2*3&#125;&#x27;</span></span><br><span class="line">6</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;&#123;print &#125;&#x27; /etc/issue</span></span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v var1=123 -F : &#x27;&#123;print var1,$1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">123 root 0</span><br><span class="line">123 bin 1</span><br><span class="line">123 daemon 2</span><br><span class="line">123 adm 3</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v var1=123 -F : &#x27;&#123;print var1,$1&quot;\t&quot;$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">123 root    0</span><br><span class="line">123 bin     1</span><br><span class="line">123 daemon  2</span><br><span class="line">123 adm     3</span><br></pre></td></tr></table></figure>

<h3 id="动作-printf"><a href="#动作-printf" class="headerlink" title="动作 printf"></a>动作 printf</h3><p>printf 可以实现格式化输出</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> <span class="string">&quot;FORMAT&quot;</span>,item1,item2,...</span><br></pre></td></tr></table></figure>

<p>说明： </p>
<ul>
<li>必须指定FORMAT</li>
<li>不会自动换行，需要显式给出换行控制符 \n</li>
<li>FORMAT中需要分别为后面每个item指定格式符</li>
</ul>
<p>格式符：与item一一对应</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%s                          <span class="comment">#显示字符串</span></span><br><span class="line">%d|%i                       <span class="comment">#显示十进制整数</span></span><br><span class="line">%f                          <span class="comment">#显示为浮点数</span></span><br><span class="line">%e|%E                       <span class="comment">#显示科学计数法数值 </span></span><br><span class="line">%c                          <span class="comment">#显示字符的ASCII码</span></span><br><span class="line">%g|%G                       <span class="comment">#以科学计数法或浮点形式显示数值</span></span><br><span class="line">%u                          <span class="comment">#无符号整数</span></span><br><span class="line">%%                          <span class="comment">#显示%自身</span></span><br></pre></td></tr></table></figure>

<p>修饰符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">M[.N]                       <span class="comment">#M表示显示的宽度；N表示小数点后精度，如 %3.1f</span></span><br><span class="line">-                           <span class="comment">#左对齐(默认右对齐) 如 %-15s</span></span><br><span class="line">+                           <span class="comment">#显示数值的正负符号 如 %+d</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -F : &#x27;&#123;printf &quot;%s&quot;,$1&#125;&#x27; /etc/passwd</span></span><br><span class="line">rootbindaemonadmlpsyncshutdownhaltmailoperator</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F : &#x27;&#123;printf &quot;%s\n&quot;,$1&#125;&#x27; /etc/passwd</span></span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F : &#x27;&#123;printf &quot;%20s\n&quot;,$1&#125;&#x27; /etc/passwd</span></span><br><span class="line">                root</span><br><span class="line">                 bin</span><br><span class="line">              daemon</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F : &#x27;&#123;printf &quot;%-20s %10d\n&quot;,$1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">root                          0</span><br><span class="line">bin                           1</span><br><span class="line">daemon                        2</span><br><span class="line">adm                           3</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F : &#x27;&#123;printf &quot;Username: %25sUID: %d\n&quot;,$1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">Username:                      rootUID: 0</span><br><span class="line">Username:                       binUID: 1</span><br><span class="line">Username:                    daemonUID: 2</span><br><span class="line">Username:                       admUID: 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F : &#x27;&#123;printf &quot;Username: %-25sUID: %d\n&quot;,$1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">Username: root                     UID: 0</span><br><span class="line">Username: bin                      UID: 1</span><br><span class="line">Username: daemon                   UID: 2</span><br><span class="line">Username: adm                      UID: 3</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -F: &#x27;BEGIN&#123;print &quot;---------------------------\n|username            |uid  |\n---------------------------&quot;&#125;&#123;printf &quot;|%-20s|%5s|\n---------------------------\n&quot;,$1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">---------------------------</span><br><span class="line">|username            |uid  |</span><br><span class="line">---------------------------</span><br><span class="line">|root                |    0|</span><br><span class="line">---------------------------</span><br><span class="line">|bin                 |    1|</span><br><span class="line">---------------------------</span><br><span class="line">|daemon              |    2|</span><br><span class="line">---------------------------</span><br><span class="line">|adm                 |    3|</span><br><span class="line">---------------------------</span><br></pre></td></tr></table></figure>

<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><p><strong>赋值操作</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=, +=, -=, *=, /=, %=, ^=, ++, --</span><br></pre></td></tr></table></figure>

<p><strong>比较操作</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">==, !=, &gt;, &gt;=, &lt;, &lt;=</span><br></pre></td></tr></table></figure>

<p><strong>算术运算符</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x+y, x-y, x*y, x/y, x^y, x%y  </span><br><span class="line">-x                           <span class="comment">#转换为负数</span></span><br><span class="line">+x                           <span class="comment">#将字符串转换为数值</span></span><br></pre></td></tr></table></figure>



<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;i=0;print i++,i&#125;&#x27;</span></span><br><span class="line">0 1</span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;i=0;print ++i,i&#125;&#x27;</span></span><br><span class="line">1 1</span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;i=0;print ++i,++i&#125;&#x27;</span></span><br><span class="line">1 2</span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN&#123;i=0;print ++i,i++&#125;&#x27;</span></span><br><span class="line">1 1</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认print,先匹配，再++</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 3 | awk &#x27;n++&#x27;</span></span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v n=0 &#x27;!n++&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># !N++当N为0时返回真，然后N递增。</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v n=0 &#x27;!n++&#123;print n&#125;&#x27; /etc/passwd</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v n=1 &#x27;!n++&#123;print n&#125;&#x27; /etc/passwd</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v n=0 &#x27;!++n&#123;print n&#125;&#x27; /etc/passwd</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v n=0 &#x27;!++n&#x27; /etc/passwd</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -v n=-1 &#x27;!++n&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;NR==2&#x27; /etc/passwd</span></span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F: &#x27;$3&gt;=1000&#x27; /etc/passwd</span></span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</span><br><span class="line">jose:x:1000:1000::/home/jose:/bin/bash</span><br><span class="line">jeck:x:1002:1002::/home/jeck:/bin/sh</span><br><span class="line">jerry:x:1001:1001:tom to jerry:/home/tom:/bin/bash</span><br></pre></td></tr></table></figure>

<p>范例：取奇，偶数行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># seq 6 | awk &#x27;NR%2==0&#x27;</span></span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 6 | awk &#x27;NR%2==1&#x27;</span></span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 6 | awk &#x27;NR%2!=0&#x27;</span></span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># seq 6 | awk &#x27;NR%2!=1&#x27;</span></span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>模式匹配操作</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~                <span class="comment">#左边是否和右边匹配，包含关系</span></span><br><span class="line">!~               <span class="comment">#是否不匹配</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#包含root的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F: &#x27;$0 ~ /root/&#123;print $0&#125;&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;/root/&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#以root开头的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F: &#x27;$0 ~ &quot;^root&quot;&#123;print $0&#125;&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F: &#x27;/^root/&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#不包含root的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;$0 !~ /root/&#x27; /etc/passwd</span></span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#UID为0的行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk -F: &#x27;$3==0&#x27; /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># df | awk -F&quot;[[:space:]]+|%&quot; &#x27;$0 ~ /^\/dev\/sd/&#123;print $5&#125;&#x27;</span></span><br><span class="line">21</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># ifconfig ens160 | awk &#x27;NR==2&#123;print $2&#125;&#x27;</span></span><br><span class="line">192.168.1.11</span><br></pre></td></tr></table></figure>

<p><strong>逻辑操作符</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;&amp;                           <span class="comment">#与，并且关系</span></span><br><span class="line">||                           <span class="comment">#或，或者关系</span></span><br><span class="line">!                            <span class="comment">#非，取反</span></span><br></pre></td></tr></table></figure>

<p>范例：! 取反</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print i&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -v i=10 &#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -v i=0 &#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -v i=-10 &#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -v i=abc &#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -v i=&#x27;&#x27; &#x27;BEGIN&#123;print !i&#125;&#x27;</span></span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;$3&gt;=0 &amp;&amp; $3&lt;5 &#123;print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root 0</span><br><span class="line"> bin 1</span><br><span class="line"> daemon 2</span><br><span class="line"> adm 3</span><br><span class="line"> lp 4</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;$3&lt;1 || $3&gt;1010 &#123;print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root 0</span><br><span class="line"> nobody 65534</span><br><span class="line"> jerry 1011</span><br><span class="line"> tom 1012</span><br><span class="line"> tom-cat 1013</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;!($3!=0) &#123;print $1,$3&#125;&#x27;     /etc/passwd</span></span><br><span class="line"> root 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;!($3&gt;=5) &#123;print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root 0</span><br><span class="line"> bin 1</span><br><span class="line"> daemon 2</span><br><span class="line"> adm 3</span><br><span class="line"> lp 4</span><br></pre></td></tr></table></figure>

<p><strong>三目运算(条件表达式)</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selector?if-true-expression:if-false-expression</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -F: &#x27;&#123;$3&gt;=1000?utype=&quot;Common&quot;:utype=&quot;Sys&quot;;printf &quot;%-20s:%12s\n&quot;,$1,utype&#125;&#x27; /etc/passwd</span></span><br><span class="line">root                :         Sys</span><br><span class="line">bin                 :         Sys</span><br><span class="line">daemon              :         Sys</span><br><span class="line">adm                 :         Sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment">#  df|awk -F&quot;[ %]+&quot; &#x27;/^\/dev\/sd/&#123;$(NF-1)&gt;10?disk=&quot;full&quot;:disk=&quot;OK&quot;;print $(NF-1),disk&#125;&#x27;</span></span><br><span class="line">21 full</span><br></pre></td></tr></table></figure>

<p>范例: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat scores.txt</span></span><br><span class="line"> wang 100</span><br><span class="line"> li 90</span><br><span class="line"> zhang 50</span><br><span class="line"> zhao 80</span><br><span class="line"> han 70</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;$2&gt;=60?type=&quot;pass&quot;:type=&quot;nopass&quot;&#123;print $1,type&#125;&#x27; scores.txt</span></span><br><span class="line"> wang pass</span><br><span class="line"> li pass</span><br><span class="line"> zhang nopass</span><br><span class="line"> zhao pass</span><br><span class="line"> han pass</span><br></pre></td></tr></table></figure>

<h3 id="模式PATTERN"><a href="#模式PATTERN" class="headerlink" title="模式PATTERN"></a>模式PATTERN</h3><p>PATTERN：根据pattern条件，过滤匹配的行，再做处理，如果没有指定，则匹配每一行</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;&#123;print $0&#125;&#x27; /etc/issue</span></span><br><span class="line"> Welcom to magedu! \d</span><br><span class="line"> \S</span><br><span class="line"> Kernel \r on an \m</span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;NR==1&#123;print $0&#125;&#x27; /etc/issue</span></span><br><span class="line"> Welcom to magedu! \d</span><br></pre></td></tr></table></figure>

<p><strong>正则匹配</strong></p>
<p>范例：用正则匹配，正则表达式需要用/ / 来锚定开始结束</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment">#  awk &#x27;/^UUID/&#123;print $1&#125;&#x27; /etc/fstab</span></span><br><span class="line">UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#非空行，非注释行</span></span><br><span class="line">[root@rocky8 ~]<span class="comment">#  awk &#x27;!/^$|^#/&#123;print $1&#125;&#x27; /etc/fstab </span></span><br><span class="line">/dev/mapper/rl-root</span><br><span class="line">UUID=a8e3c539-a7e7-4828-9a4d-08a9ec290d07</span><br><span class="line">/dev/mapper/rl-home</span><br><span class="line">/dev/mapper/rl-swap</span><br></pre></td></tr></table></figure>

<p><strong>关系表达式</strong></p>
<p>关系表达式，结果为“真”才会被处理</p>
<p>真：结果为非0值，非空字符串 </p>
<p>假：结果为0值或空字符串</p>
<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#seq 3 | awk &#x27;1&#x27; </span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#seq 3 | awk &#x27;!1&#x27; </span></span><br><span class="line">[root@centos8 ~]<span class="comment">#seq 3 | awk &#x27;0&#x27; </span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;!0&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#false 这里表示的是一个未定义的变量，不是表示bool值</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;false&#x27;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk -v false=123 &#x27;false&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#false 这里表示的是字符串</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;&quot;false&quot;&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;&quot;&quot;&#x27;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;&quot; &quot;&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;&quot;0&quot;&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里true 是变量名，一个不存在的变量</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;true&#x27;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk -v true=123 &#x27;true&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;123&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;mage&#x27;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk -v mage=&quot;mage&quot; &#x27;mage&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk -v mage=&quot;&quot; &#x27;mage&#x27;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk -v mage=&quot; &quot; &#x27;mage&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk -v mage=0 &#x27;mage&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#赋值</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i=0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#比较</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i==0&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line"><span class="comment">#赋值</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i=1&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line"><span class="comment">#比较</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i==1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#比较</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i==i&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> <span class="comment">#比较</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i!=i&#x27;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">#赋值 i=false</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i=i&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#赋值 tru false true</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 3 | awk &#x27;i=!i&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 4 | awk   &#x27;&#123;i=!i;print i&#125;&#x27;</span></span><br><span class="line"> 1</span><br><span class="line"> 0</span><br><span class="line"> 1</span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 8 | awk &#x27;!(i=!i)&#x27;</span></span><br><span class="line"> 2</span><br><span class="line"> 4</span><br><span class="line"> 6</span><br><span class="line"> 8</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 8 | awk  -v  i=1 &#x27;i=!i&#x27;</span></span><br><span class="line"> 2</span><br><span class="line"> 4</span><br><span class="line"> 6</span><br><span class="line"> 8</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;i=1;j=1&#123;print i,j&#125;&#x27; /etc/issue</span></span><br><span class="line"> Welcom to magedu! \d</span><br><span class="line"> 1 1</span><br><span class="line"> \S</span><br><span class="line"> 1 1</span><br><span class="line"> Kernel \r on an \m</span><br><span class="line"> 1 1</span><br><span class="line"> 1 1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;i=1,j=1&#123;print i,j&#125;&#x27; /etc/issue</span></span><br><span class="line"> 1 1</span><br><span class="line"> 1 1</span><br><span class="line"> 1 1</span><br><span class="line"> 1 1</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk  -F: &#x27;$3&gt;=1000&#123;print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line"> nobody 65534</span><br><span class="line"> jose 1010</span><br><span class="line"> jerry 1011</span><br><span class="line"> mage 1000</span><br><span class="line"> tom 1012</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk  -F: &#x27;$NF==&quot;/bin/bash&quot;&#123;print $1,$NF&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root /bin/bash</span><br><span class="line"> jose /bin/bash</span><br><span class="line"> jerry /bin/bash</span><br></pre></td></tr></table></figure>



<p><strong>行范围</strong></p>
<p>不支持直接用行号，但可以使用变量NR间接指定行号</p>
<p>也可以用正则锚定开始结束行</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># seq 10 | awk &#x27;NR&gt;=3 &amp;&amp; NR&lt;6&#x27;</span></span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"> 5</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;NR&gt;=3 &amp;&amp; NR&lt;6&#123;print NR,$0&#125;&#x27; /etc/passwd</span></span><br><span class="line"> 3 daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"> 4 adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line"> 5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#sed 写法</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># sed -n &#x27;3,5p&#x27; /etc/passwd</span></span><br><span class="line"> daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"> adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line"> lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#正则锚定</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;/^bin/,/^adm/&#x27; /etc/passwd</span></span><br><span class="line"> bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line"> daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"> adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#sed写法</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># sed -n &#x27;/^bin/,/^adm/p&#x27; /etc/passwd</span></span><br><span class="line"> bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line"> daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"> adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br></pre></td></tr></table></figure>



<p> <strong>BEGIN/END模式</strong></p>
<p>BEGIN{}：仅在开始处理文件中的文本之前执行一次 </p>
<p>END{}：仅在文本处理完成之后执行一次</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#只有begin 时，可以没有输入内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print &quot;begin&quot;&#125;&#x27;</span></span><br><span class="line"> begin</span><br><span class="line"></span><br><span class="line"><span class="comment">#需要后续输入</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print &quot;begin&quot;&#125;&#123;&#125;&#x27;</span></span><br><span class="line"> begin</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print &quot;begin&quot;&#125;&#123;print $0&#125;END&#123;print &quot;end&quot;&#125;&#x27; /etc/issue</span></span><br><span class="line"> begin</span><br><span class="line"> Welcom to magedu! \d</span><br><span class="line"> \S</span><br><span class="line"> Kernel \r on an \m</span><br><span class="line"> end</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># awk -F:   &#x27;BEGIN&#123;printf &quot;--------------------------------\n%-20s|%10s|\n--------------------------------\n&quot;,&quot;username&quot;,&quot;uid&quot;&#125;&#123;printf &quot;%-20s|%10d|\n--------------------------------\n&quot;,$1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line">--------------------------------</span><br><span class="line">username            |       uid|</span><br><span class="line">--------------------------------</span><br><span class="line">root                |         0|</span><br><span class="line">--------------------------------</span><br><span class="line">bin                 |         1|</span><br><span class="line">--------------------------------</span><br><span class="line">daemon              |         2|</span><br><span class="line">--------------------------------</span><br></pre></td></tr></table></figure>

<h3 id="条件判断-if-else"><a href="#条件判断-if-else" class="headerlink" title="条件判断 if-else"></a>条件判断 if-else</h3><p>使用场景：对awk取得的整行或某个字段做条件判断</p>
<p>语法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)&#123;statement;…&#125;[<span class="keyword">else</span> statement]</span><br><span class="line"><span class="keyword">if</span>(condition1)&#123;statement1&#125;<span class="keyword">else</span> <span class="keyword">if</span>(condition2)&#123;statement2&#125;<span class="keyword">else</span> <span class="keyword">if</span>(condition3)</span><br><span class="line">&#123;statement3&#125;...... <span class="keyword">else</span> &#123;statementN&#125;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;&#123;if($3&gt;=1000)print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line"> nobody 65534</span><br><span class="line"> jose 1010</span><br><span class="line"> jerry 1011</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;&#123;if($3&lt;=100)&#123;print &quot;&lt;=100&quot;,$3&#125;else if ($3&lt;=1000) &#123;print &quot;&lt;=1000&quot;,$3&#125; else&#123;print &quot;&gt;=1000&quot;,$3&#125;&#125;&#x27; /etc/passwd</span></span><br><span class="line"> &lt;=100 0</span><br><span class="line"> &lt;=100 1</span><br><span class="line"> &lt;=100 2</span><br><span class="line"> &lt;=100 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;&#123;if($NF==&quot;/bin/bash&quot;) print $1&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root</span><br><span class="line"> jose</span><br><span class="line"> jerry</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;&#123;if(NF&gt;5) print $0&#125;&#x27; /etc/fstab</span></span><br><span class="line"> ......</span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;&#123;if($3&gt;=1000) &#123;printf &quot;Common user: %s\n&quot;,$1&#125; else &#123;printf &quot;root or Sysuser: %s\n&quot;,$1&#125;&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root or Sysuser: root</span><br><span class="line"> root or Sysuser: bin</span><br><span class="line"> root or Sysuser: daemon</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># df -h|awk -F% &#x27;/^\/dev\/sd/&#123;print $1&#125;&#x27;| awk &#x27;$NF&gt;=10&#123;print $1,$5&#125;&#x27;</span></span><br><span class="line"> /dev/sda1 26</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># df | awk -F&quot;[[:space:]]+|%&quot; &#x27;/^\/dev\/sd/&#123;if($5&gt;10)print $1,$5&#125;&#x27;</span></span><br><span class="line"> /dev/sda1 26</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># df | awk -F&#x27; +|%&#x27; &#x27;/^\/dev\/sd/&#123;if($5&gt;=10)print $1,$5&#125;&#x27;</span></span><br><span class="line"> /dev/sda1 26</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># df | awk -F&quot;[ %]+&quot; &#x27;/^\/dev\/sd/&#123;if($(NF-1)&gt;10)&#123;print $(NF-1)&quot; full&quot;&#125;else &#123;print $(NF-1)&quot; OK&quot;&#125;&#125;&#x27;</span></span><br><span class="line"> 26 full</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123; test=100;if(test&gt;90)&#123;print &quot;very good&quot;&#125;else if(test&gt;60)&#123; print &quot;good&quot;&#125;else&#123;print &quot;no pass&quot;&#125;&#125;&#x27;</span></span><br><span class="line"> very good</span><br></pre></td></tr></table></figure>

<h3 id="条件判断-switch-case"><a href="#条件判断-switch-case" class="headerlink" title="条件判断 switch-case"></a>条件判断 switch-case</h3><p>awk 中的switch分支语句功能较弱，只能进行等值比较或正则匹配。 </p>
<p>各分支结尾需使用break来终止</p>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression) &#123;</span><br><span class="line">    <span class="keyword">case</span> VALUE1 or /REGEXP1/: </span><br><span class="line">        statement1;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">case</span> VALUE2 or /REGEXP2/: </span><br><span class="line">        statement2; </span><br><span class="line">        <span class="keyword">break</span>;  </span><br><span class="line">   ......;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">default</span>: </span><br><span class="line">       statementn;</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>分支穿透：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression) &#123;</span><br><span class="line">    <span class="keyword">case</span> VALUE1 or /REGEXP1/: </span><br><span class="line">    <span class="keyword">case</span> VALUE2 or /REGEXP2/: </span><br><span class="line">    <span class="keyword">case</span> VALUE3 or /REGEXP3/: </span><br><span class="line">        statement1;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">case</span> VALUE4 or /REGEXP4/: </span><br><span class="line">        statement2; </span><br><span class="line">        <span class="keyword">break</span>;  </span><br><span class="line">    ......;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">        statementn;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"> &#125; </span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;&#123;switch($3)&#123;case 0:print &quot;root&quot;,$3;break; case /^[1-9][0-9]&#123;0,2&#125;$|1000/:print &quot;sys user&quot;,$3;break;default:print &quot;common user&quot;,$3;&#125;&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root 0</span><br><span class="line"> sys user 1</span><br><span class="line"> sys user 2</span><br><span class="line"> sys user 3 </span><br><span class="line"> sys user 4</span><br><span class="line"> sys user 5</span><br></pre></td></tr></table></figure>

<h3 id="循环-while"><a href="#循环-while" class="headerlink" title="循环 while"></a>循环 while</h3><p>条件“真”，进入循环；条件“假”，退出循环  </p>
<p>使用场景： 对一行内的多个字段逐一类似处理时使用；对数组中的各元素逐一处理时使用</p>
<p>语法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (condition) &#123;statement;…&#125;</span><br></pre></td></tr></table></figure>



<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -v i=1 -v sum=0 &#x27;BEGIN&#123;while(i&lt;=100)&#123;sum+=i;i++&#125;;print sum&#125;&#x27;</span></span><br><span class="line"> 5050</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123; total=0;i=1;while(i&lt;=100)&#123;total+=i;i++&#125;;print total&#125;&#x27;</span></span><br><span class="line"> 5050</span><br></pre></td></tr></table></figure>

<h3 id="循环-do-while"><a href="#循环-do-while" class="headerlink" title="循环 do-while"></a>循环 do-while</h3><p>无论真假，至少执行一次循环体</p>
<p>语法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;statement;…&#125;<span class="keyword">while</span>(condition)</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123; total=0;i=1;do&#123; total+=i;i++;&#125;while(i&lt;=100);print total&#125;&#x27;</span></span><br><span class="line"> 5050</span><br><span class="line"> </span><br><span class="line"><span class="comment">#至少执行一次循环</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123; total=0;i=101;do&#123; print total &#125;while(i&lt;=100);&#125;&#x27;</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<h3 id="循环-for"><a href="#循环-for" class="headerlink" title="循环 for"></a>循环 for</h3><p>语法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(expr1;expr2;expr3) &#123;statement;…&#125;</span><br></pre></td></tr></table></figure>

<p>特殊用法：能够遍历数组中的元素</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(var <span class="keyword">in</span> array) &#123;for-body&#125;</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;sum+=i&#125;;print sum&#125;&#x27;</span></span><br><span class="line"> 5050</span><br><span class="line"> </span><br><span class="line"><span class="comment">#shell实现</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for((i=1,sum=0;i&lt;=100;i++));do let sum+=i;done;echo $sum</span></span><br><span class="line"> 5050</span><br></pre></td></tr></table></figure>

<p>范例：遍历数组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123; arr[0]=123;arr[1]=456;for(i in arr)&#123; print i&quot;==&gt;&quot;arr[i] &#125;;&#125;&#x27;</span></span><br><span class="line"> 0==&gt;123</span><br><span class="line"> 1==&gt;456</span><br></pre></td></tr></table></figure>

<p>面试题：文件abc.txt只有一行数字，计算其总和</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat abc.txt</span></span><br><span class="line"> 1 2 3 4 5</span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat abc.txt |awk &#x27;&#123;for(i=1;i&lt;=NF;i++)&#123;sum+=$i&#125;;print sum&#125;&#x27;</span></span><br><span class="line"> 15</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat abc.txt|tr &#x27; &#x27; + |bc</span></span><br><span class="line"> 15</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># sum=0;for i in `cat abc.txt`;do let sum+=i;done;echo $sum</span></span><br><span class="line"> 15</span><br></pre></td></tr></table></figure>

<p>性能比较</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">time (awk <span class="string">&#x27;BEGIN&#123; total=0;for(i=0;i&lt;=10000;i++)&#123;total+=i;&#125;;print total;&#125;&#x27;</span>)</span><br><span class="line">time (total=0;<span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10000&#125;;<span class="keyword">do</span> total=$((<span class="variable">$total</span>+i));<span class="keyword">done</span>;<span class="built_in">echo</span> <span class="variable">$total</span>)</span><br><span class="line">time (<span class="keyword">for</span> ((i=<span class="number">0</span>;i&lt;=<span class="number">10000</span>;i++));<span class="keyword">do</span> <span class="built_in">let</span> total+=i;<span class="keyword">done</span>;<span class="built_in">echo</span> <span class="variable">$total</span>)</span><br><span class="line">time (<span class="built_in">seq</span> –s ”+” 10000|bc)</span><br></pre></td></tr></table></figure>

<p>范例: 取出字符串中的数字</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo &#x27;dsFUs34tg*fs5a%8ar%$#@&#x27; |awk -F &quot;&quot; &#x27;</span></span><br><span class="line"> &gt; &#123;</span><br><span class="line"> &gt;   <span class="keyword">for</span>(i=1;i&lt;=NF;i++) </span><br><span class="line"> &gt;  &#123;  </span><br><span class="line"> &gt;       <span class="keyword">if</span> (<span class="variable">$i</span> ~ /[0-9]/) </span><br><span class="line"> &gt;      &#123; </span><br><span class="line"> &gt;         str=(str <span class="variable">$i</span>)                    <span class="comment">#连字符，字符串拼接</span></span><br><span class="line"> &gt;      &#125;  </span><br><span class="line"> &gt;  &#125; </span><br><span class="line"> &gt;  <span class="built_in">print</span> str</span><br><span class="line"> &gt; &#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string"> 3458</span></span><br></pre></td></tr></table></figure>

<h3 id="continue-和-break"><a href="#continue-和-break" class="headerlink" title="continue 和 break"></a>continue 和 break</h3><p>continue 中断本次循环</p>
<p>break 中断整个循环</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">continue</span> [n]</span><br><span class="line"><span class="built_in">break</span> [n]</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;for(i=1;i&lt;=100;i++)&#123;if(i==50)continue;sum+=i&#125;;print sum&#125;&#x27;</span></span><br><span class="line"> 5000</span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;for(i=1;i&lt;=100;i++)&#123;if(i==50)break;sum+=i&#125;;print sum&#125;&#x27;</span></span><br><span class="line"> 1225</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;if(i%2==0)continue;sum+=i&#125;print sum&#125;&#x27;</span></span><br><span class="line"> 2500</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;if(i==50)break;sum+=i&#125;print sum&#125;&#x27;</span></span><br><span class="line"> 1225</span><br></pre></td></tr></table></figure>

<h3 id="next"><a href="#next" class="headerlink" title="next"></a>next</h3><p>next 可以提前结束对本行处理而直接进入下一行处理（awk自身循环）</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;&#123;if($3%2!=0)&#123;next;&#125; print $1,$3&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root 0</span><br><span class="line"> daemon 2</span><br><span class="line"> lp 4</span><br><span class="line"> shutdown 6</span><br><span class="line"> mail 8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># seq 10 |awk &#x27;&#123;if($0%2!=0)&#123;next&#125;;&#123;print $0&#125;&#125;&#x27;</span></span><br><span class="line"> 2</span><br><span class="line"> 4</span><br><span class="line"> 6</span><br><span class="line"> 8</span><br><span class="line"> 10</span><br></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>awk的数组为关联数组</p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array_name[index-expression]</span><br></pre></td></tr></table></figure>



<p> index-expression</p>
<ul>
<li>利用数组，实现 k/v 功能  </li>
<li>可使用任意字符串；字符串要使用双引号括起来  </li>
<li>如果某数组元素事先不存在，在引用时，awk会自动创建此元素，并将其值初始化为“空串”  </li>
<li>若要判断数组中是否存在某元素，要使用“index in array”格式进行遍历</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;print weekdays[&quot;mon&quot;]&#125;&#x27;</span></span><br><span class="line"> Monday</span><br></pre></td></tr></table></figure>





<p>范例：判断数组索引是否存在</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;array[&quot;i&quot;]=&quot;x&quot;; array[&quot;j&quot;]=&quot;y&quot; ; print &quot;i&quot; in array,&quot;y&quot; in array &#125;&#x27;</span></span><br><span class="line"> 1 0</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;array[&quot;i&quot;]=&quot;x&quot;; array[&quot;j&quot;]=&quot;y&quot; ;if (&quot;i&quot; in array ) &#123;print &quot;存在&quot;&#125;else&#123;print &quot;不存在&quot;&#125;&#125;&#x27;</span></span><br><span class="line">存在</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;array[&quot;i&quot;]=&quot;x&quot;; array[&quot;j&quot;]=&quot;y&quot; ;if (&quot;abc&quot; in array ) &#123;print &quot;存在&quot;&#125;else&#123;print &quot;不存在&quot;&#125;&#125;&#x27;</span></span><br><span class="line">不存在</span><br></pre></td></tr></table></figure>



<p>若要遍历数组中的每个元素，要使用 for 循环</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(var <span class="keyword">in</span> array) &#123;for-body&#125;</span><br></pre></td></tr></table></figure>

<p>范例：遍历数组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;for(i in weekdays) &#123;print i,weekdays[i]&#125;&#125;&#x27;</span></span><br><span class="line"> tue Tuesday</span><br><span class="line"> mon Monday</span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;students[1]=&quot;user1&quot;;students[2]=&quot;user2&quot;;students[3]=&quot;user3&quot;;for(x in students)&#123;print x&quot;:&quot;students[x]&#125;&#125;&#x27;</span></span><br><span class="line"> 1:user1</span><br><span class="line"> 2:user2</span><br><span class="line"> 3:user3</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;BEGIN &#123;</span></span><br><span class="line">&gt;  a[<span class="string">&quot;x&quot;</span>] = <span class="string">&quot;welcome&quot;</span></span><br><span class="line">&gt;  a[<span class="string">&quot;y&quot;</span>] = <span class="string">&quot;to&quot;</span></span><br><span class="line">&gt;  a[<span class="string">&quot;z&quot;</span>] = <span class="string">&quot;Magedu&quot;</span></span><br><span class="line">&gt;  <span class="keyword">for</span> (i <span class="keyword">in</span> a) &#123;</span><br><span class="line">&gt;      <span class="built_in">print</span> i,a[i]</span><br><span class="line">&gt;  &#125;</span><br><span class="line">&gt;  &#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">x welcome</span></span><br><span class="line"><span class="string">y to</span></span><br><span class="line"><span class="string">z Magedu</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@rocky86 ~]# awk -F: &#x27;</span>&#123;user[<span class="variable">$1</span>]=<span class="variable">$3</span>&#125;END&#123;<span class="keyword">for</span>(i <span class="keyword">in</span> user)&#123;<span class="built_in">print</span> <span class="string">&quot;username: &quot;</span>i,<span class="string">&quot;uid: &quot;</span>user[i]&#125;&#125;<span class="string">&#x27; /etc/passwd</span></span><br><span class="line"><span class="string"> username: adm uid: 3</span></span><br><span class="line"><span class="string"> username: rpc uid: 32</span></span><br><span class="line"><span class="string"> username: dnsmasq uid: 985</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment">#awk &#x27;&#123;ip[$1]++&#125;END&#123;for(i in ip)&#123;print i,ip[i]&#125;&#125;&#x27; /var/log/httpd/access_log</span></span><br><span class="line"> 172.20.0.200 1482</span><br><span class="line"> 172.20.21.121 2</span><br><span class="line"> 172.20.30.91 29</span><br><span class="line"> 172.16.102.29 864</span><br><span class="line"> 172.20.0.76 1565</span><br><span class="line"> 172.20.9.9 15</span><br><span class="line"> 172.20.1.125 463</span><br><span class="line"> 172.20.61.11 2</span><br><span class="line"> 172.20.73.73 198</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment">#awk &#x27;&#123;ip[$1]++&#125;END&#123;for(i in ip)&#123;print ip[i],i&#125;&#125;&#x27; access_log |sort -nr| head -3</span></span><br><span class="line"> 4870 172.20.116.228</span><br><span class="line"> 3429 172.20.116.208</span><br><span class="line"> 2834 172.20.0.222</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment">#awk &#x27;&#123;ip[$1]++&#125;END&#123;for(i in ip)&#123;print i,ip[i]&#125;&#125;&#x27; access_log |sort -k2 -nr|head -3</span></span><br><span class="line"> 172.20.116.228 4870</span><br><span class="line"> 172.20.116.208 3429</span><br><span class="line"> 172.20.0.222 2834</span><br></pre></td></tr></table></figure>

<p>范例：封掉查看访问日志中连接次数超过1000次的IP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;&#123;ip[$1]++&#125;END&#123;for(i in ip)&#123;if(ip[i]&gt;=1000)&#123;system(&quot;iptables -A INPUT -s &quot;i&quot; -j REJECT&quot;)&#125;&#125;&#125;&#x27; /var/log/httpd/access_log</span></span><br></pre></td></tr></table></figure>

<p>范例：多维数组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;</span></span><br><span class="line"> &gt; array[1][1]=11</span><br><span class="line"> &gt; array[1][2]=12</span><br><span class="line"> &gt; array[1][3]=13</span><br><span class="line"> &gt; array[2][1]=21</span><br><span class="line"> &gt; array[2][2]=22</span><br><span class="line"> &gt; array[2][3]=23</span><br><span class="line"> &gt; <span class="keyword">for</span> (i <span class="keyword">in</span> array)</span><br><span class="line"> &gt;     <span class="keyword">for</span> (j <span class="keyword">in</span> array[i])</span><br><span class="line"> &gt;         <span class="built_in">print</span> array[i][j]</span><br><span class="line"> &gt; &#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string"> 11</span></span><br><span class="line"><span class="string"> 12</span></span><br><span class="line"><span class="string"> 13</span></span><br><span class="line"><span class="string"> 21</span></span><br><span class="line"><span class="string"> 22</span></span><br><span class="line"><span class="string"> 23</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat score.txt </span></span><br><span class="line">name sex score</span><br><span class="line">alice f  100</span><br><span class="line">bob   m  90</span><br><span class="line">ming m  95</span><br><span class="line">hong f  90</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;NR!=1&#123;if($2==&quot;m&quot;)&#123;m_sum+=$3;m_num++&#125;else&#123;f_sum+=$3;f_num++&#125;&#125;END&#123;print &quot;男生平均成绩=&quot;m_sum/m_num,&quot;女生平均成绩=&quot;f_sum/f_num&#125;&#x27; score.txt</span></span><br><span class="line">男生平均成绩=92.5 女生平均成绩=95</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;NR!=1&#123;score[$2]+=$3;num[$2]++&#125;END&#123;for(i in score)&#123;print i,score[i]/num[i]&#125;&#125;&#x27; score.txt </span></span><br><span class="line">m 92.5</span><br><span class="line">f 95</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># awk &#x27;NR!=1&#123;score[$2]+=$3;num[$2]++&#125;END&#123;for(i in score) &#123;if(i==&quot;m&quot;)&#123;print &quot;男生平均成绩=&quot;,score[i]/num[i]&#125;else&#123;print &quot;女生平均成绩=&quot;,score[i]/num[i]&#125;&#125;&#125;&#x27; score.txt </span></span><br><span class="line">男生平均成绩= 92.5</span><br><span class="line">女生平均成绩= 95</span><br></pre></td></tr></table></figure>

<h3 id="awk-函数"><a href="#awk-函数" class="headerlink" title="awk 函数"></a>awk 函数</h3><p>awk 的函数分为内置和自定义函数</p>
<p>官方文档</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.gnu.org/software/gawk/manual/gawk.html<span class="comment">#Functions</span></span><br></pre></td></tr></table></figure>

<h4 id="常见内置函数"><a href="#常见内置函数" class="headerlink" title="常见内置函数"></a>常见内置函数</h4><p><strong>数值处理</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rand()                           <span class="comment">#返回0和1之间一个随机数</span></span><br><span class="line">srand()                          <span class="comment">#配合rand() 函数,生成随机数的种子</span></span><br><span class="line">int()                            <span class="comment">#返回整数</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span><br><span class="line"> 0.790437</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span><br><span class="line"> 0.283736</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;srand(); for (i=1;i&lt;=5;i++)print int(rand()*100) &#125;&#x27;</span></span><br><span class="line"> 35</span><br><span class="line"> 17</span><br><span class="line"> 35</span><br><span class="line"> 95</span><br><span class="line"> 19</span><br></pre></td></tr></table></figure>

<p><strong>字符串处理</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str1=(str2,str3)                     <span class="comment">#连字符，字符串拼接</span></span><br><span class="line">length([s])                          <span class="comment">#返回指定字符串的长度</span></span><br><span class="line">sub(r,s,[t])                         <span class="comment">#在t中串搜索r匹配的内容，并将第一个匹配内容替换为s</span></span><br><span class="line">gsub(r,s,[t])                        <span class="comment">#在t中串搜索r匹配的内容，并将匹配内容全部替换为s，即贪婪模式</span></span><br><span class="line"><span class="built_in">split</span>(s,array,[r])                   <span class="comment">#以r为分隔符，切割串s，并将结果保存至array数组中，索引值为1,2,…</span></span><br></pre></td></tr></table></figure>

<p>范例: 统计用户名的长度</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cut -d: -f1 /etc/passwd | awk &#x27;&#123;print length()&#125;&#x27;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;&#123;print length($1)&#125;&#x27; /etc/passwd</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;sub(/:/,&quot;-&quot;,$1)&#x27;</span></span><br><span class="line"> 2008-08:08 08:08:08</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;&#123;sub(/:/,&quot;-&quot;,$1);print $0&#125;&#x27;</span></span><br><span class="line"> 2008-08:08 08:08:08</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;gsub(/:/,&quot;-&quot;,$0)&#x27;</span></span><br><span class="line"> 2008-08-08 08-08-08</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;&#123;gsub(/:/,&quot;-&quot;,$0);print $0&#125;&#x27;</span></span><br><span class="line"> 2008-08-08 08-08-08</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># netstat -tn | awk &#x27;/^tcp/&#123;split($4,ip,&quot;:&quot;);count[ip[1]]++&#125;END&#123;for(i in count)&#123;print i,count[i]&#125;&#125;&#x27;</span></span><br><span class="line"> 10.0.0.1 1</span><br><span class="line"> 10.0.0.6 1</span><br><span class="line"> 10.0.0.7 673</span><br></pre></td></tr></table></figure>

<p><strong>调用shell命令</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(<span class="string">&#x27;cmd&#x27;</span>) </span><br></pre></td></tr></table></figure>

<p>空格是awk中的字符串连接符，如果system中需要使用awk中的变量可以使用空格分隔，或者说除了awk的变量外其他一律用””引用起来</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;system(&quot;hostname&quot;)&#125;&#x27;</span></span><br><span class="line"> rocky86.m51.magedu.com</span><br><span class="line"> </span><br><span class="line"> root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;score=100; system(&quot;echo your score is &quot; score) &#125;&#x27;</span></span><br><span class="line"> your score is 100</span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># netstat -tn | awk &#x27;/^tcp/&#123;split($5,ip,&quot;:&quot;);count[ip[1]]++&#125;END&#123;for(i in count) &#123;if(count[i]&gt;=10)&#123;system(&quot;iptables -A INPUT -s &quot;i&quot; -j REJECT&quot;)&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>时间函数</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systime()                   <span class="comment">#当前时间到1970年1月1日的秒数</span></span><br><span class="line">strftime()                  <span class="comment">#指定时间格式</span></span><br></pre></td></tr></table></figure>

<p>范例: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print systime()&#125;&#x27;</span></span><br><span class="line"> 1609917829</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print systime();system(&quot;date +%s&quot;)&#125;&#x27;</span></span><br><span class="line"> 1661687319</span><br><span class="line"> 1661687319</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print strftime(&quot;%Y-%m-%dT%H:%M&quot;,systime()-3600)&#125;&#x27;</span></span><br><span class="line"> 2021-01-06T14:24</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print strftime(&quot;%Y-%m-%d %H:%M:%S&quot;);system(&quot;date \&quot;+%Y-%m-%d %H:%M:%S\&quot;&quot;)&#125;&#x27;</span></span><br><span class="line"> 2022-08-28 19:51:34</span><br><span class="line"> 2022-08-28 19:51:34</span><br></pre></td></tr></table></figure>

<h4 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h4><p>自定义函数格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">name</span> <span class="params">( parameter, parameter, ... )</span> &#123;</span><br><span class="line">   statements</span><br><span class="line">   <span class="keyword">return</span> expression</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;function test()&#123;print &quot;hello test func&quot;&#125;BEGIN&#123;test()&#125;&#x27;</span></span><br><span class="line"> hello <span class="built_in">test</span> func</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: &#x27;function test(uname,uid)&#123;print uname&quot; id is &quot;uid&#125;&#123;test($1,$3)&#125;&#x27; /etc/passwd</span></span><br><span class="line"> root <span class="built_in">id</span> is 0</span><br><span class="line"> bin <span class="built_in">id</span> is 1</span><br><span class="line"> daemon <span class="built_in">id</span> is 2</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat func.awk</span></span><br><span class="line"> <span class="keyword">function</span> max(x,y) &#123;</span><br><span class="line">   x&gt;y?var=x:var=y</span><br><span class="line">   <span class="built_in">return</span> var</span><br><span class="line"> &#125;</span><br><span class="line"> BEGIN&#123;<span class="built_in">print</span> max(a,b)&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -v a=30 -v b=20 -f func.awk</span></span><br><span class="line"> 30</span><br></pre></td></tr></table></figure>

<h3 id="awk-脚本"><a href="#awk-脚本" class="headerlink" title="awk 脚本"></a>awk 脚本</h3><p>将awk程序写成脚本，直接调用或执行</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat passwd.awk </span></span><br><span class="line">&#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;=1000)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F: -f passwd.awk /etc/passwd</span></span><br><span class="line"> nobody 65534</span><br><span class="line"> wang 1000</span><br><span class="line"> mage 1001</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat test.awk</span></span><br><span class="line"> <span class="comment">#!/bin/awk -f</span></span><br><span class="line"> &#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;=1000)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment">#chmod +x test.awk</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ./test.awk -F: /etc/passwd</span></span><br><span class="line"> nobody 65534</span><br><span class="line"> wang 1000</span><br><span class="line"> mage 1001</span><br></pre></td></tr></table></figure>

<p><strong>向awk脚本传递参数</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awkfile  var=value  var2=value2... Inputfile</span><br></pre></td></tr></table></figure>

<p>注意： </p>
<ul>
<li>上面格式变量在BEGIN过程中不可用。直到首行输入完成以后，变量才可用 </li>
<li>可以通过-v 参数，让awk在执行BEGIN之前得到变量的值</li>
<li>命令行中每一个指定的变量都需要一个-v参数</li>
</ul>
<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -v x=100 &#x27;BEGIN&#123;print x&#125;&#123;print x+100&#125;&#x27; /etc/hosts</span></span><br><span class="line"> 100</span><br><span class="line"> 200</span><br><span class="line"> 200</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk &#x27;BEGIN&#123;print x&#125;&#123;print x+100&#125;&#x27; x=200 /etc/hosts</span></span><br><span class="line"> 300</span><br><span class="line"> 300</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat test2.awk </span></span><br><span class="line"> <span class="comment">#!/bin/awk -f</span></span><br><span class="line"> &#123;<span class="keyword">if</span>(<span class="variable">$3</span> &gt;=min &amp;&amp; <span class="variable">$3</span>&lt;=max)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125; </span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># chmod +x test2.awk</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ./test2.awk -F: min=100 max=200 /etc/passwd</span></span><br><span class="line"> systemd-resolve 193</span><br><span class="line"> rtkit 172</span><br><span class="line"> pulse 171</span><br><span class="line"> qemu 107</span><br><span class="line"> usbmuxd 113</span><br><span class="line"> abrt 173</span><br></pre></td></tr></table></figure>

<p><strong>练习</strong></p>
<p>1、文件host_list.log 如下格式，请提取”.magedu.com”前面的主机名部分并写入到回到该文件中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 www.magedu.com</span><br><span class="line">2 blog.magedu.com</span><br><span class="line">3 study.magedu.com</span><br><span class="line">4 linux.magedu.com</span><br><span class="line">5 python.magedu.com</span><br><span class="line">......</span><br><span class="line">999 study.magedu.com</span><br></pre></td></tr></table></figure>

<p>参考答案:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -F&#x27;[ .]&#x27; &#x27;&#123;print $2&#125;&#x27; host_list.log &gt;&gt; host_list.log </span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat host_list.log </span></span><br><span class="line"> 1 www.magedu.com</span><br><span class="line"> 1 www.magedu.com</span><br><span class="line"> 2 blog.magedu.com</span><br><span class="line"> 3 study.magedu.com</span><br><span class="line"> 4 linux.magedu.com</span><br><span class="line"> 5 python.magedu.com</span><br><span class="line"> ......</span><br><span class="line"> 999 study.magedu.com</span><br><span class="line"> www</span><br><span class="line"> blog</span><br><span class="line"> study</span><br><span class="line"> linux</span><br><span class="line"> python</span><br></pre></td></tr></table></figure>

<p> 2、统计/etc/fstab文件中每个文件系统类型出现的次数 </p>
<p>参考答案</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -F&#x27; +&#x27; &#x27;/^UUID/&#123;fs[$3]++&#125;END&#123;for(i in fs)&#123;print i,fs[i]&#125;&#125;&#x27; /etc/fstab</span></span><br><span class="line"> swap 1</span><br><span class="line"> ext4 3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F&#x27; +&#x27; &#x27;/^UUID/&#123;print $3&#125;&#x27; /etc/fstab |uniq -c</span></span><br><span class="line">   3 ext4</span><br><span class="line">   1 swap</span><br></pre></td></tr></table></figure>

<p>3、统计/etc/fstab文件中每个单词出现的次数</p>
<p>参考答案</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># awk -F&quot;[^[:alpha:]]&quot; &#x27;&#123;for(i=1;i&lt;=NF;i++)word[$i]++&#125;END&#123;for (a in word)if(a !=&quot;&quot;) print a,word[a]&#125;&#x27;   /etc/fstab</span></span><br></pre></td></tr></table></figure>

<p> 4、提取出字符串Yd$C@M05MB%9&amp;Bdh7dq+YVixp3vpw中的所有数字</p>
<p>参考答案</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo &#x27;Yd$C@M05MB%9&amp;Bdh7dq+YVixp3vpw&#x27; | awk &#x27;&#123;gsub(/[^0-9]/,&quot;&quot;);print $0&#125;&#x27;</span></span><br><span class="line"> 05973</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &#x27;Yd$C@M05MB%9&amp;Bdh7dq+YVixp3vpw&#x27; |awk -F &quot;&quot; &#x27;&#123;for(i=1;i&lt;=NF;i++)&#123;if ($i ~ /[[:digit:]]/) &#123;str=$i; str1=(str1 str)&#125;&#125;;print str1&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &#x27;Yd$C@M05MB%9&amp;Bdh7dq+YVixp3vpw&#x27; | awk -F&#x27;[^0-9]&#x27; &#x27;&#123;for(i=1;i&lt;=NF;i++)&#123;printf &quot;%s&quot;,$i&#125;&#125;&#x27;</span></span><br><span class="line"> 05973</span><br></pre></td></tr></table></figure>

<p> 5、文件random.txt记录共5000个随机的整数，存储的格式100,50,35,89…请取出其中最大和最小的整数</p>
<p>参考答案</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str=&quot;&quot;;for((i=1;i&lt;=5000;i++));do if [ $i -ne 5000 ];then str+=&quot;$RANDOM,&quot;;else str+=$RANDOM;fi;done;echo $str &gt; random.txt</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F, &#x27;&#123;max=$1;min=$1;for(i=1;i&lt;=NF;i++)&#123;if($i&gt;max)&#123;max=$i&#125;else&#123;if($i&lt;min)&#123;min=$i&#125;&#125;&#125;&#125;END&#123;print &quot;最大值：&quot;max,&quot;最小值：&quot;min&#125;&#x27; random.txt</span></span><br></pre></td></tr></table></figure>

<p>6、解决Dos攻击生产案例：监控当某个IP并发连接数超过100时，即调用防火墙命令封掉对应的IP，监 控频率每隔5分钟。防火墙命令为： iptables -A INPUT -s IP -j REJECT </p>
<p>参考答案</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># ss -nt | awk -F &quot; +|:&quot; &#x27;NR!=1&#123;ip[$(NF-2)]++&#125;END&#123;for(i in ip)&#123;if(ip[i]&gt;100)&#123;system(&quot;iptables -A INPUT -s &quot;i&quot; -j REJECT&quot;)&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>7、将以下文件内容中FQDN取出并根据其进行计数从高到低排序</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://mail.magedu.com/index.html</span><br><span class="line"> http://www.magedu.com/test.html</span><br><span class="line"> http://study.magedu.com/index.html</span><br><span class="line"> http://blog.magedu.com/index.html</span><br><span class="line"> http://www.magedu.com/images/logo.jpg</span><br><span class="line"> http://blog.magedu.com/20080102.html</span><br><span class="line"> http://www.magedu.com/images/magedu.jpg</span><br></pre></td></tr></table></figure>

<p>参考答案:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#awk -F&quot;/&quot; &#x27;&#123;url[$3]++&#125;END&#123;for(i in url)&#123;print url[i],i&#125;&#125;&#x27; url.log |sort -nr</span></span><br><span class="line"> 3 www.magedu.com</span><br><span class="line"> 2 blog.magedu.com</span><br><span class="line"> 1 study.magedu.com</span><br><span class="line"> 1 mail.magedu.com</span><br></pre></td></tr></table></figure>

<p> 8、将以下文本文件awktest.txt中 以inode列为标记，对inode列相同的counts列进行累加，并且统计出 同一inode中，beginnumber列中 的最小值和endnumber列中的最大值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">inode|beginnumber|endnumber|counts|</span><br><span class="line">106|3363120000|3363129999|10000|</span><br><span class="line">106|3368560000|3368579999|20000|</span><br><span class="line">310|3337000000|3337000100|101|</span><br><span class="line">310|3342950000|3342959999|10000|</span><br><span class="line">310|3362120960|3362120961|2|</span><br><span class="line">311|3313460102|3313469999|9898|</span><br><span class="line">311|3313470000|3313499999|30000|</span><br><span class="line">311|3362120962|3362120963|2|</span><br></pre></td></tr></table></figure>

<p>输出的结果格式为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">106|3363120000|3368579999|30000|</span><br><span class="line">310|3337000000|3362120961|10103|</span><br><span class="line">311|3313460102|3362120963|39900|</span><br></pre></td></tr></table></figure>

<p>参考答案:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#cat awktest.txt</span></span><br><span class="line"> inode|beginnumber|endnumber|counts|</span><br><span class="line"> 106|3363120000|3363129999|10000|</span><br><span class="line"> 106|3368560000|3368579999|20000|</span><br><span class="line"> 310|3337000000|3337000100|101|</span><br><span class="line"> 310|3342950000|3342959999|10000|</span><br><span class="line"> 310|3362120960|3362120961|2|</span><br><span class="line"> 311|3313460102|3313469999|9898|</span><br><span class="line"> 311|3313470000|3313499999|30000|</span><br><span class="line"> 311|3362120962|3362120963|2|</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F &#x27;|&#x27; &#x27;!/^inode/&#123;sum[$1]+=$4;if(!begin[$1])begin[$1]=$2;else if(begin[$1]&gt;$2)begin[$1]=$2;if(!end[$1])end[$1]=$3;else if(end[$1]&lt;$3)end[$1]=$3&#125;END&#123;for(i in sum)print i&quot;|&quot;begin[i]&quot;|&quot;end[i]&quot;|&quot;sum[i]&#125;&#x27; awktest.txt</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># awk -F&#x27;|&#x27; -v OFS=&#x27;|&#x27; &#x27;/^[0-9]/&#123;inode[$1]++; if(!bn[$1])&#123;bn[$1]=$2&#125;else if(bn[$1]&gt;$2) &#123;bn[$1]=$2&#125;; if(en[$1]&lt;$3)en[$1]=$3;cnt[$1]+=$(NF-1)&#125; END&#123;for(i in inode)print i,bn[i],en[i],cnt[i]&#125;&#x27; awktest.txt</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/23/SRE-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">http://example.com/2024/09/23/SRE-常见文本处理工具和正则表达式/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SRE/">SRE</a></div><div class="post_share"><div class="social-share" data-image="/../images/title/linux5.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/31/SRE-%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" title="用户和权限管理"><img class="cover" src="/../images/title/linux4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">用户和权限管理</div></div></a></div><div class="next-post pull-right"><a href="/2024/10/12/MY-markdown%E6%96%87%E5%AD%97%E6%95%88%E6%9E%9C/" title="markdown 文字效果"><img class="cover" src="/../images/title/markdown.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">markdown 文字效果</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/04/24/SRE-Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%92%8C%E5%B8%AE%E5%8A%A9/" title="Linux基本操作和帮助"><img class="cover" src="/../images/title/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="title">Linux基本操作和帮助</div></div></a></div><div><a href="/2024/08/27/SRE-Linux%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%92%8CIO%E9%87%8D%E5%AE%9A%E5%90%91/" title="Linux文件管理和IO重定向"><img class="cover" src="/../images/title/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="title">Linux文件管理和IO重定向</div></div></a></div><div><a href="/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="shell脚本编程"><img class="cover" src="/../images/title/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-05</div><div class="title">shell脚本编程</div></div></a></div><div><a href="/2024/12/06/SRE-%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9FDNS%E6%9C%8D%E5%8A%A1/" title="域名系统DNS服务"><img class="cover" src="/../images/image/SRE/day16/15.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-06</div><div class="title">域名系统DNS服务</div></div></a></div><div><a href="/2024/12/04/SRE-%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" title="加密和安全"><img class="cover" src="/../images/image/SRE/day15/13.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-04</div><div class="title">加密和安全</div></div></a></div><div><a href="/2024/10/20/SRE-%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E5%92%8C%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9/" title="文件查找和打包压缩"><img class="cover" src="/../images/title/linux1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-20</div><div class="title">文件查找和打包压缩</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/title/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%B7%A5%E5%85%B7%E4%B9%8B%E7%A5%9EVIM"><span class="toc-number">1.</span> <span class="toc-text">文本编辑工具之神VIM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vi%E5%92%8Cvim%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">vi和vim简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-vim-%E5%88%9D%E6%AD%A5"><span class="toc-number">1.2.</span> <span class="toc-text">使用 vim 初步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vim-%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.1.</span> <span class="toc-text">vim 命令格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E4%B8%BB%E8%A6%81%E6%A8%A1%E5%BC%8F%E5%92%8C%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.2.2.</span> <span class="toc-text">三种主要模式和转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">扩展命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.1.</span> <span class="toc-text">扩展命令模式基本命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%AE%9A%E7%95%8C"><span class="toc-number">1.3.2.</span> <span class="toc-text">地址定界</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%AE%9A%E7%95%8C%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">地址定界格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%AE%9A%E7%95%8C%E5%90%8E%E8%B7%9F%E4%B8%80%E4%B8%AA%E7%BC%96%E8%BE%91%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">地址定界后跟一个编辑命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%B9%B6%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">查找并替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6vim%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.4.</span> <span class="toc-text">定制vim的工作特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E5%8F%B7"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">行号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%BD%E7%95%A5%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%86%99"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">忽略字符的大小写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E7%BC%A9%E8%BF%9B"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">自动缩进</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E4%BF%9D%E7%95%99%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">复制保留格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BATab-I%E5%92%8C%E6%8D%A2%E8%A1%8C%E7%AC%A6-%E5%92%8C-%E6%98%BE%E7%A4%BA"><span class="toc-number">1.3.4.5.</span> <span class="toc-text">显示Tab ^I和换行符 和$显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%90%9C%E7%B4%A2"><span class="toc-number">1.3.4.6.</span> <span class="toc-text">高亮搜索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE"><span class="toc-number">1.3.4.7.</span> <span class="toc-text">语法高亮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.4.8.</span> <span class="toc-text">文件格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tab-%E7%94%A8%E7%A9%BA%E6%A0%BC%E4%BB%A3%E6%9B%BF"><span class="toc-number">1.3.4.9.</span> <span class="toc-text">Tab 用空格代替</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tab%E7%94%A8%E6%8C%87%E5%AE%9A%E7%A9%BA%E6%A0%BC%E7%9A%84%E4%B8%AA%E6%95%B0%E4%BB%A3%E6%9B%BF"><span class="toc-number">1.3.4.10.</span> <span class="toc-text">Tab用指定空格的个数代替</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%BC%A9%E8%BF%9B%E5%AE%BD%E5%BA%A6"><span class="toc-number">1.3.4.11.</span> <span class="toc-text">设置缩进宽度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%85%89%E6%A0%87%E6%89%80%E5%9C%A8%E8%A1%8C%E7%9A%84%E6%A0%87%E8%AF%86%E7%BA%BF"><span class="toc-number">1.3.4.12.</span> <span class="toc-text">设置光标所在行的标识线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86"><span class="toc-number">1.3.4.13.</span> <span class="toc-text">加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E6%9B%B4%E5%A4%9A"><span class="toc-number">1.3.4.14.</span> <span class="toc-text">了解更多</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BAVIM"><span class="toc-number">1.4.1.</span> <span class="toc-text">退出VIM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%89%E6%A0%87%E8%B7%B3%E8%BD%AC"><span class="toc-number">1.4.2.</span> <span class="toc-text">光标跳转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E8%BE%91"><span class="toc-number">1.4.3.</span> <span class="toc-text">字符编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E5%91%BD%E4%BB%A4-replace"><span class="toc-number">1.4.4.</span> <span class="toc-text">替换命令(replace)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%91%BD%E4%BB%A4-delete"><span class="toc-number">1.4.5.</span> <span class="toc-text">删除命令(delete)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E5%91%BD%E4%BB%A4-yank"><span class="toc-number">1.4.6.</span> <span class="toc-text">复制命令(yank)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B2%98%E8%B4%B4%E5%91%BD%E4%BB%A4-paste"><span class="toc-number">1.4.7.</span> <span class="toc-text">粘贴命令(paste)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E5%91%BD%E4%BB%A4-change"><span class="toc-number">1.4.8.</span> <span class="toc-text">改变命令(change)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE"><span class="toc-number">1.4.9.</span> <span class="toc-text">查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%A4%E6%B6%88%E6%9B%B4%E6%94%B9"><span class="toc-number">1.4.10.</span> <span class="toc-text">撤消更改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="toc-number">1.4.11.</span> <span class="toc-text">高级用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.</span> <span class="toc-text">可视化模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%AA%97%E5%8F%A3%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">多窗口模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E5%88%86%E5%89%B2"><span class="toc-number">1.6.1.</span> <span class="toc-text">多文件分割</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E7%AA%97%E5%8F%A3%E5%88%86%E5%89%B2"><span class="toc-number">1.6.2.</span> <span class="toc-text">单文件窗口分割</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9"><span class="toc-number">1.7.</span> <span class="toc-text">帮助</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vim-%E6%80%BB%E7%BB%93%E5%9B%BE"><span class="toc-number">1.8.</span> <span class="toc-text">vim 总结图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%B8%B8%E8%A7%81%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">2.</span> <span class="toc-text">文本常见处理工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%9F%A5%E7%9C%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">文件内容查看命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">2.1.1.</span> <span class="toc-text">查看文本文件内容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cat"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">cat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nl"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">nl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tac"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">tac</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rev"><span class="toc-number">2.1.1.4.</span> <span class="toc-text">rev</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9D%9E%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">2.1.2.</span> <span class="toc-text">查看非文本文件内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">2.2.</span> <span class="toc-text">分页查看文件内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#more"><span class="toc-number">2.2.1.</span> <span class="toc-text">more</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#less"><span class="toc-number">2.2.2.</span> <span class="toc-text">less</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%96%87%E6%9C%AC%E5%89%8D%E9%9D%A2%E6%88%96%E5%90%8E%E9%9D%A2%E7%9A%84%E8%A1%8C%E5%86%85%E5%AE%B9"><span class="toc-number">2.3.</span> <span class="toc-text">显示文本前面或后面的行内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#head"><span class="toc-number">2.3.1.</span> <span class="toc-text">head</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tail"><span class="toc-number">2.3.2.</span> <span class="toc-text">tail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#head-%E5%92%8C-tail-%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.3.</span> <span class="toc-text">head 和 tail 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E5%88%97%E6%8A%BD%E5%8F%96%E6%96%87%E6%9C%AC-cut"><span class="toc-number">2.4.</span> <span class="toc-text">按列抽取文本 cut</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6-paste"><span class="toc-number">2.5.</span> <span class="toc-text">合并多个文件 paste</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E6%96%87%E6%9C%AC%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">2.6.</span> <span class="toc-text">分析文本的工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E6%96%87%E6%9C%AC%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE-wc"><span class="toc-number">2.6.1.</span> <span class="toc-text">收集文本统计数据 wc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%8E%92%E5%BA%8F-sort"><span class="toc-number">2.6.2.</span> <span class="toc-text">文本排序 sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D-uniq"><span class="toc-number">2.6.3.</span> <span class="toc-text">去重 uniq</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%96%87%E4%BB%B6"><span class="toc-number">2.6.4.</span> <span class="toc-text">比较文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#diff"><span class="toc-number">2.6.4.1.</span> <span class="toc-text">diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#patch"><span class="toc-number">2.6.4.2.</span> <span class="toc-text">patch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vimdiff"><span class="toc-number">2.6.4.3.</span> <span class="toc-text">vimdiff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cmp"><span class="toc-number">2.6.4.4.</span> <span class="toc-text">cmp</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">正则表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%83%E5%AD%97%E7%AC%A6"><span class="toc-number">3.1.</span> <span class="toc-text">基本正则表达式元字符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%8C%B9%E9%85%8D"><span class="toc-number">3.1.1.</span> <span class="toc-text">字符匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%AC%A1%E6%95%B0"><span class="toc-number">3.1.2.</span> <span class="toc-text">匹配次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E9%94%9A%E5%AE%9A"><span class="toc-number">3.1.3.</span> <span class="toc-text">位置锚定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%85%B6%E5%AE%83"><span class="toc-number">3.1.4.</span> <span class="toc-text">分组其它</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%96%E8%80%85"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">或者</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%83%E4%B9%A0"><span class="toc-number">3.1.5.</span> <span class="toc-text">正则表达式练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%83%E5%AD%97%E7%AC%A6"><span class="toc-number">3.2.</span> <span class="toc-text">扩展正则表达式元字符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%8C%B9%E9%85%8D-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">字符匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%AC%A1%E6%95%B0-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">匹配次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E9%94%9A%E5%AE%9A-1"><span class="toc-number">3.2.3.</span> <span class="toc-text">位置锚定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%85%B6%E5%AE%83-1"><span class="toc-number">3.2.4.</span> <span class="toc-text">分组其它</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%83%E4%B9%A0"><span class="toc-number">3.2.5.</span> <span class="toc-text">扩展正则表达式练习</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2"><span class="toc-number">4.</span> <span class="toc-text">文本处理三剑客</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8B-grep"><span class="toc-number">4.1.</span> <span class="toc-text">文本处理三剑客之 grep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8B-sed"><span class="toc-number">4.2.</span> <span class="toc-text">文本处理三剑客之 sed</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sed-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.2.1.</span> <span class="toc-text">sed 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">4.2.2.</span> <span class="toc-text">sed 基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="toc-number">4.2.3.</span> <span class="toc-text">sed 高级用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8B-awk"><span class="toc-number">4.3.</span> <span class="toc-text">文本处理三剑客之 awk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95%E8%AF%B4%E6%98%8E"><span class="toc-number">4.3.1.</span> <span class="toc-text">awk 工作原理和基本用法说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E5%8F%98%E9%87%8F"><span class="toc-number">4.3.2.</span> <span class="toc-text">awk 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">内置变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">自定义变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E4%BD%9C-print"><span class="toc-number">4.3.3.</span> <span class="toc-text">动作 print</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E4%BD%9C-printf"><span class="toc-number">4.3.4.</span> <span class="toc-text">动作 printf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">4.3.5.</span> <span class="toc-text">操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8FPATTERN"><span class="toc-number">4.3.6.</span> <span class="toc-text">模式PATTERN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD-if-else"><span class="toc-number">4.3.7.</span> <span class="toc-text">条件判断 if-else</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD-switch-case"><span class="toc-number">4.3.8.</span> <span class="toc-text">条件判断 switch-case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-while"><span class="toc-number">4.3.9.</span> <span class="toc-text">循环 while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-do-while"><span class="toc-number">4.3.10.</span> <span class="toc-text">循环 do-while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-for"><span class="toc-number">4.3.11.</span> <span class="toc-text">循环 for</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#continue-%E5%92%8C-break"><span class="toc-number">4.3.12.</span> <span class="toc-text">continue 和 break</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#next"><span class="toc-number">4.3.13.</span> <span class="toc-text">next</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">4.3.14.</span> <span class="toc-text">数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.15.</span> <span class="toc-text">awk 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.15.1.</span> <span class="toc-text">常见内置函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.15.2.</span> <span class="toc-text">自定义函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E8%84%9A%E6%9C%AC"><span class="toc-number">4.3.16.</span> <span class="toc-text">awk 脚本</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/06/XM-%E5%AE%9E%E7%8E%B0Internet%E7%9A%84DNS%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/" title="DNS服务架构"><img src="/../images/image/SRE/day16/16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DNS服务架构"/></a><div class="content"><a class="title" href="/2024/12/06/XM-%E5%AE%9E%E7%8E%B0Internet%E7%9A%84DNS%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/" title="DNS服务架构">DNS服务架构</a><time datetime="2024-12-05T16:14:34.000Z" title="发表于 2024-12-06 00:14:34">2024-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/06/SRE-%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9FDNS%E6%9C%8D%E5%8A%A1/" title="域名系统DNS服务"><img src="/../images/image/SRE/day16/15.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="域名系统DNS服务"/></a><div class="content"><a class="title" href="/2024/12/06/SRE-%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9FDNS%E6%9C%8D%E5%8A%A1/" title="域名系统DNS服务">域名系统DNS服务</a><time datetime="2024-12-05T16:11:29.000Z" title="发表于 2024-12-06 00:11:29">2024-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/04/SRE-%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" title="加密和安全"><img src="/../images/image/SRE/day15/13.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="加密和安全"/></a><div class="content"><a class="title" href="/2024/12/04/SRE-%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" title="加密和安全">加密和安全</a><time datetime="2024-12-03T16:00:00.000Z" title="发表于 2024-12-04 00:00:00">2024-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/01/SRE-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E6%A0%B8%E7%AE%A1%E7%90%86/" title="系统启动和内核管理"><img src="/../images/title/linux4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="系统启动和内核管理"/></a><div class="content"><a class="title" href="/2024/12/01/SRE-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E6%A0%B8%E7%AE%A1%E7%90%86/" title="系统启动和内核管理">系统启动和内核管理</a><time datetime="2024-11-30T16:00:00.000Z" title="发表于 2024-12-01 00:00:00">2024-12-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>