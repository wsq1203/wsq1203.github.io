<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>域名系统DNS服务 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Site Reliability Engineering">
<meta property="og:type" content="article">
<meta property="og:title" content="域名系统DNS服务">
<meta property="og:url" content="http://example.com/2024/12/06/SRE-%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9FDNS%E6%9C%8D%E5%8A%A1/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="Site Reliability Engineering">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/SRE/day16/15.png">
<meta property="article:published_time" content="2024-12-05T16:11:29.000Z">
<meta property="article:modified_time" content="2025-04-01T11:34:55.965Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="SRE">
<meta property="article:tag" content="DNS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/SRE/day16/15.png"><link rel="shortcut icon" href="/../images/TITLE/user.webp"><link rel="canonical" href="http://example.com/2024/12/06/SRE-%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9FDNS%E6%9C%8D%E5%8A%A1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '域名系统DNS服务',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2025-04-01 19:34:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/TITLE/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">102</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/SRE/day16/15.png')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">域名系统DNS服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-12-05T16:11:29.000Z" title="发表于 2024-12-06 00:11:29">2024-12-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-01T11:34:55.965Z" title="更新于 2025-04-01 19:34:55">2025-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/DNS/">DNS</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>56分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="域名系统DNS服务"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="名字解析介绍和DNS"><a href="#名字解析介绍和DNS" class="headerlink" title="名字解析介绍和DNS"></a>名字解析介绍和DNS</h1><p>当前TCP/IP网络中的设备之间进行通信，是利用和依赖于IP地址实现的。但数字形式的IP地址是很难记忆的。当网络设备众多，想要记住每个设备的IP地址，可以说是”不可能完成的任务”。那么如何解决这一难题呢？我们可以给每个网络设备起一个友好的名称，如：<a target="_blank" rel="noopener" href="http://www.wang.org,这种由文字组成的名/">www.wang.org，这种由文字组成的名</a> 称，显而易见要更容易记忆。但是计算机不会理解这种名称的，我们可以利用一种名字解析服务将名称转化成（解析）成IP地址。从而我们就可以利用名称来直接访问网络中设备了。除此之外还有一个重要功能，利用名称解析服务可以实现主机和IP的<code>解耦</code>，即：当主机IP变化时，只需要修改名称服务即可，用户仍可以通过原有的名称进行访问而不受影响。 </p>
<p>实现此服务的方法是多样的。如下面所述： </p>
<p>本地名称解析配置文件：hosts</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Linux: /etc/hosts</span><br><span class="line">windows: %WINDIR%/system32/drivers/etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#格式</span></span><br><span class="line">122.10.117.2 www.wang.org. www</span><br><span class="line">93.46.8.89   www.google.com. google</span><br></pre></td></tr></table></figure>

<p>DNS：Domain Name System 域名系统,应用层协议,是互联网的一项服务。它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网,基于C/S架构，服务器端：53/udp, 53/tcp </p>
<p>BIND：Bekerley Internet Name Domain,由 ISC （<a target="_blank" rel="noopener" href="http://www.isc.org)提供的dns软件实现dns域名结构/">www.isc.org）提供的DNS软件实现DNS域名结构</a></p>
<p><img src="../../../../images/SRE/day16/1.png" alt="1"></p>
<ul>
<li><p>根域: 全球根服务器节点只有13个,10个在美国，1个荷兰，1个瑞典，1个日本</p>
</li>
<li><p>一级域名：Top Level Domain: tld</p>
<p>三类：组织域、国家域(.cn, .ca, .hk, .tw)、反向域</p>
<p>com, edu, mil, gov, net, org, int,arpa</p>
</li>
<li><p>二级域名：wang.org</p>
</li>
<li><p>三级域名：study.wang.org</p>
</li>
<li><p>最多可达到127级域名</p>
</li>
</ul>
<p>ICANN（The Internet Corporation for Assigned Names and Numbers）互联网名称与数字地址分配机构，负责在全球范围内对互联网通用顶级域名（gTLD）以及国家和地区顶级域名（ccTLD）系统的管理、以及根服务器系统的管理</p>
<h2 id="DNS服务工作原理"><a href="#DNS服务工作原理" class="headerlink" title="DNS服务工作原理"></a>DNS服务工作原理</h2><p><img src="../../../../images/SRE/day16/2.png" alt="2"></p>
<p><strong>13个根服务器地址和所在地区</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.toutiao.com/a7033024151724130823/?log_from=53294f6dcaec9_1643288102998</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day16/3.png" alt="3"></p>
<p><strong>根服务器的安全</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2004年4月由于顶级域名.ly域名瘫痪,导致利比亚从互联网消失了3天</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day16/4.png" alt="4"></p>
<p><strong>雪人计划</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在与现有IPv4根服务器体系架构充分兼容基础上，&quot;雪人计划&quot;于2016年在美国、日本、印度、俄罗斯、德国、法国等全球16个国家完成25台IPv6根服务器架设，</span><br><span class="line">其中1台主根和3台辅根部署在中国，事实上形成了13台原有根加25台IPv6根的新格局</span><br></pre></td></tr></table></figure>

<h2 id="DNS查询类型"><a href="#DNS查询类型" class="headerlink" title="DNS查询类型"></a>DNS查询类型</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://help.aliyun.com/document_detail/102237.html</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day16/5.png" alt="5"></p>
<ul>
<li><p>递归查询： </p>
<p>是指DNS服务器在收到用户发起的请求时，必须向用户返回一个准确的查询结果。如果DNS服务器本地没有存储与之对应的信息，则该服务器需要询问其他服务器，并将返回的查询结构提交给用户。 </p>
<p>一般客户机和本地DNS服务器之间属于递归查询，即当客户机向DNS服务器发出请求后,若DNS服务器本身不能解析，则会向另外的DNS服务器发出查询请求，得到最终的肯定或否定的结果后转交给客户机。此查询的源和目标保持不变,为了查询结果只需要发起一次查询</p>
<p>递归算法:客户端向LocalDNS发起域名查询–&gt;localDNS不知道域名对应的IP–&gt;但它知道谁知道-&gt;他代为帮客户端去查找–&gt;最后再返回最终结果 </p>
</li>
<li><p>迭代查询：</p>
<p>是指DNS服务器在收到用户发起的请求时，并不直接回复查询结果，而是告诉另一台DNS服务器的地址，用户再向这台DNS服务器提交请求，这样依次反复，直到返回查询结果。 </p>
<p>一般情况下(有例外)本地的DNS服务器向其它DNS服务器的查询属于迭代查询,如：若对方不能返回权威的结果，则它会向下一个DNS服务器(参考前一个DNS服务器返回的结果)再次发起进行查询，直到返回查询的结果为止。此查询的源不变,但查询的目标不断变化,为查询结果一般需要发起多次查询 </p>
<p>迭代算法︰客户端向LocalDNS发起域名查询–&gt;localDNS不知道域名对应的IP–&gt;但它知道谁知道并推荐客户端应该找谁–&gt;客户端自己去找它 </p>
</li>
<li><p>DNS缓存:  </p>
<p>DNS缓存是将解析数据存储在靠近发起请求的客户端的位置，也可以说DNS数据是可以缓存在任意位置，最终目的是以此减少递归查询过程，可以更快的让用户获得请求结果。</p>
</li>
</ul>
<h2 id="名称服务器"><a href="#名称服务器" class="headerlink" title="名称服务器"></a>名称服务器</h2><p>Name Server,域内负责解析本域内的名称的DNS服务器</p>
<p>IPv4的根名称服务器：全球共13个负责解析根域的DNS服务器，美国10个，荷兰1，瑞典1，日本1</p>
<p>IPv6的根名称服务器：全球共25个，中国1主3从，美国1主2从</p>
<h2 id="解析类型"><a href="#解析类型" class="headerlink" title="解析类型"></a>解析类型</h2><ul>
<li><p>FQDN –&gt; IP 正向解析 </p>
</li>
<li><p>IP –&gt; FQDN 反向解析 </p>
<p>注意：正反向解析是两个不同的名称空间，是两棵不同的解析树</p>
</li>
</ul>
<h2 id="完整的查询请求经过的流程"><a href="#完整的查询请求经过的流程" class="headerlink" title="完整的查询请求经过的流程"></a>完整的查询请求经过的流程</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Client --&gt;hosts文件 --&gt; Client DNS Service Local Cache --&gt; DNS Server (recursion递归) </span><br><span class="line">--&gt; DNS Server Cache --&gt;DNS iteration(迭代) --&gt; 根--&gt; 顶级域名DNS--&gt;二级域名DNS… </span><br></pre></td></tr></table></figure>

<p>范例: Windows 客户端DNS缓存</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;ipconfig/displaydns | findstr  redhat</span><br><span class="line">C:\Users\Administrator&gt;ping www.redhat.com</span><br><span class="line">正在 Ping e3396.ca2.s.tl88.net [117.177.243.181] 具有 32 字节的数据:</span><br><span class="line">来自 117.177.243.181 的回复: 字节=32 时间=29ms TTL=53</span><br><span class="line">来自 117.177.243.181 的回复: 字节=32 时间=30ms TTL=53</span><br><span class="line">来自 117.177.243.181 的回复: 字节=32 时间=29ms TTL=53</span><br><span class="line">来自 117.177.243.181 的回复: 字节=32 时间=31ms TTL=53</span><br><span class="line"></span><br><span class="line">117.177.243.181 的 Ping 统计信息:</span><br><span class="line">    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，</span><br><span class="line">往返行程的估计时间(以毫秒为单位):</span><br><span class="line">    最短 = 29ms，最长 = 31ms，平均 = 29ms</span><br><span class="line">    </span><br><span class="line">C:\Users\Administrator&gt;ipconfig/displaydns | findstr  redhat</span><br><span class="line">    www.redhat.com</span><br><span class="line">    记录名称. . . . . . . : www.redhat.com</span><br><span class="line">    CNAME 记录  . . . . . : ds-www.redhat.com.edgekey.net</span><br><span class="line">    记录名称. . . . . . . : ds-www.redhat.com.edgekey.net</span><br><span class="line">    CNAME 记录  . . . . . : ds-www.redhat.com.edgekey.net.globalredir.akadns.net</span><br><span class="line">    记录名称. . . . . . . : ds-www.redhat.com.edgekey.net.globalredir.akadns.net</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;ipconfig/flushdns</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line">已成功刷新 DNS 解析缓存。</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;ipconfig/displaydns | findstr  redhat</span><br></pre></td></tr></table></figure>

<h1 id="DNS-服务相关概念和技术"><a href="#DNS-服务相关概念和技术" class="headerlink" title="DNS 服务相关概念和技术"></a>DNS 服务相关概念和技术</h1><h2 id="DNS服务器的类型"><a href="#DNS服务器的类型" class="headerlink" title="DNS服务器的类型"></a>DNS服务器的类型</h2><ul>
<li>主DNS服务器 </li>
<li>从DNS服务器 </li>
<li>缓存DNS服务器（转发器）</li>
</ul>
<h3 id="主DNS服务器"><a href="#主DNS服务器" class="headerlink" title="主DNS服务器"></a>主DNS服务器</h3><p>管理和维护所负责解析的域内解析库的服务器</p>
<h3 id="从DNS服务器"><a href="#从DNS服务器" class="headerlink" title="从DNS服务器"></a>从DNS服务器</h3><p>从主服务器或从服务器”复制”（区域传输）解析库副本 </p>
<ul>
<li>序列号：解析库版本号，主服务器解析库变化时，其序列递增 </li>
<li>刷新时间间隔：从服务器从主服务器请求同步解析的时间间隔 </li>
<li>重试时间间隔：从服务器请求同步失败时，再次尝试时间间隔 </li>
<li>过期时长：从服务器联系不到主服务器时，多久后停止服务 </li>
<li>通知机制：主服务器解析库发生变化时，会主动通知从服务器</li>
</ul>
<h2 id="区域传输"><a href="#区域传输" class="headerlink" title="区域传输"></a>区域传输</h2><ul>
<li>完全传输：传送整个解析库 </li>
<li>增量传输：传递解析库变化的那部分内容 </li>
</ul>
<h2 id="解析形式"><a href="#解析形式" class="headerlink" title="解析形式"></a>解析形式</h2><ul>
<li>正向：FQDN（ Fully Qualified Domain Name） –&gt; IP </li>
<li>反向: IP –&gt; FQDN</li>
</ul>
<h2 id="负责本地域名的正向和反向解析库"><a href="#负责本地域名的正向和反向解析库" class="headerlink" title="负责本地域名的正向和反向解析库"></a>负责本地域名的正向和反向解析库</h2><ul>
<li>正向区域 </li>
<li>反向区域</li>
</ul>
<h2 id="解析答案"><a href="#解析答案" class="headerlink" title="解析答案"></a>解析答案</h2><ul>
<li>肯定答案：存在对应的查询结果 </li>
<li>否定答案：请求的条目不存在等原因导致无法返回结果 </li>
<li>权威答案：直接由存有此查询结果的DNS服务器（权威服务器）返回的答案 </li>
<li>非权威答案：由其它非权威服务器返回的查询答案</li>
</ul>
<h2 id="各种资源记录"><a href="#各种资源记录" class="headerlink" title="各种资源记录"></a>各种资源记录</h2><p>区域解析库：由众多资源记录RR(Resource Record)组成</p>
<p>记录类型：A, AAAA, PTR, SOA, NS, CNAME, MX</p>
<ul>
<li>SOA：Start Of Authority，起始授权记录；一个区域解析库有且仅能有一个SOA记录，必须位于解析库的第一条记录 </li>
<li>A：internet Address，作用，FQDN –&gt; IP </li>
<li>AAAA：FQDN –&gt; IPv6 PTR：PoinTeR，IP –&gt; FQDN </li>
<li>NS：Name Server，专用于标明当前区域的DNS服务器 </li>
<li>CNAME ： Canonical Name，别名记录 </li>
<li>MX：Mail eXchanger，邮件交换器 </li>
<li>TXT：对域名进行标识和说明的一种方式，一般做验证记录时会使用此项，如：SPF（反垃圾邮件）记录，https验证等，如下示例：</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_dnsauth TXT 2012011200000051qgs69bwoh4h6nht4n1h0lr038x</span><br></pre></td></tr></table></figure>

<h3 id="资源记录定义的"><a href="#资源记录定义的" class="headerlink" title="资源记录定义的"></a>资源记录定义的</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name [TTL] IN rr_type value</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>TTL可从全局继承 </li>
<li>使用 “@” 符号可用于引用当前区域的域名</li>
<li>同一个名字可以通过多条记录定义多个不同的值；此时DNS服务器会以轮询方式响应</li>
<li>同一个值也可能有多个不同的定义名字；通过多个不同的名字指向同一个值进行定义；此仅表示通过多个不同的名字可以找到同一个主机</li>
</ol>
<p>面试题：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 我的网站域名需要更改，如何使其更快的生效？</span><br><span class="line">2. 更改TTL值为多少比较合适呢？是如何生效的？</span><br></pre></td></tr></table></figure>

<h3 id="SOA记录"><a href="#SOA记录" class="headerlink" title="SOA记录"></a>SOA记录</h3><p>Start Of Authority，起始授权记录</p>
<p>name: 当前区域的名字，例如”wang.org.” </p>
<p>value: 有多部分组成 </p>
<p>注意： </p>
<ol>
<li>当前区域的主DNS服务器的FQDN，也可以使用当前区域的名字，只是注释功能，可以不需要配置对应的NS记录和A记录</li>
<li>当前区域管理员的邮箱地址；但地址中不能使用@符号，一般用.替换，例如：admin.wang.org </li>
<li>主从服务区域传输相关定义以及否定的答案的统一的TTL </li>
</ol>
<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wang.org. 86400 IN SOA ns.wang.org. nsadmin.wang.org. (</span><br><span class="line">        2015042201 ;序列号</span><br><span class="line">        2H         ;刷新时间</span><br><span class="line">        10M        ;重试时间</span><br><span class="line">        1W         ;过期时间</span><br><span class="line">        1D         ;否定答案的TTL值</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<h3 id="NS记录"><a href="#NS记录" class="headerlink" title="NS记录"></a>NS记录</h3><p>name: 当前区域的名字</p>
<p>value: 当前区域的某DNS服务器的名字，例如: ns.wang.org.</p>
<p>注意：</p>
<ol>
<li>相邻的两个资源记录的name相同时，后续的可省略 </li>
<li>对NS记录而言，任何一个ns记录后面的服务器名字，都应该在后续有一个A记录 </li>
<li>一个区域可以有多个NS记录</li>
</ol>
<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wang.org. IN NS ns1.wang.org.</span><br><span class="line">wang.org. IN NS ns2.wang.org.</span><br></pre></td></tr></table></figure>

<h3 id="MX记录"><a href="#MX记录" class="headerlink" title="MX记录"></a>MX记录</h3><p>name: 当前区域的名字 </p>
<p>value: 当前区域的某邮件服务器(smtp服务器)的主机名 </p>
<p>注意： </p>
<ol>
<li>一个区域内，MX记录可有多个；但每个记录的value之前应该有一个数字(0-99)，表示此服务器的 优先级；数字越小优先级越高 </li>
<li>对MX记录而言，任何一个MX记录后面的服务器名字，都应该在后续有一个A记录</li>
</ol>
<p> 范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wang.org. IN MX 10 mx1.wang.org.</span><br><span class="line">          IN MX 20 mx2.wang.org.</span><br><span class="line">mx1             A   10.0.0.100</span><br><span class="line">mx2             A   10.0.0.200</span><br></pre></td></tr></table></figure>

<h3 id="A记录"><a href="#A记录" class="headerlink" title="A记录"></a>A记录</h3><p>name: 某主机的FQDN，例如：<a target="_blank" rel="noopener" href="http://www.wang.org/">www.wang.org</a>.</p>
<p> value: 主机名对应主机的IP地址</p>
<p>避免用户写错名称时给错误答案，可通过泛域名解析进行解析至某特定地址</p>
<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">www.wang.org.            IN   A 1.1.1.1</span><br><span class="line">www.wang.org.            IN   A 2.2.2.2</span><br><span class="line">mx1.wang.org.            IN   A 3.3.3.3</span><br><span class="line">mx2.wang.org.            IN   A 4.4.4.4</span><br><span class="line">$GENERATE 1-254 HOST$    IN   A 1.2.3.$</span><br><span class="line">*.wang.org.              IN   A 5.5.5.5</span><br><span class="line">wang.org.                IN   A 6.6.6.6</span><br><span class="line"></span><br><span class="line">#注意：如果有和DNS的IP相同的多个同名的A记录，优先返回DNS的本机IP</span><br></pre></td></tr></table></figure>

<p>范例：阿里云</p>
<p><img src="../../../../images/SRE/day16/6.png" alt="6"></p>
<h3 id="AAAA记录"><a href="#AAAA记录" class="headerlink" title="AAAA记录"></a>AAAA记录</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">name</span><span class="punctuation">: </span>FQDN</span><br><span class="line"><span class="attribute">value</span><span class="punctuation">: </span>IPv6</span><br></pre></td></tr></table></figure>

<h3 id="PTR记录"><a href="#PTR记录" class="headerlink" title="PTR记录"></a>PTR记录</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">name</span><span class="punctuation">: </span>IP，有特定格式，把IP地址反过来写，1.2.3.4，要写作4.3.2.1；而有特定后缀：in-addr.arpa.，所以完整写法为：4.3.2.1.in-addr.arpa.</span><br><span class="line"><span class="attribute">value</span><span class="punctuation">: </span>FQDN</span><br></pre></td></tr></table></figure>

<p>注意：网络地址及后缀可省略；主机地址依然需要反着写</p>
<p>例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4.3.2.1.in-addr.arpa. IN PTR www.wang.org.</span><br><span class="line"><span class="comment">#如1.2.3为网络地址，可简写成：</span></span><br><span class="line">4 IN PTR www.wang.org. </span><br></pre></td></tr></table></figure>

<h3 id="CNAME别名记录"><a href="#CNAME别名记录" class="headerlink" title="CNAME别名记录"></a>CNAME别名记录</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">name</span><span class="punctuation">: </span>别名的FQDN</span><br><span class="line"><span class="attribute">value</span><span class="punctuation">: </span>真正名字的FQDN</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">www.wang.org. IN CNAME   websrv.wang.org.</span><br></pre></td></tr></table></figure>

<h2 id="子域授权"><a href="#子域授权" class="headerlink" title="子域授权"></a>子域授权</h2><p>每个域的名称服务器，都是通过其上级名称服务器在解析库进行授权,类似根域授权tld </p>
<p>glue record：粘合记录，父域授权子域的记录 </p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.com.           IN NS ns1.com.</span><br><span class="line">.com.           IN   NS ns2.com.</span><br><span class="line">ns1.com.        IN A 2.2.2.1</span><br><span class="line">ns2.com.        IN A 2.2.2.2</span><br><span class="line"><span class="comment">#wang.org. 在.com的名称服务器上，解析库中添加资源记录</span></span><br><span class="line">wang.org.          IN NS ns1.wang.org.</span><br><span class="line">wang.org.          IN NS ns2.wang.org.</span><br><span class="line">wang.org.          IN NS ns3.wang.org.</span><br><span class="line">ns1.wang.org.      IN A 3.3.3.1</span><br><span class="line">ns2.wang.org.      IN A 3.3.3.2</span><br><span class="line">ns3.wang.org.      IN A 3.3.3.3</span><br></pre></td></tr></table></figure>

<h2 id="互联网域名"><a href="#互联网域名" class="headerlink" title="互联网域名"></a>互联网域名</h2><h3 id="域名注册"><a href="#域名注册" class="headerlink" title="域名注册"></a>域名注册</h3><p>代理商：万网, 新网, godaddy</p>
<h3 id="注册完成以后，想自己用专用服务来解析"><a href="#注册完成以后，想自己用专用服务来解析" class="headerlink" title="注册完成以后，想自己用专用服务来解析"></a>注册完成以后，想自己用专用服务来解析</h3><p>管理后台：把NS记录指向的服务器名称，和A记录指向的服务器地址</p>
<p><img src="../../../../images/SRE/day16/7.png" alt="7"></p>
<p><img src="../../../../images/SRE/day16/8.png" alt="8"></p>
<h2 id="whois"><a href="#whois" class="headerlink" title="whois"></a>whois</h2><p>范例: whois 查询域名信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#yum -y install whois</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#whois wang.org</span></span><br><span class="line">   Domain Name: wang.org</span><br><span class="line">   Registry Domain ID: 1683438754_DOMAIN_COM-VRSN</span><br><span class="line">   Registrar WHOIS Server: grs-whois.hichina.com</span><br><span class="line">   Registrar URL: http://www.net.cn</span><br><span class="line">   Updated Date: 2018-09-08T13:03:33Z</span><br><span class="line">   Creation Date: 2011-10-22T03:22:03Z</span><br><span class="line">   Registry Expiry Date: 2021-10-22T03:22:03Z</span><br><span class="line">   Registrar: Alibaba Cloud Computing (Beijing) Co., Ltd.</span><br><span class="line">   Registrar IANA ID: 420</span><br><span class="line">   Registrar Abuse Contact Email: DomainAbuse@service.aliyun.com</span><br><span class="line">   Registrar Abuse Contact Phone: +86.95187</span><br><span class="line">   Domain Status: ok https://icann.org/epp<span class="comment">#ok</span></span><br><span class="line">   Name Server: NS1.ALIDNS.COM</span><br><span class="line">   Name Server: NS2.ALIDNS.COM</span><br><span class="line">   DNSSEC: unsigned</span><br><span class="line">   URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/</span><br><span class="line">   ......</span><br></pre></td></tr></table></figure>

<p>可以从网站查询信息,查询链接</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.toolnb.com/domaininfo/wangxiaochun.com.html</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day16/9.png" alt="9"></p>
<h2 id="HttpDNS"><a href="#HttpDNS" class="headerlink" title="HttpDNS"></a>HttpDNS</h2><h3 id="HttpDNS-定义"><a href="#HttpDNS-定义" class="headerlink" title="HttpDNS 定义"></a>HttpDNS 定义</h3><p>HttpDNS是使用HTTP协议向DNS服务器的80端口进行请求，代替传统的DNS协议向DNS服务器的53端口进行请求。也就是使用Http协议去进行DNS解析请求，DNS服务器返回的解析结果（域名对应的服务器IP），直接向该IP发起对应的API服务请求，代替使用域名。</p>
<h3 id="HttpDNS工作原理"><a href="#HttpDNS工作原理" class="headerlink" title="HttpDNS工作原理"></a>HttpDNS工作原理</h3><p><img src="../../../../images/SRE/day16/10.png" alt="10"></p>
<p>HttpDNS的原理非常简单，主要有两步： </p>
<p>A、客户端直接访问HttpDNS接口，获取业务在域名配置管理系统上配置的访问延迟最优的IP。（基于容灾考虑，还是保留次选使用运营商LocalDNS解析域名的方式）</p>
<p>B、客户端向获取到的IP后就向直接往此IP发送业务协议请求。以Http请求为例，通过在header中指定host字段，向HttpDNS返回的IP发送标准的Http请求即可。</p>
<h3 id="HttpDNS优势"><a href="#HttpDNS优势" class="headerlink" title="HttpDNS优势"></a>HttpDNS优势</h3><p>从原理上来讲，HttpDNS只是将域名解析的协议由DNS协议换成了Http协议，并不复杂。但是这一微小的转换，却带来了很多的收益： </p>
<p>A、根治域名解析异常：由于绕过了运营商的LocalDNS，用户解析域名的请求通过Http协议直接透传到了HttpDNS服务器IP上，用户在客户端的域名解析请求将不会遭受到域名解析异常的困扰。 </p>
<p>B、调度精准：HttpDNS能直接获取到用户IP，通过结合IP地址库以及测速系统，可以保证将用户引导的访问最快的IDC节点上。 </p>
<p>C、实现成本低廉：接入HttpDNS的业务仅需要对客户端接入层做少量改造，无需用户手机进行root或越狱；而且由于Http协议请求构造非常简单，兼容各版本的移动操作系统更不成问题；另外HttpDNS的后端配置完全复用现有权威DNS配置，管理成本也非常低。总而言之，就是以最小的改造成本，解决了业务遭受域名解析异常的问题，并满足业务精确流量调度的需求。</p>
<p>D、扩展性强：HttpDNS提供可靠的域名解析服务，业务可将自有调度逻辑与HttpDNS返回结果结合，实现更精细化的流量调度。比如指定版本的客户端连接请求的IP地址，指定网络类型的用户连接指定的IP地址等。</p>
<h1 id="DNS软件-bind"><a href="#DNS软件-bind" class="headerlink" title="DNS软件 bind"></a>DNS软件 bind</h1><p>DNS服务器软件：bind，powerdns，dnsmasq，unbound，coredns</p>
<h2 id="BIND（Berkeley-Internet-Name-Domain）相关程序包"><a href="#BIND（Berkeley-Internet-Name-Domain）相关程序包" class="headerlink" title="BIND（Berkeley Internet Name Domain）相关程序包"></a>BIND（Berkeley Internet Name Domain）相关程序包</h2><p>yum list all bind* </p>
<ul>
<li>bind：服务器</li>
<li>bind-utils: 客户端</li>
<li>bind-libs：相关库,依赖关系自动安装</li>
<li>bind-chroot: 安全包，将dns相关文件放至 /var/named/chroot/</li>
</ul>
<p>范例：安装bind软件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># dnf -y install bind bind-utils</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]<span class="comment"># apt -y install bind9 bind9-utils bind9-host bind9-dnsutils</span></span><br></pre></td></tr></table></figure>

<p>范例: DNS客户端相关库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#ping www.baidu.com </span></span><br><span class="line">PING www.a.shifen.com (110.242.68.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from 110.242.68.4 (110.242.68.4): icmp_seq=1 ttl=128 time=10.9 ms</span><br><span class="line">64 bytes from 110.242.68.4 (110.242.68.4): icmp_seq=2 ttl=128 time=10.5 ms</span><br><span class="line">^C</span><br><span class="line">--- www.a.shifen.com ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 3ms</span><br><span class="line">rtt min/avg/max/mdev = 10.539/10.698/10.857/0.159 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#ldd `which ping` | grep libresolv.so</span></span><br><span class="line"> libresolv.so.2 =&gt; /lib64/libresolv.so.2 (0x00007f230739b000)</span><br><span class="line">[root@centos8 ~]<span class="comment">#ldd `which curl` |grep libresolv.so</span></span><br><span class="line"> libresolv.so.2 =&gt; /lib64/libresolv.so.2 (0x00007fe95048a000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="BIND包相关文件"><a href="#BIND包相关文件" class="headerlink" title="BIND包相关文件"></a>BIND包相关文件</h2><ul>
<li><p>BIND主程序：/usr/sbin/named</p>
</li>
<li><p>服务脚本和Unit名称：/etc/rc.d/init.d/named，/usr/lib/systemd/system/named.service</p>
</li>
<li><p>主配置文件：/etc/named.conf, /etc/named.rfc1912.zones, /etc/rndc.key</p>
</li>
<li><p>管理工具：/usr/sbin/rndc：remote name domain controller，默认与bind安装在同一主机，且只能通过127.0.0.1连接named进程，提供辅助性的管理功能；953/tcp</p>
</li>
<li><p>解析库文件：/var/named/ZONE_NAME.ZONE</p>
</li>
<li><p>注意：</p>
<p>​        (1) 一台物理服务器可同时为多个区域提供解析 </p>
<p>​        (2) 必须要有根区域文件；named.ca </p>
<p>​        (3) 应该有两个（如果包括ipv6的，应该更多）实现localhost和本地回环地址的解析库</p>
</li>
</ul>
<h2 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h2><ul>
<li><p>全局配置：options {}; </p>
</li>
<li><p>日志子系统配置：logging {}; </p>
</li>
<li><p>区域定义：本机能够为哪些zone进行解析，就要定义哪些zone zone</p>
<p>​         “ZONE_NAME” IN {}; </p>
</li>
</ul>
<p>注意： </p>
<ul>
<li>任何服务程序如果期望其能够通过网络被其它主机访问，至少应该监听在一个能与外部主机通信的IP地址上 </li>
<li>缓存名称服务器的配置：监听外部地址即可 </li>
<li>dnssec: 建议关闭dnssec，设为no</li>
</ul>
<h1 id="实现主DNS服务器"><a href="#实现主DNS服务器" class="headerlink" title="实现主DNS服务器"></a>实现主DNS服务器</h1><h2 id="主DNS服务器配置"><a href="#主DNS服务器配置" class="headerlink" title="主DNS服务器配置"></a>主DNS服务器配置</h2><ol>
<li>在主配置文件中定义区域</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/named.conf             </span><br><span class="line"><span class="comment">#注释掉下面两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;ZONE_NAME&quot;</span> IN &#123;</span><br><span class="line">   <span class="built_in">type</span> &#123;master|slave|hint|forward&#125;;</span><br><span class="line">   file <span class="string">&quot;ZONE_NAME.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>定义区域解析库文件</p>
<p>​        内容包括 :</p>
<pre><code>    - 宏定义
    - 资源记录  
</code></pre>
</li>
</ol>
<p>范例：区域数据库</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$TTL 86400</span><br><span class="line">$ORIGIN wang.org.</span><br><span class="line">@ IN SOA ns1.wang.org. admin.wang.org (</span><br><span class="line">  2015042201</span><br><span class="line">  1H</span><br><span class="line">  5M</span><br><span class="line">  7D</span><br><span class="line">  1D )</span><br><span class="line">  IN NS ns1</span><br><span class="line">  IN NS ns2</span><br><span class="line">  IN MX 10 mx1</span><br><span class="line">  IN MX 20 mx2</span><br><span class="line">  ns1 IN A 172.16.100.11</span><br><span class="line">  ns2 IN A 172.16.100.12</span><br><span class="line">  mx1 IN A 172.16.100.13</span><br><span class="line">  mx2 IN A 172.16.100.14</span><br><span class="line">  websrv IN A 172.16.100.11</span><br><span class="line">  websrv IN A 172.16.100.12</span><br><span class="line">  www IN CNAME websrv</span><br></pre></td></tr></table></figure>

<p>范例：抓包观察查询过程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># tcpdump -i eth0 udp port 53 -nn</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">11:37:38.458363 IP 10.0.0.7.42201 &gt; 10.0.0.8.53: 44928+ A? www.baidu.com. (31)</span><br><span class="line">11:37:38.458896 IP 10.0.0.7.54285 &gt; 10.0.0.8.53: 44928+ A? www.baidu.com. (31)</span><br><span class="line">11:37:38.460038 IP 10.0.0.7.42053 &gt; 10.0.0.8.53: 30536+ A? </span><br><span class="line">www.baidu.com.wangxiaochun.com. (48)</span><br><span class="line">11:37:38.460884 IP 10.0.0.7.37739 &gt; 10.0.0.8.53: 30536+ A? </span><br><span class="line">www.baidu.com.wangxiaochun.com. (48)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># telnet 10.0.0.8 53</span></span><br><span class="line">Trying 10.0.0.8...</span><br><span class="line">telnet: connect to address 10.0.0.8: Connection refused</span><br></pre></td></tr></table></figure>

<h2 id="主配置文件语法检查"><a href="#主配置文件语法检查" class="headerlink" title="主配置文件语法检查"></a>主配置文件语法检查</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">named-checkconf</span><br></pre></td></tr></table></figure>

<h2 id="解析库文件语法检查"><a href="#解析库文件语法检查" class="headerlink" title="解析库文件语法检查"></a>解析库文件语法检查</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">named-checkzone &quot;wang.org&quot; /var/named/wang.org.zone</span><br></pre></td></tr></table></figure>

<h2 id="配置生效"><a href="#配置生效" class="headerlink" title="配置生效"></a>配置生效</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#三种方式</span></span><br><span class="line"><span class="comment">#rndc reload </span></span><br><span class="line"><span class="comment">#systemctl reload named</span></span><br><span class="line"><span class="comment">#service named reload</span></span><br></pre></td></tr></table></figure>

<h2 id="DNS-测试和管理工具"><a href="#DNS-测试和管理工具" class="headerlink" title="DNS 测试和管理工具"></a>DNS 测试和管理工具</h2><h3 id="dig-命令"><a href="#dig-命令" class="headerlink" title="dig 命令"></a>dig 命令</h3><p>dig只用于测试dns系统，不会查询hosts文件进行解析</p>
<p>命令格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dig [-t type] name [@SERVER] [query options]</span><br><span class="line"></span><br><span class="line">query options：</span><br><span class="line">    +[no]trace：跟踪解析过程 : dig +trace wang.org</span><br><span class="line">    +[no]recurse：进行递归解析</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试反向解析</span></span><br><span class="line">dig -x IP = dig –t ptr reverseip.in-addr.arpa</span><br><span class="line"></span><br><span class="line"><span class="comment">#模拟区域传送</span></span><br><span class="line">dig -t axfr ZONE_NAME @SERVER</span><br><span class="line">dig -t axfr wang.org @10.10.10.11</span><br><span class="line">dig –t axfr 100.1.10.in-addr.arpa @172.16.1.1</span><br><span class="line">dig -t NS . @114.114.114.114</span><br><span class="line">dig -t NS . @a.root-servers.net</span><br></pre></td></tr></table></figure>

<h3 id="host命令"><a href="#host命令" class="headerlink" title="host命令"></a>host命令</h3><p>命令格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host [-t type] name [SERVER]</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">host -t NS wang.org 172.16.0.1</span><br><span class="line">host -t soa wang.org</span><br><span class="line">host -t mx wang.org</span><br><span class="line">host -t axfr wang.org</span><br><span class="line">host 1.2.3.4</span><br></pre></td></tr></table></figure>

<h3 id="nslookup命令"><a href="#nslookup命令" class="headerlink" title="nslookup命令"></a>nslookup命令</h3><p>nslookup 可以支持交互和非交互式两种方式执行</p>
<p>全令格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup [-option] [name | -] [server]</span><br></pre></td></tr></table></figure>

<p>交互式模式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nslookup&gt;</span><br><span class="line">server IP: 指明使用哪个DNS server进行查询</span><br><span class="line">set q=RR_TYPE: 指明查询的资源记录类型</span><br><span class="line"><span class="attribute">NAME</span><span class="punctuation">: </span>要查询的名称</span><br></pre></td></tr></table></figure>

<h3 id="rndc-命令"><a href="#rndc-命令" class="headerlink" title="rndc 命令"></a>rndc 命令</h3><p>利用rndc工具可以实现管理DNS功能</p>
<p>rndc 监听端口: 953/tcp </p>
<p>命令格式:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rndc COMMAND</span><br><span class="line"><span class="attribute">COMMAND</span>:</span><br><span class="line">   status: 查看状态</span><br><span class="line">   reload: 重载主配置文件和区域解析库文件</span><br><span class="line">   reload zonename: 重载区域解析库文件</span><br><span class="line">   retransfer zonename: 手动启动区域传送，而不管序列号是否增加</span><br><span class="line">   notify zonename: 重新对区域传送发通知</span><br><span class="line">   reconfig: 重载主配置文件</span><br><span class="line">   querylog: 开启或关闭查询日志文件/var/log/message</span><br><span class="line">   trace: 递增debug一个级别</span><br><span class="line">   trace LEVEL: 指定使用的级别</span><br><span class="line">   notrace：将调试级别设置为 0</span><br><span class="line">   flush：清空DNS服务器的所有缓存记录</span><br></pre></td></tr></table></figure>

<h2 id="实战案例：实现DNS正向主服务器"><a href="#实战案例：实现DNS正向主服务器" class="headerlink" title="实战案例：实现DNS正向主服务器"></a>实战案例：实现DNS正向主服务器</h2><h3 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搭建DNS正向主服务器，实现web服务器基于FQDN的访问</span><br></pre></td></tr></table></figure>

<h3 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">需要三台主机</span><br><span class="line">DNS服务端：10.0.0.8</span><br><span class="line">web服务器：10.0.0.7</span><br><span class="line">DNS客户端：10.0.0.6</span><br></pre></td></tr></table></figure>

<h3 id="前提准备"><a href="#前提准备" class="headerlink" title="前提准备"></a>前提准备</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关闭SELinux</span><br><span class="line">关闭防火墙</span><br><span class="line">时间同步</span><br></pre></td></tr></table></figure>

<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><h4 id="在DNS服务端安装bind"><a href="#在DNS服务端安装bind" class="headerlink" title="在DNS服务端安装bind"></a>在DNS服务端安装bind</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install bind bind-utils -y</span><br></pre></td></tr></table></figure>

<h4 id="修改bind-配置文件"><a href="#修改bind-配置文件" class="headerlink" title="修改bind 配置文件"></a>修改bind 配置文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/named.conf             </span><br><span class="line"><span class="comment">#注释掉下面两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones    </span><br><span class="line"><span class="comment">#加上下面内容</span></span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> IN &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file  <span class="string">&quot;wang.org.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="DNS区域数据库文件"><a href="#DNS区域数据库文件" class="headerlink" title="DNS区域数据库文件"></a>DNS区域数据库文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -p /var/named/named.localhost /var/named/wang.org.zone</span><br><span class="line"><span class="comment">#如果没有加-p选项，需要修改所有者或权限。chgrp named wang.org.zone</span></span><br><span class="line"></span><br><span class="line">vim /var/named/wang.org.zone </span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@ IN SOA master admin.wang.org. (</span><br><span class="line">                  2019042210 ; serial</span><br><span class="line">                  1D ; refresh</span><br><span class="line">                  1H ; retry</span><br><span class="line">                  1W ; expire</span><br><span class="line">                  3H ) ; minimum</span><br><span class="line">           NS   master</span><br><span class="line">master     A    10.0.0.8         </span><br><span class="line">www        A    10.0.0.7</span><br></pre></td></tr></table></figure>

<h4 id="检查配置文件和数据库文件格式，并启动服务"><a href="#检查配置文件和数据库文件格式，并启动服务" class="headerlink" title="检查配置文件和数据库文件格式，并启动服务"></a>检查配置文件和数据库文件格式，并启动服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">named-checkconf </span><br><span class="line">named-checkzone wang.org /var/named/wang.org.zone</span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br></pre></td></tr></table></figure>

<h4 id="实现WEB服务"><a href="#实现WEB服务" class="headerlink" title="实现WEB服务"></a>实现WEB服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装http服务</span></span><br><span class="line">yum -y install httpd     </span><br><span class="line"></span><br><span class="line"><span class="comment">#配置主页面</span></span><br><span class="line"><span class="built_in">echo</span> www.wang.org &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">systemctl start httpd</span><br></pre></td></tr></table></figure>

<h4 id="在客户端实现测试"><a href="#在客户端实现测试" class="headerlink" title="在客户端实现测试"></a>在客户端实现测试</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DNS1=10.0.0.8</span><br><span class="line"></span><br><span class="line"><span class="comment">#centos7 以上版执行现下面命令生效</span></span><br><span class="line">nmcli con reload</span><br><span class="line">nmcli con up eth0</span><br><span class="line"></span><br><span class="line"><span class="comment">#centos 6 执行下面命令生效</span></span><br><span class="line">service network restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#有以下记录，算是成功</span></span><br><span class="line"><span class="built_in">cat</span> /etc/resolv.conf                    </span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">nameserver 10.0.0.8</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试网页,能显示就是成功</span></span><br><span class="line">curl www.wang.org                  </span><br><span class="line">www.wang.org</span><br></pre></td></tr></table></figure>

<h2 id="允许动态更新"><a href="#允许动态更新" class="headerlink" title="允许动态更新"></a>允许动态更新</h2><p>动态更新：可以通过远程更新区域数据库的资源记录</p>
<p>实现动态更新，需要在指定的zone语句块中：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Allow-update &#123;any;&#125;;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 770 /var/named</span><br><span class="line">setsebool  -P named_write_master_zones on    <span class="comment">#开启SELinux才需要执行此步</span></span><br><span class="line"></span><br><span class="line">nsupdate</span><br><span class="line">&gt;server 127.0.0.1</span><br><span class="line">&gt;zone wang.org</span><br><span class="line">&gt;update add ftp.wang.org 88888 IN A 8.8.8.8</span><br><span class="line">&gt;send</span><br><span class="line">&gt;update delete www.wang.org A</span><br><span class="line">&gt;send </span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">dig ftp.wang.org @127.0.0.1</span><br><span class="line"><span class="built_in">ls</span> -l /var/named/wang.org.zone.jnl</span><br><span class="line"><span class="built_in">cat</span> /var/named/wang.org.zone</span><br></pre></td></tr></table></figure>

<h2 id="启用DNS客户端缓存功能"><a href="#启用DNS客户端缓存功能" class="headerlink" title="启用DNS客户端缓存功能"></a>启用DNS客户端缓存功能</h2><p>在高并发的服务器场景中,对DNS的服务器查询性能有较高的要求,如果在客户端启用DNS缓存功能,可以大幅减轻DNS服务器的压力,同时也能提高DNS客户端名称解析速度</p>
<h3 id="CentOS-启用DNS客户端缓存"><a href="#CentOS-启用DNS客户端缓存" class="headerlink" title="CentOS 启用DNS客户端缓存"></a>CentOS 启用DNS客户端缓存</h3><p>CentOS 默认没有启用DNS客户端缓存,安装nscd（Name Service Cache Daemon,名称服务缓存守护进程）包可以支持DNS缓存功能</p>
<p>减少DNS服务器压力,提高DNS查询速度</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#yum -y install nscd</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#systemctl enable --now nscd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看缓存统计信息</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#nscd -g</span></span><br><span class="line">nscd configuration:</span><br><span class="line">              0 server debug level</span><br><span class="line">         4m 25s server runtime</span><br><span class="line">              5 current number of threads</span><br><span class="line">             32 maximum number of threads</span><br><span class="line">              0 number of <span class="built_in">times</span> clients had to <span class="built_in">wait</span></span><br><span class="line">             no paranoia mode enabled</span><br><span class="line">           3600  restart internal</span><br><span class="line">              5 reload count</span><br><span class="line">passwd cache:</span><br><span class="line">            <span class="built_in">yes</span> cache is enabled</span><br><span class="line">            <span class="built_in">yes</span> cache is persistent</span><br><span class="line">            <span class="built_in">yes</span> cache is shared</span><br><span class="line">            211 suggested size</span><br><span class="line">         216064 total data pool size</span><br><span class="line">           1216 used data pool size</span><br><span class="line">            600 seconds time to live <span class="keyword">for</span> positive entries</span><br><span class="line">             20 seconds time to live <span class="keyword">for</span> negative entries</span><br><span class="line">              0 cache hits on positive entries</span><br><span class="line">              0 cache hits on negative entries</span><br><span class="line">              7 cache misses on positive entries</span><br><span class="line">              0 cache misses on negative entries</span><br><span class="line">              0% cache hit rate</span><br><span class="line">             14 current number of cached values</span><br><span class="line">             14 maximum number of cached values</span><br><span class="line">              0 maximum chain length searched</span><br><span class="line">              0 number of delays on rdlock</span><br><span class="line">              0 number of delays on wrlock</span><br><span class="line">              0 memory allocations failed</span><br><span class="line">            <span class="built_in">yes</span> check /etc/passwd <span class="keyword">for</span> changes</span><br><span class="line">group cache:</span><br><span class="line">            <span class="built_in">yes</span> cache is enabled</span><br><span class="line">            <span class="built_in">yes</span> cache is persistent</span><br><span class="line">            <span class="built_in">yes</span> cache is shared</span><br><span class="line">            211 suggested size</span><br><span class="line">         216064 total data pool size</span><br><span class="line">            128 used data pool size</span><br><span class="line">           3600 seconds time to live <span class="keyword">for</span> positive entries</span><br><span class="line">             60 seconds time to live <span class="keyword">for</span> negative entries</span><br><span class="line">              0 cache hits on positive entries</span><br><span class="line">              0 cache hits on negative entries</span><br><span class="line">              1 cache misses on positive entries</span><br><span class="line">              0 cache misses on negative entries</span><br><span class="line">              0% cache hit rate</span><br><span class="line">              2 current number of cached values</span><br><span class="line">              2 maximum number of cached values</span><br><span class="line">              0 maximum chain length searched</span><br><span class="line">              0 number of delays on rdlock</span><br><span class="line">              0 number of delays on wrlock</span><br><span class="line">              0 memory allocations failed</span><br><span class="line">            <span class="built_in">yes</span> check /etc/group <span class="keyword">for</span> changes</span><br><span class="line">hosts cache:</span><br><span class="line">            <span class="built_in">yes</span> cache is enabled</span><br><span class="line">            <span class="built_in">yes</span> cache is persistent</span><br><span class="line">            <span class="built_in">yes</span> cache is shared</span><br><span class="line">            211 suggested size</span><br><span class="line">         216064 total data pool size</span><br><span class="line">            248 used data pool size</span><br><span class="line">           3600 seconds time to live <span class="keyword">for</span> positive entries</span><br><span class="line">             20 seconds time to live <span class="keyword">for</span> negative entries</span><br><span class="line">              0 cache hits on positive entries</span><br><span class="line">              0 cache hits on negative entries</span><br><span class="line">              2 cache misses on positive entries</span><br><span class="line">              1 cache misses on negative entries</span><br><span class="line">              0% cache hit rate</span><br><span class="line">              2 current number of cached values</span><br><span class="line">              2 maximum number of cached values</span><br><span class="line">              0 maximum chain length searched</span><br><span class="line">              0 number of delays on rdlock</span><br><span class="line">              0 number of delays on wrlock</span><br><span class="line">              0 memory allocations failed</span><br><span class="line">            <span class="built_in">yes</span> check /etc/hosts <span class="keyword">for</span> changes</span><br><span class="line">services cache:</span><br><span class="line">            <span class="built_in">yes</span> cache is enabled</span><br><span class="line">            <span class="built_in">yes</span> cache is persistent</span><br><span class="line">            <span class="built_in">yes</span> cache is shared</span><br><span class="line">            211 suggested size</span><br><span class="line">         216064 total data pool size</span><br><span class="line">              0 used data pool size</span><br><span class="line">          28800 seconds time to live <span class="keyword">for</span> positive entries</span><br><span class="line">             20 seconds time to live <span class="keyword">for</span> negative entries</span><br><span class="line">              0 cache hits on positive entries</span><br><span class="line">              0 cache hits on negative entries</span><br><span class="line">              0 cache misses on positive entries</span><br><span class="line">              0 cache misses on negative entries</span><br><span class="line">              0% cache hit rate</span><br><span class="line">              0 current number of cached values</span><br><span class="line">              0 maximum number of cached values</span><br><span class="line">              0 maximum chain length searched</span><br><span class="line">              0 number of delays on rdlock</span><br><span class="line">              0 number of delays on wrlock</span><br><span class="line">              0 memory allocations failed</span><br><span class="line">            <span class="built_in">yes</span> check /etc/services <span class="keyword">for</span> changes</span><br><span class="line">netgroup cache:</span><br><span class="line">            <span class="built_in">yes</span> cache is enabled</span><br><span class="line">            <span class="built_in">yes</span> cache is persistent</span><br><span class="line">            <span class="built_in">yes</span> cache is shared</span><br><span class="line">            211 suggested size</span><br><span class="line">         216064 total data pool size</span><br><span class="line">              0 used data pool size</span><br><span class="line">          28800 seconds time to live <span class="keyword">for</span> positive entries</span><br><span class="line">             20 seconds time to live <span class="keyword">for</span> negative entries</span><br><span class="line">              0 cache hits on positive entries</span><br><span class="line">              0 cache hits on negative entries</span><br><span class="line">              0 cache misses on positive entries</span><br><span class="line">              0 cache misses on negative entries</span><br><span class="line">              0% cache hit rate</span><br><span class="line">              0 current number of cached values</span><br><span class="line">              0 maximum number of cached values</span><br><span class="line">              0 maximum chain length searched</span><br><span class="line">              0 number of delays on rdlock</span><br><span class="line">              0 number of delays on wrlock</span><br><span class="line">              0 memory allocations failed</span><br><span class="line">            <span class="built_in">yes</span> check /etc/netgroup <span class="keyword">for</span> changes</span><br><span class="line">            </span><br><span class="line"><span class="comment">#清除DNS客户端缓存</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#nscd -i hosts</span></span><br></pre></td></tr></table></figure>

<h3 id="Ubuntu-启用DNS客户端缓存"><a href="#Ubuntu-启用DNS客户端缓存" class="headerlink" title="Ubuntu 启用DNS客户端缓存"></a>Ubuntu 启用DNS客户端缓存</h3><p>ubuntu 默认会启用DNS客户端缓存</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment">#systemctl status systemd-resolved.service </span></span><br><span class="line">● systemd-resolved.service - Network Name Resolution</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/systemd-resolved.service; enabled; vendor </span><br><span class="line">preset: enabled)</span><br><span class="line">   Active: active (running) since Thu 2020-12-31 19:52:58 CST; 3h 6min ago</span><br><span class="line">     Docs: man:systemd-resolved.service(8)</span><br><span class="line">           https://www.freedesktop.org/wiki/Software/systemd/resolved</span><br><span class="line">           https://www.freedesktop.org/wiki/Software/systemd/writing-network-configuration-managers</span><br><span class="line">           https://www.freedesktop.org/wiki/Software/systemd/writing-resolver-clients</span><br><span class="line"> Main PID: 738 (systemd-resolve)</span><br><span class="line">   Status: <span class="string">&quot;Processing requests...&quot;</span></span><br><span class="line">   Tasks: 1 (<span class="built_in">limit</span>: 2290)</span><br><span class="line">   CGroup: /system.slice/systemd-resolved.service</span><br><span class="line">           └─738 /lib/systemd/systemd-resolved</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment">#systemd-resolve --help</span></span><br><span class="line">systemd-resolve [OPTIONS...] HOSTNAME|ADDRESS...</span><br><span class="line">systemd-resolve [OPTIONS...] --service [[NAME] TYPE] DOMAIN</span><br><span class="line">systemd-resolve [OPTIONS...] --openpgp EMAIL@DOMAIN...</span><br><span class="line">systemd-resolve [OPTIONS...] --statistics</span><br><span class="line">systemd-resolve [OPTIONS...] --reset-statistics</span><br><span class="line">Resolve domain names, IPv4 and IPv6 addresses, DNS records, and services.</span><br><span class="line">  -h --<span class="built_in">help</span>                 Show this <span class="built_in">help</span></span><br><span class="line">     --version             Show package version</span><br><span class="line">     --no-pager             Do not pipe output into a pager</span><br><span class="line">  -4                       Resolve IPv4 addresses</span><br><span class="line">  -6                       Resolve IPv6 addresses</span><br><span class="line">  -i --interface=INTERFACE Look on interface</span><br><span class="line">  -p --protocol=PROTO|<span class="built_in">help</span> Look via protocol</span><br><span class="line">  -t --<span class="built_in">type</span>=TYPE|<span class="built_in">help</span>       Query RR with DNS <span class="built_in">type</span></span><br><span class="line">  -c --class=CLASS|<span class="built_in">help</span>     Query RR with DNS class</span><br><span class="line">     --service             Resolve service (SRV)</span><br><span class="line">     --service-address=BOOL Resolve address <span class="keyword">for</span> services (default: <span class="built_in">yes</span>)</span><br><span class="line">     --service-txt=BOOL     Resolve TXT records <span class="keyword">for</span> services (default: <span class="built_in">yes</span>)</span><br><span class="line">     --openpgp             Query OpenPGP public key</span><br><span class="line">     --tlsa                 Query TLS public key</span><br><span class="line">     --cname=BOOL           Follow CNAME redirects (default: <span class="built_in">yes</span>)</span><br><span class="line">     --search=BOOL         Use search domains <span class="keyword">for</span> single-label names</span><br><span class="line">                                                             (default: <span class="built_in">yes</span>)</span><br><span class="line">     --raw[=payload|packet] Dump the answer as binary data</span><br><span class="line">     --legend=BOOL         Print headers and additional info (default: <span class="built_in">yes</span>)</span><br><span class="line">     --statistics           Show resolver statistics</span><br><span class="line">     --reset-statistics     Reset resolver statistics</span><br><span class="line">     --status               Show <span class="built_in">link</span> and server status</span><br><span class="line">     --flush-caches         Flush all <span class="built_in">local</span> DNS caches</span><br><span class="line">     --reset-server-features</span><br><span class="line">                           Forget learnt DNS server feature levels</span><br><span class="line">     --set-dns=SERVER       Set per-interface DNS server address</span><br><span class="line">     --set-domain=DOMAIN   Set per-interface search domain</span><br><span class="line">     --set-llmnr=MODE       Set per-interface LLMNR mode</span><br><span class="line">     --set-mdns=MODE       Set per-interface MulticastDNS mode</span><br><span class="line">     --set-dnssec=MODE     Set per-interface DNSSEC mode</span><br><span class="line">     --set-nta=DOMAIN       Set per-interface DNSSEC NTA</span><br><span class="line">     --revert               Revert per-interface configuration</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">[root@ubuntu1804 ~]<span class="comment">#systemd-resolve --statistics</span></span><br><span class="line">DNSSEC supported by current servers: no</span><br><span class="line">Transactions</span><br><span class="line">Current Transactions: 0</span><br><span class="line"> Total Transactions: 53</span><br><span class="line">Cache</span><br><span class="line"> Current Cache Size: 1</span><br><span class="line">         Cache Hits: 2</span><br><span class="line">       Cache Misses: 52</span><br><span class="line">DNSSEC Verdicts</span><br><span class="line">             Secure: 0</span><br><span class="line">           Insecure: 0</span><br><span class="line">               Bogus: 0</span><br><span class="line">       Indeterminate: 0</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line"><span class="comment">#清空缓存</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment">#systemd-resolve --flush-caches</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment">#systemd-resolve --statistics</span></span><br><span class="line">DNSSEC supported by current servers: no</span><br><span class="line">Transactions</span><br><span class="line">Current Transactions: 0</span><br><span class="line"> Total Transactions: 53</span><br><span class="line">Cache</span><br><span class="line"> Current Cache Size: 0</span><br><span class="line">         Cache Hits: 2</span><br><span class="line">       Cache Misses: 52</span><br><span class="line">DNSSEC Verdicts</span><br><span class="line">             Secure: 0</span><br><span class="line">           Insecure: 0</span><br><span class="line">               Bogus: 0</span><br><span class="line">       Indeterminate: 0</span><br></pre></td></tr></table></figure>

<h1 id="实现反向解析区域"><a href="#实现反向解析区域" class="headerlink" title="实现反向解析区域"></a>实现反向解析区域</h1><h2 id="反向解析配置"><a href="#反向解析配置" class="headerlink" title="反向解析配置"></a>反向解析配置</h2><p>反向区域：即将IP反向解析为FQDN</p>
<p>区域名称：网络地址反写.in-addr.arpa.</p>
<p>示例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.16.100. --&gt; 100.16.172.in-addr.arpa.</span><br></pre></td></tr></table></figure>

<p>(1) 定义区域</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zone &quot;ZONE_NAME&quot; IN &#123;</span><br><span class="line">  type &#123;master|slave|forward&#125;；</span><br><span class="line">  file &quot;网络地址.zone&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>(2) 定义区域解析库文件</p>
<p>注意：不需要A记录,以PTR记录为主</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 86400</span><br><span class="line"><span class="variable">$ORIGIN</span> 16.172.in-addr.arpa.</span><br><span class="line">@       IN SOA ns1.wang.org. admin.wang.org. (</span><br><span class="line">               2015042201</span><br><span class="line">               1H</span><br><span class="line">               5M</span><br><span class="line">               7D</span><br><span class="line">               1D )</span><br><span class="line"></span><br><span class="line">     IN NS ns1.wang.org.</span><br><span class="line"></span><br><span class="line">1.2 IN PTR www.wang.org.</span><br><span class="line">3.4 IN PTR mx1.wang.org.</span><br><span class="line"></span><br><span class="line"><span class="comment">#实现以下解析</span></span><br><span class="line">172.16.2.1 www.wang.org.</span><br><span class="line">172.16.4.3 mx1.wang.org.</span><br></pre></td></tr></table></figure>

<h2 id="实战案例-反向解析"><a href="#实战案例-反向解析" class="headerlink" title="实战案例: 反向解析"></a>实战案例: 反向解析</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#cat /etc/named.conf </span></span><br><span class="line">options &#123;</span><br><span class="line"> ......</span><br><span class="line"> listen-on port 53 &#123; localhost; &#125;;</span><br><span class="line"> ......</span><br><span class="line"> allow-query     &#123; any; &#125;;</span><br><span class="line"> ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#vim /etc/named.rfc1912.zones</span></span><br><span class="line">zone <span class="string">&quot;0.0.10.in-addr.arpa&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file <span class="string">&quot;10.0.0.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#cd /var/named</span></span><br><span class="line">[root@centos8 named]<span class="comment">#cp -p named.loopback 10.0.0.zone</span></span><br><span class="line">[root@centos8 named]<span class="comment">#cat 10.0.0.zone </span></span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@ IN SOA ns1.wang.org. admin.wang.org. (</span><br><span class="line">                  0 ; serial</span><br><span class="line">                 1D ; refresh</span><br><span class="line">                 1H ; retry</span><br><span class="line">                 1W ; expire</span><br><span class="line">               3H ) ; minimum</span><br><span class="line">               </span><br><span class="line">   NS   ns1.wang.org. <span class="comment">#NS记录必须以点结束，否则配置A记录才可以启动</span></span><br><span class="line"></span><br><span class="line">100   PTR www.wang.org.</span><br><span class="line">200   PTR app.wange.org.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos8 named]<span class="comment">#named-checkzone 0.0.10.in-addr.arpa 10.0.0.zone </span></span><br><span class="line">zone 0.0.10.in-addr.arpa/IN: loaded serial 0</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#dig -t ptr 100.0.0.10.in-addr.arpa. @10.0.0.8</span></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.13-RedHat-9.11.13-3.el8 &lt;&lt;&gt;&gt; -t ptr 100.0.0.10.in-addr.arpa. </span><br><span class="line">@10.0.0.8</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 46393</span></span><br><span class="line"><span class="string">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2</span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 4096</span></span><br><span class="line"><span class="string">; COOKIE: a9b985772abbae6d4bcd7aa55f1b8af3efe9c3e53640b037 (good)</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;100.0.0.10.in-addr.arpa. IN PTR</span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">100.0.0.10.in-addr.arpa. 86400 IN PTR www.wang.org.</span></span><br><span class="line"><span class="string">;; AUTHORITY SECTION:</span></span><br><span class="line"><span class="string">0.0.10.in-addr.arpa. 86400 IN NS ns1.wang.org.</span></span><br><span class="line"><span class="string">;; ADDITIONAL SECTION:</span></span><br><span class="line"><span class="string">ns1.wang.org. 86400 IN A 10.0.0.7</span></span><br><span class="line"><span class="string">;; Query time: 0 msec</span></span><br><span class="line"><span class="string">;; SERVER: 10.0.0.8#53(10.0.0.8)</span></span><br><span class="line"><span class="string">;; WHEN: Sat Jul 25 09:29:23 CST 2020</span></span><br><span class="line"><span class="string">;; MSG SIZE rcvd: 142</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@centos6 ~]#dig -x 10.0.0.100 @10.0.0.8</span></span><br><span class="line"><span class="string">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.68.rc1.el6 &lt;&lt;&gt;&gt; -x 10.0.0.100 @10.0.0.8</span></span><br><span class="line"><span class="string">;; global options: +cmd</span></span><br><span class="line"><span class="string">;; Got answer:</span></span><br><span class="line"><span class="string">;; -&gt;&gt;HEADER&lt;&lt;- opcode</span>: QUERY, status: NOERROR, <span class="built_in">id</span>: 37893</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;100.0.0.10.in-addr.arpa. IN PTR</span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">100.0.0.10.in-addr.arpa. 86400 IN PTR www.wang.org.</span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">0.0.10.in-addr.arpa. 86400 IN NS ns1.wang.org.</span><br><span class="line">;; ADDITIONAL SECTION:</span><br><span class="line">ns1.wang.org. 86400 IN A 10.0.0.7</span><br><span class="line">;; Query time: 1 msec</span><br><span class="line">;; SERVER: 10.0.0.8<span class="comment">#53(10.0.0.8)</span></span><br><span class="line">;; WHEN: Sat Jul 25 09:30:46 2020</span><br><span class="line">;; MSG SIZE rcvd: 103</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#host 10.0.0.100</span></span><br><span class="line">100.0.0.10.in-addr.arpa domain name pointer www.wang.org.</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#nslookup 10.0.0.200</span></span><br><span class="line">Server: 10.0.0.8</span><br><span class="line">Address: 10.0.0.8<span class="comment">#53</span></span><br><span class="line">200.0.0.10.in-addr.arpa name = app.wange.org.</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#nslookup </span></span><br><span class="line">&gt; 10.0.0.100</span><br><span class="line">Server: 10.0.0.8</span><br><span class="line">Address: 10.0.0.8<span class="comment">#53</span></span><br><span class="line">100.0.0.10.in-addr.arpa name = www.wang.org.</span><br><span class="line">&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\wang&gt;ping -a 10.0.0.100</span><br><span class="line">正在 Ping www.wang.org [10.0.0.100] 具有 32 字节的数据:</span><br><span class="line">请求超时。</span><br><span class="line">10.0.0.100 的 Ping 统计信息:</span><br><span class="line">   数据包: 已发送 = 1，已接收 = 0，丢失 = 1 (100% 丢失)，</span><br><span class="line">Control-C</span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line">C:\Users\wang&gt;ping -a 10.0.0.200</span><br><span class="line">正在 Ping app.wange.org [10.0.0.200] 具有 32 字节的数据:</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day16/11.png" alt="11"></p>
<h1 id="实现从服务器"><a href="#实现从服务器" class="headerlink" title="实现从服务器"></a>实现从服务器</h1><p>只有一台主DNS服务器，存在单点失败的问题，可以建立主DNS服务器的备份服务器，即从服务器来实现DNS服务的容错机制。从服务器可以自动和主服务器进行单向的数据同步，从而和主DNS服务器一样，也可以对外提供查询服务，但从服务器不提供数据更新服务。</p>
<h2 id="DNS从服务器"><a href="#DNS从服务器" class="headerlink" title="DNS从服务器"></a>DNS从服务器</h2><ol>
<li>应该为一台独立的名称服务器</li>
<li>主服务器的区域解析库文件中必须有一条NS记录指向从服务器</li>
<li>从服务器只需要定义区域，而无须提供解析库文件；解析库文件应该放置于/var/named/slaves/目录中</li>
<li>主服务器得允许从服务器作区域传送</li>
<li>主从服务器时间应该同步，可通过ntp进行</li>
<li>bind程序的版本应该保持一致；否则，应该从高，主低</li>
</ol>
<h2 id="定义从区域"><a href="#定义从区域" class="headerlink" title="定义从区域"></a>定义从区域</h2><p>格式:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">&quot;ZONE_NAME&quot;</span> IN &#123;</span><br><span class="line">   <span class="built_in">type</span> slave;</span><br><span class="line">   masters &#123; MASTER_IP; &#125;;</span><br><span class="line">   file <span class="string">&quot;slaves/ZONE_NAME.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="实战案例：实现DNS从服务器"><a href="#实战案例：实现DNS从服务器" class="headerlink" title="实战案例：实现DNS从服务器"></a>实战案例：实现DNS从服务器</h2><h3 id="实验目的-1"><a href="#实验目的-1" class="headerlink" title="实验目的"></a>实验目的</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搭建DNS主从服务器架构，实现DNS服务冗余</span><br></pre></td></tr></table></figure>

<h3 id="环境要求-1"><a href="#环境要求-1" class="headerlink" title="环境要求"></a>环境要求</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">需要四台主机</span><br><span class="line">DNS主服务器：10.0.0.8</span><br><span class="line">DNS从服务器:10.0.0.18</span><br><span class="line">web服务器：10.0.0.7</span><br><span class="line">DNS客户端：10.0.0.6</span><br></pre></td></tr></table></figure>

<h3 id="前提准备-1"><a href="#前提准备-1" class="headerlink" title="前提准备"></a>前提准备</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关闭SElinux</span><br><span class="line">关闭防火墙</span><br><span class="line">时间同步</span><br></pre></td></tr></table></figure>

<h3 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h3><h4 id="主DNS服务端配置-参看前面案例"><a href="#主DNS服务端配置-参看前面案例" class="headerlink" title="主DNS服务端配置(参看前面案例)"></a>主DNS服务端配置(参看前面案例)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span> -y</span><br><span class="line"></span><br><span class="line">vim /etc/named.conf</span><br><span class="line"><span class="comment">#注释掉下面两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">#只允许从服务器进行区域传输</span></span><br><span class="line">allow-transfer &#123; 从服务器IP;&#125;; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones    </span><br><span class="line"><span class="comment">#加上这段</span></span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file  <span class="string">&quot;wang.org.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -p /var/named/named.localhost /var/named/wang.org.zone</span><br><span class="line"><span class="comment">#如果没有-p，需要改权限。chgrp named wang.org.zone</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /var/named/wang.org.zone </span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@ IN SOA master admin.wang.org. (</span><br><span class="line">            1 ; serial</span><br><span class="line">           1D ; refresh</span><br><span class="line">           1H ; retry</span><br><span class="line">           1W ; expire</span><br><span class="line">         3H ) ; minimum</span><br><span class="line">         </span><br><span class="line">       NS master</span><br><span class="line">       NS slave</span><br><span class="line">       </span><br><span class="line">master     A    10.0.0.8</span><br><span class="line">slave       A    10.0.0.18</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br></pre></td></tr></table></figure>

<h4 id="从DNS服务器配置"><a href="#从DNS服务器配置" class="headerlink" title="从DNS服务器配置"></a>从DNS服务器配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span> -y</span><br><span class="line"></span><br><span class="line">vim /etc/named.conf</span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line"><span class="comment">#不允许其它主机进行区域传输</span></span><br><span class="line">   allow-transfer &#123; none;&#125;;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">vim /etc/named.rfc1912.zones</span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> slave;</span><br><span class="line">   masters &#123; 主服务器IP;&#125;;   </span><br><span class="line">   file <span class="string">&quot;slaves/wang.org.slave&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> /var/named/slaves/wang.org.slave <span class="comment">#查看区域数据库文件是否生成</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端测试主从DNS服务架构"><a href="#客户端测试主从DNS服务架构" class="headerlink" title="客户端测试主从DNS服务架构"></a>客户端测试主从DNS服务架构</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DNS1=主服务器</span><br><span class="line">DNS2=从服务器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#验证从DNS服务器是否可以查询</span></span><br><span class="line">dig www.wang.org </span><br><span class="line">curl www.wang.org</span><br><span class="line"></span><br><span class="line"><span class="comment">#在主服务器上停止DNS服务</span></span><br><span class="line">systemctl stop named</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#验证从DNS服务器仍然可以查询</span></span><br><span class="line">dig www.wang.org </span><br><span class="line">curl www.wang.org</span><br></pre></td></tr></table></figure>

<h1 id="实现子域"><a href="#实现子域" class="headerlink" title="实现子域"></a>实现子域</h1><h2 id="子域委派授权"><a href="#子域委派授权" class="headerlink" title="子域委派授权"></a>子域委派授权</h2><p>将子域委派给其它主机管理，实现分布式DNS数据库</p>
<p>正向解析区域子域方法</p>
<p>范例：定义两个子域区域</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shanghai.wang.org.         IN NS ns1.ops.wang.org.</span><br><span class="line">shanghai.wang.org.         IN NS ns2.ops.wang.org.</span><br><span class="line">shenzhen.wang.org.         IN NS ns1.shenzhen.wang.org.</span><br><span class="line">shenzhen.wang.org.         IN NS ns2.shenzhen.wang.org.</span><br><span class="line">ns1.shanghai.wang.org.     IN A 1.1.1.1</span><br><span class="line">ns2.shanghai.wang.org.     IN A 1.1.1.2</span><br><span class="line">ns1.shenzhen.wang.org.     IN A 1.1.1.3</span><br><span class="line">ns2.shenzhen.wang.org.     IN A 1.1.1.4</span><br></pre></td></tr></table></figure>

<h2 id="范例：实现DNS父域和子域服务"><a href="#范例：实现DNS父域和子域服务" class="headerlink" title="范例：实现DNS父域和子域服务"></a>范例：实现DNS父域和子域服务</h2><h3 id="实验目的-2"><a href="#实验目的-2" class="headerlink" title="实验目的"></a>实验目的</h3><p><img src="../../../../images/SRE/day16/12.png" alt="12"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搭建DNS父域和子域服务器</span><br></pre></td></tr></table></figure>

<h3 id="环境要求-2"><a href="#环境要求-2" class="headerlink" title="环境要求"></a>环境要求</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">需要五台主机</span><br><span class="line">DNS父域服务器：10.0.0.8</span><br><span class="line">DNS子域服务器：10.0.0.18</span><br><span class="line">父域的web服务器：10.0.0.7，www.wang.org</span><br><span class="line">子域的web服务器：10.0.0.17,www.shanghai.wang.org</span><br><span class="line">DNS客户端：10.0.0.6</span><br></pre></td></tr></table></figure>

<h3 id="前提准备-2"><a href="#前提准备-2" class="headerlink" title="前提准备"></a>前提准备</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关闭SElinux</span><br><span class="line">关闭防火墙</span><br><span class="line">时间同步</span><br></pre></td></tr></table></figure>

<h3 id="实现步骤-2"><a href="#实现步骤-2" class="headerlink" title="实现步骤"></a>实现步骤</h3><h4 id="在父域DNS服务器上实现主wang-org域的主DNS服务"><a href="#在父域DNS服务器上实现主wang-org域的主DNS服务" class="headerlink" title="在父域DNS服务器上实现主wang.org域的主DNS服务"></a>在父域DNS服务器上实现主wang.org域的主DNS服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span> -y</span><br><span class="line"></span><br><span class="line">vim /etc/named.conf</span><br><span class="line"><span class="comment">#注释掉下面两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">#只允许从服务器进行区域传输</span></span><br><span class="line">allow-transfer &#123; 从服务器IP;&#125;; </span><br><span class="line"></span><br><span class="line"><span class="comment">#建议关闭加密验证</span></span><br><span class="line">dnssec-enable no; </span><br><span class="line">dnssec-validation no;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones    </span><br><span class="line"><span class="comment">#加上这段</span></span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file  <span class="string">&quot;wang.org.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -p /var/named/named.localhost /var/named/wang.org.zone</span><br><span class="line"><span class="comment">#如果没有-p，需要改权限。chgrp named wang.org.zone</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /var/named/wang.org.zone </span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@ IN SOA master admin.wang.org. (</span><br><span class="line">                 1 ; serial</span><br><span class="line">                1D ; refresh</span><br><span class="line">                1H ; retry</span><br><span class="line">                1W ; expire</span><br><span class="line">              3H ) ; minimum</span><br><span class="line">              </span><br><span class="line">           NS   master</span><br><span class="line">shanghai   NS   shanghains</span><br><span class="line"></span><br><span class="line">master      A    10.0.0.8</span><br><span class="line">shanghains  A    10.0.0.18</span><br><span class="line"></span><br><span class="line">www         A    10.0.0.7             </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br></pre></td></tr></table></figure>

<h4 id="实现子域的DNS服务器"><a href="#实现子域的DNS服务器" class="headerlink" title="实现子域的DNS服务器"></a>实现子域的DNS服务器</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span> -y</span><br><span class="line"></span><br><span class="line">vim /etc/named.conf             </span><br><span class="line"><span class="comment">#注释掉下面两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line">allow-transfer &#123; none;&#125;; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones</span><br><span class="line">zone <span class="string">&quot;shanghai.wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file <span class="string">&quot;shanghai.wang.org.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -p /var/named/named.localhost /var/named/shanghai.wang.org.zone</span><br><span class="line"><span class="comment">#如果没有-p，需要改权限。chgrp named wang.org.zone</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /var/named/shanghai.wang.org.zone </span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA master admin.wang.org. (</span><br><span class="line">                    2019042214 ; serial</span><br><span class="line">                   1D ; refresh</span><br><span class="line">                   1H ; retry</span><br><span class="line">                   1W ; expire</span><br><span class="line">                   3H )   ; minimum</span><br><span class="line">           NS   master</span><br><span class="line">master     A    10.0.0.18</span><br><span class="line">www       A    10.0.0.17</span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br></pre></td></tr></table></figure>

<h4 id="在父域和子域的web服务器上安装httpd服务"><a href="#在父域和子域的web服务器上安装httpd服务" class="headerlink" title="在父域和子域的web服务器上安装httpd服务"></a>在父域和子域的web服务器上安装httpd服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#父域的web服务器利用上面案例（略）</span></span><br><span class="line"><span class="comment">#在子域的web服务器上安装http服务</span></span><br><span class="line">yum install httpd    </span><br><span class="line"></span><br><span class="line"><span class="comment">#配置主页面</span></span><br><span class="line"><span class="built_in">echo</span> www.shanghai.wang.org &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">systemctl start httpd</span><br></pre></td></tr></table></figure>

<h4 id="客户端测试"><a href="#客户端测试" class="headerlink" title="客户端测试"></a>客户端测试</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dig www.shanghai.wang.org</span><br><span class="line">www.shanghai.wang.org</span><br></pre></td></tr></table></figure>

<h1 id="实现-DNS-转发（缓存）服务器"><a href="#实现-DNS-转发（缓存）服务器" class="headerlink" title="实现 DNS 转发（缓存）服务器"></a>实现 DNS 转发（缓存）服务器</h1><h2 id="DNS转发"><a href="#DNS转发" class="headerlink" title="DNS转发"></a>DNS转发</h2><p>利用DNS转发，可以将用户的DNS请求，转发至指定的DNS服务，而非默认的根DNS服务器，并将指定服务器查询的返回结果进行缓存，提高效率。 </p>
<p>注意： </p>
<ol>
<li>被转发的服务器需要能够为请求者做递归，否则转发请求不予进行 </li>
<li>在/etc/named.conf的全局配置块中，关闭dnssec功能</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnssec-enable no;</span><br><span class="line">dnssec-validation no;</span><br></pre></td></tr></table></figure>

<h2 id="转发方式"><a href="#转发方式" class="headerlink" title="转发方式"></a>转发方式</h2><h3 id="全局转发"><a href="#全局转发" class="headerlink" title="全局转发"></a>全局转发</h3><p>对非本机所负责解析区域的请求，全转发给指定的服务器</p>
<p>在全局配置块中实现：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Options &#123;</span><br><span class="line">   forward first|only;</span><br><span class="line">   forwarders &#123; ip;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="特定区域转发"><a href="#特定区域转发" class="headerlink" title="特定区域转发"></a>特定区域转发</h3><p>仅转发对特定的区域的请求，比全局转发优先级高</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zone &quot;ZONE_NAME&quot; IN &#123;</span><br><span class="line">   type forward;</span><br><span class="line">   forward first|only;</span><br><span class="line">   forwarders &#123; ip;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>first：</strong>先转发至指定DNS服务器，如果无法解析查询请求，则本服务器再去根服务器查询</p>
<p><strong>only:</strong>  先转发至指定DNS服务器，如果无法解析查询请求，则本服务器将不再去根服务器查询</p>
<h1 id="实战案例：实现DNS-forward（缓存）服务器"><a href="#实战案例：实现DNS-forward（缓存）服务器" class="headerlink" title="实战案例：实现DNS forward（缓存）服务器"></a>实战案例：实现DNS forward（缓存）服务器</h1><h3 id="实验目的-3"><a href="#实验目的-3" class="headerlink" title="实验目的"></a>实验目的</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搭建DNS转发（缓存）服务器</span><br></pre></td></tr></table></figure>

<h3 id="环境要求-3"><a href="#环境要求-3" class="headerlink" title="环境要求"></a>环境要求</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">需要四台主机</span><br><span class="line">DNS只缓存服务器:  10.0.0.8</span><br><span class="line">DNS主服务器:     10.0.0.18</span><br><span class="line">web服务器:       10.0.0.7</span><br><span class="line">DNS客户端:       10.0.0.6</span><br></pre></td></tr></table></figure>

<h3 id="前提准备-3"><a href="#前提准备-3" class="headerlink" title="前提准备"></a>前提准备</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关闭SElinux</span><br><span class="line">关闭防火墙</span><br><span class="line">时间同步</span><br></pre></td></tr></table></figure>

<h3 id="实现步骤-3"><a href="#实现步骤-3" class="headerlink" title="实现步骤"></a>实现步骤</h3><h4 id="实现转发（只缓存）DNS服务器"><a href="#实现转发（只缓存）DNS服务器" class="headerlink" title="实现转发（只缓存）DNS服务器"></a>实现转发（只缓存）DNS服务器</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span> -y</span><br><span class="line"></span><br><span class="line">vim /etc/named.conf             </span><br><span class="line"><span class="comment">#注释掉两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line">forward first;</span><br><span class="line">forwarders &#123; 10.0.0.18;&#125;; </span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭dnsec功能</span></span><br><span class="line">dnssec-enable no;</span><br><span class="line">dnssec-validation no;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br></pre></td></tr></table></figure>

<h4 id="实现主DNS服务器-1"><a href="#实现主DNS服务器-1" class="headerlink" title="实现主DNS服务器"></a>实现主DNS服务器</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span> -y</span><br><span class="line"></span><br><span class="line">vim /etc/named.conf             </span><br><span class="line"><span class="comment">#注释掉两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones    </span><br><span class="line"><span class="comment">#加上下面这段</span></span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file  <span class="string">&quot;wang.org.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -p /var/named/named.localhost /var/named/wang.org.zone</span><br><span class="line"><span class="comment">#如果没有-p，需要改权限。chgrp named wang.org.zone</span></span><br><span class="line"></span><br><span class="line">vim /var/named/wang.org.zone</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA master admin.wang.org. (</span><br><span class="line">                    2019042214 ; serial</span><br><span class="line">                   1D ; refresh</span><br><span class="line">                   1H ; retry</span><br><span class="line">                   1W ; expire</span><br><span class="line">                   3H )   ; minimum</span><br><span class="line">           NS   master</span><br><span class="line">master     A    10.0.0.18</span><br><span class="line">websrv     A    10.0.0.7                          </span><br><span class="line">www       CNAME websrv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br></pre></td></tr></table></figure>

<h4 id="web服务器配置（参看前面案例，略）"><a href="#web服务器配置（参看前面案例，略）" class="headerlink" title="web服务器配置（参看前面案例，略）"></a>web服务器配置（参看前面案例，略）</h4><p><a href="#%E5%9C%A8%E7%88%B6%E5%9F%9F%E5%92%8C%E5%AD%90%E5%9F%9F%E7%9A%84web%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%89%E8%A3%85httpd%E6%9C%8D%E5%8A%A1">web服务配置</a></p>
<h4 id="在客户端测试"><a href="#在客户端测试" class="headerlink" title="在客户端测试"></a>在客户端测试</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#客户端配置（参看前面案例，略）</span><br><span class="line">dig www.wang.org    </span><br><span class="line">curl www.wang.org</span><br></pre></td></tr></table></figure>

<h1 id="实现智能-DNS"><a href="#实现智能-DNS" class="headerlink" title="实现智能 DNS"></a>实现智能 DNS</h1><p><img src="../../../../images/SRE/day16/13.png" alt="13"></p>
<h2 id="GSLB"><a href="#GSLB" class="headerlink" title="GSLB"></a>GSLB</h2><p>GSLB：Global Server Load Balance全局负载均衡</p>
<p>GSLB 是对服务器和链路进行综合判断来决定由哪个地点的服务器来提供服务，实现异地服务器群服务质量的保证</p>
<p>GSLB主要的目的是在整个网络范围内将用户的请求定向到最近的节点（或者区域）</p>
<p>GSLB分为基于DNS实现、基于重定向实现、基于路由协议实现，其中最通用的是基于DNS解析方式 </p>
<p>范例：在北京查询VIP使用网宿的CDN服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="comment">#dig www.vip.com</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.68.rc1.el6 &lt;&lt;&gt;&gt; www.vip.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 44153</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 5, ADDITIONAL: 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;www.vip.com. IN A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">www.vip.com. 180 IN CNAME www.vip.com.wscdns.com.#wscdn 网宿服务商</span></span><br><span class="line"><span class="string">www.vip.com.wscdns.com. 60 IN A 111.206.176.92</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; AUTHORITY SECTION:</span></span><br><span class="line"><span class="string">wscdns.com. 172800 IN NS dns2.wscdns.info.</span></span><br><span class="line"><span class="string">wscdns.com. 172800 IN NS dns3.wscdns.org.</span></span><br><span class="line"><span class="string">wscdns.com. 172800 IN NS dns4.wscdns.info.</span></span><br><span class="line"><span class="string">wscdns.com. 172800 IN NS dns5.cdn30.org.</span></span><br><span class="line"><span class="string">wscdns.com. 172800 IN NS dns1.wscdns.org.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 1290 msec</span></span><br><span class="line"><span class="string">;; SERVER: 10.0.0.18#53(10.0.0.18)</span></span><br><span class="line"><span class="string">;; WHEN: Wed Feb 12 18:05:17 2020</span></span><br><span class="line"><span class="string">;; MSG SIZE rcvd: 200</span></span><br></pre></td></tr></table></figure>

<p>范例: 在郑州查询VIP使用网宿的CDN服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#dig www.vip.com</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.13-RedHat-9.11.13-3.el8 &lt;&lt;&gt;&gt; www.vip.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 41846</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 5, ADDITIONAL: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 4096</span></span><br><span class="line"><span class="string">; COOKIE: c64336bd04f5165946e2a4115f5ec84d89fb312a09571ab0 (good)</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;www.vip.com. IN A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">www.vip.com. 121 IN CNAME www.vip.com.wscdns.com.</span></span><br><span class="line"><span class="string">www.vip.com.wscdns.com. 2 IN A 111.6.176.42</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; AUTHORITY SECTION:</span></span><br><span class="line"><span class="string">wscdns.com. 172742 IN NS dns5.cdn30.org.</span></span><br><span class="line"><span class="string">wscdns.com. 172742 IN NS dns3.wscdns.org.</span></span><br><span class="line"><span class="string">wscdns.com. 172742 IN NS dns2.wscdns.info.</span></span><br><span class="line"><span class="string">wscdns.com. 172742 IN NS dns1.wscdns.org.</span></span><br><span class="line"><span class="string">wscdns.com. 172742 IN NS dns4.wscdns.info.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 0 msec</span></span><br><span class="line"><span class="string">;; SERVER: 127.0.0.1#53(127.0.0.1)</span></span><br><span class="line"><span class="string">;; WHEN: Mon Sep 14 09:33:01 CST 2020</span></span><br><span class="line"><span class="string">;; MSG SIZE rcvd: 239</span></span><br></pre></td></tr></table></figure>

<h2 id="CDN-（Content-Delivery-Network）内容分发网络"><a href="#CDN-（Content-Delivery-Network）内容分发网络" class="headerlink" title="CDN （Content Delivery Network）内容分发网络"></a>CDN （Content Delivery Network）内容分发网络</h2><p><img src="../../../../images/SRE/day16/14.png" alt="14"></p>
<h3 id="CDN工作原理"><a href="#CDN工作原理" class="headerlink" title="CDN工作原理"></a>CDN工作原理</h3><ol>
<li>用户向浏览器输入<a target="_blank" rel="noopener" href="http://www.a.com这个域名,浏览器第一次发现本地没有dns缓存,则向网站的dns服务器请求/">www.a.com这个域名，浏览器第一次发现本地没有dns缓存，则向网站的DNS服务器请求</a></li>
<li>网站的DNS域名解析器设置了CNAME，指向了<a target="_blank" rel="noopener" href="http://www.a.tbcdn.com,请求指向了cdn网络中的智能dns负载均衡系统/">www.a.tbcdn.com,请求指向了CDN网络中的智能DNS负载均衡系统</a></li>
<li>智能DNS负载均衡系统解析域名，把对用户响应速度最快的IP节点返回给用户；</li>
<li>用户向该IP节点（CDN服务器）发出请求</li>
<li>由于是第一次访问，CDN服务器会通过Cache内部专用DNS解析得到此域名的原web站点IP，向原站点服务器发起请求，并在CDN服务器上缓存内容</li>
<li>请求结果发给用户 </li>
</ol>
<p>范例: CDN工作原理就近返回服务器地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="comment">#cat /etc/resolv.conf</span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">search localdomain</span><br><span class="line">nameserver 54.252.183.4 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#ping www.jd.com -c1</span></span><br><span class="line">PING jd-abroad.cdn20.com (163.171.197.13) 56(84) bytes of data.</span><br><span class="line">64 bytes from 163.171.197.13: icmp_seq=1 ttl=128 time=266 ms</span><br><span class="line">--- jd-abroad.cdn20.com ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 739ms</span><br><span class="line">rtt min/avg/max/mdev = 266.711/266.711/266.711/0.000 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#cat /etc/resolv.conf</span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">search localdomain</span><br><span class="line">nameserver 223.6.6.6</span><br><span class="line">nameserver 180.76.76.76</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]<span class="comment">#ping www.jd.com -c1</span></span><br><span class="line">PING img2x-v6-sched.jcloudedge.com (123.6.29.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from hn.kd.ny.adsl (123.6.29.3): icmp_seq=1 ttl=128 time=3.04 ms</span><br></pre></td></tr></table></figure>

<h3 id="CDN服务商"><a href="#CDN服务商" class="headerlink" title="CDN服务商"></a>CDN服务商</h3><ul>
<li>服务商：阿里，腾讯，蓝汛，网宿，帝联等 </li>
<li>智能DNS: dnspod dns.la</li>
</ul>
<p>范例: 浪潮使用网宿的CDN服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#dig www.inspur.com</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.13-RedHat-9.11.13-3.el8 &lt;&lt;&gt;&gt; www.inspur.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 24043</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;www.inspur.com.  IN A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">www.inspur.com. 43 IN CNAME www.inspur.com.wscdns.com.</span></span><br><span class="line"><span class="string">www.inspur.com.wscdns.com. 43 IN A 111.206.179.204</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 8 msec</span></span><br><span class="line"><span class="string">;; SERVER: 223.6.6.6#53(223.6.6.6)</span></span><br><span class="line"><span class="string">;; WHEN: Tue Jan 05 22:25:03 CST 2021</span></span><br><span class="line"><span class="string">;; MSG SIZE rcvd: 84</span></span><br></pre></td></tr></table></figure>

<p>范例: 工商银行使用网宿的CDN服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~<span class="comment"># dig www.icbc.com.cn</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; www.icbc.com.cn</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 14891</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 65494</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;www.icbc.com.cn. IN A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">www.icbc.com.cn. 15 IN CNAME www.icbc.com.cn.wscdns.com.</span></span><br><span class="line"><span class="string">www.icbc.com.cn.wscdns.com. 14 IN A 111.206.186.250</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 8 msec</span></span><br><span class="line"><span class="string">;; SERVER: 127.0.0.53#53(127.0.0.53)</span></span><br><span class="line"><span class="string">;; WHEN: Wed Jan 20 08:24:01 UTC 2021</span></span><br><span class="line"><span class="string">;; MSG SIZE rcvd: 100</span></span><br></pre></td></tr></table></figure>

<h3 id="CDN-案例"><a href="#CDN-案例" class="headerlink" title="CDN 案例"></a>CDN 案例</h3><h4 id="利用CDN访问"><a href="#利用CDN访问" class="headerlink" title="利用CDN访问"></a>利用CDN访问</h4><p>使用以下链接测试访问网站链接</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://tool.chinaz.com/speedtest</span><br></pre></td></tr></table></figure>

<p>观察到如下显示解析IP是一样的,并注意总耗时</p>
<p><img src="../../../../images/SRE/day16/15.png" alt="15"></p>
<h2 id="智能DNS相关技术"><a href="#智能DNS相关技术" class="headerlink" title="智能DNS相关技术"></a>智能DNS相关技术</h2><h3 id="bind中ACL"><a href="#bind中ACL" class="headerlink" title="bind中ACL"></a>bind中ACL</h3><p>ACL：把一个或多个地址归并为一个集合，并通过一个统一的名称调用</p>
<p>注意：只能先定义后使用；因此一般定义在配置文件中，处于options的前面 </p>
<p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acl acl_name &#123;</span><br><span class="line">    ip;</span><br><span class="line">    net/prelen;</span><br><span class="line">    ……</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acl beijingnet &#123;</span><br><span class="line">    172.16.0.0/16;</span><br><span class="line">    10.10.10.10;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="bind有四个内置的acl"><a href="#bind有四个内置的acl" class="headerlink" title="bind有四个内置的acl"></a>bind有四个内置的acl</h3><ul>
<li>none 没有一个主机 </li>
<li>any 任意主机 </li>
<li>localhost 本机 </li>
<li>localnet 本机的IP同掩码运算后得到的网络地址</li>
</ul>
<h3 id="访问控制的指令"><a href="#访问控制的指令" class="headerlink" title="访问控制的指令"></a>访问控制的指令</h3><ul>
<li>allow-query {}： 允许查询的主机；白名单 </li>
<li>allow-transfer {}：允许区域传送的主机；白名单 </li>
<li>allow-recursion {}: 允许递归的主机,建议全局使用 </li>
<li>allow-update {}: 允许更新区域数据库中的内容</li>
</ul>
<h3 id="view-视图"><a href="#view-视图" class="headerlink" title="view 视图"></a>view 视图</h3><h4 id="View：视图，将ACL和区域数据库实现对应关系，以实现智能DNS"><a href="#View：视图，将ACL和区域数据库实现对应关系，以实现智能DNS" class="headerlink" title="View：视图，将ACL和区域数据库实现对应关系，以实现智能DNS"></a>View：视图，将ACL和区域数据库实现对应关系，以实现智能DNS</h4><ul>
<li>一个bind服务器可定义多个view，每个view中可定义一个或多个zone</li>
<li>每个view用来匹配一组客户端 </li>
<li>多个view内可能需要对同一个区域进行解析，但使用不同的区域解析库文件</li>
</ul>
<p>注意：</p>
<ul>
<li>一旦启用了view，所有的zone都只能定义在view中 </li>
<li>仅在允许递归请求的客户端所在view中定义根区域 </li>
<li>客户端请求到达时，是自上而下检查每个view所服务的客户端列表</li>
</ul>
<h4 id="view-格式"><a href="#view-格式" class="headerlink" title="view 格式"></a>view 格式</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">view VIEW_NAME &#123;</span><br><span class="line">        match-clients &#123; beijingnet; &#125;;</span><br><span class="line">        zone &quot;wang.org&quot; &#123;</span><br><span class="line">            type master;</span><br><span class="line">            file &quot;wang.org.zone.bj&quot;; </span><br><span class="line">        &#125;;</span><br><span class="line">        include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">view VIEW_NAME &#123;</span><br><span class="line">        match-clients &#123; shanghainet; &#125;;</span><br><span class="line">        zone &quot;wang.org&quot; &#123; </span><br><span class="line">            type master;</span><br><span class="line">            file &quot;wang.org.zone.sh&quot;; </span><br><span class="line">        &#125;;</span><br><span class="line">        include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="实战案例：利用view实现智能DNS"><a href="#实战案例：利用view实现智能DNS" class="headerlink" title="实战案例：利用view实现智能DNS"></a>实战案例：利用view实现智能DNS</h2><h3 id="实验目的-4"><a href="#实验目的-4" class="headerlink" title="实验目的"></a>实验目的</h3><p>搭建DNS主从服务器架构，实现DNS服务冗余</p>
<h3 id="环境要求-4"><a href="#环境要求-4" class="headerlink" title="环境要求"></a>环境要求</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">需要五台主机</span><br><span class="line">DNS主服务器和web服务器1：10.0.0.8/24，172.16.0.8/16</span><br><span class="line">web服务器2：10.0.0.7/24</span><br><span class="line">web服务器3：172.16.0.7/16</span><br><span class="line">DNS客户端1：10.0.0.6/24 </span><br><span class="line">DNS客户端2：172.16.0.6/16</span><br></pre></td></tr></table></figure>

<h3 id="前提准备-4"><a href="#前提准备-4" class="headerlink" title="前提准备"></a>前提准备</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关闭SElinux</span><br><span class="line">关闭防火墙</span><br><span class="line">时间同步</span><br></pre></td></tr></table></figure>

<h3 id="实现步骤-4"><a href="#实现步骤-4" class="headerlink" title="实现步骤"></a>实现步骤</h3><h4 id="DNS-服务器的网卡配置"><a href="#DNS-服务器的网卡配置" class="headerlink" title="DNS 服务器的网卡配置"></a>DNS 服务器的网卡配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置两个IP地址</span></span><br><span class="line"><span class="comment">#eth0：10.0.0.8/24</span></span><br><span class="line"><span class="comment">#eth1: 172.16.0.8/16</span></span><br><span class="line">ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group </span><br><span class="line">default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">   inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">   inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group </span><br><span class="line">default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/ether 00:0c:29:f9:8d:90 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">   inet 10.0.0.8/24 brd 10.0.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">   inet6 fe80::20c:29ff:fef9:8d90/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group </span><br><span class="line">default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/ether 00:0c:29:f9:8d:11 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">   inet 172.16.0.8/16 brd 172.16.0.255 scope global noprefixroute eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">   inet6 fe80::20c:29ff:fe11:8d90/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h4 id="主DNS服务端配置文件实现-view"><a href="#主DNS服务端配置文件实现-view" class="headerlink" title="主DNS服务端配置文件实现 view"></a>主DNS服务端配置文件实现 view</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span> -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/named.conf</span><br><span class="line"><span class="comment">#在文件最前面加下面行</span></span><br><span class="line">acl beijingnet &#123;</span><br><span class="line">    10.0.0.0/24;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">acl shanghainet &#123;</span><br><span class="line">    172.16.0.0/16;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">acl othernet &#123;</span><br><span class="line">   any;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#注释掉下面两行</span></span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query     &#123; localhost; &#125;;</span><br><span class="line"><span class="comment">#其它略</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建view</span></span><br><span class="line">view beijingview &#123;</span><br><span class="line">   match-clients &#123; beijingnet;&#125;;</span><br><span class="line">   include <span class="string">&quot;/etc/named.rfc1912.zones.bj&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">view shanghaiview &#123;</span><br><span class="line">   match-clients &#123; shanghainet;&#125;;</span><br><span class="line">   include <span class="string">&quot;/etc/named.rfc1912.zones.sh&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">view otherview &#123;</span><br><span class="line">   match-clients &#123; othernet;&#125;;</span><br><span class="line">   include <span class="string">&quot;/etc/named.rfc1912.zones.other&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include <span class="string">&quot;/etc/named.root.key&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="实现区域配置文件"><a href="#实现区域配置文件" class="headerlink" title="实现区域配置文件"></a>实现区域配置文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/named.rfc1912.zones.bj</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;</span><br><span class="line">   <span class="built_in">type</span> hint;</span><br><span class="line">   file <span class="string">&quot;named.ca&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file <span class="string">&quot;wang.org.zone.bj&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones.sh</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;</span><br><span class="line">   <span class="built_in">type</span> hint;</span><br><span class="line">   file <span class="string">&quot;named.ca&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file <span class="string">&quot;wang.org.zone.sh&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones.other</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;</span><br><span class="line">   <span class="built_in">type</span> hint;</span><br><span class="line">   file <span class="string">&quot;named.ca&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;wang.org&quot;</span> &#123;</span><br><span class="line">   <span class="built_in">type</span> master;</span><br><span class="line">   file <span class="string">&quot;wang.org.zone.other&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">chgrp</span> named /etc/named.rfc1912.zones.bj</span><br><span class="line"><span class="built_in">chgrp</span> named /etc/named.rfc1912.zones.sh</span><br><span class="line"><span class="built_in">chgrp</span> named /etc/named.rfc1912.zones.other</span><br></pre></td></tr></table></figure>

<h4 id="创建区域数据库文件"><a href="#创建区域数据库文件" class="headerlink" title="创建区域数据库文件"></a>创建区域数据库文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">vim /var/named/wang.org.zone.bj</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA master admin.wang.org. (</span><br><span class="line">                    2019042214 ; serial</span><br><span class="line">                   1D ; refresh</span><br><span class="line">                   1H ; retry</span><br><span class="line">                   1W ; expire</span><br><span class="line">                   3H )   ; minimum</span><br><span class="line">           NS   master</span><br><span class="line">master     A    10.0.0.8</span><br><span class="line">websrv     A    10.0.0.7                          </span><br><span class="line">www       CNAME websrv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /var/named/wang.org.zone.sh</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA master admin.wang.org. (</span><br><span class="line">                    2019042214 ; serial</span><br><span class="line">                   1D ; refresh</span><br><span class="line">                   1H ; retry</span><br><span class="line">                   1W ; expire</span><br><span class="line">                   3H )   ; minimum</span><br><span class="line">           NS   master</span><br><span class="line">master     A    10.0.0.8</span><br><span class="line">websrv     A    172.16.0.7                          </span><br><span class="line">www       CNAME websrv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /var/named/wang.org.zone.other</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA master admin.wang.org. (</span><br><span class="line">                    2019042214 ; serial</span><br><span class="line">                   1D ; refresh</span><br><span class="line">                   1H ; retry</span><br><span class="line">                   1W ; expire</span><br><span class="line">                   3H )   ; minimum</span><br><span class="line">           NS   master</span><br><span class="line">master     A    10.0.0.8</span><br><span class="line">websrv     A    127.0.0.1                          </span><br><span class="line">www       CNAME websrv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">chgrp</span> named /var/named/wang.org.zone.bj</span><br><span class="line"><span class="built_in">chgrp</span> named /var/named/wang.org.zone.sh</span><br><span class="line"><span class="built_in">chgrp</span> named /var/named/wang.org.zone.other</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl start named          <span class="comment">#第一次启动服务</span></span><br><span class="line">rndc reload                    <span class="comment">#不是第一次启动服务</span></span><br></pre></td></tr></table></figure>

<h4 id="实现位于不同区域的三个WEB服务器"><a href="#实现位于不同区域的三个WEB服务器" class="headerlink" title="实现位于不同区域的三个WEB服务器"></a>实现位于不同区域的三个WEB服务器</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分别在三台主机上安装http服务</span></span><br><span class="line"><span class="comment">#在web服务器1：10.0.0.8/24实现</span></span><br><span class="line">yum install httpd                        </span><br><span class="line"><span class="built_in">echo</span> www.wang.org <span class="keyword">in</span> Other &gt; /var/www/html/index.html</span><br><span class="line">systemctl start httpd   </span><br><span class="line"></span><br><span class="line"><span class="comment">#在web服务器2：10.0.0.7/16</span></span><br><span class="line"><span class="built_in">echo</span> www.wang.org <span class="keyword">in</span> Beijing &gt; /var/www/html/index.html</span><br><span class="line">systemctl start httpd  </span><br><span class="line"></span><br><span class="line"><span class="comment">#在web服务器3：172.16.0.7/16</span></span><br><span class="line">yum install httpd                        </span><br><span class="line"><span class="built_in">echo</span> www.wang.org <span class="keyword">in</span> Shanghai &gt; /var/www/html/index.html</span><br><span class="line">systemctl start httpd </span><br></pre></td></tr></table></figure>

<h4 id="客户端测试-1"><a href="#客户端测试-1" class="headerlink" title="客户端测试"></a>客户端测试</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分别在三台主机上访问</span></span><br><span class="line"><span class="comment">#DNS客户端1：10.0.0.6/24 实现，确保DNS指向10.0.0.8</span></span><br><span class="line">curl www.wang.org</span><br><span class="line">www.wang.org <span class="keyword">in</span> Beijing</span><br><span class="line"></span><br><span class="line"><span class="comment">#DNS客户端2：172.16.0.6/16 实现，确保DNS指向172.16.0.8</span></span><br><span class="line">curl www.wang.org</span><br><span class="line">www.wang.org <span class="keyword">in</span> Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment">#DNS客户端3：10.0.0.8 实现，，确保DNS指向127.0.0.1</span></span><br><span class="line">curl www.wang.org</span><br><span class="line">www.wang.org <span class="keyword">in</span> Other</span><br></pre></td></tr></table></figure>

<h1 id="DNS排错"><a href="#DNS排错" class="headerlink" title="DNS排错"></a>DNS排错</h1><p>DNS 服务常见故障如下</p>
<ul>
<li><p>SERVFAIL：The nameserver encountered a problem while processing the query. </p>
<p>​        可使用dig +trace排错，可能是网络和防火墙导致 </p>
</li>
<li><p>NXDOMAIN：The queried name does not exist in the zone. </p>
<p>​        可能是CNAME对应的A记录不存在导致</p>
</li>
<li><p>REFUSED：The nameserver refused the client’s DNS request due to policy restrictions. </p>
<p>​        可能是DNS策略导致</p>
</li>
</ul>
<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dig A example.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-14.el7 &lt;&lt;&gt;&gt; A example.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 30523</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/12/06/SRE-%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9FDNS%E6%9C%8D%E5%8A%A1/">http://example.com/2024/12/06/SRE-域名系统DNS服务/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SRE/">SRE</a><a class="post-meta__tags" href="/tags/DNS/">DNS</a></div><div class="post_share"><div class="social-share" data-image="/../images/SRE/day16/15.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/12/04/SRE-%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" title="加密和安全"><img class="cover" src="/../images/SRE/day15/13.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">加密和安全</div></div></a></div><div class="next-post pull-right"><a href="/2024/12/06/XM-%E5%AE%9E%E7%8E%B0Internet%E7%9A%84DNS%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/" title="DNS服务架构"><img class="cover" src="/../images/SRE/day16/16.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">DNS服务架构</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2025/04/15/SRE-HAProxy/" title="高可用性集群HAProxy"><img class="cover" src="/../images/SRE/day47/1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-15</div><div class="title">高可用性集群HAProxy</div></div></a></div><div><a href="/2025/04/16/SRE-Keepalived/" title="高可用性集群Keepalived"><img class="cover" src="/../images/SRE/day48/1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-16</div><div class="title">高可用性集群Keepalived</div></div></a></div><div><a href="/2025/02/21/SRE-LVS/" title="企业级调度器LVS"><img class="cover" src="/../images/SRE/day27/3.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-21</div><div class="title">企业级调度器LVS</div></div></a></div><div><a href="/2024/04/24/SRE-Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%92%8C%E5%B8%AE%E5%8A%A9/" title="Linux基本操作和帮助"><img class="cover" src="/../images/TITLE/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="title">Linux基本操作和帮助</div></div></a></div><div><a href="/2024/08/27/SRE-Linux%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%92%8CIO%E9%87%8D%E5%AE%9A%E5%90%91/" title="Linux文件管理和IO重定向"><img class="cover" src="/../images/TITLE/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="title">Linux文件管理和IO重定向</div></div></a></div><div><a href="/2024/12/08/SRE-Linux%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img class="cover" src="/../images/SRE/day17/12.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="title">Linux防火墙</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/TITLE/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">102</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8D%E5%AD%97%E8%A7%A3%E6%9E%90%E4%BB%8B%E7%BB%8D%E5%92%8CDNS"><span class="toc-number">1.</span> <span class="toc-text">名字解析介绍和DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E6%9C%8D%E5%8A%A1%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">DNS服务工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E6%9F%A5%E8%AF%A2%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">DNS查询类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8D%E7%A7%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">名称服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">解析类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82%E7%BB%8F%E8%BF%87%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">完整的查询请求经过的流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DNS-%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%92%8C%E6%8A%80%E6%9C%AF"><span class="toc-number">2.</span> <span class="toc-text">DNS 服务相关概念和技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">DNS服务器的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BBDNS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.1.1.</span> <span class="toc-text">主DNS服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">从DNS服务器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E4%BC%A0%E8%BE%93"><span class="toc-number">2.2.</span> <span class="toc-text">区域传输</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%BD%A2%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">解析形式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%9F%E8%B4%A3%E6%9C%AC%E5%9C%B0%E5%9F%9F%E5%90%8D%E7%9A%84%E6%AD%A3%E5%90%91%E5%92%8C%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90%E5%BA%93"><span class="toc-number">2.4.</span> <span class="toc-text">负责本地域名的正向和反向解析库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E7%AD%94%E6%A1%88"><span class="toc-number">2.5.</span> <span class="toc-text">解析答案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E8%B5%84%E6%BA%90%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.</span> <span class="toc-text">各种资源记录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E8%AE%B0%E5%BD%95%E5%AE%9A%E4%B9%89%E7%9A%84"><span class="toc-number">2.6.1.</span> <span class="toc-text">资源记录定义的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SOA%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.2.</span> <span class="toc-text">SOA记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NS%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.3.</span> <span class="toc-text">NS记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MX%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.4.</span> <span class="toc-text">MX记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.5.</span> <span class="toc-text">A记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AAAA%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.6.</span> <span class="toc-text">AAAA记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PTR%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.7.</span> <span class="toc-text">PTR记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CNAME%E5%88%AB%E5%90%8D%E8%AE%B0%E5%BD%95"><span class="toc-number">2.6.8.</span> <span class="toc-text">CNAME别名记录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83"><span class="toc-number">2.7.</span> <span class="toc-text">子域授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%92%E8%81%94%E7%BD%91%E5%9F%9F%E5%90%8D"><span class="toc-number">2.8.</span> <span class="toc-text">互联网域名</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E6%B3%A8%E5%86%8C"><span class="toc-number">2.8.1.</span> <span class="toc-text">域名注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%AE%8C%E6%88%90%E4%BB%A5%E5%90%8E%EF%BC%8C%E6%83%B3%E8%87%AA%E5%B7%B1%E7%94%A8%E4%B8%93%E7%94%A8%E6%9C%8D%E5%8A%A1%E6%9D%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">2.8.2.</span> <span class="toc-text">注册完成以后，想自己用专用服务来解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#whois"><span class="toc-number">2.9.</span> <span class="toc-text">whois</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpDNS"><span class="toc-number">2.10.</span> <span class="toc-text">HttpDNS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpDNS-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.10.1.</span> <span class="toc-text">HttpDNS 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpDNS%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.10.2.</span> <span class="toc-text">HttpDNS工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpDNS%E4%BC%98%E5%8A%BF"><span class="toc-number">2.10.3.</span> <span class="toc-text">HttpDNS优势</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DNS%E8%BD%AF%E4%BB%B6-bind"><span class="toc-number">3.</span> <span class="toc-text">DNS软件 bind</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BIND%EF%BC%88Berkeley-Internet-Name-Domain%EF%BC%89%E7%9B%B8%E5%85%B3%E7%A8%8B%E5%BA%8F%E5%8C%85"><span class="toc-number">3.1.</span> <span class="toc-text">BIND（Berkeley Internet Name Domain）相关程序包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BIND%E5%8C%85%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">BIND包相关文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">主配置文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%BBDNS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">实现主DNS服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BBDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">主DNS服务器配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5"><span class="toc-number">4.2.</span> <span class="toc-text">主配置文件语法检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%BA%93%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5"><span class="toc-number">4.3.</span> <span class="toc-text">解析库文件语法检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%94%9F%E6%95%88"><span class="toc-number">4.4.</span> <span class="toc-text">配置生效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS-%E6%B5%8B%E8%AF%95%E5%92%8C%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">4.5.</span> <span class="toc-text">DNS 测试和管理工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dig-%E5%91%BD%E4%BB%A4"><span class="toc-number">4.5.1.</span> <span class="toc-text">dig 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#host%E5%91%BD%E4%BB%A4"><span class="toc-number">4.5.2.</span> <span class="toc-text">host命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nslookup%E5%91%BD%E4%BB%A4"><span class="toc-number">4.5.3.</span> <span class="toc-text">nslookup命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rndc-%E5%91%BD%E4%BB%A4"><span class="toc-number">4.5.4.</span> <span class="toc-text">rndc 命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%AE%9E%E7%8E%B0DNS%E6%AD%A3%E5%90%91%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">4.6.</span> <span class="toc-text">实战案例：实现DNS正向主服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84"><span class="toc-number">4.6.1.</span> <span class="toc-text">实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82"><span class="toc-number">4.6.2.</span> <span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E5%87%86%E5%A4%87"><span class="toc-number">4.6.3.</span> <span class="toc-text">前提准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.6.4.</span> <span class="toc-text">实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8DNS%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85bind"><span class="toc-number">4.6.4.1.</span> <span class="toc-text">在DNS服务端安装bind</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9bind-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.6.4.2.</span> <span class="toc-text">修改bind 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">4.6.4.3.</span> <span class="toc-text">DNS区域数据库文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%EF%BC%8C%E5%B9%B6%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.6.4.4.</span> <span class="toc-text">检查配置文件和数据库文件格式，并启动服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0WEB%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.6.4.5.</span> <span class="toc-text">实现WEB服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%B5%8B%E8%AF%95"><span class="toc-number">4.6.4.6.</span> <span class="toc-text">在客户端实现测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%81%E8%AE%B8%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0"><span class="toc-number">4.7.</span> <span class="toc-text">允许动态更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E7%94%A8DNS%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98%E5%8A%9F%E8%83%BD"><span class="toc-number">4.8.</span> <span class="toc-text">启用DNS客户端缓存功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-%E5%90%AF%E7%94%A8DNS%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98"><span class="toc-number">4.8.1.</span> <span class="toc-text">CentOS 启用DNS客户端缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-%E5%90%AF%E7%94%A8DNS%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98"><span class="toc-number">4.8.2.</span> <span class="toc-text">Ubuntu 启用DNS客户端缓存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90%E5%8C%BA%E5%9F%9F"><span class="toc-number">5.</span> <span class="toc-text">实现反向解析区域</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">反向解析配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">实战案例: 反向解析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">实现从服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">6.1.</span> <span class="toc-text">DNS从服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%BB%8E%E5%8C%BA%E5%9F%9F"><span class="toc-number">6.2.</span> <span class="toc-text">定义从区域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%AE%9E%E7%8E%B0DNS%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">6.3.</span> <span class="toc-text">实战案例：实现DNS从服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84-1"><span class="toc-number">6.3.1.</span> <span class="toc-text">实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82-1"><span class="toc-number">6.3.2.</span> <span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E5%87%86%E5%A4%87-1"><span class="toc-number">6.3.3.</span> <span class="toc-text">前提准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-1"><span class="toc-number">6.3.4.</span> <span class="toc-text">实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BBDNS%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE-%E5%8F%82%E7%9C%8B%E5%89%8D%E9%9D%A2%E6%A1%88%E4%BE%8B"><span class="toc-number">6.3.4.1.</span> <span class="toc-text">主DNS服务端配置(参看前面案例)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">6.3.4.2.</span> <span class="toc-text">从DNS服务器配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">6.3.4.3.</span> <span class="toc-text">客户端测试主从DNS服务架构</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%AD%90%E5%9F%9F"><span class="toc-number">7.</span> <span class="toc-text">实现子域</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%A7%94%E6%B4%BE%E6%8E%88%E6%9D%83"><span class="toc-number">7.1.</span> <span class="toc-text">子域委派授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B%EF%BC%9A%E5%AE%9E%E7%8E%B0DNS%E7%88%B6%E5%9F%9F%E5%92%8C%E5%AD%90%E5%9F%9F%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.2.</span> <span class="toc-text">范例：实现DNS父域和子域服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84-2"><span class="toc-number">7.2.1.</span> <span class="toc-text">实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82-2"><span class="toc-number">7.2.2.</span> <span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E5%87%86%E5%A4%87-2"><span class="toc-number">7.2.3.</span> <span class="toc-text">前提准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-2"><span class="toc-number">7.2.4.</span> <span class="toc-text">实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E7%88%B6%E5%9F%9FDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%9E%E7%8E%B0%E4%B8%BBwang-org%E5%9F%9F%E7%9A%84%E4%B8%BBDNS%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.2.4.1.</span> <span class="toc-text">在父域DNS服务器上实现主wang.org域的主DNS服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%AD%90%E5%9F%9F%E7%9A%84DNS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">7.2.4.2.</span> <span class="toc-text">实现子域的DNS服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E7%88%B6%E5%9F%9F%E5%92%8C%E5%AD%90%E5%9F%9F%E7%9A%84web%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%89%E8%A3%85httpd%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.2.4.3.</span> <span class="toc-text">在父域和子域的web服务器上安装httpd服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">7.2.4.4.</span> <span class="toc-text">客户端测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-DNS-%E8%BD%AC%E5%8F%91%EF%BC%88%E7%BC%93%E5%AD%98%EF%BC%89%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">8.</span> <span class="toc-text">实现 DNS 转发（缓存）服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E8%BD%AC%E5%8F%91"><span class="toc-number">8.1.</span> <span class="toc-text">DNS转发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">8.2.</span> <span class="toc-text">转发方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%BD%AC%E5%8F%91"><span class="toc-number">8.2.1.</span> <span class="toc-text">全局转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%AE%9A%E5%8C%BA%E5%9F%9F%E8%BD%AC%E5%8F%91"><span class="toc-number">8.2.2.</span> <span class="toc-text">特定区域转发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%AE%9E%E7%8E%B0DNS-forward%EF%BC%88%E7%BC%93%E5%AD%98%EF%BC%89%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">9.</span> <span class="toc-text">实战案例：实现DNS forward（缓存）服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84-3"><span class="toc-number">9.0.1.</span> <span class="toc-text">实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82-3"><span class="toc-number">9.0.2.</span> <span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E5%87%86%E5%A4%87-3"><span class="toc-number">9.0.3.</span> <span class="toc-text">前提准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-3"><span class="toc-number">9.0.4.</span> <span class="toc-text">实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%BD%AC%E5%8F%91%EF%BC%88%E5%8F%AA%E7%BC%93%E5%AD%98%EF%BC%89DNS%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">9.0.4.1.</span> <span class="toc-text">实现转发（只缓存）DNS服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%BBDNS%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="toc-number">9.0.4.2.</span> <span class="toc-text">实现主DNS服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%EF%BC%88%E5%8F%82%E7%9C%8B%E5%89%8D%E9%9D%A2%E6%A1%88%E4%BE%8B%EF%BC%8C%E7%95%A5%EF%BC%89"><span class="toc-number">9.0.4.3.</span> <span class="toc-text">web服务器配置（参看前面案例，略）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">9.0.4.4.</span> <span class="toc-text">在客户端测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BD-DNS"><span class="toc-number">10.</span> <span class="toc-text">实现智能 DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GSLB"><span class="toc-number">10.1.</span> <span class="toc-text">GSLB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CDN-%EF%BC%88Content-Delivery-Network%EF%BC%89%E5%86%85%E5%AE%B9%E5%88%86%E5%8F%91%E7%BD%91%E7%BB%9C"><span class="toc-number">10.2.</span> <span class="toc-text">CDN （Content Delivery Network）内容分发网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CDN%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">10.2.1.</span> <span class="toc-text">CDN工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDN%E6%9C%8D%E5%8A%A1%E5%95%86"><span class="toc-number">10.2.2.</span> <span class="toc-text">CDN服务商</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDN-%E6%A1%88%E4%BE%8B"><span class="toc-number">10.2.3.</span> <span class="toc-text">CDN 案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8CDN%E8%AE%BF%E9%97%AE"><span class="toc-number">10.2.3.1.</span> <span class="toc-text">利用CDN访问</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%BA%E8%83%BDDNS%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF"><span class="toc-number">10.3.</span> <span class="toc-text">智能DNS相关技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bind%E4%B8%ADACL"><span class="toc-number">10.3.1.</span> <span class="toc-text">bind中ACL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bind%E6%9C%89%E5%9B%9B%E4%B8%AA%E5%86%85%E7%BD%AE%E7%9A%84acl"><span class="toc-number">10.3.2.</span> <span class="toc-text">bind有四个内置的acl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">10.3.3.</span> <span class="toc-text">访问控制的指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#view-%E8%A7%86%E5%9B%BE"><span class="toc-number">10.3.4.</span> <span class="toc-text">view 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#View%EF%BC%9A%E8%A7%86%E5%9B%BE%EF%BC%8C%E5%B0%86ACL%E5%92%8C%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB%EF%BC%8C%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BDDNS"><span class="toc-number">10.3.4.1.</span> <span class="toc-text">View：视图，将ACL和区域数据库实现对应关系，以实现智能DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#view-%E6%A0%BC%E5%BC%8F"><span class="toc-number">10.3.4.2.</span> <span class="toc-text">view 格式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%88%A9%E7%94%A8view%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BDDNS"><span class="toc-number">10.4.</span> <span class="toc-text">实战案例：利用view实现智能DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84-4"><span class="toc-number">10.4.1.</span> <span class="toc-text">实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82-4"><span class="toc-number">10.4.2.</span> <span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E5%87%86%E5%A4%87-4"><span class="toc-number">10.4.3.</span> <span class="toc-text">前提准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-4"><span class="toc-number">10.4.4.</span> <span class="toc-text">实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">10.4.4.1.</span> <span class="toc-text">DNS 服务器的网卡配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BBDNS%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0-view"><span class="toc-number">10.4.4.2.</span> <span class="toc-text">主DNS服务端配置文件实现 view</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8C%BA%E5%9F%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">10.4.4.3.</span> <span class="toc-text">实现区域配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">10.4.4.4.</span> <span class="toc-text">创建区域数据库文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%BD%8D%E4%BA%8E%E4%B8%8D%E5%90%8C%E5%8C%BA%E5%9F%9F%E7%9A%84%E4%B8%89%E4%B8%AAWEB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">10.4.4.5.</span> <span class="toc-text">实现位于不同区域的三个WEB服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95-1"><span class="toc-number">10.4.4.6.</span> <span class="toc-text">客户端测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DNS%E6%8E%92%E9%94%99"><span class="toc-number">11.</span> <span class="toc-text">DNS排错</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2"><img src="/../images/SRE/day46/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S 1.29.2"/></a><div class="content"><a class="title" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2">K8S 1.29.2</a><time datetime="2025-07-30T07:17:21.000Z" title="发表于 2025-07-30 15:17:21">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins"><img src="/../images/SRE/day55/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DevOps之CICD工具Jenkins"/></a><div class="content"><a class="title" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins">DevOps之CICD工具Jenkins</a><time datetime="2025-05-09T09:30:43.000Z" title="发表于 2025-05-09 17:30:43">2025-05-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/24/SRE-git/" title="版本管理系统Git和GitLab"><img src="/../images/SRE/day53/77.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="版本管理系统Git和GitLab"/></a><div class="content"><a class="title" href="/2025/04/24/SRE-git/" title="版本管理系统Git和GitLab">版本管理系统Git和GitLab</a><time datetime="2025-04-24T01:21:27.000Z" title="发表于 2025-04-24 09:21:27">2025-04-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/21/SRE-kafka/" title="消息队列和微服务"><img src="/../images/SRE/day52/30.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="消息队列和微服务"/></a><div class="content"><a class="title" href="/2025/04/21/SRE-kafka/" title="消息队列和微服务">消息队列和微服务</a><time datetime="2025-04-21T15:34:02.000Z" title="发表于 2025-04-21 23:34:02">2025-04-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="../images/BEIAN/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="../images/BEIAN/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>