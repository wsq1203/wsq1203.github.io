<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>网络协议和通信 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="老马 2023 SRE">
<meta property="og:type" content="article">
<meta property="og:title" content="网络协议和通信">
<meta property="og:url" content="http://example.com/2024/11/26/SRE-%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%80%9A%E4%BF%A1/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="老马 2023 SRE">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/image/SRE/day10/48.png">
<meta property="article:published_time" content="2024-11-25T16:00:00.000Z">
<meta property="article:modified_time" content="2024-11-26T00:25:35.496Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="SRE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/image/SRE/day10/48.png"><link rel="shortcut icon" href="/../images/title/user.webp"><link rel="canonical" href="http://example.com/2024/11/26/SRE-%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%80%9A%E4%BF%A1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '网络协议和通信',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2024-11-26 08:25:35'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/title/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">77</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/image/SRE/day10/48.png')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">网络协议和通信</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-25T16:00:00.000Z" title="发表于 2024-11-26 00:00:00">2024-11-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-26T00:25:35.496Z" title="更新于 2024-11-26 08:25:35">2024-11-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9D%E5%89%91%E9%94%8B%E4%BB%8E%E7%A3%A8%E7%A0%BA%E5%87%BA/">宝剑锋从磨砺出</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>67分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="网络协议和通信"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="网络基础"><a href="#网络基础" class="headerlink" title="网络基础"></a>网络基础</h1><h2 id="网络概念"><a href="#网络概念" class="headerlink" title="网络概念"></a>网络概念</h2><p>计算机网络是一组计算机或网络设备通过有形的线缆或无形的媒介如无线，连接起来，按照一定的规则，进行通信的集合。</p>
<p><img src="../../../../images/image/SRE/day10/1.png" alt="1"></p>
<p>网络功能和优点 </p>
<ul>
<li>数据和应用程序 </li>
<li>资源 </li>
<li>网络存储 </li>
<li>备份设备</li>
</ul>
<p>作用范围分类</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>简写</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>广域网</td>
<td>WAN</td>
<td>Wide Area Network</td>
</tr>
<tr>
<td>城域网</td>
<td>MAN</td>
<td>Metropolitan Area Network</td>
</tr>
<tr>
<td>局域网</td>
<td>LAN</td>
<td>Local Area Network</td>
</tr>
</tbody></table>
<h2 id="常见的网络物理组件"><a href="#常见的网络物理组件" class="headerlink" title="常见的网络物理组件"></a>常见的网络物理组件</h2><p><img src="../../../../images/image/SRE/day10/2.png" alt="2"></p>
<h3 id="各种网络应用"><a href="#各种网络应用" class="headerlink" title="各种网络应用"></a>各种网络应用</h3><table>
<thead>
<tr>
<th>应用类型</th>
<th>典型软件</th>
</tr>
</thead>
<tbody><tr>
<td>Web 浏览器</td>
<td>Chrome、IE、Firefox等</td>
</tr>
<tr>
<td>即时消息IM</td>
<td>QQ、微信、钉钉等</td>
</tr>
<tr>
<td>短视频</td>
<td>抖音、快手等</td>
</tr>
<tr>
<td>电子邮件</td>
<td>Outlook、foxmail等</td>
</tr>
<tr>
<td>协作</td>
<td>视频会议、VMC、Netmeeting、WebEx等</td>
</tr>
<tr>
<td>web网络服务</td>
<td>apache、nginx、IIS</td>
</tr>
<tr>
<td>文件网络服务</td>
<td>ftp、nfs、samba</td>
</tr>
<tr>
<td>数据库服务</td>
<td>MySQL、MariaDB、MongoDB</td>
</tr>
<tr>
<td>中间件服务</td>
<td>Tomcat、JBoss</td>
</tr>
<tr>
<td>安全服务</td>
<td>Netfilter</td>
</tr>
<tr>
<td>···············</td>
<td>··················</td>
</tr>
</tbody></table>
<h3 id="应用程序对网络的要求"><a href="#应用程序对网络的要求" class="headerlink" title="应用程序对网络的要求"></a>应用程序对网络的要求</h3><p>不同类型的应用程序对网络的要求有区别</p>
<table>
<thead>
<tr>
<th>程序类型</th>
<th>场景</th>
<th>特点</th>
<th>对网络要求</th>
</tr>
</thead>
<tbody><tr>
<td>批处理程序</td>
<td>迅雷下载</td>
<td>无需直接人工交互</td>
<td>带宽很重要，但并非关键性因素</td>
</tr>
<tr>
<td>交互式程序</td>
<td>电商网站</td>
<td>人机交互</td>
<td>等待页面结果，相应时间影响用户体验</td>
</tr>
<tr>
<td>实时程序</td>
<td>视频聊天，直播</td>
<td>人与人的交互</td>
<td>端到端的延时至关重要</td>
</tr>
</tbody></table>
<h2 id="网络的特征"><a href="#网络的特征" class="headerlink" title="网络的特征"></a>网络的特征</h2><p>速度、成本、安全性、可靠性、可用性、可扩展性、拓扑</p>
<h3 id="速度-带宽"><a href="#速度-带宽" class="headerlink" title="速度(带宽)"></a>速度(带宽)</h3><p><img src="../../../../images/image/SRE/day10/3.png" alt="3"></p>
<p>在计算机网络或者是网络运营商中，一般宽带速率的单位用bps(或b/s)表示； </p>
<p>bps是bits per second的缩写，表示比特/秒；即表示每秒钟传输多少位信息； </p>
<p>所以运营商所说的1M带宽的意思是 1Mbps（兆比特每秒，不是兆字节每秒）</p>
<h3 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h3><p>拓扑结构一般是指由点和线排列成的几何图形 </p>
<p>计算机网络的拓扑结构是指一个网络的通信链路和计算机结点相互连接构成的几何图形 </p>
<p><strong>拓扑分类</strong></p>
<p><em><strong>物理拓扑</strong></em></p>
<p>物理拓扑描述了物理设备的布线方式。 </p>
<p>网络的物理拓扑指的是设备和电缆的物理布局。必须选择与需要安装的电缆类型匹配的恰当的物理拓扑。 </p>
<p><em><strong>逻辑拓扑</strong></em></p>
<p>逻辑拓扑描述了信息在网络中流动的方式。 </p>
<p>网络的逻辑拓扑表示信号从网络一个点传输到另一个点的逻辑路径。也就是说，数据访问网络介质，并通过网络介质传输数据包的方式。</p>
<p><strong>拓扑结构分类</strong></p>
<p><img src="../../../../images/image/SRE/day10/4.png" alt="4"></p>
<p><strong>各拓扑结构的特点</strong></p>
<p><em><strong>总线拓扑</strong></em></p>
<p>总线拓扑通常也称为线性总线，总线拓扑中的所有设备均由一条电缆进行连接。 </p>
<p>在总线拓扑中，一条线缆从一台设备延伸到另一设备，类似于城市中的公交线路。主线缆段的末端必须采用终结端，当信号到达线路或线缆末端时，终结端将吸收信号。如果不具备终结端，表示数据的电子信号将在线缆末端弹回，导致网络出错。 </p>
<p><em><strong>环形拓扑</strong></em></p>
<p>在这种拓扑结构中，网络上的所有设备都以环的形式连接。环形拓扑不需要终止的开始端或结束端。数据的传输方式不同于总线拓扑。其中一种实施形式为：“令牌”沿环移动，并在每台设备处停止。如果一台设备希望传输数据，则会在令牌中添加数据和目标地址。随后，令牌继续沿环移动，直至最终找到目标设备，目标设备将从令牌中获取数据。这类方法的优势在于，数据包不会发生冲突。环形拓扑分为两种：单环和双环 </p>
<p><em><strong>单环拓扑</strong></em></p>
<p>在单环拓扑中，网络上的所有设备共用一条线缆，数据单向传输。各设备等候轮到自己时再通过网络发送数据。但是，单环拓扑可能存在单一故障点的问题，一个故障就可能导致整个环形拓扑停止工作。 </p>
<p><em><strong>双环拓扑</strong></em></p>
<p>在双环拓扑中，两个环形允许双向传输数据。这种设置能提供冗余（容错能力）。也就是说，如果一个环发生故障，数据仍可在另一个环上传输。</p>
<p><em><strong>星形和扩展星形拓扑</strong></em> </p>
<p>星形拓扑是以太网LAN中最常见的物理拓扑。在星形网络扩展为包含连接主要网络设备的附加网络设备时，即称其为扩展星形拓扑。 </p>
<p><em><strong>星形拓扑</strong></em></p>
<p>星形拓扑将表现为车轮轮辐的形式。它包含一个中央连接点，该点是集线器、交换机或路由器等设备，所有电缆段均汇集于这一点。网络上的所有设备均使用自己的电缆连接到中央设备。 </p>
<p><em><strong>扩展星形拓扑</strong></em></p>
<p>扩展星形拓扑的一种常见部署方式就是分层设计，例如WAN、企业LAN或园区LAN。 </p>
<p>纯粹的扩展星形拓扑的问题在于，如果中央节点发生故障，大部分网络就会被隔离。因此，大多数扩展星形拓扑都采用一组独立连接设备之外的冗余连接，以避免在设备发生故障时造成隔离。 </p>
<p><em><strong>网状和部分网状拓扑</strong></em></p>
<p>网状拓扑提供了星形拓扑中设备间的冗余。网络可以是完全网状的，也可以是部分网状的，具体取决于所需冗余级别。这种类型的拓扑有助于提高网络的可用性和可靠性。但是，这会提高成本，也会制约可扩展性。 </p>
<p><em><strong>全网状拓扑</strong></em></p>
<p>全网状拓扑将所有设备（节点）彼此相连，以实现冗余和容错能力。其实施成本高、难度大。但这种拓扑的容错能力最强，因为任何一条链路的故障都不会影响网络的连通性。 </p>
<p>连通线路计算公式：n(n-1)/2。 </p>
<p><em><strong>部份网状拓扑</strong></em></p>
<p>在这种拓扑中，只有重要节点的设备与其它设备具有直接一一相连的线路，对于其它设备的数据传输，需要从其它节点中继，这种设计有一定的冗余和容错能力，也降低了全网状拓扑结构的成本和实施难度。</p>
<h2 id="网络标准"><a href="#网络标准" class="headerlink" title="网络标准"></a>网络标准</h2><h3 id="网络标准和分层"><a href="#网络标准和分层" class="headerlink" title="网络标准和分层"></a>网络标准和分层</h3><p>旧模型：专有产品，由一个厂商控制应用程序和嵌入的软件 </p>
<p>基于标准的模型：多厂商软件，分层方法</p>
<p><strong>层次划分的必要性</strong> </p>
<p>计算机网络是由许多硬件、软件和协议交织起来的复杂系统。由于网络设计十分复杂，如何设计、组织和实现计算机网络是一个挑战，必须要采用科学有效的方法。</p>
<p><strong>层次划分的方法</strong></p>
<ul>
<li>网络的层应当具有相对独立的功能 </li>
<li>梳理功能之间的关系，使一个功能可以为实现另一个功能提供必要的服务，从而形成系统的层次结构 </li>
<li>为提高系统的工作效率，相同或相近的功能仅在一个层次中实现，而且尽可能在较高的层次中实现 </li>
<li>每一层只为相邻的上一层提供服务</li>
</ul>
<p><strong>层次划分的优点</strong></p>
<ul>
<li>各层之间相互独立，每一层只实现一种相对独立的功能，使问题复杂程度降低 </li>
<li>灵活性好，各层内部的操作不会影响其他层 </li>
<li>结构上可分割开，各层之间都可以采用最合适的技术来实现 </li>
<li>易于实现和维护，因为整个系统已被分解成相对独立的子系统 </li>
<li>能促进标准化工作，因为每一层的功能及其提供的服务都有了精确的说明</li>
</ul>
<h3 id="开放系统互联-OSI"><a href="#开放系统互联-OSI" class="headerlink" title="开放系统互联 OSI"></a>开放系统互联 OSI</h3><p>OSI 七层的记忆口诀</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">All People Seem To Need Data Process（物数网传会表应）</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>序号</th>
<th>名称</th>
<th>英文</th>
</tr>
</thead>
<tbody><tr>
<td>7</td>
<td>应用层</td>
<td>Application</td>
</tr>
<tr>
<td>6</td>
<td>表示层</td>
<td>Presentation</td>
</tr>
<tr>
<td>5</td>
<td>会话层</td>
<td>Session</td>
</tr>
<tr>
<td>4</td>
<td>传输层</td>
<td>Transport</td>
</tr>
<tr>
<td>3</td>
<td>网络层</td>
<td>Network</td>
</tr>
<tr>
<td>2</td>
<td>数据链路层</td>
<td>Data Link</td>
</tr>
<tr>
<td>1</td>
<td>物理层</td>
<td>Physical</td>
</tr>
</tbody></table>
<p>在制定计算机网络标准方面，起着重大作用的两大国际组织是：国际电信联盟电信标准化部门，与国际标准化组织（ISO International Organization for Standardization），虽然它们工作领域不同，但随着科学技术的发展，通信与信息处理之间的界限开始变得比较模糊，这也成了国际电信联盟电信标准化部门和ISO共同关心的领域。1984年，ISO发布了著名的OSI(Open System Interconnection)标准，它定义了网络互联的7层框架，物理层、数据链路层、网络层、传输层、会话层、表示层和应用层），即OSI开放系统互连参考模型</p>
<p><strong>OSI 模型的七层结构</strong></p>
<p><strong>第7层 应用层</strong></p>
<p>应用层（Application Layer）提供为应用软件而设的接口，以设置与另一应用软件之间的通信。例如: HTTP、HTTPS、FTP、TELNET、SSH、SMTP、POP3、MySQL等</p>
<p><strong>第6层 表示层</strong></p>
<p>表示层（Presentation Layer）把数据转换为能与接收者的系统格式兼容并适合传输的格式 </p>
<p><strong>第5层 会话层</strong></p>
<p>会话层（Session Layer）负责在数据传输中设置和维护电脑网络中两台电脑之间的通信连接。</p>
<p>第4层 传输层</p>
<p>传输层（Transport Layer）把传输表头（TH）加至数据以形成数据包。传输表头包含了所使用的协议等发送信息。例如:传输控制协议 （TCP）等。</p>
<p><strong>第3层 网络层</strong></p>
<p>网络层（Network Layer）决定数据的路径选择和转寄，将网络表头（NH）加至数据包，以形成报文。网络表头包含了网络数据。例如:互联网协议（IP）等。 </p>
<p>第2层 数据链接层</p>
<p>数据链路层（Data Link Layer）负责网络寻址、错误侦测和改错。当表头和表尾被加至数据包时，会形成信息框（Data Frame）。数据链表头（DLH）是包含了物理地址和错误侦测及改错的方法。数据链表尾（DLT）是一串指示数据包末端的字符串。例如以太网、无线局域网（Wi-Fi）和通用分组无线服务（GPRS）等。分为两个子层：逻辑链路控制（logical link control，LLC）子层和介质访问控（Media access control，MAC）子层。 </p>
<p><strong>第1层 物理层</strong></p>
<p>物理层（Physical Layer）在局部局域网上传送数据帧（Data Frame），它负责管理电脑通信设备和网络媒体之间的互通。包括了针脚、电压、线缆规范、集线器、中继器、主机接口卡等。</p>
<h3 id="网络的通信过程"><a href="#网络的通信过程" class="headerlink" title="网络的通信过程"></a>网络的通信过程</h3><h4 id="数据封装和数据解封"><a href="#数据封装和数据解封" class="headerlink" title="数据封装和数据解封"></a>数据封装和数据解封</h4><p><img src="../../../../images/image/SRE/day10/5.png" alt="5"></p>
<h4 id="协议数据单元-PDU"><a href="#协议数据单元-PDU" class="headerlink" title="协议数据单元 PDU"></a>协议数据单元 PDU</h4><p>PDU: Protocol Data Unit,协议数据单元是指对等层次之间传递的数据单位</p>
<p>发送方和接收方各层之间的PDU</p>
<table>
<thead>
<tr>
<th>发送方</th>
<th>数据单元PDU</th>
<th>接收方</th>
</tr>
</thead>
<tbody><tr>
<td>应用层</td>
<td>消息 message</td>
<td>应用层</td>
</tr>
<tr>
<td>表示层</td>
<td>消息 message</td>
<td>表示层</td>
</tr>
<tr>
<td>会话层</td>
<td>消息 message</td>
<td>会话层</td>
</tr>
<tr>
<td>传输层</td>
<td>数据段 segment</td>
<td>传输层</td>
</tr>
<tr>
<td>网络层</td>
<td>数据包 packet</td>
<td>网络层</td>
</tr>
<tr>
<td>数据链路层</td>
<td>数据帧 frame</td>
<td>数据链路层</td>
</tr>
<tr>
<td>物理层</td>
<td>数据位 bit</td>
<td>物理层</td>
</tr>
</tbody></table>
<h4 id="三种通讯模式"><a href="#三种通讯模式" class="headerlink" title="三种通讯模式"></a>三种通讯模式</h4><p>三种通讯方式的区别在于目标，而不在于源</p>
<table>
<thead>
<tr>
<th>通讯模式</th>
<th></th>
<th>特点</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>unicast</td>
<td>单播</td>
<td>目标设备只有一台</td>
<td>@张三</td>
</tr>
<tr>
<td>broadcast</td>
<td>广播</td>
<td>目标设备是所有</td>
<td>@所有人</td>
</tr>
<tr>
<td>multicast</td>
<td>多播</td>
<td>目标设备是多个</td>
<td>@张三@李四@王五</td>
</tr>
</tbody></table>
<p><img src="../../../../images/image/SRE/day10/6.png" alt="6"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># ifconfig</span></span><br><span class="line">ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</span><br><span class="line">       inet 10.0.0.158 netmask 255.255.255.0 broadcast 10.0.0.255</span><br><span class="line">       inet6 fe80::20c:29ff:fef3:449a prefixlen 64 scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">       ether 00:0c:29:f3:44:9a txqueuelen 1000 (Ethernet)</span><br><span class="line">       RX packets 2903 bytes 268599 (262.3 KiB)</span><br><span class="line">       RX errors 0 dropped 0 overruns 0 frame 0</span><br><span class="line">       TX packets 2078 bytes 199764 (195.0 KiB)</span><br><span class="line">       TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</span><br></pre></td></tr></table></figure>

<h4 id="冲突域和广播域"><a href="#冲突域和广播域" class="headerlink" title="冲突域和广播域"></a>冲突域和广播域</h4><p><strong>冲突域</strong></p>
<p>两个网络设备同时发送数据,如果发生了冲突,则两个设备处于同一个冲突域,反之,则各自处于不同的冲突域 </p>
<p><strong>广播域</strong> </p>
<p>一个网络设备发送广播，另一个设备收到了,则两个设备处于同一个广播域,反之,则各自处于不同的广播域</p>
<h4 id="三种通讯机制"><a href="#三种通讯机制" class="headerlink" title="三种通讯机制"></a>三种通讯机制</h4><table>
<thead>
<tr>
<th>通讯机制</th>
<th>特点</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>单工通信</td>
<td>只有一个方向的通讯</td>
<td>收音机</td>
</tr>
<tr>
<td>半双工通信</td>
<td>通信双方都可以发送和接收信息，但不能同时发送，也不能同时接收</td>
<td>对讲机</td>
</tr>
<tr>
<td>全双工通信</td>
<td>通信双方可以同时发送和同时接收</td>
<td>手机</td>
</tr>
</tbody></table>
<p><img src="../../../../images/image/SRE/day10/7.png" alt="7"></p>
<p>查看双工和速度</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果此命令不支持，则可以使用 ethtool 命令</span></span><br><span class="line">[root@localhost nginx]<span class="comment"># mii-tool eth0</span></span><br><span class="line"> eth0: negotiated 1000baseTx-FD, <span class="built_in">link</span> ok   </span><br><span class="line"> <span class="comment">#FD 全双工，1000 千兆，base 基带传输，T 双绞线，link ok 表示网络状态正常</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">[root@localhost nginx]<span class="comment"># mii-tool -v eth0</span></span><br><span class="line"> eth0: negotiated 100baseTx-FD, <span class="built_in">link</span> ok</span><br><span class="line"> product info: vendor 00:07:32, model 17 rev 5</span><br><span class="line"> basic mode:   autonegotiation enabled</span><br><span class="line"> basic status: autonegotiation complete, <span class="built_in">link</span> ok</span><br><span class="line"> capabilities: 100baseTx-FD 100baseTx-HD 10baseT-FD 10baseT-HD</span><br><span class="line"> advertising: 100baseTx-FD 100baseTx-HD 10baseT-FD 10baseT-HD flow-control</span><br><span class="line"> <span class="built_in">link</span> partner: 100baseTx-FD 100baseTx-HD 10baseT-FD 10baseT-HD</span><br><span class="line">[root@localhost nginx]<span class="comment"># ethtool ens160</span></span><br><span class="line">Settings <span class="keyword">for</span> ens160:</span><br><span class="line">       Supported ports: [ TP ]</span><br><span class="line">       Supported <span class="built_in">link</span> modes:   1000baseT/Full <span class="comment">#支持的工作模式</span></span><br><span class="line">                               10000baseT/Full</span><br><span class="line">       Supported pause frame use: No</span><br><span class="line">       Supports auto-negotiation: No</span><br><span class="line">       Supported FEC modes: Not reported</span><br><span class="line">       Advertised <span class="built_in">link</span> modes: Not reported</span><br><span class="line">       Advertised pause frame use: No</span><br><span class="line">       Advertised auto-negotiation: No</span><br><span class="line">       Advertised FEC modes: Not reported</span><br><span class="line">       Speed: 10000Mb/s <span class="comment">#速度</span></span><br><span class="line">       Duplex: Full <span class="comment">#全双工</span></span><br><span class="line">       Auto-negotiation: off</span><br><span class="line">       Port: Twisted Pair</span><br><span class="line">       PHYAD: 0</span><br><span class="line">       Transceiver: internal</span><br><span class="line">       MDI-X: Unknown</span><br><span class="line">       Supports Wake-on: uag</span><br><span class="line">       Wake-on: d</span><br><span class="line">       Link detected: <span class="built_in">yes</span> <span class="comment">#当前网络工作状态正常</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">[root@localhost nginx]<span class="comment"># ethtool -i ens160</span></span><br><span class="line"> driver: vmxnet3 <span class="comment">#网卡驱动 </span></span><br><span class="line"> version: 1.6.0.0-k-NAPI</span><br><span class="line"> firmware-version: </span><br><span class="line"> expansion-rom-version: </span><br><span class="line"> bus-info: 0000:03:00.0</span><br><span class="line"> supports-statistics: <span class="built_in">yes</span></span><br><span class="line"> supports-test: no</span><br><span class="line"> supports-eeprom-access: no</span><br><span class="line"> supports-register-dump: <span class="built_in">yes</span></span><br><span class="line"> supports-priv-flags: no</span><br></pre></td></tr></table></figure>

<h1 id="局域网-Local-Area-Network"><a href="#局域网-Local-Area-Network" class="headerlink" title="局域网 Local Area Network"></a>局域网 Local Area Network</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>网络为一个单位所拥有</li>
<li>地理范围和站点数目均有限</li>
</ul>
<h3 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h3><ul>
<li>资源共享和数据通信</li>
</ul>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>能方便地共享昂贵的外部设备、主机以及软件、数据。从一个站点可以访问全网</li>
<li>便于系统的扩展和逐渐演变，各设备的位置可灵活的调整和改变</li>
<li>提高系统的可靠性、可用性和易用性</li>
</ul>
<h3 id="标准"><a href="#标准" class="headerlink" title="标准"></a>标准</h3><p>IEEE（国际电子电气工程师协会）于1980年2月成立了局域网标准委员会（简称IEEE802委员会），专门从事局域网标准化工作，并制定了IEEE802标准。802标准所描述的局域网参考模型只对应OSI参考模型的数据链路层与物理层，它将数据链路层划分为逻辑链路层LLC子层和介质访问控制MAC子层； </p>
<p>LLC子层负责向其上层提供服务； </p>
<p>MAC子层的主要功能包括数据帧的封装/卸装，帧的寻址和识别，帧的接收与发送，链路的管理，帧的差错控制等。MAC子层的存在屏蔽了不同物理链路种类的差异性。</p>
<p><strong>局域网标准</strong></p>
<p><img src="../../../../images/image/SRE/day10/8.png" alt="8"></p>
<table>
<thead>
<tr>
<th>标准名称</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>IEEE 802.1标准</td>
<td>局域网体系结构、网络互连、以及网络管理和性能测试</td>
</tr>
<tr>
<td>IEEE 802.2标准</td>
<td>逻辑链路控制LLC子层功能与服务</td>
</tr>
<tr>
<td>IEEE 802.3标准</td>
<td>带冲突检测的载波侦听多路访问CSMA/CD总线介质访问控制子层与物理层规范</td>
</tr>
<tr>
<td>IEEE 802.4标准</td>
<td>令牌总线（Token Bus）介质访问控制子层与物理层规范</td>
</tr>
<tr>
<td>IEEE 802.5标准</td>
<td>令牌环（Token Ring）介质访问控制子层与物理层规范</td>
</tr>
<tr>
<td>IEEE 802.6标准</td>
<td>城域网MAN介质访问控制子层与物理层规范</td>
</tr>
<tr>
<td>IEEE 802.7标准</td>
<td>宽带网络技术</td>
</tr>
<tr>
<td>IEEE 802.8标准</td>
<td>光纤传输技术</td>
</tr>
<tr>
<td>IEEE 802.9标准</td>
<td>综合语音与数据局域网（IVD LAN）技术</td>
</tr>
<tr>
<td>IEEE 802.10标准</td>
<td>可互操作的局域网安全性规范（SILS）</td>
</tr>
<tr>
<td>IEEE 802.11标准</td>
<td>无线局域网技术</td>
</tr>
<tr>
<td>IEEE 802.12标准</td>
<td>优先度要求的访问控制方法</td>
</tr>
<tr>
<td>IEEE 802.13标准</td>
<td>未使用</td>
</tr>
<tr>
<td>IEEE 802.14标准</td>
<td>交互式电视网</td>
</tr>
<tr>
<td>IEEE 802.15标准</td>
<td>无线个人局域网（WPAN）的MAC子层和物理层规范。代表技术为蓝牙（Bluetooth）</td>
</tr>
<tr>
<td>IEEE 802.16标准</td>
<td>宽带无线局域网网络</td>
</tr>
<tr>
<td>IEEE 802.20标准</td>
<td>移动宽带无线接入系统(MBWA，Mobile Broadband Wireless Access)</td>
</tr>
<tr>
<td>IEEE 802.22标准</td>
<td>无线地域网络（Wireless Regional Area Networks，WRAN）</td>
</tr>
</tbody></table>
<p><strong>无线网络标准</strong></p>
<p>中国国家无线网络标准：WAPI </p>
<p>Wi-Fi：无线保真（Wireless Fidelity），是Wi-Fi联盟制造商的商标做为产品的品牌认证，是一个创建于IEEE 802.11标准的无线局域网技术，Wi-Fi联盟成立于1999年，当时的名称叫做Wireless Ethernet Compatibility Alliance（WECA）。在2002年10月，正式改名为Wi-Fi  Alliance。</p>
<p><img src="../../../../images/image/SRE/day10/9.png" alt="9"></p>
<p>Wi-Fi 6是当前最新的WiFi技术标准，专业称呼为：802.11ax，WiFi6简单来讲就是第六代WiFi标准的意思，就和第五代移动通信标准——5G、丐帮第六代长老的意思差不多。在WiFi6之前，WiFi的名字并不是什么WiFi5、WiFi4这种简单的叫法，而是用一串非常拗口的技术型号来区分，比如WiFi5之前就叫802.11 ac，WiFi4就叫802.11 a/b/g/n，对于懂行的人来说辨别起来没问题，但对于普通用户来说就是两眼一抓瞎看谁都一样（这就好比俄罗斯大兄弟的人名：尼古拉·阿列克谢耶维奇·奥斯特洛夫斯基，一样难记） </p>
<p>2018年WiFi联盟自己也感觉这样叫下去不行，我们得学学别人移动通信协会3G\4G\5G那样整个简单容易记的代号，让消费者们容易区分前代与新代，刺激厂商升级更新换代。所以WiFi6的名称就诞生了！并且一改还顺便把WiFi4、WiFi5一起名字简化了，现在大家在最新的手机系统中的WiFi角标就能看到WiFi4、WiFi5、WiFi6的标识来区分你连接的是第几代WiFi技术，整的和手机信号是一样一样的!</p>
<p><img src="../../../../images/image/SRE/day10/10.png" alt="10"></p>
<p><img src="../../../../images/image/SRE/day10/11.png" alt="11"></p>
<p><img src="../../../../images/image/SRE/day10/12.png" alt="12"></p>
<h2 id="组网设备"><a href="#组网设备" class="headerlink" title="组网设备"></a>组网设备</h2><p><strong>常见组网设备包括路由器(Router)，交换机(Switch)，集线器(Hub)，中继器(Repeater)，线缆等</strong></p>
<p><img src="../../../../images/image/SRE/day10/13.png" alt="13"></p>
<h3 id="网络线缆和接口"><a href="#网络线缆和接口" class="headerlink" title="网络线缆和接口"></a>网络线缆和接口</h3><p><strong>常见的网络线缆包括 双绞线，同轴线，光纤线等;</strong></p>
<p>双绞线就是我们常说的网线，又分为屏蔽双绞线（Shielded Twisted Pair，STP）与非屏蔽双绞线（Unshielded Twisted Pair，UTP）</p>
<h4 id="网线标准"><a href="#网线标准" class="headerlink" title="网线标准"></a>网线标准</h4><p>上世纪80年代初，诞生了最早的网线标准（CAT）,这个标准一直沿用至今，主要根据带宽和传输速率来区分，从一类网线CAT1——八类网线CAT8</p>
<p><img src="../../../../images/image/SRE/day10/14.png" alt="14"></p>
<ol>
<li>一类网线：主要用于传输语音，不同于数据传输主要用于八十年代初之前的电话线缆，已淘汰。</li>
<li>二类网线：传输带宽为1MHZ，用于语音传输，最高数据传输速率4Mbps，常见于使用4Mbps规范令牌传递协议的旧的令牌（Token Ring），已被淘汰。</li>
<li>三类网线：该电缆的传输带宽16MHz，用于语音传输及最高传输速率为10Mbps的数据传输，主要用于10BASE–T，被ANSI/TIA-568.C.2作为最低使用等级 。</li>
<li>四类网线：该类电缆的传输频率为20MHz，用于语音传输和最高传输速率16Mbps（指的是16Mbit/s令牌环）的数据传输，主要用于基于令牌的局域网和 10BASE-T/100BASE-T。最大网段长为100m，采用RJ形式的连接器，未被广泛采用。 </li>
<li>五类线：可追溯到1995年，传输带宽为100MHz，可支持10Mbps和100Mbps传输速率（虽然现实中与理论值有一定差距），主要用于双绞线以太网（10BASE-T/100BASE-T），目前仍可使用，不过在新网络建设中已经很难看到。 </li>
<li>超五类线：标准于2001年被提出，传输带宽为100MHz，近距离情况下传输速率已可达1000Mbps。它具有衰减小，串扰少，比五类线增加了近端串音功率和测试要求，所以它也成为了当前应用最为广泛的网线。 </li>
<li>六类线：继CAT5e之后，CAT6标准被提出，传输带宽为250MHz，最适用于传输速率为1Gbps的应用。改善了在串扰以及回波损耗方面的性能，这一点对于新一代全双工的高速网络应用而言是极重要的，还有一个特点是在4个双绞线中间加了十字形的骨架。 </li>
<li>超六类线：超六类线是六类线的改进版，发布于2008年，同样是ANSI/TIA-568C.2和ISO/IEC 11801超六类/EA级标准中规定的一种双绞线电缆，主要应用于万兆位网络中。传输频率500 MHz，最大传输速度也可达到10Gbps ，在外部串扰等方面有较大改善。 </li>
<li>七类线：该线是ISO/IEC 11801 7类/F级标准中于2002年认可的一种双绞线，它主要为了适应万兆以太网技术的应用和发展。但它不再是一种非屏蔽双绞线了，而是一种屏蔽双绞线，所以它的传输频率至少可达600 MHz，传输速率可达10 Gbps。 </li>
<li>超七类线:相对于CAT7最大区别在于，支持的频率带宽提升到了1000MHz，在国内而言，七类网线已经有很少地方使用了，超七类就更加没有广泛的进入人们的生活，目前使用范围最广的是超五类、六类等网线。 </li>
<li>八类线CAT8：相关标准由美国通信工业协会 （TIA）TR-43委员会在2016年正式发布，支持2000MHz带宽，支持40Gbps以太网络，主要应用于数据中心。</li>
</ol>
<h4 id="网线线序和规范"><a href="#网线线序和规范" class="headerlink" title="网线线序和规范"></a>网线线序和规范</h4><p>UTP线拆解</p>
<p>剥开双绞线，会看到其中有八条小线，两条缠绕为一股（这也是双绞线名称的由来）</p>
<p>分别是 绿-绿白，蓝-蓝白，橙-橙白，棕-棕白。</p>
<p><img src="../../../../images/image/SRE/day10/15.png" alt="15"></p>
<p><img src="../../../../images/image/SRE/day10/16.png" alt="16"></p>
<p>线序指的是压水晶头时里面小线的排列顺序 </p>
<p>T568B标准是主流的线序</p>
<p>国际线序标准</p>
<table>
<thead>
<tr>
<th>标准</th>
<th>线序（从左到右）</th>
</tr>
</thead>
<tbody><tr>
<td>T568A</td>
<td>白绿 绿 白橙 蓝 白蓝 橙 白棕 棕</td>
</tr>
<tr>
<td>T568B</td>
<td>白橙 橙 白绿 蓝 白蓝 绿 白棕 棕</td>
</tr>
<tr>
<td>USOC(8)</td>
<td>白棕 绿 白橙 蓝 白蓝 橙 白绿 棕</td>
</tr>
<tr>
<td>USOC(6)</td>
<td>空 白绿 白橙 蓝 白蓝 橙 绿 空</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>RJ-45 Connector </p>
<p><img src="../../../../images/image/SRE/day10/17.png" alt="17"></p>
<p><strong>双绞线针脚定义</strong></p>
<p>注：BI (Bidirectional) 双向数据; RX (Receive Data) 接收数据；TX (Transmit Data) 传送数据</p>
<p><img src="../../../../images/image/SRE/day10/18.png" alt="18"></p>
<h4 id="光纤和接口Fiber-Optic"><a href="#光纤和接口Fiber-Optic" class="headerlink" title="光纤和接口Fiber-Optic"></a>光纤和接口Fiber-Optic</h4><p><img src="../../../../images/image/SRE/day10/19.png" alt="19"></p>
<ul>
<li>Short wavelength (1000BASE-SX) 最远几百米</li>
<li>Long wavelength/long haul (1000BASE-LX/LH) 最远几公里</li>
<li>Extended distance (1000BASE-ZX) 最远上百公里</li>
</ul>
<h3 id="网络适配器"><a href="#网络适配器" class="headerlink" title="网络适配器"></a>网络适配器</h3><p><img src="../../../../images/image/SRE/day10/20.png" alt="20"></p>
<p><img src="../../../../images/image/SRE/day10/21.png" alt="21"></p>
<p><img src="../../../../images/image/SRE/day10/22.png" alt="22"></p>
<p><img src="../../../../images/image/SRE/day10/23.png" alt="23"></p>
<p>网卡作用</p>
<ul>
<li>进行串行/并行转换数据缓存</li>
<li>在计算机操作系统中安装设备驱动程序</li>
<li>实现以太网协议</li>
</ul>
<p>网卡类型</p>
<ul>
<li>按总线接口类型进行分类：分为ISA、PCI、PCI-X 、PCMCIA、PCI-E 和USB等几种类型</li>
<li>按传输介质接口分类：细同轴电缆的BNC接口网卡、粗同轴电缆AUI接口网卡、以太网双绞线RJ-45接口网卡、光纤F/O接口网卡、无线网卡等 </li>
<li>按传输速率（带宽）分类：10Mbps网卡、100Mbps以太网卡、10Mbps/100Mbps自适应网卡、1000Mbps千兆以太网卡、40Gbps自适应网卡等</li>
</ul>
<h3 id="中继器和集线器"><a href="#中继器和集线器" class="headerlink" title="中继器和集线器"></a>中继器和集线器</h3><h4 id="中继器-repeater"><a href="#中继器-repeater" class="headerlink" title="中继器 repeater"></a>中继器 repeater</h4><p>实际上是一种信号再生放大器，可将变弱的信号和有失真的信号进行整形与放大，输出信号比原信号的强度将大大提高,中继器不解释、不改变收到的数字信息，而只是将其整形放大后再转发出去</p>
<p>优点</p>
<ul>
<li>易于操作</li>
<li>很短的等待时间</li>
<li>价格便宜</li>
<li>突破线缆的距离限制来扩展局域网段的距离</li>
<li>可用来连接不同的物理介质</li>
</ul>
<p>缺点</p>
<ul>
<li>采用中继器连接网络分支的数目要受具体的网络体系结构限制</li>
<li>中继器不能连接不同类型的网络</li>
<li>中继器没有隔离和过滤功能，无路由选择、交换、纠错／检错功能，一个分支出现故障可能会影响到其他的每一个网络分支</li>
<li>使用中继器扩充网络距离是最简单最廉价的方法，但当负载增加时，网络性能急剧下降，所以只有当网络负载很轻和网络时延要求不高的条件下才能使用</li>
</ul>
<h4 id="集线器-hub"><a href="#集线器-hub" class="headerlink" title="集线器 hub"></a>集线器 hub</h4><p><img src="../../../../images/image/SRE/day10/24.png" alt="24"></p>
<p>集线器（Hub）工作在物理层，是中继器的一种形式，是一种集中连接缆线的网络组件，可以认为集线器是一个多端口的中继器，集线器提供多端口连接，主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。 </p>
<p>Hub并不记忆报文是由哪个MAC地址发出，哪个MAC地址在Hub的哪个端口</p>
<p>Hub的特点：</p>
<ul>
<li>共享带宽</li>
<li>半双工</li>
</ul>
<p><img src="../../../../images/image/SRE/day10/25.png" alt="25"></p>
<h3 id="网桥和交换机"><a href="#网桥和交换机" class="headerlink" title="网桥和交换机"></a>网桥和交换机</h3><h4 id="网桥-Bridge"><a href="#网桥-Bridge" class="headerlink" title="网桥 Bridge"></a>网桥 Bridge</h4><p><img src="../../../../images/image/SRE/day10/26.png" alt="26"></p>
<p>网桥（Bridge）也叫桥接器，是连接两个局域网的一种存储/转发设备，根据MAC地址表对数据帧进行转发，可隔离碰撞域</p>
<p>网桥将网络的多个网段在数据链路层连接起来，并对网络数据帧进行管理</p>
<p>网桥的内部结构</p>
<p><img src="../../../../images/image/SRE/day10/27.png" alt="27"></p>
<p>优点</p>
<ul>
<li>过滤通信量</li>
<li>扩大了物理范围</li>
<li>提高了可靠性</li>
<li>可互连不同物理层、不同 MAC 子层和不同速率（如10 Mb/s 和 100 Mb/s 以太网）的局域网 </li>
</ul>
<p>缺点</p>
<ul>
<li>存储转发增加了时延</li>
<li>在MAC 子层并没有流量控制功能</li>
<li>具有不同 MAC 子层的网段桥接在一起时时延更大</li>
<li>网桥只适合于用户数不太多(不超过几百个)和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴</li>
</ul>
<h4 id="交换机-switch"><a href="#交换机-switch" class="headerlink" title="交换机 switch"></a>交换机 switch</h4><p><img src="../../../../images/image/SRE/day10/28.png" alt="28"></p>
<p>交换机是工作在OSI参考模型数据链路层的设备，外表和集线器相似</p>
<p>它通过判断数据帧的目的MAC地址，从而将数据帧从合适端口发送出去</p>
<p>交换机是通过MAC地址的学习和维护更新机制来实现数据帧的转发</p>
<p>内部结构</p>
<p><img src="../../../../images/image/SRE/day10/29.png" alt="29"></p>
<p>工作原理</p>
<ul>
<li>交换机根据收到数据帧中的源MAC地址建立该地址同交换机端口的映射，并将其写入MAC地址表中</li>
<li>交换机将数据帧中的目的MAC地址同已建立的MAC地址表进行比较，以决定由哪个端口进行转发</li>
<li>如数据帧中的目的MAC地址不在MAC地址表中，则向所有端口转发。这一过程称为泛洪（flood）</li>
<li>广播帧和组播帧向所有的端口转发</li>
</ul>
<p><img src="../../../../images/image/SRE/day10/30.png" alt="30"></p>
<h4 id="集线器与交换机的比较"><a href="#集线器与交换机的比较" class="headerlink" title="集线器与交换机的比较"></a>集线器与交换机的比较</h4><p><img src="../../../../images/image/SRE/day10/31.png" alt="31"></p>
<ol>
<li>交换机属于数据链路层设备，而集线器属于物理层设备 </li>
<li>集线器在转发帧时，不对传输介质进行检测，交换机在转发帧之前必须执行 CSMA/CD 算法。若在发送过程中出现碰撞，就必须停止发送和进行退避。所以交换机能隔离冲突，而集线器却只能增加冲突 </li>
<li>交换机的每个端口可提供专用的带宽，而集线器的所有端口只能共享带宽 </li>
<li>集线器只能实现半双工传送，而交换机可支持全双工传送 </li>
<li>集线器和交换机都无法隔离广播域</li>
</ol>
<h3 id="路由器-router"><a href="#路由器-router" class="headerlink" title="路由器 router"></a>路由器 router</h3><p><img src="../../../../images/image/SRE/day10/32.png" alt="32"></p>
<p>路由：把一个数据包从一个设备发送到不同网络里的另一个设备上去。这些工作依靠路由器来完成。路由器只关心网络的状态和决定网络中的最佳路径。路由的实现依靠路由器中的路由表来完成</p>
<p>路由器功能：</p>
<ul>
<li>工作在网络层 </li>
<li>分隔广播域和冲突域 </li>
<li>选择路由表中到达目标最好的路径 </li>
<li>维护和检查路由信息 </li>
<li>连接广域网</li>
</ul>
<h3 id="对比与总结"><a href="#对比与总结" class="headerlink" title="对比与总结"></a>对比与总结</h3><table>
<thead>
<tr>
<th>设备</th>
<th>iso</th>
<th>域</th>
</tr>
</thead>
<tbody><tr>
<td>集线器 hub</td>
<td>物理层</td>
<td>同一冲突域，同一广播域</td>
</tr>
<tr>
<td>交换机 switch</td>
<td>数据链路层</td>
<td>每个端口一个冲突域，所有端口都在一个广播域</td>
</tr>
<tr>
<td>路由器 router</td>
<td>网络层</td>
<td>每个端口都有独立广播域</td>
</tr>
</tbody></table>
<h2 id="以太网技术"><a href="#以太网技术" class="headerlink" title="以太网技术"></a>以太网技术</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><table>
<thead>
<tr>
<th>year</th>
<th>Ethernet activity</th>
</tr>
</thead>
<tbody><tr>
<td>1970</td>
<td>First packet radio network</td>
</tr>
<tr>
<td>1973</td>
<td>Ethernet invented at Xerox</td>
</tr>
<tr>
<td>1977</td>
<td>U.S patent no. 4063220 issued</td>
</tr>
<tr>
<td>1982</td>
<td>DIX releases 10Mb/s Ethernet</td>
</tr>
<tr>
<td>1992</td>
<td>First stackable Ethernet hub</td>
</tr>
<tr>
<td>2002</td>
<td>IEEE approves 802.3ea; 10 billion bps</td>
</tr>
</tbody></table>
<p>以太网（Ethernet）是一种产生较早且使用相当广泛的局域网，由美国Xerox（施乐）公司的Palo Alto 研究中心（简称为PARC）于20世纪70年代初期开始研究并于1975年研制成功</p>
<h3 id="以太网MAC帧格式"><a href="#以太网MAC帧格式" class="headerlink" title="以太网MAC帧格式"></a>以太网MAC帧格式</h3><p><img src="../../../../images/image/SRE/day10/33.png" alt="33"></p>
<p><img src="../../../../images/image/SRE/day10/34.png" alt="34"></p>
<h3 id="MAC地址"><a href="#MAC地址" class="headerlink" title="MAC地址"></a>MAC地址</h3><p><img src="../../../../images/image/SRE/day10/35.png" alt="35"></p>
<p>在局域网中，硬件地址又称为物理地址或MAC地址（因为这种地址用在MAC帧中）</p>
<p>IEEE 802标准为局域网规定了一种48位的全球地址（一般都简称为“地址”)，是局域网中每一台计算机固化在网卡ROM中的地址</p>
<p>IEEE 的注册管理机构 RA 负责向厂家分配地址字段的前三个字节(即高位 24 位) </p>
<p>地址字段中的后三个字节(即低位 24 位)由厂家自行指派，称为扩展标识符，必须保证生产出的适配器没有重复地址</p>
<p>各大厂商MAC识别码： <a target="_blank" rel="noopener" href="https://standards-oui.ieee.org/oui/oui.txt">https://standards-oui.ieee.org/oui/oui.txt</a></p>
<h3 id="冲突检测的载波侦听多路访问-CSMA-CD"><a href="#冲突检测的载波侦听多路访问-CSMA-CD" class="headerlink" title="冲突检测的载波侦听多路访问 CSMA/CD"></a>冲突检测的载波侦听多路访问 CSMA/CD</h3><p>主要用在早期的Hub环境中，用来解决冲突域的问题，现在主流的交换机上不再使用</p>
<p><img src="../../../../images/image/SRE/day10/36.png" alt="36"></p>
<p>工作原理</p>
<ul>
<li>先听后发</li>
<li>边发边听</li>
<li>冲突停止</li>
<li>延迟重发</li>
</ul>
<h2 id="虚拟局域网-VLAN"><a href="#虚拟局域网-VLAN" class="headerlink" title="虚拟局域网 VLAN"></a>虚拟局域网 VLAN</h2><h3 id="VLAN-原理"><a href="#VLAN-原理" class="headerlink" title="VLAN 原理"></a>VLAN 原理</h3><p>此技术可以用交换机来进行网络隔离，但要求交换机具有网络管理功能</p>
<p><img src="../../../../images/image/SRE/day10/37.png" alt="37"></p>
<p>虚拟局域网 VLAN 是由一些局域网网段构成的与物理位置无关的逻辑组这些网段具有某些共同的需求。每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧的工作站是属于哪一个 VLAN。虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网</p>
<p>优点</p>
<ol>
<li>更有效地共享网络资源。如果用交换机构成较大的局域网，大量的广播报文就会使网络性能下降。VLAN能将广播报文限制在本VLAN范围内，从而提升了网络的效能 </li>
<li>简化网络管理。当结点物理位置发生变化时，如跨越多个局域网，通过逻辑上配置VLAN即可形成网络设备的逻辑组，无需重新布线和改变IP地址等。这些逻辑组可以跨越一个或多个二层交换机</li>
<li>提高网络的数据安全性。一个VLAN中的结点接收不到另一个VLAN中其他结点的帧</li>
</ol>
<p>虚拟局域网的实现技术</p>
<ol>
<li>基于端口的VLAN</li>
<li>基于MAC地址的VLAN </li>
<li>基于协议的VLAN </li>
<li>基于网络地址的VLAN</li>
</ol>
<h3 id="IEEE-802-1Q-帧结构"><a href="#IEEE-802-1Q-帧结构" class="headerlink" title="IEEE 802.1Q 帧结构"></a>IEEE 802.1Q 帧结构</h3><p><img src="../../../../images/image/SRE/day10/38.png" alt="38"></p>
<p>VLAN 标签各字段含义</p>
<p>TPID：Tag Protocol Identifier（标签协议标识符），2Byte，表示帧类型，取值为0x8100时表示IEEE 802.1Q的VLAN数据帧。如果不支持 802.1Q的设备收到这样的帧，会将其丢弃，各设备厂商可以自定义该字段的值。当邻居设备将TPID值配置为非0x8100时， 为了能够识别这样的报文，实现互通，必须在本设备上修改TPID值，确保和邻居设备的TPID值配置一致</p>
<p>PRI：Priority，3bit，表示数据帧的802.1p（是IEEE 802.1Q的扩展协议）优先级。取值范围为0～7，值越大优先级越高。当网络阻塞时，交换机优先发送优先级高的数据帧 </p>
<p>CFI：Canonical Format Indicator（标准格式指示位），1bit,表示MAC地址在不同的传输介质中是否以标准格式进行封装，用于兼容以太网和令牌环网。CFI取值为0表示MAC地址以标准格式进行封装，为1表示以非标准格式封装。在以太网中，CFI的值为0</p>
<p>VID：VLAN ID，12bit，表示该数据帧所属VLAN的编号。VLAN ID取值范围是0～4095。由于0和4095为协议保留取值，所以VLAN ID的有效取值范围是1～4094</p>
<h2 id="分层的网络架构"><a href="#分层的网络架构" class="headerlink" title="分层的网络架构"></a>分层的网络架构</h2><p><img src="../../../../images/image/SRE/day10/39.png" alt="39"></p>
<p>架构一</p>
<p><img src="../../../../images/image/SRE/day10/40.png" alt="40"></p>
<p>架构二</p>
<p><img src="../../../../images/image/SRE/day10/41.png" alt="41"></p>
<p>架构三</p>
<p><img src="../../../../images/image/SRE/day10/42.png" alt="42"></p>
<h1 id="TCP-IP-协议栈"><a href="#TCP-IP-协议栈" class="headerlink" title="TCP/IP 协议栈"></a>TCP/IP 协议栈</h1><h2 id="TCP-IP-标准"><a href="#TCP-IP-标准" class="headerlink" title="TCP/IP 标准"></a>TCP/IP 标准</h2><h3 id="TCP-IP-介绍"><a href="#TCP-IP-介绍" class="headerlink" title="TCP/IP 介绍"></a>TCP/IP 介绍</h3><p>Transmission Control Protocol/Internet Protocol 传输控制协议/因特网互联协议</p>
<p>TCP/IP是一个Protocol Stack，包括TCP、IP、UDP、ICMP、RIP、TELNET、FTP、SMTP、ARP等许多协议</p>
<p>最早发源于1969年美国国防部（缩写为DoD）的因特网的前身ARPA网络项目，1983年1月1日，TCP/IP取代了旧的网络控制协议NCP，成为今天的互联网和局域网的基石和标准,由互联网工程任务组负责维护 </p>
<p>国防高级研究计划局DARPA与BBN技术公司、斯坦福大学和伦敦大学学院签约，在多个硬件平台上开发协议的操作版本。 在协议开发过程中，数据包路由层的版本号从版本 1 进展到版本 4，后者于 1983 年安装在 ARPA NET 中。它被称为互联网协议版本4（IPv4）作为协议，仍在互联网使用，连同其目前的继承，互联网协议版本6（IPv6）。</p>
<p>RFC 文档： <a target="_blank" rel="noopener" href="https://www.ietf.org/rfc/rfc1180.html">https://www.ietf.org/rfc/rfc1180.html</a></p>
<p>RFC ( Request For Comments ) </p>
<p>RFC文档也称请求审议文档（Requests for Comments，RFC），是一系列不断修改和完善的报告、协议提案和协议标准，是用于发布 Internet 标准的一种网络文件或工作报告。 </p>
<p>RFC 是由互联网工程任务组（IETF）维护，由互联网协会(ISOC)赞助发行</p>
<h3 id="TCP-IP-分层"><a href="#TCP-IP-分层" class="headerlink" title="TCP/IP 分层"></a>TCP/IP 分层</h3><p>共定义了四层，和OSI参考模型的分层有对应关系</p>
<p>RFC文档: <a target="_blank" rel="noopener" href="https://www.ietf.org/rfc/rfc1122#section-1.3.3">https://www.ietf.org/rfc/rfc1122#section-1.3.3</a></p>
<p>RFC官方分为四层:</p>
<ul>
<li>Application Layer</li>
<li>Transport Layer</li>
<li>Internet Layer、</li>
<li>Link Layer(media-access)</li>
</ul>
<p><img src="../../../../images/image/SRE/day10/43.png" alt="43"></p>
<p><img src="../../../../images/image/SRE/day10/44.png" alt="44"></p>
<p><strong>TCP/IP 应用层</strong></p>
<p><img src="../../../../images/image/SRE/day10/45.png" alt="45"></p>
<h3 id="TCP-IP-通信过程"><a href="#TCP-IP-通信过程" class="headerlink" title="TCP/IP 通信过程"></a>TCP/IP 通信过程</h3><p><img src="../../../../images/image/SRE/day10/46.png" alt="46"></p>
<h3 id="TCP-IP和OSI模型的比较"><a href="#TCP-IP和OSI模型的比较" class="headerlink" title="TCP/IP和OSI模型的比较"></a>TCP/IP和OSI模型的比较</h3><p>相同点</p>
<ul>
<li>两者都是以协议栈的概念为基础</li>
<li>协议栈中的协议彼此相互独立</li>
<li>下层对上层提供服务</li>
</ul>
<p>不同点</p>
<ul>
<li>OSI是先有模型；TCP/IP是先有协议，后有模型</li>
<li>OSI是国际标准，适用于各种协议栈；TCP/IP实际标准，只适用于TCP/IP网络</li>
<li>层次数量不同</li>
</ul>
<h2 id="transport-层"><a href="#transport-层" class="headerlink" title="transport 层"></a>transport 层</h2><p><img src="../../../../images/image/SRE/day10/47.png" alt="47"></p>
<p><strong>TCP和UDP对比</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>tcp</th>
<th>udp</th>
</tr>
</thead>
<tbody><tr>
<td>是否连接</td>
<td>面向连接</td>
<td>无连接</td>
</tr>
<tr>
<td>是否是可靠传输</td>
<td>可靠传输</td>
<td>不可靠传输</td>
</tr>
<tr>
<td>连接目标个数</td>
<td>一对一</td>
<td>支持一对一，一对多，多对一，多对多传输</td>
</tr>
<tr>
<td>是否有序</td>
<td>有序传输</td>
<td>无序传输</td>
</tr>
<tr>
<td>首部大小</td>
<td>首部最少20字节，最大60字节</td>
<td>首部8字节</td>
</tr>
<tr>
<td>传输方式</td>
<td>面向字节流</td>
<td>面向报文</td>
</tr>
<tr>
<td>常见应用</td>
<td>邮件服务，文件下载，网站浏览等</td>
<td>语音聊天，视频聊天等</td>
</tr>
</tbody></table>
<p><img src="../../../../images/image/SRE/day10/48.png" alt="48"></p>
<p><img src="../../../../images/image/SRE/day10/49.png" alt="49"></p>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p>TCP：传输控制制协议 ( Transmission Control Protocol )</p>
<h4 id="TCP特性"><a href="#TCP特性" class="headerlink" title="TCP特性"></a>TCP特性</h4><ul>
<li>工作在传输层</li>
<li>面向连接协议</li>
<li>全双工协议</li>
<li>半关闭</li>
<li>将数据打包成段，排序</li>
<li>确认机制</li>
<li>数据恢复，重传</li>
<li>错误检查</li>
<li>流量控制，滑动窗口</li>
<li>拥塞控制，慢启动和拥塞避免算法</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">更多关于tcp的内核参数，可参看 man 7 tcp</span><br></pre></td></tr></table></figure>

<h4 id="TCP包头结构"><a href="#TCP包头结构" class="headerlink" title="TCP包头结构"></a>TCP包头结构</h4><p><img src="../../../../images/image/SRE/day10/50.png" alt="50"></p>
<ul>
<li>源端口、目标端口：计算机上的进程要和其他进程通信是要通过计算机端口的，而一个计算机端口某个时刻只能被一个进程占用，所以通过指定源端口和目标端口，就可以知道是哪两个进程需要通信。源端口、目标端口是用16位表示的，可推算计算机的端口个数为 2^16个,即65536</li>
<li>序列号：表示本报文段所发送数据的第一个字节的编号。在TCP连接中所传送的字节流的每一个字节都会按顺序编号。由于序列号由32位表示，所以每2^32个字节，就会出现序列号回绕，再次从 0 开始</li>
<li>确认号：表示接收方期望收到发送方下一个报文段的第一个字节数据的编号。也就是告诉发送方：我希望你（指发送方）下次发送的数据的第一个字节数据的编号为此确认号</li>
<li>数据偏移：表示TCP报文段的首部长度，共4位，由于TCP首部包含一个长度可变的选项部分，需要指定这个TCP报文段到底有多长。它指出 TCP 报文段的数据起始处距离 TCP 报文段的起始处有多远。该字段的单位是32位(即4个字节为计算单位），4位二进制最大表示15，所以数据偏移也就是TCP首部最大60字节</li>
<li>URG：表示本报文段中发送的数据是否包含紧急数据。后面的紧急指针字段（urgent pointer）只有当URG=1时才有效</li>
<li>ACK：表示是否前面确认号字段是否有效。只有当ACK=1时，前面的确认号字段才有效。TCP规定，连接建立后，ACK必须为1,带ACK 标志的TCP报文段称为确认报文段 </li>
<li>PSH：提示接收端应用程序应该立即从TCP接收缓冲区中读走数据，为接收后续数据腾出空间。如果为1，则表示对方应当立即把数据提交给上层应用，而不是缓存起来，如果应用程序不将接收到的数据读走，就会一直停留在TCP接收缓冲区中</li>
<li>RST：如果收到一个RST=1的报文，说明与主机的连接出现了严重错误（如主机崩溃），必须释放连接，然后再重新建立连接。或者说明上次发送给主机的数据有问题，主机拒绝响应，带RST标志的TCP报文段称为复位报文段</li>
<li>SYN：在建立连接时使用，用来同步序号。当SYN=1，ACK=0时，表示这是一个请求建立连接的报文段；当SYN=1，ACK=1时，表示对方同意建立连接。SYN=1，说明这是一个请求建立连接或同意建立连接的报文。只有在前两次握手中SYN才置为1，带SYN标志的TCP报文段称为同步报文段 </li>
<li>FIN：表示通知对方本端要关闭连接了，标记数据是否发送完毕。如果FIN=1，即告诉对方：“我的数据已经发送完毕，你可以释放连接了”，带FIN标志的TCP报文段称为结束报文段</li>
<li>窗口大小：表示现在允许对方发送的数据量，也就是告诉对方，从本报文段的确认号开始允许对方发送的数据量，达到此值，需要ACK 确认后才能再继续传送后面数据，由Window size value * Window size scaling factor（此值在三次握手阶段TCP选项Window scale协商得到）得出此值 </li>
<li>校验和：提供额外的可靠性</li>
<li>紧急指针：标记紧急数据在数据字段中的位置</li>
<li>选项部分：其最大长度可根据TCP首部长度进行推算。TCP首部长度用4位表示，选项部分最长为：(2^4-1)*4-20=40字节</li>
</ul>
<p><strong>TCP包头常见选项</strong></p>
<ul>
<li><p>最大报文字段长度MSS（Maximum Segment Size）</p>
<p>​        通常1460字节</p>
<p>​        指明自己期望对方发送TCP报文段时那个数据字段的长度。比如：1460字节。数据字段的长度加上TCP首部的长度才等于整个TC报文段的长度。MSS不宜设的太大也不宜设的太小。若选择太小，极端情况下，TCP报文段只含有1字节数据，在IP层传输的数据报的 开销至少有40字节（包括TCP报文段的首部和IP数据报的首部）这样，网络的利用率就不会超过1/41。若TCP报文段非常长，那么 在IP层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短数据报片装配成原来的TCP报文段。当传输出错时还要进行重传， 这些也都会使开销增大。因此MSS应尽可能大，只要在IP层传输时不需要再分片就行。在连接建立过程中，双方都把自 己能够支持的MSS写入这一字段，MSS只出现在SYN报文中。即：MSS出现在SYN=1的报文段中MTU和MSS值的关系</p>
<p>​        MTU=MSS+IP Header+TCP Header，通信双方最终的MSS值=较小MTU-IP Header-TCP Header</p>
</li>
<li><p>窗口扩大 Window Scale</p>
<p>​        为了扩大窗口，由于TCP首部的窗口大小字段长度是16位，所以其表示的最大数是65535。但是随着时延和带宽比较大的通信产生（如卫星通信），需要更大的窗口来满足性能和吞吐率，所以产生了这个窗口扩大选项。</p>
</li>
<li><p>时间戳 Timestamps</p>
<p>​        可以用来计算RTT(往返时间)，发送方发送TCP报文时，把当前的时间值放入时间戳字段，接收方收到后发送确认报文时，把这个时间戳字段的值复制到确认报文中，当发送方收到确认报文后即可计算出RTT。也可以用来防止回绕序号PAWS，也可以说可以用来 区分相同序列号的不同报文。因为序列号用32为表示，每2^32个序列号就会产生回绕，那么使用时间戳字段就很容易区分相同序列号的不 同报文</p>
</li>
</ul>
<h4 id="TCP协议PORT"><a href="#TCP协议PORT" class="headerlink" title="TCP协议PORT"></a>TCP协议PORT</h4><p><img src="../../../../images/image/SRE/day10/51.png" alt="51"></p>
<p>传输层通过port号，确定应用层协议，范围0-65535</p>
<p>维基百科：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers">https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a></p>
<p>IANA互联网数字分配机构负责域名，数字资源，协议分配</p>
<ul>
<li><p>0-1023：</p>
<p>​        系统端口或特权端口(仅管理员可用) ，众所周知，永久的分配给固定的系统应用使用，</p>
<p>​        22/tcp(ssh), 80/tcp(http), 443/tcp(https)</p>
</li>
<li><p>1024-49151：</p>
<p>​        用户端口或注册端口，但要求并不严格，分配给程序注册为某应用使用，</p>
<p>​        1433/tcp(SqlServer),1521/tcp(oracle),3306/tcp(mysql),11211/tcp/udp (memcached)</p>
</li>
<li><p>49152-65535：</p>
<p>​        动态或私有端口，客户端随机使用端口，范围定义：/proc/sys/net/ipv4/ip_local_port_range</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常用服务及端口对应关系</span></span><br><span class="line"><span class="built_in">cat</span> /etc/services</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看非特权用户可以使用起始端口</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/net/ipv4/ip_unprivileged_port_start</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看客户端动态端口起始</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/net/ipv4/ip_local_port_range</span><br></pre></td></tr></table></figure>

<p>模拟tcp连接过程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nc</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有己处于监听状态的tcp端口 t:tcp, l:listen, n:numeric</span></span><br><span class="line">ss  -tnl</span><br><span class="line"></span><br><span class="line"><span class="comment">#在22 己被使用的情况下，用nc 监听22失败</span></span><br><span class="line">[root@localhost ~]<span class="variable">$nc</span> -l 22</span><br><span class="line">Ncat: <span class="built_in">bind</span> to :::22: Address already <span class="keyword">in</span> use. QUITTING.</span><br><span class="line"></span><br><span class="line"><span class="comment">#用nc 监本机 222</span></span><br><span class="line">[root@localhost ~]<span class="variable">$nc</span> -l 222</span><br><span class="line"></span><br><span class="line"><span class="comment">#用远程主机连接本机222</span></span><br><span class="line">[root@localhost ~]<span class="variable">$nc</span> 172.16.1.50 222</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看本机tcp 连接状态，能看到有一个远程主机通过222连接本机</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ss -tn</span></span><br><span class="line">State         Recv-Q     Send-Q         Local Address:Port           Peer Address:Port     Process     </span><br><span class="line">ESTAB          0          0                172.16.1.50:22             172.16.1.153:51447                 </span><br><span class="line">ESTAB          0          0                172.16.1.50:22             172.16.1.153:51449                 </span><br><span class="line">CLOSE-WAIT     32         0                172.16.1.50:48384            8.43.85.14:443                   </span><br><span class="line">ESTAB          0          0                172.16.1.50:22             172.16.1.153:51517                 </span><br><span class="line">ESTAB          0          0                172.16.1.50:222             172.16.1.49:52294 </span><br></pre></td></tr></table></figure>

<p>验证只有root 才能开启超级端口</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># su jose</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#222端口在1023以内，无权限</span></span><br><span class="line">[jose@localhost root]$ nc -l 222</span><br><span class="line">Ncat: <span class="built_in">bind</span> to :::222: Permission denied. QUITTING.</span><br><span class="line"></span><br><span class="line"><span class="comment">#2222可以</span></span><br><span class="line">[jose@localhost root]$ nc -l 2222</span><br></pre></td></tr></table></figure>

<p><strong>TCP端口号通信过程</strong></p>
<p><img src="../../../../images/image/SRE/day10/52.png" alt="52"></p>
<p><strong>TCP序号和确认号</strong></p>
<p><img src="../../../../images/image/SRE/day10/53.png" alt="53"></p>
<p><strong>TCP确认和固定窗口</strong></p>
<p><img src="../../../../images/image/SRE/day10/54.png" alt="54"></p>
<p><img src="../../../../images/image/SRE/day10/55.png" alt="55"></p>
<p><strong>TCP滑动窗口</strong></p>
<p><img src="../../../../images/image/SRE/day10/56.png" alt="56"></p>
<h4 id="三次握手和四次挥手"><a href="#三次握手和四次挥手" class="headerlink" title="三次握手和四次挥手"></a>三次握手和四次挥手</h4><p><strong>建立连接</strong></p>
<p><img src="../../../../images/image/SRE/day10/57.png" alt="57"></p>
<p><strong>TCP三次握手</strong></p>
<p>seq 序号; ack 确认号</p>
<p><img src="../../../../images/image/SRE/day10/58.png" alt="58"></p>
<p>抓包规则</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#157客户端，158服务端，通过ssh去连接</span></span><br><span class="line"> (ip.src==10.0.0.157 and ip.dst==10.0.0.158 ) or (ip.src== 10.0.0.158 and ip.dst==10.0.0.157)</span><br></pre></td></tr></table></figure>

<p>获取客户端 SYN-SENT 瞬间状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#158 作服务端，丢弃157的数据包</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># iptables -A INPUT -s 10.0.0.157 -j DROP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#157 开始连接，并查看状态</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ssh root@10.0.0.158</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#157查看状态</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ss -tna | grep SYN-SENT</span></span><br><span class="line">SYN-SENT   0      1         10.0.0.157:44326   10.0.0.158:22 </span><br></pre></td></tr></table></figure>

<p>清除防火墙规则</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># iptables -F</span></span><br></pre></td></tr></table></figure>

<p>获取服务端 SYN-RCVD 瞬间状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端开启防火墙，抛弃服务端的包，并发起连接</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># iptables -A INPUT -s 10.0.0.158 -j DROP</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ssh root@10.0.0.158</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ss -tna | grep SYN-RECV</span></span><br><span class="line">SYN-RECV   0      0         10.0.0.158:22      10.0.0.157:44328</span><br></pre></td></tr></table></figure>

<p><strong>TCP四次挥手</strong></p>
<p>MSL :Maximum Segment Lifetime</p>
<p><img src="../../../../images/image/SRE/day10/59.png" alt="59"></p>
<p>查看 MSL</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sysctl net.ipv4.tcp_fin_timeout</span></span><br><span class="line">net.ipv4.tcp_fin_timeout = 60</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_fin_timeout</span></span><br><span class="line">60</span><br></pre></td></tr></table></figure>

<h4 id="有限状态机-FSM"><a href="#有限状态机-FSM" class="headerlink" title="有限状态机 FSM"></a>有限状态机 FSM</h4><p>FSM:Finite State Machine</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># man 8 netstat</span></span><br><span class="line">ESTABLISHED</span><br><span class="line">       The socket has an established connection.</span><br><span class="line">SYN_SENT</span><br><span class="line">       The socket is actively attempting to establish a connection.</span><br><span class="line">SYN_RECV</span><br><span class="line">       A connection request has been received from the network.</span><br><span class="line">FIN_WAIT1</span><br><span class="line">       The socket is closed, and the connection is shutting down.</span><br><span class="line">FIN_WAIT2</span><br><span class="line">       Connection is closed, and the socket is waiting <span class="keyword">for</span> a shutdown from the remote end.</span><br><span class="line">TIME_WAIT</span><br><span class="line">       The socket is waiting after close to handle packets still <span class="keyword">in</span> the network.</span><br><span class="line">CLOSE The socket is not being used.</span><br><span class="line">CLOSE_WAIT</span><br><span class="line">       The remote end has shut down, waiting <span class="keyword">for</span> the socket to close.</span><br><span class="line">LAST_ACK</span><br><span class="line">       The remote end has shut down, and the socket is closed. Waiting <span class="keyword">for</span> acknowledgement.</span><br><span class="line">LISTEN The socket is listening <span class="keyword">for</span> incoming connections. Such sockets are not included <span class="keyword">in</span> the output </span><br><span class="line">unless you specify the --listening (-l) or --all (-a)</span><br><span class="line">       option.</span><br><span class="line">CLOSING</span><br><span class="line">       Both sockets are shut down but we still don<span class="string">&#x27;t have all our data sent.</span></span><br><span class="line"><span class="string">UNKNOWN</span></span><br><span class="line"><span class="string">       The state of the socket is unknown.</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/image/SRE/day10/60.png" alt="60"></p>
<p>TCP 状态转换图（也称作有限状态机）。箭头表示因报文传输、接收以及计时器超时而引发的状态转换。粗箭头表示典型的客户端行为，虚线箭头表示典型的服务器行为。粗体指令（例如open、close）是应用程序执行的操作</p>
<p><strong>虚线：服务器 实线：客户端</strong></p>
<p><img src="../../../../images/image/SRE/day10/61.png" alt="61"></p>
<p>状态标识与说明</p>
<p><img src="../../../../images/image/SRE/day10/62.png" alt="62"></p>
<p>客户端先发送一个FIN给服务端，自己进入FIN_WAIT_1状态，这时等待接收服务端报文，该报文会有三种可能</p>
<ul>
<li><p>只有服务端的ACK</p>
<p>​        只收到服务器的ACK，客户端会进入FIN_WAIT_2状态，后续当收到服务端的FIN时，回应发送一个ACK，会进入到TIME_WAIT状 态，这个状态会持续2MSL(TCP报文段在网络中的最大生存时间, RFC 1122标准的建议值是2min).客户端等待2MSL，是为了当最 后一个ACK丢失时可以再发送一次。因为服务端在等待超时后会再发送一个FIN给客户端，进而客户端知道ACK已丢失</p>
</li>
<li><p>只有服务端的FIN</p>
<p>​        只有服务端的FIN时，回应一个ACK给服务端，进入CLOSING状态，然后接收到服务端的ACK时，进入TIME_WAIT状态</p>
</li>
<li><p>基于服务端的ACK，又有FIN</p>
<p>​        同时收到服务端的ACK和FIN，直接进入TIME_WAIT状态</p>
</li>
</ul>
<p><strong>客户端的典型状态转移</strong></p>
<p>客户端通过connect系统调用主动与服务器建立连接connect系统调用首先给服务器发送一个同步报文段，使连接转移到SYN_SENT状态</p>
<p>此后connect系统调用可能因为如下两个原因失败返回：</p>
<p>1、如果connect连接的目标端口不存在（未被任何进程监听），或者该端口仍被处于TIME_WAIT状态的连接所占用，则服务器将给客户端发送一个复位报文段，connect调用失败。</p>
<p>2、如果目标端口存在，但connect在超时时间内未收到服务器的确认报文段，则connect调用失败。connect调用失败将使连接立即返回到初始的CLOSED状态。如果客户端成功收到服务器的同步报文段和确认，则connect调用成功返回，连接转移至ESTABLISHED状态当客户端执行主动关闭时，它将向服务器发送一个结束报文段，同时连接进入FIN_WAIT_1状态。若此时客户端收到服务器专门用于确认目的的确认报文段，则连接转移至FIN_WAIT_2状态。当客户端处于FIN_WAIT_2状态时，服务器处于CLOSE_WAIT状态，这一对状态是可能发生半关闭的状态。此时如果服务器也关闭连接（发送结束报文段），则客户端将给予确认并进入TIME_WAIT状态客户端从FIN_WAIT_1状态可能直接进入 TIME_WAIT 状态（不经过FIN_WAIT_2状态），前提是处于FIN_WAIT_1状态的服务器直接收到带确认信息的结束报文段（而不是先收到确认报文段，再收到结束报文段） </p>
<p>处于FIN_WAIT_2状态的客户端需要等待服务器发送结束报文段，才能转移至TIME_WAIT状态，否则它将一直停留在这个状态。如果不是为了在半关闭状态下继续接收数据，连接长时间地停留在FIN_WAIT_2状态并无益处。连接停留在FIN_WAIT_2状态的情况可能发生在：客户端执行半关闭后，未等服务器关闭连接就强行退出了。此时客户端连接由内核来接管，可称之为孤儿连接（和孤儿进程类似） </p>
<p>Linux为了防止孤儿连接长时间存留在内核中，定义了两个内核参数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定内核能接管的孤儿连接数目</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_max_orphans</span></span><br><span class="line">4096</span><br><span class="line"></span><br><span class="line"> <span class="comment">#指定孤儿连接在内核中生存的时间</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_fin_timeout</span></span><br><span class="line">60</span><br></pre></td></tr></table></figure>

<h4 id="sync半连接和accept全连接队列"><a href="#sync半连接和accept全连接队列" class="headerlink" title="sync半连接和accept全连接队列"></a>sync半连接和accept全连接队列</h4><p><img src="../../../../images/image/SRE/day10/63.png" alt="63"></p>
<p>半连接：还没有完成3次握手的连接</p>
<p>全连接：己经完成三次握手，但没有被应用层提走的连接</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#未完成连接队列大小，默认值128,建议调整大小为1024以上</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_max_syn_backlog</span></span><br><span class="line">128</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改方法</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog=1024</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存</span></span><br><span class="line">[root@localhost ~]<span class="comment"># sysctl -p</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#完成连接队列大小，默认值128,建议调整大小为1024以上</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/core/somaxconn</span></span><br><span class="line">128</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改方法同上</span></span><br></pre></td></tr></table></figure>

<p>注意，监听的 Socket 和真正用来传数据的 Socket 是两个：</p>
<ul>
<li>一个叫作监听 Socket；</li>
<li>一个叫作已连接 Socket</li>
</ul>
<p>C/S 网络通信过程</p>
<p><img src="../../../../images/image/SRE/day10/64.png" alt="64"></p>
<p><img src="../../../../images/image/SRE/day10/65.png" alt="65"></p>
<h4 id="TCP超时重传"><a href="#TCP超时重传" class="headerlink" title="TCP超时重传"></a>TCP超时重传</h4><p>异常网络状况下（开始出现超时或丢包），TCP控制数据传输以保证其承诺的可靠服务TCP服务必须能够重传超时时间内未收到确认的TCP报文段。为此，TCP模块为每个TCP报文段都维护一个重传定时器，该定时器在TCP报文段第一次被发送时启动。如果超时时间内未收到接收方的应答，TCP模块将重传TCP报文段并重置定时器。至于下次重传的超时时间如何选择，以及最多执行多少次重传，就是TCP的重传策略与TCP超时重传相关的两个内核参数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定在底层IP接管之前TCP最少执行的重传次数，默认值是</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_retries1</span></span><br><span class="line">3</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定连接放弃前TCP最多可以执行的重传次数，默认值15 （一般对应13～30min）</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_retries2</span></span><br><span class="line">15</span><br></pre></td></tr></table></figure>

<h4 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h4><p>网络中的带宽、交换结点中的缓存和处理机等，都是网络的资源。在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可承受的能力，网络的性能就会变坏。此情况称为拥塞</p>
<p>TCP为提高网络利用率，降低丢包率，并保证网络资源对每条数据流的公平性。即所谓的拥塞控制TCP拥塞控制的标准文档是RFC 5681，其中详细介绍了拥塞控制的四个部分：慢启动（slow start）、拥塞避免（congestion avoidance）、快速重传（fast retransmit）和快速恢复（fast recovery）</p>
<p>拥塞控制算法在Linux下有多种实现，比如reno算法、vegas算法和cubic算法等。它们或者部分或者全部实现了上述四个部分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前所使用的拥塞控制算法</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/tcp_congestion_control</span></span><br><span class="line">cubic</span><br></pre></td></tr></table></figure>

<h4 id="内核TCP参数优化"><a href="#内核TCP参数优化" class="headerlink" title="内核TCP参数优化"></a>内核TCP参数优化</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">net.ipv4.tcp_fin_timeout = 2</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line">net.ipv4.ip_local_port_range = 2000 65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line">net.ipv4.route.gc_timeout = 100</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_max_orphans = 16384</span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line">net.core.netdev_max_backlog = 16384</span><br></pre></td></tr></table></figure>

<p>作用说明： </p>
<ul>
<li>net.ipv4.tcp_fin_timeout 表示套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间，默认值是60秒。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_fin_timeout 60</li>
<li>net.ipv4.tcp_tw_reuse 表示开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接，默认值为0，表示关闭。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_tw_reuse 0 </li>
<li>net.ipv4.tcp_tw_recycle 表示开启TCP连接中TIME-WAIT sockets的快速回收。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_tw_recycle，默认为0，表示关闭。 提示：reuse和recycle这两个参数是为防止生产环境下服务器time_wait网络状态数量过多设置的。</li>
<li>net.ipv4.tcp_syncookies 表示开启SYN Cookies功能。当出现SYN等待队列溢出时，启用Cookies来处理，可防范少量SYN攻击，这个参数也可以不添加。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_syncookies,默认值为1</li>
<li>net.ipv4.tcp_keepalive_time 表示当keepalive启用时，TCP发送keepalive消息的频度。默认是2小时，建议改为10分钟。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_keepalive_time,默认为7200秒。</li>
<li>net.ipv4.ip_local_port_range 该选项用来设定允许系统打开的端口范围，即用于向外连接的端口范围。 该参数对应系统路径为：/proc/sys/net/ipv4/ip_local_port_range 32768 61000 </li>
<li>net.ipv4.tcp_max_syn_backlog 表示SYN队列的长度，即半连接队列长度，默认为1024，建议加大队列的长度为8192或更多，这样可以容纳更多等待连接的网络连接数。 该参数为服务器端用于记录那些尚未收到客户端确认信息的连接请求最大值。 该参数对象系统路径为：/proc/sys/net/ipv4/tcp_max_syn_backlog</li>
<li>net.ipv4.tcp_max_tw_buckets 表示系统同时保持TIME_WAIT套接字的最大数量，如果超过这个数值，TIME_WAIT套接字将立刻被清除并打印警告信息。 默认为180000，对于Apache、Nginx等服务器来说可以将其调低一点，如改为5000~30000，不通业务的服务器也可以给大一点，比如LVS、Squid。 此项参数可以控制TIME_WAIT套接字的最大数量，避免Squid服务器被大量的TIME_WAIT套接字拖死。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_max_tw_buckets</li>
<li>net.ipv4.tcp_synack_retries 参数的值决定了内核放弃连接之前发送SYN+ACK包的数量。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_synack_retries,默认值为5 </li>
<li>net.ipv4.tcp_syn_retries 表示在内核放弃建立连接之前发送SYN包的数量。 该参数对应系统路为：/proc/sys/net/ipv4/tcp_syn_retries,默认值为6 </li>
<li>net.ipv4.tcp_max_orphans 用于设定系统中最多有多少个TCP套接字不被关联到任何一个用户文件句柄上。 如果超过这个数值，孤立连接将被立即被复位并打印出警告信息。 这个限制只有为了防止简单的DoS攻击。不能过分依靠这个限制甚至认为减少这个值，更多的情况是增加这个值。 该参数对应系统路径为：/proc/sys/net/ipv4/tcp_max_orphans ，默认值8192 </li>
<li>net.core.somaxconn 同时发起的TCP的最大连接数，即全连接队列长度，在高并发请求中，可能会导致链接超时或重传，一般结合并发请求数来调大此值。 该参数对应系统路径为：/proc/sys/net/core/somaxconn ，默认值是128</li>
<li>net.core.netdev_max_backlog 表示当每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许发送到队列的数据包最大数。 该参数对应系统路径为：/proc/sys/net/core/netdev_max_backlog，默认值为1000</li>
</ul>
<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p>UPD：用户数据报协议 ( User Datagram Protocol )</p>
<h4 id="UDP特性"><a href="#UDP特性" class="headerlink" title="UDP特性"></a>UDP特性</h4><ul>
<li>工作在传输层</li>
<li>提供不可靠的网络访问</li>
<li>非面向连接协议</li>
<li>有限的错误检查</li>
<li>传输性能高</li>
<li>无数据恢复特性</li>
</ul>
<p>更多关于udp的内核参数，可参看man 7 udp</p>
<h4 id="UDP包头"><a href="#UDP包头" class="headerlink" title="UDP包头"></a>UDP包头</h4><p><img src="../../../../images/image/SRE/day10/66.png" alt="66"></p>
<h2 id="Internet层"><a href="#Internet层" class="headerlink" title="Internet层"></a>Internet层</h2><p><img src="../../../../images/image/SRE/day10/67.png" alt="67"></p>
<h3 id="Internet-Control-Message-Protocol"><a href="#Internet-Control-Message-Protocol" class="headerlink" title="Internet Control Message Protocol"></a>Internet Control Message Protocol</h3><p><img src="../../../../images/image/SRE/day10/68.png" alt="68"></p>
<p>利用icmp协议判断网络状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># ping 223.5.5.5</span></span><br><span class="line">PING 223.5.5.5 (223.5.5.5) 56(84) bytes of data.</span><br><span class="line">64 bytes from 223.5.5.5: icmp_seq=1 ttl=128 time=8.89 ms</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">^C</span><br><span class="line">--- 223.5.5.5 ping statistics ---</span><br><span class="line">9 packets transmitted, 9 received, 0% packet loss, time 8013ms</span><br><span class="line">rtt min/avg/max/mdev = 7.519/9.380/10.706/0.849 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ping 114.114.114.114</span></span><br><span class="line">PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data.</span><br><span class="line">64 bytes from 114.114.114.114: icmp_seq=1 ttl=128 time=27.8 ms</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">^C</span><br><span class="line">--- 114.114.114.114 ping statistics ---</span><br><span class="line">7 packets transmitted, 7 received, 0% packet loss, time 6011ms</span><br><span class="line">rtt min/avg/max/mdev = 24.924/29.033/38.125/3.918 ms</span><br></pre></td></tr></table></figure>

<p>发大数据包</p>
<p>多台设备同时去ping一台设备，理论上来讲，可以将该设备网卡打满，这也是ddos攻击的一种</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># ping -f -s 65508 10.0.0.100</span></span><br><span class="line">Error: packet size 65508 is too large. Maximum is 65507</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ping -f -s 65507 10.0.0.100</span></span><br><span class="line">PING 10.0.0.100 (10.0.0.100) 65507(65535) bytes of data.</span><br><span class="line">..........................................................</span><br><span class="line"></span><br><span class="line"><span class="comment">#实时刷新网卡数据</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># watch ifconfig ens160</span></span><br></pre></td></tr></table></figure>

<h3 id="Address-Resolution-Protocol"><a href="#Address-Resolution-Protocol" class="headerlink" title="Address Resolution Protocol"></a>Address Resolution Protocol</h3><h4 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h4><p>ARP地址解析协议由互联网工程任务组(IETF)在1982年11月发布的RFC 826中描述制定，是根据IP地址获取物理地址的一个TCP/IP协议。 </p>
<p>主机发送信息时将包含目标IP地址的ARP请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。地址解析协议是建立在网络中各个主机互相信任的基础上的，局域网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存。</p>
<p>同网段的ARP</p>
<p><img src="../../../../images/image/SRE/day10/69.png" alt="69"></p>
<p>跨网段的ARP</p>
<p><img src="../../../../images/image/SRE/day10/70.png" alt="70"></p>
<p>查看ARP缓存</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#win</span></span><br><span class="line">arp -a</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># arp -n</span></span><br><span class="line">Address                 HWtype HWaddress           Flags Mask           Iface</span><br><span class="line">172.16.1.49              ether   00:0c:29:a2:a3:21   C                     ens160</span><br><span class="line">172.16.1.254             ether   00:51:92:41:87:03   C                     ens160</span><br><span class="line">172.16.1.153             ether   88:66:5a:41:35:5b   C                     ens160</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ip neigh</span></span><br><span class="line">172.16.1.49 dev ens160 lladdr 00:0c:29:a2:a3:21 STALE</span><br><span class="line">172.16.1.254 dev ens160 lladdr 00:51:92:41:87:03 REACHABLE</span><br><span class="line">172.16.1.153 dev ens160 lladdr 88:66:5a:41:35:5b DELAY</span><br></pre></td></tr></table></figure>

<p>ARP静态绑定可以防止ARP欺骗</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># arp -s 10.0.0.6 00:0c:29:32:80:38</span></span><br><span class="line">[root@localhost ~]<span class="comment"># arp -n</span></span><br><span class="line">Address                 HWtype HWaddress           Flags Mask           Iface</span><br><span class="line">10.0.0.6                 ether   00:0c:29:32:80:38   CM                 eth0</span><br><span class="line">10.0.0.7                 ether   00:0c:29:32:80:38   C                  eth0</span><br><span class="line">10.0.0.1                 ether   00:50:56:c0:00:08   C                  eth0</span><br></pre></td></tr></table></figure>

<p>kali 系统实现 arp 欺骗上网流量劫持</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动路由转发功能</span></span><br><span class="line">[root@kali ~]<span class="comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装包</span></span><br><span class="line">[root@kali ~]<span class="comment"># apt-get install dsniff</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#欺骗目标主机，本机是网关</span></span><br><span class="line">[root@kali ~]<span class="comment"># arpspoof -i eth0 -t 被劫持的目标主机IP 网关IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#欺骗网关，本机是目标主机</span></span><br><span class="line">[root@kali ~]<span class="comment"># arpspoof -i eth0 -t 网关IP 被劫持的目标主机IP</span></span><br></pre></td></tr></table></figure>

<p>kali 是一个linux 发行版，里面集成了大量工具</p>
<p>官网 ： <a target="_blank" rel="noopener" href="https://www.kali.org/">https://www.kali.org/</a></p>
<h4 id="Gratuitous-ARP"><a href="#Gratuitous-ARP" class="headerlink" title="Gratuitous ARP"></a>Gratuitous ARP</h4><p>Gratuitous ARP也称为免费ARP，无故ARP。Gratuitous ARP 不同于一般的ARP请求，它并非期待得到ip对应的mac地址，而是当主机启动的时候，将发送一个Gratuitous arp请求，即请求自己的ip地址的mac地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># ip a a 10.0.0.159/24</span></span><br></pre></td></tr></table></figure>

<p>免费ARP可以有两个方面的作用： </p>
<ul>
<li>验证IP是否冲突：一个主机可以通过它来确定另一个主机是否设置了相同的 IP地址</li>
<li>更换物理网卡：如果发送ARP的主机正好改变了物理地址(如更换物理网卡)，可以使用此方法通知网络中其它主机及时更新ARP缓存</li>
</ul>
<h3 id="Reverse-Address-Resolution-Protocol"><a href="#Reverse-Address-Resolution-Protocol" class="headerlink" title="Reverse Address Resolution Protocol"></a>Reverse Address Resolution Protocol</h3><p>RARP 反向ARP，即将MAC转换成IP</p>
<p><img src="../../../../images/image/SRE/day10/71.png" alt="71"></p>
<h3 id="internet-协议"><a href="#internet-协议" class="headerlink" title="internet 协议"></a>internet 协议</h3><h4 id="Internet-协议特征"><a href="#Internet-协议特征" class="headerlink" title="Internet 协议特征"></a>Internet 协议特征</h4><ul>
<li>运行于 OSI 网络层</li>
<li>面向无连接的协议</li>
<li>独立处理数据包</li>
<li>分层编址</li>
<li>尽力而为传输</li>
<li>无数据恢复功能</li>
</ul>
<h4 id="IP-PDU-报头"><a href="#IP-PDU-报头" class="headerlink" title="IP PDU 报头"></a>IP PDU 报头</h4><p><img src="../../../../images/image/SRE/day10/72.png" alt="72"></p>
<p>IP PDU 报头格式 版本：</p>
<ul>
<li>占4位,指 IP 协议的版本目前的IP协议版本号为4；</li>
<li>首部长度：占4位，可表示的最大数值是15个单位，一个单位为4字节，因此IP 的首部长度的最大值是60字节； </li>
<li>区分服务：占8位,用来获得更好的服务，在旧标准中叫做服务类型，但实际上一直未被使用过，后改名为区分服务，只有在使用区分服务(DiffServ)时,这个字段才起作用.一般的情况下不使用； </li>
<li>总长度：占16位，指首部和数据之和的长度,单位为字节，因此数据报的最大长度为 65535 字节，总长度必须不超过最大传送单元 MTU；</li>
<li>标识：占16位，它是一个计数器,通常，每发送一个报文，该值会加1， 也用于数据包分片，在同一个包的若干分片中，该值是相同的；</li>
<li>标志(flag)：占3位，目前只有后两位有意义， DF： Don’t Fragment 中间的一位，只有当 DF=0 时才允许分片，MF： More Fragment  最后一位，MF=1表示后面还有分片，MF=0 表示最后一个分片IP PDU 报头；</li>
<li>片偏移：占13位，指较长的分组在分片后，该分片在原分组中的相对位置。片偏移以8个字节为偏移单位；</li>
<li>生存时间：占8位,记为TTL (Time To Live) 数据报文在网络中可通过的路由器数的最大值，TTL 字段是由发送端初始设置一个 8 bit字段，推荐的初始值由分配数字 RFC 指定,当前值为 64，发送 ICMP 回显应答时经常把 TTL 设为最大值 255；</li>
<li>协议：占8位，指出此数据报携带的数据使用何种协议以便目的主机的IP层将数据部分上交给哪个处理过程，1 表示为 ICMP 协议， 2  表示为 IGMP 协议， 6表示为 TCP 协议，17表示为 UDP 协议；</li>
<li>首部检验和：占16位，只检验数据报文的首部不检验数据部分，这里不采用 CRC 检验码而采用简单的计算方法；</li>
<li>源地址和目的地址：都各占4字节，分别记录源地址和目的地址；</li>
</ul>
<p>修改默认ttl</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/ip_default_ttl </span></span><br><span class="line">64</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># echo 100 &gt; /proc/sys/net/ipv4/ip_default_ttl</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/sys/net/ipv4/ip_default_ttl</span></span><br><span class="line">100</span><br></pre></td></tr></table></figure>

<p>禁用IPv6 注意:禁用IPv6可能会影响一些服务的启动,如:ssh,postfix,mysql等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">   inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">   inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/ether 00:0c:29:3e:ac:46 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">   inet 172.16.1.50/24 brd 172.16.1.255 scope global noprefixroute ens160</span><br><span class="line">   valid_lft forever preferred_lft forever</span><br><span class="line">   inet6 fe80::20c:29ff:fe3e:ac46/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line"><span class="comment">#加两行</span></span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># sysctl -p</span></span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">   inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/ether 00:0c:29:3e:ac:46 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">   inet 172.16.1.50/24 brd 172.16.1.255 scope global noprefixroute ens160</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>协议域</p>
<p><img src="../../../../images/image/SRE/day10/73.png" alt="73"></p>
<h2 id="主机到主机的包传递完整过程"><a href="#主机到主机的包传递完整过程" class="headerlink" title="主机到主机的包传递完整过程"></a>主机到主机的包传递完整过程</h2><p><img src="../../../../images/image/SRE/day10/74.png" alt="74"></p>
<p><img src="../../../../images/image/SRE/day10/75.png" alt="75"></p>
<p><img src="../../../../images/image/SRE/day10/76.png" alt="76"></p>
<p><img src="../../../../images/image/SRE/day10/77.png" alt="77"></p>
<p><img src="../../../../images/image/SRE/day10/78.png" alt="78"></p>
<p><img src="../../../../images/image/SRE/day10/79.png" alt="79"></p>
<p><img src="../../../../images/image/SRE/day10/80.png" alt="80"></p>
<p><img src="../../../../images/image/SRE/day10/81.png" alt="81"></p>
<p><img src="../../../../images/image/SRE/day10/82.png" alt="82"></p>
<p><img src="../../../../images/image/SRE/day10/83.png" alt="83"></p>
<p><img src="../../../../images/image/SRE/day10/84.png" alt="84"></p>
<p><img src="../../../../images/image/SRE/day10/85.png" alt="85"></p>
<p><img src="../../../../images/image/SRE/day10/86.png" alt="86"></p>
<p><img src="../../../../images/image/SRE/day10/87.png" alt="87"></p>
<p><img src="../../../../images/image/SRE/day10/88.png" alt="88"></p>
<p><img src="../../../../images/image/SRE/day10/89.png" alt="89"></p>
<p><img src="../../../../images/image/SRE/day10/90.png" alt="90"></p>
<p><img src="../../../../images/image/SRE/day10/91.png" alt="91"></p>
<p><img src="../../../../images/image/SRE/day10/92.png" alt="92"></p>
<p><img src="../../../../images/image/SRE/day10/93.png" alt="93"></p>
<p><img src="../../../../images/image/SRE/day10/94.png" alt="94"></p>
<h2 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h2><h3 id="IP地址组成"><a href="#IP地址组成" class="headerlink" title="IP地址组成"></a>IP地址组成</h3><p>它们可唯一标识 IP 网络中的每台设备 ，每台主机（计算机、网络设备、外围设备）必须具有唯一的地址</p>
<p>mac 属于物理地址，mac 地址不可变，一出厂就写死，标识惟一设备</p>
<p>ip 属于逻辑地址，逻辑地址可修改，人为赋予，可以修改，使用灵活，便于管理</p>
<p>ipv4 32位二进制，以十进制显示</p>
<p>ipv6 128位二进制，以十六进制显示</p>
<p>IP地址转十进制INT</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;------|------|------|------|------|------|------|------|------|---</span><br><span class="line">             2^7    2^6    2^5    2^4    2^3    2^2    2^1    2^0 </span><br><span class="line">             128    64     32     16     8 4      2      1</span><br><span class="line">           </span><br><span class="line">           </span><br><span class="line">10.0.0.158</span><br><span class="line"></span><br><span class="line">32位二进制，以.分隔，所以每处都是8位二进制</span><br><span class="line"></span><br><span class="line">10=8+2                   00001010</span><br><span class="line">0=                       00000000</span><br><span class="line">0=                       00000000</span><br><span class="line">158=128+16+8+4+2         10011110</span><br><span class="line"></span><br><span class="line">00001010.00000000.00000000.10011110</span><br><span class="line"></span><br><span class="line"><span class="comment">#二进制转十进制</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &quot;ibase=2;00001010000000000000000010011110&quot;|bc</span></span><br><span class="line">167772318</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ping 167772318</span></span><br><span class="line">PING 167772318 (10.0.0.158) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.0.0.158: icmp_seq=1 ttl=64 time=0.662 ms</span><br><span class="line">64 bytes from 10.0.0.158: icmp_seq=2 ttl=64 time=1.12 ms</span><br><span class="line">^C</span><br><span class="line">--- 167772318 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1064ms</span><br><span class="line">rtt min/avg/max/mdev = 0.662/0.892/1.122/0.230 ms</span><br></pre></td></tr></table></figure>

<p>遍历检测当前网段内的主机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.1 =     00001010 00000000 00000000 00000001</span><br><span class="line">10.0.0.254 =   00001010 00000000 00000000 11111110    254 = 128+64+32+16+8+4+2</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &quot;ibase=2;00001010000000000000000000000001&quot;|bc</span></span><br><span class="line">167772161</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &quot;ibase=2;00001010000000000000000011111110&quot;|bc</span></span><br><span class="line">167772414</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in &#123;167772161..167772414&#125;;do ping -c1 -W1 $i &amp;&amp; echo the $i is up || echo the $i is down;done;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># net=10.0.0.1;for i in &#123;1..254&#125;;do ping -c1 -W1 $net.$i &amp;&gt;/dev/null &amp;&amp; echo the $net.$i is up || echo the $net.$i is down;done;</span></span><br></pre></td></tr></table></figure>

<p>IPv4地址格式：点分十进制记法</p>
<p><img src="../../../../images/image/SRE/day10/95.png" alt="95"></p>
<p>IP地址由两部分组成</p>
<ul>
<li>网络 ID：标识网络，每个网段分配一个网络ID，处于高位</li>
<li>主机 ID：标识单个主机，由组织分配给各设备，处于低位</li>
</ul>
<h3 id="IP地址分类"><a href="#IP地址分类" class="headerlink" title="IP地址分类"></a>IP地址分类</h3><p><img src="../../../../images/image/SRE/day10/96.png" alt="96"></p>
<p><strong>各类IP特点</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>A类</th>
<th>B类</th>
<th>C类</th>
<th>d类</th>
</tr>
</thead>
<tbody><tr>
<td>高8位范围</td>
<td>00000000-01111111</td>
<td>100000000-10111111</td>
<td>11000000-11011111</td>
<td>11100000-11100000</td>
</tr>
<tr>
<td>高8位10进制</td>
<td>0-127</td>
<td>128-191</td>
<td>192-223</td>
<td>224-239</td>
</tr>
<tr>
<td>网络ID</td>
<td>高8位</td>
<td>高16位</td>
<td>高24位</td>
<td></td>
</tr>
<tr>
<td>主机ID</td>
<td>低24位</td>
<td>低16位</td>
<td>低8位</td>
<td></td>
</tr>
<tr>
<td>网络数</td>
<td>2^7-2=126</td>
<td>2^14=16384</td>
<td>2^21=2097152</td>
<td></td>
</tr>
<tr>
<td>每个网络主机数</td>
<td>2^24-2=16777214</td>
<td>2^16-2=65534</td>
<td>2^8-2=254</td>
<td></td>
</tr>
<tr>
<td>默认子网掩码</td>
<td>255.0.0.0</td>
<td>255.255.0.0</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td>范例</td>
<td>114.114.114</td>
<td>180.76.76.76</td>
<td>223.6.6.6</td>
<td></td>
</tr>
</tbody></table>
<h3 id="公共和私有IP地址"><a href="#公共和私有IP地址" class="headerlink" title="公共和私有IP地址"></a>公共和私有IP地址</h3><p>公共IP地址：互联网上设备拥有的唯一地址 </p>
<p>私有IP地址：不直接用于互联网，通常在局域网中使用</p>
<p><img src="../../../../images/image/SRE/day10/97.png" alt="97"></p>
<h3 id="特殊地址"><a href="#特殊地址" class="headerlink" title="特殊地址"></a>特殊地址</h3><p><img src="../../../../images/image/SRE/day10/98.png" alt="98"></p>
<h3 id="保留地址"><a href="#保留地址" class="headerlink" title="保留地址"></a>保留地址</h3><p>在一个IP地址中，如果主机ID全为0，或主机ID全为1，则该地址是保留地址</p>
<p>如在B类127.16 网段中，172.16.0.0 和 172.16.255.255 为保留地址</p>
<h3 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h3><p>CIDR：无类域间路由，目前的网络已不再按A，B，C类划分网段，可以任意指定网段的范围 </p>
<p>CIDR 无类域间路由表示法：IP/网络ID位数，如：172.16.0.100/16 </p>
<p>netmask子网掩码：32位或128位（IPv6）的数字，和IP成对使用，用来确认IP地址中的网络ID和主机ID，对应网络ID的位为1，对应主机ID的位为0,范例:255.255.255.0 ，表现为连续的高位为1，连续的低位为0 </p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IP地址 172.16.0.0</span><br><span class="line">子网掩码   11111111.11111111.00000000.00000000</span><br><span class="line">子网掩码十进制表示 255.255.0.0</span><br></pre></td></tr></table></figure>

<p>子网掩码的八位</p>
<p><img src="../../../../images/image/SRE/day10/99.png" alt="99"></p>
<p><strong>相关公式：</strong> </p>
<ul>
<li>一个网络的最多的主机数 ＝2 ^ 主机ID位数 - 2 </li>
<li>网络（段）数 = 2 ^ 网络ID中可变的位数 </li>
<li>网络ID = IP 与 netmask </li>
</ul>
<p>用不同命令查看ip和netmask</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># ifconfig ens160</span></span><br><span class="line">ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</span><br><span class="line">       inet 172.16.1.50 netmask 255.255.255.0 broadcast 172.16.1.255</span><br><span class="line">       inet6 fe80::20c:29ff:fe3e:ac46 prefixlen 64 scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">       ether 00:0c:29:3e:ac:46 txqueuelen 1000 (Ethernet)</span><br><span class="line">       RX packets 569 bytes 67473 (65.8 KiB)</span><br><span class="line">       RX errors 0 dropped 0 overruns 0 frame 0</span><br><span class="line">       TX packets 362 bytes 115316 (112.6 KiB)</span><br><span class="line">       TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="comment">#172.16.1.50/24     24表示子网掩码，就是说，32位IP地址里面，前24位表示网络ID</span></span><br><span class="line">[root@bogon ~]<span class="comment"># ip addr show ens160</span></span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">   <span class="built_in">link</span>/ether 00:0c:29:3e:ac:46 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">   inet 172.16.1.50/24 brd 172.16.1.255 scope global noprefixroute ens160</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">   inet6 fe80::20c:29ff:fe3e:ac46/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever  </span><br></pre></td></tr></table></figure>

<p>不同ip类型对应netmask</p>
<p><img src="../../../../images/image/SRE/day10/100.png" alt="100"></p>
<p>两种写法转换</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.100/23       23=8+8+7+0=255.255.254.0        </span><br><span class="line">172.16.2.50/18      17=8+8+2+0=255.255.192.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;------|------|------|------|------|------|------|------|------|---</span><br><span class="line">             2^7   2^6   2^5   2^4   2^3   2^2   2^1   2^0 </span><br><span class="line">             128   64    32    16     8     4     2     1</span><br></pre></td></tr></table></figure>

<p>判断对方主机是否在同一个网段： </p>
<p>用自已的子网掩码分别和自已的IP及对方的IP相与，比较结果，相同则同一网络，不同则不同网段</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#10.0.0.100/24, 10.0.1.100/24</span></span><br><span class="line"><span class="comment">#上述两个IP地址不在同一个网段，netmask都是24，则表示ip前三段是网络ID，两个网络ID不一样，所以不是同一个网段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#10.0.0.100/16, 10.0.1.100/16</span></span><br><span class="line"><span class="comment">#上述两个IP地址不在同一个网段，netmask都是16，则表示ip前两段是网络ID，两个网络ID一样，所以是同一个网段</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#10.0.0.100/24, 10.0.1.100/16</span></span><br><span class="line"><span class="comment">#上述两个IP是否在同一个网段，要分情况</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#10.0.0.100/24 ----&gt; 10.0.1.100/16 时</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#10.0.0.100/24 = 10.0.0.100/255.255.255.0</span></span><br><span class="line"><span class="comment">#00001010.00000000.00000000.01100100 IP</span></span><br><span class="line"><span class="comment">#11111111.11111111.11111111.00000000 netmask</span></span><br><span class="line"><span class="comment">#00001010.00000000.00000000.00000000 网络ID 10.0.0.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#此处也要和前面的netmask与运算，而不是自己的</span></span><br><span class="line"><span class="comment">#10.0.1.100/24 = 10.0.1.100/255.255.255.0</span></span><br><span class="line"><span class="comment">#00001010.00000000.00000001.01100100 IP</span></span><br><span class="line"><span class="comment">#11111111.11111111.11111111.00000000 netmask</span></span><br><span class="line"><span class="comment">#00001010.00000000.00000001.00000000 网络ID 10.0.1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#结论：10.0.0.0 != 10.0.1.0，所以两者不在同一个网段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#10.0.1.100/16 ----&gt; 10.0.0.100/24 时</span></span><br><span class="line"><span class="comment">#结论，不用算，是同一个网段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#IP A与IP B通信时，都是用IP A的netmask去算IP B的netmask，因为在通信前，IP A不知道IP B的netmask值，只能用自己IP与运算</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;------|------|------|------|------|------|------|------|------|---</span><br><span class="line">             2^7   2^6   2^5   2^4   2^3   2^2   2^1   2^0 </span><br><span class="line">             128   64    32    16     8     4     2     1</span><br></pre></td></tr></table></figure>

<p>一个主机：220.100.199.0/22，求主机数量，最小IP，最大IP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#网络ID</span></span><br><span class="line"><span class="comment">#220.100.199.0/22 = 220.100.199.0/255.255.252.0</span></span><br><span class="line"><span class="comment">#220=128+64+16+8+4, 100=64+32+4, 199=128+64+4+2+1</span></span><br><span class="line"><span class="comment">#22=8+8+6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#11011100.01100100.11000111.00000000   IP</span></span><br><span class="line"><span class="comment">#11111111.11111111.11111100.00000000   network</span></span><br><span class="line"><span class="comment">#11011100.01100100.11000100.00000000   网络ID 220.100.196.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#主机数量</span></span><br><span class="line"><span class="comment">#2^(32-22)-2=2^10-2=1024-2=1022   32-22 表示32位减去22位网络ID，剩下主机位ID数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#最小IP和最大IP</span></span><br><span class="line"><span class="comment">#220.100.196.1</span></span><br><span class="line"><span class="comment">#220.100.196</span></span><br><span class="line"><span class="comment">#196=128+64+4=11000100</span></span><br><span class="line"><span class="comment">#前22位属于网络ID   220.100.110001 00.00000000</span></span><br><span class="line"><span class="comment">#则最大是 220.100.110001 11.11111111 = 220.100.199.254</span></span><br></pre></td></tr></table></figure>

<h3 id="划分子网"><a href="#划分子网" class="headerlink" title="划分子网"></a>划分子网</h3><p>划分子网：将一个大的网络（主机数多）划分成多个小的网络（主机数少），主机ID位数变少，网络ID位数变多，网络ID位向主机ID位借n 位,将划分2^n个子网</p>
<p><img src="../../../../images/image/SRE/day10/101.png" alt="101"></p>
<p>可变长度子网掩码</p>
<p><img src="../../../../images/image/SRE/day10/102.png" alt="102"></p>
<p>Subnet地址</p>
<p><img src="../../../../images/image/SRE/day10/103.png" alt="103"></p>
<p>划分子网数=2^(网络ID向主机ID借的位数)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#10.0.0.0/8</span></span><br><span class="line"><span class="comment">#主机数 2^24-2=16777214</span></span><br><span class="line"><span class="comment">#10.0.0.1 -- 10.255.255.254</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#网络ID向主机ID借一位，能划分成两个子网</span></span><br><span class="line"><span class="comment">#10.0 0000000.00000000.00000000   10.0.0.0/9  </span></span><br><span class="line"><span class="comment">#10.1 0000000.00000000.00000000   10.128.0.0/9 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#网络ID向主机ID借两位，能划分成四个子网</span></span><br><span class="line"><span class="comment">#10.00 000000.00000000.00000000   10.0.0.0/10</span></span><br><span class="line"><span class="comment">#10.01 000000.00000000.00000000   10.64.0.0/10</span></span><br><span class="line"><span class="comment">#10.10 000000.00000000.00000000   10.128.0.0/10</span></span><br><span class="line"><span class="comment">#10.11 000000.00000000.00000000   10.192.0.0/10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#划分成32个子网 2^5=32，所以借5位</span></span><br><span class="line"><span class="comment">#10.00000 000.00000000.00000000   10.0.0.0/13</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line"><span class="comment">#10.11111 000.00000000.00000000   10.248.0.0/13</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#中国移动10.0.0.0/8 给32个各省公司划分对应的子网</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#每个省公司的子网的netmask?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#划分32个子网，则网络ID要向主机ID借5位， 2^5=32</span></span><br><span class="line"><span class="comment">#则网络位是 8+5=13</span></span><br><span class="line"><span class="comment">#netmask 是 11111111.11111000.00000000.00000000 = 255.248.0.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#每个省公司的子网的主机数有多少?</span></span><br><span class="line"><span class="comment">#2^(32-13)-2=524286</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#所有子网中最小和最大的子网的网络ID?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#10.00000 000.0.0 最小子网，网络ID为 10.0.0.0/13</span></span><br><span class="line"><span class="comment">#10.11111 000.0.0 最大子网，网络ID为 10.248.0.0/13</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#河南省得到第10个子网，该省的网络ID?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#32个子网，从0到31</span></span><br><span class="line"><span class="comment">#10.00000 000.0.0 第一个子网，借位处从0开始</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#则第10个子网，借位处值为9,9=8+1，二进制就是01001</span></span><br><span class="line"><span class="comment">#则网络ID是 10.72.0.0/13</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#河南省子网起始IP?</span></span><br><span class="line"><span class="comment">#10.01001 000.0.0 10.72.0.1</span></span><br><span class="line"><span class="comment">#10.01001 111.255.254 10.79.255.254</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#河南省再给省内的18个地市划分子网，求：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#每个市公司的子网的netmask?</span></span><br><span class="line"><span class="comment">#每个市公司的子网的主机数有多少?</span></span><br><span class="line"><span class="comment">#各地市的最小netid和最大的netid? </span></span><br><span class="line"><span class="comment">#洛阳市第2个子网，最小IP和最大IP?</span></span><br></pre></td></tr></table></figure>

<h3 id="优化IP地址分配"><a href="#优化IP地址分配" class="headerlink" title="优化IP地址分配"></a>优化IP地址分配</h3><p><img src="../../../../images/image/SRE/day10/104.png" alt="104"></p>
<p>合并超网：将多个小网络合并成一个大网，主机ID位向网络ID位借位，主要实现路由聚合功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#8个C类网段</span></span><br><span class="line">220.78.168.0/24</span><br><span class="line">220.78.169.0/24</span><br><span class="line">220.78.170.0/24</span><br><span class="line">220.78.171.0/24</span><br><span class="line">220.78.172.0/24</span><br><span class="line">220.78.173.0/24</span><br><span class="line">220.78.174.0/24</span><br><span class="line">220.78.175.0/24</span><br><span class="line"></span><br><span class="line"><span class="comment">#主机ID向网络ID借3位，网络ID变成21位 168=128+32+8</span></span><br><span class="line">220.78.10101 000.0   220.78.168.0/24</span><br><span class="line">220.78.10101 001.0   220.78.169.0/24</span><br><span class="line">220.78.10101 010.0   220.78.170.0/24</span><br><span class="line">......</span><br><span class="line">220.78.10101 110.0   220.78.174.0/24</span><br><span class="line">220.78.10101 111.0   220.78.175.0/24</span><br><span class="line"></span><br><span class="line"><span class="comment">#合并成一个大网</span></span><br><span class="line">220.78.168.0/21</span><br></pre></td></tr></table></figure>

<h3 id="跨网络通信"><a href="#跨网络通信" class="headerlink" title="跨网络通信"></a>跨网络通信</h3><p>跨网络通信：路由,选择路径</p>
<p>路由分类：</p>
<ul>
<li>主机路由</li>
<li>网络路由</li>
<li>默认路由 </li>
</ul>
<p>优先级：精度越高，优先级越高</p>
<h3 id="动态主机配置协议-DHCP"><a href="#动态主机配置协议-DHCP" class="headerlink" title="动态主机配置协议 DHCP"></a>动态主机配置协议 DHCP</h3><p><img src="../../../../images/image/SRE/day10/105.png" alt="105"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/11/26/SRE-%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%80%9A%E4%BF%A1/">http://example.com/2024/11/26/SRE-网络协议和通信/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SRE/">SRE</a></div><div class="post_share"><div class="social-share" data-image="/../images/image/SRE/day10/48.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/11/24/SRE-%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" title="软件管理"><img class="cover" src="/../images/title/linux3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">软件管理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/04/24/SRE-Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%92%8C%E5%B8%AE%E5%8A%A9/" title="Linux基本操作和帮助"><img class="cover" src="/../images/title/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="title">Linux基本操作和帮助</div></div></a></div><div><a href="/2024/08/27/SRE-Linux%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%92%8CIO%E9%87%8D%E5%AE%9A%E5%90%91/" title="Linux文件管理和IO重定向"><img class="cover" src="/../images/title/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="title">Linux文件管理和IO重定向</div></div></a></div><div><a href="/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="shell脚本编程"><img class="cover" src="/../images/title/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-05</div><div class="title">shell脚本编程</div></div></a></div><div><a href="/2024/09/23/SRE-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="常见文本处理工具和正则表达式"><img class="cover" src="/../images/title/linux5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-23</div><div class="title">常见文本处理工具和正则表达式</div></div></a></div><div><a href="/2024/10/20/SRE-%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E5%92%8C%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9/" title="文件查找和打包压缩"><img class="cover" src="/../images/title/linux1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-20</div><div class="title">文件查找和打包压缩</div></div></a></div><div><a href="/2024/08/31/SRE-%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" title="用户和权限管理"><img class="cover" src="/../images/title/linux4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-31</div><div class="title">用户和权限管理</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/title/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">77</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">网络基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">网络概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%89%A9%E7%90%86%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">常见的网络物理组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">各种网络应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%AF%B9%E7%BD%91%E7%BB%9C%E7%9A%84%E8%A6%81%E6%B1%82"><span class="toc-number">1.2.2.</span> <span class="toc-text">应用程序对网络的要求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%9A%84%E7%89%B9%E5%BE%81"><span class="toc-number">1.3.</span> <span class="toc-text">网络的特征</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9F%E5%BA%A6-%E5%B8%A6%E5%AE%BD"><span class="toc-number">1.3.1.</span> <span class="toc-text">速度(带宽)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91"><span class="toc-number">1.3.2.</span> <span class="toc-text">网络拓扑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A0%87%E5%87%86"><span class="toc-number">1.4.</span> <span class="toc-text">网络标准</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A0%87%E5%87%86%E5%92%8C%E5%88%86%E5%B1%82"><span class="toc-number">1.4.1.</span> <span class="toc-text">网络标准和分层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%94%BE%E7%B3%BB%E7%BB%9F%E4%BA%92%E8%81%94-OSI"><span class="toc-number">1.4.2.</span> <span class="toc-text">开放系统互联 OSI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%9A%84%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">网络的通信过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%92%8C%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%B0%81"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">数据封装和数据解封</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83-PDU"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">协议数据单元 PDU</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E9%80%9A%E8%AE%AF%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">三种通讯模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%B2%E7%AA%81%E5%9F%9F%E5%92%8C%E5%B9%BF%E6%92%AD%E5%9F%9F"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">冲突域和广播域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E9%80%9A%E8%AE%AF%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.3.5.</span> <span class="toc-text">三种通讯机制</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B1%80%E5%9F%9F%E7%BD%91-Local-Area-Network"><span class="toc-number">2.</span> <span class="toc-text">局域网 Local Area Network</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.1.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">2.1.2.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">2.1.3.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86"><span class="toc-number">2.1.4.</span> <span class="toc-text">标准</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E8%AE%BE%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">组网设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BA%BF%E7%BC%86%E5%92%8C%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.2.1.</span> <span class="toc-text">网络线缆和接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BA%BF%E6%A0%87%E5%87%86"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">网线标准</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BA%BF%E7%BA%BF%E5%BA%8F%E5%92%8C%E8%A7%84%E8%8C%83"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">网线线序和规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%89%E7%BA%A4%E5%92%8C%E6%8E%A5%E5%8F%A3Fiber-Optic"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">光纤和接口Fiber-Optic</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">2.2.2.</span> <span class="toc-text">网络适配器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E7%BB%A7%E5%99%A8%E5%92%8C%E9%9B%86%E7%BA%BF%E5%99%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">中继器和集线器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E7%BB%A7%E5%99%A8-repeater"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">中继器 repeater</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BA%BF%E5%99%A8-hub"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">集线器 hub</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E6%A1%A5%E5%92%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">2.2.4.</span> <span class="toc-text">网桥和交换机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E6%A1%A5-Bridge"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">网桥 Bridge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E6%8D%A2%E6%9C%BA-switch"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">交换机 switch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BA%BF%E5%99%A8%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">集线器与交换机的比较</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8-router"><span class="toc-number">2.2.5.</span> <span class="toc-text">路由器 router</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E4%B8%8E%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.6.</span> <span class="toc-text">对比与总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E7%BD%91%E6%8A%80%E6%9C%AF"><span class="toc-number">2.3.</span> <span class="toc-text">以太网技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E7%BD%91MAC%E5%B8%A7%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.3.2.</span> <span class="toc-text">以太网MAC帧格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MAC%E5%9C%B0%E5%9D%80"><span class="toc-number">2.3.3.</span> <span class="toc-text">MAC地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%B2%E7%AA%81%E6%A3%80%E6%B5%8B%E7%9A%84%E8%BD%BD%E6%B3%A2%E4%BE%A6%E5%90%AC%E5%A4%9A%E8%B7%AF%E8%AE%BF%E9%97%AE-CSMA-CD"><span class="toc-number">2.3.4.</span> <span class="toc-text">冲突检测的载波侦听多路访问 CSMA&#x2F;CD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91-VLAN"><span class="toc-number">2.4.</span> <span class="toc-text">虚拟局域网 VLAN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VLAN-%E5%8E%9F%E7%90%86"><span class="toc-number">2.4.1.</span> <span class="toc-text">VLAN 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IEEE-802-1Q-%E5%B8%A7%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.2.</span> <span class="toc-text">IEEE 802.1Q 帧结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%9A%84%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84"><span class="toc-number">2.5.</span> <span class="toc-text">分层的网络架构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP-IP-%E5%8D%8F%E8%AE%AE%E6%A0%88"><span class="toc-number">3.</span> <span class="toc-text">TCP&#x2F;IP 协议栈</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-IP-%E6%A0%87%E5%87%86"><span class="toc-number">3.1.</span> <span class="toc-text">TCP&#x2F;IP 标准</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-IP-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.1.</span> <span class="toc-text">TCP&#x2F;IP 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-IP-%E5%88%86%E5%B1%82"><span class="toc-number">3.1.2.</span> <span class="toc-text">TCP&#x2F;IP 分层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-IP-%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B"><span class="toc-number">3.1.3.</span> <span class="toc-text">TCP&#x2F;IP 通信过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-IP%E5%92%8COSI%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-number">3.1.4.</span> <span class="toc-text">TCP&#x2F;IP和OSI模型的比较</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#transport-%E5%B1%82"><span class="toc-number">3.2.</span> <span class="toc-text">transport 层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP"><span class="toc-number">3.2.1.</span> <span class="toc-text">TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E7%89%B9%E6%80%A7"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">TCP特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E5%8C%85%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">TCP包头结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E5%8D%8F%E8%AE%AEPORT"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">TCP协议PORT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">三次握手和四次挥手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA-FSM"><span class="toc-number">3.2.1.5.</span> <span class="toc-text">有限状态机 FSM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sync%E5%8D%8A%E8%BF%9E%E6%8E%A5%E5%92%8Caccept%E5%85%A8%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97"><span class="toc-number">3.2.1.6.</span> <span class="toc-text">sync半连接和accept全连接队列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0"><span class="toc-number">3.2.1.7.</span> <span class="toc-text">TCP超时重传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">3.2.1.8.</span> <span class="toc-text">拥塞控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E6%A0%B8TCP%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96"><span class="toc-number">3.2.1.9.</span> <span class="toc-text">内核TCP参数优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP"><span class="toc-number">3.2.2.</span> <span class="toc-text">UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E7%89%B9%E6%80%A7"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">UDP特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E5%8C%85%E5%A4%B4"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">UDP包头</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Internet%E5%B1%82"><span class="toc-number">3.3.</span> <span class="toc-text">Internet层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Internet-Control-Message-Protocol"><span class="toc-number">3.3.1.</span> <span class="toc-text">Internet Control Message Protocol</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Address-Resolution-Protocol"><span class="toc-number">3.3.2.</span> <span class="toc-text">Address Resolution Protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ARP"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">ARP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gratuitous-ARP"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">Gratuitous ARP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reverse-Address-Resolution-Protocol"><span class="toc-number">3.3.3.</span> <span class="toc-text">Reverse Address Resolution Protocol</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#internet-%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.3.4.</span> <span class="toc-text">internet 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Internet-%E5%8D%8F%E8%AE%AE%E7%89%B9%E5%BE%81"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">Internet 协议特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP-PDU-%E6%8A%A5%E5%A4%B4"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">IP PDU 报头</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E5%8C%85%E4%BC%A0%E9%80%92%E5%AE%8C%E6%95%B4%E8%BF%87%E7%A8%8B"><span class="toc-number">3.4.</span> <span class="toc-text">主机到主机的包传递完整过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80"><span class="toc-number">3.5.</span> <span class="toc-text">IP地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E7%BB%84%E6%88%90"><span class="toc-number">3.5.1.</span> <span class="toc-text">IP地址组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB"><span class="toc-number">3.5.2.</span> <span class="toc-text">IP地址分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E5%92%8C%E7%A7%81%E6%9C%89IP%E5%9C%B0%E5%9D%80"><span class="toc-number">3.5.3.</span> <span class="toc-text">公共和私有IP地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%9C%B0%E5%9D%80"><span class="toc-number">3.5.4.</span> <span class="toc-text">特殊地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E7%95%99%E5%9C%B0%E5%9D%80"><span class="toc-number">3.5.5.</span> <span class="toc-text">保留地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">3.5.6.</span> <span class="toc-text">子网掩码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91"><span class="toc-number">3.5.7.</span> <span class="toc-text">划分子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96IP%E5%9C%B0%E5%9D%80%E5%88%86%E9%85%8D"><span class="toc-number">3.5.8.</span> <span class="toc-text">优化IP地址分配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1"><span class="toc-number">3.5.9.</span> <span class="toc-text">跨网络通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8D%8F%E8%AE%AE-DHCP"><span class="toc-number">3.5.10.</span> <span class="toc-text">动态主机配置协议 DHCP</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/26/SRE-%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%80%9A%E4%BF%A1/" title="网络协议和通信"><img src="/../images/image/SRE/day10/48.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络协议和通信"/></a><div class="content"><a class="title" href="/2024/11/26/SRE-%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%80%9A%E4%BF%A1/" title="网络协议和通信">网络协议和通信</a><time datetime="2024-11-25T16:00:00.000Z" title="发表于 2024-11-26 00:00:00">2024-11-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/24/SRE-%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" title="软件管理"><img src="/../images/title/linux3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件管理"/></a><div class="content"><a class="title" href="/2024/11/24/SRE-%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" title="软件管理">软件管理</a><time datetime="2024-11-23T16:00:00.000Z" title="发表于 2024-11-24 00:00:00">2024-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/21/ST-%E9%AB%98%E5%8F%AF%E7%94%A8Hadoop/" title="高可用部署 HADOOP"><img src="/../images/title/hadoop-jb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高可用部署 HADOOP"/></a><div class="content"><a class="title" href="/2024/11/21/ST-%E9%AB%98%E5%8F%AF%E7%94%A8Hadoop/" title="高可用部署 HADOOP">高可用部署 HADOOP</a><time datetime="2024-11-20T16:10:00.000Z" title="发表于 2024-11-21 00:10:00">2024-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/21/SRE-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" title="磁盘存储和文件系统"><img src="/../images/image/SRE/day09/4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="磁盘存储和文件系统"/></a><div class="content"><a class="title" href="/2024/11/21/SRE-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" title="磁盘存储和文件系统">磁盘存储和文件系统</a><time datetime="2024-11-20T16:00:00.000Z" title="发表于 2024-11-21 00:00:00">2024-11-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="https://jihulab.com/wsq1203/images/-/raw/main/gonganbeian/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>