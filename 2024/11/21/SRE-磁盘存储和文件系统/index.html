<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>磁盘存储和文件系统 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Site Reliability Engineering">
<meta property="og:type" content="article">
<meta property="og:title" content="磁盘存储和文件系统">
<meta property="og:url" content="http://example.com/2024/11/21/SRE-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="Site Reliability Engineering">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/SRE/day09/4.png">
<meta property="article:published_time" content="2024-11-20T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-01T11:34:55.978Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="SRE">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/SRE/day09/4.png"><link rel="shortcut icon" href="/../images/TITLE/user.webp"><link rel="canonical" href="http://example.com/2024/11/21/SRE-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '磁盘存储和文件系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2025-04-01 19:34:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/TITLE/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">104</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">35</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/SRE/day09/4.png')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">磁盘存储和文件系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-20T16:00:00.000Z" title="发表于 2024-11-21 00:00:00">2024-11-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-01T11:34:55.978Z" title="更新于 2025-04-01 19:34:55">2025-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>87分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="磁盘存储和文件系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="磁盘结构"><a href="#磁盘结构" class="headerlink" title="磁盘结构"></a>磁盘结构</h1><h2 id="设备文件"><a href="#设备文件" class="headerlink" title="设备文件"></a>设备文件</h2><p>Linux 哲学思想：一切皆文件</p>
<p>对于硬件设备，在Linux系统中，也是以文件的形式呈现出来的</p>
<p>设备文件：关联至一个设备驱动程序，进而能够与之对应的硬件设备进行通信</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通文件</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ll t*</span></span><br><span class="line">-rw-r--r--  1 root root  20 Jul 11 21:17 <span class="built_in">test</span></span><br><span class="line">-rw-r--r--  1 root root 178 Jul 15 09:50 test2.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#设备文件</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ll /dev/sda</span></span><br><span class="line">brw-rw---- 1 root disk 8, 0 Jul 29 08:51 /dev/sda</span><br><span class="line"></span><br><span class="line"><span class="comment">#设备文件</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ll /dev/tty0</span></span><br><span class="line">crw--w---- 1 root <span class="built_in">tty</span> 4, 0 Jul 29 08:51 /dev/tty0</span><br></pre></td></tr></table></figure>

<p>设备号</p>
<table>
<thead>
<tr>
<th>设备号</th>
<th>英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>主设备号</td>
<td>major number</td>
<td>标识设备类型</td>
</tr>
<tr>
<td>次设备号</td>
<td>minor number</td>
<td>标识同一类型下的不同设备</td>
</tr>
</tbody></table>
<p>设备文件类型</p>
<table>
<thead>
<tr>
<th>设备类型</th>
<th>英文</th>
<th>文件类型标识字符</th>
<th>存取单位</th>
<th>典型设备</th>
</tr>
</thead>
<tbody><tr>
<td>块设备</td>
<td>block</td>
<td>b</td>
<td>块</td>
<td>磁盘</td>
</tr>
<tr>
<td>字符设备</td>
<td>char</td>
<td>c</td>
<td>字符</td>
<td>键盘</td>
</tr>
</tbody></table>
<p>磁盘设备的设备文件命名</p>
<table>
<thead>
<tr>
<th>设备类型</th>
<th>设备文件命名</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>ASA,SATA,SCSI,IDE,USB</td>
<td>/dav/sda;/deb/sdb;/dev/sdc…</td>
<td></td>
</tr>
<tr>
<td>nvme协议硬盘</td>
<td>/dev/nvme0n1;/dev/nvme0n2…</td>
<td></td>
</tr>
<tr>
<td>虚拟磁盘</td>
<td>/dev/vda;/dev/vdb;/dev/xvda;/dev/xvdb…</td>
<td></td>
</tr>
</tbody></table>
<p>添加硬盘，不重启识别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo &#x27;- - -&#x27; &gt; /sys/class/scsi_host/host0/scan</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &#x27;- - -&#x27; &gt; /sys/class/scsi_host/host1/scan </span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &#x27;- - -&#x27; &gt; /sys/class/scsi_host/host2/scan </span></span><br></pre></td></tr></table></figure>

<h2 id="硬盘类型"><a href="#硬盘类型" class="headerlink" title="硬盘类型"></a>硬盘类型</h2><p><img src="../../../../images/SRE/day09/1.png" alt="1"></p>
<p><strong>硬盘接口类型</strong></p>
<ul>
<li>IDE：133MB/s，并行接口，早期家用电脑 </li>
<li>SCSI：640MB/s，并行接口，早期服务器 </li>
<li>SATA：6Gbps，SATA数据端口与电源端口是分开的，即需要两条线，一条数据线，一条电源线 </li>
<li>SAS：6Gbps，SAS是一整条线，数据端口与电源端口是一体化的，SAS中是包含供电线的，而 SATA中不包含供电线。SATA标准其实是 SAS标准的一个子集，二者可兼容，SATA硬盘可以插入SAS主板上，反之不行</li>
<li>USB：480MB/s </li>
<li>M.2：</li>
</ul>
<p><code>注意：速度不是由单纯的接口类型决定，支持Nvme协议硬盘速度是最快的</code></p>
<p><strong>服务器硬盘大小</strong> </p>
<ul>
<li>LFF：3.5寸，一般见到的那种台式机硬盘的大小 </li>
<li>SFF：Small Form Factor 小形状因数，2.5寸，注意不同于2.5寸的笔记本硬盘 </li>
</ul>
<p>L、S分别是大、小的意思，目前服务器或者盘柜采用sff规格的硬盘主要是考内虑增大单位密度内的磁盘容量、增强散热、减小功耗</p>
<h2 id="机械硬盘和固态硬盘"><a href="#机械硬盘和固态硬盘" class="headerlink" title="机械硬盘和固态硬盘"></a>机械硬盘和固态硬盘</h2><p>机械硬盘（HDD）：Hard Disk Drive，即是传统普通硬盘，主要由：盘片，磁头，盘片转轴及控制电机，磁头控制器，数据转换器，接口，缓存等几个部分组成。机械硬盘中所有的盘片都装在一个旋转轴 上，每张盘片之间是平行的，在每个盘片的存储面上有一个磁头，磁头与盘片之间的距离比头发丝的直径还小，所有的磁头联在一个磁头控制器上，由磁头控制器负责各个磁头的运动。磁头可沿盘片的半径方向运 动，加上盘片每分钟几千转的高速旋转，磁头就可以定位在盘片的指定位置上进行数据的读写操作。数据通过磁头由电磁流来改变极性方式被电磁流写到磁盘上，也可以通过相反方式读取。硬盘为精密设备，进入硬盘的空气必须过滤 </p>
<p>固态硬盘（SSD）：Solid State Drive，用固态电子存储芯片阵列而制成的硬盘，由控制单元和存储单元（FLASH芯片、DRAM芯片）组成。 固态硬盘在接口的规范和定义、功能及使用方法上与普通硬盘的完全相同，在产品外形和尺寸上也与普通硬盘一致 </p>
<p>相较于HDD，SSD在防震抗摔、传输速率、功耗、重量、噪音上有明显优势，SSD传输速率性能是HDD 的2倍 </p>
<p>相较于SSD，HDD在价格、容量占有绝对优势 </p>
<p>硬盘有价，数据无价，目前SSD不能完全取代HHD</p>
<p><strong>机械硬盘结构</strong></p>
<p><img src="../../../../images/SRE/day09/2.png" alt="2"></p>
<p><img src="../../../../images/SRE/day09/3.png" alt="3"></p>
<h2 id="硬盘存储术语"><a href="#硬盘存储术语" class="headerlink" title="硬盘存储术语"></a>硬盘存储术语</h2><p><img src="../../../../images/SRE/day09/4.png" alt="4"></p>
<p><strong>硬盘存储术语 CHS</strong></p>
<table>
<thead>
<tr>
<th>术语</th>
<th>英文</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>磁头</td>
<td>head</td>
<td>一个盘面对应一个磁头</td>
</tr>
<tr>
<td>磁道</td>
<td>track</td>
<td>盘面上的每一圈就是一个磁道</td>
</tr>
<tr>
<td>扇区</td>
<td>sector</td>
<td>把每个磁道按512bytes大小再进行划分，这就是扇区，每个磁道上的扇区数量是不一样的</td>
</tr>
<tr>
<td>柱面</td>
<td>cylinder</td>
<td>磁头移动的时候，是一起移动的，如果是6个盘面，则6个磁头对应的磁道是一致的，这就是柱面</td>
</tr>
</tbody></table>
<p>CentOS7之后，就只显示扇区信息了 </p>
<p>CentOS 5 之前版本 Linux 以柱面的整数倍划分分区，CentOS 6之后可以支持以扇区划分分区</p>
<p>范例：查看CHS信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rocky8.6默认只有扇区信息</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fdisk -l /dev/sda</span></span><br><span class="line">Disk /dev/sda: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x3475e2b0</span><br><span class="line"></span><br><span class="line">Device     Boot   Start       End   Sectors Size Id Type</span><br><span class="line">/dev/sda1 *       2048   2099199   2097152   1G 83 Linux</span><br><span class="line">/dev/sda2       2099200 419430399 417331200 199G 8e Linux LVM</span><br><span class="line"></span><br><span class="line"><span class="comment">#加参数后可显示更详细信息</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fdisk -u=cylinder -l /dev/sda</span></span><br><span class="line">Disk /dev/sda: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Geometry: 255 heads, 2 sectors/track, 26108 cylinders</span><br><span class="line">Units: cylinders of 510 * 512 = 261120 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x3475e2b0</span><br><span class="line"></span><br><span class="line">Device     Boot Start   End Cylinders Size Id Type</span><br><span class="line">/dev/sda1 *        5   4117      4113   1G 83 Linux</span><br><span class="line">/dev/sda2        4117 822413    818297 199G 8e Linux LVM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#centos6上默认会显示详细信息</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># fdisk -l /dev/sda</span></span><br><span class="line">Disk /dev/sda: 214.7 GB, 214748364800 bytes</span><br><span class="line">255 heads, 63 sectors/track, 26108 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x0006fc79</span><br><span class="line">   Device Boot     Start         End     Blocks   Id System</span><br><span class="line">/dev/sda1   *           1         131     1048576   83 Linux</span><br><span class="line">Partition 1 does not end on cylinder boundary.</span><br><span class="line">/dev/sda2             131       12879   102400000   83 Linux</span><br><span class="line">/dev/sda3           12879       19253    51200000   83 Linux</span><br><span class="line">/dev/sda4           19253       26109    55065600    5 Extended</span><br><span class="line">/dev/sda5           19254       19515     2097152   82 Linux swap / Solaris</span><br></pre></td></tr></table></figure>

<p>范例：识别SSD和机械硬盘类型</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1表示机械，0表示SSD</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lsblk -d -o name,rota</span></span><br><span class="line">NAME       ROTA</span><br><span class="line">sda        1</span><br><span class="line">sr0        1</span><br><span class="line">nvme0n1    0</span><br><span class="line">nvme0n2    0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ls /sys/block/</span></span><br><span class="line">nvme0n1 nvme0n2 sda sr0</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /sys/block/*/queue/rotational</span></span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /sys/block/sda/queue/rotational </span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>范例: 测速</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># dd | hdparm -t /dev/sda </span></span><br><span class="line">/dev/sda:</span><br><span class="line"> Timing buffered disk reads: 1854 MB <span class="keyword">in</span>  3.00 seconds = 617.80 MB/sec</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day09/5.png" alt="5"></p>
<p><strong>区位记录磁盘扇区结构ZBR（Zoned Bit Recording）</strong></p>
<p><img src="../../../../images/SRE/day09/6.png" alt="6"></p>
<p>磁盘上寻址的两种方式</p>
<p><strong>CHS</strong> </p>
<ul>
<li>CHS采用 24 bit位寻址</li>
<li>其中前10位表示cylinder，中间8位表示head，后面6位表示sector </li>
<li>最大寻址空间 8 GB </li>
</ul>
<p><strong>LBA</strong>（logical block addressing） </p>
<ul>
<li>LBA是一个整数，通过转换成 CHS 格式完成磁盘具体寻址 </li>
<li>ATA-1规范中定义了28位寻址模式，以每扇区512位组来计算，ATA-1所定义的28位LBA上限达到 128 GiB。2002年ATA-6规范采用48位LBA，同样以每扇区512位组计算容量上限可达128 Petabytes </li>
</ul>
<p>由于CHS寻址方式的寻址空间在大概8GB以内，所以在磁盘容量小于大概8GB时，可以使用CHS寻址方 式或是LBA寻址方式；在磁盘容量大 于大概8GB时，则只能使用LBA寻址方式</p>
<h1 id="管理存储"><a href="#管理存储" class="headerlink" title="管理存储"></a>管理存储</h1><p>使用磁盘空间过程</p>
<ol>
<li>设备分区 </li>
<li>创建文件系统</li>
<li>挂载新的文件系统</li>
</ol>
<h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><h3 id="为什么分区"><a href="#为什么分区" class="headerlink" title="为什么分区"></a>为什么分区</h3><ul>
<li>优化I/O性能</li>
<li>实现磁盘空间配额限制 </li>
<li>提高修复速度 </li>
<li>隔离系统和程序 </li>
<li>安装多个OS  </li>
<li>采用不同文件系统</li>
</ul>
<h3 id="分区方式"><a href="#分区方式" class="headerlink" title="分区方式"></a>分区方式</h3><p>两种分区方式：MBR，GPT</p>
<h4 id="MBR分区"><a href="#MBR分区" class="headerlink" title="MBR分区"></a>MBR分区</h4><p>MBR：Master Boot Record，1982年，使用32位表示扇区数，分区不超过2T </p>
<p>划分分区的单位： </p>
<ul>
<li>CentOS 5 之前按整柱面划分 </li>
<li>CentOS 6 版本后可以按Sector划分</li>
</ul>
<p>0磁道0扇区：512bytes</p>
<ul>
<li>446bytes: boot loader 启动相关 </li>
<li>64bytes：分区表，其中每16bytes标识一个分区 </li>
<li>2bytes: 55AA，标识位</li>
</ul>
<p>MBR分区中一块硬盘最多有4个主分区，也可以3主分区+1扩展(N个逻辑分区) </p>
<p> MBR分区：主和扩展分区对应的1–4，/dev/sda3，逻辑分区从5开始，/dev/sda5 </p>
<p>MBR分区结构</p>
<p><img src="../../../../images/SRE/day09/7.png" alt="7"></p>
<blockquote>
<p>为什么不能超过4个主分区？</p>
</blockquote>
<p>因为在 0磁道0扇区 上只留了64bytes空间存储分区表信息，而一个分区的关键信息要占用16个字节来存放 </p>
<blockquote>
<p>为什么单分区不能超2T？ </p>
</blockquote>
<p>一个分区信息占用16个字节，其中记录分区开始位置的空间为4个字节，记录分区结束位置的空间也是4个字节； </p>
<p>一个字节8位，4个字节是32位，则起始位最小值为32个0，结束位最大值为32个1， </p>
<p>所以一个分区，最大就是2的32次方个扇区，一个扇区512字节，则最大空间是 2^ 32*2^9 = 2^41 字节；</p>
<p> 2^40 是T，那2^41就表示不超过2T</p>
<p>硬盘主引导记录MBR由4个部分组成</p>
<p><img src="../../../../images/SRE/day09/8.png" alt="8"></p>
<ul>
<li>主引导程序（偏移地址0000H–0088H），它负责从活动分区中装载，并运行系统引导程序 </li>
<li>出错信息数据区，偏移地址0089H–00E1H为出错信息，00E2H–01BDH全为0字节 </li>
<li>分区表（DPT,Disk Partition Table）含4个分区项，偏移地址01BEH–01FDH,每个分区表项长16个 字节，共64字节为分区项1、分区项 2、分区项3、分区项4  </li>
<li>结束标志字，偏移地址01FE–01FF的2个字节值为结束标志55AA</li>
</ul>
<p>MBR中DPT结构（disk partition table 磁盘分区表）</p>
<p><img src="../../../../images/SRE/day09/9.png" alt="9"></p>
<p>范例：查看分区表信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># hexdump -C -n 512 /dev/sda</span></span><br></pre></td></tr></table></figure>

<p>范例: 备份MBR的分区表,并破坏后恢复</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看分区表</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fdisk -l /dev/sda</span></span><br><span class="line">Disk /dev/sda: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x5b8e1003</span><br><span class="line">Device     Boot   Start       End   Sectors Size Id Type</span><br><span class="line">/dev/sda1 *       2048   2099199   2097152   1G 83 Linux</span><br><span class="line">/dev/sda2       2099200 419430399 417331200 199G 8e Linux LVM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#备份MBR分区表</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># dd if=/dev/sda of=/data/dpt.img bs=1 count=64 skip=446</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#64字节大小</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ll /data/dpt.img </span></span><br><span class="line">-rw-r--r-- 1 root root 64 Jul 30 11:49 /tmp/dpt.img</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看具体内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># hexdump -vC /data/dpt.img</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#备份到远端</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># scp /tmp/dpt.img 10.0.0.157:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#破坏MBR分区表</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># dd if=/dev/zero of=/dev/sda bs=1 count=64 seek=446</span></span><br><span class="line"></span><br><span class="line">64+0 records <span class="keyword">in</span></span><br><span class="line">64+0 records out</span><br><span class="line">64 bytes copied, 0.00248682 s, 25.7 kB/s</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看前512字节</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># hexdump -vC -n 512 /dev/sda</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看分区表，没有分区信息</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fdisk -l /dev/sda</span></span><br><span class="line">Disk /dev/sda: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x3475e2b0</span><br><span class="line"></span><br><span class="line"><span class="comment">#但内存中还有相关信息</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lsblk</span></span><br><span class="line">NAME       MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda           8:0    0 200G  0 disk </span><br><span class="line">├─sda1        8:1    0   1G  0 part /boot</span><br><span class="line">└─sda2        8:2    0 199G  0 part </span><br><span class="line"> ├─rl-root 253:0    0   70G  0 lvm /</span><br><span class="line"> ├─rl-swap 253:1    0   2G  0 lvm [SWAP]</span><br><span class="line"> └─rl-home 253:2    0 127G  0 lvm /home</span><br><span class="line">sr0          11:0    1 10.5G  0 rom </span><br><span class="line"></span><br><span class="line"><span class="comment">#重启后无法进系统</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># reboot</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用光盘启动,进入Rescue mode,选第3项skip to shell</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置网络</span></span><br><span class="line">ifconfig ens160 10.0.0.158/24</span><br><span class="line"></span><br><span class="line"><span class="comment">#或 ip a 10.0.0.158/24 dev ens160</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从远端拿回分区表信息</span></span><br><span class="line">scp 10.0.0.157:/root/dpt.img .</span><br><span class="line"></span><br><span class="line"><span class="comment">#恢复MBR分区表</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=dpt.img of=/dev/sda bs=1 seek=446</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<p>问题：如何利用分区策略相同的另一台主机的分区表来还原和恢复当前主机破环的分区表？</p>
<h4 id="GPT分区"><a href="#GPT分区" class="headerlink" title="GPT分区"></a>GPT分区</h4><p>GPT：GUID（Globals Unique Identifiers） partition table 支持128个分区，使用64位，支持8Z（ 512Byte/block ）64Z （ 4096Byte/block） </p>
<p>使用128位UUID(Universally Unique Identifier) 表示磁盘和分区，GPT分区表自动备份在头和尾两份， 并有CRC校验位 </p>
<p>UEFI (Unified Extensible Firmware Interface 统一可扩展固件接口)硬件支持GPT，使得操作系统可以启动</p>
<p><strong>GPT分区结构</strong></p>
<p><img src="../../../../images/SRE/day09/10.png" alt="10"></p>
<p>GPT分区结构分为4个区域： </p>
<ul>
<li>GPT头 </li>
<li>分区表 </li>
<li>GPT分区 </li>
<li>备份区域</li>
</ul>
<p>范例：ubuntu默认使用gpt分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu22:~<span class="comment"># fdisk -l /dev/sda</span></span><br><span class="line">Disk /dev/sda: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Disk model: VMware Virtual S</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: D7BA0964-556C-4442-87F5-9B57ACD27E8A</span><br><span class="line"></span><br><span class="line">Device       Start       End   Sectors Size Type</span><br><span class="line">/dev/sda1     2048      4095      2048   1M BIOS boot</span><br><span class="line">/dev/sda2     4096   4198399   4194304   2G Linux filesystem</span><br><span class="line">/dev/sda3  4198400 419428351 415229952 198G Linux filesystem</span><br></pre></td></tr></table></figure>

<h3 id="BIOS和UEFI"><a href="#BIOS和UEFI" class="headerlink" title="BIOS和UEFI"></a>BIOS和UEFI</h3><p>BIOS是固化在电脑主板上的程序，主要用于开机系统自检和引导操作系统。目前新式的电脑基本上都是 UEFI启动 </p>
<p>BIOS（Basic Input Output System 基本输入输出系统）主要完成系统硬件自检和引导操作系统，操作系统开始启动之后，BIOS的任务就完成了。系统硬件自检：如果系统硬件有故障，主板上的扬声器就会发出长短不同的“滴滴”音，可以简单的判断硬件故障，比如“1长1短”通常表示内存故障，“1长3短”通常 表示显卡故障</p>
<p>BIOS在1975年就诞生了，使用汇编语言编写，当初只有16位，因此只能访问1M的内存，其中前640K称为基本内存，后384K内存留给开机和各类BIOS本身使用。BIOS只能识别到主引导记录（MBR）初始化的硬盘，最大支持2T的硬盘，4个主分区（逻辑分区中的扩展分区除 外），而目前普遍实现了64位系统，传统的BIOS已经无法满足需求了，这时英特尔主导的EFI就诞生了 </p>
<p>EFI（Extensible Firmware Interface）可扩展固件接口，是 Intel 为PC 固件的体系结构、接口和服务提出的建议标准。其主要目的是为了提 供一组在 OS 加载之前（启动前）在所有平台上一致的、正确指定的启动服务，被看做是BIOS的继任者，或者理解为新版BIOS。 </p>
<p>UEFI是由EFI1.10为基础发展起来的，它的所有者已不再是Intel，而是一个称作Unified EFI Form的国际组织 </p>
<p>UEFI(Unified Extensible Firmware Interface)统一的可扩展固件接口， 是一种详细描述类型接口的标准。UEFI相当于一个轻量化的操作系统，提供了硬件和操作系统之间的一个接口，提供了图形化的操作界面。最关键的是引入了GPT分区表，支持2T以上的硬盘，硬盘分区不受限制</p>
<p><strong>BIOS和UEFI区别</strong></p>
<p>BIOS采用了16位汇编语言编写，只能运行在实模式（内存寻址方式由16位段寄存器的内容乘以16(10H) 当做段基地址，加上16位偏移地址 形成20位的物理地址）下，可访问的内存空间为1MB，只支持字符操作界面 </p>
<p>UEFI采用32位或者64位的C语言编写，突破了实模式的限制，可以达到最大的寻址空间，支持图形操作界面，使用文件方式保存信息，支持 GPT分区启动，适合和较新的系统和硬件的配合使用</p>
<p><strong>BIOS+MBR与UEFI+GPT</strong></p>
<p><img src="../../../../images/SRE/day09/11.png" alt="11"></p>
<p>MSDN (Microsoft Developer Network) 指出，Windows 只能安装于 BIOS + MBR 或是 UEFI + GPT 的 组合上，而 BIOS + GPT 和 UEFI +  MBR 是不允许的。但是 BIOS + GPT + GRUB 启动Linux 是可以的</p>
<h3 id="管理分区"><a href="#管理分区" class="headerlink" title="管理分区"></a>管理分区</h3><p>列出块设备</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">lsblk [options] [&lt;device&gt; ...]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-a|--all              <span class="comment">#输出所有设备信息</span></span><br><span class="line">-b|--bytes            <span class="comment">#以字节为单位显示设备大小</span></span><br><span class="line">-d|--nodeps           <span class="comment">#不显示分区信息</span></span><br><span class="line">-e|--exclude &lt;list&gt;   <span class="comment">#以主设备号排除设备</span></span><br><span class="line">-f|--fs               <span class="comment">#显示文件系统</span></span><br><span class="line">-i|--ascii            <span class="comment">#只使用 ascii 字符输出</span></span><br><span class="line">-I|--include &lt;list&gt;   <span class="comment">#仅显示指定的设备</span></span><br><span class="line">-J|--json             <span class="comment">#以json格式显示输出</span></span><br><span class="line">-l|--list             <span class="comment">#以列表显示</span></span><br><span class="line">-T|--tree             <span class="comment">#以树状结构显示，默认项</span></span><br><span class="line">-m|--perms            <span class="comment">#显示属主属组及权限</span></span><br><span class="line">-n|--noheadings       <span class="comment">#不显示表头</span></span><br><span class="line">-o|--output &lt;list&gt;    <span class="comment">#只显示指定列</span></span><br><span class="line">-O|--output-all       <span class="comment">#显示所有列</span></span><br><span class="line">-p|--paths            <span class="comment">#显示设备全路径</span></span><br><span class="line">-P|--pairs            <span class="comment">#以 k=&gt;v 的格式显示输出</span></span><br><span class="line">-r|--raw              <span class="comment">#原样输出</span></span><br><span class="line">-s|--inverse          <span class="comment">#反向显示关联信息</span></span><br><span class="line">-S|--scsi             <span class="comment">#显示scsi设备(small computer system interface device,小型计算机接口设备)</span></span><br><span class="line">-t|--topology         <span class="comment">#显示拓扑信息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用字段</span></span><br><span class="line">NAME        <span class="comment">#设备名称</span></span><br><span class="line">MAJ:MIN     <span class="comment">#主设备号:次设备号</span></span><br><span class="line">RM          <span class="comment">#是否是可移动设备</span></span><br><span class="line">SIZE        <span class="comment">#设备容量大小</span></span><br><span class="line">RO          <span class="comment">#是否是只读设备</span></span><br><span class="line">TYPE        <span class="comment">#设备类型</span></span><br><span class="line">MOUNTPOINT  <span class="comment">#挂载点</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky ~]<span class="comment"># lsblk</span></span><br><span class="line">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sr0          11:0    1  1.7G  0 rom  </span><br><span class="line">nvme0n1     259:0    0  200G  0 disk </span><br><span class="line">├─nvme0n1p1 259:1    0  200M  0 part /boot</span><br><span class="line">└─nvme0n1p2 259:2    0  126G  0 part </span><br><span class="line">  ├─rl-root 253:0    0  100G  0 lvm  /</span><br><span class="line">  ├─rl-swap 253:1    0    1G  0 lvm  [SWAP]</span><br><span class="line">  └─rl-home 253:2    0   25G  0 lvm  /home</span><br><span class="line">nvme0n2     259:3    0   20G  0 disk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示全路径</span></span><br><span class="line">[root@rocky ~]<span class="comment"># lsblk -p</span></span><br><span class="line">NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">/dev/sr0                 11:0    1  1.7G  0 rom  </span><br><span class="line">/dev/nvme0n1            259:0    0  200G  0 disk </span><br><span class="line">├─/dev/nvme0n1p1        259:1    0  200M  0 part /boot</span><br><span class="line">└─/dev/nvme0n1p2        259:2    0  126G  0 part </span><br><span class="line">  ├─/dev/mapper/rl-root 253:0    0  100G  0 lvm  /</span><br><span class="line">  ├─/dev/mapper/rl-swap 253:1    0    1G  0 lvm  [SWAP]</span><br><span class="line">  └─/dev/mapper/rl-home 253:2    0   25G  0 lvm  /home</span><br><span class="line">/dev/nvme0n2            259:3    0   20G  0 disk</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示文件系统</span></span><br><span class="line">[root@rocky ~]<span class="comment"># lsblk -f</span></span><br><span class="line">NAME        FSTYPE      FSVER            LABEL                UUID                                   FSAVAIL FSUSE% MOUNTPOINTS</span><br><span class="line">sr0         iso9660     Joliet Extension Rocky-9-4-x86_64-dvd 2024-05-05-01-12-25-00                                </span><br><span class="line">nvme0n1                                                                                                             </span><br><span class="line">├─nvme0n1p1 xfs                                               1e30bccb-53d6-4f26-bc88-018396bfae13     28.4M    85% /boot</span><br><span class="line">└─nvme0n1p2 LVM2_member LVM2 001                              ebXpiz-oYJQ-R3cv-TPPn-iGch-rqNX-nyM96C                </span><br><span class="line">  ├─rl-root xfs                                               94a29cef-4cd4-4a0f-bd79-dd8bf658dcb5       98G     2% /</span><br><span class="line">  ├─rl-swap swap        1                                     a16fb3ee-1e0d-44db-9a79-2622bd7eab3a                  [SWAP]</span><br><span class="line">  └─rl-home xfs                                               663f89cc-4c97-435d-9c66-f992e2a458af     24.7G     1% /home</span><br><span class="line">nvme0n2</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建分区命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fdisk          <span class="comment">#管理MBR分区</span></span><br><span class="line">gdisk          <span class="comment">#管理GPT分区</span></span><br><span class="line">parted         <span class="comment">#高级分区操作，可以是交互或非交互方式</span></span><br><span class="line"></span><br><span class="line">partprobe      <span class="comment">#重新设置内存中的内核分区表版本，适合于除了CentOS 6 以外的其它版本 5，7，8</span></span><br></pre></td></tr></table></figure>

<h4 id="parted-命令"><a href="#parted-命令" class="headerlink" title="parted 命令"></a>parted 命令</h4><p>注意：parted的操作都是实时生效的，没有交互式确认</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">parted [OPTION]... [DEVICE [COMMAND [PARAMETERS]...]...]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-l|--list                                <span class="comment">#显示所有硬盘分区信息</span></span><br><span class="line">-s|--script                              <span class="comment">#不输出提示信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用子命令</span></span><br><span class="line">align-check TYPE N                       <span class="comment">#检查分区是否满足对齐(最小|最佳)类型的对齐方式</span></span><br><span class="line"><span class="built_in">help</span> [COMMAND]                           <span class="comment">#显示命令帮助</span></span><br><span class="line">mklabel|mktable LABEL-TYPE               <span class="comment">#指定磁盘的分区类型 gpt|msdos(mbr)</span></span><br><span class="line">mkpart PART-TYPE [FS-TYPE] START END     <span class="comment">#新建分区,指定分区类型，文件系统，开始结束位置</span></span><br><span class="line">name NUMBER NAME                         <span class="comment">#重命名指定分区</span></span><br><span class="line"><span class="built_in">print</span> [devices|free|list,all|NUMBER]     <span class="comment">#显示</span></span><br><span class="line">quit                                     <span class="comment">#退出</span></span><br><span class="line">rescue START END                         <span class="comment">#空间碎片整理</span></span><br><span class="line">resizepart NUMBER END                    <span class="comment">#重置分区大小</span></span><br><span class="line"><span class="built_in">rm</span> NUMBER                                <span class="comment">#删除指定分区</span></span><br><span class="line">select DEVICE                            <span class="comment">#选择设备</span></span><br><span class="line">disk_set FLAG STATE                      <span class="comment">#为设备打标签</span></span><br><span class="line">disk_toggle [FLAG]                       <span class="comment">#修改flag</span></span><br><span class="line"><span class="built_in">set</span> NUMBER FLAG STATE                    <span class="comment">#设置flag</span></span><br><span class="line">toggle [NUMBER [FLAG]]                   <span class="comment">#修改flag</span></span><br><span class="line">unit UNIT                                <span class="comment">#设置默认单位, 默认为MB，B|KB|MB|GB|TB</span></span><br><span class="line">version                                  <span class="comment">#显示版本</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示所有分区信息</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted -l</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示指定磁盘设备分区信息</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb print</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number Start End Size Type File system Flags</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在磁盘上创建GPT分区</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb mklabel gpt</span></span><br><span class="line">Warning: The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost. Do you </span><br><span class="line">want to <span class="built_in">continue</span>?</span><br><span class="line">Yes/No? <span class="built_in">yes</span>                   </span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb print                                    </span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number Start End Size File system Name Flags</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建分区</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb mkpart primary 1 1001</span></span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb print</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number Start   End     Size   File system Name     Flags</span><br><span class="line">1     1049kB 1001MB 1000MB xfs         primary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次创建</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb mkpart primary 1002 1102</span></span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb print</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number Start   End     Size   File system Name     Flags</span><br><span class="line">1     1049kB 1001MB 1000MB xfs            primary</span><br><span class="line">2     1002MB 1102MB  99.6MB               primary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb rm 2</span></span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># parted /dev/sdb print                                   </span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number Start   End     Size   File system Name     Flags</span><br><span class="line">1     1049kB 1001MB 1000MB xfs         primary</span><br></pre></td></tr></table></figure>

<h4 id="分区工具fdisk和gdisk"><a href="#分区工具fdisk和gdisk" class="headerlink" title="分区工具fdisk和gdisk"></a>分区工具fdisk和gdisk</h4><p><strong>fdisk</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">fdisk [options] &lt;disk&gt;      </span><br><span class="line">fdisk [options] -l [&lt;disk&gt;] </span><br><span class="line"></span><br><span class="line"><span class="comment">#类似于fdisk 的GPT分区工具</span></span><br><span class="line">gdisk [options] [device...] </span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-b|--sector-size &lt;size&gt;      <span class="comment">#指定扇区大小，默认512字节</span></span><br><span class="line">-L|--color[=color]           <span class="comment">#显示时是否添加颜色(auto|always|never)默认启用颜色</span></span><br><span class="line">-l|--list                    <span class="comment">#显示</span></span><br><span class="line">-o|--output &lt;list&gt;           <span class="comment">#只显示指定列</span></span><br><span class="line">-u|--units[=&lt;unit&gt;]          <span class="comment">#设置显示单位 cylinders|sectors，默认sectors</span></span><br><span class="line">-s|--getsz                   <span class="comment">#显示设备有多少个扇区</span></span><br><span class="line">-b|--bytes N                 <span class="comment">#以指定的字节大小来计算扇区数量</span></span><br><span class="line">-t|--<span class="built_in">type</span> <span class="built_in">type</span>               <span class="comment">#只显示指定类型的分区表</span></span><br><span class="line">-C|--cylinders N             <span class="comment">#指定柱面数</span></span><br><span class="line">-H|--heads N                 <span class="comment">#指定磁头数</span></span><br><span class="line">-S|--sectors N               <span class="comment">#指定每条磁道的扇区数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用子命令</span></span><br><span class="line">p                   <span class="comment">#输出分区列表</span></span><br><span class="line">t                   <span class="comment">#更改分区类型</span></span><br><span class="line">n                   <span class="comment">#创建新分区</span></span><br><span class="line">d                   <span class="comment">#删除分区</span></span><br><span class="line">v                   <span class="comment">#校验分区</span></span><br><span class="line">u                   <span class="comment">#转换单位</span></span><br><span class="line">w                   <span class="comment">#保存并退出</span></span><br><span class="line">q                   <span class="comment">#不保存并退出</span></span><br><span class="line">x                   <span class="comment">#高级功能(专家模式)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#不同类型分区可用的列，配合 -o 选项</span></span><br><span class="line">gpt: Device Start End Sectors Size Type Type-UUID Attrs Name UUID</span><br><span class="line">dos: Device Start End Sectors Cylinders Size Type Id Attrs Boot End-C/H/S Start-C/H/S</span><br><span class="line">bsd: Slice Start End Sectors Cylinders Size Type Bsize Cpg Fsize</span><br><span class="line">sgi: Device Start End Sectors Cylinders Size Type Id Attrs</span><br><span class="line">sun: Device Start End Sectors Cylinders Size Type Id Flags</span><br></pre></td></tr></table></figure>

<p>范例：显示分区列表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示所有设备</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fdisk -l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示指定设备</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fdisk -l /dev/sda</span></span><br></pre></td></tr></table></figure>

<p>范例：显示指定列</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky ~]<span class="comment"># fdisk -lo id,size,type /dev/nvme0n1</span></span><br><span class="line">Disk /dev/nvme0n1: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Disk model: VMware Virtual NVMe Disk</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0xafe9c023</span><br><span class="line"></span><br><span class="line">Id  Size Type</span><br><span class="line">83  200M Linux</span><br><span class="line">8e  126G Linux LVM</span><br></pre></td></tr></table></figure>

<p>范例：查看内核是否已经识别新的分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky ~]<span class="comment"># cat /proc/partitions </span></span><br><span class="line">major minor  <span class="comment">#blocks  name</span></span><br><span class="line"></span><br><span class="line"> 259        0  209715200 nvme0n1</span><br><span class="line"> 259        1     204800 nvme0n1p1</span><br><span class="line"> 259        2  132128768 nvme0n1p2</span><br><span class="line"> 259        3   20971520 nvme0n2</span><br><span class="line">  11        0    1786752 sr0</span><br><span class="line"> 253        0  104857600 dm-0</span><br><span class="line"> 253        1    1048576 dm-1</span><br><span class="line"> 253        2   26214400 dm-2</span><br></pre></td></tr></table></figure>

<p><strong>CentOS 7,8 同步分区表</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># partprobe</span></span><br></pre></td></tr></table></figure>

<p><strong>CentOS6 通知内核重新读取硬盘分区表</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新增分区</span></span><br><span class="line"><span class="comment"># partx -a /dev/DEVICE </span></span><br><span class="line"><span class="comment"># kpartx -a /dev/DEVICE -f: force</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># partx -a /dev/sda</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除分区</span></span><br><span class="line"><span class="comment"># partx -d --nr M-N /dev/DEVICE</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># partx -d --nr 6-8 /dev/sda</span></span><br></pre></td></tr></table></figure>

<p>范例: 非交互式创建分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo -e &#x27;n\np\n\n\n+1G\nw&#x27; | fdisk /dev/sdb</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fdisk /dev/sdb &lt;&lt;EOF </span></span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line">+1G</span><br><span class="line">w</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lsblk /dev/sdb</span></span><br><span class="line">NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb      8:16   0 20G  0 disk </span><br><span class="line">├─sdb1   8:17   0   1G  0 part </span><br><span class="line">└─sdb2   8:18   0   1G  0 part </span><br></pre></td></tr></table></figure>

<p><strong>gdisk</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">gdisk [ -l ] device</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用子命令</span></span><br><span class="line">b                         <span class="comment">#备份分区表到指定文件</span></span><br><span class="line">c                         <span class="comment">#修改分区名</span></span><br><span class="line">d                         <span class="comment">#删除分区 </span></span><br><span class="line">i                         <span class="comment">#显示分区详细信息</span></span><br><span class="line">l                         <span class="comment">#列出所有分区类型</span></span><br><span class="line">n                         <span class="comment">#新建分区</span></span><br><span class="line">o                         <span class="comment">#创建新的分区表</span></span><br><span class="line">p                         <span class="comment">#查看分区</span></span><br><span class="line">q                         <span class="comment">#退出</span></span><br><span class="line">r                         <span class="comment">#恢复和转换选项，非专业人士勿用</span></span><br><span class="line">s                         <span class="comment">#排序</span></span><br><span class="line">t                         <span class="comment">#修改分区类型，默认 8300,表示普通分区</span></span><br><span class="line">v                         <span class="comment">#检测硬盘是否有问题</span></span><br><span class="line">w                         <span class="comment">#保存退出</span></span><br><span class="line">x                         <span class="comment">#额外功能，专家模式</span></span><br><span class="line">?                         <span class="comment">#显示帮助</span></span><br></pre></td></tr></table></figure>

<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><h3 id="文件系统概念"><a href="#文件系统概念" class="headerlink" title="文件系统概念"></a>文件系统概念</h3><p>文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构；即在存储设备上组织文件的方法。</p>
<p> 操作系统中负责管理和存储文件信息的软件结构称为文件管理系统，简称文件系统 </p>
<p>从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的 存取，安全控制，日志，压缩，加密等。</p>
<p>查看当前内核支持的文件系统：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rocky8.6</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ls /lib/modules/`uname -r`/kernel/fs</span></span><br><span class="line">binfmt_misc.ko.xz  cifs   ext4    fuse   jbd2          nfs         nls       squashfs</span><br><span class="line">cachefiles         cramfs fat     gfs2   lockd         nfs_common  overlayfs udf</span><br><span class="line">ceph               dlm    fscache isofs  mbcache.ko.xz nfsd        pstore    xfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ubuntu22.04</span></span><br><span class="line">root@ubuntu22:~<span class="comment"># ls /lib/modules/`uname -r`/kernel/fs</span></span><br><span class="line">9p     bfs            coda    f2fs      hfs      ksmbd       nfsd    omfs       quota         ubifs</span><br><span class="line">adfs   binfmt_misc.ko cramfs  fat       hfsplus  lockd       nilfs2  orangefs   reiserfs     udf</span><br><span class="line">affs   btrfs          dlm     freevxfs  hpfs     minix       nls     overlayfs  romfs         ufs</span><br><span class="line">afs    cachefiles     efs     fscache   isofs    netfs       ntfs    pstore     shiftfs.ko   vboxsf</span><br><span class="line">autofs ceph           erofs   fuse      jffs2    nfs         ntfs3   qnx4       smbfs_common xfs</span><br><span class="line">befs   cifs           exfat   gfs2      jfs      nfs_common  ocfs2   qnx6       sysv   zonefs</span><br></pre></td></tr></table></figure>

<p>查看当前系统可用的文件系统：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rocky8.6</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /proc/filesystems </span></span><br><span class="line">nodev sysfs</span><br><span class="line">nodev tmpfs</span><br><span class="line">nodev bdev</span><br><span class="line">nodev proc</span><br><span class="line">nodev cgroup</span><br><span class="line">nodev cgroup2</span><br><span class="line">nodev cpuset</span><br><span class="line">nodev devtmpfs</span><br><span class="line">nodev configfs</span><br><span class="line">nodev debugfs</span><br><span class="line">nodev tracefs</span><br><span class="line">nodev securityfs</span><br><span class="line">nodev sockfs</span><br><span class="line">nodev bpf</span><br><span class="line">nodev pipefs</span><br><span class="line">nodev ramfs</span><br><span class="line">nodev hugetlbfs</span><br><span class="line">nodev devpts</span><br><span class="line">nodev autofs</span><br><span class="line">nodev pstore</span><br><span class="line">nodev mqueue</span><br><span class="line"> fuseblk</span><br><span class="line">nodev fuse</span><br><span class="line">nodev fusectl</span><br><span class="line"> xfs</span><br><span class="line">nodev rpc_pipefs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ubuntu22.04</span></span><br><span class="line">root@ubuntu22:~<span class="comment"># cat /proc/filesystems </span></span><br><span class="line">nodev sysfs</span><br><span class="line">nodev tmpfs</span><br><span class="line">nodev bdev</span><br><span class="line">nodev proc</span><br><span class="line">nodev cgroup</span><br><span class="line">nodev cgroup2</span><br><span class="line">nodev cpuset</span><br><span class="line">nodev devtmpfs</span><br><span class="line">nodev configfs</span><br><span class="line">nodev debugfs</span><br><span class="line">nodev tracefs</span><br><span class="line">nodev securityfs</span><br><span class="line">nodev sockfs</span><br><span class="line">nodev bpf</span><br><span class="line">nodev pipefs</span><br><span class="line">nodev ramfs</span><br><span class="line">nodev hugetlbfs</span><br><span class="line">nodev devpts</span><br><span class="line"> ext3</span><br><span class="line"> ext2</span><br><span class="line"> ext4</span><br><span class="line"> squashfs</span><br><span class="line"> vfat</span><br><span class="line">nodev ecryptfs</span><br><span class="line"> fuseblk</span><br><span class="line">nodev fuse</span><br><span class="line">nodev fusectl</span><br><span class="line">nodev mqueue</span><br><span class="line">nodev pstore</span><br><span class="line"> btrfs</span><br><span class="line">nodev autofs</span><br></pre></td></tr></table></figure>

<p>当前系统支持的文件系统和当前系统可用的文件系统是两回事，modules 中的文件系统在编译时选择了才是可用的，而可用的文件系统包含了默认支持的文件系统，如果需要使用某个文件系统，而该文件系统又不在proc 中，则需要重新编译内核； </p>
<p>各种文件系统：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Comparison_of_file_systems">https://en.wikipedia.org/wiki/Comparison_of_file_systems</a> </p>
<p>帮助：man 5 fs</p>
<h3 id="文件系统类型"><a href="#文件系统类型" class="headerlink" title="文件系统类型"></a>文件系统类型</h3><p><strong>Linux 常用文件系统</strong></p>
<table>
<thead>
<tr>
<th>文件系统</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>ext2</td>
<td>Extended file system 适用于那些分区容量不是太大，更新也不频繁的情况，例如 /boot 分 区</td>
</tr>
<tr>
<td>ext3</td>
<td>ext2 的改进版本，其支持日志功能，能够帮助系统从非正常关机导致的异常中恢复</td>
</tr>
<tr>
<td>ext4</td>
<td>ext 文件系统的最新版。有很多新的特性，包括纳秒级时间戳、巨型文件 (16TB)、最大1EB的文件系统，以及速度的提升</td>
</tr>
<tr>
<td>xfs</td>
<td>SGI，支持最大8EB的文件系统</td>
</tr>
<tr>
<td>swap</td>
<td>交换分区专用的文件系统</td>
</tr>
<tr>
<td>iso9660</td>
<td>光盘文件系统</td>
</tr>
<tr>
<td>btrFS</td>
<td>Oracle公司开发</td>
</tr>
<tr>
<td>reiserFS</td>
<td>最有潜力的文件系统。2008年，由于ReiserFS的创始人Hans Reiser的谋杀罪名成立，导致废弃</td>
</tr>
</tbody></table>
<p><strong>Windows 常用文件系统</strong></p>
<table>
<thead>
<tr>
<th>文件系统</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>FAT32</td>
<td>最多只能支持16TB的文件系统和4GB的文件</td>
</tr>
<tr>
<td>NTFS</td>
<td>最多只能支持16EB的文件系统和16EB的文件</td>
</tr>
<tr>
<td>extFAT</td>
<td></td>
</tr>
</tbody></table>
<p><strong>Unix常用文件系统</strong></p>
<table>
<thead>
<tr>
<th>文件系统</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>FFS(fast)</td>
<td></td>
</tr>
<tr>
<td>UFS(unix)</td>
<td>UFS是UNIX文件系统的简称，几乎是大部分UNIX类操作系统默认的基于磁盘的文件系统</td>
</tr>
<tr>
<td>JFS2</td>
<td></td>
</tr>
</tbody></table>
<p><strong>网络文件系统</strong></p>
<table>
<thead>
<tr>
<th>文件系统</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>NFS</td>
<td>Network File System，即网络文件系统</td>
</tr>
<tr>
<td>CIFS</td>
<td></td>
</tr>
</tbody></table>
<p><strong>集群文件系统</strong></p>
<table>
<thead>
<tr>
<th>文件系统</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>GFS2</td>
<td>基于X86_64，最大文件系统可到100TB</td>
</tr>
<tr>
<td>OCFS2(oracle)</td>
<td></td>
</tr>
</tbody></table>
<p><strong>分布式文件系统</strong></p>
<table>
<thead>
<tr>
<th>文件系统</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>fastdFS</td>
<td></td>
</tr>
<tr>
<td>ceph</td>
<td>不仅仅是一个文件系统，还是一个有企业级功能的对象存储生态环境</td>
</tr>
<tr>
<td>mooseFS</td>
<td></td>
</tr>
<tr>
<td>mogileFS</td>
<td></td>
</tr>
<tr>
<td>glusterFS</td>
<td></td>
</tr>
<tr>
<td>Lustre</td>
<td></td>
</tr>
</tbody></table>
<p><strong>RAW</strong> </p>
<p>裸文件系统,未经处理或者未经格式化产生的文件系统</p>
<p><strong>常用的文件系统特性：</strong></p>
<p><strong>FAT32</strong> </p>
<p>最多只能支持16TB的文件系统和4GB的文件 </p>
<p><strong>NTFS</strong> </p>
<p>最多只能支持16EB的文件系统和16EB的文件 </p>
<p><strong>EXT3</strong> </p>
<ul>
<li>最多只能支持32TB的文件系统和2TB的文件，实际只能容纳2TB的文件系统和16GB的文件 </li>
<li>Ext3目前只支持32000个子目录 </li>
<li>Ext3文件系统使用32位空间记录块数量和 inode数量 </li>
<li>当数据写入到Ext3文件系统中时，Ext3的数据块分配器每次只能分配一个4KB的块 </li>
</ul>
<p><strong>EXT4</strong> </p>
<ul>
<li>EXT4是Linux系统下的日志文件系统，是EXT3文件系统的后继版本 </li>
<li>Ext4的文件系统容量达到1EB，而支持单个文件则达到16TB  </li>
<li>理论上支持无限数量的子目录 </li>
<li>Ext4文件系统使用64位空间记录块数量和 inode数量 </li>
<li>Ext4的多块分配器支持一次调用分配多个数据块 </li>
<li>修复速度更快 </li>
</ul>
<p><strong>XFS</strong> </p>
<ul>
<li>根据所记录的日志在很短的时间内迅速恢复磁盘文件内容 </li>
<li>用优化算法，日志记录对整体文件操作影响非常小 </li>
<li>是一个全64-bit的文件系统，最大可以支持8EB的文件系统，而支持单个文件则达到8EB  </li>
<li>能以接近裸设备I/O的性能存储数据</li>
</ul>
<h3 id="文件系统的组成部分"><a href="#文件系统的组成部分" class="headerlink" title="文件系统的组成部分"></a>文件系统的组成部分</h3><ul>
<li>内核中的模块：ext4, xfs, vfat  </li>
<li>Linux的虚拟文件系统：VFS  </li>
<li>用户空间的管理工具：mkfs.ext4, mkfs.xfs,mkfs.vfat</li>
</ul>
<p><img src="../../../../images/SRE/day09/12.png" alt="12"></p>
<h3 id="文件系统选择管理"><a href="#文件系统选择管理" class="headerlink" title="文件系统选择管理"></a>文件系统选择管理</h3><h4 id="创建文件系统"><a href="#创建文件系统" class="headerlink" title="创建文件系统"></a>创建文件系统</h4><p><strong>mkfs</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mkfs [options] [-t &lt;<span class="built_in">type</span>&gt;] [fs-options] &lt;device&gt; [&lt;size&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-t|--<span class="built_in">type</span>=model           <span class="comment">#指定文件系统类型 (ext2|ext3|ext4|xfs)，默认 ext2</span></span><br><span class="line">-b                        <span class="comment">#指定块 block 大小 (1024|2048|4096)</span></span><br><span class="line">-L LABEL                  <span class="comment">#设置卷标</span></span><br><span class="line">-V|--verbose              <span class="comment">#显示创建过程</span></span><br><span class="line">-j                        <span class="comment">#同 -t ext3</span></span><br><span class="line">-i N                      <span class="comment">#为数据空间中每多少个字节创建一个inode；不应该小于block大小</span></span><br><span class="line">-N N                      <span class="comment">#指定分区中创建多少个inode</span></span><br><span class="line">-I N                      <span class="comment">#一个inode记录占用的磁盘空间大小，128---4096</span></span><br><span class="line">-m N                      <span class="comment">#默认5%,为管理人员预留空间占总空间的百分比</span></span><br><span class="line">-O FEATURE[,...]          <span class="comment">#启用指定特性</span></span><br><span class="line">-O ^FEATURE               <span class="comment">#关闭指定特性</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建ext4 文件系统</span></span><br><span class="line"><span class="comment">#mkfs.ext4 /dev/sdc1 等同于 mkfs -t ext4 /dev/sdc1</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mkfs.ext4 /dev/sdc1</span></span><br><span class="line">mke2fs 1.45.6 (20-Mar-2020)</span><br><span class="line">Creating filesystem with 262144 4k blocks and 65536 inodes</span><br><span class="line">Filesystem UUID: 80402d09-2ec9-423a-a13a-fb25df9774da</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line"> 32768, 98304, 163840, 229376</span><br><span class="line"> </span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (8192 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建xfs文件系统</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mkfs.xfs /dev/sdc2 </span></span><br><span class="line">meta-data=/dev/sdc2              isize=512    agcount=4, agsize=131072 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=1, sparse=1, rmapbt=0</span><br><span class="line">         =                       reflink=1    bigtime=0 inobtcount=0</span><br><span class="line">data     =                       bsize=4096   blocks=524288, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0, ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>

<p>范例：查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># lsblk -f</span></span><br><span class="line">NAME       FSTYPE     LABEL               UUID                                   MOUNTPOINT</span><br><span class="line">sda                                                                                 </span><br><span class="line">├─sda1     xfs                             94a73757-555a-4d2b-8153-f54277c4c50d   /boot</span><br><span class="line">└─sda2     LVM2_member                     qLmfIa-YvfP-3Du3-dwVG-a0qM-eZRR-uP3P80 </span><br><span class="line"> ├─rl-root xfs                             bd1ab1fd-ee1c-4908-a7b3-e83a170adda9   /</span><br><span class="line"> ├─rl-swap swap                            c6f13a3f-a2f3-4ba7-a591-879f476fdd1a   [SWAP]</span><br><span class="line"> └─rl-home xfs                             22a09cff-b3f2-48c5-b251-c1c4af9b11b7   /home</span><br><span class="line">sdb                                                                                 </span><br><span class="line">├─sdb1                                                                              </span><br><span class="line">├─sdb2                                                                              </span><br><span class="line">├─sdb5                                                                              </span><br><span class="line">└─sdb6                                                                              </span><br><span class="line">sdc                                                                                 </span><br><span class="line">├─sdc1     ext4                            a7751b8e-da27-447e-9466-79127e0850af   </span><br><span class="line">└─sdc2     xfs                             205ecdf1-1f0e-495d-a1ab-2f74b6ab98a0   </span><br><span class="line">sr0        iso9660                         Rocky-8-6-x86_64-dvd 2022-05-15-21-06-44-00   </span><br><span class="line"></span><br><span class="line"><span class="comment">#df 只能查看己挂载的设备</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># df -l</span></span><br><span class="line">Filesystem         1K-blocks     Used Available Use% Mounted on</span><br><span class="line">devtmpfs               883748        0    883748   0% /dev</span><br><span class="line">tmpfs                  914116        0    914116   0% /dev/shm</span><br><span class="line">tmpfs                  914116     9536    904580   2% /run</span><br><span class="line">tmpfs                  914116        0    914116   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root  73364480 11770668  61593812  17% /</span><br><span class="line">/dev/mapper/rl-home 133071376   961128 132110248   1% /home</span><br><span class="line">/dev/sda1             1038336   260336    778000  26% /boot</span><br><span class="line">tmpfs                  182820       12    182808   1% /run/user/42</span><br><span class="line">tmpfs                  182820        0    182820   0% /run/user/0</span><br></pre></td></tr></table></figure>

<p><strong>mke2fs</strong></p>
<p>ext系列文件系统专用管理工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mke2fs [OPTION]... DEVICE </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-t                          <span class="comment">#指定文件系统类型 &#123;ext2|ext3|ext4|xfs&#125; </span></span><br><span class="line">-b                          <span class="comment">#指定块大小&#123;1024|2048|4096&#125; </span></span><br><span class="line">-L LABEL                    <span class="comment">#设置卷标</span></span><br><span class="line">-j                          <span class="comment">#同 -t ext3，mkfs.ext3|mkfs -t ext3|mke2fs -j|mke2fs -t ext3</span></span><br><span class="line">-i N                        <span class="comment">#为数据空间中每多少个字节创建一个inode 不应该小于block大小</span></span><br><span class="line">-N N                        <span class="comment">#指定分区中创建多少个inode</span></span><br><span class="line">-I N                        <span class="comment">#一个inode记录占用的磁盘空间大小，128---4096</span></span><br><span class="line">-m N                        <span class="comment">#默认5%,为管理人员预留空间占总空间的百分比 </span></span><br><span class="line">-O FEATURE[,...]            <span class="comment">#启用指定特性</span></span><br><span class="line">-O ^FEATURE                 <span class="comment">#关闭指定特性</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="查看和管理分区信息"><a href="#查看和管理分区信息" class="headerlink" title="查看和管理分区信息"></a>查看和管理分区信息</h4><p><strong>blkid</strong></p>
<p>查看块设备属性信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">blkid [OPTION]... [DEVICE]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-U UUID                 <span class="comment">#根据指定的UUID来查找对应的设备</span></span><br><span class="line">-L LABEL                <span class="comment">#根据指定的LABEL来查找对应的设备</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示所有</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># blkid</span></span><br><span class="line">/dev/sdc1: UUID=<span class="string">&quot;a7751b8e-da27-447e-9466-79127e0850af&quot;</span> BLOCK_SIZE=<span class="string">&quot;4096&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTLABEL=<span class="string">&quot;Linux </span></span><br><span class="line"><span class="string">filesystem&quot;</span> PARTUUID=<span class="string">&quot;45ac71ce-1e51-4e92-ab43-7e7c71bab06a&quot;</span></span><br><span class="line">/dev/sr0: BLOCK_SIZE=<span class="string">&quot;2048&quot;</span> UUID=<span class="string">&quot;2022-05-15-21-06-44-00&quot;</span> LABEL=<span class="string">&quot;Rocky-8-6-x86_64-dvd&quot;</span> TYPE=<span class="string">&quot;iso9660&quot;</span></span><br><span class="line">PTUUID=<span class="string">&quot;6b8b4567&quot;</span> PTTYPE=<span class="string">&quot;dos&quot;</span></span><br><span class="line">/dev/sda1: UUID=<span class="string">&quot;94a73757-555a-4d2b-8153-f54277c4c50d&quot;</span> BLOCK_SIZE=<span class="string">&quot;512&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> PARTUUID=<span class="string">&quot;3475e2b0-01&quot;</span></span><br><span class="line">/dev/sda2: UUID=<span class="string">&quot;qLmfIa-YvfP-3Du3-dwVG-a0qM-eZRR-uP3P80&quot;</span> TYPE=<span class="string">&quot;LVM2_member&quot;</span> PARTUUID=<span class="string">&quot;3475e2b0-02&quot;</span></span><br><span class="line">/dev/mapper/rl-root: UUID=<span class="string">&quot;bd1ab1fd-ee1c-4908-a7b3-e83a170adda9&quot;</span> BLOCK_SIZE=<span class="string">&quot;512&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span></span><br><span class="line">/dev/mapper/rl-swap: UUID=<span class="string">&quot;c6f13a3f-a2f3-4ba7-a591-879f476fdd1a&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span></span><br><span class="line">/dev/mapper/rl-home: UUID=<span class="string">&quot;22a09cff-b3f2-48c5-b251-c1c4af9b11b7&quot;</span> BLOCK_SIZE=<span class="string">&quot;512&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span></span><br><span class="line">/dev/sdc2: UUID=<span class="string">&quot;205ecdf1-1f0e-495d-a1ab-2f74b6ab98a0&quot;</span> BLOCK_SIZE=<span class="string">&quot;512&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> PARTLABEL=<span class="string">&quot;Linux </span></span><br><span class="line"><span class="string">filesystem&quot;</span> PARTUUID=<span class="string">&quot;26bf9878-a529-4a07-be62-f854f86941da&quot;</span></span><br><span class="line">/dev/sdb1: PARTUUID=<span class="string">&quot;a5cc5319-01&quot;</span></span><br><span class="line">/dev/sdb5: PARTUUID=<span class="string">&quot;a5cc5319-05&quot;</span></span><br><span class="line">/dev/sdb6: PARTUUID=<span class="string">&quot;a5cc5319-06&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查询</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># blkid -U &quot;c6f13a3f-a2f3-4ba7-a591-879f476fdd1a&quot;</span></span><br><span class="line">/dev/mapper/rl-swap</span><br></pre></td></tr></table></figure>

<p><strong>e2label</strong></p>
<p>管理ext系列文件系统的LABEL</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e2label DEVICE [LABEL]</span><br></pre></td></tr></table></figure>

<p><strong>findfs</strong></p>
<p>查找分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">findfs [options] LABEL=&lt;label&gt;</span><br><span class="line">findfs [options] UUID=&lt;uuid&gt;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#findfs UUID=f7f53add-b184-4ddc-8d2c-5263b84d1e15</span></span><br><span class="line">/dev/sda2</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#findfs `sed -En &#x27;/data/s#^([^ ]+).*#\1#p&#x27; /etc/fstab`</span></span><br><span class="line">/dev/sda3</span><br></pre></td></tr></table></figure>

<p><strong>tune2fs</strong></p>
<p>重新设定ext系列文件系统可调整参数的值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tune2fs [OPTION]... [DEVICE]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-l                         <span class="comment">#查看指定文件系统信息</span></span><br><span class="line">-L LABEL                   <span class="comment">#修改卷标</span></span><br><span class="line">-m N                       <span class="comment">#修预留给管理员的空间百分比</span></span><br><span class="line">-j                         <span class="comment">#将ext2升级为ext3</span></span><br><span class="line">-O                         <span class="comment">#文件系统属性启用或禁用, -O ^has_journal</span></span><br><span class="line">-o                         <span class="comment">#调整文件系统的默认挂载选项，-o ^acl </span></span><br><span class="line">-U UUID                    <span class="comment">#修改UUID号</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># tune2fs -l /dev/sdc1</span></span><br><span class="line">tune2fs 1.45.6 (20-Mar-2020)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:          &lt;not available&gt;</span><br><span class="line">Filesystem UUID:          a7751b8e-da27-447e-9466-79127e0850af</span><br><span class="line">Filesystem magic number:  0xEF53</span><br><span class="line">Filesystem revision <span class="comment">#:    1 (dynamic)</span></span><br><span class="line">Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg </span><br><span class="line">sparse_super large_file huge_file dir_nlink extra_isize metadata_csum</span><br><span class="line">Filesystem flags:         signed_directory_hash </span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p><strong>dumpe2fs</strong></p>
<p>显示ext文件系统信息，将磁盘块分组管理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dumpe2fs [OPTION]... [DEVICE]</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># dumpe2fs /dev/sdc1</span></span><br><span class="line">dumpe2fs 1.45.6 (20-Mar-2020)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:         &lt;not available&gt;</span><br><span class="line">Filesystem UUID:         a7751b8e-da27-447e-9466-79127e0850af</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看超级块信息</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># dumpe2fs -h /dev/sdc1</span></span><br><span class="line">dumpe2fs 1.45.6 (20-Mar-2020)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:         &lt;not available&gt;</span><br><span class="line">Filesystem UUID:         a7751b8e-da27-447e-9466-79127e0850af</span><br><span class="line">Filesystem magic number: 0xEF53</span><br><span class="line">Filesystem revision <span class="comment">#:   1 (dynamic)</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p><strong>xfs_info</strong></p>
<p>显示已挂载的 xfs 文件系统信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfs_info mountpoint|devname</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># xfs_info /dev/sda7</span></span><br><span class="line">meta-data=/dev/sda7              isize=512    agcount=4, agsize=131072 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=1, sparse=1, rmapbt=0</span><br><span class="line">         =                       reflink=1</span><br><span class="line">data     =                       bsize=4096   blocks=524288, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0, ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>

<h4 id="文件系统检测和修复"><a href="#文件系统检测和修复" class="headerlink" title="文件系统检测和修复"></a>文件系统检测和修复</h4><p>文件系统夹故障常发生于死机或者非正常关机之后，挂载为文件系统标记为“no clean” </p>
<p><code>注意：一定不要在挂载状态下执行下面命令修复</code></p>
<p><strong>fsck</strong></p>
<p>fsck: File System Check</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fsck [options] -- [fs-options] [&lt;filesystem&gt; ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-a                      <span class="comment">#自动修复</span></span><br><span class="line">-r                      <span class="comment">#交互式修复错误</span></span><br></pre></td></tr></table></figure>



<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># fsck.ext4 /dev/sdc1 </span></span><br><span class="line">e2fsck 1.45.6 (20-Mar-2020)</span><br><span class="line">/dev/sdc1: clean, 11/65536 files, 12955/262144 blocks</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># fsck -t ext4 /dev/sdc1 </span></span><br><span class="line">fsck from util-linux 2.32.1</span><br><span class="line">e2fsck 1.45.6 (20-Mar-2020)</span><br><span class="line">/dev/sdc1: clean, 11/65536 files, 12955/262144 blocks</span><br></pre></td></tr></table></figure>

<p><strong>e2fsck</strong> </p>
<p>ext系列文件专用的检测修复工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">e2fsck [options] -- [fs-options] [&lt;filesystem&gt; ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-y                    <span class="comment">#自动回答为yes</span></span><br><span class="line">-f                    <span class="comment">#强制修复</span></span><br><span class="line">-p                    <span class="comment">#自动进行安全的修复文件系统问题</span></span><br></pre></td></tr></table></figure>

<p><strong>xfs_repair</strong></p>
<p>xfs文件系统专用检测修复工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xfs_repair [options] device</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-f                       <span class="comment">#修复文件，而设备</span></span><br><span class="line">-n                       <span class="comment">#只检查</span></span><br><span class="line">-d                       <span class="comment">#允许修复只读的挂载设备，在单用户下修复 / 时使用，然后立即reboot</span></span><br></pre></td></tr></table></figure>

<p>范例：修改破坏的ext文件系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#mount /dev/sdb2 /mnt</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#cp /etc/fstab /mnt/f1</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#cp /etc/fstab /mnt/f2</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#ls /mnt</span></span><br><span class="line">f1 f2 lost+found</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#dd if=/dev/zero of=/dev/sdb2 bs=1M count=1</span></span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00128317 s, 817 MB/s</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#ls /mnt</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#tune2fs -l /dev/sdb2</span></span><br><span class="line">tune2fs 1.44.6 (5-Mar-2019)</span><br><span class="line">tune2fs: Bad magic number <span class="keyword">in</span> super-block <span class="keyword">while</span> trying to open /dev/sdb2</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#df</span></span><br><span class="line">Filesystem               1K-blocks                 Used Available Use% Mounted </span><br><span class="line">on</span><br><span class="line">devtmpfs                     391676                    0    391676   0% /dev</span><br><span class="line">tmpfs                        408092                    0    408092   0% /dev/shm</span><br><span class="line">tmpfs                        408092                 5824    402268   2% /run</span><br><span class="line">tmpfs                        408092                    0    408092   0% </span><br><span class="line">/sys/fs/cgroup</span><br><span class="line">/dev/sda2                 104806400              4381120 100425280   5% /</span><br><span class="line">/dev/sda3                  52403200               398584  52004616   1% /data</span><br><span class="line">/dev/sda1                    999320               130848    799660  15% /boot</span><br><span class="line">tmpfs                         81616                    0     81616   0% </span><br><span class="line">/run/user/0</span><br><span class="line">/dev/sdb2      73786976294838107984 73786976294836115464   1976136 100% /mnt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#umount /mnt</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#e2fsck /dev/sdb2</span></span><br><span class="line">e2fsck 1.44.6 (5-Mar-2019)</span><br><span class="line">ext2fs_open2: Bad magic number <span class="keyword">in</span> super-block</span><br><span class="line">e2fsck: Superblock invalid, trying backup blocks...</span><br><span class="line"><span class="built_in">test</span> was not cleanly unmounted, check forced.</span><br><span class="line">Resize inode not valid. Recreate&lt;y&gt;? <span class="built_in">yes</span></span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">Block bitmap differences:  +(98304--98560) +(163840--164096) +(229376--229632) +</span><br><span class="line">(294912--295168)</span><br><span class="line">Fix&lt;y&gt;? <span class="built_in">yes</span></span><br><span class="line">Free blocks count wrong <span class="keyword">for</span> group <span class="comment">#0 (24280, counted=24281).</span></span><br><span class="line">Fix&lt;y&gt;? </span><br><span class="line"><span class="built_in">test</span>: e2fsck canceled.</span><br><span class="line"><span class="built_in">test</span>: ***** FILE SYSTEM WAS MODIFIED *****</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#e2fsck /dev/sdb2 -y</span></span><br><span class="line">e2fsck 1.44.6 (5-Mar-2019)</span><br><span class="line"><span class="built_in">test</span> was not cleanly unmounted, check forced.</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">Free blocks count wrong <span class="keyword">for</span> group <span class="comment">#0 (24280, counted=24281).</span></span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line">Free blocks count wrong <span class="keyword">for</span> group <span class="comment">#1 (32511, counted=32509).</span></span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line">Free blocks count wrong (498131, counted=498130).</span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line">Free inodes count wrong <span class="keyword">for</span> group <span class="comment">#0 (8181, counted=8179).</span></span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line">Free inodes count wrong (131061, counted=131059).</span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line">Padding at end of inode bitmap is not <span class="built_in">set</span>. Fix? <span class="built_in">yes</span></span><br><span class="line"><span class="built_in">test</span>: ***** FILE SYSTEM WAS MODIFIED *****</span><br><span class="line"><span class="built_in">test</span>: 13/131072 files (0.0% non-contiguous), 26158/524288 blocks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#tune2fs -l /dev/sdb2</span></span><br><span class="line">tune2fs 1.44.6 (5-Mar-2019)</span><br><span class="line">Filesystem volume name:   <span class="built_in">test</span></span><br><span class="line">Last mounted on:         &lt;not available&gt;</span><br><span class="line">Filesystem UUID:         c44b3a40-70dc-44d2-8427-b8094f73940a</span><br><span class="line">Filesystem magic number: 0xEF53</span><br><span class="line">Filesystem revision <span class="comment">#:   1 (dynamic)</span></span><br><span class="line">Filesystem features:     has_journal ext_attr resize_inode dir_index filetype </span><br><span class="line">extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize </span><br><span class="line">metadata_csum</span><br><span class="line">Filesystem flags:         signed_directory_hash </span><br><span class="line">Default mount options:   user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">Errors behavior:         Continue</span><br><span class="line">Filesystem OS <span class="built_in">type</span>:       Linux</span><br><span class="line">Inode count:              131072</span><br><span class="line">Block count:              524288</span><br><span class="line">Reserved block count:     26214</span><br><span class="line">Free blocks:              498130</span><br><span class="line">Free inodes:              131059</span><br><span class="line">First block:              0</span><br><span class="line">Block size:               4096</span><br><span class="line">Fragment size:            4096</span><br><span class="line">Group descriptor size:    64</span><br><span class="line">Reserved GDT blocks:      255</span><br><span class="line">Blocks per group:         32768</span><br><span class="line">Fragments per group:      32768</span><br><span class="line">Inodes per group:         8192</span><br><span class="line">Inode blocks per group:   512</span><br><span class="line">Flex block group size:    16</span><br><span class="line">Filesystem created:       Mon Apr 13 16:10:06 2020</span><br><span class="line">Last mount time:         n/a</span><br><span class="line">Last write time:         Mon Apr 13 16:57:21 2020</span><br><span class="line">Mount count:              0</span><br><span class="line">Maximum mount count:      -1</span><br><span class="line">Last checked:             Mon Apr 13 16:57:21 2020</span><br><span class="line">Check interval:           0 (&lt;none&gt;)</span><br><span class="line">Lifetime writes:          130 MB</span><br><span class="line">Reserved blocks uid:      0 (user root)</span><br><span class="line">Reserved blocks gid:      0 (group root)</span><br><span class="line">First inode:              11</span><br><span class="line">Inode size:          256</span><br><span class="line">Required extra isize:     32</span><br><span class="line">Desired extra isize:      32</span><br><span class="line">Journal inode:            8</span><br><span class="line">Default directory <span class="built_in">hash</span>:   half_md4</span><br><span class="line">Directory Hash Seed:     8d4f1f25-ab7c-4fb2-b45d-3d23974edede</span><br><span class="line">Journal backup:           inode blocks</span><br><span class="line">Checksum <span class="built_in">type</span>:           crc32c</span><br><span class="line">Checksum:                 0x7f222e49</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#mount /dev/sdb2 /mnt</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#ls /mnt</span></span><br><span class="line">f1 f2 lost+found</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#cat /mnt/f1 </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Wed Jan 15 21:39:15 2020</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk/&#x27;.</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># After editing this file, run &#x27;systemctl daemon-reload&#x27; to update systemd</span></span><br><span class="line"><span class="comment"># units generated from this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=f7f53add-b184-4ddc-8d2c-5263b84d1e15 /                   xfs     defaults         0 0</span><br><span class="line">UUID=5c2216e3-ae34-444e-aa60-83cbaebb47e7 /boot               ext4     defaults        1 2</span><br><span class="line">UUID=9a2293a8-9277-4b18-bae1-498e0b9da145 /data                 xfs     defaults        0 0</span><br><span class="line">UUID=eebe3bc7-6d52-4ad9-86aa-916f1a123fd4 swap                 swap   defaults        0 0</span><br></pre></td></tr></table></figure>

<h2 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h2><p>挂载：将额外文件系统与根文件系统某现存的目录建立起关联关系，进而使得此目录做为其它文件访问入口的行为 </p>
<p>卸载：为解除此关联关系的过程 </p>
<p>把设备关联挂载点：mount Point </p>
<p>挂载点下原有文件在挂载完成后会被临时隐藏，因此，挂载点目录一般为空。进程正在使用中的设备无法被卸载</p>
<h3 id="挂载文件系统-mount"><a href="#挂载文件系统-mount" class="headerlink" title="挂载文件系统 mount"></a>挂载文件系统 mount</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount [-lhV]</span><br><span class="line">mount -a [options]</span><br><span class="line">mount [options] [--<span class="built_in">source</span>] &lt;<span class="built_in">source</span>&gt; | [--target] &lt;directory&gt;</span><br><span class="line">mount [options] &lt;<span class="built_in">source</span>&gt; &lt;directory&gt;</span><br><span class="line">mount &lt;operation&gt; &lt;mountpoint&gt; [&lt;target&gt;]</span><br></pre></td></tr></table></figure>

<p><strong>device：指明要挂载的设备</strong></p>
<ul>
<li>设备文件：例如:/dev/sda5</li>
<li>卷标：-L ‘LABEL’, 例如 -L ‘MYDATA’</li>
<li>UUID： -U ‘UUID’：例如 -U ‘0c50523c-43f1-45e7-85c0-a126711d406e’ </li>
<li>伪文件系统名称：proc, sysfs, devtmpfs, configfs</li>
</ul>
<p><strong>mountpoint</strong>：挂载点目录必须事先存在，建议使用空目录</p>
<p><strong>挂载规则:</strong></p>
<ul>
<li>一个挂载点同一时间只能挂载一个设备 </li>
<li>一个挂载点同一时间挂载了多个设备，只能看到最后一个设备的数据，其它设备上的数据将被隐藏 </li>
<li>一个设备可以同时挂载到多个挂载点 </li>
<li>通常挂载点一般是已存在空的目录</li>
</ul>
<p><strong>mount 常用命令选项</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">-a|--all                  <span class="comment">#自动挂载所有支持自动挂载的设备(定义在了/etc/fstab文件中，且挂载选项中有auto功能)</span></span><br><span class="line">-B|--<span class="built_in">bind</span>                 <span class="comment">#绑定目录到另一个目录上</span></span><br><span class="line">-c|--no-canonicalize      <span class="comment">#不对路径规范化</span></span><br><span class="line">-f|--fake                 <span class="comment">#空运行；跳过 mount(2) 系统调用</span></span><br><span class="line">-F|--fork                 <span class="comment">#对每个设备禁用 fork，配合-a 选项一起使用</span></span><br><span class="line">-T|--fstab path           <span class="comment">#指定写文件，默认 /etc/fstab</span></span><br><span class="line">-i|--internal-only        <span class="comment">#不调用 mount.&lt;type&gt; 辅助程序</span></span><br><span class="line">-l|--show-labels          <span class="comment">#显示文件系统的 labels</span></span><br><span class="line">-n|--no-mtab              <span class="comment">#不更新/etc/mtab，mount不可见</span></span><br><span class="line">-o|--options o1,o2        <span class="comment">#挂载选项列表，以英文逗号分隔</span></span><br><span class="line">-O|--test-opts o1,o2      <span class="comment">#限制文件系统集合(和 -a 选项一起使用)</span></span><br><span class="line">-r|--read-only            <span class="comment">#以只读方式挂载文件系统(同 -o ro)</span></span><br><span class="line">-t|--types                <span class="comment">#指定要挂载的设备上的文件系统类型,如:ext4,xfs</span></span><br><span class="line">--<span class="built_in">source</span> device           <span class="comment">#指明源(路径、标签、uuid)</span></span><br><span class="line">--target mountpoint       <span class="comment">#指明挂载点</span></span><br><span class="line">-v|--verbose              <span class="comment">#显示过程</span></span><br><span class="line">-w|--rw|--read-write      <span class="comment">#以读写方式挂载文件系统(默认)</span></span><br><span class="line">-L LABEL                  <span class="comment">#以卷标指定挂载设备</span></span><br><span class="line">-U UUID                   <span class="comment">#以UUID指定要挂载的设备</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-o选项值</span></span><br><span class="line">async                     <span class="comment">#异步模式,内存更改时,写入缓存区buffer,过一段时间再写到磁盘中，效率高，但不安全</span></span><br><span class="line"><span class="built_in">sync</span>                      <span class="comment">#同步模式,内存更改时，同时写磁盘，安全，但效率低下</span></span><br><span class="line">atime/noatime             <span class="comment">#包含目录和文件</span></span><br><span class="line">diratime/nodiratime       <span class="comment">#目录的访问时间戳</span></span><br><span class="line">auto/noauto               <span class="comment">#是否支持开机自动挂载，是否支持-a选项</span></span><br><span class="line"><span class="built_in">exec</span>/noexec               <span class="comment">#是否支持将文件系统上运行应用程序</span></span><br><span class="line">dev/nodev                 <span class="comment">#是否支持在此文件系统上使用设备文件</span></span><br><span class="line">suid/nosuid               <span class="comment">#是否支持suid和sgid权限</span></span><br><span class="line">remount                   <span class="comment">#重新挂载</span></span><br><span class="line">ro/rw                     <span class="comment">#只读/读写   </span></span><br><span class="line">user/nouser               <span class="comment">#是否允许普通用户挂载此设备，/etc/fstab使用</span></span><br><span class="line">acl/noacl                 <span class="comment">#启用此文件系统上的acl功能</span></span><br><span class="line">loop                      <span class="comment">#使用loop设备</span></span><br><span class="line">_netdev                   <span class="comment">#当网络可用时才对网络资源进行挂载，如：NFS文件系统</span></span><br><span class="line">defaults                  <span class="comment">#相当于rw, suid, dev, exec, auto, nouser, async</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--source 选项值</span></span><br><span class="line">-L|--label label          <span class="comment">#同 LABEL=label</span></span><br><span class="line">-U|--uuid uuid            <span class="comment">#同 UUID=uuid</span></span><br><span class="line">LABEL=label               <span class="comment">#用label值指定设备</span></span><br><span class="line">UUID=uuid                 <span class="comment">#用uuid值指定设备</span></span><br><span class="line">PARTLABEL=label           <span class="comment">#按PARTLABEL值指定设备</span></span><br><span class="line">PARTUUID=uuid             <span class="comment">#按PARTUUID值指定设备</span></span><br><span class="line">device                    <span class="comment">#按路径指定设备</span></span><br><span class="line">directory                 <span class="comment">#绑定式挂载的挂载点(参阅 --bind/rbind)</span></span><br><span class="line">file                      <span class="comment">#用于设置回环设备的常规文件</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># lsblk /dev/sdc -f</span></span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">sdc                                                      </span><br><span class="line">├─sdc1 ext4         a7751b8e-da27-447e-9466-79127e0850af </span><br><span class="line">└─sdc2 xfs          205ecdf1-1f0e-495d-a1ab-2f74b6ab98a0 </span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mkdir /sdc&#123;1,2&#125;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mount /dev/sdc1 /sdc1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#只读挂载</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mount --source /dev/sdc2 -o ro /sdc2</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lsblk /dev/sdc -f</span></span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">sdc                                                      </span><br><span class="line">├─sdc1 ext4         a7751b8e-da27-447e-9466-79127e0850af /sdc1</span><br><span class="line">└─sdc2 xfs          205ecdf1-1f0e-495d-a1ab-2f74b6ab98a0 /sdc2</span><br><span class="line"></span><br><span class="line"><span class="comment">#写测试</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cp /etc/fstab /sdc1/</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cp /etc/fstab /sdc2/</span></span><br><span class="line"><span class="built_in">cp</span>: cannot create regular file <span class="string">&#x27;/sdc2/fstab&#x27;</span>: Read-only file system</span><br></pre></td></tr></table></figure>

<h3 id="卸载文件系统-umount"><a href="#卸载文件系统-umount" class="headerlink" title="卸载文件系统 umount"></a>卸载文件系统 umount</h3><p>卸载时：可使用设备，也可以使用挂载点</p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">umount [-hV]</span><br><span class="line">umount -a [options]</span><br><span class="line">umount [options] &lt;<span class="built_in">source</span>&gt; | &lt;directory&gt;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># lsblk /dev/sdc -f</span></span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">sdc                                                      </span><br><span class="line">├─sdc1 ext4         a7751b8e-da27-447e-9466-79127e0850af /sdc1</span><br><span class="line">└─sdc2 xfs          205ecdf1-1f0e-495d-a1ab-2f74b6ab98a0 /sdc2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设备卸载</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># umount /dev/sdc1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载点卸载</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># umount /sdc2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看挂载情况</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lsblk /dev/sdc -f</span></span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">sdc                                                      </span><br><span class="line">├─sdc1 ext4         a7751b8e-da27-447e-9466-79127e0850af </span><br><span class="line">└─sdc2 xfs          205ecdf1-1f0e-495d-a1ab-2f74b6ab98a0 </span><br></pre></td></tr></table></figure>

<h3 id="查看挂载情况"><a href="#查看挂载情况" class="headerlink" title="查看挂载情况"></a>查看挂载情况</h3><p><strong>查看挂载</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount                 <span class="comment">#通过mount命令查看</span></span><br><span class="line"><span class="built_in">cat</span> /etc/mtab         <span class="comment">#通过查看/etc/mtab文件显示当前已挂载的所有设备</span></span><br><span class="line"><span class="built_in">cat</span> /proc/mounts      <span class="comment">#查看内核追踪到的已挂载的所有设备</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># mount</span></span><br><span class="line">sysfs on /sys <span class="built_in">type</span> sysfs (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">proc on /proc <span class="built_in">type</span> proc (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">devtmpfs on /dev <span class="built_in">type</span> devtmpfs (rw,nosuid,size=883748k,nr_inodes=220937,mode=755)</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /etc/mtab</span></span><br><span class="line">sysfs /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0</span><br><span class="line">proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0</span><br><span class="line">devtmpfs /dev devtmpfs rw,nosuid,size=883748k,nr_inodes=220937,mode=755 0 0</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /proc/mounts </span></span><br><span class="line">sysfs /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0</span><br><span class="line">proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0</span><br><span class="line">devtmpfs /dev devtmpfs rw,nosuid,size=883748k,nr_inodes=220937,mode=755 0 0</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p><strong>查看挂载点情况</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">findmnt [options]</span><br><span class="line">findmnt [options] &lt;device&gt; | &lt;mountpoint&gt;</span><br><span class="line">findmnt [options] &lt;device&gt; &lt;mountpoint&gt;</span><br><span class="line">findmnt [options] [--<span class="built_in">source</span> &lt;device&gt;] [--target &lt;path&gt; | --mountpoint &lt;<span class="built_in">dir</span>&gt;]</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认查看整个系统挂载树</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># findmnt</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看指定设备或挂载点</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># findmnt /dev/sdc1</span></span><br><span class="line">TARGET SOURCE   FSTYPE OPTIONS</span><br><span class="line">/sdc1 /dev/sdc1 ext4   rw,relatime</span><br></pre></td></tr></table></figure>

<p><strong>查看正在访问指定文件系统的进程</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof         MOUNT_POINT</span><br><span class="line">fuser -v     MOUNT_POINT</span><br></pre></td></tr></table></figure>

<p><strong>终止所有在正访问指定的文件系统的进程</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser -km MOUNT_POINT</span><br></pre></td></tr></table></figure>



<h3 id="持久挂载"><a href="#持久挂载" class="headerlink" title="持久挂载"></a>持久挂载</h3><p>将挂载保存到 /etc/fstab 中可以下次开机时，自动启用挂载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/etc/fstab格式帮助</span></span><br><span class="line">man 5 fstab</span><br></pre></td></tr></table></figure>

<p>每行定义一个要挂载的文件系统,，其中包括共 6 项</p>
<ul>
<li>要挂载的设备或伪文件系统设备文件(LABEL=label | UUID=uuid | /dev/sda1) </li>
<li>挂载点：必须是事先存在的目录 </li>
<li>文件系统类型：ext4，xfs，iso9660，nfs，none  </li>
<li>挂载选项：defaults ，acl，bind，ro，rw 等 </li>
<li>转储频率：0 不做备份; 1 每天转储; 2 每隔一天转储 </li>
<li>fsck检查的文件系统的顺序：0 不自检 ; 1 首先自检，一般只有rootfs才用；2 非rootfs使用</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat /etc/fstab </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Sun Jul 3 12:05:30 2022</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk/&#x27;.</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># After editing this file, run &#x27;systemctl daemon-reload&#x27; to update systemd</span></span><br><span class="line"><span class="comment"># units generated from this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/dev/mapper/rl-root     /                       xfs     defaults        0 0</span><br><span class="line">UUID=94a73757-555a-4d2b-8153-f54277c4c50d /boot xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-swap     none                    swap    defaults        0 0</span><br></pre></td></tr></table></figure>

<p>添加新的挂载项，需要执行下面命令生效 </p>
<p>此命令只针对文件新增行或删除行有效，如果在中间修改了挂载选项，则此命令无效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -a</span><br></pre></td></tr></table></figure>

<p>修改文件前后对比</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># df; mount -a;echo;df</span></span><br></pre></td></tr></table></figure>





<p>如果 /etc/fstab 中的分区UUID出错，则会无法进系统 </p>
<p>解决方案：</p>
<p> centos7,centos8会自动进入 emergency 模式，输入root密码后，再修改 /etc/fstab，然后重启即可 </p>
<p>centos6中除了修改为正确之外，还可以将/etc/fstab 文件中错误行最后一项设置为0，即不检查</p>
<h3 id="重新挂载"><a href="#重新挂载" class="headerlink" title="重新挂载"></a>重新挂载</h3><p>修改了/etc/fstab 文件中的挂载规则，无法通过mount -a 生效，要执行执行挂载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o remount MOUNTPOINT</span><br></pre></td></tr></table></figure>



<h2 id="处理交换文件和分区"><a href="#处理交换文件和分区" class="headerlink" title="处理交换文件和分区"></a>处理交换文件和分区</h2><h3 id="swap-介绍"><a href="#swap-介绍" class="headerlink" title="swap 介绍"></a>swap 介绍</h3><p>swap交换分区是系统RAM的补充，swap 分区支持虚拟内存。当没有足够的 RAM 保存系统处理的数据时会将数据写入 swap 分区，当系统 缺乏 swap 空间时，内核会因 RAM 内存耗尽而终止进程。 </p>
<p>配置过多 swap 空间会造成存储设备处于分配状态但闲置，造成浪费，过多 swap 空间还会掩盖内存泄露 </p>
<p>注意：为优化性能，可以将swap 分布存放，或高性能磁盘存放</p>
<p><strong>Redhat 官方推荐推荐系统 swap 空间</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-ppc<span class="comment">#sect-recommended-partitioning-scheme-ppc</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>系统中的 RAM 量</th>
<th>推荐的 swap 空间</th>
<th>允许休眠的建议 swap 空间大小</th>
</tr>
</thead>
<tbody><tr>
<td>低于 2 GB</td>
<td>RAM 量的2倍数</td>
<td>RAM 容量的三倍</td>
</tr>
<tr>
<td>2 GB - 8 GB</td>
<td>等于 RAM 量</td>
<td>RAM 量的倍数</td>
</tr>
<tr>
<td>8 GB - 64 GB</td>
<td>4 GB 到 RAM 容量的 0.5 倍</td>
<td>RAM 容量的 1.5 倍</td>
</tr>
<tr>
<td>8 GB - 64 GB</td>
<td>独立负载（至少 4GB）</td>
<td>不建议使用休眠功能</td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free     shared  buff/cache   available</span><br><span class="line">Mem:          1.7Gi       599Mi       717Mi       10Mi       468Mi       1.0Gi</span><br><span class="line">Swap:         2.0Gi         0B        2.0Gi</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># dd if=/dev/zero of=/dev/null bs=30G count=1</span></span><br><span class="line"><span class="built_in">dd</span>: memory exhausted by input buffer of size 32212254720 bytes (30 GiB)</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里文件大小虽然超过了，但有SWAP空间，所以可以执行成功</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># dd if=/dev/zero of=/dev/null bs=3G count=1</span></span><br><span class="line">0+1 records <span class="keyword">in</span></span><br><span class="line">0+1 records out</span><br><span class="line">2147479552 bytes (2.1 GB, 2.0 GiB) copied, 22.6783 s, 94.7 MB/s</span><br></pre></td></tr></table></figure>

<h3 id="交换分区实现过程"><a href="#交换分区实现过程" class="headerlink" title="交换分区实现过程"></a>交换分区实现过程</h3><ol>
<li>创建交换分区或者文件</li>
<li>使用mkswap写入特殊签名</li>
<li>在/etc/fstab文件中添加适当的条目</li>
<li>使用swapon -a 激活交换空间</li>
</ol>
<p><strong>启用swap分区</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">swapon [options] [&lt;spec&gt;]</span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-a|--all                  <span class="comment">#激活 /etc/fstab 中的所有交换区</span></span><br><span class="line">-d|--discard[=policy]     <span class="comment">#根据条件禁用(once|pages)</span></span><br><span class="line">-e|--ifexists             <span class="comment">#自动跳过不存在的设备而不提示</span></span><br><span class="line">-f|--fixpgsz              <span class="comment">#必要时重新初始化交换区</span></span><br><span class="line">-o|--options list         <span class="comment">#指定选项，swapon -o pri=1,discard=pages,nofail /dev/sda2</span></span><br><span class="line">-p|--priority N           <span class="comment">#指定交换设备的优先级(-1到32767)，值越大优先级越高,也可在/etc/fstab第4列指定pri=value</span></span><br><span class="line">-s|--summary              <span class="comment">#显示已使用交换设备的摘要</span></span><br><span class="line">--show[=columns]          <span class="comment">#以可自定义的表格形式打印摘要   swapon --show|swapon --show=NAME,TYPE</span></span><br><span class="line">--noheadings              <span class="comment">#不打印表头，配合 --show 选项</span></span><br><span class="line">--raw                     <span class="comment">#使用原生输出格式，配合 --show 选项</span></span><br><span class="line">--bytes                   <span class="comment">#在 --show 输出中以字节数显示交换区大小</span></span><br><span class="line">-v|--verbose              <span class="comment">#显示详细信息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;spec&gt; 参数：</span></span><br><span class="line">-L label                 <span class="comment">#同 LABEL=label</span></span><br><span class="line">-U uuid                  <span class="comment">#同 UUID=uuid</span></span><br><span class="line">LABEL=label              <span class="comment">#按交换区标签指定设备</span></span><br><span class="line">UUID=uuid                <span class="comment">#按交换区 UUID 指定设备</span></span><br><span class="line">PARTLABEL=label          <span class="comment">#按分区标签指定设备</span></span><br><span class="line">PARTUUID=uuid            <span class="comment">#按分区 UUID 指定设备</span></span><br><span class="line">device                   <span class="comment">#要使用设备的名称</span></span><br><span class="line">filename                 <span class="comment">#要使用文件的名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#可显示列</span></span><br><span class="line">NAME                     <span class="comment">#设备文件或分区路径</span></span><br><span class="line">TYPE                     <span class="comment">#设备的类型</span></span><br><span class="line">SIZE                     <span class="comment">#交换区大小</span></span><br><span class="line">USED                     <span class="comment">#已使用字节数</span></span><br><span class="line">PRIO                     <span class="comment">#交换优先级</span></span><br><span class="line">UUID                     <span class="comment">#uuid</span></span><br><span class="line">LABEL                    <span class="comment">#label</span></span><br></pre></td></tr></table></figure>

<p><strong>禁用swap分区</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">swapoff [options] [&lt;spec&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-a|--all              <span class="comment">#禁用 /proc/swaps 中的所有交换区</span></span><br><span class="line">-v|--verbose          <span class="comment">#显示过程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#spec 参数</span></span><br><span class="line">-L label              <span class="comment">#要使用设备的标签</span></span><br><span class="line">-U uuid               <span class="comment">#要使用设备的 UUID</span></span><br><span class="line">LABEL=label           <span class="comment">#要使用设备的标签</span></span><br><span class="line">UUID=uuid             <span class="comment">#要使用设备的 UUID</span></span><br><span class="line">device                <span class="comment">#要使用设备的名称</span></span><br><span class="line">filename              <span class="comment">#要使用文件的名称</span></span><br></pre></td></tr></table></figure>

<p><strong>创建swap分区</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先创建分区，选择swap类型（fdisk;t;82）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再创建swap文件系统</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mkswap /dev/sdb7 </span></span><br><span class="line">Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)</span><br><span class="line">no label, UUID=1fe6ce0f-e49a-47e0-956e-48be13606d9c</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># blkid /dev/sdb7</span></span><br><span class="line">/dev/sdb7: UUID=<span class="string">&quot;1fe6ce0f-e49a-47e0-956e-48be13606d9c&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span> PARTUUID=<span class="string">&quot;a5cc5319-07&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改/etc/fstab文件，添加swap行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用，再次启用</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># swapoff -a</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># swapon -a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看，比原来多2GB swap空间</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># free -h</span></span><br><span class="line">             total       used       free     shared buff/cache   available</span><br><span class="line">Mem:          1.7Gi       435Mi       1.2Gi       1.0Mi       127Mi       1.2Gi</span><br><span class="line">Swap:         4.0Gi       240Mi       3.8Gi</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看内存</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /proc/swaps </span></span><br><span class="line">Filename Type Size Used Priority</span><br><span class="line">/dev/dm-1                               partition 2125820 0 -2</span><br><span class="line">/dev/sdb7                               partition 2097148 0 -3</span><br></pre></td></tr></table></figure>

<p><strong>查看swap分区</strong> </p>
<p>Priority越大，优先级越高，会被优先使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># swapon -s</span></span><br><span class="line">Filename Type Size Used Priority</span><br><span class="line">/dev/dm-1               partition 2125820 0 -2</span><br><span class="line">/dev/sdb7               partition 2097148 0 -3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat /proc/swaps </span></span><br><span class="line">Filename Type Size Used Priority</span><br><span class="line">/dev/dm-1               partition 2125820 0 -2</span><br><span class="line">/dev/sdb7               partition 2097148 0 -3</span><br></pre></td></tr></table></figure>

<p><strong>修改swap优先级</strong> </p>
<p>可以指定swap分区0到32767的优先级，值越大优先级越高</p>
<p>如果用户没有指定，那么核心会自动给swap指定一个优先级，这个优先级从-1开始，每加入一个新的 没有用户指定优先级的swap，会给这个优先级减一</p>
<p>添加的swap的缺省优先级比较高，除非用户自己指定一个优先级，而用户指定的优先级(是正数)永远 高于核心缺省指定的优先级(是负数)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># swapon -s</span></span><br><span class="line">Filename Type Size Used Priority</span><br><span class="line">/dev/dm-1                             partition 2125820 0 -2</span><br><span class="line">/dev/sdb7                             partition 2097148 0 -3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Sun Jul 3 12:05:30 2022</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk/&#x27;.</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># After editing this file, run &#x27;systemctl daemon-reload&#x27; to update systemd</span></span><br><span class="line"><span class="comment"># units generated from this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/dev/mapper/rl-root                           /               xfs     defaults          0 0</span><br><span class="line">UUID=94a73757-555a-4d2b-8153-f54277c4c50d     /boot           xfs     defaults          0 0</span><br><span class="line">/dev/mapper/rl-home                           /home           xfs     defaults          0 0</span><br><span class="line">/dev/mapper/rl-swap                           none            swap    defaults          0 0</span><br><span class="line">UUID=1fe6ce0f-e49a-47e0-956e-48be13606d9c     none             swap   defaults,pri=123  0 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># swapoff -a</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># swapon -a</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># swapon -s</span></span><br><span class="line">Filename Type Size Used Priority</span><br><span class="line">/dev/dm-1               partition 2125820 0 -2</span><br><span class="line">/dev/sdb7               partition 2097148 0 123</span><br></pre></td></tr></table></figure>

<p><strong>以文件作为swap分区</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建文件</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># dd if=/dev/zero of=/swapfile bs=1G count=2</span></span><br><span class="line">2+0 records <span class="keyword">in</span></span><br><span class="line">2+0 records out</span><br><span class="line">2147483648 bytes (2.1 GB, 2.0 GiB) copied, 4.72333 s, 455 MB/s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建文件系统</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mkswap /swapfile </span></span><br><span class="line">mkswap: /swapfile: insecure permissions 0644, 0600 suggested.</span><br><span class="line">Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)</span><br><span class="line">no label, UUID=b1edc27b-2f23-4991-b211-0d2c4bd6a85f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># blkid /swapfile</span></span><br><span class="line">/swapfile: UUID=<span class="string">&quot;b1edc27b-2f23-4991-b211-0d2c4bd6a85f&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span></span><br><span class="line"><span class="comment">#修改/etc/fstab，添加行</span></span><br><span class="line">/swapfile     none                   swap   defaults        0 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#启用</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># swapon /swapfile</span></span><br><span class="line">swapon: /swapfile: insecure permissions 0644, 0600 suggested.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># swapon -s</span></span><br><span class="line">Filename Type Size Used Priority</span><br><span class="line">/dev/dm-1               partition 2125820 0 -2</span><br><span class="line">/dev/sdb7               partition 2097148 55608 123</span><br><span class="line">/swapfile               file      2097148 0 -3</span><br></pre></td></tr></table></figure>

<p><strong>永久禁用swap</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除swap行</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># sed -i.bak &#x27;/swap/d&#x27; /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#或注释swap行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># sed -i.bak &#x27;/swap/s@^@#@&#x27; /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用swap，由于修改了配置文件，所以重启也不会有SWAP</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># swapoff -a</span></span><br></pre></td></tr></table></figure>

<h3 id="swap的使用策略"><a href="#swap的使用策略" class="headerlink" title="swap的使用策略"></a>swap的使用策略</h3><p>/proc/sys/vm/swappiness 的值决定了当内存占用达到一定的百分比时，会启用swap分区的空间 </p>
<p>使用规则</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当内存使用率达到100-swappiness时,会启用交换分区</span><br><span class="line">简单地说这个参数定义了系统对swap的使用倾向，此值越大表示越倾向于使用swap。</span><br><span class="line">可以设为0，这样做并不会禁止对swap的使用，只是最大限度地降低了使用swap的可能性</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#说明：CentOS7和8默认值为30，内存在使用到100-30=70%的时候，就开始出现有交换分区的使用。</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># cat /proc/sys/vm/swappiness</span></span><br><span class="line">30</span><br><span class="line">[root@centos7 ~]<span class="comment"># cat /proc/sys/vm/swappiness</span></span><br><span class="line">30</span><br><span class="line">[root@centos6 ~]<span class="comment"># cat /proc/sys/vm/swappiness</span></span><br><span class="line">60</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">vm.swappiness=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#生效</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># sysctl -p</span></span><br><span class="line">vm.swappiness = 0</span><br></pre></td></tr></table></figure>

<h2 id="移动介质"><a href="#移动介质" class="headerlink" title="移动介质"></a>移动介质</h2><p>挂载意味着使外来的文件系统看起来如同是主目录树的一部分，所有移动介质也需要挂载，挂载点通常 在/media 或/mnt下 </p>
<p>访问前，介质必须被挂载 </p>
<p>摘除时，介质必须被卸载 </p>
<p>按照默认设置，非根用户只能挂载某些设备（光盘、DVD、软盘、USB等等）</p>
<h3 id="使用光盘"><a href="#使用光盘" class="headerlink" title="使用光盘"></a>使用光盘</h3><p>在图形环境下自动启动挂载/run/media/</p>
<p>手工挂载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># mount /dev/sr0 /mnt/</span></span><br><span class="line">mount: /mnt: WARNING: device write-protected, mounted read-only.</span><br></pre></td></tr></table></figure>

<p>自动挂载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># yum install -y autofs</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># systemctl enable --now autofs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这样就能自动列出光盘内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ls /misc/cd</span></span><br></pre></td></tr></table></figure>

<p>操作光盘</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eject           <span class="comment">#弹出光盘</span></span><br><span class="line">eject -t        <span class="comment">#弹入光盘</span></span><br></pre></td></tr></table></figure>

<p>创建ISO文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /dev/cdrom /root/centos.iso</span><br><span class="line">mkisofs  -r  -o /root/etc.iso /etc   <span class="comment"># 来自于genisoimage包</span></span><br></pre></td></tr></table></figure>

<p>刻录光盘</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wodim -v -eject centos.iso</span><br></pre></td></tr></table></figure>

<p><strong>将ISO制作为U盘工具Rufus</strong></p>
<p>官网: <a target="_blank" rel="noopener" href="http://rufus.ie/">http://rufus.ie/</a> </p>
<p>Rufus 是一个开源免费的快速制作 U 盘系统启动盘和格式化 USB 的实用小工具，它可以快速把 ISO 格式的系统镜像文件快速制作成可引导的 USB 启动安装盘，支持 Windows 或 Linux 启动。Rufus 小巧玲 珑，软件体积仅 7 百多 KB，然而麻雀虽小，它却五脏俱全</p>
<h3 id="USB介质"><a href="#USB介质" class="headerlink" title="USB介质"></a>USB介质</h3><p>查看USB设备是否识别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsusb                 <span class="comment">#来自于usbutils包</span></span><br></pre></td></tr></table></figure>

<p>被内核探测为SCSI设备,表现为/dev/sdaX、/dev/sdbX或类似的设备文件 </p>
<p>在图形环境中自动挂载在/run/media/</p>
<p>手动挂载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/DEVICE /mnt</span><br></pre></td></tr></table></figure>

<p>插入U盘后可以看到日志信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># tail /var/log/messages -f</span></span><br><span class="line">Apr 15 14:25:06 centos8 kernel: usb 4-1: new SuperSpeed Gen 1 USB device number 2 using xhci_hcd</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># dmesg</span></span><br><span class="line">[ 1861.537401] usb 4-1: new SuperSpeed Gen 1 USB device number 2 using xhci_hcd</span><br><span class="line">......</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>格式化U盘为 FAT32 文件系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># dnf -y install dosfstools</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># mkfs.vfat /dev/sdd1</span></span><br><span class="line">mkfs.fat 4.1 (2017-01-24)</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># mount /dev/sdd1 /mnt</span></span><br></pre></td></tr></table></figure>

<p>查看USB设备</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># yum -y install usbutils</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># lsusb</span></span><br><span class="line">Bus 004 Device 002: ID 0951:1666 Kingston Technology DataTraveler 100 G3/G4/SE9 G2</span><br><span class="line">......</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="磁盘常见工具"><a href="#磁盘常见工具" class="headerlink" title="磁盘常见工具"></a>磁盘常见工具</h2><h3 id="文件系统查看工具-df"><a href="#文件系统查看工具-df" class="headerlink" title="文件系统查看工具 df"></a>文件系统查看工具 df</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-a|--all                      <span class="comment">#显示所有</span></span><br><span class="line">-B|--block-size=SIZE          <span class="comment">#显示时指定块大小</span></span><br><span class="line">--direct                      <span class="comment">#将挂载点那一列标题显示为文件</span></span><br><span class="line">-h|--human-readable           <span class="comment">#以方便阅读的方式显示</span></span><br><span class="line">-H|--si                       <span class="comment">#以 1000为单位，而不是1024</span></span><br><span class="line">-i|--inodes                   <span class="comment">#显示inode 信息而非块使用量</span></span><br><span class="line">-k                            <span class="comment">#同 --block-size=1K</span></span><br><span class="line">-l|--<span class="built_in">local</span>                    <span class="comment">#只显示本机的文件系统</span></span><br><span class="line">--output[=FIELD_LIST]         <span class="comment">#只显示指定字段</span></span><br><span class="line">-P|--portability              <span class="comment">#以Posix兼容的格式输出</span></span><br><span class="line">--total                       <span class="comment">#最后加一行汇总数据</span></span><br><span class="line">-t|--<span class="built_in">type</span>=TYPE                <span class="comment">#根据文件系统类型过滤</span></span><br><span class="line">-T|--print-type               <span class="comment">#显示文件系统类型</span></span><br><span class="line">-x|--exclude-type=TYPE        <span class="comment">#根据文件系统类型反向过滤</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># df -Th</span></span><br><span class="line">Filesystem          Type      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs            devtmpfs  864M     0 864M   0% /dev</span><br><span class="line">tmpfs               tmpfs     893M     0 893M   0% /dev/shm</span><br><span class="line">tmpfs               tmpfs     893M  9.4M 884M   2% /run</span><br><span class="line">tmpfs               tmpfs     893M     0 893M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root xfs        70G   14G  57G  19% /</span><br><span class="line">/dev/sda1           xfs       1014M 255M 760M  26% /boot</span><br><span class="line">/dev/mapper/rl-home xfs       127G  939M 126G   1% /home</span><br><span class="line">/dev/sdc1           ext4      976M  2.6M 907M   1% /sdc1</span><br><span class="line">tmpfs               tmpfs     179M   12K 179M   1% /run/user/42</span><br><span class="line">tmpfs               tmpfs     179M     0 179M   0% /run/user/0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#只显示指定设备</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># df /dev/sda</span></span><br><span class="line">Filesystem     1K-blocks  Used Available Use% Mounted on</span><br><span class="line">devtmpfs          883748     0    883748   0% /dev</span><br></pre></td></tr></table></figure>

<h3 id="目录统计工具-du"><a href="#目录统计工具-du" class="headerlink" title="目录统计工具 du"></a>目录统计工具 du</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> [OPTION]... [FILE]...</span><br><span class="line"><span class="built_in">du</span> [OPTION]... --files0-from=F</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-0｜--null               <span class="comment">#输出时以NULL分割，而不是换行</span></span><br><span class="line">-a｜--all                <span class="comment">#显示所有文件和目录大小</span></span><br><span class="line">-B|--block-size=SIZE     <span class="comment">#指定块大小</span></span><br><span class="line">-b|--bytes               <span class="comment">#同 --apparent-size --block-size=1</span></span><br><span class="line">-c|--total               <span class="comment">#汇总</span></span><br><span class="line">-d|--max-depth=N         <span class="comment">#指定最大目录层级</span></span><br><span class="line">-h|--human-readable      <span class="comment">#以方便阅读的格式显示</span></span><br><span class="line">-k                       <span class="comment">#同 --block-size=1K</span></span><br><span class="line">-m                       <span class="comment">#同 --block-size=1M</span></span><br><span class="line">--si                     <span class="comment">#友好显示，以 1000 为单位，而不是 1024</span></span><br><span class="line">-s|--summarize           <span class="comment">#只显示外层目录</span></span><br><span class="line">-X|--exclude-from=FILE   <span class="comment">#根据文件名忽略</span></span><br><span class="line">--exclude=PATTERN        <span class="comment">#根据正则表达式忽略</span></span><br><span class="line">-x|--one-file-system     <span class="comment">#忽略不在同一个文件系统的目录</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看目录占用多大空间</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># du -sh /etc/</span></span><br><span class="line">31M /etc/</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看目录下每个文件或子目录大小</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># du -sh /var/log/* | head -n 3</span></span><br><span class="line">2.2M /var/log/anaconda</span><br><span class="line">5.5M /var/log/audit</span><br><span class="line">64K /var/log/boot.log</span><br></pre></td></tr></table></figure>

<h3 id="文件工具-dd"><a href="#文件工具-dd" class="headerlink" title="文件工具 dd"></a>文件工具 dd</h3><p>dd 命令：convert and copy a fifile</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> [OPERAND]...</span><br><span class="line"><span class="built_in">dd</span> OPTION</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用格式</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/PATH/FROM/SRC of=/PATH/TO/DEST  bs=N count=N</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line"><span class="keyword">if</span>=file                            <span class="comment">#从所命名文件读取而不是从标准输入</span></span><br><span class="line">of=file                            <span class="comment">#写到所命名的文件而不是到标准输出</span></span><br><span class="line">ibs=size                           <span class="comment">#一次读size个byte</span></span><br><span class="line">obs=size                           <span class="comment">#一次写size个byte</span></span><br><span class="line">bs=size                            <span class="comment">#指定块大小（既是是ibs也是obs)</span></span><br><span class="line">cbs=size                           <span class="comment">#从开头忽略blocks个ibs大小的块</span></span><br><span class="line">seek=blocks                        <span class="comment">#从开头忽略blocks个obs大小的块</span></span><br><span class="line">count=n                            <span class="comment">#复制n个bs</span></span><br><span class="line">conv=conversion[,conversion...]    <span class="comment">#用指定的参数转换文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#conversion 转换参数</span></span><br><span class="line">ascii               <span class="comment">#转换 EBCDIC 为 ASCII</span></span><br><span class="line">ebcdic              <span class="comment">#转换 ASCII 为 EBCDIC</span></span><br><span class="line">lcase               <span class="comment">#把大写字符转换为小写字符</span></span><br><span class="line">ucase               <span class="comment">#把小写字符转换为大写字符</span></span><br><span class="line">nocreat             <span class="comment">#不创建输出文件</span></span><br><span class="line">noerror             <span class="comment">#出错时不停止</span></span><br><span class="line">notrunc             <span class="comment">#不截短输出文件</span></span><br><span class="line"><span class="built_in">sync</span>                <span class="comment">#把每个输入块填充到ibs个字节，不足部分用空(NUL)字符补齐</span></span><br><span class="line">fdatasync           <span class="comment">#写完成前，物理写入输出文件</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份MBR</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=/tmp/mbr.bak bs=512 count=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#有一个大与2K的二进制文件fileA。现在想从第64个字节位置开始读取，需要读取的大小是128Byts。又有fileB, 想把上面读取到的128Bytes写到第32个字节开始的位置，替换128Bytes，实现如下</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=fileA of=fileB bs=1 count=128 skip=63 seek=31 conv=notrunc</span><br><span class="line"></span><br><span class="line"><span class="comment">#将本地的/dev/sdx整盘备份到/dev/sdy </span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx of=/dev/sdy</span><br><span class="line"></span><br><span class="line"><span class="comment">#将/dev/sdx全盘数据备份到指定路径的image文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx of=/path/to/image</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份/dev/sdx全盘数据，并利用gzip压缩，保存到指定路径</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx | gzip &gt;/path/to/image.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#将备份文件恢复到指定盘</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/path/to/image of=/dev/sdx</span><br><span class="line"></span><br><span class="line"><span class="comment">#将压缩的备份文件恢复到指定盘</span></span><br><span class="line">gzip -dc /path/to/image.gz | <span class="built_in">dd</span> of=/dev/sdx</span><br><span class="line"></span><br><span class="line"><span class="comment">#将内存里的数据拷贝到root目录下的mem.bin文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/mem of=/root/mem.bin bs=1024</span><br><span class="line"></span><br><span class="line"><span class="comment">#拷贝光盘数据到root文件夹下，并保存为cdrom.iso文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/cdrom of=/root/cdrom.iso</span><br><span class="line"></span><br><span class="line"><span class="comment">#销毁磁盘数据</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=/dev/sda1</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过比较dd指令输出中命令的执行时间，即可确定系统最佳的block size大小</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=1024 count=1000000</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=2048 count=500000  </span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=4096 count=250000</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试硬盘写速度</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=1024 count=1000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试硬盘读速度</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/root/1Gb.file bs=64k | <span class="built_in">dd</span> of=/dev/null</span><br></pre></td></tr></table></figure>

<h1 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h1><h2 id="什么是RAID"><a href="#什么是RAID" class="headerlink" title="什么是RAID"></a>什么是RAID</h2><p>“RAID”一词是由David Patterson, Garth A. Gibson, Randy Katz 于1987年在加州大学伯克利分校发明 的。在1988年6月SIGMOD会议上提交的论文”A Case for Redundant Arrays of Inexpensive Disks” （中文翻译：廉价磁盘冗余阵列案例） 中提出。 </p>
<p>为了提升磁盘系统性能，他们提出用许多块廉价的磁盘做成一个磁盘组，在性能上超过昂贵的大型机上的单个大容量磁盘。 </p>
<p>文中同时定义了RAID的5个级别：RAID 1、RAID 2、RAID 3、RAID 4、RAID 5，这些都被沿用至今。 </p>
<p>旧称廉价磁盘冗余阵列 （Redundant Array of Inexpensive Disks）</p>
<p>现称独立硬盘冗余阵列（ Redundant Array of Independent Disks）</p>
<p>简称磁盘阵列 </p>
<p>利用虚拟化存储技术把多个硬盘组合起来，成为一个或多个硬盘阵列组，目的为提升性能或数据冗余，或是两者同时提升。 </p>
<p>RAID 层级不同，数据会以多种模式分散于各个硬盘，RAID 层级的命名会以 RAID 开头并带数字，例如：RAID 0、RAID 1、RAID 5、RAID 6、RAID 7、RAID 01、RAID 10、RAID 50、RAID 60。每种等级都有其理论上的优缺点，不同的等级在两个目标间获取平衡，分别是增加数据可靠性以及增加存储器 （群）读写性能。 </p>
<p>简单来说，RAID把多个硬盘组合成为一个逻辑硬盘，因此，操作系统只会把它当作一个实体硬盘。 RAID常被用在服务器电脑上，并且常使用完全相同的硬盘作为组合。由于硬盘价格的不断下降与RAID 功能更加有效地与主板集成，它也成为普通用户的一个选择，特别是需要大容量存储空间的工作，如： 视频与音频制作。</p>
<p><strong>RAID功能实现</strong> </p>
<ul>
<li>提高IO能力,磁盘并行读写 </li>
<li>提高耐用性,磁盘冗余算法来实现 </li>
</ul>
<p><strong>RAID实现的方式</strong> </p>
<ul>
<li>外接式磁盘阵列：通过扩展卡提供适配能力 </li>
<li>内接式RAID：主板集成RAID控制器，安装OS前在BIOS里配置 </li>
<li>软件RAID：通过OS实现，比如：群晖的NAS</li>
</ul>
<h2 id="RAID级别"><a href="#RAID级别" class="headerlink" title="RAID级别"></a>RAID级别</h2><p>级别：多块磁盘组织在一起的工作方式有所不同 </p>
<p>参考链接: <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/RAID">https://zh.wikipedia.org/wiki/RAID</a></p>
<p>RAID-0：条带卷，strip  </p>
<p>RAID-1：镜像卷，mirror  </p>
<p>RAID-2 </p>
<p> ……  </p>
<p>RAID-5  </p>
<p>RAID-6  </p>
<p>RAID-7  </p>
<p>RAID-10  </p>
<p>RAID-01  </p>
<p>RAID-50 </p>
<h3 id="RAID-0"><a href="#RAID-0" class="headerlink" title="RAID-0"></a>RAID-0</h3><p>以 chunk 单位,读写数据,因为读写时都可以并行处理，所以在所有的级别中，RAID 0的速度是最快的。 但是RAID 0既没有冗余功能，也不具备容错能力，如果一个磁盘（物理）损坏，所有数据都会丢失</p>
<p><img src="../../../../images/SRE/day09/13.png" alt="13"></p>
<p>读、写性能提升 </p>
<p>可用空间：N*min(S1,S2,…)  </p>
<p>无容错能力 </p>
<p>最少磁盘数：1+</p>
<h3 id="RAID-1"><a href="#RAID-1" class="headerlink" title="RAID-1"></a>RAID-1</h3><p>也称为镜像, 两组以上的N个磁盘相互作镜像，在一些多线程操作系统中能有很好的读取速度，理论上读取速度等于硬盘数量的倍数，与RAID  0相同。另外写入速度有微小的降低。</p>
<p><img src="../../../../images/SRE/day09/14.png" alt="14"></p>
<p>读性能提升、写性能略有下降 </p>
<p>可用空间：1*min(S1,S2,…) </p>
<p>磁盘利用率 50%  </p>
<p>有冗余能力 </p>
<p>最少磁盘数：2+</p>
<h3 id="RAID-4"><a href="#RAID-4" class="headerlink" title="RAID-4"></a>RAID-4</h3><p><img src="../../../../images/SRE/day09/15.png" alt="15"></p>
<p>多块数据盘异或运算值存于专用校验盘 </p>
<p>磁盘利用率 (N-1)/N  </p>
<p>有冗余能力 </p>
<p>至少3块硬盘才可以实现</p>
<h3 id="RAID-5"><a href="#RAID-5" class="headerlink" title="RAID-5"></a>RAID-5</h3><p><img src="../../../../images/SRE/day09/16.png" alt="16"></p>
<p>读、写性能提升 </p>
<p>可用空间：(N-1)*min(S1,S2,…)  </p>
<p>有容错能力：允许最多1块磁盘损坏 </p>
<p>最少磁盘数：3, 3+</p>
<h3 id="RAID-6"><a href="#RAID-6" class="headerlink" title="RAID-6"></a>RAID-6</h3><p><img src="../../../../images/SRE/day09/17.png" alt="17"></p>
<p>双份校验位,算法更复杂 </p>
<p>读、写性能提升 </p>
<p>可用空间：(N-2)*min(S1,S2,…)  </p>
<p>有容错能力：允许最多2块磁盘损坏 </p>
<p>最少磁盘数：4, 4+</p>
<h3 id="RAID-10"><a href="#RAID-10" class="headerlink" title="RAID-10"></a>RAID-10</h3><p><img src="../../../../images/SRE/day09/18.png" alt="18"></p>
<p>读、写性能提升 </p>
<p>可用空间：N*min(S1,S2,…)/2  </p>
<p>有容错能力：每组镜像最多只能坏一块 </p>
<p>最少磁盘数：4, 4+</p>
<h3 id="RAID-01"><a href="#RAID-01" class="headerlink" title="RAID-01"></a>RAID-01</h3><p><img src="../../../../images/SRE/day09/19.png" alt="19"></p>
<p>多块磁盘先实现RAID0,再组合成RAID1</p>
<h3 id="RAID-50"><a href="#RAID-50" class="headerlink" title="RAID-50"></a>RAID-50</h3><p><img src="../../../../images/SRE/day09/20.png" alt="20"></p>
<p>多块磁盘先实现RAID5,再组合成RAID0</p>
<h3 id="RAID-60"><a href="#RAID-60" class="headerlink" title="RAID-60"></a>RAID-60</h3><p><img src="../../../../images/SRE/day09/21.png" alt="21"></p>
<h3 id="其它级别"><a href="#其它级别" class="headerlink" title="其它级别"></a>其它级别</h3><p><strong>JBOD：Just a Bunch Of Disks 只是一堆磁盘</strong></p>
<p><img src="../../../../images/SRE/day09/22.png" alt="22"></p>
<p>功能：将多块磁盘的空间合并一个大的连续空间使用 </p>
<p>第一块硬盘存放所有磁盘的分段信息,如果损坏,整个阵列会失败 </p>
<p>后续磁盘损坏只会影响本块磁盘的数据 </p>
<p>可用空间：sum(S1,S2,…)</p>
<p><strong>RAID7</strong></p>
<p>RAID 7并非公开的RAID标准，而是美国公司的Storage Computer Corporation的专利硬件产品名称， RAID 7是以RAID 3及RAID 4为基础所发展，但是经过强化以解决原来的一些限制。另外，在实现中使用 大量的缓冲存储器以及用以实现异步数组管理的专用即时处理器，使得 RAID 7可以同时处理大量的IO要 求，所以性能甚至超越了许多其他RAID标准的实际产品。但也因为如此，在价格方面非常的高 昂.RAID7 可以理解为一个独立存储计算机，自身带有操作系统和管理工具，可以独立运行，理论上性能最高的RAID模式 </p>
<p><strong>SHR(Synology Hybrid RAID)</strong> </p>
<p>群晖公司的技术,适合不了解RAID的普通用户 </p>
<p>根据磁盘个数自动组成不同的RAID,1块普通磁盘,2块RAID1,3块RAID4,SHR2类似于RAID6  </p>
<p>只支持群晖系统</p>
<h3 id="RAID-总结"><a href="#RAID-总结" class="headerlink" title="RAID 总结"></a>RAID 总结</h3><p>常用级别：RAID-0, RAID-1, RAID-5, RAID-10, RAID-50,RAID-</p>
<table>
<thead>
<tr>
<th>RAID<br />等级</th>
<th>最少<br />硬盘</th>
<th>最大<br />容错</th>
<th>可用<br />容量</th>
<th>读性能</th>
<th>写性能</th>
<th>安全性</th>
<th>目的</th>
<th>应用<br />场景</th>
</tr>
</thead>
<tbody><tr>
<td>单一<br />硬盘</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>无</td>
<td></td>
<td></td>
</tr>
<tr>
<td>JBOD</td>
<td>1</td>
<td>0</td>
<td>n</td>
<td>1</td>
<td>1</td>
<td>无（同RAID 0）</td>
<td>增加容量</td>
<td>个人(暂时)存储 备份</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>n</td>
<td>n</td>
<td>n</td>
<td>一块硬盘坏，全部硬盘 都会异常</td>
<td>追求最大容量、速度</td>
<td>影片剪接缓存 用途</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>n-1</td>
<td>1</td>
<td>n</td>
<td>1</td>
<td>高，一个正常即可</td>
<td>追求最大安全性</td>
<td>个人企业备份</td>
</tr>
<tr>
<td>5</td>
<td>3</td>
<td>1</td>
<td>n-1</td>
<td>n-1</td>
<td>n-1</td>
<td>高</td>
<td>追求最大容量、最小预算</td>
<td>个人企业备份</td>
</tr>
<tr>
<td>6</td>
<td>4</td>
<td>2</td>
<td>n-2</td>
<td>n-2</td>
<td>n-2</td>
<td>安全性较RAID5高</td>
<td>同RAID 5，但较安全</td>
<td>个人企业备份</td>
</tr>
<tr>
<td>10</td>
<td>4</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>高</td>
<td>综合RAID 0/1优点，理论 速度较快</td>
<td>大型数据库、 服务器</td>
</tr>
<tr>
<td>50</td>
<td>6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>高</td>
<td>提升数据安全</td>
<td></td>
</tr>
<tr>
<td>60</td>
<td>8</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>高</td>
<td>提升数据安全</td>
<td></td>
</tr>
</tbody></table>
<h2 id="实现软RAID"><a href="#实现软RAID" class="headerlink" title="实现软RAID"></a>实现软RAID</h2><p>mdadm工具：为软RAID提供管理界面，为空余磁盘添加冗余，结合内核中的md(multi devices) RAID设备可命为/dev/md0、/dev/md1、/dev/md2、/dev/md3等</p>
<p>mdadm：模式化的工具,支持的RAID级别：LINEAR, RAID0, RAID1, RAID4, RAID5, RAID6, RAID10</p>
<p>命令的语法格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mdadm [mode] &lt;raiddevice&gt; [options] &lt;component-devices&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mode</span></span><br><span class="line">-C|--create                 <span class="comment">#创建</span></span><br><span class="line">-A|--assemble               <span class="comment">#装配</span></span><br><span class="line">-F|--monitor                <span class="comment">#监控</span></span><br><span class="line">-D|--detail                 <span class="comment">#显示raid的详细信息</span></span><br><span class="line">-f                          <span class="comment">#标记指定磁盘为损坏</span></span><br><span class="line">-r                          <span class="comment">#移除磁盘</span></span><br><span class="line">-a                          <span class="comment">#添加磁盘</span></span><br><span class="line"></span><br><span class="line">&lt;raiddevice&gt; <span class="comment">#raid 设备</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#options</span></span><br><span class="line">-C</span><br><span class="line">-n N                        <span class="comment">#使用N个块设备来创建此RAID</span></span><br><span class="line">-l N                        <span class="comment">#指明要创建的RAID的级别</span></span><br><span class="line">-a &#123;<span class="built_in">yes</span>|no&#125;                 <span class="comment">#自动创建目标RAID设备的设备文件</span></span><br><span class="line">-c CHUNK_SIZE               <span class="comment">#指明块大小,单位k</span></span><br><span class="line">-x N                        <span class="comment">#指明空闲盘的个数</span></span><br><span class="line">&lt;component-devices&gt;         <span class="comment">#任意块设备</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用mdadm创建并定义RAID设备</span></span><br><span class="line">mdadm -C /dev/md0 -a <span class="built_in">yes</span> -l 5 -n 3 -x 1 /dev/sd&#123;b,c,d,e&#125;1</span><br><span class="line"></span><br><span class="line"><span class="comment">#用文件系统对每个RAID设备进行格式化</span></span><br><span class="line">mkfs.xfs /dev/md0</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用mdadm检查RAID设备的状况</span></span><br><span class="line">mdadm --detail|D /dev/md0</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加新的成员</span></span><br><span class="line">mdadm -G /dev/md0 -n4  -a /dev/sdf1</span><br><span class="line"></span><br><span class="line"><span class="comment">#模拟磁盘故障</span></span><br><span class="line">mdadm /dev/md0  -f /dev/sda1</span><br><span class="line"></span><br><span class="line"><span class="comment">#移除磁盘</span></span><br><span class="line">mdadm   /dev/md0 -r /dev/sda1</span><br><span class="line"></span><br><span class="line"><span class="comment">#在备用驱动器上重建分区</span></span><br><span class="line">mdadm /dev/md0  -a /dev/sda1</span><br><span class="line"></span><br><span class="line"><span class="comment">#系统日志信息</span></span><br><span class="line"><span class="built_in">cat</span> /proc/mdstat</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成配置文件</span></span><br><span class="line">mdadm -D -s &gt;&gt; /etc/mdadm.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止设备</span></span><br><span class="line">mdadm -S /dev/md0</span><br><span class="line"></span><br><span class="line"><span class="comment">#激活设备</span></span><br><span class="line">mdadm -A -s /dev/md0</span><br><span class="line"></span><br><span class="line"><span class="comment">#强制启动</span></span><br><span class="line">mdadm -R /dev/md0</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除raid信息</span></span><br><span class="line">dadm --zero-superblock /dev/sdb1</span><br></pre></td></tr></table></figure>

<p>练习 </p>
<ol>
<li>创建一个可用空间为1G的RAID1设备，文件系统为ext4，有一个空闲盘，开机可自动挂载 至/backup目录 </li>
<li>创建由三块硬盘组成的可用空间为2G的RAID5设备，要求其chunk大小为256k，文件系统为ext4， 开机可自动挂载至/mydata目录</li>
</ol>
<h1 id="逻辑卷管理器（LVM）"><a href="#逻辑卷管理器（LVM）" class="headerlink" title="逻辑卷管理器（LVM）"></a>逻辑卷管理器（LVM）</h1><h2 id="LVM介绍"><a href="#LVM介绍" class="headerlink" title="LVM介绍"></a>LVM介绍</h2><p>LVM: Logical Volume Manager 可以允许对卷进行方便操作的抽象层，包括重新设定文件系统的大小， 允许在多个物理设备间重新组织文件 系统 </p>
<p>LVM可以弹性的更改LVM的容量</p>
<p><img src="../../../../images/SRE/day09/23.png" alt="23"></p>
<p>通过交换PE来进行资料的转换，将原来LV内的PE转移到其他的设备中以降低LV的容量，或将其他设备 中的PE加到LV中以加大容量 </p>
<p><strong>实现过程</strong></p>
<ul>
<li>将设备指定为物理卷 </li>
<li>用一个或者多个物理卷来创建一个卷组，物理卷是用固定大小的物理区域（Physical Extent， PE）来定义的 </li>
<li>在物理卷上创建的逻辑卷， 是由物理区域（PE）组成 </li>
<li>可以在逻辑卷上创建文件系统并挂载</li>
</ul>
<p><img src="../../../../images/SRE/day09/24.png" alt="24"></p>
<p>第一个逻辑卷对应设备名：/dev/dm-#  </p>
<p>dm: device mapper，将一个或多个底层块设备组织成一个逻辑设备的模块 </p>
<p>软链接： </p>
<ul>
<li>/dev/mapper/VG_NAME-LV_NAME  </li>
<li>/dev/VG_NAME/LV_NAME</li>
</ul>
<p>范例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># ll /dev/mapper/rl* </span></span><br><span class="line">lrwxrwxrwx 1 root root 7 Aug  1 09:38 /dev/mapper/rl-home -&gt; ../dm-2</span><br><span class="line">lrwxrwxrwx 1 root root 7 Aug  1 09:38 /dev/mapper/rl-root -&gt; ../dm-0</span><br><span class="line">lrwxrwxrwx 1 root root 7 Aug  1 09:38 /dev/mapper/rl-swap -&gt; ../dm-1</span><br></pre></td></tr></table></figure>

<h2 id="实现逻辑卷"><a href="#实现逻辑卷" class="headerlink" title="实现逻辑卷"></a>实现逻辑卷</h2><p>相关工具来自于 lvm2 包</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># yum -y install lvm2</span></span><br></pre></td></tr></table></figure>

<h3 id="pv管理工具"><a href="#pv管理工具" class="headerlink" title="pv管理工具"></a>pv管理工具</h3><p>将块设备创建为物理卷，本质上就是给块设备打一个标签， </p>
<p>块设备数量和物理卷数量是对应的，有几个块设备，就可以创建几个物理卷， </p>
<p>块设备容量大小不限，可以跨分区。</p>
<p><strong>显示pv信息</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pvs                   <span class="comment">#简要pv信息显示</span></span><br><span class="line">pvdisplay             <span class="comment">#显示详细信息</span></span><br></pre></td></tr></table></figure>

<p><strong>创建pv</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/DEVICE</span><br></pre></td></tr></table></figure>

<p><strong>删除pv</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvremove /dev/DEVICE</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建pv</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># pvcreate /dev/sdb2 /dev/sdc </span></span><br><span class="line"> Physical volume <span class="string">&quot;/dev/sdb2&quot;</span> successfully created.</span><br><span class="line"> Physical volume <span class="string">&quot;/dev/sdc&quot;</span> successfully created.</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># pvs</span></span><br><span class="line">  PV       VG Fmt  Attr PSize    PFree </span><br><span class="line"> /dev/sda2 rl lvm2 a--  &lt;199.00g     0</span><br><span class="line"> /dev/sdb2    lvm2 ---     5.00g  5.00g</span><br><span class="line"> /dev/sdc     lvm2 ---    10.00g 10.00g</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看指定PV</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># pvdisplay /dev/sdc</span></span><br><span class="line">  <span class="string">&quot;/dev/sdc&quot;</span> is a new physical volume of <span class="string">&quot;10.00 GiB&quot;</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line"> PV Name               /dev/sdc</span><br><span class="line"> VG Name               </span><br><span class="line"> PV Size               10.00 GiB</span><br><span class="line"> Allocatable           NO</span><br><span class="line"> PE Size               0   </span><br><span class="line"> Total PE              0</span><br><span class="line"> Free PE               0</span><br><span class="line"> Allocated PE          0</span><br><span class="line"> PV UUID               4rZKNs-ca0S-Jp4G-zFzY-P8Up-KUG7-yFcZcg</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">#移除</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># pvremove /dev/sdc</span></span><br><span class="line"> Labels on physical volume <span class="string">&quot;/dev/sdc&quot;</span> successfully wiped.</span><br></pre></td></tr></table></figure>

<h3 id="vg管理工具"><a href="#vg管理工具" class="headerlink" title="vg管理工具"></a>vg管理工具</h3><p><strong>显示卷组</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vgs</span><br><span class="line">vgdisplay</span><br></pre></td></tr></table></figure>

<p><strong>创建卷组</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vgcreate [-s Size ] vgname pv1 [pv2...]</span><br><span class="line"></span><br><span class="line"><span class="comment">#-s 指定PE大小，数字加单位，单位为 k|K|m|M|g|G|t|T|p|P|e|E</span></span><br></pre></td></tr></table></figure>

<p><strong>管理卷组</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vgextend vgname pv1 [pv2...]    <span class="comment">#往卷组中添加物理卷</span></span><br><span class="line">vgreduce vgname pv1 [pv2...]    <span class="comment">#从卷组中移除物理卷</span></span><br></pre></td></tr></table></figure>

<p><strong>删除卷组</strong> </p>
<p>删除vg之前，要先把对应的 pv 解除绑定 (pvmove)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgremove vgname</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建vg</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vgcreate -s 16M testvg /dev/sdb2 /dev/sdc</span></span><br><span class="line"> Volume group <span class="string">&quot;testvg&quot;</span> successfully created</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#查看vg</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vgs</span></span><br><span class="line"> VG     <span class="comment">#PV #LV #SN Attr   VSize   VFree  </span></span><br><span class="line"> rl       1   3   0 wz--n- &lt;199.00g      0</span><br><span class="line"> testvg   2   0   0 wz--n- &lt;14.97g &lt;14.97g</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看vg  </span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vgdisplay testvg</span></span><br><span class="line">  --- Volume group ---</span><br><span class="line"> VG Name               testvg</span><br><span class="line"> System ID             </span><br><span class="line"> Format                lvm2</span><br><span class="line"> Metadata Areas        2</span><br><span class="line"> Metadata Sequence No  1</span><br><span class="line"> VG Access             <span class="built_in">read</span>/write</span><br><span class="line"> VG Status             resizable</span><br><span class="line"> MAX LV                0</span><br><span class="line"> Cur LV                0</span><br><span class="line"> Open LV               0</span><br><span class="line"> Max PV                0</span><br><span class="line"> Cur PV                2</span><br><span class="line"> Act PV                2</span><br><span class="line"> VG Size               &lt;14.97 GiB <span class="comment">#总大小</span></span><br><span class="line"> PE Size               16.00 MiB <span class="comment">#PE大小</span></span><br><span class="line"> Total PE              958 <span class="comment">#总PE数量</span></span><br><span class="line"> Alloc PE / Size       0 / 0   <span class="comment">#己分配的PE</span></span><br><span class="line"> Free PE / Size        958 / &lt;14.97 GiB <span class="comment">#可用PE</span></span><br><span class="line"> VG UUID               Croa8U-P3lT-PpBY-kUaU-FvES-dWoT-eEGLOA</span><br></pre></td></tr></table></figure>

<p>范例：扩展vg</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># pvs</span></span><br><span class="line"> PV         VG     Fmt Attr PSize   PFree  </span><br><span class="line"> /dev/sda2 rl     lvm2 a-- &lt;199.00g      0</span><br><span class="line"> /dev/sdb2 testvg lvm2 a--     4.98g 272.00m</span><br><span class="line"> /dev/sdb3         lvm2 ---     2.00g   2.00g</span><br><span class="line"> /dev/sdc   testvg lvm2 a--     9.98g   4.98g</span><br><span class="line"> </span><br><span class="line"><span class="comment">#往testvg中增加 pv</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vgextend testvg /dev/sdb3 </span></span><br><span class="line"> Volume group <span class="string">&quot;testvg&quot;</span> successfully extended</span><br><span class="line"> </span><br><span class="line"><span class="comment">#再次查看pv</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># pvs</span></span><br><span class="line"> PV         VG     Fmt Attr PSize    PFree  </span><br><span class="line"> /dev/sda2  rl     lvm2 a-- &lt;199.00g      0</span><br><span class="line"> /dev/sdb2  testvg lvm2 a--     4.98g 272.00m</span><br><span class="line"> /dev/sdb3  testvg lvm2 a--     1.98g   1.98g</span><br><span class="line"> /dev/sdc   testvg lvm2 a--     9.98g   4.98g</span><br></pre></td></tr></table></figure>

<h3 id="lv管理工具"><a href="#lv管理工具" class="headerlink" title="lv管理工具"></a>lv管理工具</h3><p><strong>显示逻辑卷</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lvs</span><br><span class="line">Lvdisplay</span><br></pre></td></tr></table></figure>

<p><strong>创建逻辑卷</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lvcreate &#123;-L N[mMgGtT]|-l N&#125; -n NAME VolumeGroup</span><br><span class="line"></span><br><span class="line">-L|--size N[mMgGtT]      <span class="comment">#指定大小 </span></span><br><span class="line">-l|--extents N           <span class="comment">#指定PE个数,也可用百分比</span></span><br><span class="line">-n Name                  <span class="comment">#逻辑卷名称</span></span><br></pre></td></tr></table></figure>

<p><strong>扩展逻辑卷</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lvextend &#123;-L N[mMgGtT]|-l N&#125; LV_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-L|--size [+]Size[mMgGtT]           <span class="comment">#N个单位大小，也可写成+10M</span></span><br><span class="line">-l|--extents [+]Number[PERCENT]     <span class="comment">#N个PE，也可以写成+10，表示在原基础上加10个PE大小，+100%free 表示把剩下空间都用完</span></span><br><span class="line">-r|--resizefs                       <span class="comment">#自动重置文件系统大小</span></span><br></pre></td></tr></table></figure>

<p><strong>缩减逻辑卷</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lvreduce &#123;-L N[mMgGtT]|-l N&#125; LV_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-L|--size [-]Size[mMgGtT]            <span class="comment">#N个单位大小，也可写成-10M</span></span><br><span class="line">-l|--extents [-]Number[PERCENT]      <span class="comment">#N个PE，也可以写成-10，表示在原基础上减10个PE大小</span></span><br></pre></td></tr></table></figure>

<p><strong>删除逻辑卷</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvremove /dev/VG_NAME/LV_NAME</span><br></pre></td></tr></table></figure>

<p><strong>重设文件系统大小</strong></p>
<p>修改了逻辑卷大小后，要同步文件系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fsadm [options] resize device [new_size[BKMGTEP]]</span><br><span class="line"></span><br><span class="line">resize2fs [-f] [-F] [-M] [-P] [-p] lvname    <span class="comment">#只支持ext系列文件系统</span></span><br><span class="line"></span><br><span class="line">xfs_growfs /mountpoint                       <span class="comment">#只支持xfs 文件系统</span></span><br></pre></td></tr></table></figure>

<p>范例：创建lv</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从 testvg 中创建lv1,大小为 100个PE</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lvcreate -l 100 -n lv1 testvg</span></span><br><span class="line"> Logical volume <span class="string">&quot;lv1&quot;</span> created.</span><br><span class="line"> </span><br><span class="line"><span class="comment">#创建lv2，大小为5G</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lvcreate -L 5G -n lv2 testvg </span></span><br><span class="line"> Logical volume <span class="string">&quot;lv2&quot;</span> created.</span><br><span class="line"> </span><br><span class="line"><span class="comment">#创建lv3,大小为剩下可用PE数量的 20%</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lvcreate -l 20%free -n lv3 testvg</span></span><br><span class="line"> Logical volume <span class="string">&quot;lv3&quot;</span> created.</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#创建lv4,大小为指定vg的10%</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lvcreate -l 10%VG -n lv4 testvg</span></span><br><span class="line"> Logical volume <span class="string">&quot;lv4&quot;</span> created.</span><br></pre></td></tr></table></figure>

<p>范例：查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lvs /dev/testvg/*</span></span><br><span class="line"> LV   VG     Attr       LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert</span><br><span class="line"> lv1 testvg -wi-a----- 1.56g                                                    </span><br><span class="line"> lv2 testvg -wi-a----- 5.00g                                                    </span><br><span class="line"> lv3 testvg -wi-a----- 1.67g                                                    </span><br><span class="line"> lv4 testvg -wi-a----- 1.48g </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#查看  </span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lvdisplay /dev/testvg/lv1</span></span><br><span class="line">  --- Logical volume ---</span><br><span class="line"> LV Path               /dev/testvg/lv1</span><br><span class="line"> LV Name               lv1</span><br><span class="line"> VG Name               testvg</span><br><span class="line"> LV UUID               57QkET-OpG0-kZlD-iRC9-YWmL-iaum-BtftfM</span><br><span class="line"> LV Write Access       <span class="built_in">read</span>/write</span><br><span class="line"> LV Creation host, time rocky86, 2022-08-01 14:27:52 +0800</span><br><span class="line"> LV Status             available</span><br><span class="line">  <span class="comment"># open                 0</span></span><br><span class="line"> LV Size                1.56 GiB</span><br><span class="line"> Current LE             100</span><br><span class="line"> Segments               1</span><br><span class="line"> Allocation             inherit</span><br><span class="line"> Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line"> Block device           253:3</span><br></pre></td></tr></table></figure>



<p><strong>逻辑卷的使用跟硬盘分区使用一样，要先创建文件系统，再进行挂载</strong></p>
<h3 id="扩展和缩减逻辑卷"><a href="#扩展和缩减逻辑卷" class="headerlink" title="扩展和缩减逻辑卷"></a>扩展和缩减逻辑卷</h3><h4 id="在线扩展逻辑卷"><a href="#在线扩展逻辑卷" class="headerlink" title="在线扩展逻辑卷"></a>在线扩展逻辑卷</h4><p>扩展逻辑卷之前，要先保证卷组上还有空间 </p>
<p>两步实现，先扩展逻辑卷，再扩容文件系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一步实现逻辑卷的空间扩展</span></span><br><span class="line">lvextend -L [+]N[mMgGtT] /dev/VG_NAME/LV_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二步实现文件系统的扩展</span></span><br><span class="line"><span class="comment">#针对ext</span></span><br><span class="line">resize2fs /dev/VG_NAME/LV_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#针对xfs </span></span><br><span class="line">xfs_growfs MOUNTPOINT</span><br></pre></td></tr></table></figure>

<p>一步实现容量和文件系统的扩展</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvresize -r -l +100%FREE /dev/VG_NAME/LV_NAME</span><br></pre></td></tr></table></figure>



<h4 id="缩减逻辑卷"><a href="#缩减逻辑卷" class="headerlink" title="缩减逻辑卷"></a>缩减逻辑卷</h4><p><strong>注意：缩减有数据损坏的风险，建议先备份再缩减，不支持在线缩减，要先取消挂载，xfs文件系统不支持缩减</strong></p>
<p><strong>缩减流程</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#取消挂载</span></span><br><span class="line">umount /dev/VG_NAME/LV_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件系统检测,e2fsck可写成fsck</span></span><br><span class="line">e2fsck -f /dev/VG_NAME/LV_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#缩减文件系统到指定大小</span></span><br><span class="line">resize2fs /dev/VG_NAME/LV_NAME N[mMgGtT]</span><br><span class="line"></span><br><span class="line"><span class="comment">#缩减逻辑卷</span></span><br><span class="line">lvreduce -L [-] N[mMgGtT] /dev/VG_NAME/LV_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新挂载</span></span><br><span class="line">mount /dev/VG_NAME/LV_NAME mountpoint</span><br></pre></td></tr></table></figure>

<p><strong>简化缩减流程</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">umount /dev/VG_NAME/LV_NAME</span><br><span class="line">lvreduce  -L N[mMgGtT] -r /dev/VG_NAME/LV_NAME</span><br><span class="line">mount /dev/VG_NAME/LV_NAME mountpoint</span><br></pre></td></tr></table></figure>

<p>范例: 缩减XFS文件系统的逻辑</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#因为XFS文件系统不支持缩减,可以用下面方式缩减</span></span><br><span class="line"><span class="comment">#先备份XFS文件系统数据</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#yum -y install xfsdump</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#备份/data挂载点对应的逻辑卷</span></span><br><span class="line"><span class="comment">#注意挂载点后面不要加/,否则会出错:xfsdump: ERROR: /data/ does not identify a file </span></span><br><span class="line">system</span><br><span class="line">[root@centos8 ~]<span class="comment">#xfsdump -f data.img /data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载文件系统</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#umount /data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#缩减逻辑卷</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#lvreduce -L 10G /dev/vg0/lv0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新创建文件系统</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#mkfs.xfs -f /dev/vg0/lv0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新挂载</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#mount /dev/vg0/lv0 /data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#还原数据</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#xfsrestore -f data.img /data</span></span><br></pre></td></tr></table></figure>

<h3 id="跨主机迁移卷组"><a href="#跨主机迁移卷组" class="headerlink" title="跨主机迁移卷组"></a>跨主机迁移卷组</h3><p>源计算机上 </p>
<p>1 在旧系统中，umount 所有卷组上的逻辑卷 </p>
<p>2 禁用卷组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vgchange -a n vg0 </span><br><span class="line">lvdisplay</span><br></pre></td></tr></table></figure>

<p>3 导出卷组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vgexport vg0 </span><br><span class="line">pvscan</span><br><span class="line">vgdisplay</span><br></pre></td></tr></table></figure>

<p>4 拆下旧硬盘在目标计算机上,并导入卷组：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgimport vg0</span><br></pre></td></tr></table></figure>

<p>5 启用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgchange -ay vg0</span><br></pre></td></tr></table></figure>

<p>6 mount 所有卷组上的逻辑卷</p>
<h3 id="拆除指定的PV存储设备"><a href="#拆除指定的PV存储设备" class="headerlink" title="拆除指定的PV存储设备"></a>拆除指定的PV存储设备</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#pvdisplay </span></span><br><span class="line">  --- Physical volume ---</span><br><span class="line"> PV Name               /dev/sda7</span><br><span class="line"> VG Name               vg0</span><br><span class="line"> PV Size               3.00 GiB / not usable 4.00 MiB</span><br><span class="line"> Allocatable           <span class="built_in">yes</span></span><br><span class="line"> PE Size               4.00 MiB</span><br><span class="line"> Total PE              767</span><br><span class="line"> Free PE               255</span><br><span class="line"> Allocated PE          512</span><br><span class="line"> PV UUID               rAYPLI-H4Or-Kz7L-44So-IZaD-vEbj-meOz7N</span><br><span class="line">   </span><br><span class="line">  --- Physical volume ---</span><br><span class="line"> PV Name               /dev/sdc</span><br><span class="line"> VG Name               vg0</span><br><span class="line"> PV Size               10.00 GiB / not usable 4.00 MiB</span><br><span class="line"> Allocatable           <span class="built_in">yes</span></span><br><span class="line"> PE Size               4.00 MiB</span><br><span class="line"> Total PE              2559</span><br><span class="line"> Free PE               2303</span><br><span class="line"> Allocated PE          256</span><br><span class="line"> PV UUID               RDR8Ge-Oxb0-OrT2-CVj7-8doA-r5fo-hj4ZCm</span><br><span class="line">   </span><br><span class="line">  --- Physical volume ---</span><br><span class="line"> PV Name               /dev/sdb</span><br><span class="line"> VG Name               vg0</span><br><span class="line"> PV Size               20.00 GiB / not usable 4.00 MiB</span><br><span class="line"> Allocatable           <span class="built_in">yes</span></span><br><span class="line"> PE Size               4.00 MiB</span><br><span class="line"> Total PE              5119</span><br><span class="line"> Free PE               5119</span><br><span class="line"> Allocated PE          0</span><br><span class="line"> PV UUID               Ky0f8z-qjVT-ikWZ-gfwL-H5d7-ZsZ2-NDcJ3v</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 把pv 上的数据移走</span></span><br><span class="line"> [root@centos8 ~]<span class="comment"># pvmove /dev/sdc </span></span><br><span class="line"> /dev/sdc: Moved: 0.78%</span><br><span class="line"> /dev/sdc: Moved: 100.00%</span><br><span class="line"> </span><br><span class="line"> [root@centos8 ~]<span class="comment"># pvdisplay </span></span><br><span class="line">  --- Physical volume ---</span><br><span class="line"> PV Name               /dev/sda7</span><br><span class="line"> VG Name               vg0</span><br><span class="line"> PV Size               3.00 GiB / not usable 4.00 MiB</span><br><span class="line"> Allocatable           <span class="built_in">yes</span></span><br><span class="line"> PE Size               4.00 MiB</span><br><span class="line"> Total PE              767</span><br><span class="line"> Free PE               255</span><br><span class="line"> Allocated PE          512</span><br><span class="line"> PV UUID               rAYPLI-H4Or-Kz7L-44So-IZaD-vEbj-meOz7N</span><br><span class="line">   </span><br><span class="line">  --- Physical volume ---</span><br><span class="line"> PV Name               /dev/sdc</span><br><span class="line"> VG Name               vg0</span><br><span class="line"> PV Size               10.00 GiB / not usable 4.00 MiB</span><br><span class="line"> Allocatable           <span class="built_in">yes</span></span><br><span class="line"> PE Size               4.00 MiB</span><br><span class="line"> Total PE              2559</span><br><span class="line"> Free PE               2559</span><br><span class="line"> Allocated PE          0</span><br><span class="line"> PV UUID               RDR8Ge-Oxb0-OrT2-CVj7-8doA-r5fo-hj4ZCm</span><br><span class="line">   </span><br><span class="line">  --- Physical volume ---</span><br><span class="line"> PV Name               /dev/sdb</span><br><span class="line"> VG Name               vg0</span><br><span class="line"> PV Size               20.00 GiB / not usable 4.00 MiB</span><br><span class="line"> Allocatable           <span class="built_in">yes</span></span><br><span class="line"> PE Size               4.00 MiB</span><br><span class="line"> Total PE              5119</span><br><span class="line"> Free PE               4863</span><br><span class="line"> Allocated PE          256</span><br><span class="line"> PV UUID               Ky0f8z-qjVT-ikWZ-gfwL-H5d7-ZsZ2-NDcJ3v</span><br><span class="line"> </span><br><span class="line"><span class="comment">#从vg0中删除指定pv</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># vgreduce vg0 /dev/sdc</span></span><br><span class="line"> Removed <span class="string">&quot;/dev/sdc&quot;</span> from volume group <span class="string">&quot;vg0&quot;</span></span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># pvs</span></span><br><span class="line"> PV         VG Fmt Attr PSize   PFree   </span><br><span class="line"> /dev/sda7 vg0 lvm2 a--   &lt;3.00g 1020.00m</span><br><span class="line"> /dev/sdb   vg0 lvm2 a-- &lt;20.00g &lt;19.00g</span><br><span class="line"> /dev/sdc       lvm2 ---   10.00g   10.00g</span><br><span class="line"> </span><br><span class="line"><span class="comment">#删除pv</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># pvremove /dev/sdc</span></span><br><span class="line"> Labels on physical volume <span class="string">&quot;/dev/sdc&quot;</span> successfully wiped</span><br></pre></td></tr></table></figure>

<h2 id="逻辑卷快照"><a href="#逻辑卷快照" class="headerlink" title="逻辑卷快照"></a>逻辑卷快照</h2><h3 id="逻辑卷快照原理"><a href="#逻辑卷快照原理" class="headerlink" title="逻辑卷快照原理"></a>逻辑卷快照原理</h3><p><img src="../../../../images/SRE/day09/25.png" alt="25"></p>
<p>快照是特殊的逻辑卷，它是在生成快照时存在的逻辑卷的准确拷贝,对于需要备份或者复制的现有数据临时拷贝以及其它操作来说，快照是最合适的选择,快照只有在它们和原来的逻辑卷不同时才会消耗空间， 建立快照的卷大小小于等于原始逻辑卷,也可以使用lvextend扩展快照 </p>
<p>逻辑卷管理器快照</p>
<p>快照就是将当时的系统信息记录下来，就好像照相一般，若将来有任何数据改动了，则原始数据会被移动到快照区，没有改动的区域则由快照区和文件系统共享 </p>
<p>逻辑卷快照工作原理</p>
<ul>
<li>在生成快照时会分配给它一定的空间，但只有在原来的逻辑卷或者快照有所改变才会使用这些空间</li>
<li>当原来的逻辑卷中有所改变时，会将旧的数据复制到快照中</li>
<li>快照中只含有原来的逻辑卷中更改的数据或者自生成快照后的快照中更改的数据</li>
</ul>
<p><img src="../../../../images/SRE/day09/26.png" alt="26"></p>
<ol>
<li>如果log_lv 中的文件不做任何修改，则快照空间为空 </li>
<li>修改f1，第一次修改时，将修改前的f1推到快照，后面的修改不管</li>
<li>删除f2，将f2推送到快照</li>
<li>新建f3,不会被推送到快照 </li>
<li>使用快照还原，则f1被还原，f2被还原，f3也没有了</li>
</ol>
<p>由于快照区与原本的LV共用很多PE的区块，因此快照与被快照的LV必须在同一个VG中。系统恢复的时候的文件数量不能高于快照区的实际容量 </p>
<p>快照特点:</p>
<ul>
<li>备份速度快，瞬间完成 </li>
<li>应用场景是测试环境，不能完全代替备份 </li>
<li>快照后，逻辑卷的修改速度会一定有影响</li>
</ul>
<h3 id="实现逻辑卷快照"><a href="#实现逻辑卷快照" class="headerlink" title="实现逻辑卷快照"></a>实现逻辑卷快照</h3><p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]$ lvs</span><br><span class="line"> LV       VG     Attr       LSize   Pool Origin Data% Meta% Move Log Cpy%Sync Convert</span><br><span class="line"> root     cs     -wi-ao---- &lt;17.00g                                                    </span><br><span class="line"> swap     cs     -wi-ao----   2.00g                                                    </span><br><span class="line"> log_lv   testvg -wi-ao----   6.00g                                                    </span><br><span class="line"> mysql_lv testvg -wi-ao----   4.00g </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#为逻辑卷创建快照</span></span><br><span class="line"><span class="comment">#-s 表示快照</span></span><br><span class="line"><span class="comment">#-L 100M 表示大小，大小取决于你要修改多少文件</span></span><br><span class="line"><span class="comment">#-p r 表示该卷只读</span></span><br><span class="line">[root@loaclhost ~]$ lvcreate -n mysql_snapshot -s -L 100M -p r /dev/testvg/mysql_lv</span><br><span class="line"> Rounding up size to full physical extent 112.00 MiB</span><br><span class="line"> Logical volume <span class="string">&quot;mysql_snapshot&quot;</span> created.</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@loaclhost ~]$ lvs</span><br><span class="line"> LV             VG     Attr       LSize   Pool Origin   Data% Meta% Move Log Cpy%Sync Convert</span><br><span class="line"> root           cs     -wi-ao---- &lt;17.00g                                                      </span><br><span class="line"> swap           cs     -wi-ao----   2.00g                                                      </span><br><span class="line"> log_lv         testvg -wi-ao----   6.00g                                                      </span><br><span class="line"> mysql_lv       testvg owi-aos---   4.00g                                                      </span><br><span class="line"> mysql_snapshot testvg sri-a-s--- 112.00m     mysql_lv 0.01 </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">#查看</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$lvdisplay</span> /dev/testvg/mysql_snapshot /dev/testvg/mysql_lv</span><br><span class="line">  --- Logical volume ---</span><br><span class="line"> LV Path               /dev/testvg/mysql_lv</span><br><span class="line"> LV Name               mysql_lv</span><br><span class="line"> VG Name               testvg</span><br><span class="line"> LV UUID               yru9Eg-Nexc-xZiH-x0YF-1WZc-A1cd-h6SQGI</span><br><span class="line"> LV Write Access       <span class="built_in">read</span>/write</span><br><span class="line"> LV Creation host, time loaclhost, 2022-05-10 14:21:21 +0800</span><br><span class="line"> LV snapshot status     <span class="built_in">source</span> of</span><br><span class="line">                         mysql_snapshot [active]</span><br><span class="line"> LV Status             available</span><br><span class="line">  <span class="comment"># open                 1</span></span><br><span class="line"> LV Size                4.00 GiB</span><br><span class="line"> Current LE             256</span><br><span class="line"> Segments               1</span><br><span class="line"> Allocation             inherit</span><br><span class="line"> Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line"> Block device           253:2</span><br><span class="line">   </span><br><span class="line">  --- Logical volume ---</span><br><span class="line"> LV Path               /dev/testvg/mysql_snapshot</span><br><span class="line"> LV Name               mysql_snapshot</span><br><span class="line"> VG Name               testvg</span><br><span class="line"> LV UUID               9fxWYK-3y13-DHLI-Dvqk-maAI-60rl-80BpKo</span><br><span class="line"> LV Write Access       <span class="built_in">read</span> only</span><br><span class="line"> LV Creation host, time loaclhost, 2022-05-10 16:38:36 +0800</span><br><span class="line"> LV snapshot status     active destination <span class="keyword">for</span> mysql_lv</span><br><span class="line"> LV Status             available</span><br><span class="line">  <span class="comment"># open                 0</span></span><br><span class="line"> LV Size                4.00 GiB</span><br><span class="line"> Current LE             256</span><br><span class="line"> COW-table size         112.00 MiB</span><br><span class="line"> COW-table LE           7</span><br><span class="line"> Allocated to snapshot  0.01%</span><br><span class="line"> Snapshot chunk size    4.00 KiB</span><br><span class="line"> Segments               1</span><br><span class="line"> Allocation             inherit</span><br><span class="line"> Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line"> Block device           253:6</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"><span class="comment">#创建完成后挂载到目录</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$mkdir</span> /mysql_snapshot</span><br><span class="line">[root@loaclhost ~]<span class="variable">$mount</span> /dev/testvg/mysql_snapshot /mysql_snapshot</span><br><span class="line">mount: /mysql_snapshot: WARNING: device write-protected, mounted read-only.</span><br><span class="line"></span><br><span class="line"><span class="comment">#此时去查看，其内容与源分区一样，其实此时快照分区没有内容，看到的内容都来自源分区</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$ls</span> /mysql/ /mysql_snapshot/ -il</span><br><span class="line">/mysql/:</span><br><span class="line">total 1048600</span><br><span class="line">15 -rw-r--r-- 1 root root          4 May 10 16:37 abc</span><br><span class="line">13 -rw-r--r-- 1 root root 1073741824 May 10 14:32 dd1</span><br><span class="line">11 drwx------ 2 root root      16384 May 10 14:24 lost+found</span><br><span class="line">/mysql_snapshot/:</span><br><span class="line">total 1048600</span><br><span class="line">15 -rw-r--r-- 1 root root          4 May 10 16:37 abc</span><br><span class="line">13 -rw-r--r-- 1 root root 1073741824 May 10 14:32 dd1</span><br><span class="line">11 drwx------ 2 root root      16384 May 10 14:24 lost+found</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改文件后再对比</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$ls</span> /mysql/ /mysql_snapshot/ -il</span><br><span class="line">/mysql/:</span><br><span class="line">total 1048600</span><br><span class="line">15 -rw-r--r-- 1 root root         30 May 10 16:22 abc <span class="comment">#######修改后的</span></span><br><span class="line">13 -rw-r--r-- 1 root root 1073741824 May 10 14:32 dd1</span><br><span class="line">11 drwx------ 2 root root      16384 May 10 14:24 lost+found</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/mysql_snapshot/:</span><br><span class="line">total 1048600</span><br><span class="line">12 -rw-r--r-- 1 root root          4 May 10 14:29 abc <span class="comment">#######修改前的</span></span><br><span class="line">13 -rw-r--r-- 1 root root 1073741824 May 10 14:32 dd1</span><br><span class="line">11 drwx------ 2 root root      16384 May 10 14:24 lost+found</span><br><span class="line"></span><br><span class="line"><span class="comment">#在源中删除或创建新文件再对比</span></span><br></pre></td></tr></table></figure>

<p>使用快照恢复</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先取消挂载</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$umount</span> /mysql_snapshot</span><br><span class="line">[root@loaclhost ~]<span class="variable">$umount</span> /mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#从快照中恢复</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$lvconvert</span> --merge /dev/testvg/mysql_snapshot</span><br><span class="line"> Merging of volume testvg/mysql_snapshot started.</span><br><span class="line"> testvg/mysql_lv: Merged: 100.00%</span><br><span class="line">  </span><br><span class="line"><span class="comment">#挂载回去</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$mount</span> /dev/testvg/mysql_lv /mysql </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$ls</span> /mysql -il</span><br><span class="line">total 1048600</span><br><span class="line">15 -rw-r--r-- 1 root root          4 May 10 16:37 abc</span><br><span class="line">13 -rw-r--r-- 1 root root 1073741824 May 10 14:32 dd1</span><br><span class="line">11 drwx------ 2 root root      16384 May 10 14:24 lost+found</span><br><span class="line"></span><br><span class="line"><span class="comment">#恢复之后快照就没有了，是一次性的</span></span><br><span class="line">[root@loaclhost ~]<span class="variable">$lvs</span></span><br><span class="line"> LV       VG     Attr       LSize   Pool Origin Data% Meta% Move Log Cpy%Sync Convert</span><br><span class="line"> root     cs     -wi-ao---- &lt;17.00g                                                    </span><br><span class="line"> swap     cs     -wi-ao----   2.00g                                                    </span><br><span class="line"> log_lv   testvg -wi-ao----   6.00g                                                    </span><br><span class="line"> mysql_lv testvg -wi-ao----   4.00g</span><br></pre></td></tr></table></figure>

<p><strong>练习</strong> </p>
<ol>
<li>创建一个至少有两个PV组成的大小为20G的名为testvg的VG；要求PE大小为16MB, 而后在卷组中创 建大小为5G的逻辑卷testlv；挂载至/users目录 </li>
<li>新建用户archlinux，要求其家目录为/users/archlinux，而后su切换至archlinux用户，复 制/etc/pam.d目录至自己的家目录 </li>
<li>扩展testlv至7G，要求archlinux用户的文件不能丢失 </li>
<li>收缩testlv至3G，要求archlinux用户的文件不能丢失</li>
<li>对testlv创建快照，并尝试基于快照备份数据，验证快照的功能</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/11/21/SRE-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">http://example.com/2024/11/21/SRE-磁盘存储和文件系统/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SRE/">SRE</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="/../images/SRE/day09/4.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/11/08/ST-Linux%E5%AE%9E%E7%94%A8%E7%94%A8%E8%84%9A%E6%9C%AC/" title="Linux 实用脚本"><img class="cover" src="/../images/TITLE/ST.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux 实用脚本</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/21/ST-%E9%AB%98%E5%8F%AF%E7%94%A8Hadoop/" title="高可用部署 HADOOP"><img class="cover" src="/../images/TITLE/hadoop-jb.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">高可用部署 HADOOP</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/08/27/SRE-Linux%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%92%8CIO%E9%87%8D%E5%AE%9A%E5%90%91/" title="Linux文件管理和IO重定向"><img class="cover" src="/../images/TITLE/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="title">Linux文件管理和IO重定向</div></div></a></div><div><a href="/2024/04/24/SRE-Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%92%8C%E5%B8%AE%E5%8A%A9/" title="Linux基本操作和帮助"><img class="cover" src="/../images/TITLE/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="title">Linux基本操作和帮助</div></div></a></div><div><a href="/2024/12/08/SRE-Linux%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img class="cover" src="/../images/SRE/day17/12.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="title">Linux防火墙</div></div></a></div><div><a href="/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" title="shell脚本编程"><img class="cover" src="/../images/TITLE/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-05</div><div class="title">shell脚本编程</div></div></a></div><div><a href="/2024/12/08/SRE-linux%E5%91%BD%E4%BB%A4%E7%B4%A2%E5%BC%95/" title="linux命令索引"><img class="cover" src="/../images/TITLE/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="title">linux命令索引</div></div></a></div><div><a href="/2024/09/23/SRE-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="常见文本处理工具和正则表达式"><img class="cover" src="/../images/TITLE/linux5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-23</div><div class="title">常见文本处理工具和正则表达式</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/TITLE/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">104</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">35</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">磁盘结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">设备文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E7%9B%98%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">硬盘类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E5%92%8C%E5%9B%BA%E6%80%81%E7%A1%AC%E7%9B%98"><span class="toc-number">1.3.</span> <span class="toc-text">机械硬盘和固态硬盘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E7%9B%98%E5%AD%98%E5%82%A8%E6%9C%AF%E8%AF%AD"><span class="toc-number">1.4.</span> <span class="toc-text">硬盘存储术语</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%AD%98%E5%82%A8"><span class="toc-number">2.</span> <span class="toc-text">管理存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA"><span class="toc-number">2.1.</span> <span class="toc-text">磁盘分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%88%86%E5%8C%BA"><span class="toc-number">2.1.1.</span> <span class="toc-text">为什么分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">2.1.2.</span> <span class="toc-text">分区方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MBR%E5%88%86%E5%8C%BA"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">MBR分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GPT%E5%88%86%E5%8C%BA"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">GPT分区</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BIOS%E5%92%8CUEFI"><span class="toc-number">2.1.3.</span> <span class="toc-text">BIOS和UEFI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%88%86%E5%8C%BA"><span class="toc-number">2.1.4.</span> <span class="toc-text">管理分区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#parted-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">parted 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%B7%A5%E5%85%B7fdisk%E5%92%8Cgdisk"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">分区工具fdisk和gdisk</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.2.</span> <span class="toc-text">文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5"><span class="toc-number">2.2.1.</span> <span class="toc-text">文件系统概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">文件系统类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">2.2.3.</span> <span class="toc-text">文件系统的组成部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E9%80%89%E6%8B%A9%E7%AE%A1%E7%90%86"><span class="toc-number">2.2.4.</span> <span class="toc-text">文件系统选择管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">创建文件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E7%AE%A1%E7%90%86%E5%88%86%E5%8C%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">查看和管理分区信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%B5%8B%E5%92%8C%E4%BF%AE%E5%A4%8D"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">文件系统检测和修复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD"><span class="toc-number">2.3.</span> <span class="toc-text">挂载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-mount"><span class="toc-number">2.3.1.</span> <span class="toc-text">挂载文件系统 mount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-umount"><span class="toc-number">2.3.2.</span> <span class="toc-text">卸载文件系统 umount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%82%E8%BD%BD%E6%83%85%E5%86%B5"><span class="toc-number">2.3.3.</span> <span class="toc-text">查看挂载情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E6%8C%82%E8%BD%BD"><span class="toc-number">2.3.4.</span> <span class="toc-text">持久挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E6%8C%82%E8%BD%BD"><span class="toc-number">2.3.5.</span> <span class="toc-text">重新挂载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E4%BA%A4%E6%8D%A2%E6%96%87%E4%BB%B6%E5%92%8C%E5%88%86%E5%8C%BA"><span class="toc-number">2.4.</span> <span class="toc-text">处理交换文件和分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#swap-%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.4.1.</span> <span class="toc-text">swap 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%8D%A2%E5%88%86%E5%8C%BA%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">2.4.2.</span> <span class="toc-text">交换分区实现过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swap%E7%9A%84%E4%BD%BF%E7%94%A8%E7%AD%96%E7%95%A5"><span class="toc-number">2.4.3.</span> <span class="toc-text">swap的使用策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E4%BB%8B%E8%B4%A8"><span class="toc-number">2.5.</span> <span class="toc-text">移动介质</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%85%89%E7%9B%98"><span class="toc-number">2.5.1.</span> <span class="toc-text">使用光盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#USB%E4%BB%8B%E8%B4%A8"><span class="toc-number">2.5.2.</span> <span class="toc-text">USB介质</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E5%B8%B8%E8%A7%81%E5%B7%A5%E5%85%B7"><span class="toc-number">2.6.</span> <span class="toc-text">磁盘常见工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7-df"><span class="toc-number">2.6.1.</span> <span class="toc-text">文件系统查看工具 df</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%9F%E8%AE%A1%E5%B7%A5%E5%85%B7-du"><span class="toc-number">2.6.2.</span> <span class="toc-text">目录统计工具 du</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%B7%A5%E5%85%B7-dd"><span class="toc-number">2.6.3.</span> <span class="toc-text">文件工具 dd</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAID"><span class="toc-number">3.</span> <span class="toc-text">RAID</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFRAID"><span class="toc-number">3.1.</span> <span class="toc-text">什么是RAID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAID%E7%BA%A7%E5%88%AB"><span class="toc-number">3.2.</span> <span class="toc-text">RAID级别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-0"><span class="toc-number">3.2.1.</span> <span class="toc-text">RAID-0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">RAID-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-4"><span class="toc-number">3.2.3.</span> <span class="toc-text">RAID-4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-5"><span class="toc-number">3.2.4.</span> <span class="toc-text">RAID-5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-6"><span class="toc-number">3.2.5.</span> <span class="toc-text">RAID-6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-10"><span class="toc-number">3.2.6.</span> <span class="toc-text">RAID-10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-01"><span class="toc-number">3.2.7.</span> <span class="toc-text">RAID-01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-50"><span class="toc-number">3.2.8.</span> <span class="toc-text">RAID-50</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-60"><span class="toc-number">3.2.9.</span> <span class="toc-text">RAID-60</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E7%BA%A7%E5%88%AB"><span class="toc-number">3.2.10.</span> <span class="toc-text">其它级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID-%E6%80%BB%E7%BB%93"><span class="toc-number">3.2.11.</span> <span class="toc-text">RAID 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%BD%AFRAID"><span class="toc-number">3.3.</span> <span class="toc-text">实现软RAID</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%88LVM%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">逻辑卷管理器（LVM）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LVM%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">LVM介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%8D%B7"><span class="toc-number">4.2.</span> <span class="toc-text">实现逻辑卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pv%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">4.2.1.</span> <span class="toc-text">pv管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vg%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">4.2.2.</span> <span class="toc-text">vg管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lv%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">4.2.3.</span> <span class="toc-text">lv管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%92%8C%E7%BC%A9%E5%87%8F%E9%80%BB%E8%BE%91%E5%8D%B7"><span class="toc-number">4.2.4.</span> <span class="toc-text">扩展和缩减逻辑卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E6%89%A9%E5%B1%95%E9%80%BB%E8%BE%91%E5%8D%B7"><span class="toc-number">4.2.4.1.</span> <span class="toc-text">在线扩展逻辑卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%A9%E5%87%8F%E9%80%BB%E8%BE%91%E5%8D%B7"><span class="toc-number">4.2.4.2.</span> <span class="toc-text">缩减逻辑卷</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E4%B8%BB%E6%9C%BA%E8%BF%81%E7%A7%BB%E5%8D%B7%E7%BB%84"><span class="toc-number">4.2.5.</span> <span class="toc-text">跨主机迁移卷组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E9%99%A4%E6%8C%87%E5%AE%9A%E7%9A%84PV%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87"><span class="toc-number">4.2.6.</span> <span class="toc-text">拆除指定的PV存储设备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7"><span class="toc-number">4.3.</span> <span class="toc-text">逻辑卷快照</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7%E5%8E%9F%E7%90%86"><span class="toc-number">4.3.1.</span> <span class="toc-text">逻辑卷快照原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7"><span class="toc-number">4.3.2.</span> <span class="toc-text">实现逻辑卷快照</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/10/MY-k8s%E5%AE%B9%E5%BF%8D%E6%B1%A1%E7%82%B9%E4%BA%B2%E5%92%8CHPA/" title="容忍/污点/亲和/HPA"><img src="/../images/SRE/day46/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="容忍/污点/亲和/HPA"/></a><div class="content"><a class="title" href="/2025/08/10/MY-k8s%E5%AE%B9%E5%BF%8D%E6%B1%A1%E7%82%B9%E4%BA%B2%E5%92%8CHPA/" title="容忍/污点/亲和/HPA">容忍/污点/亲和/HPA</a><time datetime="2025-08-10T09:35:57.000Z" title="发表于 2025-08-10 17:35:57">2025-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/01/MY-Proxy/" title="Proxy 代理"><img src="/../images/MY/clash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Proxy 代理"/></a><div class="content"><a class="title" href="/2025/08/01/MY-Proxy/" title="Proxy 代理">Proxy 代理</a><time datetime="2025-08-01T11:05:46.000Z" title="发表于 2025-08-01 19:05:46">2025-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2"><img src="/../images/SRE/day46/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S 1.29.2"/></a><div class="content"><a class="title" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2">K8S 1.29.2</a><time datetime="2025-07-30T07:17:21.000Z" title="发表于 2025-07-30 15:17:21">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins"><img src="/../images/SRE/day55/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DevOps之CICD工具Jenkins"/></a><div class="content"><a class="title" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins">DevOps之CICD工具Jenkins</a><time datetime="2025-05-09T09:30:43.000Z" title="发表于 2025-05-09 17:30:43">2025-05-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="../images/BEIAN/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="../images/BEIAN/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>