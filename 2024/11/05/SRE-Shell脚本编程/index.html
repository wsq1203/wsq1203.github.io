<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>shell脚本编程 | ૮(˶ᵔ ᵕ ᵔ˶)ა</title><meta name="author" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="copyright" content="૮(˶ᵔ ᵕ ᵔ˶)ა"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Site Reliability Engineering">
<meta property="og:type" content="article">
<meta property="og:title" content="shell脚本编程">
<meta property="og:url" content="http://example.com/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="og:description" content="Site Reliability Engineering">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/TITLE/linux2.jpg">
<meta property="article:published_time" content="2024-11-04T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-01T11:34:55.941Z">
<meta property="article:author" content="૮(˶ᵔ ᵕ ᵔ˶)ა">
<meta property="article:tag" content="SRE">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/TITLE/linux2.jpg"><link rel="shortcut icon" href="/../images/TITLE/user.webp"><link rel="canonical" href="http://example.com/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'shell脚本编程',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2025-04-01 19:34:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/../images/TITLE/user.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">104</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">35</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../images/TITLE/linux2.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="૮(˶ᵔ ᵕ ᵔ˶)ა"><span class="site-name">૮(˶ᵔ ᵕ ᵔ˶)ა</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">shell脚本编程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-04T16:00:00.000Z" title="发表于 2024-11-05 00:00:00">2024-11-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-01T11:34:55.941Z" title="更新于 2025-04-01 19:34:55">2025-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">25.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>118分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="shell脚本编程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="shell-脚本语言的基本用法"><a href="#shell-脚本语言的基本用法" class="headerlink" title="shell 脚本语言的基本用法"></a>shell 脚本语言的基本用法</h1><h2 id="shell-脚本的用途"><a href="#shell-脚本的用途" class="headerlink" title="shell 脚本的用途"></a>shell 脚本的用途</h2><ul>
<li>将简单的命令组合完成复杂的工作，自动化执行命令，提高工作效率 </li>
<li>减少手工命令的输入，一定程度上避免人为错误 </li>
<li>将软件或应用的安装及配置实现标准化 </li>
<li>用于实现日常性的,重复性的，非交互式的运维工作，如：文件打包压缩备份,监控系统运行状态并实现告警等</li>
</ul>
<h2 id="shell-脚本基本结构"><a href="#shell-脚本基本结构" class="headerlink" title="shell 脚本基本结构"></a>shell 脚本基本结构</h2><p>shell是基于过程式、解释执行的语言。 </p>
<p>shell脚本是包含一些命令或声明，并符合一定格式的文本文件。</p>
<p>一个shell脚本文件中主要包含以下内容</p>
<ul>
<li>各种系统命令的组合</li>
<li>数据存储：变量、数组</li>
<li>表达式：a + b</li>
<li>控制语句：if</li>
</ul>
<p>格式要求：首行shebang机制</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#!/usr/bin/perl </span></span><br><span class="line"><span class="comment">#!/usr/bin/ruby</span></span><br><span class="line"><span class="comment">#!/usr/bin/lua</span></span><br></pre></td></tr></table></figure>

<h2 id="shell脚本创建过程"><a href="#shell脚本创建过程" class="headerlink" title="shell脚本创建过程"></a>shell脚本创建过程</h2><ol>
<li>用编辑器创建新文件，首行必须是 shell 声明（shebang），编辑完成后保存退出 </li>
<li>添加可执行权限 </li>
<li>运行脚本</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建文件</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vim test.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加可执行权限</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># chmod +x test.sh</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 执行，相对路径</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ./test.sh </span></span><br><span class="line"> hello world</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 执行，绝对路径</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># /root/test.sh </span></span><br><span class="line"> hello world</span><br></pre></td></tr></table></figure>

<h2 id="shell-脚本注释规范"><a href="#shell-脚本注释规范" class="headerlink" title="shell 脚本注释规范"></a>shell 脚本注释规范</h2><p>一般要注明作者，创建(修改)时间，文件名，版本号，该程序的功能及作用，目地，版权信息，作者联系方式等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="comment"># </span></span><br><span class="line"> <span class="comment"># ****************************************************</span></span><br><span class="line"> <span class="comment"># Author:            jose</span></span><br><span class="line"> <span class="comment"># QQ:                123456</span></span><br><span class="line"> <span class="comment"># Date:              2022-08-16</span></span><br><span class="line"> <span class="comment"># FileName:          test.sh</span></span><br><span class="line"> <span class="comment"># URL:               http://www.magedu.com</span></span><br><span class="line"> <span class="comment"># Description:       test</span></span><br><span class="line"> <span class="comment"># Copyright(C):      2022 All right</span></span><br><span class="line"> <span class="comment"># ***************************************************</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure>

<p>配置vim 自动生成注释</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim .vimrc</span></span><br><span class="line"> <span class="built_in">set</span> nu</span><br><span class="line"> <span class="built_in">set</span> ts=4</span><br><span class="line"> autocmd BufNewFile *.sh <span class="built_in">exec</span> <span class="string">&quot;:call SetTitle()&quot;</span></span><br><span class="line"> func SetTitle()</span><br><span class="line"> <span class="keyword">if</span> <span class="built_in">expand</span>(<span class="string">&quot;%:e&quot;</span>) == <span class="string">&#x27;sh&#x27;</span></span><br><span class="line">        call setline(1,<span class="string">&quot;#!/bin/bash&quot;</span>)</span><br><span class="line">        call setline(2,<span class="string">&quot;# &quot;</span>)</span><br><span class="line">        call setline(3,<span class="string">&quot;# ****************************************************&quot;</span>)</span><br><span class="line">        call setline(4,<span class="string">&quot;# Author:            jose&quot;</span>)</span><br><span class="line">        call setline(5,<span class="string">&quot;# QQ:                123456&quot;</span>)</span><br><span class="line">        call setline(6,<span class="string">&quot;# Date:              &quot;</span>.strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>))</span><br><span class="line">        call setline(7,<span class="string">&quot;# FileName:          &quot;</span>.<span class="built_in">expand</span>(<span class="string">&quot;%&quot;</span>))</span><br><span class="line">        call setline(8,<span class="string">&quot;# URL:               http://www.magedu.com&quot;</span>)</span><br><span class="line">        call setline(9,<span class="string">&quot;# Description:       test&quot;</span>)</span><br><span class="line">        call setline(10,<span class="string">&quot;# Copyright(C):     &quot;</span>.strftime(<span class="string">&quot;%Y&quot;</span>).<span class="string">&quot; All right&quot;</span>)</span><br><span class="line">        call setline(11,<span class="string">&quot;# ***************************************************&quot;</span>)</span><br><span class="line">        call setline(12,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        call setline(13,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        call setline(14,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    endif</span><br><span class="line"> endfunc</span><br></pre></td></tr></table></figure>

<h2 id="第一个-shell-脚本"><a href="#第一个-shell-脚本" class="headerlink" title="第一个 shell 脚本"></a>第一个 shell 脚本</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim hello.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="comment"># </span></span><br><span class="line"> <span class="comment"># ****************************************************</span></span><br><span class="line"> <span class="comment"># Author:            jose</span></span><br><span class="line"> <span class="comment"># QQ:                123456</span></span><br><span class="line"> <span class="comment"># Date:              2022-08-16</span></span><br><span class="line"> <span class="comment"># FileName:          test.sh</span></span><br><span class="line"> <span class="comment"># URL:               http://www.magedu.com</span></span><br><span class="line"> <span class="comment"># Description:       test</span></span><br><span class="line"> <span class="comment"># Copyright(C):      2022 All right</span></span><br><span class="line"> <span class="comment"># ***************************************************</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 经典写法</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;hello, world&quot;</span></span><br><span class="line"> <span class="comment"># 流行写法</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&#x27;Hello, world!&#x27;</span></span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># bash hello.sh </span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 管道</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat hello.sh | bash</span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 重定向</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash &lt; hello.sh </span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 重定向</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash &lt;&lt;&lt; $(cat hello.sh)</span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># chmod +x hello.sh </span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 绝对路径</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># /root/hello.sh </span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 相对路径</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ./hello.sh </span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 当前进程中执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># . hello.sh </span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 子进程中执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># . /hello.sh </span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br></pre></td></tr></table></figure>

<p>本地执行远程脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># curl http://10.0.0.157/test.sh -s | bash</span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># curl http://10.0.0.157/test.sh 2&gt;/dev/null | bash</span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># wget -qO -  http://10.0.0.157/test.sh | bash</span></span><br><span class="line"> hello, world</span><br><span class="line"> Hello, world!</span><br></pre></td></tr></table></figure>

<p>在远程主机运行本地脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat test2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">hostname -I</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash test2.sh </span></span><br><span class="line"> 10.0.0.150 </span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 远程主机上执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ssh root@10.0.0.157 /bin/bash &lt; test2.sh</span></span><br><span class="line"> root@10.0.0.157<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string"> 10.0.0.157</span></span><br></pre></td></tr></table></figure>

<p>范例：备份脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[1;32mStarting backup...\033[0m&quot;</span></span><br><span class="line"><span class="built_in">sleep</span> 2</span><br><span class="line"><span class="built_in">cp</span> -av /etc/ /data/etc`<span class="built_in">date</span> +%F`/</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[1;32mBackup is finished\033[0m&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="shell-脚本调试"><a href="#shell-脚本调试" class="headerlink" title="shell 脚本调试"></a>shell 脚本调试</h2><p>写一个脚本，获取主机系统信息，包括CPU型号，内存大小，硬盘大小，操作系统版本这四个指标</p>
<p>第一个版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim sysinfo-v1.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> lscpu | sed -nr <span class="string">&#x27;s/^Model name: +(.*)/\1/p&#x27;</span></span><br><span class="line"> <span class="built_in">cat</span> /proc/meminfo | <span class="built_in">head</span> -n 1 | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f2,3</span><br><span class="line"> lsblk /dev/sda | grep <span class="string">&quot;^sda&quot;</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f4 </span><br><span class="line"> <span class="built_in">cat</span> /etc/os-release | sed -nr <span class="string">&quot;s/^VERSION=\&quot;(.*)\&quot;/\1/p&quot;</span></span><br><span class="line"> </span><br><span class="line"> [root@rocky86 ~]<span class="comment"># bash sysinfo-v1.sh</span></span><br><span class="line"> 11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz</span><br><span class="line"> 1828236 kB</span><br><span class="line"> 200G</span><br><span class="line"> 8.6 (Green Obsidian)</span><br></pre></td></tr></table></figure>

<p>第二个版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;CPU    \c&quot;</span> </span><br><span class="line">lscpu | sed -nr <span class="string">&#x27;s/^Model name: +(.*)/\1/p&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Mem    \c&quot;</span> </span><br><span class="line"><span class="built_in">cat</span> /proc/meminfo | <span class="built_in">head</span> -n 1 | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f2,3</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;DISK   \c&quot;</span> </span><br><span class="line">lsblk /dev/sda | grep <span class="string">&quot;^sda&quot;</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f4</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;OS \c&quot;</span> </span><br><span class="line"><span class="built_in">cat</span> /etc/os-release | sed -nr <span class="string">&quot;s/^VERSION=\&quot;(.*)\&quot;/\1/p&quot;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash sysinfo-v2.sh</span></span><br><span class="line"> CPU     11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz</span><br><span class="line"> Mem     1828236 kB</span><br><span class="line"> DISK    200G</span><br><span class="line"> OS      8.6 (Green Obsidian)</span><br></pre></td></tr></table></figure>

<p>第三个版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;========================= sysinfo begin ================\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;CPU    \c&quot;</span> </span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32m `lscpu | sed -nr &#x27;s/^Model name: +(.*)/\1/p&#x27;` \E[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Mem    \c&quot;</span> </span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32m `cat /proc/meminfo | head -n 1 | tr -s &quot;</span> <span class="string">&quot; | cut -d&quot;</span> <span class="string">&quot; -f2,3` \E[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;DISK   \c&quot;</span> </span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32m `lsblk /dev/sda | grep &quot;</span>^sda<span class="string">&quot; | tr -s &quot;</span> <span class="string">&quot; | cut -d&quot;</span> <span class="string">&quot; -f4` \E[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;OS \c&quot;</span> </span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32m `cat /etc/os-release | sed -nr &#x27;s/^VERSION=\&quot;(.*)\&quot;/\1/p&#x27;` \E[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n========================= sysinfo end ==================&quot;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash sysinfo-v3.sh</span></span><br><span class="line"> ========================= sysinfo begin ================</span><br><span class="line"> CPU       11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz </span><br><span class="line"> Mem       1828236 kB </span><br><span class="line"> DISK      200G </span><br><span class="line"> OS        8.6 (Green Obsidian) </span><br><span class="line">========================= sysinfo end ==================</span><br></pre></td></tr></table></figure>

<p>执行前先做语法检查</p>
<p>此选项只能检测脚本中的语法错误，不能检测命令错误，也不会执行脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -n test.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test3.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line"> xxxxx</span><br><span class="line"> lscpu | sed -n p<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@rocky86 ~]# bash -n test3.sh</span></span><br><span class="line"><span class="string"> test3.sh: line 17: unexpected EOF while looking for matching `&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"> test3.sh: line 18: syntax error: unexpected end of file</span></span><br></pre></td></tr></table></figure>

<p>调试并执行</p>
<p>逐行输出命令，并输出执行结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -x test.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># bash -x test3.sh </span></span><br><span class="line"> + <span class="built_in">echo</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> hello world</span><br><span class="line"> + xxxxx</span><br><span class="line"> test3.sh: line 15: xxxxx: <span class="built_in">command</span> not found</span><br><span class="line"> test3.sh: line 17: unexpected EOF <span class="keyword">while</span> looking <span class="keyword">for</span> matching `<span class="string">&#x27;&#x27;</span></span><br><span class="line"> test3.sh: line 18: syntax error: unexpected end of file</span><br></pre></td></tr></table></figure>

<p>总结：脚本错误常见的有三种</p>
<ul>
<li>语法错误：会导致后续的命令不继续执行，可以用 bash -n 检查错误，提示的出错行数不一定是准确的</li>
<li>命令错误：默认后续的命令还会继续执行，用 bash -n 无法检查出来 ，可以使用 bash -x 进行观察</li>
<li>逻辑错误：只能使用 bash -x 进行观察</li>
</ul>
<p>一个空格引发的血案</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test4.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">cat</span> &gt; test.conf&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"> $(hostname)</span></span><br><span class="line"><span class="string"> $(hostname -I)</span></span><br><span class="line"><span class="string"> EOF</span> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;==== over ====&quot;</span></span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash test4.sh</span></span><br><span class="line"> test4.sh: line 18: warning: here-document at line 14 delimited by end-of-file (wanted `EOF<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@rocky86 ~]# cat -nA test4.sh</span></span><br><span class="line"><span class="string"> 1  #!/bin/bash$</span></span><br><span class="line"><span class="string"> 2  $</span></span><br><span class="line"><span class="string"> 3  cat &gt; test.conf&lt;&lt;EOF$</span></span><br><span class="line"><span class="string"> 4  $(hostname)$</span></span><br><span class="line"><span class="string"> 5  $(hostname -I)$</span></span><br><span class="line"><span class="string"> 6  EOF $     # ===================================== 这里多了一个空格</span></span><br><span class="line"><span class="string"> 7  echo &quot;==== over ====&quot;$</span></span><br></pre></td></tr></table></figure>

<p>请问：这是哪种错误？</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取一天后的 Y-m-d</span></span><br><span class="line"> <span class="built_in">sleep</span> $[24*3600]; <span class="built_in">date</span> +%F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的写法</span></span><br><span class="line"> <span class="built_in">date</span> +%F --<span class="built_in">date</span>=<span class="string">&quot;+ day&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="变量-1"><a href="#变量-1" class="headerlink" title="变量"></a>变量</h3><p>变量表示命名的内存空间，将数据放在内存空间中，通过变量名引用，获取数据</p>
<p>数据要存在内存空间中，而内存空间又是通过内存地址来访问的，但内存地址一般是16进制的编号； </p>
<p>为了方便使用，就有了变量名，当访问一个变量时，实际是访问其对应的内存地址的那块内存空间；</p>
<p><img src="../../../../images/SRE/day07/1.png" alt="1"></p>
<p>如上图所示 </p>
<p>我们要获取 123 ，有两种方式，一种是通过变量名 x，另一种是通过内存地址(指针) 0x7ff995d4412，很明显是通过变量名更方便</p>
<h3 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h3><p>变量类型：</p>
<ul>
<li>内置变量，如：PS1，PATH，UID，HOSTNAME，$$，BASHPID，PPID，$?，HISTSIZE  </li>
<li>用户自定义变量</li>
</ul>
<p>不同的变量存放的数据不同，决定了以下 </p>
<ul>
<li>数据存储方式  </li>
<li>参与的运算  </li>
<li>表示的数据范围</li>
</ul>
<p>变量数据类型： </p>
<ul>
<li>字符 </li>
<li>数值：整型、浮点型，bash 不支持浮点数 </li>
<li>布尔 </li>
<li>指针 </li>
<li>结构体</li>
</ul>
<h3 id="编程语言分类"><a href="#编程语言分类" class="headerlink" title="编程语言分类"></a>编程语言分类</h3><p><img src="../../../../images/SRE/day07/2.png" alt="2"></p>
<p><strong>静态和动态语言</strong> </p>
<ul>
<li>静态编译语言：使用变量前，先声明变量类型，之后类型不能改变，在编译时检查，如：java，c  </li>
<li>动态编译语言：不用事先声明，可随时改变类型，如：bash，Python</li>
</ul>
<p>静态类型</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="meta"># vim test.cpp</span></span><br><span class="line"> <span class="meta"># <span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> <span class="meta"># <span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"> <span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"> 	<span class="type">int</span> var1=<span class="number">123</span>;</span><br><span class="line"> 	<span class="type">bool</span> var2=<span class="literal">false</span>;</span><br><span class="line"> 	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>动态类型</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"> var1=123</span><br><span class="line"> var2=<span class="string">&quot;abc&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var2</span></span><br></pre></td></tr></table></figure>

<p>强类型和弱类型语言 </p>
<ul>
<li>强类型语言：不同类型数据操作，必须经过强制转换才同一类型才能运算，如: java ， c# ， python  </li>
<li>弱类型语言：语言的运行时会隐式做数据类型转换。无须指定类型，默认均为字符型；参与运算会自动进行隐式类型转换；变量无须事 先定义可直接调用，如：bash ，php，javascript</li>
</ul>
<p>强类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test.py</span></span><br><span class="line"> <span class="comment">#!/bin/python</span></span><br><span class="line">    </span><br><span class="line"> var1=<span class="string">&#x27;magedu&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> var1+=<span class="number">10</span>;               <span class="comment"># 这一行会报错，string 和 int 无法用连字符操作</span></span><br><span class="line">    </span><br><span class="line"> var1+=<span class="built_in">str</span>(<span class="number">20</span>);          <span class="comment"># int 要先转换成 string 类型</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">print</span>(var1);</span><br></pre></td></tr></table></figure>

<p>弱类型</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test5.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"> var1=123</span><br><span class="line"> var1+=<span class="string">&quot;abc&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br></pre></td></tr></table></figure>

<h3 id="Shell中变量命名法则"><a href="#Shell中变量命名法则" class="headerlink" title="Shell中变量命名法则"></a>Shell中变量命名法则</h3><h4 id="命名要求"><a href="#命名要求" class="headerlink" title="命名要求"></a>命名要求</h4><ul>
<li>区分大小写 </li>
<li>不能使程序中的保留字和内置变量：如：if, for  </li>
<li>只能使用数字、字母及下划线，且不能以数字开头，注意：不支持短横线 “ - ”，和主机名相反</li>
</ul>
<h4 id="命名习惯"><a href="#命名习惯" class="headerlink" title="命名习惯"></a>命名习惯</h4><ul>
<li>见名知义，用英文单词命名，并体现出实际作用，不要用简写，如：ATM  </li>
<li>变量名大写  </li>
<li>局部变量小写  </li>
<li>函数名小写 </li>
<li>大驼峰StudentFirstName，由多个单词组成，且每个单词的首字母是大写，其它小写  </li>
<li>小驼峰studentFirstName ，由多个单词组成，第一个单词的首字母小写，后续每个单词的首字母是大写，其它小写  </li>
<li>下划线: student_name</li>
</ul>
<h3 id="变量定义和引用"><a href="#变量定义和引用" class="headerlink" title="变量定义和引用"></a>变量定义和引用</h3><p>变量的生效范围等标准划分变量类型 </p>
<ul>
<li>普通变量：生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell 进程均无效  </li>
<li>环境变量：生效范围为当前shell进程及其子进程  </li>
<li>本地变量：生效范围为当前shell进程中某代码片断，通常指函数</li>
</ul>
<p><strong>变量赋值：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">&#x27;value&#x27;</span></span><br></pre></td></tr></table></figure>

<p> value 可以是以下多种形式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">&#x27;root&#x27;</span>                  <span class="comment"># 直接字串   </span></span><br><span class="line">name=<span class="string">&quot;<span class="variable">$USER</span>&quot;</span>                 <span class="comment"># 变量引用  </span></span><br><span class="line">name=`COMMAND`               <span class="comment"># 命令引用   </span></span><br><span class="line">name=$(COMMAND)              <span class="comment"># 命令引用   </span></span><br></pre></td></tr></table></figure>

<p>注意：变量赋值是临时生效，当退出终端后，变量会自动删除，无法持久保存，脚本中的变量会随着脚本结束，也会自动删除</p>
<p><strong>变量引用：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span></span><br><span class="line"><span class="variable">$&#123;name&#125;</span> </span><br></pre></td></tr></table></figure>

<p>弱引用和强引用 </p>
<ul>
<li>“$name” 弱引用，其中的变量引用会被替换为变量值 </li>
<li>‘$name’ 强引用，其中的变量引用不会被替换为变量值，而保持原字符串</li>
</ul>
<p>范例：变量的各种赋值方式和引用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># TITLE=&#x27;cto&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo $TITLE</span></span><br><span class="line">cto</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo I am $TITLE</span></span><br><span class="line">I am cto</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;I am $TITLE&quot;</span></span><br><span class="line">I am cto</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &#x27;I am $TITLE&#x27;</span></span><br><span class="line">I am <span class="variable">$TITLE</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># NAME=$USER</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo $NAME</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令执行结果赋值</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># FILE=`ls /run`</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo $FILE</span></span><br><span class="line">agetty.reload atd.pid auditd.pid console crond.pid cron.reboot cryptsetup dbus dmeventd-client dmeventd-server faillock fsck httpd initctl initramfs irqbalance lock <span class="built_in">log</span> lvm mariadb motd.d mount NetworkManager openvpn-client openvpn-server plymouth rsyslogd.pid screen sepermit setrans sshd.pid sudo systemd tmpfiles.d tuned udev user utmp vmware</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># FILE=/etc/*</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo $FILE</span></span><br><span class="line">/etc/9sklafdnakljsdf /etc/adjtime /etc/aliases /etc/aliases.db /etc/alternatives /etc/anacrontab /etc/asound.conf /etc/at.deny /etc/audit /etc/authselect /etc/bash_completion.d /etc/bashrc</span><br></pre></td></tr></table></figure>

<p>保留格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># seq 5</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># NUM=`seq 5`</span></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo $NUM</span></span><br><span class="line">1 2 3 4 5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;$NUM&quot;</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># NAMES=&quot;wang</span></span><br><span class="line">&gt; zhang</span><br><span class="line">&gt; zhao</span><br><span class="line">&gt; li<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@rocky8 ~]# echo <span class="variable">$NAMES</span></span></span><br><span class="line"><span class="string">wang zhang zhao li</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@rocky8 ~]# echo &quot;</span><span class="variable">$NAMES</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">wang</span></span><br><span class="line"><span class="string">zhang</span></span><br><span class="line"><span class="string">zhao</span></span><br><span class="line"><span class="string">li</span></span><br></pre></td></tr></table></figure>

<p>范例：变量引用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="comment"># NAME=mage</span></span><br><span class="line">[root@centos8 data]<span class="comment"># AGE=20</span></span><br><span class="line">[root@centos8 data]<span class="comment"># echo $NAME</span></span><br><span class="line"> mage</span><br><span class="line"></span><br><span class="line">[root@centos8 data]<span class="comment"># echo $AGE</span></span><br><span class="line"> 20</span><br><span class="line"></span><br><span class="line">[root@centos8 data]<span class="comment"># echo $NAME $AGE</span></span><br><span class="line"> mage 20</span><br><span class="line"></span><br><span class="line">[root@centos8 data]<span class="comment"># echo $NAME$AGE</span></span><br><span class="line"> mage20</span><br><span class="line"></span><br><span class="line">[root@centos8 data]<span class="comment"># echo $NAME_$AGE</span></span><br><span class="line"> 20</span><br><span class="line"></span><br><span class="line">[root@centos8 data]<span class="comment"># echo $&#123;NAME&#125;_$AGE</span></span><br><span class="line"> mage_20</span><br></pre></td></tr></table></figure>

<p>范例：变量的间接赋值和引用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># TITLE=cto</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wang</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># TITLE=$NAME</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $NAME</span></span><br><span class="line"> wang</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $TITLE</span></span><br><span class="line"> wang</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=mage</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $NAME</span></span><br><span class="line"> mage</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $TITLE</span></span><br><span class="line"> wang</span><br></pre></td></tr></table></figure>

<p>范例：变量追加值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># TITLE=CTO</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># TITLE+=:wang</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $TITLE</span></span><br><span class="line"> CTO:wang</span><br></pre></td></tr></table></figure>

<p>范例：利用变量实现动态命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># CMD=hostname</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># $CMD</span></span><br><span class="line"> centos8.magedu.com</span><br></pre></td></tr></table></figure>

<p>范例：将sysinfo.sh 中的颜色定义成变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim sysinfo-v4.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> COLOR=34</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;========================= sysinfo begin ================\n&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;CPU    \c&quot;</span> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;<span class="variable">$&#123;COLOR&#125;</span>m `lscpu | sed -nr &#x27;s/^Model name: +(.*)/\1/p&#x27;` \E[0m&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;Mem    \c&quot;</span> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;<span class="variable">$&#123;COLOR&#125;</span>m `cat /proc/meminfo | head -n 1 | tr -s &quot;</span> <span class="string">&quot; | cut -d&quot;</span> <span class="string">&quot; -f2,3` \E[0m&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;DISK   \c&quot;</span> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;<span class="variable">$&#123;COLOR&#125;</span>m `lsblk /dev/sda | grep &quot;</span>^sda<span class="string">&quot; | tr -s &quot;</span> <span class="string">&quot; | cut -d&quot;</span> <span class="string">&quot; -f4` \E[0m&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;OS \c&quot;</span> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;<span class="variable">$&#123;COLOR&#125;</span>m `cat /etc/os-release | sed -nr &#x27;s/^VERSION=\&quot;(.*)\&quot;/\1/p&#x27;` \E[0m&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;\n========================= sysinfo end ==================&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>当前进程和子进程</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test10.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"> VAR1=123</span><br><span class="line"> VAR2=456</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;test&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$BASHPID</span></span><br><span class="line"> <span class="built_in">sleep</span> 20</span><br><span class="line"> </span><br><span class="line">[root@rocky86 ~]<span class="comment"># chmod +x test10.sh</span></span><br></pre></td></tr></table></figure>

<p>当前进程中执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo $BASHPID</span></span><br><span class="line"> 2570</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># test10.sh中输出的 BASHPID 也是 2570</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># . test10.sh </span></span><br><span class="line"> <span class="built_in">test</span></span><br><span class="line"> 2570</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 执行完成后，当前进程中能使用 test10.sh 中定义的变量</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $VAR1 $VAR2</span></span><br><span class="line"> 123 456</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 进程树中查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># pstree -p | grep 2570</span></span><br><span class="line">           |-sshd(1009)-+-sshd(2537)---sshd(2562)---bash(2570)---<span class="built_in">sleep</span>(9403)</span><br></pre></td></tr></table></figure>

<p>子进程中执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo $BASHPID</span></span><br><span class="line"> 2570</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 进程ID不一样</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ./test10.sh </span></span><br><span class="line"> <span class="built_in">test</span></span><br><span class="line"> 9501</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 子进程中的变量己经销毁了</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $VAR1 $VAR2</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># </span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 进程树中查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># pstree -p | grep 9501</span></span><br><span class="line">           |-sshd(1009)-+-sshd(2537)---sshd(2562)---bash(2570)---test10.sh(9501)---<span class="built_in">sleep</span>(9502)</span><br></pre></td></tr></table></figure>

<p><strong>显示已定义的所有变量：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span></span><br></pre></td></tr></table></figure>

<p><strong>删除变量：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> &lt;name&gt;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># NAME=mage</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># TITLE=ceo</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $NAME $TITLE</span></span><br><span class="line"> mage ceo</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># unset NAME TITLE</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $NAME $TITLE</span></span><br></pre></td></tr></table></figure>

<p>范例：显示系统信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim sysinfo-v5.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">  </span><br><span class="line">RED=<span class="string">&quot;\E[1;31m&quot;</span></span><br><span class="line">GREEN=<span class="string">&quot;echo -e \E[1;32m&quot;</span></span><br><span class="line">END=<span class="string">&quot;\E[0m&quot;</span></span><br><span class="line">. /etc/os-release</span><br><span class="line"><span class="variable">$GREEN</span>----------------------- sysinfo begin --------------------<span class="variable">$END</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;HOSTNAME:      <span class="variable">$RED</span>`hostname`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;IPADDR:        <span class="variable">$RED</span>` ifconfig ens160|grep -Eo &#x27;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27; |head -n1`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;IPADDR:        <span class="variable">$RED</span>` hostname -I`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;OSVERSION:     $RED$PRETTY_NAME<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;KERNEL:        <span class="variable">$RED</span>`uname -r`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;CPU:          <span class="variable">$RED</span>`lscpu|grep &#x27;^Model name&#x27;|tr -s &#x27; &#x27;|cut -d : -f2`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;MEMORY:        <span class="variable">$RED</span>`free -h|grep Mem|tr -s &#x27; &#x27; : |cut -d : -f2`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;DISK:          <span class="variable">$RED</span>`lsblk |grep &#x27;^sd&#x27; |tr -s &#x27; &#x27; |cut -d &quot;</span> <span class="string">&quot; -f4`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="variable">$GREEN</span>----------------------- sysinfo end ----------------------------------<span class="variable">$END</span></span><br></pre></td></tr></table></figure>

<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>环境变量： </p>
<ul>
<li>可以使子进程（包括孙子进程）继承父进程的变量，但是无法让父进程使用子进程的变量  </li>
<li>一旦子进程修改从父进程继承的变量，将会新的值传递给孙子进程  </li>
<li>一般只在系统配置文件中使用，在脚本中较少使用</li>
</ul>
<p>变量声明和赋值：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明并赋值</span></span><br><span class="line"><span class="built_in">export</span> name=VALUE</span><br><span class="line"><span class="built_in">declare</span> -x name=VALUE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者分两步实现</span></span><br><span class="line">name=VALUE</span><br><span class="line"><span class="built_in">export</span> name</span><br></pre></td></tr></table></figure>

<p>变量引用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span></span><br><span class="line"><span class="variable">$&#123;name&#125;</span></span><br></pre></td></tr></table></figure>

<p>显示所有环境变量：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span></span><br><span class="line"><span class="built_in">printenv</span></span><br><span class="line"><span class="built_in">export</span></span><br><span class="line"><span class="built_in">declare</span> -x</span><br></pre></td></tr></table></figure>

<p>查看指定进程的环境变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/<span class="variable">$PID</span>/environ</span><br></pre></td></tr></table></figure>

<p>删除变量：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> name</span><br></pre></td></tr></table></figure>

<p>bash内建的环境变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PATH</span><br><span class="line">SHELL</span><br><span class="line">USER</span><br><span class="line">UID</span><br><span class="line">HOME</span><br><span class="line">PWD</span><br><span class="line">SHLVL <span class="comment"># shell的嵌套层数，即深度</span></span><br><span class="line">LANG</span><br><span class="line">MAIL</span><br><span class="line">HOSTNAME</span><br><span class="line">HISTSIZE</span><br><span class="line">_   <span class="comment"># 下划线,表示前一命令的最后一个参数</span></span><br></pre></td></tr></table></figure>

<p>范例: 查看进程的环境变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># cat /proc/1688/environ </span></span><br><span class="line">LANG=CPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/binNOTIFY_SOCKET=/run/systemd/notifyINVOCATION_ID=03144162b25c48a4b39edcf1597a1530JOURNAL_STREAM=9:27235</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># cat /proc/1688/environ  | tr &#x27;\0&#x27; &#x27;\n&#x27;</span></span><br><span class="line">LANG=C</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span><br><span class="line">NOTIFY_SOCKET=/run/systemd/notify</span><br><span class="line">INVOCATION_ID=03144162b25c48a4b39edcf1597a1530</span><br><span class="line">JOURNAL_STREAM=9:27235</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># var1=123;export var2=456</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># vim test6.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var2</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$PS1</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># bash test6.sh</span></span><br><span class="line"> 456</span><br><span class="line"> /go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>

<h3 id="只读变量"><a href="#只读变量" class="headerlink" title="只读变量"></a>只读变量</h3><p>只读变量：只能声明定义，但后续不能修改和删除，即常量 </p>
<p>声明只读变量：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">readonly</span> name</span><br><span class="line"><span class="built_in">declare</span> -r name</span><br></pre></td></tr></table></figure>

<p>查看只读变量：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">readonly</span> [-p]</span><br><span class="line"><span class="built_in">declare</span> -r</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># readonly PI=3.14159</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $PI</span></span><br><span class="line"> 3.14159</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># PI=3.14</span></span><br><span class="line"> -bash: PI: <span class="built_in">readonly</span> variable</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># unset PI-</span></span><br><span class="line"> bash: <span class="built_in">unset</span>: PI: cannot <span class="built_in">unset</span>: <span class="built_in">readonly</span> variable</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $PI</span></span><br><span class="line"> 3.14159</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># exit</span></span><br><span class="line"> <span class="built_in">logout</span></span><br><span class="line"> Connection closed by foreign host.</span><br><span class="line"> Disconnected from remote host(10.0.0.8) at 14:27:04.</span><br><span class="line"> Type `<span class="built_in">help</span><span class="string">&#x27; to learn how to use Xshell prompt.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[c:\~]$ </span></span><br><span class="line"><span class="string">Reconnecting in 1 seconds. Press any key to exit local shell.</span></span><br><span class="line"><span class="string"> .</span></span><br><span class="line"><span class="string"> Connecting to 10.0.0.8:22...</span></span><br><span class="line"><span class="string"> Connection established.</span></span><br><span class="line"><span class="string"> To escape to local shell, press &#x27;</span>Ctrl+Alt+]<span class="string">&#x27;.</span></span><br><span class="line"><span class="string"> WARNING! The remote SSH server rejected X11 forwarding request.</span></span><br><span class="line"><span class="string"> Last login: Wed Apr  1 13:51:28 2020 from 10.0.0.1</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[root@centos8 ~]# echo $PI</span></span><br><span class="line"><span class="string">[root@centos8 ~]# </span></span><br></pre></td></tr></table></figure>

<h3 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a>位置变量</h3><p>位置变量：在bash shell中内置的变量, 在脚本代码中调用通过命令行传递给脚本的参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$1</span>,<span class="variable">$2</span>,...                           <span class="comment"># 对应第1个、第2个等参数，shift [n]换位置</span></span><br><span class="line"><span class="variable">$0</span>                                  <span class="comment"># 命令本身,包括路径</span></span><br><span class="line">$*                                  <span class="comment"># 传递给脚本的所有参数，全部参数合为一个字符串</span></span><br><span class="line"><span class="variable">$@</span>                                  <span class="comment"># 传递给脚本的所有参数，每个参数为独立字符串</span></span><br><span class="line"><span class="variable">$#</span>                                <span class="comment"># 传递给脚本的参数的个数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：$@ $* 只在被双引号包起来的时候才会有差异</span></span><br></pre></td></tr></table></figure>

<p>清空所有位置变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> --</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat /data/scripts/arg.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;1st arg is <span class="variable">$1</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;2st arg is <span class="variable">$2</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;3st arg is <span class="variable">$3</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;10st arg is <span class="variable">$&#123;10&#125;</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;11st arg is <span class="variable">$&#123;11&#125;</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;The number of arg is <span class="variable">$#</span> &quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;All args are $*&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;All args are <span class="variable">$@</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;The scriptname is `basename <span class="variable">$0</span>`&quot;</span></span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># bash /data/scripts/arg.sh &#123;a..z&#125;</span></span><br><span class="line"> 1st arg is a</span><br><span class="line"> 2st arg is b</span><br><span class="line"> 3st arg is c</span><br><span class="line"> 10st arg is j</span><br><span class="line"> 11st arg is k</span><br><span class="line"> The number of arg is 26</span><br><span class="line"> All args are a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line"> All args are a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line"> The scriptname is arg.sh</span><br></pre></td></tr></table></figure>

<p>范例：删库跑路之命令rm的安全实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat /data/scripts/rm.sh </span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"> WARNING_COLOR=<span class="string">&quot;echo -e \E[1;31m&quot;</span></span><br><span class="line"> END=<span class="string">&quot;\E[0m&quot;</span></span><br><span class="line"> DIR=/tmp/`<span class="built_in">date</span> +%F_%H-%M-%S`</span><br><span class="line"> <span class="built_in">mkdir</span> <span class="variable">$DIR</span></span><br><span class="line"> <span class="built_in">mv</span>  $*  <span class="variable">$DIR</span></span><br><span class="line"> <span class="variable">$&#123;WARNING_COLOR&#125;</span>Move $* to <span class="variable">$DIR</span> <span class="variable">$END</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># chmod a+x /data/scripts/rm.sh</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># alias rm=&#x27;/data/scripts/rm.sh&#x27;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># touch &#123;1..10&#125;.txt</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># rm *.txt</span></span><br><span class="line"> Move 10.txt 1.txt 2.txt 3.txt 4.txt 5.txt 6.txt 7.txt 8.txt 9.txt to /tmp/2020-04-01_15-15-28 </span><br></pre></td></tr></table></figure>

<p>范例：$*和$@的区别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 scripts]<span class="comment"># cat f1.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;f1.sh:all args are <span class="variable">$@</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;f1.sh:all args are $*&quot;</span></span><br><span class="line"> ./file.sh <span class="string">&quot;$*&quot;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment"># cat f2.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;f2.sh:all args are <span class="variable">$@</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;f2.sh:all args are $*&quot;</span></span><br><span class="line"> ./file.sh <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment"># cat file.sh</span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;file.sh:1st arg is <span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment"># ./f1.sh a b c</span></span><br><span class="line"> f1.sh:all args are a b c</span><br><span class="line"> f1.sh:all args are a b c</span><br><span class="line"> file.sh:1st arg is a b c</span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment"># ./f2.sh a b c</span></span><br><span class="line"> f2.sh:all args are a b c</span><br><span class="line"> f2.sh:all args are a b c</span><br><span class="line"> file.sh:1st arg is a</span><br></pre></td></tr></table></figure>

<p>范例: 利用软链接实现同一个脚本不同功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ********************************************************************</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$0</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ln -s test.sh a.sh</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># ln -s test.sh b.sh</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># ./a.sh</span></span><br><span class="line"> ./a.sh</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ./b.sh</span></span><br><span class="line"> ./b.sh</span><br></pre></td></tr></table></figure>

<h3 id="退出状态码变量"><a href="#退出状态码变量" class="headerlink" title="退出状态码变量"></a>退出状态码变量</h3><p>当我们浏览网页时，有时会看到下图所显示的数字，表示网页的错误信息，我们称为状态码，在shell脚本中也有相似的技术表示程序执行的 相应状态。</p>
<p><img src="../../../../images/SRE/day07/3.png" alt="3"></p>
<p>进程执行后，将使用变量 $? 保存状态码的相关数字，不同的值反应成功或失败，$?取值范例 0-255</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$?                  <span class="comment"># 0代表成功,1-255代表失败</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c1 -W1 hostdown &amp;&gt; /dev/null </span><br><span class="line"><span class="built_in">echo</span> $?</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># curl -fs http://www.wangxiaochun.com &gt;/dev/null</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<p>用户可以在脚本中使用以下命令自定义退出状态码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span> [n]</span><br></pre></td></tr></table></figure>

<p>注意： </p>
<ul>
<li>脚本中一旦遇到exit命令，脚本会立即终止；终止退出状态取决于exit命令后面的数字 </li>
<li>如果exit后面无数字,终止退出状态取决于exit命令前面命令执行结果 </li>
<li>如果没有exit命令, 即未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最后一 条命令的状态码</li>
</ul>
<h3 id="展开命令行"><a href="#展开命令行" class="headerlink" title="展开命令行"></a>展开命令行</h3><p><strong>展开命令执行顺序</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">把命令行分成单个命令词</span><br><span class="line">展开别名</span><br><span class="line">展开大括号的声明&#123;&#125;</span><br><span class="line">展开波浪符声明 ~</span><br><span class="line">命令替换<span class="built_in">$</span>() 和 ``</span><br><span class="line">再次把命令行分成命令词</span><br><span class="line">展开文件通配符*、?、[abc]等等</span><br><span class="line">准备I/0重导向 &lt;、&gt;</span><br><span class="line">运行命令</span><br></pre></td></tr></table></figure>

<p><strong>防止扩展</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\                   <span class="comment"># 反斜线 会使随后的字符按原意解释</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># echo Your cost: \$5.00 </span></span><br><span class="line"> Your cost: <span class="variable">$5</span>.00</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># echo &quot;The book&#x27;s price is \$10&quot;</span></span><br><span class="line"> The book<span class="string">&#x27;s price is $10</span></span><br></pre></td></tr></table></figure>

<p><strong>加引号来防止扩展</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>                      <span class="comment"># 单引号 防止所有扩展    </span></span><br><span class="line"><span class="string">&quot;&quot;</span>                      <span class="comment"># 双引号 也可防止扩展，但是以下情况例外 $</span></span><br></pre></td></tr></table></figure>

<p><strong>变量扩展</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">``                       <span class="comment"># 反引号，命令替换   </span></span><br><span class="line">\                        <span class="comment"># 反斜线，禁止单个字符扩展   </span></span><br><span class="line">!                        <span class="comment"># 叹号，历史命令替换</span></span><br></pre></td></tr></table></figure>

<p>范例: ``和$() 区别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># echo `echo \`</span></span><br><span class="line"> &gt; ^C</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo `echo \\`</span></span><br><span class="line"> \</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo `echo \\\`</span></span><br><span class="line"> &gt; ^C</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo `echo \\\\`</span></span><br><span class="line"> \</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $(echo \)</span></span><br><span class="line"> &gt; ^C</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $(echo \\)</span></span><br><span class="line"> \</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $(echo \\\)</span></span><br><span class="line"> &gt; ^C</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $(echo \\\\)</span></span><br><span class="line"> \\</span><br></pre></td></tr></table></figure>

<h3 id="脚本安全和-set"><a href="#脚本安全和-set" class="headerlink" title="脚本安全和 set"></a>脚本安全和 set</h3><p>set 命令：可以用来定制 shell 环境</p>
<p><strong>$- 变量</strong></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
<th>备份</th>
</tr>
</thead>
<tbody><tr>
<td>h</td>
<td>hashall</td>
<td>开启hash表缓存外部命令路径</td>
</tr>
<tr>
<td>i</td>
<td>interactive-comments</td>
<td>表示当前是交互是shell</td>
</tr>
<tr>
<td>m</td>
<td>monitor</td>
<td>开启监控模式，可通过 Job control来控制进程的停止、继续，后台或者前台执行等</td>
</tr>
<tr>
<td>B</td>
<td>braceexpand</td>
<td>是否支持大括号扩展</td>
</tr>
<tr>
<td>H</td>
<td>history</td>
<td>是否可用 ! 快速展开history命令</td>
</tr>
</tbody></table>
<p>范例：查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 查看命令行下的配置</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># echo $-</span></span><br><span class="line"> himBHs</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 查看脚本中的配置</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># cat set.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> $-</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># bash set.sh </span></span><br><span class="line">hB</span><br></pre></td></tr></table></figure>

<p>范例：关闭hash缓存功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># echo $-</span></span><br><span class="line"> himBHs</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># hash</span></span><br><span class="line"> hits    <span class="built_in">command</span></span><br><span class="line">    6    /usr/bin/bash</span><br><span class="line">    2    /usr/bin/cat</span><br><span class="line">    6    /usr/bin/vim</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">[root@rocky86 0817]<span class="comment"># set +h</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># echo $-</span></span><br><span class="line"> imBHs</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># hash</span></span><br><span class="line">-bash: <span class="built_in">hash</span>: hashing disabled</span><br></pre></td></tr></table></figure>

<p>范例：关闭大括号展开</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># echo $-</span></span><br><span class="line"> imBHs</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># echo &#123;1..5&#125;</span></span><br><span class="line"> 1 2 3 4 5</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># set +B</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># echo $-</span></span><br><span class="line"> imHs</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># echo &#123;1..5&#125;</span></span><br><span class="line"> &#123;1..5&#125;</span><br></pre></td></tr></table></figure>

<p><strong>set 命令实现脚本安全</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>u</td>
<td>开启此项，在使用一个没有声明的变量时，会报错，并且终止程序，同 set -o nounset</td>
</tr>
<tr>
<td>e</td>
<td>开启此项，命令返回非0就退出，不再继续执行后面的代码，同 set -o errexit</td>
</tr>
<tr>
<td>o</td>
<td>set -o 显示所有; set -o option 开启 option 项; set +o option 关闭 option 项</td>
</tr>
<tr>
<td>x</td>
<td>set -x</td>
</tr>
</tbody></table>
<ul>
<li>-u 在扩展一个没有设置的变量时，显示错误信息， 等同set -o nounset </li>
<li>-e 如果一个命令返回一个非0退出状态值(失败)就退出， 等同set -o errexit </li>
<li>-o option 显示，打开或者关闭选项 显示选项：set -o  打开选项：set -o 选项 关闭选项：set +o 选项 </li>
<li>-x 当执行命令时，打印命令及其参数,类似 bash -x </li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># set -o</span></span><br><span class="line"> allexport     off</span><br><span class="line"> braceexpand   on</span><br><span class="line"> emacs         on</span><br><span class="line"> errexit       off</span><br><span class="line"> errtrace      off</span><br><span class="line"> functrace     off</span><br><span class="line"> hashall       on</span><br><span class="line"> histexpand    on</span><br><span class="line"> <span class="built_in">history</span>       on</span><br><span class="line"> ignoreeof     off</span><br><span class="line"> interactive-comments on</span><br><span class="line"> keyword       off</span><br><span class="line"> monitor       on</span><br><span class="line"> noclobber     off</span><br><span class="line"> noexec        off</span><br><span class="line"> <span class="built_in">noglob</span>        off</span><br><span class="line"> nolog         off</span><br><span class="line"> notify        off</span><br><span class="line"> nounset       off</span><br><span class="line"> onecmd        off</span><br><span class="line"> physical      off</span><br><span class="line"> pipefail      off</span><br><span class="line"> posix         off</span><br><span class="line"> privileged    off</span><br><span class="line"> verbose       off</span><br><span class="line"> vi            off</span><br><span class="line"> xtrace        off</span><br></pre></td></tr></table></figure>

<p>范例：限制使用没声明的变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># cat set2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">set</span> -u</span><br><span class="line"> DIR=/test</span><br><span class="line"> <span class="built_in">rm</span> -rf <span class="variable">$&#123;DIr&#125;</span>/*         <span class="comment"># 这个变量其实不存在，如果没有 set -u 选项，则会删除根目录</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># bash set2.sh</span></span><br><span class="line">set2.sh: line 17: DIr: unbound variable</span><br></pre></td></tr></table></figure>

<p>范例：遇到错误终止</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># vim set3.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">echo</span> 123</span><br><span class="line"><span class="built_in">cd</span> /test2/            <span class="comment"># 这个目录不存在，如果没有 set -e，则也会删根</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf * </span><br><span class="line"><span class="built_in">echo</span> 456</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遇到错误行就终止</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># bash set3.sh</span></span><br><span class="line"> 123</span><br><span class="line"> set3.sh: line 17: <span class="built_in">cd</span>: /test2/: No such file or directory</span><br></pre></td></tr></table></figure>

<h2 id="格式化输出-printf"><a href="#格式化输出-printf" class="headerlink" title="格式化输出 printf"></a>格式化输出 printf</h2><p>相当于增强版的 echo, 实现丰富的格式化输出 </p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> format args...</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day07/4.png" alt="4"></p>
<p><strong>常用格式替换符</strong></p>
<table>
<thead>
<tr>
<th><strong>替换符</strong></th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody><tr>
<td>%s</td>
<td>字符串</td>
</tr>
<tr>
<td>%d,%i</td>
<td>十进制整数</td>
</tr>
<tr>
<td>%f</td>
<td>浮点格式</td>
</tr>
<tr>
<td>%c</td>
<td>ASCII字符，即显示对应参数的第一个字符</td>
</tr>
<tr>
<td>%b</td>
<td>相对应的参数中包含转义字符时，可以使用此替换符进行替换，对应的转义字符会被转  义</td>
</tr>
<tr>
<td>%o</td>
<td>八进制值</td>
</tr>
<tr>
<td>%u</td>
<td>不带正负号的十进制值</td>
</tr>
<tr>
<td>%x</td>
<td>十六进制值（a-f）</td>
</tr>
<tr>
<td>%X</td>
<td>十六进制值（A-F）</td>
</tr>
<tr>
<td>%%</td>
<td>表示%本身</td>
</tr>
</tbody></table>
<p>说明：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%[N]s                   <span class="comment">#  N表示输出宽度，不够补空格 -N 表示左对齐</span></span><br><span class="line">%[0][N]d                <span class="comment">#  0表示宽度不够时在左边补0，N表示输出宽度</span></span><br><span class="line">%[.N]f                  <span class="comment">#  .N 表示保留的小数位</span></span><br></pre></td></tr></table></figure>

<p><strong>常用转义字符</strong></p>
<table>
<thead>
<tr>
<th><strong>转义符</strong></th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody><tr>
<td>\a</td>
<td>警告字符，通常为ASCII的BEL字符</td>
</tr>
<tr>
<td>\b</td>
<td>后退</td>
</tr>
<tr>
<td>\f</td>
<td>换页</td>
</tr>
<tr>
<td>\n</td>
<td>换行</td>
</tr>
<tr>
<td>\r</td>
<td>回车</td>
</tr>
<tr>
<td>\t</td>
<td>水平制表符</td>
</tr>
<tr>
<td>\v</td>
<td>垂直制表符</td>
</tr>
<tr>
<td>\</td>
<td>表示\本身</td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%s&quot; 1 2 3 4</span></span><br><span class="line"> 1234[root@centos8 ~]<span class="comment"># </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%s\n&quot; 1 2 3 4</span></span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line"> 3</span><br><span class="line"> 4</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%f\n&quot; 1 2 3 4</span></span><br><span class="line"> 1.000000</span><br><span class="line"> 2.000000</span><br><span class="line"> 3.000000</span><br><span class="line"> 4.000000</span><br><span class="line"></span><br><span class="line"> <span class="comment"># .2f 表示保留两位小数</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%.2f\n&quot; 1 2 3 4</span></span><br><span class="line"> 1.00</span><br><span class="line"> 2.00</span><br><span class="line"> 3.00</span><br><span class="line"> 4.00</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;(%s)&quot; 1 2 3 4;echo </span></span><br><span class="line"> (1)(2)(3)(4)</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot; (%s) &quot; 1 2 3 4;echo</span></span><br><span class="line"> (1) (2) (3) (4) </span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;(%s)\n&quot; 1 2 3 4</span></span><br><span class="line"> (1)</span><br><span class="line"> (2)</span><br><span class="line"> (3)</span><br><span class="line"> (4)</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%s %s\n&quot; 1 2 3 4</span></span><br><span class="line"> 1 2</span><br><span class="line"> 3 4</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%s %s %s\n&quot; 1 2 3 4</span></span><br><span class="line"> 1 2 3</span><br><span class="line"> 4</span><br><span class="line"> </span><br><span class="line"><span class="comment"># %-10s 表示宽度10个字符，左对齐</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%-10s %-10s %-4s %s \n&quot; 姓名 性别 年龄 体重 小明 男 20 70 小红 女 18 50</span></span><br><span class="line">姓名  性别  年龄  体重</span><br><span class="line">小明  男    20   70</span><br><span class="line">小红  女    18   50</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将十进制的17转换成16进制数</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%X&quot; 17</span></span><br><span class="line"> 11</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 将十六进制C转换成十进制</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># printf &quot;%d\n&quot; 0xC</span></span><br><span class="line"> 12</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># VAR=&quot;welcome to Magedu&quot;;printf &quot;\033[1;32m%s\033[0m &quot; $VAR</span></span><br><span class="line"> welcome to Magedu</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># VAR=&quot;welcome to Magedu&quot;;printf &quot;\033[1;32m%s\033[0m\n&quot; $VAR</span></span><br><span class="line"> welcome</span><br><span class="line"> to</span><br><span class="line"> Magedu</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># VAR=&quot;welcome to Magedu&quot;;printf &quot;\033[1;32m%s\033[0m\n&quot; &quot;$VAR&quot;</span></span><br><span class="line"> welcome to Magedu</span><br></pre></td></tr></table></figure>

<h2 id="算术运算"><a href="#算术运算" class="headerlink" title="算术运算"></a>算术运算</h2><p>Shell允许在某些情况下对算术表达式进行求值，比如：let和declare 内置命令，(( ))复合命令和算术扩展。求值以固定宽度的整数进行，不检 查溢出，尽管除以0 被困并标记为错误。运算符及其优先级，关联性和值与C语言相同。以下运算符列表分组为等优先级运算符级别。级别按降序排列优先。</p>
<p><strong>注意：bash 只支持整数，不支持小数</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ -                          <span class="comment"># addition, subtraction</span></span><br><span class="line">* / %                        <span class="comment"># multiplication, division, remainder, %表示取模，即取余数，示例：9%4=1，5%3=2</span></span><br><span class="line">i++ i--                      <span class="comment"># variable post-increment and post-decrement</span></span><br><span class="line">++i --i                      <span class="comment"># variable pre-increment and pre-decrement</span></span><br><span class="line">= *= /= %= += -= &lt;&lt;= &gt;&gt;= &amp;= ^= |=  <span class="comment"># assignment</span></span><br><span class="line">- +                          <span class="comment"># unary minus and plus</span></span><br><span class="line">! ~                          <span class="comment"># logical and bitwise negation</span></span><br><span class="line">**                           <span class="comment"># exponentiation 乘方,即指数运算</span></span><br><span class="line">&lt;&lt; &gt;&gt;                        <span class="comment"># left and right bitwise shifts</span></span><br><span class="line">&lt;= &gt;= &lt; &gt;                    <span class="comment"># comparison</span></span><br><span class="line">== !=                        <span class="comment"># equality and inequality</span></span><br><span class="line">&amp;                            <span class="comment"># bitwise AND</span></span><br><span class="line">|                            <span class="comment"># bitwise OR</span></span><br><span class="line">^                            <span class="comment"># bitwise exclusive OR</span></span><br><span class="line">&amp;&amp;                           <span class="comment"># logical AND</span></span><br><span class="line">||                           <span class="comment"># logical OR</span></span><br><span class="line"><span class="built_in">expr</span>?<span class="built_in">expr</span>:<span class="built_in">expr</span>               <span class="comment"># conditional operator</span></span><br><span class="line">expr1 , expr2                <span class="comment"># comma</span></span><br></pre></td></tr></table></figure>

<p>乘法符号有些场景中需要转义</p>
<p>实现算术运算：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> var=expression</span><br><span class="line">((var=expression))</span><br><span class="line">var=$[expression]</span><br><span class="line">var=$((expression))</span><br><span class="line">var=$(<span class="built_in">expr</span> arg1 arg2 ...)</span><br><span class="line"><span class="built_in">declare</span> -i var=number</span><br><span class="line"><span class="built_in">echo</span> expression|bc</span><br></pre></td></tr></table></figure>

<p>范例：不转义，无法进行算术运算</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># i=123;j=456;</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># k=i+j;echo $k</span></span><br><span class="line"> i+j</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># k=$i+$j;echo $k</span></span><br><span class="line"> 123+456</span><br></pre></td></tr></table></figure>

<p>范例：转义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># i=123;j=456;</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># let k=i+j;echo $k</span></span><br><span class="line"> 579</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># ((k=i+j));echo $k</span></span><br><span class="line"> 579</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># k=$[i+j];echo $k</span></span><br><span class="line"> 579</span><br></pre></td></tr></table></figure>

<p>范例：expr 命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 表达式中间要有空格</span></span><br><span class="line">[root@rocky86 0817]<span class="comment"># expr 10+20</span></span><br><span class="line"> 10+20</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># expr 10 + 20</span></span><br><span class="line"> 30</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># expr 10 \* 20</span></span><br><span class="line"> 200</span><br></pre></td></tr></table></figure>

<p>内建的随机数生成器变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$RANDOM</span>                   <span class="comment"># 取值范围：0-32767</span></span><br></pre></td></tr></table></figure>

<p>范例：生成 0 - 49 之间随机数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># echo $[$RANDOM%50]</span></span><br><span class="line"> 6</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># echo $[$RANDOM%50]</span></span><br><span class="line"> 15</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># echo $[$RANDOM%50]</span></span><br><span class="line"> 33</span><br></pre></td></tr></table></figure>

<p>范例：随机字体颜色</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[1;$[RANDOM%7+31]mhello\033[0m&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day07/5.png" alt="5"></p>
<p>增强型赋值：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+=                      <span class="comment"># i+=10 相当于 i=i+10</span></span><br><span class="line">-=                      <span class="comment"># i-=j  相当于 i=i-j</span></span><br><span class="line">*=</span><br><span class="line">/=</span><br><span class="line">%=</span><br><span class="line">++                      <span class="comment"># i++,++i 相当于 i=i+1</span></span><br><span class="line">--                      <span class="comment"># i--,--i 相当于 i=i-1</span></span><br></pre></td></tr></table></figure>

<p>范例：i++与++i</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0817]<span class="comment"># i=1;let j=i++;echo $i $j</span></span><br><span class="line"> 2 1</span><br><span class="line"></span><br><span class="line">[root@rocky86 0817]<span class="comment"># i=1;let j=++i;echo $i $j</span></span><br><span class="line"> 2 2</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># let i=10*2</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $i</span></span><br><span class="line"> 20</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ((j=i+10))</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $j</span></span><br><span class="line"> 30</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]<span class="comment"># i=10;((i++));echo $i </span></span><br><span class="line">11</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># i=10</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># let i+=20 # 相当于let i=i+20 </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $i</span></span><br><span class="line"> 30</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># j=20</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># let i*=j </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $i</span></span><br><span class="line"> 600</span><br></pre></td></tr></table></figure>

<p>范例：自增，自减</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># unset i j ; i=1; let j=i++; echo &quot;i=$i,j=$j&quot;</span></span><br><span class="line"> i=2,j=1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># unset i j ; i=1; let j=++i; echo &quot;i=$i,j=$j&quot;</span></span><br><span class="line"> i=2,j=2</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># expr 2 * 3</span></span><br><span class="line"> <span class="built_in">expr</span>: syntax error: unexpected argument ‘anaconda-ks.cfg’</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ls</span></span><br><span class="line"> anaconda-ks.cfg</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># expr 2 \* 3</span></span><br><span class="line"> 6</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># echo &quot;scale=3;20/3&quot;|bc</span></span><br><span class="line"> 6.666</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># i=10</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># j=20</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># declare -i result=i*j</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $result</span></span><br><span class="line"> 200</span><br></pre></td></tr></table></figure>

<p>范例： </p>
<p>鸡兔同笼，是中国古代著名典型趣题之一，记载于《孙子算经》之中。今有雉兔同笼，上有三十五头，下有九十四足，问雉兔各几何？</p>
<ol>
<li>让鸡和兔子都抬一条腿到天上去，则地上还有59条腿，分别属于1条腿的鸡和3条腿的兔子，94-35=59；</li>
<li>让鸡和兔子都抬两条腿到天上去，则地上还有24条腿，分别属于0条腿的鸡和2条腿的兔子，59-35=24； </li>
<li>那么，兔子的数量是 24/2=12只，则鸡的数量是 35-12=23只；</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 scripts]<span class="comment"># cat chook_rabbit.sh </span></span><br><span class="line"> <span class="comment">#!/bin/bash</span></span><br><span class="line"> HEAD=<span class="variable">$1</span></span><br><span class="line"> FOOT=<span class="variable">$2</span></span><br><span class="line"> RABBIT=$(((FOOT-HEAD-HEAD)/<span class="number">2</span>))</span><br><span class="line"> CHICKEN=$[HEAD-RABBIT]</span><br><span class="line"> <span class="built_in">echo</span> RABBIT:<span class="variable">$RABBIT</span></span><br><span class="line"> <span class="built_in">echo</span> CHICKEN:<span class="variable">$CHICKEN</span></span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment"># ./chook_rabbit.sh 30 80</span></span><br><span class="line"> RABBIT:10</span><br><span class="line"> CHOOK:20</span><br></pre></td></tr></table></figure>

<h2 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h2><h3 id="与或非"><a href="#与或非" class="headerlink" title="与或非"></a>与或非</h3><p><img src="../../../../images/SRE/day07/6.png" alt="6"></p>
<p><strong>true, false</strong></p>
<table>
<thead>
<tr>
<th>bool<strong>值</strong></th>
<th><strong>二进制表示</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>true</td>
<td>1</td>
<td>真</td>
</tr>
<tr>
<td>false</td>
<td>0</td>
<td>假</td>
</tr>
</tbody></table>
<p><strong>与：&amp; 和0相与结果为0，和1相与结果保留原值, 一假则假，全真才真</strong></p>
<table>
<thead>
<tr>
<th><strong>变量</strong>1</th>
<th><strong>变量</strong>2</th>
<th><strong>与运算</strong></th>
<th><strong>与运算结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0&amp;0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0&amp;1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1&amp;0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1&amp;1</td>
<td>1</td>
</tr>
</tbody></table>
<p>范例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># x=$[2&amp;6]</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># echo $x</span></span><br><span class="line"> 2</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># x=$[7&amp;3]</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># echo $x</span></span><br><span class="line"> 3</span><br></pre></td></tr></table></figure>

<p><strong>或：| 和1相或结果为1，和0相或结果保留原值,一真则真,全假才假</strong></p>
<table>
<thead>
<tr>
<th><strong>变量</strong>1</th>
<th><strong>变量</strong>2</th>
<th><strong>或运算</strong></th>
<th><strong>或运算结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0|0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0|1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1|0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1|1</td>
<td>1</td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu1804 ~]<span class="comment"># x=$[2|6]</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># echo $x</span></span><br><span class="line"> 6</span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># x=$[7|3]</span></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment"># echo $x</span></span><br><span class="line"> 7</span><br></pre></td></tr></table></figure>

<p><strong>非：！</strong></p>
<table>
<thead>
<tr>
<th><strong>变量</strong></th>
<th><strong>运算</strong></th>
<th><strong>非运算结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>! 1</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>! 0</td>
<td>1</td>
</tr>
</tbody></table>
<p><strong>异或：^</strong> </p>
<p>异或的两个值，相同为假，不同为真。两个数字X,Y异或得到结果Z，Z再和任意两者之一X异或，将得出另一个值Y</p>
<table>
<thead>
<tr>
<th><strong>变量</strong>1</th>
<th><strong>变量</strong>2</th>
<th><strong>异或运算</strong></th>
<th><strong>异或运算结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0^0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0^1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1^0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1^1</td>
<td>1</td>
</tr>
</tbody></table>
<p>范例: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># true </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># false</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ! true</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ! false</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<p>范例: 变量互换</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=20;temp=$x;x=$y;y=$temp;echo x=$x,y=$y</span></span><br><span class="line"> x=20,y=10</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=20;x=$[x^y];y=$[x^y];x=$[x^y];echo x=$x,y=$y</span></span><br><span class="line"> x=20,y=10</span><br></pre></td></tr></table></figure>

<h3 id="短路运算"><a href="#短路运算" class="headerlink" title="短路运算"></a>短路运算</h3><p><strong>短路与 &amp;&amp;</strong></p>
<table>
<thead>
<tr>
<th>command1<strong>值</strong></th>
<th>command2<strong>值</strong></th>
<th><strong>短路与运算</strong></th>
<th><strong>短路与运算结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>true</td>
<td>true</td>
<td>cmd1 &amp;&amp; cmd2</td>
<td>true</td>
</tr>
<tr>
<td>true</td>
<td>false</td>
<td>cmd1 &amp;&amp; cmd2</td>
<td>false</td>
</tr>
<tr>
<td>false</td>
<td>true</td>
<td>cmd1 &amp;&amp; cmd2</td>
<td>false</td>
</tr>
<tr>
<td>false</td>
<td>false</td>
<td>cmd1 &amp;&amp; cmd2</td>
<td>false</td>
</tr>
</tbody></table>
<p>当cmd1 的结果为false时，整个表达式就是 false, cmd2 不参与运算，这就是所谓的短路</p>
<p> <strong>短路或 ||</strong> </p>
<table>
<thead>
<tr>
<th>command1<strong>值</strong></th>
<th>command2<strong>值</strong></th>
<th><strong>短路或运算</strong></th>
<th><strong>短路与运算结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>true</td>
<td>true</td>
<td>cmd1 ||  cmd2</td>
<td>true</td>
</tr>
<tr>
<td>true</td>
<td>false</td>
<td>cmd1 ||  cmd2</td>
<td>true</td>
</tr>
<tr>
<td>false</td>
<td>true</td>
<td>cmd1 ||  cmd2</td>
<td>true</td>
</tr>
<tr>
<td>false</td>
<td>false</td>
<td>cmd1 ||  cmd2</td>
<td>false</td>
</tr>
</tbody></table>
<p>当cmd1 的结果为true时，整个表达式就是 true, cmd2 不参与运算，这就是所谓的短路</p>
<h4 id="短路与和或组合"><a href="#短路与和或组合" class="headerlink" title="短路与和或组合"></a>短路与和或组合</h4><table>
<thead>
<tr>
<th>command1<strong>值</strong></th>
<th>command2<strong>值</strong></th>
<th>command3<strong>值</strong></th>
<th><strong>短路运算</strong></th>
<th><strong>短路与运算结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>true</td>
<td>true</td>
<td>true</td>
<td>cmd1 &amp;&amp; cmd2 || cmd3</td>
<td>true</td>
</tr>
<tr>
<td>true</td>
<td>true</td>
<td>false</td>
<td>cmd1 &amp;&amp; cmd2 || cmd3</td>
<td>true</td>
</tr>
<tr>
<td>true</td>
<td>false</td>
<td>true</td>
<td>cmd1 &amp;&amp; cmd2 || cmd3</td>
<td>true</td>
</tr>
<tr>
<td>true</td>
<td>false</td>
<td>false</td>
<td>cmd1 &amp;&amp; cmd2 || cmd3</td>
<td>false</td>
</tr>
<tr>
<td>false</td>
<td>true</td>
<td>true</td>
<td>cmd1 &amp;&amp; cmd2 || cmd3</td>
<td>true</td>
</tr>
<tr>
<td>false</td>
<td>true</td>
<td>false</td>
<td>cmd1 &amp;&amp; cmd2 || cmd3</td>
<td>false</td>
</tr>
<tr>
<td>false</td>
<td>false</td>
<td>false</td>
<td>cmd1 &amp;&amp; cmd2 || cmd3</td>
<td>false</td>
</tr>
</tbody></table>
<p>当cmd1 的结果为true时，会执行 cmd2；</p>
<p>当cmd1 的结果为false时，会执行 cmd3；</p>
<p>cmd1 || cmd2 &amp;&amp; cmd3 这种语法是错误的，不使用；</p>
<h2 id="条件测试命令"><a href="#条件测试命令" class="headerlink" title="条件测试命令"></a>条件测试命令</h2><p>条件测试：</p>
<p>判断某需求是否满足，需要由测试机制来实现，专用的测试表达式需要由测试命令辅助完成测试过程，实现评估布尔声明，以便用在条件性环境下进行执行</p>
<p>若真，则状态码变量 $? 返回0</p>
<p>若假，则状态码变量 $? 返回1</p>
<p>条件测试命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span> <span class="built_in">expr</span></span><br><span class="line">[ arg... ]                       <span class="comment"># 同 test </span></span><br><span class="line">[[ expression ]]                 <span class="comment"># 增加版的[],支持[],支持扩展正则表达式和通配符</span></span><br></pre></td></tr></table></figure>

<p>注意：[] 中的表达式，前后要有空格</p>
<p>常用选项：文件判断相关</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-a FILE         <span class="comment"># 如果文件存在则为真</span></span><br><span class="line">-b FILE         <span class="comment"># 如果文件为块特殊文件则为真</span></span><br><span class="line">-c FILE         <span class="comment"># 如果文件为字符特殊文件则为真</span></span><br><span class="line">-d FILE         <span class="comment"># 如果文件为目录则为真</span></span><br><span class="line">-e FILE         <span class="comment"># 如果文件存在则为真</span></span><br><span class="line">-f FILE         <span class="comment"># 如果文件存在且为常规文件则为真</span></span><br><span class="line">-g FILE         <span class="comment"># 如果文件的组属性设置打开则为真</span></span><br><span class="line">-h FILE         <span class="comment"># 如果文件为符号链接则为真</span></span><br><span class="line">-L FILE         <span class="comment"># 如果文件为符号链接则为真</span></span><br><span class="line">-k FILE         <span class="comment"># 如果文件的粘滞 (sticky) 位设定则为真</span></span><br><span class="line">-p FILE         <span class="comment"># 如果文件为命名管道则为真</span></span><br><span class="line">-r FILE         <span class="comment"># 如果当前用户对文件有可读权限为真</span></span><br><span class="line">-s FILE         <span class="comment"># 如果文件存在且不为空则为真</span></span><br><span class="line">-S FILE         <span class="comment"># 如果文件是套接字则为真</span></span><br><span class="line"></span><br><span class="line">-t FD           <span class="comment"># 如果文件描述符在一个终端上打开则为真</span></span><br><span class="line">-u FILE         <span class="comment"># 如果文件设置了SUID特殊权限则为真</span></span><br><span class="line">-w FILE         <span class="comment"># 如果当前用户对文件有可写权限为真</span></span><br><span class="line">-x FILE         <span class="comment"># 如果当前用户对文件有可执行权限为真</span></span><br><span class="line">-O FILE         <span class="comment"># 如果当前用户是文件属主为真</span></span><br><span class="line">-G FILE         <span class="comment"># 如果当前用户对文件属组为真</span></span><br><span class="line">-N FILE         <span class="comment"># 如果文件上次被读取之后修改过则为真</span></span><br><span class="line"></span><br><span class="line">FILE1 -nt	FILE2    <span class="comment"># 如果 file1 文件新于 file2 文件则为真(根据修改日期)</span></span><br><span class="line">FILE1 -ot	FILE2    <span class="comment"># 如果 file1 文件旧于 file2 文件则为真</span></span><br><span class="line">FILE1 -ef	FILE2    <span class="comment"># 如果 file1 文件是 file2 文件的硬链接则为真</span></span><br></pre></td></tr></table></figure>

<p>常用选项：字符串判断相关</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-z STRING                 <span class="comment"># 判断字符串是否为空，为空则为真</span></span><br><span class="line">-n STRING                 <span class="comment"># 如果字符串不为空则为真</span></span><br><span class="line">STRING                    <span class="comment"># 同上</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个字符串变量比较，一定要有空格，如果没有空格，就变成赋值了</span></span><br><span class="line">STRING1 = STRING2         <span class="comment"># 如果 string1 和 string2 字符串相同则为真</span></span><br><span class="line">STRING1 != STRING2        <span class="comment"># 如果 string1 和 string2 字符串不相同则为真</span></span><br><span class="line">STRING1 &lt; STRING2         <span class="comment"># 只比较第一个字符，以字母表顺序来比较，string1在string2 之前则为真，&lt; 要转义</span></span><br><span class="line">STRING1 &gt; STRING2         <span class="comment"># 只比较第一个字符，以字母表顺序来比较，string1在string2 之后则为真, &gt; 要转义</span></span><br></pre></td></tr></table></figure>

<p>常用选项：数学相关</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数字相关  格式 arg1 OP arg2</span></span><br><span class="line">-eq                       <span class="comment"># 等于   </span></span><br><span class="line">-ne                       <span class="comment"># 不等于          </span></span><br><span class="line">-lt                       <span class="comment"># 小于         </span></span><br><span class="line">-le                       <span class="comment"># 小于等于          </span></span><br><span class="line">-gt                       <span class="comment"># 大于          </span></span><br><span class="line">-ge                       <span class="comment"># 大于等于 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 算术表达式比较</span></span><br><span class="line">==                       <span class="comment"># 相等           </span></span><br><span class="line">!=                       <span class="comment"># 不相等           </span></span><br><span class="line">&lt;=                       <span class="comment"># 小于或等于           </span></span><br><span class="line">&gt;=                       <span class="comment"># 大于或等于           </span></span><br><span class="line">&lt;                        <span class="comment"># 小于           </span></span><br><span class="line">&gt;                        <span class="comment"># 大于</span></span><br></pre></td></tr></table></figure>

<p>常用选项：其它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-o OPTION                      <span class="comment"># 如果在shell 中开启了某项，则为真     </span></span><br><span class="line">-v VAR                         <span class="comment"># 如果变量被设置为为真     </span></span><br><span class="line">-R VAR                         <span class="comment"># 如果变量被设置且被引用则为真     </span></span><br><span class="line">! EXPR                         <span class="comment"># 表达式结果取反     </span></span><br><span class="line">EXPR1 -a EXPR2                 <span class="comment"># 如果 expr1 和 expr2 都为真则为真     </span></span><br><span class="line">EXPR1 -o EXPR2                 <span class="comment"># 如果 expr1 和 expr2 有一个为真则为真</span></span><br></pre></td></tr></table></figure>

<h3 id="变量测试"><a href="#变量测试" class="headerlink" title="变量测试"></a>变量测试</h3><p>范例：判断变量是否被定义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># unset x</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># test -v x </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># x=10</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># test -v x </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># y=</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># test -v y</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 注意 [ ] 中需要空格，否则会报下面错误</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [-v name]</span></span><br><span class="line">-bash: [-v: <span class="built_in">command</span> not found</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -v name ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<h3 id="数值测试"><a href="#数值测试" class="headerlink" title="数值测试"></a>数值测试</h3><p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># i=10</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># j=8</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ $i -lt $j ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ $i -gt $j ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># [ i -gt j ]</span></span><br><span class="line">-bash: [: i: <span class="built_in">integer</span> expression expected</span><br></pre></td></tr></table></figure>

<p>范例：算术表达式比较</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=10;(( x == y ));echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=20;(( x == y ));echo $?</span></span><br><span class="line"> 1</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=20;(( x != y ));echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=10;(( x != y ));echo $?</span></span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=20;(( x &gt; y ));echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># x=10;y=20;(( x &lt; y ));echo $?</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<h3 id="字符串测试"><a href="#字符串测试" class="headerlink" title="字符串测试"></a>字符串测试</h3><p><strong>test和 [ ] 字符串测试用法</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-z STRING                           <span class="comment"># 判断字符串是否为空，为空则为</span></span><br><span class="line">-n STRING                           <span class="comment"># 如果字符串不为空则为真</span></span><br><span class="line">STRING                              <span class="comment"># 同上</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个字符串变量比较，一定要有空格，如果没有空格，就变成赋值了</span></span><br><span class="line">STRING1 = STRING2                   <span class="comment"># 如果 string1 和 string2 字符串相同则为真</span></span><br><span class="line">STRING1 != STRING2                  <span class="comment"># 如果 string1 和 string2 字符串不相同则为真</span></span><br><span class="line">STRING1 &lt; STRING2                   <span class="comment"># 只比较第一个字符，以字母表顺序来比较，string1在string2 之前则为真，&lt; 要转义</span></span><br><span class="line">STRING1 &gt; STRING2                   <span class="comment"># 只比较第一个字符，以字母表顺序来比较，string1在string2 之后则为真, &gt; 要转义</span></span><br></pre></td></tr></table></figure>

<p><strong>[[ ]] 字符串测试用法</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[[ expression ]] 用法</span><br><span class="line">==                                  <span class="comment"># 左侧字符串是否和右侧的PATTERN相同</span></span><br><span class="line">                                    <span class="comment"># 注意:此表达式用于[[ ]]中，PATTERN为通配符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=~                                  <span class="comment"># 左侧字符串是否能够被右侧的正则表达式的PATTERN所匹配</span></span><br><span class="line">                                    <span class="comment"># 注意: 此表达式用于[[ ]]中为扩展的正则表达式</span></span><br></pre></td></tr></table></figure>

<p><strong>建议：当使用正则表达式或通配符使用[[ ]]，其它情况一般使用 [ ]</strong></p>
<p>范例：使用 [ ]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># unset str</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -z &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># str=&quot;&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -z &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># str=&quot; &quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -z &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -n &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># unset str</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -n &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># str=magedu</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># str=magedu</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ &quot;$str&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># str1=magedu</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># str2=mage</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ $str1 = $str2 ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># str2=magedu</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ $str1 = $str2 ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<p>范例：在比较字符串时，建议变量放在“ ”中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># [ &quot;$NAME&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=&quot;I love linux&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ $NAME ]</span></span><br><span class="line">-bash: [: love: binary operator expected</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ &quot;$NAME&quot; ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ I love linux ]</span></span><br><span class="line">-bash: [: love: binary operator expected</span><br></pre></td></tr></table></figure>

<p>范例：比较符要转义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个写法有问题</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># a=a;b=b; [ $a &gt; $b ]; echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 这个才是正确的</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># a=a;b=b; [ &quot;$a&quot; \&gt; &quot;$b&quot; ]; echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># a=b;b=a; [ &quot;$a&quot; \&gt; &quot;$b&quot; ]; echo $?</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<p>范例: [[ ]] 和通配符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># FILE=&quot;a*&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $FILE</span></span><br><span class="line"> a*</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $FILE == a* ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=&quot;ab&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $FILE == a* ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=&quot;a*&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># [[]]中如果不想使用通配符*,只想表达*本身,可以用&quot; &quot;引起来</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $FILE == a&quot;*&quot; ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=&quot;ab&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $FILE == a&quot;*&quot; ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># [[]]中如果不想使用通配符*,只想表达*本身,也可以使用转义符</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $FILE == a\* ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=&quot;a\b&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $FILE == a\* ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=&quot;a*&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $FILE == a\* ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 通配符?</span></span><br><span class="line">[root@centos8 script]<span class="comment"># FILE=abc</span></span><br><span class="line">[root@centos8 script]<span class="comment"># [[ $FILE == ??? ]]</span></span><br><span class="line">[root@centos8 script]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line">[root@centos8 script]<span class="comment"># FILE=abcd</span></span><br><span class="line">[root@centos8 script]<span class="comment"># [[ $FILE == ??? ]]</span></span><br><span class="line">[root@centos8 script]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 通配符</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=&quot;linux1&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$NAME&quot; == linux* ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$NAME&quot; == &quot;linux*&quot; ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=&quot;linux*&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$NAME&quot; == &quot;linux*&quot; ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 结论：[[ == ]] == 右侧的 * 做为通配符，不要加&quot;&quot;，只想做为*符号使用时, 需要加 &quot;&quot; 或转义</span></span><br></pre></td></tr></table></figure>

<p>范例: 判断合理的考试成绩</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 script]<span class="comment">#  SCORE=101</span></span><br><span class="line">[root@centos8 script]<span class="comment">#  [[ $SCORE =~ 100|[0-9]&#123;1,2&#125; ]]</span></span><br><span class="line">[root@centos8 script]<span class="comment">#  echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line">[root@centos8 script]<span class="comment">#  [[ $SCORE =~ ^(100|[0-9]&#123;1,2&#125;)$ ]]</span></span><br><span class="line">[root@centos8 script]<span class="comment">#  echo $?</span></span><br><span class="line"> 1</span><br><span class="line"> </span><br><span class="line">[root@centos8 script]<span class="comment">#  SCORE=10</span></span><br><span class="line">[root@centos8 script]<span class="comment">#  [[ $SCORE =~ ^(100|[0-9]&#123;1,2&#125;)$ ]]</span></span><br><span class="line">[root@centos8 script]<span class="comment">#  echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line">[root@centos8 script]<span class="comment">#  SCORE=abc</span></span><br><span class="line">[root@centos8 script]<span class="comment">#  [[ $SCORE =~ ^(100|[0-9]&#123;1,2&#125;)$ ]]</span></span><br><span class="line">[root@centos8 script]<span class="comment">#  echo $?</span></span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>

<p>范例：使用 [[ ]] 判断文件后缀</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通配符</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=test.log</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$FILE&quot; == *.log ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=test.txt</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$FILE&quot; == *.log ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$FILE&quot; != *.log ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 正则表达式</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$FILE&quot; =~ \.log$ ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># FILE=test.log</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$FILE&quot; =~ \.log$ ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br></pre></td></tr></table></figure>

<p>范例: 判断合法的非负整数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># N=100</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$N&quot; =~ ^[0-9]+$ ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># N=Magedu10</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$N&quot; =~ ^[0-9]+$ ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>

<p>范例: 判断合法IP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># IP=1.2.3.4</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$IP&quot; =~ ^([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;$ ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># IP=1.2.3.4567</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ &quot;$IP&quot; =~ ^([0-9]&#123;1,3&#125;.)&#123;3&#125;[0-9]&#123;1,3&#125;$ ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [[ $IP =~ ^(([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\.)&#123;3&#125;([1-9]?[0-9]|1[0-9]&#123;2&#125;|2[0-4][09]|25[0-5])$ ]]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>

<p>范例: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># cat check_ip.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># ****************************************************</span></span><br><span class="line"><span class="comment"># Author: jose</span></span><br><span class="line"><span class="comment"># QQ: 123456</span></span><br><span class="line"><span class="comment"># Date: 2022-08-17</span></span><br><span class="line"><span class="comment"># FileName: set3.sh</span></span><br><span class="line"><span class="comment"># URL: http://www.magedu.com</span></span><br><span class="line"><span class="comment"># Description: test</span></span><br><span class="line"><span class="comment"># Copyright(C): 2022 All right</span></span><br><span class="line"><span class="comment"># ***************************************************</span></span><br><span class="line">IP=<span class="variable">$1</span> </span><br><span class="line">[[ <span class="variable">$IP</span> =~ ^(([<span class="number">1</span>-<span class="number">9</span>]?[<span class="number">0</span>-<span class="number">9</span>]|<span class="number">1</span>[<span class="number">0</span>-<span class="number">9</span>]&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>][<span class="number">0</span>-<span class="number">9</span>]|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])\.)&#123;<span class="number">3</span>&#125;([<span class="number">1</span>-<span class="number">9</span>]?[<span class="number">0</span>-<span class="number">9</span>]|<span class="number">1</span>[<span class="number">0</span>-<span class="number">9</span>]&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>][<span class="number">0</span>-<span class="number">9</span>]|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])$ ]] </span><br><span class="line">&amp;&amp; echo <span class="variable">$IP</span> is valid || echo <span class="variable">$IP</span> is invalid</span><br></pre></td></tr></table></figure>

<h3 id="文件测试"><a href="#文件测试" class="headerlink" title="文件测试"></a>文件测试</h3><p>范例： -e和-a 表示判断文件的存在性，建议使用-e</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件是否不存在</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -a /etc/nologin ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ! [ -a /etc/nologin ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件是否存在</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -a /etc/issue ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取反后结果却没有变化</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ ! -a /etc/issue ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ! [ -a /etc/issue ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件是否存在</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># ! [ -e /etc/issue ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此为推荐写法</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ ! -e /etc/issue ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -d /etc ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -d /etc/issue ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -L /bin ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -L /bin/ ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>文件权限测试： </p>
<p><strong>注意：最终结果由用户对文件的实际权限决定，而非文件属性决定</strong> </p>
<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># [ -w /etc/shadow ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -x /etc/shadow ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -w test.txt ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># chattr +i test.txt </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># lsattr test.txt</span></span><br><span class="line">----i-------------- nianling.txt</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -w test.txt ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># chattr -i test.txt </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -w test.txt ]</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>文件属性测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># [ -s /etc/passwd ];echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># [ -s nofile ];echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># [ -O /etc/passwd ];echo $?</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="关于-和"><a href="#关于-和" class="headerlink" title="关于 () 和 {}"></a>关于 () 和 {}</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">( cmd1;cmd2;... ) 和 &#123; cmd1;cmd2;...; &#125; 都可以将多个命令组合在一起，批量执行</span><br><span class="line">( list ) 会开启子shell,并且list中变量赋值及内部命令执行后,将不再影响后续的环境</span><br><span class="line">&#123; list; &#125; 不会开启子shell, 在当前shell中运行,会影响当前shell环境，左侧要有空格，右侧要有; 结束</span><br></pre></td></tr></table></figure>

<p>范例: () 和 {} </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># name=mage;(echo $name;name=wang;echo $name );echo $name</span></span><br><span class="line">mage</span><br><span class="line">wang</span><br><span class="line">mage</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># name=mage;&#123; echo $name;name=wang;echo $name; &#125; ;echo $name</span></span><br><span class="line">mage</span><br><span class="line">wang</span><br><span class="line">wang</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># umask</span></span><br><span class="line">0022</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># (umask 066;touch f1.txt)</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># ll f1.txt </span></span><br><span class="line">-rw------- 1 root root 0 Dec 23 16:58 f1.txt</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># umask</span></span><br><span class="line">0022</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ( cd /data;ls )</span></span><br><span class="line">test.log</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># pwd</span></span><br><span class="line">/root</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># &#123; cd /data;ls; &#125;</span></span><br><span class="line">test.log</span><br><span class="line"></span><br><span class="line">[root@centos8 data]<span class="comment"># pwd</span></span><br><span class="line">/data</span><br><span class="line"></span><br><span class="line">[root@centos8 data]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># （）会开启子shell</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $BASHPID</span></span><br><span class="line">1920</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># ( echo $BASHPID;sleep 100)</span></span><br><span class="line">1979</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># pstree -p</span></span><br><span class="line">├─sshd(719)───sshd(1906)───sshd(1919)─┬─bash(1920)───bash(1979)───<span class="built_in">sleep</span>(1980)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123; &#125; 不会开启子shell</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $BASHPID</span></span><br><span class="line">1920</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># &#123; echo $BASHPID; &#125;</span></span><br><span class="line">1920</span><br></pre></td></tr></table></figure>

<h2 id="组合测试条件"><a href="#组合测试条件" class="headerlink" title="组合测试条件"></a>组合测试条件</h2><h3 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ EXPRESSION1 -a EXPRESSION2 ]        <span class="comment"># 并且，EXPRESSION1和EXPRESSION2都是真，结果才为真</span></span><br><span class="line"></span><br><span class="line">[ EXPRESSION1 -o EXPRESSION2 ]        <span class="comment"># 或者，EXPRESSION1和EXPRESSION2只要有一个真，结果就为真</span></span><br><span class="line"></span><br><span class="line">[ ! EXPRESSION ]                      <span class="comment"># 取反</span></span><br></pre></td></tr></table></figure>

<p><strong>说明： -a 和 -o 需要使用测试命令进行，[[ ]] 不支持</strong></p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#  FILE=&quot;/data/scrips/test.sh&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  ll /data/scrips/test.sh</span></span><br><span class="line">-rw-r--r-- 1 root root 382 Dec 23 09:32 /data/scripts/test.sh</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  [ -f $FILE -a -x $FILE ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  chmod +x /data/scripts/test.sh</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  ll /data/scripts/test.sh</span></span><br><span class="line">-rwxr-xr-x 1 root root 382 Dec 23 09:32 /data/script40/test.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并且</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  [ -f $FILE -a -x $FILE ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  chmod -x /data/scripts/test.sh</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  ll /data/scripts/test.sh</span></span><br><span class="line">-rw-r--r-- 1 root root 382 Dec 23 09:32 /data/scripts/test.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  [ -f $FILE -o -x $FILE ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  [ -x $FILE ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取反</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  [ ! -x $FILE ] </span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  ! [ -x $FILE ] </span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h3 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式"></a>第二种方式</h3><p><img src="../../../../images/SRE/day07/7.png" alt="7"></p>
<p><strong>条件表达式</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">COMMAND1 &amp;&amp; COMMAND2         <span class="comment">#  并且，短路与，代表条件性的 AND THEN </span></span><br><span class="line">                             <span class="comment">#  如果 COMMAND1 成功，将执行 COMMAND2；否则，不执行 COMMAND2</span></span><br><span class="line"></span><br><span class="line">COMMAND1 || COMMAND2         <span class="comment">#  或者，短路或，代表条件性的 OR ELSE</span></span><br><span class="line">                             <span class="comment">#  如果 COMMAND1 成功，将执行 COMMAND2；否则，不执行 COMMAND2</span></span><br><span class="line"></span><br><span class="line">! COMMAND                    <span class="comment">#  非，取反</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># test &quot;A&quot; = &quot;B&quot; &amp;&amp; echo &quot;Strings are equal&quot; </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># test &quot;A&quot;-eq &quot;B&quot; &amp;&amp; echo &quot;Integers are equal&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ &quot;A&quot; = &quot;B&quot; ] &amp;&amp; echo &quot;Strings are equal&quot; </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ &quot;$A&quot; -eq &quot;$B&quot; ] &amp;&amp; echo &quot;Integers are equal&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -f /bin/cat -a -x /bin/cat ] &amp;&amp; cat /etc/fstab</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># [ -z &quot;$HOSTNAME&quot; -o &quot;$HOSTNAME&quot; = &quot;localhost.localdomain&quot; ]&amp;&amp; </span></span><br><span class="line">hostname www.magedu.com</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># id wang &amp;&gt; /dev/null ||   useradd wang</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># id zhang &amp;&gt; /dev/null ||   useradd zhang</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># getent passwd zhang</span></span><br><span class="line">zhang:x:1002:1002::/home/zhang:/bin/bash</span><br><span class="line">[root@centos8 ~]<span class="comment"># grep -q no_such_user /etc/passwd || echo &#x27;No such user&#x27;</span></span><br><span class="line">No such user</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#  [ -f “$FILE” ] &amp;&amp; [[ “$FILE”=~ .*\.sh$ ]] &amp;&amp; chmod +x $FILE</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># ping -c1 -W1 172.16.0.1 &amp;&gt; /dev/null &amp;&amp; echo &#x27;172.16.0.1 is up&#x27; || (echo &#x27;172.16.0.1 is unreachable&#x27;; exit 1) </span></span><br><span class="line">172.16.0.1 is up</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  IP=10.0.0.111;ping -c1 -W1 $IP &amp;&gt; /dev/null &amp;&amp; echo $IP is up || echo $IP is down</span></span><br><span class="line">10.0.0.111 is down</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  IP=10.0.0.1;ping -c1 -W1 $IP &amp;&gt; /dev/null &amp;&amp; echo $IP is up || echo $IP is down</span></span><br><span class="line">10.0.0.1 is up</span><br></pre></td></tr></table></figure>

<p><strong>条件组合</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COMMAND1 &amp;&amp; COMMAND2 || COMMAND3 </span><br><span class="line">COMMAND1 || COMMAND2 &amp;&amp; COMMAND3</span><br></pre></td></tr></table></figure>

<p><img src="../../../../images/SRE/day07/8.png" alt="8"></p>
<p><img src="../../../../images/SRE/day07/9.png" alt="9"></p>
<p>范例：轮盘游戏</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># [ $[RANDOM%6] -eq 0 ] &amp;&amp; rm -rf /* || echo &quot;Luckly boy&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例：&amp;&amp; 和 || 组合使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># NAME=wang; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot;</span></span><br><span class="line">wang is exist</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wange; id $NAME &amp;&gt; /dev/null || echo &quot;$NAME is not exist&quot;</span></span><br><span class="line">wange is not exist</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wange; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot; || echo &quot;$NAME is not exist&quot;</span></span><br><span class="line">wange is not exist</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wang; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot; || echo &quot;$NAME is not exist&quot;</span></span><br><span class="line">wang is exist</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wang; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot; || echo &quot;$NAME is not exist&quot;</span></span><br><span class="line">wang is exist</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wang; id $NAME &amp;&gt; /dev/null || echo &quot;$NAME is not exist&quot; &amp;&amp; echo &quot;$NAME is exist&quot;</span></span><br><span class="line">wang is exist</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wange; id $NAME &amp;&gt; /dev/null || echo &quot;$NAME is not exist&quot;&amp;&amp; echo &quot;$NAME is exist&quot;</span></span><br><span class="line">wange is not exist</span><br><span class="line">wange is exist</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结论：如果&amp;&amp;和 || 混合使用，&amp;&amp; 要在前，|| 放在后</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wange; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot; || useradd $NAME</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># id wange</span></span><br><span class="line">uid=1002(wange) gid=1002(wange) <span class="built_in">groups</span>=1002(wange)</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wangge; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot; || ( useradd $NAME; echo $NAME is created )</span></span><br><span class="line">wangge is created</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># id wangge</span></span><br><span class="line">uid=1003(wangge) gid=1003(wangge) <span class="built_in">groups</span>=1003(wangge)</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># NAME=wanggege; id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot; || &#123; useradd $NAME; echo $NAME is created; &#125;</span></span><br><span class="line">wanggege is created</span><br></pre></td></tr></table></figure>

<p>范例：网络状态判断</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat /data/scripts/ping.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">IP=172.16.0.1</span><br><span class="line">ping -c1 -W1 <span class="variable">$IP</span> &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span> is up&quot;</span> || &#123;  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span> is unreachable&quot;</span>; <span class="built_in">exit</span>; &#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Script is finished&quot;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># bash /data/scripts/ping.sh</span></span><br><span class="line">172.16.0.1 is up</span><br><span class="line">Script is finished</span><br></pre></td></tr></table></figure>

<p>范例: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># . /etc/os-release; [[ $ID == &quot;rocky&quot; ]] &amp;&amp; [[ $VERSION_ID == 8* ]] &amp;&amp; echo Rocky8 || echo CentOS8</span></span><br><span class="line">Rocky8</span><br></pre></td></tr></table></figure>

<p>范例：磁盘空间的判断</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat /data/script/disk_check.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">WARNING=80</span><br><span class="line">SPACE_USED=`<span class="built_in">df</span>|grep <span class="string">&#x27;^/dev/sd&#x27;</span>|<span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> %|<span class="built_in">cut</span> -d% -f5|<span class="built_in">sort</span> -nr|<span class="built_in">head</span> -1`[ <span class="string">&quot;<span class="variable">$SPACE_USED</span>&quot;</span> -ge <span class="variable">$WARNING</span> ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;disk used is <span class="variable">$SPACE_USED</span>,will be full&quot;</span> ; mail -s diskwarning root; &#125;</span><br></pre></td></tr></table></figure>

<p>范例：磁盘空间和Inode号的检查脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 scripts]<span class="comment"># cat disk_check.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">WARNING=80 </span><br><span class="line">SPACE_USED=`<span class="built_in">df</span> | grep <span class="string">&#x27;^/dev/sd&#x27;</span>|grep -oE <span class="string">&#x27;[0-9]+%&#x27;</span>|<span class="built_in">tr</span> -d %| <span class="built_in">sort</span> -nr|<span class="built_in">head</span> -1` </span><br><span class="line">INODE_USED=`<span class="built_in">df</span> -i | grep <span class="string">&#x27;^/dev/sd&#x27;</span>|grep -oE <span class="string">&#x27;[0-9]+%&#x27;</span>|<span class="built_in">tr</span> -d %| <span class="built_in">sort</span> -nr|<span class="built_in">head</span> -1`</span><br><span class="line">[ <span class="string">&quot;<span class="variable">$SPACE_USED</span>&quot;</span> -gt <span class="variable">$WARNING</span> -o <span class="string">&quot;<span class="variable">$INODE_USED</span>&quot;</span> -gt <span class="variable">$WARNING</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;DISK USED:<span class="variable">$SPACE_USED</span>%,INODE_USED:<span class="variable">$INODE_USED</span>,will be full&quot;</span> | mail -s <span class="string">&quot;DISK Warning&quot;</span> root@wangxiaochun.com </span><br></pre></td></tr></table></figure>

<h2 id="使用read命令来接受输入"><a href="#使用read命令来接受输入" class="headerlink" title="使用read命令来接受输入"></a>使用read命令来接受输入</h2><p>使用read来把输入值分配给一个或多个shell变量，read从标准输入中读取值，给每个单词分配一个变 量，所有剩余单词都被分配给最后一 个变量，如果变量名没有指定，默认标准输入的值赋值给系统内置 变量REPLY</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> [options] [name ...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常见选项</span></span><br><span class="line">-p <span class="string">&#x27;PROMPT&#x27;</span>          <span class="comment"># 指定要显示的提示</span></span><br><span class="line">-s                   <span class="comment"># 静默输入，一般用于密码</span></span><br><span class="line">-n N                 <span class="comment"># 指定输入的字符长度N</span></span><br><span class="line">-d <span class="string">&#x27;CHAR&#x27;</span>            <span class="comment"># 输入结束符</span></span><br><span class="line">-t N                 <span class="comment"># TIMEOUT为N秒</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># read</span></span><br><span class="line">M51</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $REPLY</span></span><br><span class="line">M51</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># read NAME TITLE</span></span><br><span class="line">wang cto</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $NAME</span></span><br><span class="line">wang</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $TITLE</span></span><br><span class="line">cto</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># read -p &quot;Please input your name: &quot; NAME</span></span><br><span class="line">Please input your name: wang</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $NAME</span></span><br><span class="line">wang</span><br></pre></td></tr></table></figure>

<p>范例：标准输入重定向赋值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#  read x y z &lt;&lt;&lt; &quot;I love you&quot;</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $x</span></span><br><span class="line">I</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $y</span></span><br><span class="line">love</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#  echo $z</span></span><br><span class="line">you</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>范例：交互式输入参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim test6.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input your name: &quot;</span> NAME</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input your age: &quot;</span> AGE</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$NAME</span> <span class="variable">$AGE</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash test6.sh </span></span><br><span class="line">Please input your name: jose</span><br><span class="line">Please input your age: 123</span><br><span class="line">jose 123</span><br></pre></td></tr></table></figure>

<p>范例：管道符</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#管道符是开启子进程，所以这样没值</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo magedu | read NAME </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo $NAME</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo magedu | &#123; read NAME; echo $NAME; &#125;</span></span><br><span class="line">magedu</span><br></pre></td></tr></table></figure>

<p>管道符左右两边都是子进程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#没有开启子进程</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $BASHPID;&#123; echo $BASHPID;sleep 100; &#125;</span></span><br><span class="line">2679</span><br><span class="line">2679</span><br><span class="line"></span><br><span class="line"><span class="comment">#管道符左右两边都开启了子进程，</span></span><br><span class="line"><span class="comment">#但管道符左边的没有输出，因为重定向给右边了，右边也不接收标准输入重定向，所以没有输出</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $BASHPID;&#123; echo $BASHPID;sleep 100; &#125; | &#123; echo $BASHPID;sleep 100; &#125;</span></span><br><span class="line">2679</span><br><span class="line">6856</span><br><span class="line"></span><br><span class="line">[jose@rocky86 ~]$ pstree -p | grep <span class="built_in">sleep</span></span><br><span class="line">           |-sshd(1032)-+-sshd(2648)---sshd(2672)---bash(2679)-+-bash(6855)---<span class="built_in">sleep</span>(6858)</span><br><span class="line">           |            |                                      `-bash(6856)---<span class="built_in">sleep</span>(6857)</span><br><span class="line">           </span><br><span class="line">           </span><br><span class="line">           </span><br><span class="line"><span class="comment">#read 接收并查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $BASHPID;&#123; echo $BASHPID;sleep 100; &#125; | &#123; read pid;echo $pid; echo $BASHPID;sleep 100; &#125;</span></span><br><span class="line">2679</span><br><span class="line">6944</span><br><span class="line">6945</span><br><span class="line"></span><br><span class="line">[jose@rocky86 ~]$ pstree -p | grep <span class="built_in">sleep</span></span><br><span class="line">           |-sshd(1032)-+-sshd(2648)---sshd(2672)---bash(2679)-+-bash(6944)---<span class="built_in">sleep</span>(6946)</span><br><span class="line">           |            |                                      `-bash(6945)---<span class="built_in">sleep</span>(6947)</span><br></pre></td></tr></table></figure>

<p>范例：面试题 read和输入重定向</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 scripts]<span class="comment"># cat test.txt</span></span><br><span class="line">1 2</span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment"># read i j &lt; test.txt ; echo i=$i j=$j</span></span><br><span class="line">i=1 j=2</span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment"># echo 1 2 | read x y ; echo x=$x y=$y</span></span><br><span class="line">x= y=</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo 1 2 | ( read x y ; echo x=$x y=$y )</span></span><br><span class="line">x=1 y=2</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo 1 2 | &#123; read x y ; echo x=$x y=$y; &#125;</span></span><br><span class="line">x=1 y=2</span><br></pre></td></tr></table></figure>

<p>范例：判断用户输入的是否为 YES</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 scripts]<span class="comment"># cat read.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Are you rich?yes or no: &quot;</span> ANSWER</span><br><span class="line">[[ <span class="variable">$ANSWER</span> =~ ^([Yy]|[Yy][Ee][Ss])$ ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;You are rich&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;Good Good Study,Day Day Up!&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>范例: 判断用户输入的是否为 YES</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~<span class="comment"># cat yesorno.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input yes or no: &quot;</span> input</span><br><span class="line"></span><br><span class="line">answer=`<span class="built_in">echo</span> <span class="variable">$input</span>| <span class="built_in">tr</span> <span class="string">&#x27;A-Z&#x27;</span> <span class="string">&#x27;a-z&#x27;</span>`</span><br><span class="line"></span><br><span class="line">[ <span class="variable">$answer</span> = <span class="string">&#x27;yes&#x27;</span> -o <span class="variable">$answer</span> = <span class="string">&#x27;y&#x27;</span> ] &amp;&amp; <span class="built_in">echo</span> YES</span><br><span class="line"></span><br><span class="line">[ <span class="variable">$answer</span> = <span class="string">&#x27;no&#x27;</span> -o <span class="variable">$answer</span> = <span class="string">&#x27;n&#x27;</span> ] &amp;&amp; <span class="built_in">echo</span> NO</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~<span class="comment"># cat yesorno2.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input yes or no: &quot;</span> input</span><br><span class="line"></span><br><span class="line">[[ <span class="variable">$input</span> =~ ^([Yy][Ee][Ss]|[Yy])$ ]] &amp;&amp; <span class="built_in">echo</span> YES</span><br><span class="line">[[ <span class="variable">$input</span> =~ ^([Nn][Oo]|[Nn])$ ]] &amp;&amp; <span class="built_in">echo</span> NO</span><br></pre></td></tr></table></figure>

<p>范例: 检查主机的网络状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 script]<span class="comment">#cat check_host.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input a IP: &quot;</span> IP</span><br><span class="line">[[  <span class="string">&quot;<span class="variable">$IP</span>&quot;</span> =~ ^(([<span class="number">1</span>-<span class="number">9</span>]?[<span class="number">0</span>-<span class="number">9</span>]|<span class="number">1</span>[<span class="number">0</span>-<span class="number">9</span>]&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>][<span class="number">0</span>-<span class="number">9</span>]|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])\.)&#123;<span class="number">3</span>&#125;([<span class="number">1</span>-<span class="number">9</span>]?[<span class="number">0</span>-<span class="number">9</span>]|<span class="number">1</span>[<span class="number">0</span>-<span class="number">9</span>]&#123;<span class="number">2</span>&#125;|<span class="number">2</span>[<span class="number">0</span>-<span class="number">4</span>][<span class="number">0</span>-<span class="number">9</span>]|<span class="number">25</span>[<span class="number">0</span>-<span class="number">5</span>])$ </span><br><span class="line">]] || &#123; echo &quot;IP is invalid&quot;;exit; &#125;</span><br><span class="line">ping -c1 -W1 <span class="variable">$IP</span> &amp;&gt; /dev/null &amp;&amp; echo <span class="variable">$IP</span> is up || echo <span class="variable">$IP</span> is down</span><br></pre></td></tr></table></figure>

<h1 id="bash-shell-的配置文件"><a href="#bash-shell-的配置文件" class="headerlink" title="bash shell 的配置文件"></a>bash shell 的配置文件</h1><blockquote>
<p>bash shell的配置文件很多，可以分成下面类别</p>
</blockquote>
<h2 id="按生效范围划分两类"><a href="#按生效范围划分两类" class="headerlink" title="按生效范围划分两类"></a>按生效范围划分两类</h2><p>全局配置：针对所有用户皆有效</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile</span><br><span class="line">/etc/profile.d/*.sh</span><br><span class="line">/etc/bashrc</span><br></pre></td></tr></table></figure>

<p>个人配置：只针对特定用户有效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/.bash_profile</span><br><span class="line">~/.bashrc</span><br></pre></td></tr></table></figure>

<h2 id="shell登录两种方式分类"><a href="#shell登录两种方式分类" class="headerlink" title="shell登录两种方式分类"></a>shell登录两种方式分类</h2><h3 id="交互式登录"><a href="#交互式登录" class="headerlink" title="交互式登录"></a>交互式登录</h3><ul>
<li>直接通过终端输入账号密码登录</li>
<li>使用 su - UserName 切换的用户</li>
</ul>
<p><strong>配置文件生效和执行顺序：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#放在每个文件最前</span></span><br><span class="line">/etc/profile</span><br><span class="line">/etc/profile.d/*.sh</span><br><span class="line">/etc/bashrc </span><br><span class="line">~/ .bash_ profile</span><br><span class="line">~/ .bashrc</span><br><span class="line">/etc/bashrc                  <span class="comment">#此文件执行两次</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#放在每个文件最后</span></span><br><span class="line">/etc/profile.d/*.sh</span><br><span class="line">/etc/bashrc</span><br><span class="line">/etc/profile</span><br><span class="line">/etc/bashrc                  <span class="comment">#此文件执行两次</span></span><br><span class="line">~/.bashrc</span><br><span class="line">~/.bash_profile</span><br></pre></td></tr></table></figure>

<p><strong>注意：文件之间的调用关系，写在同一个文件的不同位置，将影响文件的执行顺序</strong></p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改配置文件，在最前面加入内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="comment"># /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/profile-begin&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vim /etc/bashrc </span></span><br><span class="line"><span class="comment"># /etc/bashrc</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/bashrc-begin&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新登录，查看</span></span><br><span class="line">......</span><br><span class="line">Last login: Thu Aug 18 15:54:00 2022 from 10.0.0.1</span><br><span class="line">/etc/profile-begin</span><br><span class="line">/etc/bashrc-begin</span><br><span class="line">/etc/bashrc-begin</span><br><span class="line">[root@rocky86 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改配置文件，在最后面加入内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vim /etc/profile</span></span><br><span class="line">......</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/profile-end&quot;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># vim /etc/bashrc </span></span><br><span class="line">......</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/etc/bashrc-end&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新登录，查看</span></span><br><span class="line">......</span><br><span class="line">Last login: Thu Aug 18 17:04:11 2022 from 10.0.0.1</span><br><span class="line">/etc/bashrc-end</span><br><span class="line">/etc/profile-end</span><br><span class="line">/etc/bashrc-end</span><br></pre></td></tr></table></figure>

<h3 id="非交互式登录"><a href="#非交互式登录" class="headerlink" title="非交互式登录"></a>非交互式登录</h3><ul>
<li>su UserName  </li>
<li>图形界面下打开的终端 </li>
<li>执行脚本 </li>
<li>任何其它的bash实例</li>
</ul>
<p>执行顺序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile.d/*.sh</span><br><span class="line">/etc/bashrc</span><br><span class="line">~/.bashrc</span><br></pre></td></tr></table></figure>

<h2 id="按功能划分分类"><a href="#按功能划分分类" class="headerlink" title="按功能划分分类"></a>按功能划分分类</h2><table>
<thead>
<tr>
<th>内容</th>
<th>Profile类</th>
<th>bashrc类</th>
</tr>
</thead>
<tbody><tr>
<td>交互式登录shell配置</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>非交互式登录shell配置</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>全局配置文件</td>
<td>/etc/profile,/etc/profile.d/*.sh</td>
<td>/etc/bashrc</td>
</tr>
<tr>
<td>个人配置文件</td>
<td>~/.bash_profile</td>
<td>~/.bashrc</td>
</tr>
<tr>
<td>功能作用</td>
<td>定义环境变量，运行命令或脚本</td>
<td>定义命令别名和函数，定义本地变量</td>
</tr>
</tbody></table>
<h2 id="编辑配置文件生效"><a href="#编辑配置文件生效" class="headerlink" title="编辑配置文件生效"></a>编辑配置文件生效</h2><p>修改profile和bashrc文件后需生效两种方法: </p>
<ul>
<li>重新启动shell进程 </li>
<li>source|. 配置文件</li>
</ul>
<p>注意：source 会在当前shell中执行脚本,所有一般只用于执行置文件，或在脚本中调用另一个脚本的场景 </p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. ~/.bashrc</span><br></pre></td></tr></table></figure>

<h2 id="Bash-退出任务"><a href="#Bash-退出任务" class="headerlink" title="Bash 退出任务"></a>Bash 退出任务</h2><p>保存在~/.bash_logout文件中（用户）,在退出登录shell时运行 </p>
<p>功能： </p>
<ul>
<li>创建自动备份 </li>
<li>清除临时文件</li>
</ul>
<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="条件选择"><a href="#条件选择" class="headerlink" title="条件选择"></a>条件选择</h2><h3 id="条件判断分绍"><a href="#条件判断分绍" class="headerlink" title="条件判断分绍"></a>条件判断分绍</h3><h4 id="单分支条件"><a href="#单分支条件" class="headerlink" title="单分支条件"></a>单分支条件</h4><p><img src="../../../../images/SRE/day07/10.png" alt="10"></p>
<h4 id="多分支条件"><a href="#多分支条件" class="headerlink" title="多分支条件"></a>多分支条件</h4><p><img src="../../../../images/SRE/day07/11.png" alt="11"></p>
<p><img src="../../../../images/SRE/day07/12.png" alt="12"></p>
<h3 id="选择执行-if-语句"><a href="#选择执行-if-语句" class="headerlink" title="选择执行 if 语句"></a>选择执行 if 语句</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> COMMANDS; <span class="keyword">then</span> COMMANDS; [ <span class="keyword">elif</span> COMMANDS; <span class="keyword">then</span> COMMANDS;]... [ <span class="keyword">else</span> COMMANDS; ] <span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>单分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件;<span class="keyword">then</span></span><br><span class="line">   条件为真的分支代码</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>双分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件; <span class="keyword">then</span></span><br><span class="line">   条件为真的分支代码</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   条件为假的分支代码</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>多分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件1; <span class="keyword">then</span></span><br><span class="line">   条件1为真的分支代码</span><br><span class="line"><span class="keyword">elif</span> 判断条件2; <span class="keyword">then</span></span><br><span class="line">   条件2为真的分支代码</span><br><span class="line"><span class="keyword">elif</span> 判断条件3; <span class="keyword">then</span></span><br><span class="line">   条件3为真的分支代码</span><br><span class="line">...</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   以上条件都为假的分支代码</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>说明： </p>
<ul>
<li>多个条件时，逐个条件进行判断，第一次遇为“真”条件时，执行其分支，而后结束整个if语句 </li>
<li>if 语句可嵌套</li>
</ul>
<p>范例：判断操作系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim os-v1.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">. /etc/os-release</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$ID</span> = <span class="string">&quot;ubuntu&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ubuntu&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$ID</span> =~ rocky|centos|rhel ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;rhel&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;other os&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 100</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#根据命令的退出状态来执行命令</span></span><br><span class="line"><span class="keyword">if</span> ping -c1 -W2 station1 &amp;&gt; /dev/null; <span class="keyword">then</span>     </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;station1 is UP&#x27;</span>  </span><br><span class="line"><span class="keyword">elif</span>  grep -q <span class="string">&#x27;station1&#x27;</span> ~/maintenance.txt;  <span class="keyword">then</span>     </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;station1 is undergoing maintenance&#x27;</span></span><br><span class="line"><span class="keyword">else</span>   </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;station1 is unexpectedly DOWN!&#x27;</span>     </span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>范例：身体质量指数 (BMI） </p>
<p>参考链接: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://baike.baidu.com/item/标准体重/1694152?fr=aladdin</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat if_bmi.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入身高(m为单位): &quot;</span> HIGH</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ ! <span class="string">&quot;<span class="variable">$HIGH</span>&quot;</span> =~ ^[0-2](\.[0-9]&#123;1,2&#125;)?$ ]];<span class="keyword">then</span> </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;输入错误的身高!&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入体重(kg为单位): &quot;</span> WEIGHT</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ ! <span class="string">&quot;<span class="variable">$WEIGHT</span>&quot;</span> =~ ^[0-9]&#123;1,3&#125;$ ]];<span class="keyword">then</span> </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;输入错误的体重!&quot;</span>; </span><br><span class="line">  <span class="built_in">exit</span> 2; </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">BMI=`<span class="built_in">echo</span> <span class="variable">$WEIGHT</span>/<span class="variable">$HIGH</span>^2|bc`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$BMI</span>  -le 18 ] ;<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;太瘦了,多吃点!&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$BMI</span>  -lt 24 ] ;<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;身材很棒!&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;太胖了,注意节食,加强运动!&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="条件判断-case-语句"><a href="#条件判断-case-语句" class="headerlink" title="条件判断 case 语句"></a>条件判断 case 语句</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WORD <span class="keyword">in</span> [PATTERN [| PATTERN] ... ) COMMANDS ;;]... <span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 变量引用 <span class="keyword">in</span></span><br><span class="line">PAT1)</span><br><span class="line">  分支1</span><br><span class="line">  ;;</span><br><span class="line">PAT2)</span><br><span class="line">  分支2</span><br><span class="line">  ;;</span><br><span class="line">...</span><br><span class="line">*)</span><br><span class="line">  默认分支</span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>case支持glob风格的通配符：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*                   <span class="comment"># 任意长度任意字符</span></span><br><span class="line">?                   <span class="comment"># 任意单个字符</span></span><br><span class="line">[]                  <span class="comment"># 指定范围内的任意单个字符</span></span><br><span class="line">|                   <span class="comment"># 或者，a|b</span></span><br></pre></td></tr></table></figure>

<p>范例：判断用户输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim case_yesorno.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Do you agree(yes/no)? &quot;</span> INPUT</span><br><span class="line"></span><br><span class="line">INPUT=`<span class="built_in">echo</span> <span class="variable">$INPUT</span> | <span class="built_in">tr</span> <span class="string">&#x27;A-Z&#x27;</span> <span class="string">&#x27;a-z&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$INPUT</span> <span class="keyword">in</span></span><br><span class="line">y|<span class="built_in">yes</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;You input is YES&quot;</span></span><br><span class="line">   ;;  </span><br><span class="line">n|no)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;You input is NO&quot;</span></span><br><span class="line">   ;;  </span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Input fales,please input yes or no!&quot;</span></span><br><span class="line">   ;;  </span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>范例：判断用户输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim case_yesorno2.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Do you agree(yes/no)&quot;</span> INPUT</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$INPUT</span> <span class="keyword">in</span></span><br><span class="line">[yY]|[yY][eE][sS])</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;You input is YES&quot;</span></span><br><span class="line">  ;;</span><br><span class="line">[nN]|[nN][oO])</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;You input is NO&quot;</span></span><br><span class="line">  ;;</span><br><span class="line">*)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Input false , please input yes or no!&quot;</span></span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>范例: 文件后缀处理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim suffix.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;please input a file: &quot;</span> FILE</span><br><span class="line">SUFFIX=`<span class="built_in">echo</span> <span class="variable">$FILE</span> | grep -Eo <span class="string">&quot;[^.]+$&quot;</span>`</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$SUFFIX</span> <span class="keyword">in</span></span><br><span class="line">gz)</span><br><span class="line">   <span class="built_in">echo</span> gzip</span><br><span class="line">   ;;</span><br><span class="line">bz2)</span><br><span class="line">   <span class="built_in">echo</span> bzip2</span><br><span class="line">   ;;</span><br><span class="line">xz)</span><br><span class="line">   <span class="built_in">echo</span> xz</span><br><span class="line">   ;;</span><br><span class="line">Z)</span><br><span class="line">   <span class="built_in">echo</span> compress</span><br><span class="line">   ;;</span><br><span class="line">zip)</span><br><span class="line">   <span class="built_in">echo</span> zip</span><br><span class="line">   ;;</span><br><span class="line">*)</span><br><span class="line">   <span class="built_in">echo</span> other</span><br><span class="line">   ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>范例：运维菜单实现版本2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># vim work_menu.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">&quot;\E[$[RANDOM%7+31];1m&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">请选择：</span></span><br><span class="line"><span class="string">1）备份数据库</span></span><br><span class="line"><span class="string">2）清理日志</span></span><br><span class="line"><span class="string">3）软件升级</span></span><br><span class="line"><span class="string">4）软件回滚</span></span><br><span class="line"><span class="string">5）删库跑路</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p  <span class="string">&quot;请输入上面数字1-5: &quot;</span> MENU</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$MENU</span> <span class="keyword">in</span></span><br><span class="line">1)</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;执行备份数据库&quot;</span></span><br><span class="line">   <span class="comment">#./backup.sh</span></span><br><span class="line">   ;;</span><br><span class="line">2)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;清理日志&quot;</span></span><br><span class="line">   ;;</span><br><span class="line">3)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;软件升级&quot;</span></span><br><span class="line">   ;;</span><br><span class="line">4)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;软件回滚&quot;</span></span><br><span class="line">   ;;</span><br><span class="line">5)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;删库跑路&quot;</span></span><br><span class="line">   ;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;INPUT FALSE!&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><h3 id="循环执行介绍"><a href="#循环执行介绍" class="headerlink" title="循环执行介绍"></a>循环执行介绍</h3><p>将某代码段重复运行多次，通常有进入循环的条件和退出循环的条件 </p>
<p>重复运行次数 </p>
<ul>
<li>循环次数事先已知 </li>
<li>循环次数事先未知</li>
</ul>
<p>常见的循环的命令：for, while, until </p>
<p>程序先进行语句判断，如真则执行循环语句，然后再进行语句判断，直至语句判断失败才跳出；</p>
<p><img src="../../../../images/SRE/day07/13.png" alt="13"></p>
<h3 id="循环-for"><a href="#循环-for" class="headerlink" title="循环 for"></a>循环 for</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CentOS7的for帮助比CentOS8全面</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#help for</span></span><br><span class="line"><span class="keyword">for</span>: <span class="keyword">for</span> NAME [<span class="keyword">in</span> WORDS ... ] ; <span class="keyword">do</span> COMMANDS; <span class="keyword">done</span></span><br><span class="line">   Execute commands <span class="keyword">for</span> each member <span class="keyword">in</span> a list.</span><br><span class="line">    </span><br><span class="line">   The `<span class="keyword">for</span><span class="string">&#x27; loop executes a sequence of commands for each member in a</span></span><br><span class="line"><span class="string">   list of items. If `in WORDS ...;&#x27;</span> is not present, <span class="keyword">then</span> `<span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span><span class="string">&#x27; is</span></span><br><span class="line"><span class="string">   assumed. For each element in WORDS, NAME is set to that element, and</span></span><br><span class="line"><span class="string">   the COMMANDS are executed.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">   Exit Status:</span></span><br><span class="line"><span class="string">   Returns the status of the last command executed.</span></span><br><span class="line"><span class="string">for ((: for (( exp1; exp2; exp3 )); do COMMANDS; done</span></span><br><span class="line"><span class="string">   Arithmetic for loop.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">   Equivalent to</span></span><br><span class="line"><span class="string">   (( EXP1 ))</span></span><br><span class="line"><span class="string">   while (( EXP2 )); do</span></span><br><span class="line"><span class="string">   COMMANDS</span></span><br><span class="line"><span class="string">   (( EXP3 ))</span></span><br><span class="line"><span class="string">   done</span></span><br><span class="line"><span class="string">   EXP1, EXP2, and EXP3 are arithmetic expressions. If any expression is</span></span><br><span class="line"><span class="string">   omitted, it behaves as if it evaluates to 1.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">   Exit Status:</span></span><br><span class="line"><span class="string">   Returns the status of the last command executed.</span></span><br></pre></td></tr></table></figure>

<p><strong>格式1：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> NAME [<span class="keyword">in</span> WORDS ... ] ; <span class="keyword">do</span> COMMANDS; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式1</span></span><br><span class="line"><span class="keyword">for</span> 变量名  <span class="keyword">in</span> 列表;<span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2</span></span><br><span class="line"><span class="keyword">for</span> 变量名  <span class="keyword">in</span> 列表</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><strong>执行机制：</strong> </p>
<ul>
<li>依次将列表中的元素赋值给“变量名”; 每次赋值后即执行一次循环体; 直到列表中的元素耗尽，循环结束 </li>
<li>如果省略 [in WORDS … ] ，此时使用位置参数变量 in “$@”</li>
</ul>
<p><strong>for 循环列表生成方式：</strong> </p>
<ul>
<li>直接给出列表 </li>
<li>整数列表：如 {start..end} </li>
<li>返回列表的命令：如 $(COMMAND) </li>
<li>使用glob，如：*.sh </li>
<li>变量引用，如：$@，$*，$#</li>
</ul>
<p>范例：面试题，计算1+2+3+…+100 的结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># sum=0;for i in &#123;1..100&#125;;do let sum+=i;done ;echo $sum</span></span><br><span class="line"><span class="built_in">sum</span>=5050</span><br><span class="line">[root@centos8 ~]<span class="comment"># seq -s+ 100|bc</span></span><br><span class="line">5050</span><br><span class="line">[root@centos8 ~]<span class="comment"># echo &#123;1..100&#125;|tr &#x27; &#x27; +|bc</span></span><br><span class="line">5050</span><br><span class="line">[root@centos8 ~]<span class="comment"># seq 100|paste -sd +|bc</span></span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<p>范例: 100以内的奇数之和</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># sum=0;for i in &#123;1..100..2&#125;;do let sum+=i;done;echo sum=$sum</span></span><br><span class="line"><span class="built_in">sum</span>=2500</span><br><span class="line">[root@centos8 ~]<span class="comment"># seq -s+ 1 2 100| bc</span></span><br><span class="line">2500</span><br><span class="line">[root@centos8 ~]<span class="comment"># echo &#123;1..100..2&#125;|tr &#x27; &#x27; + | bc</span></span><br><span class="line">2500</span><br></pre></td></tr></table></figure>

<p>范例：从变量中获取列表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat /data/scripts/for_sum.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $* ; <span class="keyword">do</span></span><br><span class="line">   <span class="built_in">let</span> <span class="built_in">sum</span>+=i</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">sum</span>=<span class="variable">$sum</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment"># bash /data/scripts/for_sum.sh 1 2 3 4 5 6</span></span><br><span class="line"><span class="built_in">sum</span>=21</span><br></pre></td></tr></table></figure>

<p>范例: 批量创建用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># cat createuser.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ <span class="variable">$#</span> -eq 0 ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;Usage: createuser.sh USERNAME ...&quot;</span> ;<span class="built_in">exit</span> 1 ; &#125; </span><br><span class="line"><span class="keyword">for</span> user ;<span class="keyword">do</span></span><br><span class="line">   <span class="built_in">id</span> <span class="variable">$user</span> &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="variable">$user</span> is exist || &#123; useradd <span class="variable">$user</span> ; <span class="built_in">echo</span> <span class="variable">$user</span> is created; &#125;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例: 批量创建用户和并设置随机密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 script]<span class="comment">#cat user_for.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;;<span class="keyword">do</span></span><br><span class="line">   useradd user<span class="variable">$i</span></span><br><span class="line">    PASS=`<span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc <span class="string">&#x27;[:alnum:]&#x27;</span> |<span class="built_in">head</span> -c12`</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$PASS</span> | passwd --stdin user<span class="variable">$i</span> &amp;&gt; /dev/null </span><br><span class="line">    <span class="built_in">echo</span> user<span class="variable">$i</span>:<span class="variable">$PASS</span> &gt;&gt; /data/user.log</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;user<span class="variable">$i</span> is created&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例: 九九乘法表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..9&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> `<span class="built_in">seq</span> <span class="variable">$i</span>`;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;j&#125;</span> * <span class="variable">$&#123;i&#125;</span>=$[j*i]\t\c&quot;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> &#123;1..9&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> <span class="variable">$j</span>`;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;$[RANDOM%7+31]m<span class="variable">$&#123;i&#125;</span>x<span class="variable">$&#123;j&#125;</span>=$[i*j]\E[0m\t\c&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例: 倒状的九九乘法表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..9&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> $(<span class="built_in">seq</span> `<span class="built_in">echo</span> $[10-<span class="variable">$i</span>]`);<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;<span class="variable">$&#123;j&#125;</span>x`echo $[10-i]`=<span class="subst">$(((10-i)</span>*j))\t&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>生产案例：将指定目录下的文件所有文件的后缀改名为 bak 后缀</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DIR=/data/test</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$DIR</span> || &#123;  <span class="built_in">echo</span> 无法进入 <span class="variable">$DIR</span>;<span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="keyword">for</span> FILE <span class="keyword">in</span> * ;<span class="keyword">do</span></span><br><span class="line">PRE=`<span class="built_in">echo</span> <span class="variable">$FILE</span>|grep -Eo <span class="string">&quot;.*\.&quot;</span>`</span><br><span class="line">    <span class="built_in">mv</span> <span class="variable">$FILE</span> <span class="variable">$&#123;PRE&#125;</span>bak</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例：M37期面试题，要求将目录YYYY-MM-DD/中所有文件，移动到YYYY-MM/DD/下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.创建YYYY-MM-DD格式的目录，当前日期一年前365天到目前共365个目录，里面有10个文件.log后缀的文件</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#cat for_dir.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">PDIR=/data/test</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..365&#125;;<span class="keyword">do</span> </span><br><span class="line">  DIR=`<span class="built_in">date</span> -d <span class="string">&quot;-<span class="variable">$i</span> day&quot;</span> +%F`</span><br><span class="line">  <span class="built_in">mkdir</span> -pv <span class="variable">$PDIR</span>/<span class="variable">$DIR</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$PDIR</span>/<span class="variable">$DIR</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;1..10&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">touch</span> <span class="variable">$RANDOM</span>.<span class="built_in">log</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.将上面的目录移动到YYYY-MM/DD/下  </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">DIR=/data/test</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$DIR</span> || &#123;  <span class="built_in">echo</span> 无法进入 <span class="variable">$DIR</span>;<span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="keyword">for</span> subdir <span class="keyword">in</span> * ;<span class="keyword">do</span> </span><br><span class="line">  YYYY_MM=`<span class="built_in">echo</span> <span class="variable">$subdir</span> |<span class="built_in">cut</span> -d<span class="string">&quot;-&quot;</span> -f1,2`</span><br><span class="line">  DD=`<span class="built_in">echo</span> <span class="variable">$subdir</span> |<span class="built_in">cut</span> -d<span class="string">&quot;-&quot;</span> -f3`</span><br><span class="line">  [ -d <span class="variable">$YYYY_MM</span>/<span class="variable">$DD</span> ] || <span class="built_in">mkdir</span> -p <span class="variable">$YYYY_MM</span>/<span class="variable">$DD</span> &amp;&gt; /dev/null</span><br><span class="line">  <span class="built_in">mv</span> <span class="variable">$subdir</span>/*   <span class="variable">$YYYY_MM</span>/<span class="variable">$DD</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$DIR</span>/*-*-*</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>面试题：扫描一个网段：192.168.1.0/24，判断此网段中主机在线状态，将在线的主机的IP打印出来</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">NET=192.168.1</span><br><span class="line"><span class="keyword">for</span> ID <span class="keyword">in</span> &#123;1..254&#125;; <span class="keyword">do</span></span><br><span class="line">   &#123;</span><br><span class="line">        ping -c1 -w1 <span class="variable">$NET</span>.<span class="variable">$ID</span> &amp;&gt;/dev/null &amp;&amp; <span class="built_in">echo</span> <span class="variable">$NET</span>.<span class="variable">$ID</span> is up | <span class="built_in">tee</span> -a host_list.log || <span class="built_in">echo</span> <span class="variable">$NET</span>.<span class="variable">$ID</span> is down </span><br><span class="line">   &#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br></pre></td></tr></table></figure>

<p>M47期面试题</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有若干只兔和鸡，兔和鸡加起来一共有100条腿，请写一个简单的shell算出兔和鸡各多少只可能组合(假设所有的鸡和兔子的腿都是健全的，且兔和鸡至少为1只)</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#暴力解法，无优化，硬循环，循环 10000次</span></span><br><span class="line">count=0</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> &#123;1..100&#125;;<span class="keyword">do</span></span><br><span class="line">               <span class="built_in">let</span> count++</span><br><span class="line">                <span class="keyword">if</span> [ $[4*x + 2*y] -eq 100 ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;小白兔=&quot;</span><span class="variable">$x</span><span class="string">&quot;; 小鸡=&quot;</span><span class="variable">$y</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;循环次数: &quot;</span> <span class="variable">$count</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加break,在满足条件的情况下，退出里层循环，减少循环次数</span></span><br><span class="line"><span class="comment">#在小白兔的数量确定的情况下，则小鸡的数量肯定也是只有一个值能满足，所以条件成立就可以直接退出</span></span><br><span class="line">count=0</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> &#123;1..100&#125;;<span class="keyword">do</span></span><br><span class="line">               <span class="built_in">let</span> count++</span><br><span class="line">                <span class="keyword">if</span> [ $[4*x + 2*y] -eq 100 ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;小白兔=&quot;</span><span class="variable">$x</span><span class="string">&quot;; 小鸡=&quot;</span><span class="variable">$y</span></span><br><span class="line">                       <span class="built_in">break</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;循环次数: &quot;</span> <span class="variable">$count</span></span><br><span class="line"><span class="comment">#接着优化</span></span><br><span class="line"><span class="comment">#总共100条腿</span></span><br><span class="line"><span class="comment">#一只小白兔4条腿，一只小鸡2条腿，所以，最多25只小白兔，最多50只小鸡</span></span><br><span class="line">count=0</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> &#123;1..24&#125;; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> &#123;1..48&#125;;<span class="keyword">do</span></span><br><span class="line">               <span class="built_in">let</span> count++</span><br><span class="line">                <span class="keyword">if</span> [ $[4*x + 2*y] -eq 100 ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;小白兔=&quot;</span><span class="variable">$x</span><span class="string">&quot;; 小鸡=&quot;</span><span class="variable">$y</span></span><br><span class="line">                       <span class="built_in">break</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;循环次数: &quot;</span> <span class="variable">$count</span></span><br></pre></td></tr></table></figure>

<p><strong>格式2</strong> </p>
<p>双小括号方法，即((…))格式，也可以用于算术运算，双小括号方法也可以使bash Shell实现C语言风格的 </p>
<p>变量操作:</p>
<p><img src="../../../../images/SRE/day07/14.png" alt="14"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (( exp1; exp2; exp3 )); <span class="keyword">do</span> COMMANDS; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((控制变量初始化;条件判断表达式;控制变量的修正表达式))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>说明： </p>
<ul>
<li>控制变量初始化：仅在运行到循环代码段时执行一次 </li>
<li>控制变量的修正表达式：每轮循环结束会先进行控制变量修正运算，而后再做条件判断</li>
</ul>
<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span>((sum=<span class="number">0</span>,i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++));<span class="keyword">do</span>                       </span><br><span class="line">       <span class="built_in">let</span> <span class="built_in">sum</span>+=i</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">sum</span>=<span class="variable">$sum</span></span><br><span class="line"><span class="keyword">for</span>((sum=<span class="number">0</span>,i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;sum+=i,i++));<span class="keyword">do</span></span><br><span class="line"> <span class="literal">true</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">sum</span>=<span class="variable">$sum</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@ubuntu1804 ~]<span class="comment">#bash sum.sh</span></span><br><span class="line"><span class="built_in">sum</span>=5050</span><br><span class="line"><span class="built_in">sum</span>=5050</span><br></pre></td></tr></table></figure>

<p>范例:九九乘法表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法1实现</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..9&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> `<span class="built_in">seq</span> <span class="variable">$i</span>`;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;j&#125;</span>x<span class="variable">$i</span>=<span class="subst">$((j*i)</span>)\t\c&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#语法2实现</span></span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">1</span>;i&lt;<span class="number">10</span>;i++));<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span>((j=<span class="number">1</span>;j&lt;=i;j++));<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;j&#125;</span>x<span class="variable">$i</span>=<span class="subst">$((j*i)</span>)\t\c&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例：等腰三角形</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入三角形的行数: &quot;</span> line</span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">1</span>;i&lt;=line;i++));<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span>((k=<span class="number">0</span>;k&lt;=line-i;k++));<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27; \c&#x27;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">for</span>((j=<span class="number">1</span>;j&lt;=<span class="number">2</span>*i-<span class="number">1</span>;j++));<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&#x27;*\c&#x27;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@centos8 scripts]<span class="comment">#bash for_triangle.sh</span></span><br><span class="line">请输入三角形的行数: 10</span><br><span class="line">         *</span><br><span class="line">        ***</span><br><span class="line">       *****</span><br><span class="line">      *******</span><br><span class="line">     *********</span><br><span class="line">    ***********</span><br><span class="line">   *************</span><br><span class="line">  ***************</span><br><span class="line"> *****************</span><br><span class="line">*******************</span><br></pre></td></tr></table></figure>

<p>范例：生成进度</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]<span class="comment"># for ((i = 0; i &lt;= 100; ++i)); do printf &quot;\e[4D%3d%%&quot; $i;sleep 0.1s; done</span></span><br><span class="line">100%[root@rocky8 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<h3 id="循环-while"><a href="#循环-while" class="headerlink" title="循环 while"></a>循环 while</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> COMMANDS; <span class="keyword">do</span> COMMANDS; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> CONDITION; <span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> CONDITION</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>说明： </p>
<p>CONDITION：循环控制条件；进入循环之前，先做一次判断；每一次循环之后会再次做判断；条件为 “true”，则执行一次循环；直到条件测试状态为“false”终止循环，因此：CONDTION一般应该有循环控 制变量；而此变量的值会在循环体不断地被修正 </p>
<p>进入条件：CONDITION为 true  </p>
<p>退出条件：CONDITION为 false</p>
<p><strong>无限循环</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> : ; <span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># sum=0;i=1;while ((i&lt;=100));do let sum+=i;let i++;done;echo $sum</span></span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置发邮件的邮箱</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#cat .mailrc </span></span><br><span class="line"><span class="built_in">set</span> from=29308620@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp=smtp.qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-user=29308620@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-password=esvnhbnqocirbicf</span><br><span class="line"><span class="built_in">set</span> smtp-auth=login</span><br><span class="line"><span class="built_in">set</span> ssl-verify=ignore</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#cat while_diskcheck.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">WARNING=80</span><br><span class="line"><span class="keyword">while</span> :;<span class="keyword">do</span></span><br><span class="line">   USE=`<span class="built_in">df</span> | sed -rn <span class="string">&#x27;/^\/dev\/sd/s#.* ([0-9]+)%.*#\1#p&#x27;</span> |<span class="built_in">sort</span> -nr|<span class="built_in">head</span> -n1`</span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$USE</span> -gt <span class="variable">$WARNING</span> ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> Disk will be full from `hostname -I` | mail  -s <span class="string">&quot;disk warning&quot;</span> 29308620@qq.com</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   <span class="built_in">sleep</span> 10</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例: 国际象棋棋盘</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">flag=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..8&#125;;<span class="keyword">do</span></span><br><span class="line">  flag=$[<span class="variable">$i</span>%2]</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;1..8&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ $[<span class="variable">$j</span>%2] = <span class="variable">$flag</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[41m \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[43m \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">flag=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..8&#125;;<span class="keyword">do</span></span><br><span class="line">  flag=$[<span class="variable">$i</span>%2]</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;1..8&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ $[<span class="variable">$j</span>%2] = <span class="variable">$flag</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[41m     \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[43m     \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;1..8&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ $[<span class="variable">$j</span>%2] = <span class="variable">$flag</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[41m     \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[43m     \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;1..8&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ $[<span class="variable">$j</span>%2] = <span class="variable">$flag</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[41m     \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\033[43m     \033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="while-特殊用法-while-read"><a href="#while-特殊用法-while-read" class="headerlink" title="while 特殊用法 while read"></a>while 特殊用法 while read</h3><p>while 循环的特殊用法，遍历文件或文本的每一行 </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span> &lt; /PATH/FROM/SOMEFILE</span><br></pre></td></tr></table></figure>

<p>说明：依次读取/PATH/FROM/SOMEFILE文件中的每一行，且将行赋值给变量line</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#echo magedu | read X ; echo $X</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#echo magedu | while read X ; do echo $X;done</span></span><br><span class="line">magedu</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#echo magedu | &#123; read X ; echo $X; &#125;</span></span><br><span class="line">magedu</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#echo magedu | ( read X ; echo $X )</span></span><br><span class="line">magedu</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#echo mage wang zhang | ( read X Y Z; echo $X $Y $Z )</span></span><br><span class="line">mage wang zhang</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#echo mage wang zhang | while read X Y Z; do echo $X $Y $Z;done</span></span><br><span class="line">mage wang zhang</span><br></pre></td></tr></table></figure>

<p>范例：检测网站是否可以访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat url.txt </span></span><br><span class="line">http://www.baidu.com</span><br><span class="line">http://www.google.com</span><br><span class="line">http://www.facebook.com</span><br><span class="line">http://www.jd.com</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat check_url.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> url;<span class="keyword">do</span></span><br><span class="line"> curl <span class="variable">$url</span> &amp;&gt; /dev/null || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$url</span> fail&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; url.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#管道写法</span></span><br><span class="line"><span class="built_in">cat</span> url.txt | <span class="keyword">while</span> <span class="built_in">read</span> url;<span class="keyword">do</span></span><br><span class="line"> curl <span class="variable">$url</span> &amp;&gt; /dev/null || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$url</span> fail&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例：查看/sbin/nologin的shell类型的用户名和UID</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat nologin.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span></span><br><span class="line"> <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$line</span>&quot;</span> =~ /sbin/nologin$ ]];<span class="keyword">then</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$line</span> | <span class="built_in">cut</span> -d<span class="string">&quot;:&quot;</span> -f1,3</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; /etc/passwd</span><br></pre></td></tr></table></figure>

<h3 id="循环-until"><a href="#循环-until" class="headerlink" title="循环 until"></a>循环 until</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">until CONDITION; <span class="keyword">do</span> COMMANDS; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">until CONDITION; <span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>说明： </p>
<p>进入条件： CONDITION 为false  </p>
<p>退出条件： CONDITION 为true</p>
<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#sum=0;i=1;until ((i&gt;100));do let sum+=i;let i++;done;echo $sum</span></span><br><span class="line">5050</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># sum=0;i=1;until ! ((i&lt;=100));do let sum+=i;let i++;done;echo $sum</span></span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<p><strong>无限循环</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">until <span class="literal">false</span>; <span class="keyword">do</span></span><br><span class="line">  循环体</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<h3 id="循环控制语句-continue"><a href="#循环控制语句-continue" class="headerlink" title="循环控制语句 continue"></a>循环控制语句 continue</h3><p>continue [N]：提前结束第N层的本轮循环，而直接进入下一轮判断；最内层为第1层 </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> CONDITION1; <span class="keyword">do</span></span><br><span class="line"> CMD1</span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">if</span> CONDITION2; <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">continue</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line">   CMDn</span><br><span class="line">   ...</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># for i in &#123;1..5&#125;;do [ $i -eq 3 ] &amp;&amp; continue;echo $i;done</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@rocky86 0821]<span class="comment"># for i in &#123;1..5&#125;;do if [ $i -eq 3 ];then continue;fi; echo $i;done</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<p>范例：循环嵌套中的continue</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat continue_for.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..4&#125;; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;a..c&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$j</span> = <span class="string">&#x27;b&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span> <span class="variable">$j</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash continue_for.sh</span></span><br><span class="line">1 a</span><br><span class="line">1 c</span><br><span class="line">2 a</span><br><span class="line">2 c</span><br><span class="line">3 a</span><br><span class="line">3 c</span><br><span class="line">4 a</span><br><span class="line">4 c</span><br></pre></td></tr></table></figure>

<p>continue 2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat continue_for.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..4&#125;; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;a..c&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$j</span> = <span class="string">&#x27;b&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">continue</span> 2</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span> <span class="variable">$j</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash continue_for.sh</span></span><br><span class="line">1 a</span><br><span class="line">2 a</span><br><span class="line">3 a</span><br><span class="line">4 a</span><br></pre></td></tr></table></figure>

<h3 id="循环控制语句-break"><a href="#循环控制语句-break" class="headerlink" title="循环控制语句 break"></a>循环控制语句 break</h3><p>break [N]：提前结束第N层整个循环，最内层为第1层 </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> CONDITION1; <span class="keyword">do</span></span><br><span class="line">  CMD1</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> CONDITION2; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">    CMDn</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># for i in &#123;1..5&#125;;do [ $i -eq 3 ] &amp;&amp; break;echo $i;done</span></span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>范例：嵌套循环中的break</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat break_for.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..4&#125;; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;a..c&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$j</span> = <span class="string">&#x27;b&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span> <span class="variable">$j</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash break_for.sh </span></span><br><span class="line">1 a</span><br><span class="line">2 a</span><br><span class="line">3 a</span><br><span class="line">4 a</span><br></pre></td></tr></table></figure>

<p>break 2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat break_for.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..4&#125;; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;a..c&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$j</span> = <span class="string">&#x27;b&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">break</span> 2</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span> <span class="variable">$j</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash break_for.sh</span></span><br><span class="line">1 a</span><br></pre></td></tr></table></figure>

<p>范例：猜字游戏</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat guess.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">NUM=$[RANDOM%10]</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -p <span class="string">&quot;输入 0-9 之间的数字: &quot;</span> INPUT ;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$INPUT</span> -eq <span class="variable">$NUM</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;恭喜你猜对了!&quot;</span></span><br><span class="line">      <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$INPUT</span> -gt <span class="variable">$NUM</span> ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;数字太大了,重新猜!&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;数字太小了,重新猜!&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="循环控制-shift-命令"><a href="#循环控制-shift-命令" class="headerlink" title="循环控制 shift 命令"></a>循环控制 shift 命令</h3><p>shift [n] 用于将参量列表 list 左移指定次数，缺省为左移一次。 </p>
<p>参量列表 list 一旦被移动，最左端的那个参数就从列表中删除。while 循环遍历位置参量列表时，常用到 shift </p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat shift.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">until [ -z <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span> &quot;</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash s.sh a b c d e f g</span></span><br><span class="line">a b c d e f g </span><br><span class="line">b c d e f g </span><br><span class="line">c d e f g </span><br><span class="line">d e f g </span><br><span class="line">e f g </span><br><span class="line">f g </span><br><span class="line">g </span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat shift.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ];<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash shift.sh a b c d</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br></pre></td></tr></table></figure>

<p>shift 2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat shift2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ];<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">  <span class="built_in">shift</span> 2</span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash shift2.sh 1 2 3 4 5 6</span></span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<p>范例：批量创建用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat shift_users.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: `basename <span class="variable">$0</span>` user1 user2 ...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ];<span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">id</span> <span class="variable">$1</span> &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$1</span> is exist</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">           useradd <span class="variable">$1</span></span><br><span class="line">           <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is created&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">       <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All user is created&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="循环与菜单-select"><a href="#循环与菜单-select" class="headerlink" title="循环与菜单 select"></a>循环与菜单 select</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select NAME [<span class="keyword">in</span> WORDS ... ;] <span class="keyword">do</span> COMMANDS; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">select NAME <span class="keyword">in</span> list ;<span class="keyword">do</span> </span><br><span class="line">  循环体命令</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>说明： </p>
<ul>
<li>select 循环主要用于创建菜单，按数字顺序排列的菜单项显示在标准错误上，并显示 PS3 提示符， 等待用户输入 </li>
<li>用户输入菜单列表中的某个数字，执行相应的命令 </li>
<li>用户输入菜单列表中的某个数字，会将对应的WORD值赋值给NAME变量 </li>
<li>用户输入被保存在内置变量 REPLY 中 </li>
<li>select 是个无限循环，因此要用 break 命令退出循环，或用 exit 命令终止脚本。也可以按 ctrl+c 退出循环 </li>
<li>select 经常和 case 联合使用 </li>
<li>与 for 循环类似，可以省略 in list，此时使用位置参量</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># PS3=&quot;中午吃什么: &quot;; select i in 肯德基 麦当劳 沙县小吃 兰州拉面; do echo $i;done </span></span><br><span class="line">1) 肯德基</span><br><span class="line">2) 麦当劳</span><br><span class="line">3) 沙县小吃</span><br><span class="line">4) 兰州拉面</span><br><span class="line">中午吃什么: 1</span><br><span class="line">肯德基</span><br><span class="line">中午吃什么: 2</span><br><span class="line">麦当劳</span><br><span class="line">中午吃什么: 100</span><br><span class="line"></span><br><span class="line">中午吃什么:</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat select.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">PS3=<span class="string">&quot;请选择: &quot;</span></span><br><span class="line">select i <span class="keyword">in</span> 备份数据库 清理日志 重启服务 退出; <span class="keyword">do</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">1)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;开始备份数据库...&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;数据库备份完成&quot;</span></span><br><span class="line">  ;;</span><br><span class="line">2)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;开始清理日志...&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;清理完成&quot;</span></span><br><span class="line">  ;;</span><br><span class="line">3) </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;开始重启服务...&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;重启完成&quot;</span></span><br><span class="line">  ;;</span><br><span class="line">4)</span><br><span class="line">  <span class="built_in">break</span></span><br><span class="line">  ;;</span><br><span class="line">*)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;选项错误&quot;</span></span><br><span class="line">  ;; </span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="函数-function"><a href="#函数-function" class="headerlink" title="函数 function"></a>函数 function</h1><h2 id="函数介绍"><a href="#函数介绍" class="headerlink" title="函数介绍"></a>函数介绍</h2><p>函数 function </p>
<p>是由若干条shell命令组成的语句块，实现代码重用和模块化编程 </p>
<p>它与shell程序形式上是相似的，不同的是它不是一个单独的进程，不能独立运行，而是shell程序的一部 分</p>
<p>函数和shell程序区别 </p>
<ul>
<li>Shell程序在子Shell中运行 </li>
<li>函数在当前Shell中运行。因此在当前Shell中，函数可对shell中变量进行修改</li>
</ul>
<h2 id="管理函数"><a href="#管理函数" class="headerlink" title="管理函数"></a>管理函数</h2><p>函数由两部分组成：函数名和函数体 </p>
<p>查看帮助</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># help function</span></span><br><span class="line">......</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h3 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法一</span></span><br><span class="line"><span class="function"><span class="title">func_name</span></span>()&#123;</span><br><span class="line"> ...函数体...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#语法二</span></span><br><span class="line"><span class="keyword">function</span> func_name &#123;</span><br><span class="line"> ...函数体...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#语法三</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">func_name</span></span>()&#123;</span><br><span class="line"> ...函数体...</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="查看函数"><a href="#查看函数" class="headerlink" title="查看函数"></a>查看函数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前已定义的函数名</span></span><br><span class="line"><span class="built_in">declare</span> -F</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前已定义的函数定义</span></span><br><span class="line"><span class="built_in">declare</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看指定当前已定义的函数名</span></span><br><span class="line"><span class="built_in">declare</span> -f func_name </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前已定义的函数名定义</span></span><br><span class="line"><span class="built_in">declare</span> -F func_name</span><br></pre></td></tr></table></figure>

<h3 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> func_name</span><br></pre></td></tr></table></figure>

<h2 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h2><p>函数的调用方式 </p>
<ul>
<li>可在交互式环境下定义函数 </li>
<li>可将函数放在脚本文件中作为它的一部分</li>
<li>可放在只包含函数的单独文件中</li>
</ul>
<p>调用：函数只有被调用才会执行，通过给定函数名调用函数，函数名出现的地方，会被自动替换为函数代码 </p>
<p>函数的生命周期：被调用时创建，返回时终止</p>
<h3 id="交互式环境调用函数"><a href="#交互式环境调用函数" class="headerlink" title="交互式环境调用函数"></a>交互式环境调用函数</h3><p>交互式环境下定义和使用函数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># test_func()&#123;</span></span><br><span class="line">&gt; <span class="built_in">echo</span> <span class="string">&quot;this is cli function&quot;</span></span><br><span class="line">&gt; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># test_func</span></span><br><span class="line">this is cli <span class="keyword">function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -f test_func</span></span><br><span class="line"><span class="function"><span class="title">test_func</span></span> () </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;this is cli function&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在脚本中定义及使用函数"><a href="#在脚本中定义及使用函数" class="headerlink" title="在脚本中定义及使用函数"></a>在脚本中定义及使用函数</h3><p>函数在使用前必须定义，因此应将函数定义放在脚本开始部分，直至shell首次发现它后才能使用，调用函数仅使用其函数名即可 </p>
<p>范例：在脚本中使用函数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat func1.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#函数定义</span></span><br><span class="line"><span class="function"><span class="title">hello</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;this is test function - hello&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一次调用</span></span><br><span class="line">hello</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二次调用</span></span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>范例：函数调用函数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat func2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">func1</span></span>()&#123;</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;func1&quot;</span></span><br><span class="line">   func2</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">func2</span></span>()&#123;</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;func2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">func1</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash func2.sh</span></span><br><span class="line">func1</span><br><span class="line">func2</span><br></pre></td></tr></table></figure>

<p>范例：函数间互相调用，死循环，爆栈，耗尽资源，高级语言会有此错误检测</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat func2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">func1</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;func1&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line">  func2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">func2</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;func2&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line">  func1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func1</span><br></pre></td></tr></table></figure>

<h3 id="使用函数文件"><a href="#使用函数文件" class="headerlink" title="使用函数文件"></a>使用函数文件</h3><p>可以将经常使用的函数存入一个单独的函数文件，然后将函数文件载入shell，再进行调用函数 </p>
<p>函数文件名可任意选取，但最好与相关任务有某种联系，例如：functions  </p>
<p>一旦函数文件载入shell，就可以在命令行或脚本中调用函数。 </p>
<p>可以使用delcare -f 或set 命令查看所有定 义的函数，其输出列表包括已经载入shell的所有函数 </p>
<p>若要改动函数，首先用unset命令从shell中删除函数。改动完毕后，再重新载入此文件</p>
<p>实现函数文件的过程： </p>
<ol>
<li>创建函数文件，只存放函数的定义  </li>
<li>在shell脚本或交互式shell中加载函数文件 </li>
<li>调用函数</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义函数文件</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat functions</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">func1</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;functions-func1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">func2</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;functions-func2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令行引入</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># . functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这种写法也可以</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># source functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#函数调用</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># func1;func2</span></span><br><span class="line">functions-func1</span><br><span class="line">functions-func2</span><br><span class="line"></span><br><span class="line"><span class="comment">#脚本文件中引用</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># cat func3.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">. <span class="built_in">functions</span></span><br><span class="line">func1</span><br><span class="line">func2</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash func3.sh</span></span><br><span class="line">functions-func1</span><br><span class="line">functions-func2</span><br></pre></td></tr></table></figure>

<h2 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h2><p>函数默认返回值是函数体中最后一条命令的退出状态码； </p>
<p>也可以使用return 自定义函数的返回值，在函数中使用 return，return 之后的语句将不会被执行</p>
<p>return 的用法：</p>
<table>
<thead>
<tr>
<th>return语句</th>
<th>返回值</th>
</tr>
</thead>
<tbody><tr>
<td>return</td>
<td>由return语句的前一行命令执行结果决定</td>
</tr>
<tr>
<td>return 0</td>
<td>无错误返回</td>
</tr>
<tr>
<td>return 1-255</td>
<td>有错误返回</td>
</tr>
</tbody></table>
<p>范例：获取函数返回值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat var4.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">var_func1</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func1 =======&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#默认返回值</span></span><br><span class="line"><span class="function"><span class="title">var_func2</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func2 =======&quot;</span></span><br><span class="line"> <span class="built_in">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">var_func3</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func3 ======&quot;</span></span><br><span class="line"> errcmd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义返回值，return 之后的语句将不会被执行</span></span><br><span class="line"><span class="function"><span class="title">var_func4</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func4 aaaaaaaaaaaaaa&quot;</span></span><br><span class="line"> <span class="built_in">return</span> 123</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func4 bbbbbbbbbb&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var_func1</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;func1 返回值是 $?\n&quot;</span></span><br><span class="line"></span><br><span class="line">var_func2</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;func2 返回值是 $?\n&quot;</span></span><br><span class="line"></span><br><span class="line">var_func3</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;func3 返回值是 $?\n&quot;</span></span><br><span class="line"></span><br><span class="line">var_func4</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;func4 返回值是 $?\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 0820]<span class="comment"># bash var4.sh</span></span><br><span class="line">func1 =======</span><br><span class="line">func1 返回值是 0</span><br><span class="line"></span><br><span class="line">func2 =======</span><br><span class="line">func2 返回值是 0</span><br><span class="line"></span><br><span class="line">func3 ======</span><br><span class="line">var4.sh: line 26: errcmd: <span class="built_in">command</span> not found</span><br><span class="line">func3 返回值是 127</span><br><span class="line"></span><br><span class="line">func4 aaaaaaaaaaaaaa</span><br><span class="line">func4 返回值是 123</span><br></pre></td></tr></table></figure>

<p>范例：return 和 exit 的区别 </p>
<p>return 只会中断函数执行，但exit 会中断整个脚本的执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat var5.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">var_func1</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;func1 =======&quot;</span></span><br><span class="line">  <span class="built_in">return</span> 123</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;func1 =======&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 123</span><br><span class="line">var_func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;func1 返回值是 &quot;</span>$?</span><br><span class="line"><span class="built_in">echo</span> 456</span><br><span class="line"></span><br><span class="line">[root@rocky86 0820]<span class="comment"># bash var5.sh</span></span><br><span class="line">123</span><br><span class="line">func1 =======</span><br><span class="line">func1 返回值是 123</span><br><span class="line">456</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat var6.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">var_func1</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;func1 =======&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 123</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;func1 =======&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> 123</span><br><span class="line">var_func1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;func1 返回值是 &quot;</span>$?</span><br><span class="line"><span class="built_in">echo</span> 456</span><br><span class="line"></span><br><span class="line">[root@rocky86 0820]<span class="comment"># bash var6.sh</span></span><br><span class="line">123</span><br><span class="line">func1 =======</span><br><span class="line"></span><br><span class="line">[root@rocky86 0820]<span class="comment"># echo $?</span></span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h2 id="环境函数"><a href="#环境函数" class="headerlink" title="环境函数"></a>环境函数</h2><p>类拟于环境变量，也可以定义环境函数，使子进程也可使用父进程定义的函数 </p>
<p>定义环境函数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> -f function_name </span><br><span class="line"><span class="built_in">declare</span> -xf function_name</span><br></pre></td></tr></table></figure>

<p>查看环境函数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> -f</span><br><span class="line"><span class="built_in">declare</span> -xf</span><br></pre></td></tr></table></figure>

<p>范例：定义和查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cli_func1()&#123; echo &quot;cli-func1&quot;; &#125;; cli_func2()&#123; echo &quot;cli-func2&quot;; &#125;;export -f cli_func2;</span></span><br><span class="line">[root@rocky86 0820]<span class="comment"># export -f</span></span><br><span class="line"><span class="function"><span class="title">cli_func2</span></span> () </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;cli-func2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">declare</span> -fx cli_func2</span><br><span class="line"><span class="function"><span class="title">which</span></span> () </span><br><span class="line">&#123; </span><br><span class="line">   ( <span class="built_in">alias</span>;</span><br><span class="line">   <span class="built_in">eval</span> <span class="variable">$&#123;which_declare&#125;</span> ) | /usr/bin/which --tty-only --read-alias --read-functions --show-tilde --show-dot<span class="variable">$@</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">declare</span> -fx <span class="built_in">which</span></span><br></pre></td></tr></table></figure>

<p>范例：调用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat var7.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;var7 start BASHPID <span class="variable">$BASHPID</span> ====================== &quot;</span></span><br><span class="line">cli_func1</span><br><span class="line">cli_func2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;var7 end ======================&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 0820]<span class="comment"># echo $BASHPID;</span></span><br><span class="line">2259</span><br><span class="line"></span><br><span class="line">[root@rocky86 0820]<span class="comment"># ./var7.sh </span></span><br><span class="line">var7 start BASHPID 5122 ======================</span><br><span class="line">./var7.sh: line 16: cli_func1: <span class="built_in">command</span> not found</span><br><span class="line">cli-func2</span><br><span class="line">var7 end ======================</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h2><p>函数可以接受参数： </p>
<ul>
<li>传递参数给函数：在函数名后面以空白分隔给定参数列表即可，如：testfunc arg1 arg2 …  </li>
<li>在函数体中当中，可使用$1, $2, …调用这些参数；还可以使用$@, $*, $#等特殊变量</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat msg.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">msg</span></span>()&#123;</span><br><span class="line">  <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> -a -n <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;$2m<span class="variable">$1</span>\E[0m&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">msg <span class="string">&quot;ok&quot;</span> 31</span><br><span class="line">msg <span class="string">&quot;fail&quot;</span> 32</span><br><span class="line">msg <span class="string">&quot;FBI-Warning&quot;</span> 34</span><br></pre></td></tr></table></figure>

<h2 id="函数变量"><a href="#函数变量" class="headerlink" title="函数变量"></a>函数变量</h2><p>变量作用域：</p>
<table>
<thead>
<tr>
<th>变量类型</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>普通变量</td>
<td>只有当前shell进程中有效，函数外定义，可以在函数内修改</td>
</tr>
<tr>
<td>环境变量</td>
<td>当前shell和子shell有效</td>
</tr>
<tr>
<td>本地变量</td>
<td>作用域在函数内，函数结束会自动销毁</td>
</tr>
</tbody></table>
<p>在函数中定义本地变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">local</span> NAME=VALUE</span><br></pre></td></tr></table></figure>

<p>示例：普通变量可以在函数中被修改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat functions </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">var_func2</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func2 start ===================&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"> var1=789</span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func2 end =====================&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 0820]<span class="comment"># cat var1.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">. <span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">var1=123</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">var_func1</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func1 start ===================&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"> var1=456</span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func1 end ====================&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line">var_func1</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line">var_func2</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 0820]<span class="comment"># bash var1.sh</span></span><br><span class="line">123</span><br><span class="line">func1 start ===================</span><br><span class="line">123</span><br><span class="line">456</span><br><span class="line">func1 end ====================</span><br><span class="line">456</span><br><span class="line">func2 start ===================</span><br><span class="line">456</span><br><span class="line">789</span><br><span class="line">func2 end =====================</span><br><span class="line">789</span><br></pre></td></tr></table></figure>

<p>示例：本地变量只能在函数内定义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat var2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">local</span> var1=123</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行报错</span></span><br><span class="line">[root@rocky86 0820]<span class="comment"># bash var2.sh</span></span><br><span class="line">var2.sh: line 14: <span class="built_in">local</span>: can only be used <span class="keyword">in</span> a <span class="keyword">function</span></span><br></pre></td></tr></table></figure>

<p>示例：本地变量只作用在函数内</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat var2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">var1=123</span><br><span class="line"><span class="function"><span class="title">var_func1</span></span>()&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func1 start ========================&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"> <span class="built_in">local</span> var1=456</span><br><span class="line"> <span class="built_in">local</span> var2=789</span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$var1</span> <span class="variable">$var2</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;func1 end =========================&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span> <span class="variable">$var2</span></span><br><span class="line">var_func1</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span> <span class="variable">$var2</span></span><br><span class="line"><span class="comment">#执行</span></span><br><span class="line">[root@rocky86 0820]<span class="comment"># bash var2.sh</span></span><br><span class="line">123</span><br><span class="line">func1 start ========================</span><br><span class="line">123</span><br><span class="line">456 789</span><br><span class="line">func1 end =========================</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>示例：环境变量可以传到子进程中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 0820]<span class="comment"># cat var33.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;var33.sh start BASHPID <span class="variable">$BASHPID</span> ==================\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;var1=<span class="variable">$var1</span> var2=<span class="variable">$var2</span> var3=<span class="variable">$var3</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nvar33.sh end =====================================\n&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 0820]<span class="comment"># cat var3.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">var1=123</span><br><span class="line"><span class="built_in">export</span> var2=456</span><br><span class="line"><span class="built_in">declare</span> -x var3=789</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;var3.sh start BASHPID <span class="variable">$BASHPID</span> ============\n\n&quot;</span></span><br><span class="line">bash var33.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;var1=<span class="variable">$var1</span> var2=<span class="variable">$var2</span> var3=<span class="variable">$var3</span>&quot;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 0820]<span class="comment"># bash var3.sh </span></span><br><span class="line">var3.sh start BASHPID 4490 ============</span><br><span class="line"></span><br><span class="line">var33.sh start BASHPID 4491 ==================</span><br><span class="line"></span><br><span class="line">var1= var2=456 var3=789</span><br><span class="line"></span><br><span class="line">var33.sh end =====================================</span><br><span class="line"></span><br><span class="line">var1=123 var2=456 var3=789</span><br></pre></td></tr></table></figure>

<h2 id="函数递归"><a href="#函数递归" class="headerlink" title="函数递归"></a>函数递归</h2><p>函数递归：</p>
<p>函数直接或间接调用自身，注意递归层数，可能会陷入死循环 </p>
<p>递归特点:  </p>
<ul>
<li>函数内部自已调用自已 </li>
<li>必须有结束函数的出口语句，防止死循环</li>
</ul>
<p>范例：无出口递归</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># num=1;cli_func1()&#123; echo &quot;num=&quot;$num; let num++; cli_func1; &#125;;cli_func1</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">num=8587</span><br><span class="line"></span><br><span class="line">Connection closed.</span><br><span class="line"></span><br><span class="line">Disconnected from remote host(rocky86-150) at 11:44:30.</span><br><span class="line"></span><br><span class="line">Type `<span class="built_in">help</span><span class="string">&#x27; to learn how to use Xshell prompt.</span></span><br></pre></td></tr></table></figure>

<p><strong>阶乘</strong></p>
<p>阶乘是基斯顿·卡曼（Christian Kramp，1760～1826）于 1808 年发明的运算符号，是数学术语。 </p>
<p>一个正整数的阶乘（factorial）是所有小于及等于该数的正整数的积，并且0的阶乘为1。自然数n的阶乘写作n!</p>
<p>阶乘公式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n!=1×2×3×...×(n-1)×n</span><br><span class="line">0!=1, n!=(n-1)!×n</span><br></pre></td></tr></table></figure>

<p>用递归实现阶乘</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat fac.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">fac</span></span>()&#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$1</span> -gt 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> $[<span class="variable">$1</span> * $(fac $[<span class="variable">$1</span>-1])]</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fac <span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash fac.sh 5</span></span><br><span class="line">120</span><br></pre></td></tr></table></figure>

<p><strong>斐波拉契数列</strong></p>
<p>斐波那契数列（Fibonacci sequence），又称黄金分割数列，因数学家莱昂纳多·斐波那契（Leonardo Fibonacci）以兔子繁殖为例子而引 入，故又称为“兔子数列”</p>
<p>指的是这样一个数列：1、1、2、3、5、8、13、21、34、…… </p>
<p>在数学上，斐波那契数列以如下被以递推的方法定义</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F(0)=0, F(1)=1, F(n)=F(n - 1)+F(n - 2)(n ≥ 2, n ∈ N*)</span><br></pre></td></tr></table></figure>

<p>用递归求斐波拉契数列第N项的值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat fib.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">fib</span></span>()&#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$1</span> -gt 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> $[ $[ $(fib $[<span class="variable">$1</span>-1]) + $(fib $[<span class="variable">$1</span>-2]) ] ]</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fib <span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<p>循环加递归，求和</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat fib2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">fib</span></span>()&#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$1</span> -gt 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> $[ $(fib $[<span class="variable">$1</span>-1]) + $(fib $[<span class="variable">$1</span>-2]) ]</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">for</span> ((i=<span class="variable">$1</span>;i&lt;=<span class="variable">$2</span>;i++));<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">let</span> <span class="built_in">sum</span>+=$(fib <span class="variable">$i</span>)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash fib2.sh 1 10</span></span><br><span class="line">143</span><br></pre></td></tr></table></figure>

<p>斐波拉契数列递归算法展开</p>
<p><img src="../../../../images/SRE/day07/15.png" alt="15"></p>
<p><strong>逻辑炸弹</strong></p>
<p>fork 炸弹是一种恶意程序，它的内部是一个不断在 fork 进程的无限循环，实质是一个简单的递归程序。 </p>
<p>由于程序是递归的，如果没有任何限制，这会导致这个简单的程序迅速耗尽系统里面的所有资源</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:()&#123; :|:&amp; &#125;;:</span><br><span class="line"><span class="function"><span class="title">bomb</span></span>()&#123; bomb | bomb &amp; &#125;;bomb</span><br></pre></td></tr></table></figure>

<h1 id="其它脚本相关工具"><a href="#其它脚本相关工具" class="headerlink" title="其它脚本相关工具"></a>其它脚本相关工具</h1><h2 id="信号捕捉-trap"><a href="#信号捕捉-trap" class="headerlink" title="信号捕捉 trap"></a>信号捕捉 trap</h2><p>trap 命令可以捕捉信号，修改信号原来的功能，实现自定义功能 </p>
<p>在脚本或程序的执行过程中，我们可以通过发送信号的方式，打断或终止程序的执行过程，为了避免这种情况，我们可以使用信号捕捉，来 自定义信号处理。</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">trap</span> [-lp] [[arg] signal_spec ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-l       <span class="comment">#显示所有信号</span></span><br><span class="line">-p       <span class="comment">#显示所有自定义的信号</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;command&#x27;</span> signal      <span class="comment">#自定义指定信号的处理方式</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;&#x27;</span> signal             <span class="comment">#忽略指定的信号</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;-&#x27;</span> signal            <span class="comment">#恢复信号默认操作</span></span><br><span class="line"><span class="built_in">trap</span> func EXIT             <span class="comment">#退出时执行func</span></span><br></pre></td></tr></table></figure>

<p>查看所有信号：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># trap -l</span></span><br><span class="line">1) SIGHUP 2) SIGINT 3) SIGQUIT 4) SIGILL 5) SIGTRAP</span><br><span class="line">6) SIGABRT 7) SIGBUS 8) SIGFPE 9) SIGKILL 10) SIGUSR1</span><br><span class="line">......</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>信号的三种表示方法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">3) SIGQUIT</span><br><span class="line"></span><br><span class="line">3              <span class="comment">#信号ID</span></span><br><span class="line">SIGQUIT        <span class="comment">#完整写法，大小写都支持</span></span><br><span class="line">QUIT           <span class="comment">#简短写法，大小写都支持</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat trap.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;捕捉到了 ctrl+c信号&#x27;&quot;</span> int</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;捕捉到了 ctrl+\信号&#x27;&quot;</span> quit</span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> -p</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..15&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;&#x27;</span> int</span><br><span class="line"><span class="built_in">trap</span> -p</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;16..30&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;-&#x27;</span> int</span><br><span class="line"><span class="built_in">trap</span> -p</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;31..45&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat trap_fin.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">finish</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;finish at `date +%F-%T`&quot;</span> | <span class="built_in">tee</span> -a /tmp/trap_fin.log</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> finish <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;`date +%F-%T`&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>创建临时文件 mktemp</p>
<p>mktemp 命令用于创建并显示临时文件，可避免冲突 </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mktemp</span> [OPTION]... [TEMPLATE]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-d|--directory                 <span class="comment">#创建目录</span></span><br><span class="line">-u|--dry-run                   <span class="comment">#只输出命令，不执行</span></span><br><span class="line">-p DIR|--tmpdir[=DIR]          <span class="comment">#指明临时文件所存放目录位置</span></span><br><span class="line">-t                             <span class="comment">#将文件保存到$TMPDIR 定义的目录中，如果该变量未定义，则保存到/tmp 目录中</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># mktemp</span></span><br><span class="line">/tmp/tmp.YQXxc3bHdI</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mktemp XXXX</span></span><br><span class="line">UYtW</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果指定了文件名，则后面一定要有X，至少要3个，X会被替换成随机串</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># mktemp test</span></span><br><span class="line"><span class="built_in">mktemp</span>: too few X<span class="string">&#x27;s in template ‘test’</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@rocky86 ~]# mktemp testXXX</span></span><br><span class="line"><span class="string">test19C</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#创建并赋值给变量</span></span><br><span class="line"><span class="string">[root@rocky86 ~]# tmp=`mktemp`</span></span><br><span class="line"><span class="string">[root@rocky86 ~]# echo $tmp</span></span><br><span class="line"><span class="string">/tmp/tmp.wQAdrqn1UR</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#创建目录</span></span><br><span class="line"><span class="string">[root@rocky86 ~]# mktemp -d</span></span><br><span class="line"><span class="string">/tmp/tmp.2iLac1ruHt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@rocky86 ~]# ll /tmp/tmp.2iLac1ruHt/</span></span><br><span class="line"><span class="string">total 0</span></span><br></pre></td></tr></table></figure>

<p>范例：假删除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat trash.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">DIR=`<span class="built_in">mktemp</span> -d /tmp/trash-$(<span class="built_in">date</span> +%F_%H-%M-%S)XXXXXX`</span><br><span class="line"><span class="built_in">mv</span> $* <span class="variable">$DIR</span></span><br><span class="line"><span class="built_in">echo</span> $* is move to <span class="variable">$DIR</span></span><br></pre></td></tr></table></figure>

<h2 id="安装复制文件-install"><a href="#安装复制文件-install" class="headerlink" title="安装复制文件 install"></a>安装复制文件 install</h2><p>install 功能相当于cp，chmod，chown，chgrp ,mkdir 等相关工具的集合 </p>
<p>格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">install [OPTION]... [-T] SOURCE DEST</span><br><span class="line">install [OPTION]... SOURCE... DIRECTORY</span><br><span class="line">install [OPTION]... -t DIRECTORY SOURCE...</span><br><span class="line">install [OPTION]... -d DIRECTORY...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-m|--mode=MODE                <span class="comment">#指定权限，默认755</span></span><br><span class="line">-v|--verbose                  <span class="comment">#显示过程</span></span><br><span class="line">-o|--owner=OWNER              <span class="comment">#指定属主</span></span><br><span class="line">-g|--group=GROUP              <span class="comment">#指定属组</span></span><br><span class="line">-d|--directory DIR            <span class="comment">#指定目录，如果不存在就创建</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果目录不存在，则创建目录，并将权限设成777，如果目录存在，则修改其权限</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># install -m 777 -d testdir</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ll -d testdir</span></span><br><span class="line">drwxrwxrwx. 2 root root 6 May 25 12:46 testdir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#将文件复制到指定目录，并指定属主属组，权限</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># install -m 777 -o mage -g root fin.sh /tmp/fin-tmp.sh</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># ll /tmp/fin-tmp.sh</span></span><br><span class="line">-rwxrwxrwx. 1 mage root 153 May 25 12:58 /tmp/fin-tmp.sh</span><br></pre></td></tr></table></figure>

<h1 id="数组-array"><a href="#数组-array" class="headerlink" title="数组 array"></a>数组 array</h1><h2 id="数组介绍"><a href="#数组介绍" class="headerlink" title="数组介绍"></a>数组介绍</h2><p>变量：存储单个元素的内存空间 </p>
<p>数组：存储多个元素的连续的内存空间，相当于多个变量的集合 </p>
<p>数组名和索引 </p>
<p>索引的编号从0开始，属于数值索引 </p>
<p>索引可支持使用自定义的格式，而不仅是数值格式，即为关联索引，bash 4.0版本之后开始支持 </p>
<p>bash的数组支持稀疏格式（索引不连续）</p>
<h2 id="声明数组"><a href="#声明数组" class="headerlink" title="声明数组"></a>声明数组</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通数组可以不事先声明,直接使用</span></span><br><span class="line"><span class="built_in">declare</span> -a ARRAY_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#关联数组必须先声明,再使用</span></span><br><span class="line"><span class="built_in">declare</span> -A ARRAY_NAME</span><br></pre></td></tr></table></figure>

<p>注意：两者不可相互转换</p>
<h2 id="数组赋值"><a href="#数组赋值" class="headerlink" title="数组赋值"></a>数组赋值</h2><p><strong>一次只赋值一个元素</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARRAY_NAME[INDEX]=VALUE</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># weekdays[0]=&quot;Sunday&quot;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># weekdays[4]=&quot;Thursday&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>一次赋值全部元素</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARRAY_NAME=(<span class="string">&quot;VAL1&quot;</span> <span class="string">&quot;VAL2&quot;</span> <span class="string">&quot;VAL3&quot;</span> ...)</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># title=(&quot;ceo&quot; &quot;coo&quot; &quot;cto&quot;)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># num=(&#123;0..10&#125;)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># alpha=(&#123;a..g&#125;)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># file=( *.sh )</span></span><br></pre></td></tr></table></figure>

<p><strong>只赋值特定元素</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARRAY_NAME=([0]=<span class="string">&quot;VAL1&quot;</span> [3]=<span class="string">&quot;VAL2&quot;</span> ...)</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># weekdays=([0]=&quot;Sunday&quot;,[4]=&quot;Thursday&quot;)</span></span><br></pre></td></tr></table></figure>

<p><strong>交互式数组值对赋值</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -a ARRAY</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># read -a test</span></span><br><span class="line">a b c d</span><br></pre></td></tr></table></figure>

<h2 id="显示所有数组"><a href="#显示所有数组" class="headerlink" title="显示所有数组"></a>显示所有数组</h2><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -a</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># declare -a</span></span><br><span class="line"><span class="built_in">declare</span> -a ARRAY_NAME=([0]=<span class="string">&quot;VALUE&quot;</span>)</span><br><span class="line"><span class="built_in">declare</span> -a BASH_ARGC=()</span><br><span class="line"><span class="built_in">declare</span> -a BASH_ARGV=()</span><br><span class="line"><span class="built_in">declare</span> -a BASH_COMPLETION_VERSINFO=([0]=<span class="string">&quot;2&quot;</span> [1]=<span class="string">&quot;7&quot;</span>)</span><br><span class="line"><span class="built_in">declare</span> -a BASH_LINENO=()</span><br><span class="line"><span class="built_in">declare</span> -ar BASH_REMATCH=()</span><br><span class="line"><span class="built_in">declare</span> -a BASH_SOURCE=()</span><br><span class="line"><span class="built_in">declare</span> -ar BASH_VERSINFO=([0]=<span class="string">&quot;4&quot;</span> [1]=<span class="string">&quot;4&quot;</span> [2]=<span class="string">&quot;20&quot;</span> [3]=<span class="string">&quot;1&quot;</span> [4]=<span class="string">&quot;release&quot;</span> [5]=<span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span>)</span><br><span class="line"><span class="built_in">declare</span> -a DIRSTACK=()</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="引用数组"><a href="#引用数组" class="headerlink" title="引用数组"></a>引用数组</h2><p><strong>引用特定的数组元素</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果省略[INDEX]表示引用下标为0的元素</span></span><br><span class="line"><span class="variable">$&#123;ARRAY_NAME[INDEX]&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># declare -a title=([0]=&quot;ceo&quot; [1]=&quot;coo&quot; [2]=&quot;cto&quot;)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[1]&#125;</span></span><br><span class="line">coo</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title&#125;</span></span><br><span class="line">ceo</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[2]&#125;</span></span><br><span class="line">cto</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[3]&#125;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>区分这三种写法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo $title</span></span><br><span class="line">ceo</span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[0]&#125;</span></span><br><span class="line">ceo</span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $title[0]</span></span><br><span class="line">ceo[0]</span><br></pre></td></tr></table></figure>

<p><strong>引用数组所有元素</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;ARRAY_NAME[*]&#125;</span></span><br><span class="line"><span class="variable">$&#123;ARRAY_NAME[@]&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[@]&#125;</span></span><br><span class="line">ceo coo cto</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[*]&#125;</span></span><br><span class="line">ceo coo cto</span><br></pre></td></tr></table></figure>

<p>遍历数组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># arr=(&#123;a..e&#125;)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in $&#123;arr[*]&#125;;do echo $i; done;</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># unset arr[2];unset arr[4]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#用连续下标遍历，下标不连续时会有问题</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for ((i=0;i&lt;$&#123;#arr[*]&#125;;i++));do echo $&#123;arr[$i]&#125;;done</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#先取出所有下标，再遍历</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in $&#123;!arr[@]&#125;;do echo $&#123;arr[$i]&#125;;done</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">d</span><br><span class="line">e</span><br></pre></td></tr></table></figure>

<p><strong>数组的长度，即数组中元素的个数</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#ARRAY_NAME[*]&#125;</span></span><br><span class="line"><span class="variable">$&#123;#ARRAY_NAME[@]&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;#title[*]&#125;</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure>



<p><strong>数组的所有下标</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;!ARRAY_NAME[*]&#125;</span></span><br><span class="line"><span class="variable">$&#123;!ARRAY_NAME[@]&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!title[@]&#125;</span></span><br><span class="line">0 1 2</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!title[*]&#125;</span></span><br><span class="line">0 1 2</span><br></pre></td></tr></table></figure>



<h2 id="删除数组"><a href="#删除数组" class="headerlink" title="删除数组"></a>删除数组</h2><p><strong>删除数组中的某元素，会导致稀疏格式</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> ARRAY[INDEX]</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[*]&#125;</span></span><br><span class="line">ceo coo cto</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># unset title[1]</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[*]&#125;</span></span><br><span class="line">ceo cto</span><br></pre></td></tr></table></figure>



<p><strong>删除整个数组</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> ARRAY</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># unset title</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;title[*]&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="数组数据处理"><a href="#数组数据处理" class="headerlink" title="数组数据处理"></a>数组数据处理</h2><p><strong>数组切片</strong> </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;ARRAY[@]:offset:number&#125;</span></span><br><span class="line"><span class="variable">$&#123;ARRAY[*]:offset:number&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">offset      <span class="comment">#要跳过的元素个数</span></span><br><span class="line">number      <span class="comment">#要取出的元素个数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#取偏移量之后的所有元素</span></span><br><span class="line">&#123;ARRAY[@]:offset&#125;</span><br><span class="line">&#123;ARRAY[*]:offset&#125;</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># num=(&#123;0..10&#125;)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;num[*]&#125;</span></span><br><span class="line">0 1 2 3 4 5 6 7 8 9 10</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;num[*]:2:3&#125;</span></span><br><span class="line">2 3 4</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;num[*]:6&#125;</span></span><br><span class="line">6 7 8 9 10</span><br></pre></td></tr></table></figure>

<p><strong>向数组中追加元素</strong></p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ARRAY[<span class="variable">$&#123;#ARRAY[*]&#125;</span>]=value</span><br><span class="line">ARRAY[<span class="variable">$&#123;#ARRAY[@]&#125;</span>]=value</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># num[$&#123;#num[@]&#125;]=11</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;#num[@]&#125;</span></span><br><span class="line">12</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;num[@]&#125;</span></span><br><span class="line">0 1 2 3 4 5 6 7 8 9 10 11</span><br></pre></td></tr></table></figure>

<h2 id="关联数组"><a href="#关联数组" class="headerlink" title="关联数组"></a>关联数组</h2><p>关联数组与普通数组区别： </p>
<ul>
<li>关联数组要先声明，才能使用，普通数组可以不用声明 </li>
<li>关联数组可以自定义下标，普通数组必须用数字</li>
</ul>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -A ARRAY_NAME </span><br><span class="line">ARRAY_NAME=([idx_name1]=<span class="string">&#x27;val1&#x27;</span> [idx_name2]=<span class="string">&#x27;val2‘...)</span></span><br></pre></td></tr></table></figure>

<p>范例：必须先声明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># test[a]=123</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;test[*]&#125;</span></span><br><span class="line">123</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># test[b]=456</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;test[*]&#125;</span></span><br><span class="line">456</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#此处再声明就失败，因为test现在是普通数组</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -A test</span></span><br><span class="line">-bash: <span class="built_in">declare</span>: <span class="built_in">test</span>: cannot convert indexed to associative array</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除之后重新赋值</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># unset test</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -A test</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># test[ceo]=mage</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># test[coo]=zhang</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;test[ceo]&#125;</span></span><br><span class="line">mage</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;test[cto]&#125;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;test[coo]&#125;</span></span><br><span class="line">zhang</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;test[*]&#125;</span></span><br><span class="line">mage zhang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#遍历</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in $&#123;test[*]&#125;;do echo $&#123;i&#125;;done</span></span><br><span class="line">mage</span><br><span class="line">zhang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#遍历下标，根据下标取元素内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in $&#123;!test[*]&#125;;do echo $&#123;test[$i]&#125;;done</span></span><br><span class="line">mage</span><br><span class="line">zhang</span><br></pre></td></tr></table></figure>

<p>范例：关联数组赋值必须指定下标</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#报错</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -A studentList</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># studentList=(tom jerry)</span></span><br><span class="line">-bash: studentList: tom: must use subscript when assigning associative array</span><br><span class="line">-bash: studentList: jerry: must use subscript when assigning associative array</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># studentList=([stu1]=tom [stu2]=jerry)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;studentList[*]&#125;</span></span><br><span class="line">jerry tom</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!studentList[*]&#125;</span></span><br><span class="line">stu2 stu1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#根据下标遍历</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in $&#123;!studentList[*]&#125;;do echo $i=$&#123;studentList[$i]&#125;;done</span></span><br><span class="line">stu2=jerry</span><br><span class="line">stu1=tom</span><br></pre></td></tr></table></figure>

<p>范例：显示所有关联数组下标</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># declare -A title=([ceo]=mage [coo]=zhang [cto]=wang)</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!title[@]&#125;</span></span><br><span class="line">ceo cto coo</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># declare -A student</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># student[name1]=lijun</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># student[name2]=ziqing</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># student[age1]=18</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># student[age2]=16</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;student[*]&#125;</span></span><br><span class="line">16 18 ziqing lijun</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!student[*]&#125;</span></span><br><span class="line">age2 age1 name2 name1</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in &#123;1..5&#125;;do echo student&#123;name$i]=$&#123;student[name$i]&#125;;done</span></span><br><span class="line">student&#123;name1]=lijun</span><br><span class="line">student&#123;name2]=ziqing</span><br><span class="line">student&#123;name3]=</span><br><span class="line">student&#123;name4]=</span><br><span class="line">student&#123;name5]=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in &#123;1..2&#125;;do echo $&#123;student[name$i]&#125;: $&#123;student[age$i]&#125;;done;</span></span><br><span class="line">lijun: 18</span><br><span class="line">ziqing: 16</span><br></pre></td></tr></table></figure>

<h2 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h2><p>生成10个随机数保存于数组中，并找出其最大值和最小值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat rand.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -i min max</span><br><span class="line"><span class="built_in">declare</span> -a nums</span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++));<span class="keyword">do</span></span><br><span class="line"> nums[<span class="variable">$i</span>]=<span class="variable">$RANDOM</span></span><br><span class="line"> <span class="keyword">if</span> [ <span class="variable">$i</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    min=<span class="variable">$&#123;nums[0]&#125;</span></span><br><span class="line">    max=<span class="variable">$&#123;nums[0]&#125;</span></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$&#123;nums[$i]&#125;</span> -gt <span class="variable">$max</span> ]; <span class="keyword">then</span></span><br><span class="line">        max=<span class="variable">$&#123;nums[$i]&#125;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$&#123;nums[$i]&#125;</span> -lt <span class="variable">$min</span> ]; <span class="keyword">then</span></span><br><span class="line">        min=<span class="variable">$&#123;nums[$i]&#125;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All numbers are <span class="variable">$&#123;nums[*]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> Max is <span class="variable">$max</span></span><br><span class="line"><span class="built_in">echo</span> Min is <span class="variable">$min</span></span><br></pre></td></tr></table></figure>

<p>管道实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat rand2.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -a nums</span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++));<span class="keyword">do</span></span><br><span class="line">   nums[<span class="variable">$i</span>]=<span class="variable">$RANDOM</span></span><br><span class="line">   </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">min=`<span class="built_in">echo</span> <span class="variable">$&#123;nums[*]&#125;</span> | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span> | <span class="built_in">sort</span> -n | <span class="built_in">head</span> -n1`</span><br><span class="line">max=`<span class="built_in">echo</span> <span class="variable">$&#123;nums[*]&#125;</span> | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n1`</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All numbers are <span class="variable">$&#123;nums[*]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> MAX <span class="variable">$max</span></span><br><span class="line"><span class="built_in">echo</span> MIN <span class="variable">$min</span></span><br></pre></td></tr></table></figure>

<h1 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h1><h2 id="字符串切片"><a href="#字符串切片" class="headerlink" title="字符串切片"></a>字符串切片</h2><h3 id="基于偏移量取字符串"><a href="#基于偏移量取字符串" class="headerlink" title="基于偏移量取字符串"></a>基于偏移量取字符串</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#var&#125;</span>                     <span class="comment">#返回字符串变量var的字符的长度,一个汉字算一个字符</span></span><br><span class="line"><span class="variable">$&#123;var:offset&#125;</span>               <span class="comment">#返回字符串变量var中从第offset个字符后（不包括第offset个字符）的字符开始，到最后的部分，offset的取值在0 到 $&#123;#var&#125;-1 之间(bash4.2后，允许为负值)</span></span><br><span class="line"><span class="variable">$&#123;var:offset:number&#125;</span>        <span class="comment">#返回字符串变量var中从第offset个字符后（不包括第offset个字符）的字符开始，长度为number的部分</span></span><br><span class="line"><span class="variable">$&#123;var: -length&#125;</span>             <span class="comment">#取字符串的最右侧几个字符, 注意：冒号后必须有一空白字符</span></span><br><span class="line"><span class="variable">$&#123;var:offset:-length&#125;</span>       <span class="comment">#从最左侧跳过offset字符，一直向右取到距离最右侧lengh个字符之前的内容,即:掐头去尾</span></span><br><span class="line"><span class="variable">$&#123;var: -length:-offset&#125;</span>     <span class="comment">#先从最右侧向左取到length个字符开始，再向右取到距离最右侧offset个字符之间的内容,注意：-length前空格,并且length必须大于offset</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str=abcd1234</span></span><br><span class="line">[root@rocky86 ~]<span class="comment">#echo $&#123;#str&#125;</span></span><br><span class="line">8</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str:2&#125;</span></span><br><span class="line">cd1234</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str:2:4&#125;</span></span><br><span class="line">cd12</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str: -3&#125;</span></span><br><span class="line">234</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment">## echo $&#123;str:2:-1&#125;</span></span><br><span class="line">cd123</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str: -6:-2&#125;</span></span><br><span class="line">cd12</span><br><span class="line"></span><br><span class="line"><span class="comment">#一个中文算一个字符长度</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># str2=我爱中国</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;#str2&#125;</span></span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<h3 id="基于模式取子串"><a href="#基于模式取子串" class="headerlink" title="基于模式取子串"></a>基于模式取子串</h3><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#其中word可以是指定的任意字符,自左而右，查找var变量所存储的字符串中，第一次出现的word, 删除字符串开头至第一次出现word字符串（含）之间的所有字符,即懒惰模式,以第一个word为界删左留右</span></span><br><span class="line"><span class="variable">$&#123;var#*word&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从var变量的值中删除以word开头的部分</span></span><br><span class="line"><span class="variable">$&#123;var#word&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同上，贪婪模式，不同的是，删除的是字符串开头至最后一次由word指定的字符之间的所有内容,即贪婪模式,以最后一个word为界删左留右</span></span><br><span class="line"><span class="variable">$&#123;var##*word&#125;</span></span><br><span class="line"><span class="variable">$&#123;var##word&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str=abcd1234abcd1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除第一次出现的cd及其左边的内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str#*cd&#125;</span></span><br><span class="line">1234abcd1234</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除左边第一个ab</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str#ab&#125;</span></span><br><span class="line">cd1234abcd1234</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除最后第一次出现的cd及其左边的内容</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str##*cd&#125;</span></span><br><span class="line">1234</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str##ab&#125;</span></span><br><span class="line">cd1234abcd1234</span><br></pre></td></tr></table></figure>

<p>范例：保留文件名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># nginx_url=http://nginx.org/download/nginx-1.20.2.tar.gz</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;nginx_url##*/&#125;</span></span><br><span class="line">nginx-1.20.2.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#其中word可以是指定的任意字符,功能：自右而左，查找var变量所存储的字符串中，第一次出现的word, 删除字符串最后一个字符向左至第一次出现word字符串（含）之间的所有字符,即懒惰模式,以从右向左的第一个word为界删右留左</span></span><br><span class="line"><span class="variable">$&#123;var%word*&#125;</span></span><br><span class="line"><span class="variable">$&#123;var%word&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同上，只不过删除字符串最右侧的字符向左至最后一次出现word字符之间的所有字符,即贪婪模式,以从右向左的最后一个word为界删右留左</span></span><br><span class="line"><span class="variable">$&#123;var%%word*&#125;</span></span><br><span class="line"><span class="variable">$&#123;var%%word&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str=abcd1234abcd12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从右边开始查找，删除第一个ab及右边的字符串</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str%ab*&#125;</span></span><br><span class="line">abcd1234</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除右边的12345</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str%12345&#125;</span></span><br><span class="line">abcd1234abcd</span><br><span class="line"></span><br><span class="line"><span class="comment">#从右边开始查找，删除最后一个123及右边的字符串</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str%%123*&#125;</span></span><br><span class="line">abcd</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除右边第一12345</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str%%12345&#125;</span></span><br><span class="line">abcd1234abcd</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># url=http://www.magedu.com:8080</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;url##*:&#125;</span></span><br><span class="line">8080</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;url%%:*&#125;</span></span><br><span class="line">http</span><br></pre></td></tr></table></figure>

<h2 id="查找替换"><a href="#查找替换" class="headerlink" title="查找替换"></a>查找替换</h2><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查找var所表示的字符串中，第一次被pattern所匹配到的字符串，以substr替换之，懒惰模式</span></span><br><span class="line"><span class="variable">$&#123;var/pattern/substr&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查找var所表示的字符串中，所有能被pattern所匹配到的字符串，以substr替换之，贪婪模式</span></span><br><span class="line"><span class="variable">$&#123;var//pattern/substr&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查找var所表示的字符串中，行首被pattern所匹配到的字符串，以substr替换之</span></span><br><span class="line"><span class="variable">$&#123;var/#pattern/substr&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查找var所表示的字符串中，行尾被pattern所匹配到的字符串，以substr替换之</span></span><br><span class="line"><span class="variable">$&#123;var/%pattern/substr&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str=abcd1234abcd12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从左到右，替换第一个123为XYZ</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str/123/XYZ&#125;</span></span><br><span class="line">abcdXYZ4abcd12345</span><br><span class="line"></span><br><span class="line"><span class="comment">#从左到右，替换所有123为XYZ</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str//123/XYZ&#125;</span></span><br><span class="line">abcdXYZ4abcdXYZ45</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换行首的abc为XYZ</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str/#abc/XYZ&#125;</span></span><br><span class="line">XYZd1234abcd12345</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换行尾的12345为XYZ</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str/%12345/XYZ&#125;</span></span><br><span class="line">abcd1234abcdXYZ</span><br></pre></td></tr></table></figure>

<h2 id="查找并删除"><a href="#查找并删除" class="headerlink" title="查找并删除"></a>查找并删除</h2><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除var表示的字符串中第一次被pattern匹配到的字符串，懒惰模式</span></span><br><span class="line"><span class="variable">$&#123;var/pattern&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除var表示的字符串中所有被pattern匹配到的字符串，贪婪模式</span></span><br><span class="line"><span class="variable">$&#123;var//pattern&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除var表示的字符串中所有以pattern为行首匹配到的字符串</span></span><br><span class="line"><span class="variable">$&#123;var/#pattern&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除var所表示的字符串中所有以pattern为行尾所匹配到的字符串</span></span><br><span class="line"><span class="variable">$&#123;var/%pattern&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str=abcd1234abcd12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从左到右删除第一个1234</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str/1234&#125;</span></span><br><span class="line">abcdabcd12345</span><br><span class="line"></span><br><span class="line"><span class="comment">#从左到右删除所有1234</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str//1234&#125;</span></span><br><span class="line">abcdabcd5</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除行首abcd</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str/#abcd&#125;</span></span><br><span class="line">1234abcd12345</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除行尾12345</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str/%12345&#125;</span></span><br><span class="line">abcd1234abcd</span><br></pre></td></tr></table></figure>

<h2 id="字符大小写转换"><a href="#字符大小写转换" class="headerlink" title="字符大小写转换"></a>字符大小写转换</h2><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#把var中的所有小写字母转换为大写</span></span><br><span class="line"><span class="variable">$&#123;var^^&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#把var中的所有大写字母转换为小写</span></span><br><span class="line"><span class="variable">$&#123;var,,&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str=abcd1234ABCD12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#所有小写转大写</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str^^&#125;</span></span><br><span class="line">ABCD1234ABCD12345</span><br><span class="line"></span><br><span class="line"><span class="comment">#所有大写转小写</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str,,&#125;</span></span><br><span class="line">abcd1234abcd12345</span><br><span class="line"></span><br><span class="line"><span class="comment">#tr实现大小写转换</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $str | tr &#x27;a-z&#x27; &#x27;A-Z&#x27;</span></span><br><span class="line">ABCD1234ABCD12345</span><br></pre></td></tr></table></figure>

<h2 id="变量扩展"><a href="#变量扩展" class="headerlink" title="变量扩展"></a>变量扩展</h2><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#扩展以所有prefix开头的变量</span></span><br><span class="line"><span class="variable">$&#123;!prefix*&#125;</span></span><br><span class="line"><span class="variable">$&#123;!prefix@&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：模糊匹配变量名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># file1=a;file2=b;file3=c</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!file*&#125;</span></span><br><span class="line">file1 file2 file3</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!file@&#125;</span></span><br><span class="line">file1 file2 file3</span><br></pre></td></tr></table></figure>

<h1 id="高级变量"><a href="#高级变量" class="headerlink" title="高级变量"></a>高级变量</h1><h2 id="高级变量赋值"><a href="#高级变量赋值" class="headerlink" title="高级变量赋值"></a>高级变量赋值</h2><p>$str 为变量名，expr 为具体字符串 </p>
<p>这些组合可以省掉一些 if，else 的判断代码</p>
<table>
<thead>
<tr>
<th>变量配置方式</th>
<th>str沒有配置</th>
<th>str为空字符串</th>
<th>str已配置为非空字符串</th>
</tr>
</thead>
<tbody><tr>
<td>var=${str-expr}</td>
<td>var=expr</td>
<td>var=</td>
<td>var=$str</td>
</tr>
<tr>
<td>var=${str:-expr}</td>
<td>var=expr</td>
<td>var=expr</td>
<td>var=$str</td>
</tr>
<tr>
<td>var=${str+expr}</td>
<td>var=</td>
<td>var=expr</td>
<td>var=expr</td>
</tr>
<tr>
<td>var=${str:+expr}</td>
<td>var=</td>
<td>var=</td>
<td>var=expr</td>
</tr>
<tr>
<td>var=${str=expr}</td>
<td>str=expr; var=expr</td>
<td>str不变; var=</td>
<td>str不变; var=$str</td>
</tr>
<tr>
<td>var=${str:=expr}</td>
<td>str=expr; var=expr</td>
<td>str=expr; var=expr</td>
<td>str不变; var=$str</td>
</tr>
<tr>
<td>var=${str?expr}</td>
<td>expr 输出至 stderr</td>
<td>var=</td>
<td>var=$str</td>
</tr>
<tr>
<td>var=${str:?expr}</td>
<td>expr 输出至 stderr</td>
<td>expr输出至stderr</td>
<td>var=$str</td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># str1=abc</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str1-xyz&#125;</span></span><br><span class="line">abc</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># str1=&quot;&quot;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str1-xyz&#125;</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># unset str1</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;str1-xyz&#125;</span></span><br><span class="line">xyz</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># title=ceo</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># name=$&#123;title:-mage&#125;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $name</span></span><br><span class="line">ceo</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># title=</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># name=$&#123;title:-mage&#125;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $name</span></span><br><span class="line">mage</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># unset title</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># name=$&#123;title:-mage&#125;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $name</span></span><br><span class="line">mage</span><br></pre></td></tr></table></figure>

<h2 id="高级变量用法-有类型变量"><a href="#高级变量用法-有类型变量" class="headerlink" title="高级变量用法-有类型变量"></a>高级变量用法-有类型变量</h2><p>Shell变量一般是无类型的，但是bash Shell提供了declare和typeset两个命令用于指定变量的类型，两个命令是等价的 </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> [-aAfFgilnrtux] [-p] [name[=value] ...]</span><br><span class="line"><span class="comment">#选项：</span></span><br><span class="line">-f                      <span class="comment">#显示已定义的所有函数名及其内容</span></span><br><span class="line">-F                      <span class="comment">#仅显示已定义的所有函数名</span></span><br><span class="line">-p                      <span class="comment">#显示每个变量的属性和值</span></span><br><span class="line">-a                      <span class="comment">#声明或显示定义为数组的变量</span></span><br><span class="line">-A                      <span class="comment">#将变量定义为关联数组      </span></span><br><span class="line">-i                      <span class="comment">#声明或显示定义为整型的变量</span></span><br><span class="line">-l                      <span class="comment">#声明或显示定义为小写的变量</span></span><br><span class="line">-n                      <span class="comment">#变量引用另外一个变量的值</span></span><br><span class="line">-r                      <span class="comment">#声明或显示只读变量</span></span><br><span class="line">-t                      <span class="comment">#声明或显示具有trace(追踪)属性的变量</span></span><br><span class="line">-u                      <span class="comment">#声明或显示定义为大写的变量</span></span><br><span class="line">-x                      <span class="comment">#显示环境变量和函数,相当于export </span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示所有己定义的函数和函数体</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示所有己定义的函数，仅函数名</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -F</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示所有己定义的变量属性及值</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -p</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示所有普通数组</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义一个普通数组</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -a arr1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示所有关联数组</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -A</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义一个关联数组</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -A arr2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示所有整型变量</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -i</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义一个整型变量</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -i int1</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># int1=abcd</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $int1</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示所有小写变量</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义一个整型变量</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -l lower1</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># lower1=1234abcdABCD</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $lower1</span></span><br><span class="line">1234abcdabcd</span><br><span class="line"></span><br><span class="line"><span class="comment">#变量引用</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># str1=1234</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -n str2=str1</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $str1 $str2</span></span><br><span class="line">1234 1234</span><br><span class="line"></span><br><span class="line"><span class="comment">#str2 会跟着改变</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># str1=abcd</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $str1 $str2</span></span><br><span class="line">abcd abcd</span><br><span class="line"></span><br><span class="line"><span class="comment">#str1 也会跟着改变</span></span><br><span class="line">[root@rocky86 ~]<span class="comment">#str2=xyz</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $str1 $str2</span></span><br><span class="line">xyz xyz</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示所有只读变量</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -r</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#只读变量在定义时就要赋值</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -r r1</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># r1=123</span></span><br><span class="line">-bash: r1: <span class="built_in">readonly</span> variable</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># declare -r r2=123</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $r2</span></span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h2 id="变量间接引用"><a href="#变量间接引用" class="headerlink" title="变量间接引用"></a>变量间接引用</h2><h3 id="eval命令"><a href="#eval命令" class="headerlink" title="eval命令"></a>eval命令</h3><p>eval命令将会首先扫描命令行进行所有的置换，然后再执行该命令。该命令适用于那些一次扫描无法实现其功能的变量,该命令对变量进行两次扫描</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># CMD=whoami</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $CMD</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># eval $CMD</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># n1=6</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo &#123;1..$n1&#125;</span></span><br><span class="line">&#123;1..6&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#两次展开</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># eval echo &#123;1..$n1&#125;</span></span><br><span class="line">1 2 3 4 5 6</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># for i in `eval echo &#123;1..$n1&#125;`;do echo i=$i;done</span></span><br><span class="line">i=1</span><br><span class="line">i=2</span><br><span class="line">i=3</span><br><span class="line">i=4</span><br><span class="line">i=5</span><br><span class="line">i=6</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># a=aa;b=bb</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># $a$b=cc</span></span><br><span class="line">bash: aabb=cc: <span class="built_in">command</span> not found...</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># eval $a$b=cc</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $a$b</span></span><br><span class="line">aabb</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $aabb</span></span><br><span class="line">cc</span><br></pre></td></tr></table></figure>

<h3 id="间接变量引用"><a href="#间接变量引用" class="headerlink" title="间接变量引用"></a>间接变量引用</h3><p>如果第一个变量的值是第二个变量的名字，从第一个变量引用第二个变量的值就称为间接变量引用variable1的值是variable2，而variable2又是变量名，variable2的值为value，间接变量引用是指通过variable1获得变量值value的行为</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">variable1=variable2</span><br><span class="line">variable2=value</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># var1=str</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># str=abcd</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $var1</span></span><br><span class="line">str</span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo \$$var1</span></span><br><span class="line"><span class="variable">$str</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># eval echo \$$var1</span></span><br><span class="line">abcd</span><br></pre></td></tr></table></figure>

<p>bash Shell提供了两种格式实现间接变量引用 </p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法1</span></span><br><span class="line"><span class="comment">#变量赋值</span></span><br><span class="line"><span class="built_in">eval</span> tempvar=\$<span class="variable">$variable1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示值</span></span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">echo</span> \$<span class="variable">$variable1</span></span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">echo</span> <span class="string">&#x27;$&#x27;</span><span class="variable">$variable1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tmpvar</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#方法2</span></span><br><span class="line"><span class="comment">#变量赋值</span></span><br><span class="line">tempvar=<span class="variable">$&#123;!variable1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示值</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!variable1&#125;</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># ceo=name</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># name=mage</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># eval echo \$$ceo</span></span><br><span class="line">mage</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># eval tmp=\$$ceo</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $tmp</span></span><br><span class="line">mage</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $&#123;!ceo&#125;</span></span><br><span class="line">mage</span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># tmp2=$&#123;!ceo&#125;</span></span><br><span class="line">[root@rocky86 ~]<span class="comment"># echo $tmp2</span></span><br><span class="line">mage</span><br></pre></td></tr></table></figure>

<p>面试题：下面脚本执行结果输出什么</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]<span class="comment"># cat var123.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">var</span></span>()&#123;</span><br><span class="line"> <span class="built_in">local</span> var=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;!var&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">var 1 a</span><br><span class="line">var 2 a b</span><br><span class="line">var 3 a b c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky86 ~]<span class="comment"># bash var123.sh</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">૮(˶ᵔ ᵕ ᵔ˶)ა</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/11/05/SRE-Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/">http://example.com/2024/11/05/SRE-Shell脚本编程/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">૮(˶ᵔ ᵕ ᵔ˶)ა</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SRE/">SRE</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="/../images/TITLE/linux2.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/25/MY-ElasticsearchPOD%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Epending%E7%8A%B6%E6%80%81/" title="部署 ELK pod 处于 pending 状态"><img class="cover" src="/../images/TITLE/Elastic-err.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">部署 ELK pod 处于 pending 状态</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/08/ST-Linux%E5%AE%9E%E7%94%A8%E7%94%A8%E8%84%9A%E6%9C%AC/" title="Linux 实用脚本"><img class="cover" src="/../images/TITLE/ST.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux 实用脚本</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/08/27/SRE-Linux%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%92%8CIO%E9%87%8D%E5%AE%9A%E5%90%91/" title="Linux文件管理和IO重定向"><img class="cover" src="/../images/TITLE/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="title">Linux文件管理和IO重定向</div></div></a></div><div><a href="/2024/04/24/SRE-Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%92%8C%E5%B8%AE%E5%8A%A9/" title="Linux基本操作和帮助"><img class="cover" src="/../images/TITLE/linux2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-24</div><div class="title">Linux基本操作和帮助</div></div></a></div><div><a href="/2024/12/08/SRE-Linux%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img class="cover" src="/../images/SRE/day17/12.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="title">Linux防火墙</div></div></a></div><div><a href="/2024/12/08/SRE-linux%E5%91%BD%E4%BB%A4%E7%B4%A2%E5%BC%95/" title="linux命令索引"><img class="cover" src="/../images/TITLE/linux3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-08</div><div class="title">linux命令索引</div></div></a></div><div><a href="/2024/09/23/SRE-%E5%B8%B8%E8%A7%81%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="常见文本处理工具和正则表达式"><img class="cover" src="/../images/TITLE/linux5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-23</div><div class="title">常见文本处理工具和正则表达式</div></div></a></div><div><a href="/2024/12/04/SRE-%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" title="加密和安全"><img class="cover" src="/../images/SRE/day15/13.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-04</div><div class="title">加密和安全</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/../images/TITLE/user.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="author-info__description">这家伙很勤奋，什么都留下了</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">104</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">35</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#shell-%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">shell 脚本语言的基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-%E8%84%9A%E6%9C%AC%E7%9A%84%E7%94%A8%E9%80%94"><span class="toc-number">1.1.</span> <span class="toc-text">shell 脚本的用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-%E8%84%9A%E6%9C%AC%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">shell 脚本基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell%E8%84%9A%E6%9C%AC%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">shell脚本创建过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-%E8%84%9A%E6%9C%AC%E6%B3%A8%E9%87%8A%E8%A7%84%E8%8C%83"><span class="toc-number">1.4.</span> <span class="toc-text">shell 脚本注释规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA-shell-%E8%84%9A%E6%9C%AC"><span class="toc-number">1.5.</span> <span class="toc-text">第一个 shell 脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-%E8%84%9A%E6%9C%AC%E8%B0%83%E8%AF%95"><span class="toc-number">1.6.</span> <span class="toc-text">shell 脚本调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.</span> <span class="toc-text">变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-1"><span class="toc-number">1.7.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">变量类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E5%88%86%E7%B1%BB"><span class="toc-number">1.7.3.</span> <span class="toc-text">编程语言分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shell%E4%B8%AD%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E6%B3%95%E5%88%99"><span class="toc-number">1.7.4.</span> <span class="toc-text">Shell中变量命名法则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%A6%81%E6%B1%82"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">命名要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E4%B9%A0%E6%83%AF"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">命名习惯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89%E5%92%8C%E5%BC%95%E7%94%A8"><span class="toc-number">1.7.5.</span> <span class="toc-text">变量定义和引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.6.</span> <span class="toc-text">环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AA%E8%AF%BB%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.7.</span> <span class="toc-text">只读变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.8.</span> <span class="toc-text">位置变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81%E7%A0%81%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.9.</span> <span class="toc-text">退出状态码变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E5%BC%80%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-number">1.7.10.</span> <span class="toc-text">展开命令行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E5%AE%89%E5%85%A8%E5%92%8C-set"><span class="toc-number">1.7.11.</span> <span class="toc-text">脚本安全和 set</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA-printf"><span class="toc-number">1.8.</span> <span class="toc-text">格式化输出 printf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97"><span class="toc-number">1.9.</span> <span class="toc-text">算术运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">1.10.</span> <span class="toc-text">逻辑运算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E6%88%96%E9%9D%9E"><span class="toc-number">1.10.1.</span> <span class="toc-text">与或非</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E8%B7%AF%E8%BF%90%E7%AE%97"><span class="toc-number">1.10.2.</span> <span class="toc-text">短路运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%AD%E8%B7%AF%E4%B8%8E%E5%92%8C%E6%88%96%E7%BB%84%E5%90%88"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">短路与和或组合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%91%BD%E4%BB%A4"><span class="toc-number">1.11.</span> <span class="toc-text">条件测试命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%B5%8B%E8%AF%95"><span class="toc-number">1.11.1.</span> <span class="toc-text">变量测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%B5%8B%E8%AF%95"><span class="toc-number">1.11.2.</span> <span class="toc-text">数值测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B5%8B%E8%AF%95"><span class="toc-number">1.11.3.</span> <span class="toc-text">字符串测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">1.11.4.</span> <span class="toc-text">文件测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-%E5%92%8C"><span class="toc-number">1.12.</span> <span class="toc-text">关于 () 和 {}</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%B5%8B%E8%AF%95%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.13.</span> <span class="toc-text">组合测试条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.13.1.</span> <span class="toc-text">第一种方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.13.2.</span> <span class="toc-text">第二种方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8read%E5%91%BD%E4%BB%A4%E6%9D%A5%E6%8E%A5%E5%8F%97%E8%BE%93%E5%85%A5"><span class="toc-number">1.14.</span> <span class="toc-text">使用read命令来接受输入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bash-shell-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">bash shell 的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E7%94%9F%E6%95%88%E8%8C%83%E5%9B%B4%E5%88%92%E5%88%86%E4%B8%A4%E7%B1%BB"><span class="toc-number">2.1.</span> <span class="toc-text">按生效范围划分两类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell%E7%99%BB%E5%BD%95%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.</span> <span class="toc-text">shell登录两种方式分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%99%BB%E5%BD%95"><span class="toc-number">2.2.1.</span> <span class="toc-text">交互式登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%99%BB%E5%BD%95"><span class="toc-number">2.2.2.</span> <span class="toc-text">非交互式登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E5%8A%9F%E8%83%BD%E5%88%92%E5%88%86%E5%88%86%E7%B1%BB"><span class="toc-number">2.3.</span> <span class="toc-text">按功能划分分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%94%9F%E6%95%88"><span class="toc-number">2.4.</span> <span class="toc-text">编辑配置文件生效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bash-%E9%80%80%E5%87%BA%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.5.</span> <span class="toc-text">Bash 退出任务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E9%80%89%E6%8B%A9"><span class="toc-number">3.1.</span> <span class="toc-text">条件选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E5%88%86%E7%BB%8D"><span class="toc-number">3.1.1.</span> <span class="toc-text">条件判断分绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%88%86%E6%94%AF%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">单分支条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%88%86%E6%94%AF%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">多分支条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%89%A7%E8%A1%8C-if-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.2.</span> <span class="toc-text">选择执行 if 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD-case-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.3.</span> <span class="toc-text">条件判断 case 语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF"><span class="toc-number">3.2.</span> <span class="toc-text">循环</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E6%89%A7%E8%A1%8C%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.2.1.</span> <span class="toc-text">循环执行介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-for"><span class="toc-number">3.2.2.</span> <span class="toc-text">循环 for</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-while"><span class="toc-number">3.2.3.</span> <span class="toc-text">循环 while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#while-%E7%89%B9%E6%AE%8A%E7%94%A8%E6%B3%95-while-read"><span class="toc-number">3.2.4.</span> <span class="toc-text">while 特殊用法 while read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF-until"><span class="toc-number">3.2.5.</span> <span class="toc-text">循环 until</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5-continue"><span class="toc-number">3.2.6.</span> <span class="toc-text">循环控制语句 continue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5-break"><span class="toc-number">3.2.7.</span> <span class="toc-text">循环控制语句 break</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6-shift-%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.8.</span> <span class="toc-text">循环控制 shift 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%B8%8E%E8%8F%9C%E5%8D%95-select"><span class="toc-number">3.2.9.</span> <span class="toc-text">循环与菜单 select</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-function"><span class="toc-number">4.</span> <span class="toc-text">函数 function</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">函数介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">管理函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.1.</span> <span class="toc-text">定义函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.2.</span> <span class="toc-text">查看函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.3.</span> <span class="toc-text">删除函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">4.3.</span> <span class="toc-text">函数调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%8E%AF%E5%A2%83%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.1.</span> <span class="toc-text">交互式环境调用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%84%9A%E6%9C%AC%E4%B8%AD%E5%AE%9A%E4%B9%89%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.2.</span> <span class="toc-text">在脚本中定义及使用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.3.</span> <span class="toc-text">使用函数文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">4.4.</span> <span class="toc-text">函数返回值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.</span> <span class="toc-text">环境函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="toc-number">4.6.</span> <span class="toc-text">函数参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%8F%98%E9%87%8F"><span class="toc-number">4.7.</span> <span class="toc-text">函数变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%80%92%E5%BD%92"><span class="toc-number">4.8.</span> <span class="toc-text">函数递归</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E8%84%9A%E6%9C%AC%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-number">5.</span> <span class="toc-text">其它脚本相关工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89-trap"><span class="toc-number">5.1.</span> <span class="toc-text">信号捕捉 trap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6-install"><span class="toc-number">5.2.</span> <span class="toc-text">安装复制文件 install</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-array"><span class="toc-number">6.</span> <span class="toc-text">数组 array</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">数组介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E6%95%B0%E7%BB%84"><span class="toc-number">6.2.</span> <span class="toc-text">声明数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E8%B5%8B%E5%80%BC"><span class="toc-number">6.3.</span> <span class="toc-text">数组赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E6%95%B0%E7%BB%84"><span class="toc-number">6.4.</span> <span class="toc-text">显示所有数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%95%B0%E7%BB%84"><span class="toc-number">6.5.</span> <span class="toc-text">引用数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E7%BB%84"><span class="toc-number">6.6.</span> <span class="toc-text">删除数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">6.7.</span> <span class="toc-text">数组数据处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84"><span class="toc-number">6.8.</span> <span class="toc-text">关联数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B"><span class="toc-number">6.9.</span> <span class="toc-text">范例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">字符串处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%87%E7%89%87"><span class="toc-number">7.1.</span> <span class="toc-text">字符串切片</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%81%8F%E7%A7%BB%E9%87%8F%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">7.1.1.</span> <span class="toc-text">基于偏移量取字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%A8%A1%E5%BC%8F%E5%8F%96%E5%AD%90%E4%B8%B2"><span class="toc-number">7.1.2.</span> <span class="toc-text">基于模式取子串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%9B%BF%E6%8D%A2"><span class="toc-number">7.2.</span> <span class="toc-text">查找替换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%B9%B6%E5%88%A0%E9%99%A4"><span class="toc-number">7.3.</span> <span class="toc-text">查找并删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.4.</span> <span class="toc-text">字符大小写转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%89%A9%E5%B1%95"><span class="toc-number">7.5.</span> <span class="toc-text">变量扩展</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%8F%98%E9%87%8F"><span class="toc-number">8.</span> <span class="toc-text">高级变量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC"><span class="toc-number">8.1.</span> <span class="toc-text">高级变量赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%8F%98%E9%87%8F%E7%94%A8%E6%B3%95-%E6%9C%89%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F"><span class="toc-number">8.2.</span> <span class="toc-text">高级变量用法-有类型变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E9%97%B4%E6%8E%A5%E5%BC%95%E7%94%A8"><span class="toc-number">8.3.</span> <span class="toc-text">变量间接引用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#eval%E5%91%BD%E4%BB%A4"><span class="toc-number">8.3.1.</span> <span class="toc-text">eval命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%B4%E6%8E%A5%E5%8F%98%E9%87%8F%E5%BC%95%E7%94%A8"><span class="toc-number">8.3.2.</span> <span class="toc-text">间接变量引用</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/10/MY-k8s%E5%AE%B9%E5%BF%8D%E6%B1%A1%E7%82%B9%E4%BA%B2%E5%92%8CHPA/" title="容忍/污点/亲和/HPA"><img src="/../images/SRE/day46/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="容忍/污点/亲和/HPA"/></a><div class="content"><a class="title" href="/2025/08/10/MY-k8s%E5%AE%B9%E5%BF%8D%E6%B1%A1%E7%82%B9%E4%BA%B2%E5%92%8CHPA/" title="容忍/污点/亲和/HPA">容忍/污点/亲和/HPA</a><time datetime="2025-08-10T09:35:57.000Z" title="发表于 2025-08-10 17:35:57">2025-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/01/MY-Proxy/" title="Proxy 代理"><img src="/../images/MY/clash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Proxy 代理"/></a><div class="content"><a class="title" href="/2025/08/01/MY-Proxy/" title="Proxy 代理">Proxy 代理</a><time datetime="2025-08-01T11:05:46.000Z" title="发表于 2025-08-01 19:05:46">2025-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2"><img src="/../images/SRE/day46/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S 1.29.2"/></a><div class="content"><a class="title" href="/2025/07/30/MY-k8s1.29/" title="K8S 1.29.2">K8S 1.29.2</a><time datetime="2025-07-30T07:17:21.000Z" title="发表于 2025-07-30 15:17:21">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins"><img src="/../images/SRE/day55/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DevOps之CICD工具Jenkins"/></a><div class="content"><a class="title" href="/2025/05/09/SRE-jenkins/" title="DevOps之CICD工具Jenkins">DevOps之CICD工具Jenkins</a><time datetime="2025-05-09T09:30:43.000Z" title="发表于 2025-05-09 17:30:43">2025-05-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By ૮(˶ᵔ ᵕ ᵔ˶)ა</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index"><img src="../images/BEIAN/icp.png" width="15" height="15">豫ICP备2023009931号</a></br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162702000178" target="_blank"><img src="../images/BEIAN/beian.png" width="15" height="15">豫公网安备 41162702000178号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>